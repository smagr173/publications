/*! For license information please see main.js.LICENSE.txt */
(()=>{var e,t,n={7657:e=>{const t=.3048,n=.0254,r=1609.34,i=1853.248;e.exports=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.toObject=()=>({fl:this.fl,ft:this.ft,in:this.in,km:this.km,m:this.m,mi:this.mi,nm:this.nm});const o=(null==e?void 0:e.unit)||"m",s=(null==e?void 0:e.value)||"GND";this.m="GND"===s?0:"UNL"===s?8e4:function(e,o){switch(e){case"fl":return 30.48*o;case"ft":return o*t;case"in":return o*n;case"km":return 1e3*o;case"m":return o;case"sm":return 10*o;case"mi":return o*r;case"nm":case"[nmi_i]":return o*i;default:return null}}(o.toLowerCase(),s),this.fl=this.m/30.48,this.ft=this.m/t,this.in=this.m/n,this.km=this.m/1e3,this.mi=this.m/r,this.nm=this.m/i}}},5296:(e,t,n)=>{"use strict";n.d(t,{Z:()=>re});var r=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(e){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),i=Math.abs,o=String.fromCharCode,s=Object.assign;function a(e){return e.trim()}function l(e,t,n){return e.replace(t,n)}function c(e,t){return e.indexOf(t)}function u(e,t){return 0|e.charCodeAt(t)}function h(e,t,n){return e.slice(t,n)}function d(e){return e.length}function p(e){return e.length}function f(e,t){return t.push(e),e}var m=1,g=1,y=0,v=0,_=0,x="";function b(e,t,n,r,i,o,s){return{value:e,root:t,parent:n,type:r,props:i,children:o,line:m,column:g,length:s,return:""}}function w(e,t){return s(b("",null,null,"",null,null,0),e,{length:-e.length},t)}function S(){return _=v>0?u(x,--v):0,g--,10===_&&(g=1,m--),_}function M(){return _=v<y?u(x,v++):0,g++,10===_&&(g=1,m++),_}function E(){return u(x,v)}function T(){return v}function C(e,t){return h(x,e,t)}function A(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function I(e){return m=g=1,y=d(x=e),v=0,[]}function P(e){return x="",e}function R(e){return a(C(v-1,O(91===e?e+2:40===e?e+1:e)))}function L(e){for(;(_=E())&&_<33;)M();return A(e)>2||A(_)>3?"":" "}function D(e,t){for(;--t&&M()&&!(_<48||_>102||_>57&&_<65||_>70&&_<97););return C(e,T()+(t<6&&32==E()&&32==M()))}function O(e){for(;M();)switch(_){case e:return v;case 34:case 39:34!==e&&39!==e&&O(_);break;case 40:41===e&&O(e);break;case 92:M()}return v}function N(e,t){for(;M()&&e+_!==57&&(e+_!==84||47!==E()););return"/*"+C(t,v-1)+"*"+o(47===e?e:M())}function k(e){for(;!A(E());)M();return C(e,v)}var F="-ms-",z="-moz-",B="-webkit-",U="comm",j="rule",V="decl",G="@keyframes";function H(e,t){for(var n="",r=p(e),i=0;i<r;i++)n+=t(e[i],i,e,t)||"";return n}function Z(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case V:return e.return=e.return||e.value;case U:return"";case G:return e.return=e.value+"{"+H(e.children,r)+"}";case j:e.value=e.props.join(",")}return d(n=H(e.children,r))?e.return=e.value+"{"+n+"}":""}function W(e){return P($("",null,null,null,[""],e=I(e),0,[0],e))}function $(e,t,n,r,i,s,a,h,p){for(var m=0,g=0,y=a,v=0,_=0,x=0,b=1,w=1,C=1,A=0,I="",P=i,O=s,F=r,z=I;w;)switch(x=A,A=M()){case 40:if(108!=x&&58==u(z,y-1)){-1!=c(z+=l(R(A),"&","&\f"),"&\f")&&(C=-1);break}case 34:case 39:case 91:z+=R(A);break;case 9:case 10:case 13:case 32:z+=L(x);break;case 92:z+=D(T()-1,7);continue;case 47:switch(E()){case 42:case 47:f(X(N(M(),T()),t,n),p);break;default:z+="/"}break;case 123*b:h[m++]=d(z)*C;case 125*b:case 59:case 0:switch(A){case 0:case 125:w=0;case 59+g:-1==C&&(z=l(z,/\f/g,"")),_>0&&d(z)-y&&f(_>32?Y(z+";",r,n,y-1):Y(l(z," ","")+";",r,n,y-2),p);break;case 59:z+=";";default:if(f(F=q(z,t,n,m,g,i,h,I,P=[],O=[],y),s),123===A)if(0===g)$(z,t,F,F,P,s,y,h,O);else switch(99===v&&110===u(z,3)?100:v){case 100:case 108:case 109:case 115:$(e,F,F,r&&f(q(e,F,F,0,0,i,h,I,i,P=[],y),O),i,O,y,h,r?P:O);break;default:$(z,F,F,F,[""],O,0,h,O)}}m=g=_=0,b=C=1,I=z="",y=a;break;case 58:y=1+d(z),_=x;default:if(b<1)if(123==A)--b;else if(125==A&&0==b++&&125==S())continue;switch(z+=o(A),A*b){case 38:C=g>0?1:(z+="\f",-1);break;case 44:h[m++]=(d(z)-1)*C,C=1;break;case 64:45===E()&&(z+=R(M())),v=E(),g=y=d(I=z+=k(T())),A++;break;case 45:45===x&&2==d(z)&&(b=0)}}return s}function q(e,t,n,r,o,s,c,u,d,f,m){for(var g=o-1,y=0===o?s:[""],v=p(y),_=0,x=0,w=0;_<r;++_)for(var S=0,M=h(e,g+1,g=i(x=c[_])),E=e;S<v;++S)(E=a(x>0?y[S]+" "+M:l(M,/&\f/g,y[S])))&&(d[w++]=E);return b(e,t,n,0===o?j:u,d,f,m)}function X(e,t,n){return b(e,t,n,U,o(_),h(e,2,-2),0)}function Y(e,t,n,r){return b(e,t,n,V,h(e,0,r),h(e,r+1,-1),r)}var K=function(e,t,n){for(var r=0,i=0;r=i,i=E(),38===r&&12===i&&(t[n]=1),!A(i);)M();return C(e,v)},J=new WeakMap,Q=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||J.get(n))&&!r){J.set(e,!0);for(var i=[],s=function(e,t){return P(function(e,t){var n=-1,r=44;do{switch(A(r)){case 0:38===r&&12===E()&&(t[n]=1),e[n]+=K(v-1,t,n);break;case 2:e[n]+=R(r);break;case 4:if(44===r){e[++n]=58===E()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=o(r)}}while(r=M());return e}(I(e),t))}(t,i),a=n.props,l=0,c=0;l<s.length;l++)for(var u=0;u<a.length;u++,c++)e.props[c]=i[l]?s[l].replace(/&\f/g,a[u]):a[u]+" "+s[l]}}},ee=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function te(e,t){switch(function(e,t){return 45^u(e,0)?(((t<<2^u(e,0))<<2^u(e,1))<<2^u(e,2))<<2^u(e,3):0}(e,t)){case 5103:return B+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return B+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return B+e+z+e+F+e+e;case 6828:case 4268:return B+e+F+e+e;case 6165:return B+e+F+"flex-"+e+e;case 5187:return B+e+l(e,/(\w+).+(:[^]+)/,B+"box-$1$2"+F+"flex-$1$2")+e;case 5443:return B+e+F+"flex-item-"+l(e,/flex-|-self/,"")+e;case 4675:return B+e+F+"flex-line-pack"+l(e,/align-content|flex-|-self/,"")+e;case 5548:return B+e+F+l(e,"shrink","negative")+e;case 5292:return B+e+F+l(e,"basis","preferred-size")+e;case 6060:return B+"box-"+l(e,"-grow","")+B+e+F+l(e,"grow","positive")+e;case 4554:return B+l(e,/([^-])(transform)/g,"$1"+B+"$2")+e;case 6187:return l(l(l(e,/(zoom-|grab)/,B+"$1"),/(image-set)/,B+"$1"),e,"")+e;case 5495:case 3959:return l(e,/(image-set\([^]*)/,B+"$1$`$1");case 4968:return l(l(e,/(.+:)(flex-)?(.*)/,B+"box-pack:$3"+F+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+B+e+e;case 4095:case 3583:case 4068:case 2532:return l(e,/(.+)-inline(.+)/,B+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(d(e)-1-t>6)switch(u(e,t+1)){case 109:if(45!==u(e,t+4))break;case 102:return l(e,/(.+:)(.+)-([^]+)/,"$1"+B+"$2-$3$1"+z+(108==u(e,t+3)?"$3":"$2-$3"))+e;case 115:return~c(e,"stretch")?te(l(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==u(e,t+1))break;case 6444:switch(u(e,d(e)-3-(~c(e,"!important")&&10))){case 107:return l(e,":",":"+B)+e;case 101:return l(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+B+(45===u(e,14)?"inline-":"")+"box$3$1"+B+"$2$3$1"+F+"$2box$3")+e}break;case 5936:switch(u(e,t+11)){case 114:return B+e+F+l(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return B+e+F+l(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return B+e+F+l(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return B+e+F+e+e}return e}var ne=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case V:e.return=te(e.value,e.length);break;case G:return H([w(e,{value:l(e.value,"@","@"+B)})],r);case j:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=/(::plac\w+|:read-\w+)/.exec(e))?e[0]:e}(t)){case":read-only":case":read-write":return H([w(e,{props:[l(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return H([w(e,{props:[l(t,/:(plac\w+)/,":"+B+"input-$1")]}),w(e,{props:[l(t,/:(plac\w+)/,":-moz-$1")]}),w(e,{props:[l(t,/:(plac\w+)/,F+"input-$1")]})],r)}return""}))}}],re=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var i,o,s=e.stylisPlugins||ne,a={},l=[];i=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)a[t[n]]=!0;l.push(e)}));var c,u,h,d,f=[Z,(u=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],m=(h=[Q,ee].concat(s,f),d=p(h),function(e,t,n,r){for(var i="",o=0;o<d;o++)i+=h[o](e,t,n,r)||"";return i});o=function(e,t,n,r){c=n,H(W(e?e+"{"+t.styles+"}":t.styles),m),r&&(g.inserted[t.name]=!0)};var g={key:t,sheet:new r({key:t,container:i,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:a,registered:{},insert:o};return g.sheet.hydrate(l),g}},1816:(e,t,n)=>{"use strict";function r(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}n.d(t,{Z:()=>r})},8787:(e,t,n)=>{"use strict";n.d(t,{C:()=>a,T:()=>c,i:()=>o,w:()=>l});var r=n(7313),i=n(5296),o=(n(1086),n(5696),!0),s=r.createContext("undefined"!=typeof HTMLElement?(0,i.Z)({key:"css"}):null),a=s.Provider,l=function(e){return(0,r.forwardRef)((function(t,n){var i=(0,r.useContext)(s);return e(t,i,n)}))};o||(l=function(e){return function(t){var n=(0,r.useContext)(s);return null===n?(n=(0,i.Z)({key:"css"}),r.createElement(s.Provider,{value:n},e(t,n))):e(t,n)}});var c=r.createContext({})},686:(e,t,n)=>{"use strict";n.d(t,{F4:()=>u,iv:()=>c,xB:()=>l});var r=n(8787),i=n(7313),o=n(4911),s=n(5696),a=n(1086),l=(n(5296),n(7861),(0,r.w)((function(e,t){var n=e.styles,l=(0,a.O)([n],void 0,i.useContext(r.T));if(!r.i){for(var c,u=l.name,h=l.styles,d=l.next;void 0!==d;)u+=" "+d.name,h+=d.styles,d=d.next;var p=!0===t.compat,f=t.insert("",{name:u,styles:h},t.sheet,p);return p?null:i.createElement("style",((c={})["data-emotion"]=t.key+"-global "+u,c.dangerouslySetInnerHTML={__html:f},c.nonce=t.sheet.nonce,c))}var m=i.useRef();return(0,s.j)((function(){var e=t.key+"-global",n=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),r=!1,i=document.querySelector('style[data-emotion="'+e+" "+l.name+'"]');return t.sheet.tags.length&&(n.before=t.sheet.tags[0]),null!==i&&(r=!0,i.setAttribute("data-emotion",e),n.hydrate([i])),m.current=[n,r],function(){n.flush()}}),[t]),(0,s.j)((function(){var e=m.current,n=e[0];if(e[1])e[1]=!1;else{if(void 0!==l.next&&(0,o.My)(t,l.next,!0),n.tags.length){var r=n.tags[n.tags.length-1].nextElementSibling;n.before=r,n.flush()}t.insert("",l,n,!1)}}),[t,l.name]),null})));function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.O)(t)}var u=function(){var e=c.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}},1086:(e,t,n)=>{"use strict";n.d(t,{O:()=>f});var r={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},i=n(1816),o=/[A-Z]|^ms/g,s=/_EMO_([^_]+?)_([^]*?)_EMO_/g,a=function(e){return 45===e.charCodeAt(1)},l=function(e){return null!=e&&"boolean"!=typeof e},c=(0,i.Z)((function(e){return a(e)?e:e.replace(o,"-$&").toLowerCase()})),u=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(s,(function(e,t,n){return d={name:t,styles:n,next:d},t}))}return 1===r[e]||a(e)||"number"!=typeof t||0===t?t:t+"px"};function h(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return d={name:n.name,styles:n.styles,next:d},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)d={name:r.name,styles:r.styles,next:d},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=h(e,t,n[i])+";";else for(var o in n){var s=n[o];if("object"!=typeof s)null!=t&&void 0!==t[s]?r+=o+"{"+t[s]+"}":l(s)&&(r+=c(o)+":"+u(o,s)+";");else if(!Array.isArray(s)||"string"!=typeof s[0]||null!=t&&void 0!==t[s[0]]){var a=h(e,t,s);switch(o){case"animation":case"animationName":r+=c(o)+":"+a+";";break;default:r+=o+"{"+a+"}"}}else for(var d=0;d<s.length;d++)l(s[d])&&(r+=c(o)+":"+u(o,s[d])+";")}return r}(e,t,n);case"function":if(void 0!==e){var i=d,o=n(e);return d=i,h(e,t,o)}}if(null==t)return n;var s=t[n];return void 0!==s?s:n}var d,p=/label:\s*([^\s;\n{]+)\s*(;|$)/g,f=function(e,t,n){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,i="";d=void 0;var o=e[0];null==o||void 0===o.raw?(r=!1,i+=h(n,t,o)):i+=o[0];for(var s=1;s<e.length;s++)i+=h(n,t,e[s]),r&&(i+=o[s]);p.lastIndex=0;for(var a,l="";null!==(a=p.exec(i));)l+="-"+a[1];var c=function(e){for(var t,n=0,r=0,i=e.length;i>=4;++r,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(i)+l;return{name:c,styles:i,next:d}}},5696:(e,t,n)=>{"use strict";var r;n.d(t,{L:()=>s,j:()=>a});var i=n(7313),o=!!(r||(r=n.t(i,2))).useInsertionEffect&&(r||(r=n.t(i,2))).useInsertionEffect,s=o||function(e){return e()},a=o||i.useLayoutEffect},4911:(e,t,n)=>{"use strict";function r(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}n.d(t,{My:()=>o,fp:()=>r,hC:()=>i});var i=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},o=function(e,t,n){i(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var o=t;do{e.insert(t===o?"."+r:"",o,e.sheet,!0),o=o.next}while(void 0!==o)}}},9883:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos")},6713:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos")},3241:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")},2741:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight")},9303:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm8-4h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-.14 0-.27.01-.4.04-.39.08-.74.28-1.01.55-.18.18-.33.4-.43.64-.1.23-.16.49-.16.77v14c0 .27.06.54.16.78s.25.45.43.64c.27.27.62.47 1.01.55.13.02.26.03.4.03h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75M19 19H5V5h14z"}),"AssignmentLateOutlined")},2586:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy")},3714:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")},6306:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},9428:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"}),"KeyboardArrowDown")},8268:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link")},8324:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"Navigation")},7983:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var i=r(n(5045)),o=n(6417);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search")},5045:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(5367)},5436:(e,t)=>{"use strict";Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context"),Symbol.for("react.forward_ref"),Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"),Symbol.for("react.lazy"),Symbol.for("react.offscreen");Symbol.for("react.module.reference")},478:(e,t,n)=>{"use strict";n(5436)},7458:(e,t,n)=>{"use strict";n.d(t,{Z:()=>L});var r=n(7462),i=n(3366),o=n(3491),s=n(3364),a=n(3232),l=n(3649),c=n(1821),u=n(2755);const h={black:"#000",white:"#fff"},d={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},p={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},f={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},m={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},y={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},v={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},_=["mode","contrastThreshold","tonalOffset"],x={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:h.white,default:h.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},b={text:{primary:h.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:h.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function w(e,t,n,r){const i=r.light||r,o=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,u.$n)(e.main,i):"dark"===t&&(e.dark=(0,u._j)(e.main,o)))}const S=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"],M={textTransform:"uppercase"},E='"Roboto", "Helvetica", "Arial", sans-serif';function T(e,t){const n="function"==typeof t?t(e):t,{fontFamily:o=E,fontSize:a=14,fontWeightLight:l=300,fontWeightRegular:c=400,fontWeightMedium:u=500,fontWeightBold:h=700,htmlFontSize:d=16,allVariants:p,pxToRem:f}=n,m=(0,i.Z)(n,S),g=a/14,y=f||(e=>e/d*g+"rem"),v=(e,t,n,i,s)=>{return(0,r.Z)({fontFamily:o,fontWeight:e,fontSize:y(t),lineHeight:n},o===E?{letterSpacing:(a=i/t,Math.round(1e5*a)/1e5+"em")}:{},s,p);var a},_={h1:v(l,96,1.167,-1.5),h2:v(l,60,1.2,-.5),h3:v(c,48,1.167,0),h4:v(c,34,1.235,.25),h5:v(c,24,1.334,0),h6:v(u,20,1.6,.15),subtitle1:v(c,16,1.75,.15),subtitle2:v(u,14,1.57,.1),body1:v(c,16,1.5,.15),body2:v(c,14,1.43,.15),button:v(u,14,1.75,.4,M),caption:v(c,12,1.66,.4),overline:v(c,12,2.66,1,M),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,s.Z)((0,r.Z)({htmlFontSize:d,pxToRem:y,fontFamily:o,fontSize:a,fontWeightLight:l,fontWeightRegular:c,fontWeightMedium:u,fontWeightBold:h},_),m,{clone:!1})}function C(){return[`${arguments.length<=0?void 0:arguments[0]}px ${arguments.length<=1?void 0:arguments[1]}px ${arguments.length<=2?void 0:arguments[2]}px ${arguments.length<=3?void 0:arguments[3]}px rgba(0,0,0,0.2)`,`${arguments.length<=4?void 0:arguments[4]}px ${arguments.length<=5?void 0:arguments[5]}px ${arguments.length<=6?void 0:arguments[6]}px ${arguments.length<=7?void 0:arguments[7]}px rgba(0,0,0,0.14)`,`${arguments.length<=8?void 0:arguments[8]}px ${arguments.length<=9?void 0:arguments[9]}px ${arguments.length<=10?void 0:arguments[10]}px ${arguments.length<=11?void 0:arguments[11]}px rgba(0,0,0,0.12)`].join(",")}const A=["none",C(0,2,1,-1,0,1,1,0,0,1,3,0),C(0,3,1,-2,0,2,2,0,0,1,5,0),C(0,3,3,-2,0,3,4,0,0,1,8,0),C(0,2,4,-1,0,4,5,0,0,1,10,0),C(0,3,5,-1,0,5,8,0,0,1,14,0),C(0,3,5,-1,0,6,10,0,0,1,18,0),C(0,4,5,-2,0,7,10,1,0,2,16,1),C(0,5,5,-3,0,8,10,1,0,3,14,2),C(0,5,6,-3,0,9,12,1,0,3,16,2),C(0,6,6,-3,0,10,14,1,0,4,18,3),C(0,6,7,-4,0,11,15,1,0,4,20,3),C(0,7,8,-4,0,12,17,2,0,5,22,4),C(0,7,8,-4,0,13,19,2,0,5,24,4),C(0,7,9,-4,0,14,21,2,0,5,26,4),C(0,8,9,-5,0,15,22,2,0,6,28,5),C(0,8,10,-5,0,16,24,2,0,6,30,5),C(0,8,11,-5,0,17,26,2,0,6,32,5),C(0,9,11,-5,0,18,28,2,0,7,34,6),C(0,9,12,-6,0,19,29,2,0,7,36,6),C(0,10,13,-6,0,20,31,3,0,8,38,7),C(0,10,13,-6,0,21,33,3,0,8,40,7),C(0,10,14,-6,0,22,35,3,0,8,42,7),C(0,11,14,-7,0,23,36,3,0,9,44,8),C(0,11,15,-7,0,24,38,3,0,9,46,8)];var I=n(5829);const P={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},R=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];const L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:n={},transitions:S={},typography:M={}}=e,E=(0,i.Z)(e,R);if(e.vars)throw new Error((0,o.Z)(18));const C=function(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:a=.2}=e,l=(0,i.Z)(e,_),c=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:g[200],light:g[50],dark:g[400]}:{main:g[700],light:g[400],dark:g[800]}}(t),S=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:p[200],light:p[50],dark:p[400]}:{main:p[500],light:p[300],dark:p[700]}}(t),M=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:f[500],light:f[300],dark:f[700]}:{main:f[700],light:f[400],dark:f[800]}}(t),E=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:y[400],light:y[300],dark:y[700]}:{main:y[700],light:y[500],dark:y[900]}}(t),T=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:v[400],light:v[300],dark:v[700]}:{main:v[800],light:v[500],dark:v[900]}}(t),C=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:m[400],light:m[300],dark:m[700]}:{main:"#ed6c02",light:m[500],dark:m[900]}}(t);function A(e){return(0,u.mi)(e,b.text.primary)>=n?b.text.primary:x.text.primary}const I=e=>{let{color:t,name:n,mainShade:i=500,lightShade:s=300,darkShade:l=700}=e;if(t=(0,r.Z)({},t),!t.main&&t[i]&&(t.main=t[i]),!t.hasOwnProperty("main"))throw new Error((0,o.Z)(11,n?` (${n})`:"",i));if("string"!=typeof t.main)throw new Error((0,o.Z)(12,n?` (${n})`:"",JSON.stringify(t.main)));return w(t,"light",s,a),w(t,"dark",l,a),t.contrastText||(t.contrastText=A(t.main)),t},P={dark:b,light:x};return(0,s.Z)((0,r.Z)({common:(0,r.Z)({},h),mode:t,primary:I({color:c,name:"primary"}),secondary:I({color:S,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:I({color:M,name:"error"}),warning:I({color:C,name:"warning"}),info:I({color:E,name:"info"}),success:I({color:T,name:"success"}),grey:d,contrastThreshold:n,getContrastText:A,augmentColor:I,tonalOffset:a},P[t]),l)}(n),L=(0,c.Z)(e);let D=(0,s.Z)(L,{mixins:(O=L.breakpoints,N=t,(0,r.Z)({toolbar:{minHeight:56,[O.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[O.up("sm")]:{minHeight:64}}},N)),palette:C,shadows:A.slice(),typography:T(C,M),transitions:(0,I.ZP)(S),zIndex:(0,r.Z)({},P)});var O,N;D=(0,s.Z)(D,E);for(var k=arguments.length,F=new Array(k>1?k-1:0),z=1;z<k;z++)F[z-1]=arguments[z];return D=F.reduce(((e,t)=>(0,s.Z)(e,t)),D),D.unstable_sxConfig=(0,r.Z)({},a.Z,null==E?void 0:E.unstable_sxConfig),D.unstable_sx=function(e){return(0,l.Z)({sx:e,theme:this})},D}},5829:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>u,x9:()=>a});var r=n(3366),i=n(7462);const o=["duration","easing","delay"],s={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},a={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function l(e){return`${Math.round(e)}ms`}function c(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function u(e){const t=(0,i.Z)({},s,e.easing),n=(0,i.Z)({},a,e.duration);return(0,i.Z)({getAutoHeightDuration:c,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:s=n.standard,easing:a=t.easeInOut,delay:c=0}=i;return(0,r.Z)(i,o),(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"==typeof s?s:l(s)} ${a} ${"string"==typeof c?c:l(c)}`)).join(",")}},e,{easing:t,duration:n})}},2248:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=(0,n(7458).Z)()},2951:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r="$$material"},3727:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(4205);const i=e=>(0,r.Z)(e)&&"classes"!==e},4205:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}},7592:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>a});var r=n(3781),i=n(2248),o=n(2951),s=n(3727);const a=(0,r.ZP)({themeId:o.Z,defaultTheme:i.Z,rootShouldForwardProp:s.Z})},7342:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4614),i=n(2248),o=n(2951);function s(e){let{props:t,name:n}=e;return(0,r.Z)({props:t,name:n,defaultTheme:i.Z,themeId:o.Z})}},1615:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(1179).Z},1171:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(7462),i=n(7313),o=n(3366),s=n(4146),a=n(8007),l=n(1615),c=n(7342),u=n(7592),h=n(4363),d=n(1167);function p(e){return(0,d.ZP)("MuiSvgIcon",e)}(0,h.Z)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var f=n(6417);const m=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],g=(0,u.ZP)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"inherit"!==n.color&&t[`color${(0,l.Z)(n.color)}`],t[`fontSize${(0,l.Z)(n.fontSize)}`]]}})((e=>{let{theme:t,ownerState:n}=e;var r,i,o,s,a,l,c,u,h,d,p,f,m;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(r=t.transitions)||null==(i=r.create)?void 0:i.call(r,"fill",{duration:null==(o=t.transitions)||null==(o=o.duration)?void 0:o.shorter}),fontSize:{inherit:"inherit",small:(null==(s=t.typography)||null==(a=s.pxToRem)?void 0:a.call(s,20))||"1.25rem",medium:(null==(l=t.typography)||null==(c=l.pxToRem)?void 0:c.call(l,24))||"1.5rem",large:(null==(u=t.typography)||null==(h=u.pxToRem)?void 0:h.call(u,35))||"2.1875rem"}[n.fontSize],color:null!=(d=null==(p=(t.vars||t).palette)||null==(p=p[n.color])?void 0:p.main)?d:{action:null==(f=(t.vars||t).palette)||null==(f=f.action)?void 0:f.active,disabled:null==(m=(t.vars||t).palette)||null==(m=m.action)?void 0:m.disabled,inherit:void 0}[n.color]}})),y=i.forwardRef((function(e,t){const n=(0,c.Z)({props:e,name:"MuiSvgIcon"}),{children:u,className:h,color:d="inherit",component:y="svg",fontSize:v="medium",htmlColor:_,inheritViewBox:x=!1,titleAccess:b,viewBox:w="0 0 24 24"}=n,S=(0,o.Z)(n,m),M=i.isValidElement(u)&&"svg"===u.type,E=(0,r.Z)({},n,{color:d,component:y,fontSize:v,instanceFontSize:e.fontSize,inheritViewBox:x,viewBox:w,hasSvgAsChild:M}),T={};x||(T.viewBox=w);const C=(e=>{const{color:t,fontSize:n,classes:r}=e,i={root:["root","inherit"!==t&&`color${(0,l.Z)(t)}`,`fontSize${(0,l.Z)(n)}`]};return(0,a.Z)(i,p,r)})(E);return(0,f.jsxs)(g,(0,r.Z)({as:y,className:(0,s.Z)(C.root,h),focusable:"false",color:_,"aria-hidden":!b||void 0,role:b?"img":void 0,ref:t},T,S,M&&u.props,{ownerState:E,children:[M?u.props.children:u,b?(0,f.jsx)("title",{children:b}):null]}))}));y.muiName="SvgIcon";const v=y;function _(e,t){function n(n,i){return(0,f.jsx)(v,(0,r.Z)({"data-testid":`${t}Icon`,ref:i},n,{children:e}))}return n.muiName=v.muiName,i.memo(i.forwardRef(n))}},8706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(2454).Z},5367:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>i.Z,createChainedFunction:()=>o,createSvgIcon:()=>s.Z,debounce:()=>a.Z,deprecatedPropType:()=>l,isMuiElement:()=>c.Z,ownerDocument:()=>u.Z,ownerWindow:()=>h.Z,requirePropFactory:()=>d,setRef:()=>p,unstable_ClassNameGenerator:()=>b,unstable_useEnhancedEffect:()=>f.Z,unstable_useId:()=>m.Z,unsupportedProp:()=>g,useControlled:()=>y.Z,useEventCallback:()=>v.Z,useForkRef:()=>_.Z,useIsFocusVisible:()=>x.Z});var r=n(8610),i=n(1615);const o=n(4792).Z;var s=n(1171),a=n(8706);const l=function(e,t){return()=>null};var c=n(2537),u=n(6106),h=n(3533);n(7462);const d=function(e,t){return()=>null},p=n(7495).Z;var f=n(4993),m=n(7677);const g=function(e,t,n,r,i){return null};var y=n(3800),v=n(3236),_=n(6983),x=n(6336);const b={configure:e=>{r.Z.configure(e)}}},2537:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(7313);const i=function(e,t){var n,i;return r.isValidElement(e)&&-1!==t.indexOf(null!=(n=e.type.muiName)?n:null==(i=e.type)||null==(i=i._payload)||null==(i=i.value)?void 0:i.muiName)}},6106:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(2133).Z},3533:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(4949).Z},3800:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(9511).Z},4993:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(8557).Z},3236:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(1782).Z},6983:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(8990).Z},7677:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=n(994).Z},6336:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(7313),i=n(6383);let o=!0,s=!1;const a=new i.V,l={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function c(e){e.metaKey||e.altKey||e.ctrlKey||(o=!0)}function u(){o=!1}function h(){"hidden"===this.visibilityState&&s&&(o=!0)}const d=function(){const e=r.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",c,!0),t.addEventListener("mousedown",u,!0),t.addEventListener("pointerdown",u,!0),t.addEventListener("touchstart",u,!0),t.addEventListener("visibilitychange",h,!0))}),[]),t=r.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!function(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(e){}return o||function(e){const{type:t,tagName:n}=e;return!("INPUT"!==n||!l[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(s=!0,a.start(100,(()=>{s=!1})),t.current=!1,!0)},ref:e}}},5150:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o}),n(7313);var r=n(686),i=n(6417);function o(e){const{styles:t,defaultTheme:n={}}=e,o="function"==typeof t?e=>{return t(null==(r=e)||0===Object.keys(r).length?n:e);var r}:t;return(0,i.jsx)(r.xB,{styles:o})}},4995:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalStyles:()=>S.Z,StyledEngineProvider:()=>w,ThemeContext:()=>l.T,css:()=>v.iv,default:()=>M,internal_processStyles:()=>E,keyframes:()=>v.F4});var r=n(7462),i=n(7313),o=n(1816),s=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,a=(0,o.Z)((function(e){return s.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),l=n(8787),c=n(4911),u=n(1086),h=n(5696),d=a,p=function(e){return"theme"!==e},f=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?d:p},m=function(e,t,n){var r;if(t){var i=t.shouldForwardProp;r=e.__emotion_forwardProp&&i?function(t){return e.__emotion_forwardProp(t)&&i(t)}:i}return"function"!=typeof r&&n&&(r=e.__emotion_forwardProp),r},g=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return(0,c.hC)(t,n,r),(0,h.L)((function(){return(0,c.My)(t,n,r)})),null},y=function e(t,n){var o,s,a=t.__emotion_real===t,h=a&&t.__emotion_base||t;void 0!==n&&(o=n.label,s=n.target);var d=m(t,n,a),p=d||f(h),y=!p("as");return function(){var v=arguments,_=a&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==o&&_.push("label:"+o+";"),null==v[0]||void 0===v[0].raw)_.push.apply(_,v);else{_.push(v[0][0]);for(var x=v.length,b=1;b<x;b++)_.push(v[b],v[0][b])}var w=(0,l.w)((function(e,t,n){var r=y&&e.as||h,o="",a=[],m=e;if(null==e.theme){for(var v in m={},e)m[v]=e[v];m.theme=i.useContext(l.T)}"string"==typeof e.className?o=(0,c.fp)(t.registered,a,e.className):null!=e.className&&(o=e.className+" ");var x=(0,u.O)(_.concat(a),t.registered,m);o+=t.key+"-"+x.name,void 0!==s&&(o+=" "+s);var b=y&&void 0===d?f(r):p,w={};for(var S in e)y&&"as"===S||b(S)&&(w[S]=e[S]);return w.className=o,w.ref=n,i.createElement(i.Fragment,null,i.createElement(g,{cache:t,serialized:x,isStringTag:"string"==typeof r}),i.createElement(r,w))}));return w.displayName=void 0!==o?o:"Styled("+("string"==typeof h?h:h.displayName||h.name||"Component")+")",w.defaultProps=t.defaultProps,w.__emotion_real=w,w.__emotion_base=h,w.__emotion_styles=_,w.__emotion_forwardProp=d,Object.defineProperty(w,"toString",{value:function(){return"."+s}}),w.withComponent=function(t,i){return e(t,(0,r.Z)({},n,i,{shouldForwardProp:m(w,i,!0)})).apply(void 0,_)},w}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){y[e]=y(e)}));var v=n(686),_=n(5296),x=n(6417);let b;function w(e){const{injectFirst:t,children:n}=e;return t&&b?(0,x.jsx)(l.C,{value:b,children:n}):n}"object"==typeof document&&(b=(0,_.Z)({key:"css",prepend:!0}));var S=n(5150);function M(e,t){return y(e,t)}const E=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},2755:(e,t,n)=>{"use strict";var r=n(4836);t.Fq=function(e,t){return e=a(e),t=s(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,l(e)},t._j=u,t.mi=function(e,t){const n=c(e),r=c(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},t.$n=h;var i=r(n(8807)),o=r(n(6964));function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,o.default)(e,t,n)}function a(e){if(e.type)return e;if("#"===e.charAt(0))return a(function(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,i.default)(9,e));let r,o=e.substring(t+1,e.length-1);if("color"===n){if(o=o.split(" "),r=o.shift(),4===o.length&&"/"===o[3].charAt(0)&&(o[3]=o[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error((0,i.default)(10,r))}else o=o.split(",");return o=o.map((e=>parseFloat(e))),{type:n,values:o,colorSpace:r}}function l(e){const{type:t,colorSpace:n}=e;let{values:r}=e;return-1!==t.indexOf("rgb")?r=r.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),r=-1!==t.indexOf("color")?`${n} ${r.join(" ")}`:`${r.join(", ")}`,`${t}(${r})`}function c(e){let t="hsl"===(e=a(e)).type||"hsla"===e.type?a(function(e){e=a(e);const{values:t}=e,n=t[0],r=t[1]/100,i=t[2]/100,o=r*Math.min(i,1-i),s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-o*Math.max(Math.min(t-3,9-t,1),-1)};let c="rgb";const u=[Math.round(255*s(0)),Math.round(255*s(8)),Math.round(255*s(4))];return"hsla"===e.type&&(c+="a",u.push(t[3])),l({type:c,values:u})}(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function u(e,t){if(e=a(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return l(e)}function h(e,t){if(e=a(e),t=s(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return l(e)}},3781:(e,t,n)=>{"use strict";var r=n(4836);t.ZP=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=m,rootShouldForwardProp:r=f,slotShouldForwardProp:l=f}=e,u=e=>(0,c.default)((0,i.default)({},e,{theme:y((0,i.default)({},e,{defaultTheme:n,themeId:t}))}));return u.__mui_systemSx=!0,function(e){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:h,slot:p,skipVariantsResolver:m,skipSx:x,overridesResolver:b=v(g(p))}=c,w=(0,o.default)(c,d),S=void 0!==m?m:p&&"Root"!==p&&"root"!==p||!1,M=x||!1;let E=f;"Root"===p||"root"===p?E=r:p?E=l:function(e){return"string"==typeof e&&e.charCodeAt(0)>96}(e)&&(E=void 0);const T=(0,s.default)(e,(0,i.default)({shouldForwardProp:E,label:void 0},w)),C=e=>"function"==typeof e&&e.__emotion_real!==e||(0,a.isPlainObject)(e)?r=>_(e,(0,i.default)({},r,{theme:y({theme:r.theme,defaultTheme:n,themeId:t})})):e,A=function(r){let o=C(r);for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];const c=a?a.map(C):[];h&&b&&c.push((e=>{const r=y((0,i.default)({},e,{defaultTheme:n,themeId:t}));if(!r.components||!r.components[h]||!r.components[h].styleOverrides)return null;const o=r.components[h].styleOverrides,s={};return Object.entries(o).forEach((t=>{let[n,o]=t;s[n]=_(o,(0,i.default)({},e,{theme:r}))})),b(e,s)})),h&&!S&&c.push((e=>{var r;const o=y((0,i.default)({},e,{defaultTheme:n,themeId:t}));return _({variants:null==o||null==(r=o.components)||null==(r=r[h])?void 0:r.variants},(0,i.default)({},e,{theme:o}))})),M||c.push(u);const d=c.length-a.length;if(Array.isArray(r)&&d>0){const e=new Array(d).fill("");o=[...r,...e],o.raw=[...r.raw,...e]}const p=T(o,...c);return e.muiName&&(p.muiName=e.muiName),p};return T.withConfig&&(A.withConfig=T.withConfig),A}};var i=r(n(434)),o=r(n(7071)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(4995)),a=n(5651),l=(r(n(2303)),r(n(6566)),r(n(7588))),c=r(n(7368));const u=["ownerState"],h=["variants"],d=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}function f(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const m=(0,l.default)(),g=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function y(e){let{defaultTheme:t,theme:n,themeId:r}=e;return i=n,0===Object.keys(i).length?t:n[r]||n;var i}function v(e){return e?(t,n)=>n[e]:null}function _(e,t){let{ownerState:n}=t,r=(0,o.default)(t,u);const s="function"==typeof e?e((0,i.default)({ownerState:n},r)):e;if(Array.isArray(s))return s.flatMap((e=>_(e,(0,i.default)({ownerState:n},r))));if(s&&"object"==typeof s&&Array.isArray(s.variants)){const{variants:e=[]}=s;let t=(0,o.default)(s,h);return e.forEach((e=>{let o=!0;"function"==typeof e.props?o=e.props((0,i.default)({ownerState:n},r,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&r[t]!==e.props[t]&&(o=!1)})),o&&(Array.isArray(t)||(t=[t]),t.push("function"==typeof e.style?e.style((0,i.default)({ownerState:n},r,n)):e.style))})),t}return s}},4929:(e,t,n)=>{"use strict";n.d(t,{L7:()=>l,P$:()=>u,VO:()=>i,W8:()=>a,dt:()=>c,k9:()=>s});var r=n(3364);const i={xs:0,sm:600,md:900,lg:1200,xl:1536},o={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${i[e]}px)`};function s(e,t,n){const r=e.theme||{};if(Array.isArray(t)){const e=r.breakpoints||o;return t.reduce(((r,i,o)=>(r[e.up(e.keys[o])]=n(t[o]),r)),{})}if("object"==typeof t){const e=r.breakpoints||o;return Object.keys(t).reduce(((r,o)=>{if(-1!==Object.keys(e.values||i).indexOf(o))r[e.up(o)]=n(t[o],o);else{const e=o;r[e]=t[e]}return r}),{})}return n(t)}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,n)=>(t[e.up(n)]={},t)),{}))||{}}function l(e,t){return e.reduce(((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function c(e){const t=a(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];const s=[t,...i].reduce(((e,t)=>(0,r.Z)(e,t)),{});return l(Object.keys(t),s)}function u(e){let{values:t,breakpoints:n,base:r}=e;const i=r||function(e,t){if("object"!=typeof e)return{};const n={},r=Object.keys(t);return Array.isArray(e)?r.forEach(((t,r)=>{r<e.length&&(n[t]=!0)})):r.forEach((t=>{null!=e[t]&&(n[t]=!0)})),n}(t,n),o=Object.keys(i);if(0===o.length)return t;let s;return o.reduce(((e,n,r)=>(Array.isArray(t)?(e[n]=null!=t[r]?t[r]:t[s],s=r):"object"==typeof t?(e[n]=null!=t[n]?t[n]:t[s],s=n):e[n]=t,e)),{})}},4277:(e,t,n)=>{"use strict";function r(e,t){const n=this;return n.vars&&"function"==typeof n.getColorSchemeSelector?{[n.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)")]:t}:n.palette.mode===e?t:{}}n.d(t,{Z:()=>r})},4162:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(3366),i=n(7462);const o=["values","unit","step"],s=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,i.Z)({},e,{[t.key]:t.val})),{})};function a(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:a=5}=e,l=(0,r.Z)(e,o),c=s(t),u=Object.keys(c);function h(e){return`@media (min-width:${"number"==typeof t[e]?t[e]:e}${n})`}function d(e){return`@media (max-width:${("number"==typeof t[e]?t[e]:e)-a/100}${n})`}function p(e,r){const i=u.indexOf(r);return`@media (min-width:${"number"==typeof t[e]?t[e]:e}${n}) and (max-width:${(-1!==i&&"number"==typeof t[u[i]]?t[u[i]]:r)-a/100}${n})`}return(0,i.Z)({keys:u,values:c,up:h,down:d,between:p,only:function(e){return u.indexOf(e)+1<u.length?p(e,u[u.indexOf(e)+1]):h(e)},not:function(e){const t=u.indexOf(e);return 0===t?h(u[1]):t===u.length-1?d(u[t]):p(e,u[u.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},l)}},1821:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(7462),i=n(3366),o=n(3364),s=n(4162);const a={borderRadius:4};var l=n(6886),c=n(3649),u=n(3232),h=n(4277);const d=["breakpoints","palette","spacing","shape"],p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:p,shape:f={}}=e,m=(0,i.Z)(e,d),g=(0,s.Z)(t),y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,l.hB)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(0===n.length?[1]:n).map((e=>{const n=t(e);return"number"==typeof n?`${n}px`:n})).join(" ")};return n.mui=!0,n}(p);let v=(0,o.Z)({breakpoints:g,direction:"ltr",components:{},palette:(0,r.Z)({mode:"light"},n),spacing:y,shape:(0,r.Z)({},a,f)},m);v.applyStyles=h.Z;for(var _=arguments.length,x=new Array(_>1?_-1:0),b=1;b<_;b++)x[b-1]=arguments[b];return v=x.reduce(((e,t)=>(0,o.Z)(e,t)),v),v.unstable_sxConfig=(0,r.Z)({},u.Z,null==m?void 0:m.unstable_sxConfig),v.unstable_sx=function(e){return(0,c.Z)({sx:e,theme:this})},v}},7588:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z,private_createBreakpoints:()=>i.Z,unstable_applyStyles:()=>o.Z});var r=n(1821),i=n(4162),o=n(4277)},7330:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(3364);const i=function(e,t){return t?(0,r.Z)(e,t,{clone:!1}):e}},6886:(e,t,n)=>{"use strict";n.d(t,{hB:()=>f,eI:()=>p,NA:()=>m,e6:()=>y,o3:()=>v});var r=n(4929),i=n(6428),o=n(7330);const s={m:"margin",p:"padding"},a={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},l={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},c=function(e){const t={};return e=>(void 0===t[e]&&(t[e]=(e=>{if(e.length>2){if(!l[e])return[e];e=l[e]}const[t,n]=e.split(""),r=s[t],i=a[n]||"";return Array.isArray(i)?i.map((e=>r+e)):[r+i]})(e)),t[e])}(),u=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],h=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],d=[...u,...h];function p(e,t,n,r){var o;const s=null!=(o=(0,i.DW)(e,t,!1))?o:n;return"number"==typeof s?e=>"string"==typeof e?e:s*e:Array.isArray(s)?e=>"string"==typeof e?e:s[e]:"function"==typeof s?s:()=>{}}function f(e){return p(e,"spacing",8)}function m(e,t){if("string"==typeof t||null==t)return t;const n=e(Math.abs(t));return t>=0?n:"number"==typeof n?-n:`-${n}`}function g(e,t){const n=f(e.theme);return Object.keys(e).map((i=>function(e,t,n,i){if(-1===t.indexOf(n))return null;const o=function(e,t){return n=>e.reduce(((e,r)=>(e[r]=m(t,n),e)),{})}(c(n),i),s=e[n];return(0,r.k9)(e,s,o)}(e,t,i,n))).reduce(o.Z,{})}function y(e){return g(e,u)}function v(e){return g(e,h)}function _(e){return g(e,d)}y.propTypes={},y.filterProps=u,v.propTypes={},v.filterProps=h,_.propTypes={},_.filterProps=d},6428:(e,t,n)=>{"use strict";n.d(t,{DW:()=>o,Jq:()=>s,ZP:()=>a});var r=n(1179),i=n(4929);function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!=typeof t)return null;if(e&&e.vars&&n){const n=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=n)return n}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function s(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"==typeof e?e(n):Array.isArray(e)?e[n]||i:o(e,n)||i,t&&(r=t(r,i,e)),r}const a=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:a,transform:l}=e,c=e=>{if(null==e[t])return null;const c=e[t],u=o(e.theme,a)||{};return(0,i.k9)(e,c,(e=>{let i=s(u,l,e);return e===i&&"string"==typeof e&&(i=s(u,l,`${t}${"default"===e?"":(0,r.Z)(e)}`,e)),!1===n?i:{[n]:i}}))};return c.propTypes={},c.filterProps=[t],c}},3232:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(6886),i=n(6428),o=n(7330);const s=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>(t.filterProps.forEach((n=>{e[n]=t})),e)),{}),i=e=>Object.keys(e).reduce(((t,n)=>r[n]?(0,o.Z)(t,r[n](e)):t),{});return i.propTypes={},i.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),i};var a=n(4929);function l(e){return"number"!=typeof e?e:`${e}px solid`}function c(e,t){return(0,i.ZP)({prop:e,themeKey:"borders",transform:t})}const u=c("border",l),h=c("borderTop",l),d=c("borderRight",l),p=c("borderBottom",l),f=c("borderLeft",l),m=c("borderColor"),g=c("borderTopColor"),y=c("borderRightColor"),v=c("borderBottomColor"),_=c("borderLeftColor"),x=c("outline",l),b=c("outlineColor"),w=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,r.eI)(e.theme,"shape.borderRadius",4,"borderRadius"),n=e=>({borderRadius:(0,r.NA)(t,e)});return(0,a.k9)(e,e.borderRadius,n)}return null};w.propTypes={},w.filterProps=["borderRadius"],s(u,h,d,p,f,m,g,y,v,_,w,x,b);const S=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,r.eI)(e.theme,"spacing",8,"gap"),n=e=>({gap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.gap,n)}return null};S.propTypes={},S.filterProps=["gap"];const M=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,r.eI)(e.theme,"spacing",8,"columnGap"),n=e=>({columnGap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.columnGap,n)}return null};M.propTypes={},M.filterProps=["columnGap"];const E=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,r.eI)(e.theme,"spacing",8,"rowGap"),n=e=>({rowGap:(0,r.NA)(t,e)});return(0,a.k9)(e,e.rowGap,n)}return null};function T(e,t){return"grey"===t?t:e}function C(e){return e<=1&&0!==e?100*e+"%":e}E.propTypes={},E.filterProps=["rowGap"],s(S,M,E,(0,i.ZP)({prop:"gridColumn"}),(0,i.ZP)({prop:"gridRow"}),(0,i.ZP)({prop:"gridAutoFlow"}),(0,i.ZP)({prop:"gridAutoColumns"}),(0,i.ZP)({prop:"gridAutoRows"}),(0,i.ZP)({prop:"gridTemplateColumns"}),(0,i.ZP)({prop:"gridTemplateRows"}),(0,i.ZP)({prop:"gridTemplateAreas"}),(0,i.ZP)({prop:"gridArea"})),s((0,i.ZP)({prop:"color",themeKey:"palette",transform:T}),(0,i.ZP)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:T}),(0,i.ZP)({prop:"backgroundColor",themeKey:"palette",transform:T}));const A=(0,i.ZP)({prop:"width",transform:C}),I=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,r;const i=(null==(n=e.theme)||null==(n=n.breakpoints)||null==(n=n.values)?void 0:n[t])||a.VO[t];return i?"px"!==(null==(r=e.theme)||null==(r=r.breakpoints)?void 0:r.unit)?{maxWidth:`${i}${e.theme.breakpoints.unit}`}:{maxWidth:i}:{maxWidth:C(t)}};return(0,a.k9)(e,e.maxWidth,t)}return null};I.filterProps=["maxWidth"];const P=(0,i.ZP)({prop:"minWidth",transform:C}),R=(0,i.ZP)({prop:"height",transform:C}),L=(0,i.ZP)({prop:"maxHeight",transform:C}),D=(0,i.ZP)({prop:"minHeight",transform:C}),O=((0,i.ZP)({prop:"size",cssProperty:"width",transform:C}),(0,i.ZP)({prop:"size",cssProperty:"height",transform:C}),s(A,I,P,R,L,D,(0,i.ZP)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:l},borderTop:{themeKey:"borders",transform:l},borderRight:{themeKey:"borders",transform:l},borderBottom:{themeKey:"borders",transform:l},borderLeft:{themeKey:"borders",transform:l},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:l},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:w},color:{themeKey:"palette",transform:T},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:T},backgroundColor:{themeKey:"palette",transform:T},p:{style:r.o3},pt:{style:r.o3},pr:{style:r.o3},pb:{style:r.o3},pl:{style:r.o3},px:{style:r.o3},py:{style:r.o3},padding:{style:r.o3},paddingTop:{style:r.o3},paddingRight:{style:r.o3},paddingBottom:{style:r.o3},paddingLeft:{style:r.o3},paddingX:{style:r.o3},paddingY:{style:r.o3},paddingInline:{style:r.o3},paddingInlineStart:{style:r.o3},paddingInlineEnd:{style:r.o3},paddingBlock:{style:r.o3},paddingBlockStart:{style:r.o3},paddingBlockEnd:{style:r.o3},m:{style:r.e6},mt:{style:r.e6},mr:{style:r.e6},mb:{style:r.e6},ml:{style:r.e6},mx:{style:r.e6},my:{style:r.e6},margin:{style:r.e6},marginTop:{style:r.e6},marginRight:{style:r.e6},marginBottom:{style:r.e6},marginLeft:{style:r.e6},marginX:{style:r.e6},marginY:{style:r.e6},marginInline:{style:r.e6},marginInlineStart:{style:r.e6},marginInlineEnd:{style:r.e6},marginBlock:{style:r.e6},marginBlockStart:{style:r.e6},marginBlockEnd:{style:r.e6},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:S},rowGap:{style:E},columnGap:{style:M},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:C},maxWidth:{style:I},minWidth:{transform:C},height:{transform:C},maxHeight:{transform:C},minHeight:{transform:C},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},9028:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(7462),i=n(3366),o=n(3364),s=n(3232);const a=["sx"],l=e=>{var t,n;const r={systemProps:{},otherProps:{}},i=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:s.Z;return Object.keys(e).forEach((t=>{i[t]?r.systemProps[t]=e[t]:r.otherProps[t]=e[t]})),r};function c(e){const{sx:t}=e,n=(0,i.Z)(e,a),{systemProps:s,otherProps:c}=l(n);let u;return u=Array.isArray(t)?[s,...t]:"function"==typeof t?function(){const e=t(...arguments);return(0,o.P)(e)?(0,r.Z)({},s,e):s}:(0,r.Z)({},s,t),(0,r.Z)({},c,{sx:u})}},7368:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z,extendSxProp:()=>i.Z,unstable_createStyleFunctionSx:()=>r.n,unstable_defaultSxConfig:()=>o.Z});var r=n(3649),i=n(9028),o=n(3232)},3649:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u,n:()=>l});var r=n(1179),i=n(7330),o=n(6428),s=n(4929),a=n(3232);function l(){function e(e,t,n,i){const a={[e]:t,theme:n},l=i[e];if(!l)return{[e]:t};const{cssProperty:c=e,themeKey:u,transform:h,style:d}=l;if(null==t)return null;if("typography"===u&&"inherit"===t)return{[e]:t};const p=(0,o.DW)(n,u)||{};return d?d(a):(0,s.k9)(a,t,(t=>{let n=(0,o.Jq)(p,h,t);return t===n&&"string"==typeof t&&(n=(0,o.Jq)(p,h,`${e}${"default"===t?"":(0,r.Z)(t)}`,t)),!1===c?n:{[c]:n}}))}return function t(n){var r;const{sx:o,theme:l={}}=n||{};if(!o)return null;const c=null!=(r=l.unstable_sxConfig)?r:a.Z;function u(n){let r=n;if("function"==typeof n)r=n(l);else if("object"!=typeof n)return n;if(!r)return null;const o=(0,s.W8)(l.breakpoints),a=Object.keys(o);let u=o;return Object.keys(r).forEach((n=>{const o="function"==typeof(a=r[n])?a(l):a;var a;if(null!=o)if("object"==typeof o)if(c[n])u=(0,i.Z)(u,e(n,o,l,c));else{const e=(0,s.k9)({theme:l},o,(e=>({[n]:e})));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),i=new Set(r);return t.every((e=>i.size===Object.keys(e).length))}(e,o)?u=(0,i.Z)(u,e):u[n]=t({sx:o,theme:l})}else u=(0,i.Z)(u,e(n,o,l,c))})),(0,s.L7)(a,u)}return Array.isArray(o)?o.map(u):u(o)}}const c=l();c.filterProps=["sx"];const u=c},6728:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(1821),i=n(4976);const o=(0,r.Z)(),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return(0,i.Z)(e)}},4290:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(649);function i(e){const{theme:t,name:n,props:i}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,r.Z)(t.components[n].defaultProps,i):i}},4614:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(4290),i=n(6728);function o(e){let{props:t,name:n,defaultTheme:o,themeId:s}=e,a=(0,i.Z)(o);return s&&(a=a[s]||a),(0,r.Z)({theme:a,name:n,props:t})}},4976:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(7313),i=n(8787);const o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=r.useContext(i.T);return t&&(n=t,0!==Object.keys(n).length)?t:e;var n}},653:(e,t,n)=>{"use strict";t.Z=void 0;var r=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,n&&n.set(e,r),r}(n(7313)),i=n(4995);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=r.useContext(i.ThemeContext);return t&&(n=t,0!==Object.keys(n).length)?t:e;var n}},8610:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r=e=>e,i=(()=>{let e=r;return{configure(t){e=t},generate:t=>e(t),reset(){e=r}}})()},1179:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(3491);function i(e){if("string"!=typeof e)throw new Error((0,r.Z)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},2303:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z});var r=n(1179)},3753:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,n))}},6964:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z});var r=n(3753)},8007:(e,t,n)=>{"use strict";function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const r={};return Object.keys(e).forEach((i=>{r[i]=e[i].reduce(((e,r)=>{if(r){const i=t(r);""!==i&&e.push(i),n&&n[r]&&e.push(n[r])}return e}),[]).join(" ")})),r}n.d(t,{Z:()=>r})},4792:(e,t,n)=>{"use strict";function r(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>null==t?e:function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.apply(this,r),t.apply(this,r)}),(()=>{}))}n.d(t,{Z:()=>r})},2454:(e,t,n)=>{"use strict";function r(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];clearTimeout(t),t=setTimeout((()=>{e.apply(this,i)}),n)}return r.clear=()=>{clearTimeout(t)},r}n.d(t,{Z:()=>r})},3364:(e,t,n)=>{"use strict";n.d(t,{P:()=>i,Z:()=>s});var r=n(7462);function i(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}function o(e){if(!i(e))return e;const t={};return Object.keys(e).forEach((n=>{t[n]=o(e[n])})),t}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const a=n.clone?(0,r.Z)({},e):e;return i(e)&&i(t)&&Object.keys(t).forEach((r=>{"__proto__"!==r&&(i(t[r])&&r in e&&i(e[r])?a[r]=s(e[r],t[r],n):n.clone?a[r]=i(t[r])?o(t[r]):t[r]:a[r]=t[r])})),a}},5651:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z,isPlainObject:()=>r.P});var r=n(3364)},3491:(e,t,n)=>{"use strict";function r(e){let t="https://mui.com/production-error/?code="+e;for(let e=1;e<arguments.length;e+=1)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{Z:()=>r})},8807:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r.Z});var r=n(3491)},1167:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>o,_v:()=>i});var r=n(8610);const i={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const o=i[t];return o?`${n}-${o}`:`${r.Z.generate(e)}-${t}`}},4363:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(1167);function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i={};return t.forEach((t=>{i[t]=(0,r.ZP)(e,t,n)})),i}},6566:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l,getFunctionName:()=>o});var r=n(339);const i=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function o(e){const t=`${e}`.match(i);return t&&t[1]||""}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.displayName||e.name||o(e)||t}function a(e,t,n){const r=s(t);return e.displayName||(""!==r?`${n}(${r})`:n)}function l(e){if(null!=e){if("string"==typeof e)return e;if("function"==typeof e)return s(e,"Component");if("object"==typeof e)switch(e.$$typeof){case r.ForwardRef:return a(e,e.render,"ForwardRef");case r.Memo:return a(e,e.type,"memo");default:return}}}},7916:(e,t)=>{"use strict";Symbol.for("react.element"),Symbol.for("react.portal"),Symbol.for("react.fragment"),Symbol.for("react.strict_mode"),Symbol.for("react.profiler"),Symbol.for("react.provider"),Symbol.for("react.context"),Symbol.for("react.server_context");var n=Symbol.for("react.forward_ref"),r=(Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo"));Symbol.for("react.lazy"),Symbol.for("react.offscreen");Symbol.for("react.module.reference"),t.ForwardRef=n,t.Memo=r},339:(e,t,n)=>{"use strict";e.exports=n(7916)},2133:(e,t,n)=>{"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,{Z:()=>r})},4949:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(2133);function i(e){return(0,r.Z)(e).defaultView||window}},649:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(7462);function i(e,t){const n=(0,r.Z)({},t);return Object.keys(e).forEach((o=>{if(o.toString().match(/^(components|slots)$/))n[o]=(0,r.Z)({},e[o],n[o]);else if(o.toString().match(/^(componentsProps|slotProps)$/)){const s=e[o]||{},a=t[o];n[o]={},a&&Object.keys(a)?s&&Object.keys(s)?(n[o]=(0,r.Z)({},a),Object.keys(s).forEach((e=>{n[o][e]=i(s[e],a[e])}))):n[o]=a:n[o]=s}else void 0===n[o]&&(n[o]=e[o])})),n}},7495:(e,t,n)=>{"use strict";function r(e,t){"function"==typeof e?e(t):e&&(e.current=t)}n.d(t,{Z:()=>r})},9511:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(7313);function i(e){let{controlled:t,default:n,name:i,state:o="value"}=e;const{current:s}=r.useRef(void 0!==t),[a,l]=r.useState(n);return[s?t:a,r.useCallback((e=>{s||l(e)}),[])]}},8557:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(7313);const i="undefined"!=typeof window?r.useLayoutEffect:r.useEffect},1782:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(7313),i=n(8557);const o=function(e){const t=r.useRef(e);return(0,i.Z)((()=>{t.current=e})),r.useRef((function(){return(0,t.current)(...arguments)})).current}},8990:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(7313),i=n(7495);function o(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.useMemo((()=>t.every((e=>null==e))?null:e=>{t.forEach((t=>{(0,i.Z)(t,e)}))}),t)}},994:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>a});var i=n(7313);let o=0;const s=(r||(r=n.t(i,2)))["useId".toString()];function a(e){if(void 0!==s){const t=s();return null!=e?e:t}return function(e){const[t,n]=i.useState(e),r=e||t;return i.useEffect((()=>{null==t&&(o+=1,n(`mui-${o}`))}),[t]),r}(e)}},6383:(e,t,n)=>{"use strict";n.d(t,{V:()=>s,Z:()=>a});var r=n(7313);const i={},o=[];class s{constructor(){this.currentId=null,this.clear=()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new s}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=null,t()}),e)}}function a(){const e=function(e,t){const n=r.useRef(i);return n.current===i&&(n.current=e(void 0)),n}(s.create).current;var t;return t=e.disposeEffect,r.useEffect(t,o),e}},8441:(e,t,n)=>{"use strict";var r=n(6400);function i(e){var t=[1/0,1/0,-1/0,-1/0];return r.coordEach(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}i.default=i,t.Z=i},1949:(e,t)=>{"use strict";function n(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function r(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("coordinates must contain numbers");return n({type:"Point",coordinates:e},t,r)}function i(e,t,r){void 0===r&&(r={});for(var i=0,o=e;i<o.length;i++){var s=o[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:e},t,r)}function o(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:e},t,r)}function s(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function a(e,t,r){return void 0===r&&(r={}),n({type:"MultiLineString",coordinates:e},t,r)}function l(e,t,r){return void 0===r&&(r={}),n({type:"MultiPoint",coordinates:e},t,r)}function c(e,t,r){return void 0===r&&(r={}),n({type:"MultiPolygon",coordinates:e},t,r)}function u(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e*r}function h(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e/r}function d(e){return e%(2*Math.PI)*180/Math.PI}function p(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=n,t.geometry=function(e,t,n){switch(void 0===n&&(n={}),e){case"Point":return r(t).geometry;case"LineString":return o(t).geometry;case"Polygon":return i(t).geometry;case"MultiPoint":return l(t).geometry;case"MultiLineString":return a(t).geometry;case"MultiPolygon":return c(t).geometry;default:throw new Error(e+" is invalid")}},t.point=r,t.points=function(e,t,n){return void 0===n&&(n={}),s(e.map((function(e){return r(e,t)})),n)},t.polygon=i,t.polygons=function(e,t,n){return void 0===n&&(n={}),s(e.map((function(e){return i(e,t)})),n)},t.lineString=o,t.lineStrings=function(e,t,n){return void 0===n&&(n={}),s(e.map((function(e){return o(e,t)})),n)},t.featureCollection=s,t.multiLineString=a,t.multiPoint=l,t.multiPolygon=c,t.geometryCollection=function(e,t,r){return void 0===r&&(r={}),n({type:"GeometryCollection",geometries:e},t,r)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n},t.radiansToLength=u,t.lengthToRadians=h,t.lengthToDegrees=function(e,t){return d(h(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=d,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,n){if(void 0===t&&(t="kilometers"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return u(h(e,t),n)},t.convertArea=function(e,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=t.areaFactors[n];if(!i)throw new Error("invalid original units");var o=t.areaFactors[r];if(!o)throw new Error("invalid final units");return e/i*o},t.isNumber=p,t.isObject=function(e){return!!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!p(e))throw new Error("bbox must only contain numbers")}))},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}},6400:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1949);function i(e,t,n){if(null!==e)for(var r,o,s,a,l,c,u,h,d=0,p=0,f=e.type,m="FeatureCollection"===f,g="Feature"===f,y=m?e.features.length:1,v=0;v<y;v++){l=(h=!!(u=m?e.features[v].geometry:g?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var _=0;_<l;_++){var x=0,b=0;if(null!==(a=h?u.geometries[_]:u)){c=a.coordinates;var w=a.type;switch(d=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(c,p,v,x,b))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(!1===t(c[r],p,v,x,b))return!1;p++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(o=0;o<c[r].length-d;o++){if(!1===t(c[r][o],p,v,x,b))return!1;p++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(b=0,o=0;o<c[r].length;o++){for(s=0;s<c[r][o].length-d;s++){if(!1===t(c[r][o][s],p,v,x,b))return!1;p++}b++}x++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===i(a.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&!1!==t(e.features[n].properties,n);n++);break;case"Feature":t(e.properties,0)}}function s(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function a(e,t){var n,r,i,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(n=0;n<m;n++){for(a=p?e.features[n].geometry:f?e.geometry:e,c=p?e.features[n].properties:f?e.properties:{},u=p?e.features[n].bbox:f?e.bbox:void 0,h=p?e.features[n].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=l?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function l(e,t){a(e,(function(e,n,i,o,s){var a,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(r.feature(e,i,{bbox:o,id:s}),n,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u={type:a,coordinates:e.coordinates[c]};if(!1===t(r.feature(u,i),n,c))return!1}}))}function c(e,t){l(e,(function(e,n,o){var s=0;if(e.geometry){var a=e.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var l,c=0,u=0,h=0;return!1!==i(e,(function(i,a,d,p,f){if(void 0===l||n>c||p>u||f>h)return l=i,c=n,u=p,h=f,void(s=0);var m=r.lineString([l,i],e.properties);if(!1===t(m,n,o,f,s))return!1;s++,l=i}))&&void 0}}}))}function u(e,t){if(!e)throw new Error("geojson is required");l(e,(function(e,n,i){if(null!==e.geometry){var o=e.geometry.type,s=e.geometry.coordinates;switch(o){case"LineString":if(!1===t(e,n,i,0,0))return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(!1===t(r.lineString(s[a],e.properties),n,i,a))return!1}}}))}t.coordAll=function(e){var t=[];return i(e,(function(e){t.push(e)})),t},t.coordEach=i,t.coordReduce=function(e,t,n,r){var o=n;return i(e,(function(e,r,i,s,a){o=0===r&&void 0===n?e:t(o,e,r,i,s,a)}),r),o},t.featureEach=s,t.featureReduce=function(e,t,n){var r=n;return s(e,(function(e,i){r=0===i&&void 0===n?e:t(r,e,i)})),r},t.findPoint=function(e,t){if(t=t||{},!r.isObject(t))throw new Error("options is invalid");var n,i=t.featureIndex||0,o=t.multiFeatureIndex||0,s=t.geometryIndex||0,a=t.coordIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),l=l||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":l=l||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var c=n.coordinates;switch(n.type){case"Point":return r.point(c,l,t);case"MultiPoint":return o<0&&(o=c.length+o),r.point(c[o],l,t);case"LineString":return a<0&&(a=c.length+a),r.point(c[a],l,t);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a),r.point(c[s][a],l,t);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),r.point(c[o][a],l,t);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a),r.point(c[o][s][a],l,t)}throw new Error("geojson is invalid")},t.findSegment=function(e,t){if(t=t||{},!r.isObject(t))throw new Error("options is invalid");var n,i=t.featureIndex||0,o=t.multiFeatureIndex||0,s=t.geometryIndex||0,a=t.segmentIndex||0,l=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),l=l||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":l=l||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var c=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),r.lineString([c[a],c[a+1]],l,t);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a-1),r.lineString([c[s][a],c[s][a+1]],l,t);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a-1),r.lineString([c[o][a],c[o][a+1]],l,t);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a-1),r.lineString([c[o][s][a],c[o][s][a+1]],l,t)}throw new Error("geojson is invalid")},t.flattenEach=l,t.flattenReduce=function(e,t,n){var r=n;return l(e,(function(e,i,o){r=0===i&&0===o&&void 0===n?e:t(r,e,i,o)})),r},t.geomEach=a,t.geomReduce=function(e,t,n){var r=n;return a(e,(function(e,i,o,s,a){r=0===i&&void 0===n?e:t(r,e,i,o,s,a)})),r},t.lineEach=u,t.lineReduce=function(e,t,n){var r=n;return u(e,(function(e,i,o,s){r=0===i&&void 0===n?e:t(r,e,i,o,s)})),r},t.propEach=o,t.propReduce=function(e,t,n){var r=n;return o(e,(function(e,i){r=0===i&&void 0===n?e:t(r,e,i)})),r},t.segmentEach=c,t.segmentReduce=function(e,t,n){var r=n,i=!1;return c(e,(function(e,o,s,a,l){r=!1===i&&void 0===n?e:t(r,e,o,s,a,l),i=!0})),r}},4680:(e,t,n)=>{"use strict";var r=n(8476),i=n(9962),o=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?i(n):n}},9962:(e,t,n)=>{"use strict";var r=n(1199),i=n(8476),o=i("%Function.prototype.apply%"),s=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||r.call(s,o),l=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(r,s,arguments);return l&&c&&l(t,"length").configurable&&c(t,"length",{value:1+u(0,e.length-(arguments.length-1))}),t};var h=function(){return a(r,o,arguments)};c?c(e.exports,"apply",{value:h}):e.exports.apply=h},7074:(e,t,n)=>{"use strict";var r=n(2162),i=n(3550),o=n(3826),s=n(4820).orient2d;function a(e,t,n){t=Math.max(0,void 0===t?2:t),n=n||0;var i=function(e){for(var t=e[0],n=e[0],r=e[0],i=e[0],s=0;s<e.length;s++){var a=e[s];a[0]<t[0]&&(t=a),a[0]>r[0]&&(r=a),a[1]<n[1]&&(n=a),a[1]>i[1]&&(i=a)}var l=[t,n,r,i],c=l.slice();for(s=0;s<e.length;s++)o(e[s],l)||c.push(e[s]);return function(e){e.sort(_);for(var t=[],n=0;n<e.length;n++){for(;t.length>=2&&p(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}for(var r=[],i=e.length-1;i>=0;i--){for(;r.length>=2&&p(r[r.length-2],r[r.length-1],e[i])<=0;)r.pop();r.push(e[i])}return r.pop(),t.pop(),t.concat(r)}(c)}(e),s=new r(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,t){return e[0]-t[0]},s.compareMinY=function(e,t){return e[1]-t[1]},s.load(e);for(var a,c=[],u=0;u<i.length;u++){var h=i[u];s.remove(h),a=m(h,a),c.push(a)}var d=new r(16);for(u=0;u<c.length;u++)d.insert(f(c[u]));for(var y=t*t,v=n*n;c.length;){var x=c.shift(),b=x.p,w=x.next.p,S=g(b,w);if(!(S<v)){var M=S/y;(h=l(s,x.prev.p,b,w,x.next.next.p,M,d))&&Math.min(g(h,b),g(h,w))<=M&&(c.push(x),c.push(m(h,x)),s.remove(h),d.remove(x),d.insert(f(x)),d.insert(f(x.next)))}}x=a;var E=[];do{E.push(x.p),x=x.next}while(x!==a);return E.push(x.p),E}function l(e,t,n,r,o,s,a){for(var l=new i([],c),h=e.data;h;){for(var p=0;p<h.children.length;p++){var f=h.children[p],m=h.leaf?y(f,n,r):u(n,r,f);m>s||l.push({node:f,dist:m})}for(;l.length&&!l.peek().node.children;){var g=l.pop(),v=g.node,_=y(v,t,n),x=y(v,r,o);if(g.dist<_&&g.dist<x&&d(n,v,a)&&d(r,v,a))return v}(h=l.pop())&&(h=h.node)}return null}function c(e,t){return e.dist-t.dist}function u(e,t,n){if(h(e,n)||h(t,n))return 0;var r=v(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=v(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=v(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=v(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(r,i,o,s)}function h(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function d(e,t,n){for(var r,i,o,s,a=Math.min(e[0],t[0]),l=Math.min(e[1],t[1]),c=Math.max(e[0],t[0]),u=Math.max(e[1],t[1]),h=n.search({minX:a,minY:l,maxX:c,maxY:u}),d=0;d<h.length;d++)if(r=h[d].p,i=h[d].next.p,o=e,r!==(s=t)&&i!==o&&p(r,i,o)>0!=p(r,i,s)>0&&p(o,s,r)>0!=p(o,s,i)>0)return!1;return!0}function p(e,t,n){return s(e[0],e[1],t[0],t[1],n[0],n[1])}function f(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function m(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function g(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function y(e,t,n){var r=t[0],i=t[1],o=n[0]-r,s=n[1]-i;if(0!==o||0!==s){var a=((e[0]-r)*o+(e[1]-i)*s)/(o*o+s*s);a>1?(r=n[0],i=n[1]):a>0&&(r+=o*a,i+=s*a)}return(o=e[0]-r)*o+(s=e[1]-i)*s}function v(e,t,n,r,i,o,s,a){var l,c,u,h,d=n-e,p=r-t,f=s-i,m=a-o,g=e-i,y=t-o,v=d*d+p*p,_=d*f+p*m,x=f*f+m*m,b=d*g+p*y,w=f*g+m*y,S=v*x-_*_,M=S,E=S;0===S?(c=0,M=1,h=w,E=x):(h=v*w-_*b,(c=_*w-x*b)<0?(c=0,h=w,E=x):c>M&&(c=M,h=w+_,E=x)),h<0?(h=0,-b<0?c=0:-b>v?c=M:(c=-b,M=v)):h>E&&(h=E,-b+_<0?c=0:-b+_>v?c=M:(c=-b+_,M=v));var T=(1-(u=0===h?0:h/E))*i+u*s-((1-(l=0===c?0:c/M))*e+l*n),C=(1-u)*o+u*a-((1-l)*t+l*r);return T*T+C*C}function _(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}i.default&&(i=i.default),e.exports=a,e.exports.default=a},2162:function(e){e.exports=function(){"use strict";function e(e,r,i,o,s){!function e(n,r,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,l=r-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var d=n[r],p=i,f=o;for(t(n,i,r),s(n[o],d)>0&&t(n,i,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[i],d)?t(n,i,f):t(n,++f,o),f<=r&&(i=f+1),r<=f&&(o=f-1)}}(e,r,i||0,o||e.length-1,s||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var s=e.children[o];a(i,e.leaf?r(s):s)}return i}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,n,r,i,o){for(var s=[n,r];s.length;)if(!((r=s.pop())-(n=s.pop())<=i)){var a=n+Math.ceil((r-n)/i/2)*i;e(t,a,n,r,o),s.push(n,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var s=t.children[o],a=t.leaf?r(s):s;p(e,a)&&(t.leaf?n.push(s):d(e,a)?this._all(s,n):i.push(s))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],o=t.leaf?this.toBBox(i):i;if(p(e,o)){if(t.leaf||d(e,o))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,o,s=this.data,a=this.toBBox(e),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=c.pop(),o=!0),s.leaf){var u=i(e,s.children,t);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(l.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,s=n-t+1,a=this._maxEntries;if(s<=a)return o(i=f(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(i=f([])).leaf=!1,i.height=r;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(e,t,n,c,this.compareMinX);for(var u=t;u<=n;u+=c){var h=Math.min(u+c-1,n);m(e,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);i.children.push(this._build(e,d,p,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,s=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=u(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,i=c<i?c:i,s=l):h===o&&c<i&&(i=c,s=l)}t=s||t.children[0]}var d,p;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),a(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var s=this._chooseSplitIndex(n,i,r),a=f(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,o(n,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},r.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,o,a,l,c,h,d=1/0,p=1/0,f=t;f<=n-t;f++){var m=s(e,0,f,this.toBBox),g=s(e,f,n,this.toBBox),y=(i=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(i.minX,o.minX),l=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),h=Math.min(i.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),v=u(m)+u(g);y<d?(d=y,r=f,p=v<p?v:p):y===d&&v<p&&(p=v,r=f)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,o=s(e,0,t,i),l=s(e,n-t,n,i),c=h(o)+h(l),u=t;u<n-t;u++){var d=e.children[u];a(o,e.leaf?i(d):d),c+=h(o)}for(var p=n-t-1;p>=t;p--){var f=e.children[p];a(l,e.leaf?i(f):f),c+=h(l)}return c},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)a(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()},658:function(e){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",r="second",i="minute",o="hour",s="day",a="week",l="month",c="quarter",u="year",h="date",d="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},g=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},y={s:g,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+g(r,2,"0")+":"+g(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,l),o=n-i<0,s=t.clone().add(r+(o?-1:1),l);return+(-(r+(n-i)/(o?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:u,w:a,d:s,D:h,h:o,m:i,s:r,ms:n,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},v="en",_={};_[v]=m;var x="$isDayjsObject",b=function(e){return e instanceof E||!(!e||!e[x])},w=function e(t,n,r){var i;if(!t)return v;if("string"==typeof t){var o=t.toLowerCase();_[o]&&(i=o),n&&(_[o]=n,i=o);var s=t.split("-");if(!i&&s.length>1)return e(s[0])}else{var a=t.name;_[a]=t,i=a}return!r&&i&&(v=i),i||!r&&v},S=function(e,t){if(b(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new E(n)},M=y;M.l=w,M.i=b,M.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function m(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[x]=!0}var g=m.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(M.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return M},g.isValid=function(){return!(this.$d.toString()===d)},g.isSame=function(e,t){var n=S(e);return this.startOf(t)<=n&&n<=this.endOf(t)},g.isAfter=function(e,t){return S(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<S(e)},g.$g=function(e,t,n){return M.u(e)?this[t]:this.set(n,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var n=this,c=!!M.u(t)||t,d=M.p(e),p=function(e,t){var r=M.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return c?r:r.endOf(s)},f=function(e,t){return M.w(n.toDate()[e].apply(n.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,g=this.$M,y=this.$D,v="set"+(this.$u?"UTC":"");switch(d){case u:return c?p(1,0):p(31,11);case l:return c?p(1,g):p(0,g+1);case a:var _=this.$locale().weekStart||0,x=(m<_?m+7:m)-_;return p(c?y-x:y+(6-x),g);case s:case h:return f(v+"Hours",0);case o:return f(v+"Minutes",1);case i:return f(v+"Seconds",2);case r:return f(v+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var a,c=M.p(e),d="set"+(this.$u?"UTC":""),p=(a={},a[s]=d+"Date",a[h]=d+"Date",a[l]=d+"Month",a[u]=d+"FullYear",a[o]=d+"Hours",a[i]=d+"Minutes",a[r]=d+"Seconds",a[n]=d+"Milliseconds",a)[c],f=c===s?this.$D+(t-this.$W):t;if(c===l||c===u){var m=this.clone().set(h,1);m.$d[p](f),m.init(),this.$d=m.set(h,Math.min(this.$D,m.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[M.p(e)]()},g.add=function(n,c){var h,d=this;n=Number(n);var p=M.p(c),f=function(e){var t=S(d);return M.w(t.date(t.date()+Math.round(e*n)),d)};if(p===l)return this.set(l,this.$M+n);if(p===u)return this.set(u,this.$y+n);if(p===s)return f(1);if(p===a)return f(7);var m=(h={},h[i]=e,h[o]=t,h[r]=1e3,h)[p]||1,g=this.$d.getTime()+n*m;return M.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||d;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=M.z(this),o=this.$H,s=this.$m,a=this.$M,l=n.weekdays,c=n.months,u=n.meridiem,h=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},p=function(e){return M.s(o%12||12,e,"0")},m=u||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(f,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return M.s(t.$y,4,"0");case"M":return a+1;case"MM":return M.s(a+1,2,"0");case"MMM":return h(n.monthsShort,a,c,3);case"MMMM":return h(c,a);case"D":return t.$D;case"DD":return M.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return h(n.weekdaysMin,t.$W,l,2);case"ddd":return h(n.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(o);case"HH":return M.s(o,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return m(o,s,!0);case"A":return m(o,s,!1);case"m":return String(s);case"mm":return M.s(s,2,"0");case"s":return String(t.$s);case"ss":return M.s(t.$s,2,"0");case"SSS":return M.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,h,d){var p,f=this,m=M.p(h),g=S(n),y=(g.utcOffset()-this.utcOffset())*e,v=this-g,_=function(){return M.m(f,g)};switch(m){case u:p=_()/12;break;case l:p=_();break;case c:p=_()/3;break;case a:p=(v-y)/6048e5;break;case s:p=(v-y)/864e5;break;case o:p=v/t;break;case i:p=v/e;break;case r:p=v/1e3;break;default:p=v}return d?p:M.a(p)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return _[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=w(e,t,!0);return r&&(n.$L=r),n},g.clone=function(){return M.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},m}(),T=E.prototype;return S.prototype=T,[["$ms",n],["$s",r],["$m",i],["$H",o],["$W",s],["$M",l],["$y",u],["$D",h]].forEach((function(e){T[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,E,S),e.$i=!0),S},S.locale=w,S.isDayjs=b,S.unix=function(e){return S(1e3*e)},S.en=_[v],S.Ls=_,S.p={},S}()},1100:function(e){e.exports=function(){"use strict";return function(e,t){var n=t.prototype,r=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return r.bind(this)(e);var i=this.$utils(),o=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return r.bind(this)(o)}}}()},7798:function(e){e.exports=function(){"use strict";var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},t=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,n=/\d\d/,r=/\d\d?/,i=/\d*[^-_:/,()\s\d]+/,o={},s=function(e){return(e=+e)+(e>68?1900:2e3)},a=function(e){return function(t){this[e]=+t}},l=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e)return 0;if("Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),n=60*t[1]+(+t[2]||0);return 0===n?0:"+"===t[0]?-n:n}(e)}],c=function(e){var t=o[e];return t&&(t.indexOf?t:t.s.concat(t.f))},u=function(e,t){var n,r=o.meridiem;if(r){for(var i=1;i<=24;i+=1)if(e.indexOf(r(i,0,t))>-1){n=i>12;break}}else n=e===(t?"pm":"PM");return n},h={A:[i,function(e){this.afternoon=u(e,!1)}],a:[i,function(e){this.afternoon=u(e,!0)}],S:[/\d/,function(e){this.milliseconds=100*+e}],SS:[n,function(e){this.milliseconds=10*+e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[r,a("seconds")],ss:[r,a("seconds")],m:[r,a("minutes")],mm:[r,a("minutes")],H:[r,a("hours")],h:[r,a("hours")],HH:[r,a("hours")],hh:[r,a("hours")],D:[r,a("day")],DD:[n,a("day")],Do:[i,function(e){var t=o.ordinal,n=e.match(/\d+/);if(this.day=n[0],t)for(var r=1;r<=31;r+=1)t(r).replace(/\[|\]/g,"")===e&&(this.day=r)}],M:[r,a("month")],MM:[n,a("month")],MMM:[i,function(e){var t=c("months"),n=(c("monthsShort")||t.map((function(e){return e.slice(0,3)}))).indexOf(e)+1;if(n<1)throw new Error;this.month=n%12||n}],MMMM:[i,function(e){var t=c("months").indexOf(e)+1;if(t<1)throw new Error;this.month=t%12||t}],Y:[/[+-]?\d+/,a("year")],YY:[n,function(e){this.year=s(e)}],YYYY:[/\d{4}/,a("year")],Z:l,ZZ:l};function d(n){var r,i;r=n,i=o&&o.formats;for(var s=(n=r.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,n,r){var o=r&&r.toUpperCase();return n||i[r]||e[r]||i[o].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))}))).match(t),a=s.length,l=0;l<a;l+=1){var c=s[l],u=h[c],d=u&&u[0],p=u&&u[1];s[l]=p?{regex:d,parser:p}:c.replace(/^\[|\]$/g,"")}return function(e){for(var t={},n=0,r=0;n<a;n+=1){var i=s[n];if("string"==typeof i)r+=i.length;else{var o=i.regex,l=i.parser,c=e.slice(r),u=o.exec(c)[0];l.call(t,u),e=e.replace(u,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var n=e.hours;t?n<12&&(e.hours+=12):12===n&&(e.hours=0),delete e.afternoon}}(t),t}}return function(e,t,n){n.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(s=e.parseTwoDigitYear);var r=t.prototype,i=r.parse;r.parse=function(e){var t=e.date,r=e.utc,s=e.args;this.$u=r;var a=s[1];if("string"==typeof a){var l=!0===s[2],c=!0===s[3],u=l||c,h=s[2];c&&(h=s[2]),o=this.$locale(),!l&&h&&(o=n.Ls[h]),this.$d=function(e,t,n){try{if(["x","X"].indexOf(t)>-1)return new Date(("X"===t?1e3:1)*e);var r=d(t)(e),i=r.year,o=r.month,s=r.day,a=r.hours,l=r.minutes,c=r.seconds,u=r.milliseconds,h=r.zone,p=new Date,f=s||(i||o?1:p.getDate()),m=i||p.getFullYear(),g=0;i&&!o||(g=o>0?o-1:p.getMonth());var y=a||0,v=l||0,_=c||0,x=u||0;return h?new Date(Date.UTC(m,g,f,y,v,_,x+60*h.offset*1e3)):n?new Date(Date.UTC(m,g,f,y,v,_,x)):new Date(m,g,f,y,v,_,x)}catch(e){return new Date("")}}(t,a,r),this.init(),h&&!0!==h&&(this.$L=this.locale(h).$L),u&&t!=this.format(a)&&(this.$d=new Date("")),o={}}else if(a instanceof Array)for(var p=a.length,f=1;f<=p;f+=1){s[1]=a[f-1];var m=n.apply(this,s);if(m.isValid()){this.$d=m.$d,this.$L=m.$L,this.init();break}f===p&&(this.$d=new Date(""))}else i.call(this,e)}}}()},8743:function(e){e.exports=function(){"use strict";return function(e,t,n){t.prototype.isBetween=function(e,t,r,i){var o=n(e),s=n(t),a="("===(i=i||"()")[0],l=")"===i[1];return(a?this.isAfter(o,r):!this.isBefore(o,r))&&(l?this.isBefore(s,r):!this.isAfter(s,r))||(a?this.isBefore(o,r):!this.isAfter(o,r))&&(l?this.isAfter(s,r):!this.isBefore(s,r))}}}()},3825:function(e){e.exports=function(){"use strict";var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,n,r){var i=n.prototype,o=i.format;r.en.formats=e,i.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var n=this.$locale().formats,r=function(t,n){return t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,r,i){var o=i&&i.toUpperCase();return r||n[i]||e[i]||n[o].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))}))}(t,void 0===n?{}:n);return o.call(this,r)}}}()},1635:function(e){e.exports=function(){"use strict";var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(r,i,o){var s=i.prototype;o.utc=function(e){return new i({date:e,utc:!0,args:arguments})},s.utc=function(t){var n=o(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},s.local=function(){return o(this.toDate(),{locale:this.$L,utc:!1})};var a=s.parse;s.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var l=s.init;s.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var c=s.utcOffset;s.utcOffset=function(r,i){var o=this.$utils().u;if(o(r))return this.$u?0:o(this.$offset)?c.call(this):this.$offset;if("string"==typeof r&&(r=function(e){void 0===e&&(e="");var r=e.match(t);if(!r)return null;var i=(""+r[0]).match(n)||["-",0,0],o=i[0],s=60*+i[1]+ +i[2];return 0===s?0:"+"===o?s:-s}(r),null===r))return this;var s=Math.abs(r)<=16?60*r:r,a=this;if(i)return a.$offset=s,a.$u=0===r,a;if(0!==r){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(s+l,e)).$offset=s,a.$x.$localOffset=l}else a=this.utc();return a};var u=s.format;s.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,t)},s.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},s.isUTC=function(){return!!this.$u},s.toISOString=function(){return this.toDate().toISOString()},s.toString=function(){return this.toDate().toUTCString()};var h=s.toDate;s.toDate=function(e){return"s"===e&&this.$offset?o(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var d=s.diff;s.diff=function(e,t,n){if(e&&this.$u===e.$u)return d.call(this,e,t,n);var r=this.local(),i=o(e).local();return d.call(r,i,t,n)}}}()},3038:function(e){e.exports=function(){"use strict";var e="week",t="year";return function(n,r,i){var o=r.prototype;o.week=function(n){if(void 0===n&&(n=null),null!==n)return this.add(7*(n-this.week()),"day");var r=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var o=i(this).startOf(t).add(1,t).date(r),s=i(this).endOf(e);if(o.isBefore(s))return 1}var a=i(this).startOf(t).date(r).startOf(e).subtract(1,"millisecond"),l=this.diff(a,e,!0);return l<0?i(this).startOf("week").week():Math.ceil(l)},o.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}}()},1330:(e,t,n)=>{var r=n(6328),i=n(5021),o=n(8199),s=n(7503),a=n(9012),l=n(2039),c=Date.prototype.getTime;function u(e){return null==e}function h(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||e.length>0&&"number"!=typeof e[0])}e.exports=function e(t,n,d){var p=d||{};return!!(p.strict?o(t,n):t===n)||(!t||!n||"object"!=typeof t&&"object"!=typeof n?p.strict?o(t,n):t==n:function(t,n,o){var d,p;if(typeof t!=typeof n)return!1;if(u(t)||u(n))return!1;if(t.prototype!==n.prototype)return!1;if(i(t)!==i(n))return!1;var f=s(t),m=s(n);if(f!==m)return!1;if(f||m)return t.source===n.source&&a(t)===a(n);if(l(t)&&l(n))return c.call(t)===c.call(n);var g=h(t),y=h(n);if(g!==y)return!1;if(g||y){if(t.length!==n.length)return!1;for(d=0;d<t.length;d++)if(t[d]!==n[d])return!1;return!0}if(typeof t!=typeof n)return!1;try{var v=r(t),_=r(n)}catch(e){return!1}if(v.length!==_.length)return!1;for(v.sort(),_.sort(),d=v.length-1;d>=0;d--)if(v[d]!=_[d])return!1;for(d=v.length-1;d>=0;d--)if(!e(t[p=v[d]],n[p],o))return!1;return!0}(t,n,p))}},9959:(e,t,n)=>{"use strict";var r=n(6328),i="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,s=Array.prototype.concat,a=Object.defineProperty,l=n(2926)(),c=a&&l,u=function(e,t,n,r){if(t in e)if(!0===r){if(e[t]===n)return}else if("function"!=typeof(i=r)||"[object Function]"!==o.call(i)||!r())return;var i;c?a(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n},h=function(e,t){var n=arguments.length>2?arguments[2]:{},o=r(t);i&&(o=s.call(o,Object.getOwnPropertySymbols(t)));for(var a=0;a<o.length;a+=1)u(e,o[a],t[o[a]],n[o[a]])};h.supportsDescriptors=!!c,e.exports=h},467:e=>{function t(e,t,n,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(e,t,n,r)}t.prototype.run=function(e,t,n,r){this._init(e,t,n,r);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var o=this._regionQuery(i);if(o.length<this.minPts)this.noise.push(i);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(i,s),this._expandCluster(s,o)}}return this.clusters},t.prototype._init=function(e,t,n,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this.noise=[],this._datasetLength=e.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}t&&(this.epsilon=t),n&&(this.minPts=n),r&&(this.distance=r)},t.prototype._expandCluster=function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(1!==this._visited[r]){this._visited[r]=1;var i=this._regionQuery(r);i.length>=this.minPts&&(t=this._mergeArrays(t,i))}1!==this._assigned[r]&&this._addToCluster(r,e)}},t.prototype._addToCluster=function(e,t){this.clusters[t].push(e),this._assigned[e]=1},t.prototype._regionQuery=function(e){for(var t=[],n=0;n<this._datasetLength;n++)this.distance(this.dataset[e],this.dataset[n])<this.epsilon&&t.push(n);return t},t.prototype._mergeArrays=function(e,t){for(var n=t.length,r=0;r<n;r++){var i=t[r];e.indexOf(i)<0&&e.push(i)}return e},t.prototype._euclideanDistance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;)n+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(n)},e.exports&&(e.exports=t)},9803:e=>{function t(e,t,n){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(e,t,n)}t.prototype.init=function(e,t,n){this.assignments=[],this.centroids=[],void 0!==e&&(this.dataset=e),void 0!==t&&(this.k=t),void 0!==n&&(this.distance=n)},t.prototype.run=function(e,t){this.init(e,t);for(var n=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var i=!0;i;){i=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(u),a=0,l=0;l<u;l++)s[l]=0;for(var c=0;c<n;c++){var u=this.dataset[c].length;if(o===this.assignments[c]){for(l=0;l<u;l++)s[l]+=this.dataset[c][l];a++}}if(a>0){for(l=0;l<u;l++)s[l]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),i=!0}}return this.getClusters()},t.prototype.randomCentroid=function(){var e,t,n=this.dataset.length-1;do{t=Math.round(Math.random()*n),e=this.dataset[t]}while(this.centroids.indexOf(e)>=0);return e},t.prototype.assign=function(){for(var e,t=!1,n=this.dataset.length,r=0;r<n;r++)(e=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=e,t=!0);return t},t.prototype.getClusters=function(){for(var e,t=new Array(this.k),n=0;n<this.assignments.length;n++)void 0===t[e=this.assignments[n]]&&(t[e]=[]),t[e].push(n);return t},t.prototype.argmin=function(e,t,n){for(var r,i=Number.MAX_VALUE,o=0,s=t.length,a=0;a<s;a++)(r=n(e,t[a]))<i&&(i=r,o=a);return o},t.prototype.distance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;){var i=e[r]-t[r];n+=i*i}return Math.sqrt(n)},e.exports&&(e.exports=t)},1183:(e,t,n)=>{if(e.exports)var r=n(183);function i(e,t,n,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(e,t,n,r)}i.prototype.run=function(e,t,n,i){this._init(e,t,n,i);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var l=new r(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,l),this._expandCluster(a,l))}return this.clusters},i.prototype.getReachabilityPlot=function(){for(var e=[],t=0,n=this._orderedList.length;t<n;t++){var r=this._orderedList[t],i=this._reachability[r];e.push([r,i])}return e},i.prototype._init=function(e,t,n,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}t&&(this.epsilon=t),n&&(this.minPts=n),r&&(this.distance=r)},i.prototype._updateQueue=function(e,t,n){var r=this;this._coreDistance=this._distanceToCore(e),t.forEach((function(t){if(void 0===r._processed[t]){var i=r.distance(r.dataset[e],r.dataset[t]),o=Math.max(r._coreDistance,i);void 0===r._reachability[t]?(r._reachability[t]=o,n.insert(t,o)):o<r._reachability[t]&&(r._reachability[t]=o,n.remove(t),n.insert(t,o))}}))},i.prototype._expandCluster=function(e,t){for(var n=t.getElements(),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[e].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,t),this._expandCluster(e,t))}}},i.prototype._distanceToCore=function(e){for(var t=this.epsilon,n=0;n<t;n++)if(this._regionQuery(e,n).length>=this.minPts)return n},i.prototype._regionQuery=function(e,t){t=t||this.epsilon;for(var n=[],r=0,i=this.dataset.length;r<i;r++)this.distance(this.dataset[e],this.dataset[r])<t&&n.push(r);return n},i.prototype._euclideanDistance=function(e,t){for(var n=0,r=Math.min(e.length,t.length);r--;)n+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(n)},e.exports&&(e.exports=i)},183:e=>{function t(e,t,n){this._queue=[],this._priorities=[],this._sorting="desc",this._init(e,t,n)}t.prototype.insert=function(e,t){for(var n=this._queue.length,r=n;r--;){var i=this._priorities[r];"desc"===this._sorting?t>i&&(n=r):t<i&&(n=r)}this._insertAt(e,t,n)},t.prototype.remove=function(e){for(var t=this._queue.length;t--;)if(e===this._queue[t]){this._queue.splice(t,1),this._priorities.splice(t,1);break}},t.prototype.forEach=function(e){this._queue.forEach(e)},t.prototype.getElements=function(){return this._queue},t.prototype.getElementPriority=function(e){return this._priorities[e]},t.prototype.getPriorities=function(){return this._priorities},t.prototype.getElementsWithPriorities=function(){for(var e=[],t=0,n=this._queue.length;t<n;t++)e.push([this._queue[t],this._priorities[t]]);return e},t.prototype._init=function(e,t,n){if(e&&t){if(this._queue=[],this._priorities=[],e.length!==t.length)throw new Error("Arrays must have the same length");for(var r=0;r<e.length;r++)this.insert(e[r],t[r])}n&&(this._sorting=n)},t.prototype._insertAt=function(e,t,n){this._queue.length===n?(this._queue.push(e),this._priorities.push(t)):(this._queue.splice(n,0,e),this._priorities.splice(n,0,t))},e.exports&&(e.exports=t)},303:(e,t,n)=>{e.exports&&(e.exports={DBSCAN:n(467),KMEANS:n(9803),OPTICS:n(1183),PriorityQueue:n(183)})},6583:e=>{"use strict";function t(e,t,r){r=r||2;var o,s,a,l,h,d,f,m=t&&t.length,g=m?t[0]*r:e.length,y=n(e,0,g,r,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(e,t,r,i){var o,s,a,l=[];for(o=0,s=t.length;o<s;o++)(a=n(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(c),o=0;o<l.length;o++)r=u(l[o],r);return r}(e,t,y,r)),e.length>80*r){o=a=e[0],s=l=e[1];for(var _=r;_<g;_+=r)(h=e[_])<o&&(o=h),(d=e[_+1])<s&&(s=d),h>a&&(a=h),d>l&&(l=d);f=0!==(f=Math.max(a-o,l-s))?32767/f:0}return i(y,v,r,o,s,f,0),v}function n(e,t,n,r,i){var o,s;if(i===T(e,t,n,r)>0)for(o=t;o<n;o+=r)s=S(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=S(o,e[o],e[o+1],s);return s&&y(s,s.next)&&(M(s),s=s.next),s}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!y(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(M(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,c,u,h,p){if(e){!p&&h&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=d(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):o(e))t.push(f.i/n|0),t.push(e.i/n|0),t.push(m.i/n|0),M(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?i(e=a(r(e),t,n),t,n,c,u,h,2):2===p&&l(e,t,n,c,u,h):i(r(e),t,n,c,u,h,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,s=r.x,a=t.y,l=n.y,c=r.y,u=i<o?i<s?i:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=i>o?i>s?i:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,m=r.next;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=p&&f(i,a,o,l,s,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(e,t,n,r){var i=e.prev,o=e,s=e.next;if(g(i,o,s)>=0)return!1;for(var a=i.x,l=o.x,c=s.x,u=i.y,h=o.y,p=s.y,m=a<l?a<c?a:c:l<c?l:c,y=u<h?u<p?u:p:h<p?h:p,v=a>l?a>c?a:c:l>c?l:c,_=u>h?u>p?u:p:h>p?h:p,x=d(m,y,t,n,r),b=d(v,_,t,n,r),w=e.prevZ,S=e.nextZ;w&&w.z>=x&&S&&S.z<=b;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==i&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,S.x>=m&&S.x<=v&&S.y>=y&&S.y<=_&&S!==i&&S!==s&&f(a,u,l,h,c,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}for(;w&&w.z>=x;){if(w.x>=m&&w.x<=v&&w.y>=y&&w.y<=_&&w!==i&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;S&&S.z<=b;){if(S.x>=m&&S.x<=v&&S.y>=y&&S.y<=_&&S!==i&&S!==s&&f(a,u,l,h,c,p,S.x,S.y)&&g(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function a(e,t,n){var i=e;do{var o=i.prev,s=i.next.next;!y(o,s)&&v(o,i,i.next,s)&&b(o,s)&&b(s,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(s.i/n|0),M(i),M(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function l(e,t,n,o,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),i(l,t,n,o,s,a,0),void i(u,t,n,o,s,a,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,c=n,u=n.x,d=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&f(o<d?i:s,o,u,d,o<d?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),b(r,e)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,p=l)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var i=w(n,e);return r(i,i.next),r(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&v(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||y(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,n,r){var i=x(g(e,t,n)),o=x(g(e,t,r)),s=x(g(n,r,e)),a=x(g(n,r,t));return i!==o&&s!==a||!(0!==i||!_(e,n,t))||!(0!==o||!_(e,r,t))||!(0!==s||!_(n,e,r))||!(0!==a||!_(n,t,r))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var n=new E(e.i,e.x,e.y),r=new E(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function S(e,t,n,r){var i=new E(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function E(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,s=Math.abs(T(e,0,o,n));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(T(e,c,u,n))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,p=r[a+1]*n,f=r[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},2781:e=>{"use strict";var t=Array.prototype.slice,n=Object.prototype.toString;e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==n.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var i,o=t.call(arguments,1),s=Math.max(0,r.length-o.length),a=[],l=0;l<s;l++)a.push("$"+l);if(i=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=r.apply(this,o.concat(t.call(arguments)));return Object(n)===n?n:this}return r.apply(e,o.concat(t.call(arguments)))})),r.prototype){var c=function(){};c.prototype=r.prototype,i.prototype=new c,c.prototype=null}return i}},1199:(e,t,n)=>{"use strict";var r=n(2781);e.exports=Function.prototype.bind||r},6889:e=>{"use strict";var t=function(){return"string"==typeof function(){}.name},n=Object.getOwnPropertyDescriptor;if(n)try{n([],"length")}catch(e){n=null}t.functionsHaveConfigurableNames=function(){if(!t()||!n)return!1;var e=n((function(){}),"name");return!!e&&!!e.configurable};var r=Function.prototype.bind;t.boundFunctionsHaveNames=function(){return t()&&"function"==typeof r&&""!==function(){}.bind().name},e.exports=t},9996:(e,t,n)=>{var r=n(1330),i=function(e){this.precision=e&&e.precision?e.precision:17,this.direction=!(!e||!e.direction)&&e.direction,this.pseudoNode=!(!e||!e.pseudoNode)&&e.pseudoNode,this.objectComparator=e&&e.objectComparator?e.objectComparator:a};function o(e){return e.coordinates.map((function(t){return{type:e.type.replace("Multi",""),coordinates:t}}))}function s(e,t){return e.hasOwnProperty("coordinates")?e.coordinates.length===t.coordinates.length:e.length===t.length}function a(e,t){return r(e,t,{strict:!0})}i.prototype.compare=function(e,t){if(e.type!==t.type||!s(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates,0,!1);case"Polygon":return this.comparePolygon(e,t);case"Feature":return this.compareFeature(e,t);default:if(0===e.type.indexOf("Multi")){var n=this,r=o(e),i=o(t);return r.every((function(e){return this.some((function(t){return n.compare(e,t)}))}),i)}}return!1},i.prototype.compareCoord=function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n].toFixed(this.precision)!==t[n].toFixed(this.precision))return!1;return!0},i.prototype.compareLine=function(e,t,n,r){if(!s(e,t))return!1;var i=this.pseudoNode?e:this.removePseudo(e),o=this.pseudoNode?t:this.removePseudo(t);if(!r||this.compareCoord(i[0],o[0])||(o=this.fixStartIndex(o,i))){var a=this.compareCoord(i[n],o[n]);return this.direction||a?this.comparePath(i,o):!!this.compareCoord(i[n],o[o.length-(1+n)])&&this.comparePath(i.slice().reverse(),o)}},i.prototype.fixStartIndex=function(e,t){for(var n,r=-1,i=0;i<e.length;i++)if(this.compareCoord(e[i],t[0])){r=i;break}return r>=0&&(n=[].concat(e.slice(r,e.length),e.slice(1,r+1))),n},i.prototype.comparePath=function(e,t){var n=this;return e.every((function(e,t){return n.compareCoord(e,this[t])}),t)},i.prototype.comparePolygon=function(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){var n=e.coordinates.slice(1,e.coordinates.length),r=t.coordinates.slice(1,t.coordinates.length),i=this;return n.every((function(e){return this.some((function(t){return i.compareLine(e,t,1,!0)}))}),r)}return!1},i.prototype.compareFeature=function(e,t){return!(e.id!==t.id||!this.objectComparator(e.properties,t.properties)||!this.compareBBox(e,t))&&this.compare(e.geometry,t.geometry)},i.prototype.compareBBox=function(e,t){return!!(!e.bbox&&!t.bbox||e.bbox&&t.bbox&&this.compareCoord(e.bbox,t.bbox))},i.prototype.removePseudo=function(e){return e},e.exports=i},3130:(e,t,n)=>{var r=n(845),i=n(1949),o=n(6400),s=n(8441).Z,a=o.featureEach,l=(o.coordEach,i.polygon,i.featureCollection);function c(e){var t=new r(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:s(e),r.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach((function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:s(e),t.push(e)})):a(e,(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:s(e),t.push(e)})),r.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:s(e),r.prototype.remove.call(this,e,t)},t.clear=function(){return r.prototype.clear.call(this)},t.search=function(e){var t=r.prototype.search.call(this,this.toBBox(e));return l(t)},t.collides=function(e){return r.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=r.prototype.all.call(this);return l(e)},t.toJSON=function(){return r.prototype.toJSON.call(this)},t.fromJSON=function(e){return r.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=s(e);else{if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=s(e)}return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}e.exports=c,e.exports.default=c},845:function(e){e.exports=function(){"use strict";function e(e,r,i,o,s){!function e(n,r,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,l=r-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var d=n[r],p=i,f=o;for(t(n,i,r),s(n[o],d)>0&&t(n,i,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[i],d)?t(n,i,f):t(n,++f,o),f<=r&&(i=f+1),r<=f&&(o=f-1)}}(e,r,i||0,o||e.length-1,s||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<n;o++){var s=e.children[o];a(i,e.leaf?r(s):s)}return i}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,n,r,i,o){for(var s=[n,r];s.length;)if(!((r=s.pop())-(n=s.pop())<=i)){var a=n+Math.ceil((r-n)/i/2)*i;e(t,a,n,r,o),s.push(n,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var s=t.children[o],a=t.leaf?r(s):s;p(e,a)&&(t.leaf?n.push(s):d(e,a)?this._all(s,n):i.push(s))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],o=t.leaf?this.toBBox(i):i;if(p(e,o)){if(t.leaf||d(e,o))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,o,s=this.data,a=this.toBBox(e),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=c.pop(),o=!0),s.leaf){var u=i(e,s.children,t);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(l.push(s),c.push(n),n=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,s=n-t+1,a=this._maxEntries;if(s<=a)return o(i=f(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(i=f([])).leaf=!1,i.height=r;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(e,t,n,c,this.compareMinX);for(var u=t;u<=n;u+=c){var h=Math.min(u+c-1,n);m(e,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);i.children.push(this._build(e,d,p,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,s=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=u(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,i=c<i?c:i,s=l):h===o&&c<i&&(i=c,s=l)}t=s||t.children[0]}var d,p;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],o=this._chooseSubtree(r,this.data,t,i);for(o.children.push(e),a(o,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var s=this._chooseSplitIndex(n,i,r),a=f(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,o(n,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},r.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,o,a,l,c,h,d=1/0,p=1/0,f=t;f<=n-t;f++){var m=s(e,0,f,this.toBBox),g=s(e,f,n,this.toBBox),y=(i=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(i.minX,o.minX),l=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),h=Math.min(i.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),v=u(m)+u(g);y<d?(d=y,r=f,p=v<p?v:p):y===d&&v<p&&(p=v,r=f)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,o=s(e,0,t,i),l=s(e,n-t,n,i),c=h(o)+h(l),u=t;u<n-t;u++){var d=e.children[u];a(o,e.leaf?i(d):d),c+=h(o)}for(var p=n-t-1;p>=t;p--){var f=e.children[p];a(l,e.leaf?i(f):f),c+=h(l)}return c},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)a(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},r}()},8476:(e,t,n)=>{"use strict";var r,i=SyntaxError,o=Function,s=TypeError,a=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new s},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=n(5520)(),d=n(7593)(),p=Object.getPrototypeOf||(d?function(e){return e.__proto__}:null),f={},m="undefined"!=typeof Uint8Array&&p?p(Uint8Array):r,g={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h&&p?p([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h&&p?p(p([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h&&p?p((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h&&p?p((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h&&p?p(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(p)try{null.error}catch(e){var y=p(p(e));g["%Error.prototype%"]=y}var v=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&p&&(n=p(i.prototype))}return g[t]=n,n},_={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},x=n(1199),b=n(7838),w=x.call(Function.call,Array.prototype.concat),S=x.call(Function.apply,Array.prototype.splice),M=x.call(Function.call,String.prototype.replace),E=x.call(Function.call,String.prototype.slice),T=x.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,I=function(e,t){var n,r=e;if(b(_,r)&&(r="%"+(n=_[r])[0]+"%"),b(g,r)){var o=g[r];if(o===f&&(o=v(r)),void 0===o&&!t)throw new s("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new s('"allowMissing" argument must be a boolean');if(null===T(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=E(e,0,1),n=E(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return M(e,C,(function(e,t,n,i){r[r.length]=n?M(i,A,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",o=I("%"+r+"%",t),a=o.name,c=o.value,u=!1,h=o.alias;h&&(r=h[0],S(n,w([0,1],h)));for(var d=1,p=!0;d<n.length;d+=1){var f=n[d],m=E(f,0,1),y=E(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),b(g,a="%"+(r+="."+f)+"%"))c=g[a];else if(null!=c){if(!(f in c)){if(!t)throw new s("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&d+1>=n.length){var v=l(c,f);c=(p=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:c[f]}else p=b(c,f),c=c[f];p&&!u&&(g[a]=c)}}return c}},2926:(e,t,n)=>{"use strict";var r=n(8476)("%Object.defineProperty%",!0),i=function(){if(r)try{return r({},"a",{value:1}),!0}catch(e){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==r([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},7593:e=>{"use strict";var t={foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof n)}},5520:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(541);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}},541:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},8857:(e,t,n)=>{"use strict";var r=n(541);e.exports=function(){return r()&&!!Symbol.toStringTag}},7838:(e,t,n)=>{"use strict";var r=n(1199);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},7861:(e,t,n)=>{"use strict";var r=n(9456),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return r.isMemo(e)?s:a[e.$$typeof]||i}a[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[r.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,f=Object.prototype;e.exports=function e(t,n,r){if("string"!=typeof n){if(f){var i=p(n);i&&i!==f&&e(t,i,r)}var s=u(n);h&&(s=s.concat(h(n)));for(var a=l(t),m=l(n),g=0;g<s.length;++g){var y=s[g];if(!(o[y]||r&&r[y]||m&&m[y]||a&&a[y])){var v=d(n,y);try{c(t,y,v)}catch(e){}}}}return t}},229:(e,t)=>{"use strict";var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,f=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,g=n?Symbol.for("react.lazy"):60116,y=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,_=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case u:case h:case o:case a:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case d:case g:case m:case l:return e;default:return t}}case i:return t}}}function w(e){return b(e)===h}t.AsyncMode=u,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=l,t.Element=r,t.ForwardRef=d,t.Fragment=o,t.Lazy=g,t.Memo=m,t.Portal=i,t.Profiler=a,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return w(e)||b(e)===u},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===c},t.isContextProvider=function(e){return b(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return b(e)===d},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===m},t.isPortal=function(e){return b(e)===i},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===h||e===a||e===s||e===p||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===l||e.$$typeof===c||e.$$typeof===d||e.$$typeof===v||e.$$typeof===_||e.$$typeof===x||e.$$typeof===y)},t.typeOf=b},9456:(e,t,n)=>{"use strict";e.exports=n(229)},5021:(e,t,n)=>{"use strict";var r=n(8857)(),i=n(4680)("Object.prototype.toString"),o=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===i(e)},s=function(e){return!!o(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"[object Function]"===i(e.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,e.exports=a?o:s},2039:(e,t,n)=>{"use strict";var r=Date.prototype.getDay,i=Object.prototype.toString,o=n(8857)();e.exports=function(e){return"object"==typeof e&&null!==e&&(o?function(e){try{return r.call(e),!0}catch(e){return!1}}(e):"[object Date]"===i.call(e))}},7503:(e,t,n)=>{"use strict";var r,i,o,s,a=n(4680),l=n(8857)();if(l){r=a("Object.prototype.hasOwnProperty"),i=a("RegExp.prototype.exec"),o={};var c=function(){throw o};s={toString:c,valueOf:c},"symbol"==typeof Symbol.toPrimitive&&(s[Symbol.toPrimitive]=c)}var u=a("Object.prototype.toString"),h=Object.getOwnPropertyDescriptor;e.exports=l?function(e){if(!e||"object"!=typeof e)return!1;var t=h(e,"lastIndex");if(!t||!r(t,"value"))return!1;try{i(e,s)}catch(e){return e===o}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===u(e)}},738:(e,t,n)=>{e.exports=function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return i(t[s][1][e]||e)}),c,c.exports,e,t,n,r)}return n[s].exports}for(var o=void 0,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var s=f((function(){t(i,r)}));"error"===s.status&&r(s.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(i);return this.state!==l?h(n,this.state===a?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=f(d,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)p(e,r);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,l=-1,c=new this(i);++l<n;)u(e[l],l);return c;function u(e,i){t.resolve(e).then((function(e){s[i]=e,++a!==n||r||(r=!0,o.resolve(c,s))}),(function(e){r||(r=!0,o.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,r=e.length,s=!1;if(!r)return this.resolve([]);for(var a=-1,l=new this(i);++a<r;)n=e[a],t.resolve(n).then((function(e){s||(s=!0,o.resolve(l,e))}),(function(e){s||(s=!0,o.reject(l,e))}));return l}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function a(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",d=void 0,p={},f=Object.prototype.toString,m="readonly",g="readwrite";function y(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function v(e){return"boolean"==typeof d?s.resolve(d):function(e){return new s((function(t){var n=e.transaction(h,g),r=o([""]);n.objectStore(h).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function _(e){var t=p[e.name],n={};n.promise=new s((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function x(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function b(e,t){var n=p[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function w(e,t){return new s((function(n,r){if(p[e.name]=p[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);_(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var s=i.open.apply(i,o);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),x(e)}}))}function S(e){return w(e,!1)}function M(e){return w(e,!0)}function E(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function T(e){return o([y(atob(e.data))],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function A(e){var t=this,n=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function I(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return s.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),M(e)})).then((function(){return function(e){_(e);for(var t=p[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,S(e).then((function(t){return e.db=t,E(e)?M(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw b(e,t),t}))}(e).then((function(){I(e,t,n,r-1)}))})).catch(n);n(i)}}var P={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=p[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},p[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=A);var o=[];function a(){return s.resolve()}for(var l=0;l<i.forages.length;l++){var c=i.forages[l];c!==t&&o.push(c._initReady().catch(a))}var u=i.forages.slice(0);return s.all(o).then((function(){return n.db=i.db,S(n)})).then((function(e){return n.db=e,E(n,t._defaultConfig.version)?M(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new s((function(t,r){n.ready().then((function(){I(n._dbInfo,m,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var n=s.result;if(n){var r=n.value;C(r)&&(r=T(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new s((function(t,r){n.ready().then((function(){I(n._dbInfo,m,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),C(e)&&(e=T(e)),t(e)},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=new s((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===f.call(t)?v(o.db).then((function(e){return e?t:(n=t,new s((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){I(r._dbInfo,g,(function(o,s){if(o)return i(o);try{var a=s.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var l=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),n(t)},s.onabort=s.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return a(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=new s((function(t,r){n.ready().then((function(){I(n._dbInfo,g,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){I(t._dbInfo,g,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){I(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new s((function(t,r){e<0?t(null):n.ready().then((function(){I(n._dbInfo,m,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName),a=!1,l=s.openKeyCursor();l.onsuccess=function(){var n=l.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},l.onerror=function(){r(l.error)}}catch(e){r(e)}}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){I(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];o.onsuccess=function(){var t=o.result;t?(s.push(t.key),t.continue()):e(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){var o=e.name===r.name&&this._dbInfo.db?s.resolve(this._dbInfo.db):S(e).then((function(t){var n=p[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));n=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;_(e);var r=p[e.name],o=r.forages;t.close();for(var a=0;a<o.length;a++){var l=o[a];l._dbInfo.db=null,l._dbInfo.version=n}var c=new s((function(t,r){var o=i.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,x(n._dbInfo)}})).catch((function(t){throw(b(e,t)||s.resolve()).catch((function(){})),t}))}})):o.then((function(t){_(e);var n=p[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;var a=new s((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return a.then((function(e){n.db=e;for(var t=0;t<r.length;t++)x(r[t]._dbInfo)})).catch((function(t){throw(b(e,t)||s.resolve()).catch((function(){})),t}))}))}else n=s.reject("Invalid arguments");return a(n,t),n}};var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,D="__lfsc__:",O="arbf",N="blob",k="si08",F="ui08",z="uic8",B="si16",U="si32",j="ur16",V="ui32",G="fl32",H="fl64",Z=Object.prototype.toString;function W(e){var t,n,r,i,o,s=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var c=new ArrayBuffer(s),u=new Uint8Array(c);for(t=0;t<a;t+=4)n=R.indexOf(e[t]),r=R.indexOf(e[t+1]),i=R.indexOf(e[t+2]),o=R.indexOf(e[t+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function $(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=R[n[t]>>2],r+=R[(3&n[t])<<4|n[t+1]>>4],r+=R[(15&n[t+1])<<2|n[t+2]>>6],r+=R[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var q={serialize:function(e,t){var n="";if(e&&(n=Z.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===Z.call(e.buffer))){var r,i=D;e instanceof ArrayBuffer?(r=e,i+=O):(r=e.buffer,"[object Int8Array]"===n?i+=k:"[object Uint8Array]"===n?i+=F:"[object Uint8ClampedArray]"===n?i+=z:"[object Int16Array]"===n?i+=B:"[object Uint16Array]"===n?i+=j:"[object Int32Array]"===n?i+=U:"[object Uint32Array]"===n?i+=V:"[object Float32Array]"===n?i+=G:"[object Float64Array]"===n?i+=H:t(new Error("Failed to get type for BinaryArray"))),t(i+$(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+$(this.result);t(D+N+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,9)!==D)return JSON.parse(e);var t,n=e.substring(13),r=e.substring(9,13);if(r===N&&L.test(n)){var i=n.match(L);t=i[1],n=n.substring(i[0].length)}var s=W(n);switch(r){case O:return s;case N:return o([s],{type:t});case k:return new Int8Array(s);case F:return new Uint8Array(s);case z:return new Uint8ClampedArray(s);case B:return new Int16Array(s);case j:return new Uint16Array(s);case U:return new Int32Array(s);case V:return new Uint32Array(s);case G:return new Float32Array(s);case H:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}},stringToBuffer:W,bufferToString:$};function X(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function Y(e,t,n,r,i,o){e.executeSql(n,r,i,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,s):X(e,t,(function(){e.executeSql(n,r,i,o)}),o)}),o):o(e,s)}),o)}function K(e,t,n,r){var i=this;e=c(e);var o=new s((function(o,s){i.ready().then((function(){void 0===t&&(t=null);var a=t,l=i._dbInfo;l.serializer.serialize(t,(function(t,c){c?s(c):l.db.transaction((function(n){Y(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(K.apply(i,[e,a,n,r-1]));s(t)}}))}))})).catch(s)}));return a(o,n),o}var J={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new s((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){X(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=q,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new s((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,s=o.length,a=0;a<s;a++){var l=o.item(a),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,a+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new s((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},setItem:function(e,t,n){return K.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var r=new s((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},key:function(e,t){var n=this,r=new s((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Y(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return a(r,t),r},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Y(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return a(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return a(r=e.name?new s((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(function(e){return new s((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}(r))})).then((function(e){return new s((function(t,n){e.db.transaction((function(r){function i(e){return new s((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],a=0,l=e.storeNames.length;a<l;a++)o.push(i(e.storeNames[a]));s.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):s.reject("Invalid arguments"),t),r}};function Q(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function ee(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var te={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=Q(e,this._defaultConfig),ee()?(this._dbInfo=t,t.serializer=q,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=localStorage.length,s=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),s++)))return c}}}));return a(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return a(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new s((function(i,o){var s=r._dbInfo;s.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(s.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return a(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return a(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return a(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return a(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return a(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return a(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new s((function(t){e.storeName?t(Q(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):s.reject("Invalid arguments"),a(r,t),r}},ne=function(e,t){for(var n=e.length,r=0;r<n;){if((i=e[r])===(o=t)||"number"==typeof i&&"number"==typeof o&&isNaN(i)&&isNaN(o))return!0;r++}var i,o;return!1},re=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ie={},oe={},se={INDEXEDDB:P,WEBSQL:J,LOCALSTORAGE:te},ae=[se.INDEXEDDB._driver,se.WEBSQL._driver,se.LOCALSTORAGE._driver],le=["dropInstance"],ce=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(le),ue={description:"",driver:ae.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function he(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function de(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(re(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var pe=function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),se)if(se.hasOwnProperty(n)){var r=se[n],i=r._driver;this[n]=i,ie[i]||this.defineDriver(r)}this._defaultConfig=de({},ue),this._config=de({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new s((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var o=ce.concat("_initStorage"),l=0,c=o.length;l<c;l++){var u=o[l];if((!ne(le,u)||e[u])&&"function"!=typeof e[u])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=s.reject(t);return a(n,arguments[arguments.length-1]),n}},n=0,r=le.length;n<r;n++){var i=le[n];e[i]||(e[i]=t(i))}}();var h=function(n){ie[r]&&console.info("Redefining LocalForage driver: "+r),ie[r]=e,oe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return l(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=ie[e]?s.resolve(ie[e]):s.reject(new Error("Driver not found."));return l(r,t,n),r},e.prototype.getSerializer=function(e){var t=s.resolve(q);return l(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;re(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function a(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(a).catch(n)}o();var l=new Error("No available storage method found.");return r._driverSet=s.reject(l),r._driverSet}()}}(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=s.reject(e),r._driverSet})),l(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!oe[e]},e.prototype._extend=function(e){de(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ce.length;e<t;e++)he(this,ce[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),fe=new pe;t.exports=fe},{3:3}]},{},[4])(4)},6031:function(e,t,n){var r;e=n.nmd(e),function(){var i,o="Expected a function",s="__lodash_hash_undefined__",a="__lodash_placeholder__",l=32,c=128,u=1/0,h=9007199254740991,d=NaN,p=4294967295,f=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",l],["partialRight",64],["rearg",256]],m="[object Arguments]",g="[object Array]",y="[object Boolean]",v="[object Date]",_="[object Error]",x="[object Function]",b="[object GeneratorFunction]",w="[object Map]",S="[object Number]",M="[object Object]",E="[object Promise]",T="[object RegExp]",C="[object Set]",A="[object String]",I="[object Symbol]",P="[object WeakMap]",R="[object ArrayBuffer]",L="[object DataView]",D="[object Float32Array]",O="[object Float64Array]",N="[object Int8Array]",k="[object Int16Array]",F="[object Int32Array]",z="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",j="[object Uint32Array]",V=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Z=/&(?:amp|lt|gt|quot|#39);/g,W=/[&<>"']/g,$=RegExp(Z.source),q=RegExp(W.source),X=/<%-([\s\S]+?)%>/g,Y=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Q=/^\w*$/,ee=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,te=/[\\^$.*+?()[\]{}|]/g,ne=RegExp(te.source),re=/^\s+/,ie=/\s/,oe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,se=/\{\n\/\* \[wrapped with (.+)\] \*/,ae=/,? & /,le=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,ue=/\\(\\)?/g,he=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,de=/\w*$/,pe=/^[-+]0x[0-9a-f]+$/i,fe=/^0b[01]+$/i,me=/^\[object .+?Constructor\]$/,ge=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,ve=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_e=/($^)/,xe=/['\n\r\u2028\u2029\\]/g,be="\\ud800-\\udfff",we="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Se="\\u2700-\\u27bf",Me="a-z\\xdf-\\xf6\\xf8-\\xff",Ee="A-Z\\xc0-\\xd6\\xd8-\\xde",Te="\\ufe0e\\ufe0f",Ce="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ae="["+be+"]",Ie="["+Ce+"]",Pe="["+we+"]",Re="\\d+",Le="["+Se+"]",De="["+Me+"]",Oe="[^"+be+Ce+Re+Se+Me+Ee+"]",Ne="\\ud83c[\\udffb-\\udfff]",ke="[^"+be+"]",Fe="(?:\\ud83c[\\udde6-\\uddff]){2}",ze="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+Ee+"]",Ue="\\u200d",je="(?:"+De+"|"+Oe+")",Ve="(?:"+Be+"|"+Oe+")",Ge="(?:['](?:d|ll|m|re|s|t|ve))?",He="(?:['](?:D|LL|M|RE|S|T|VE))?",Ze="(?:"+Pe+"|"+Ne+")?",We="["+Te+"]?",$e=We+Ze+"(?:"+Ue+"(?:"+[ke,Fe,ze].join("|")+")"+We+Ze+")*",qe="(?:"+[Le,Fe,ze].join("|")+")"+$e,Xe="(?:"+[ke+Pe+"?",Pe,Fe,ze,Ae].join("|")+")",Ye=RegExp("[']","g"),Ke=RegExp(Pe,"g"),Je=RegExp(Ne+"(?="+Ne+")|"+Xe+$e,"g"),Qe=RegExp([Be+"?"+De+"+"+Ge+"(?="+[Ie,Be,"$"].join("|")+")",Ve+"+"+He+"(?="+[Ie,Be+je,"$"].join("|")+")",Be+"?"+je+"+"+Ge,Be+"+"+He,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Re,qe].join("|"),"g"),et=RegExp("["+Ue+be+we+Te+"]"),tt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,it={};it[D]=it[O]=it[N]=it[k]=it[F]=it[z]=it[B]=it[U]=it[j]=!0,it[m]=it[g]=it[R]=it[y]=it[L]=it[v]=it[_]=it[x]=it[w]=it[S]=it[M]=it[T]=it[C]=it[A]=it[P]=!1;var ot={};ot[m]=ot[g]=ot[R]=ot[L]=ot[y]=ot[v]=ot[D]=ot[O]=ot[N]=ot[k]=ot[F]=ot[w]=ot[S]=ot[M]=ot[T]=ot[C]=ot[A]=ot[I]=ot[z]=ot[B]=ot[U]=ot[j]=!0,ot[_]=ot[x]=ot[P]=!1;var st={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,lt=parseInt,ct="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,ut="object"==typeof self&&self&&self.Object===Object&&self,ht=ct||ut||Function("return this")(),dt=t&&!t.nodeType&&t,pt=dt&&e&&!e.nodeType&&e,ft=pt&&pt.exports===dt,mt=ft&&ct.process,gt=function(){try{return pt&&pt.require&&pt.require("util").types||mt&&mt.binding&&mt.binding("util")}catch(e){}}(),yt=gt&&gt.isArrayBuffer,vt=gt&&gt.isDate,_t=gt&&gt.isMap,xt=gt&&gt.isRegExp,bt=gt&&gt.isSet,wt=gt&&gt.isTypedArray;function St(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Mt(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r}function Et(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Tt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Ct(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function At(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}function It(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Pt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Rt(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Lt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function Dt(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function Ot(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Nt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var kt=Gt("length");function Ft(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function zt(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function Bt(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):zt(e,jt,n)}function Ut(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function jt(e){return e!=e}function Vt(e,t){var n=null==e?0:e.length;return n?Wt(e,t)/n:d}function Gt(e){return function(t){return null==t?i:t[e]}}function Ht(e){return function(t){return null==e?i:e[t]}}function Zt(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function Wt(e,t){for(var n,r=-1,o=e.length;++r<o;){var s=t(e[r]);s!==i&&(n=n===i?s:n+s)}return n}function $t(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function qt(e){return e?e.slice(0,dn(e)+1).replace(re,""):e}function Xt(e){return function(t){return e(t)}}function Yt(e,t){return Rt(t,(function(t){return e[t]}))}function Kt(e,t){return e.has(t)}function Jt(e,t){for(var n=-1,r=e.length;++n<r&&Bt(t,e[n],0)>-1;);return n}function Qt(e,t){for(var n=e.length;n--&&Bt(t,e[n],0)>-1;);return n}var en=Ht({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),tn=Ht({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nn(e){return"\\"+st[e]}function rn(e){return et.test(e)}function on(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function sn(e,t){return function(n){return e(t(n))}}function an(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var s=e[n];s!==t&&s!==a||(e[n]=a,o[i++]=n)}return o}function ln(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function cn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function un(e){return rn(e)?function(e){for(var t=Je.lastIndex=0;Je.test(e);)++t;return t}(e):kt(e)}function hn(e){return rn(e)?function(e){return e.match(Je)||[]}(e):function(e){return e.split("")}(e)}function dn(e){for(var t=e.length;t--&&ie.test(e.charAt(t)););return t}var pn=Ht({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),fn=function e(t){var n,r=(t=null==t?ht:fn.defaults(ht.Object(),t,fn.pick(ht,nt))).Array,ie=t.Date,be=t.Error,we=t.Function,Se=t.Math,Me=t.Object,Ee=t.RegExp,Te=t.String,Ce=t.TypeError,Ae=r.prototype,Ie=we.prototype,Pe=Me.prototype,Re=t["__core-js_shared__"],Le=Ie.toString,De=Pe.hasOwnProperty,Oe=0,Ne=(n=/[^.]+$/.exec(Re&&Re.keys&&Re.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",ke=Pe.toString,Fe=Le.call(Me),ze=ht._,Be=Ee("^"+Le.call(De).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ue=ft?t.Buffer:i,je=t.Symbol,Ve=t.Uint8Array,Ge=Ue?Ue.allocUnsafe:i,He=sn(Me.getPrototypeOf,Me),Ze=Me.create,We=Pe.propertyIsEnumerable,$e=Ae.splice,qe=je?je.isConcatSpreadable:i,Xe=je?je.iterator:i,Je=je?je.toStringTag:i,et=function(){try{var e=lo(Me,"defineProperty");return e({},"",{}),e}catch(e){}}(),st=t.clearTimeout!==ht.clearTimeout&&t.clearTimeout,ct=ie&&ie.now!==ht.Date.now&&ie.now,ut=t.setTimeout!==ht.setTimeout&&t.setTimeout,dt=Se.ceil,pt=Se.floor,mt=Me.getOwnPropertySymbols,gt=Ue?Ue.isBuffer:i,kt=t.isFinite,Ht=Ae.join,mn=sn(Me.keys,Me),gn=Se.max,yn=Se.min,vn=ie.now,_n=t.parseInt,xn=Se.random,bn=Ae.reverse,wn=lo(t,"DataView"),Sn=lo(t,"Map"),Mn=lo(t,"Promise"),En=lo(t,"Set"),Tn=lo(t,"WeakMap"),Cn=lo(Me,"create"),An=Tn&&new Tn,In={},Pn=Fo(wn),Rn=Fo(Sn),Ln=Fo(Mn),Dn=Fo(En),On=Fo(Tn),Nn=je?je.prototype:i,kn=Nn?Nn.valueOf:i,Fn=Nn?Nn.toString:i;function zn(e){if(ea(e)&&!Gs(e)&&!(e instanceof Vn)){if(e instanceof jn)return e;if(De.call(e,"__wrapped__"))return zo(e)}return new jn(e)}var Bn=function(){function e(){}return function(t){if(!Qs(t))return{};if(Ze)return Ze(t);e.prototype=t;var n=new e;return e.prototype=i,n}}();function Un(){}function jn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function Vn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Gn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Hn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Zn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Wn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Zn;++t<n;)this.add(e[t])}function $n(e){var t=this.__data__=new Hn(e);this.size=t.size}function qn(e,t){var n=Gs(e),r=!n&&Vs(e),i=!n&&!r&&$s(e),o=!n&&!r&&!i&&la(e),s=n||r||i||o,a=s?$t(e.length,Te):[],l=a.length;for(var c in e)!t&&!De.call(e,c)||s&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||go(c,l))||a.push(c);return a}function Xn(e){var t=e.length;return t?e[Zr(0,t-1)]:i}function Yn(e,t){return Lo(Ti(e),or(t,0,e.length))}function Kn(e){return Lo(Ti(e))}function Jn(e,t,n){(n!==i&&!Bs(e[t],n)||n===i&&!(t in e))&&rr(e,t,n)}function Qn(e,t,n){var r=e[t];De.call(e,t)&&Bs(r,n)&&(n!==i||t in e)||rr(e,t,n)}function er(e,t){for(var n=e.length;n--;)if(Bs(e[n][0],t))return n;return-1}function tr(e,t,n,r){return ur(e,(function(e,i,o){t(r,e,n(e),o)})),r}function nr(e,t){return e&&Ci(t,Pa(t),e)}function rr(e,t,n){"__proto__"==t&&et?et(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ir(e,t){for(var n=-1,o=t.length,s=r(o),a=null==e;++n<o;)s[n]=a?i:Ea(e,t[n]);return s}function or(e,t,n){return e==e&&(n!==i&&(e=e<=n?e:n),t!==i&&(e=e>=t?e:t)),e}function sr(e,t,n,r,o,s){var a,l=1&t,c=2&t,u=4&t;if(n&&(a=o?n(e,r,o,s):n(e)),a!==i)return a;if(!Qs(e))return e;var h=Gs(e);if(h){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&De.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return Ti(e,a)}else{var d=ho(e),p=d==x||d==b;if($s(e))return xi(e,l);if(d==M||d==m||p&&!o){if(a=c||p?{}:fo(e),!l)return c?function(e,t){return Ci(e,uo(e),t)}(e,function(e,t){return e&&Ci(t,Ra(t),e)}(a,e)):function(e,t){return Ci(e,co(e),t)}(e,nr(a,e))}else{if(!ot[d])return o?e:{};a=function(e,t,n){var r,i=e.constructor;switch(t){case R:return bi(e);case y:case v:return new i(+e);case L:return function(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case D:case O:case N:case k:case F:case z:case B:case U:case j:return wi(e,n);case w:return new i;case S:case A:return new i(e);case T:return function(e){var t=new e.constructor(e.source,de.exec(e));return t.lastIndex=e.lastIndex,t}(e);case C:return new i;case I:return r=e,kn?Me(kn.call(r)):{}}}(e,d,l)}}s||(s=new $n);var f=s.get(e);if(f)return f;s.set(e,a),oa(e)?e.forEach((function(r){a.add(sr(r,t,n,r,e,s))})):ta(e)&&e.forEach((function(r,i){a.set(i,sr(r,t,n,i,e,s))}));var g=h?i:(u?c?to:eo:c?Ra:Pa)(e);return Et(g||e,(function(r,i){g&&(r=e[i=r]),Qn(a,i,sr(r,t,n,i,e,s))})),a}function ar(e,t,n){var r=n.length;if(null==e)return!r;for(e=Me(e);r--;){var o=n[r],s=t[o],a=e[o];if(a===i&&!(o in e)||!s(a))return!1}return!0}function lr(e,t,n){if("function"!=typeof e)throw new Ce(o);return Ao((function(){e.apply(i,n)}),t)}function cr(e,t,n,r){var i=-1,o=It,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;n&&(t=Rt(t,Xt(n))),r?(o=Pt,s=!1):t.length>=200&&(o=Kt,s=!1,t=new Wn(t));e:for(;++i<a;){var u=e[i],h=null==n?u:n(u);if(u=r||0!==u?u:0,s&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else o(t,h,r)||l.push(u)}return l}zn.templateSettings={escape:X,evaluate:Y,interpolate:K,variable:"",imports:{_:zn}},zn.prototype=Un.prototype,zn.prototype.constructor=zn,jn.prototype=Bn(Un.prototype),jn.prototype.constructor=jn,Vn.prototype=Bn(Un.prototype),Vn.prototype.constructor=Vn,Gn.prototype.clear=function(){this.__data__=Cn?Cn(null):{},this.size=0},Gn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gn.prototype.get=function(e){var t=this.__data__;if(Cn){var n=t[e];return n===s?i:n}return De.call(t,e)?t[e]:i},Gn.prototype.has=function(e){var t=this.__data__;return Cn?t[e]!==i:De.call(t,e)},Gn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Cn&&t===i?s:t,this},Hn.prototype.clear=function(){this.__data__=[],this.size=0},Hn.prototype.delete=function(e){var t=this.__data__,n=er(t,e);return!(n<0||(n==t.length-1?t.pop():$e.call(t,n,1),--this.size,0))},Hn.prototype.get=function(e){var t=this.__data__,n=er(t,e);return n<0?i:t[n][1]},Hn.prototype.has=function(e){return er(this.__data__,e)>-1},Hn.prototype.set=function(e,t){var n=this.__data__,r=er(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Zn.prototype.clear=function(){this.size=0,this.__data__={hash:new Gn,map:new(Sn||Hn),string:new Gn}},Zn.prototype.delete=function(e){var t=so(this,e).delete(e);return this.size-=t?1:0,t},Zn.prototype.get=function(e){return so(this,e).get(e)},Zn.prototype.has=function(e){return so(this,e).has(e)},Zn.prototype.set=function(e,t){var n=so(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Wn.prototype.add=Wn.prototype.push=function(e){return this.__data__.set(e,s),this},Wn.prototype.has=function(e){return this.__data__.has(e)},$n.prototype.clear=function(){this.__data__=new Hn,this.size=0},$n.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},$n.prototype.get=function(e){return this.__data__.get(e)},$n.prototype.has=function(e){return this.__data__.has(e)},$n.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Hn){var r=n.__data__;if(!Sn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Zn(r)}return n.set(e,t),this.size=n.size,this};var ur=Pi(vr),hr=Pi(_r,!0);function dr(e,t){var n=!0;return ur(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function pr(e,t,n){for(var r=-1,o=e.length;++r<o;){var s=e[r],a=t(s);if(null!=a&&(l===i?a==a&&!aa(a):n(a,l)))var l=a,c=s}return c}function fr(e,t){var n=[];return ur(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function mr(e,t,n,r,i){var o=-1,s=e.length;for(n||(n=mo),i||(i=[]);++o<s;){var a=e[o];t>0&&n(a)?t>1?mr(a,t-1,n,r,i):Lt(i,a):r||(i[i.length]=a)}return i}var gr=Ri(),yr=Ri(!0);function vr(e,t){return e&&gr(e,t,Pa)}function _r(e,t){return e&&yr(e,t,Pa)}function xr(e,t){return At(t,(function(t){return Ys(e[t])}))}function br(e,t){for(var n=0,r=(t=gi(t,e)).length;null!=e&&n<r;)e=e[ko(t[n++])];return n&&n==r?e:i}function wr(e,t,n){var r=t(e);return Gs(e)?r:Lt(r,n(e))}function Sr(e){return null==e?e===i?"[object Undefined]":"[object Null]":Je&&Je in Me(e)?function(e){var t=De.call(e,Je),n=e[Je];try{e[Je]=i;var r=!0}catch(e){}var o=ke.call(e);return r&&(t?e[Je]=n:delete e[Je]),o}(e):function(e){return ke.call(e)}(e)}function Mr(e,t){return e>t}function Er(e,t){return null!=e&&De.call(e,t)}function Tr(e,t){return null!=e&&t in Me(e)}function Cr(e,t,n){for(var o=n?Pt:It,s=e[0].length,a=e.length,l=a,c=r(a),u=1/0,h=[];l--;){var d=e[l];l&&t&&(d=Rt(d,Xt(t))),u=yn(d.length,u),c[l]=!n&&(t||s>=120&&d.length>=120)?new Wn(l&&d):i}d=e[0];var p=-1,f=c[0];e:for(;++p<s&&h.length<u;){var m=d[p],g=t?t(m):m;if(m=n||0!==m?m:0,!(f?Kt(f,g):o(h,g,n))){for(l=a;--l;){var y=c[l];if(!(y?Kt(y,g):o(e[l],g,n)))continue e}f&&f.push(g),h.push(m)}}return h}function Ar(e,t,n){var r=null==(e=Eo(e,t=gi(t,e)))?e:e[ko(Xo(t))];return null==r?i:St(r,e,n)}function Ir(e){return ea(e)&&Sr(e)==m}function Pr(e,t,n,r,o){return e===t||(null==e||null==t||!ea(e)&&!ea(t)?e!=e&&t!=t:function(e,t,n,r,o,s){var a=Gs(e),l=Gs(t),c=a?g:ho(e),u=l?g:ho(t),h=(c=c==m?M:c)==M,d=(u=u==m?M:u)==M,p=c==u;if(p&&$s(e)){if(!$s(t))return!1;a=!0,h=!1}if(p&&!h)return s||(s=new $n),a||la(e)?Ji(e,t,n,r,o,s):function(e,t,n,r,i,o,s){switch(n){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case R:return!(e.byteLength!=t.byteLength||!o(new Ve(e),new Ve(t)));case y:case v:case S:return Bs(+e,+t);case _:return e.name==t.name&&e.message==t.message;case T:case A:return e==t+"";case w:var a=on;case C:var l=1&r;if(a||(a=ln),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;r|=2,s.set(e,t);var u=Ji(a(e),a(t),r,i,o,s);return s.delete(e),u;case I:if(kn)return kn.call(e)==kn.call(t)}return!1}(e,t,c,n,r,o,s);if(!(1&n)){var f=h&&De.call(e,"__wrapped__"),x=d&&De.call(t,"__wrapped__");if(f||x){var b=f?e.value():e,E=x?t.value():t;return s||(s=new $n),o(b,E,n,r,s)}}return!!p&&(s||(s=new $n),function(e,t,n,r,o,s){var a=1&n,l=eo(e),c=l.length;if(c!=eo(t).length&&!a)return!1;for(var u=c;u--;){var h=l[u];if(!(a?h in t:De.call(t,h)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var f=!0;s.set(e,t),s.set(t,e);for(var m=a;++u<c;){var g=e[h=l[u]],y=t[h];if(r)var v=a?r(y,g,h,t,e,s):r(g,y,h,e,t,s);if(!(v===i?g===y||o(g,y,n,r,s):v)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var _=e.constructor,x=t.constructor;_==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x||(f=!1)}return s.delete(e),s.delete(t),f}(e,t,n,r,o,s))}(e,t,n,r,Pr,o))}function Rr(e,t,n,r){var o=n.length,s=o,a=!r;if(null==e)return!s;for(e=Me(e);o--;){var l=n[o];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<s;){var c=(l=n[o])[0],u=e[c],h=l[1];if(a&&l[2]){if(u===i&&!(c in e))return!1}else{var d=new $n;if(r)var p=r(u,h,c,e,t,d);if(!(p===i?Pr(h,u,3,r,d):p))return!1}}return!0}function Lr(e){return!(!Qs(e)||(t=e,Ne&&Ne in t))&&(Ys(e)?Be:me).test(Fo(e));var t}function Dr(e){return"function"==typeof e?e:null==e?nl:"object"==typeof e?Gs(e)?zr(e[0],e[1]):Fr(e):hl(e)}function Or(e){if(!bo(e))return mn(e);var t=[];for(var n in Me(e))De.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Nr(e,t){return e<t}function kr(e,t){var n=-1,i=Zs(e)?r(e.length):[];return ur(e,(function(e,r,o){i[++n]=t(e,r,o)})),i}function Fr(e){var t=ao(e);return 1==t.length&&t[0][2]?So(t[0][0],t[0][1]):function(n){return n===e||Rr(n,e,t)}}function zr(e,t){return vo(e)&&wo(t)?So(ko(e),t):function(n){var r=Ea(n,e);return r===i&&r===t?Ta(n,e):Pr(t,r,3)}}function Br(e,t,n,r,o){e!==t&&gr(t,(function(s,a){if(o||(o=new $n),Qs(s))!function(e,t,n,r,o,s,a){var l=To(e,n),c=To(t,n),u=a.get(c);if(u)Jn(e,n,u);else{var h=s?s(l,c,n+"",e,t,a):i,d=h===i;if(d){var p=Gs(c),f=!p&&$s(c),m=!p&&!f&&la(c);h=c,p||f||m?Gs(l)?h=l:Ws(l)?h=Ti(l):f?(d=!1,h=xi(c,!0)):m?(d=!1,h=wi(c,!0)):h=[]:ra(c)||Vs(c)?(h=l,Vs(l)?h=ga(l):Qs(l)&&!Ys(l)||(h=fo(c))):d=!1}d&&(a.set(c,h),o(h,c,r,s,a),a.delete(c)),Jn(e,n,h)}}(e,t,a,n,Br,r,o);else{var l=r?r(To(e,a),s,a+"",e,t,o):i;l===i&&(l=s),Jn(e,a,l)}}),Ra)}function Ur(e,t){var n=e.length;if(n)return go(t+=t<0?n:0,n)?e[t]:i}function jr(e,t,n){t=t.length?Rt(t,(function(e){return Gs(e)?function(t){return br(t,1===e.length?e[0]:e)}:e})):[nl];var r=-1;t=Rt(t,Xt(oo()));var i=kr(e,(function(e,n,i){var o=Rt(t,(function(t){return t(e)}));return{criteria:o,index:++r,value:e}}));return function(e,t){var r=e.length;for(e.sort((function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;++r<s;){var l=Si(i[r],o[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}));r--;)e[r]=e[r].value;return e}(i)}function Vr(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var s=t[r],a=br(e,s);n(a,s)&&Yr(o,gi(s,e),a)}return o}function Gr(e,t,n,r){var i=r?Ut:Bt,o=-1,s=t.length,a=e;for(e===t&&(t=Ti(t)),n&&(a=Rt(e,Xt(n)));++o<s;)for(var l=0,c=t[o],u=n?n(c):c;(l=i(a,u,l,r))>-1;)a!==e&&$e.call(a,l,1),$e.call(e,l,1);return e}function Hr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;go(i)?$e.call(e,i,1):li(e,i)}}return e}function Zr(e,t){return e+pt(xn()*(t-e+1))}function Wr(e,t){var n="";if(!e||t<1||t>h)return n;do{t%2&&(n+=e),(t=pt(t/2))&&(e+=e)}while(t);return n}function $r(e,t){return Io(Mo(e,t,nl),e+"")}function qr(e){return Xn(Ba(e))}function Xr(e,t){var n=Ba(e);return Lo(n,or(t,0,n.length))}function Yr(e,t,n,r){if(!Qs(e))return e;for(var o=-1,s=(t=gi(t,e)).length,a=s-1,l=e;null!=l&&++o<s;){var c=ko(t[o]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(o!=a){var h=l[c];(u=r?r(h,c,l):i)===i&&(u=Qs(h)?h:go(t[o+1])?[]:{})}Qn(l,c,u),l=l[c]}return e}var Kr=An?function(e,t){return An.set(e,t),e}:nl,Jr=et?function(e,t){return et(e,"toString",{configurable:!0,enumerable:!1,value:Qa(t),writable:!0})}:nl;function Qr(e){return Lo(Ba(e))}function ei(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var s=r(o);++i<o;)s[i]=e[i+t];return s}function ti(e,t){var n;return ur(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function ni(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,s=e[o];null!==s&&!aa(s)&&(n?s<=t:s<t)?r=o+1:i=o}return i}return ri(e,t,nl,n)}function ri(e,t,n,r){var o=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(t=n(t))!=t,l=null===t,c=aa(t),u=t===i;o<s;){var h=pt((o+s)/2),d=n(e[h]),p=d!==i,f=null===d,m=d==d,g=aa(d);if(a)var y=r||m;else y=u?m&&(r||p):l?m&&p&&(r||!f):c?m&&p&&!f&&(r||!g):!f&&!g&&(r?d<=t:d<t);y?o=h+1:s=h}return yn(s,4294967294)}function ii(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var s=e[n],a=t?t(s):s;if(!n||!Bs(a,l)){var l=a;o[i++]=0===s?0:s}}return o}function oi(e){return"number"==typeof e?e:aa(e)?d:+e}function si(e){if("string"==typeof e)return e;if(Gs(e))return Rt(e,si)+"";if(aa(e))return Fn?Fn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ai(e,t,n){var r=-1,i=It,o=e.length,s=!0,a=[],l=a;if(n)s=!1,i=Pt;else if(o>=200){var c=t?null:Wi(e);if(c)return ln(c);s=!1,i=Kt,l=new Wn}else l=t?[]:a;e:for(;++r<o;){var u=e[r],h=t?t(u):u;if(u=n||0!==u?u:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),a.push(u)}else i(l,h,n)||(l!==a&&l.push(h),a.push(u))}return a}function li(e,t){return null==(e=Eo(e,t=gi(t,e)))||delete e[ko(Xo(t))]}function ci(e,t,n,r){return Yr(e,t,n(br(e,t)),r)}function ui(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?ei(e,r?0:o,r?o+1:i):ei(e,r?o+1:0,r?i:o)}function hi(e,t){var n=e;return n instanceof Vn&&(n=n.value()),Dt(t,(function(e,t){return t.func.apply(t.thisArg,Lt([e],t.args))}),n)}function di(e,t,n){var i=e.length;if(i<2)return i?ai(e[0]):[];for(var o=-1,s=r(i);++o<i;)for(var a=e[o],l=-1;++l<i;)l!=o&&(s[o]=cr(s[o]||a,e[l],t,n));return ai(mr(s,1),t,n)}function pi(e,t,n){for(var r=-1,o=e.length,s=t.length,a={};++r<o;){var l=r<s?t[r]:i;n(a,e[r],l)}return a}function fi(e){return Ws(e)?e:[]}function mi(e){return"function"==typeof e?e:nl}function gi(e,t){return Gs(e)?e:vo(e,t)?[e]:No(ya(e))}var yi=$r;function vi(e,t,n){var r=e.length;return n=n===i?r:n,!t&&n>=r?e:ei(e,t,n)}var _i=st||function(e){return ht.clearTimeout(e)};function xi(e,t){if(t)return e.slice();var n=e.length,r=Ge?Ge(n):new e.constructor(n);return e.copy(r),r}function bi(e){var t=new e.constructor(e.byteLength);return new Ve(t).set(new Ve(e)),t}function wi(e,t){var n=t?bi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Si(e,t){if(e!==t){var n=e!==i,r=null===e,o=e==e,s=aa(e),a=t!==i,l=null===t,c=t==t,u=aa(t);if(!l&&!u&&!s&&e>t||s&&a&&c&&!l&&!u||r&&a&&c||!n&&c||!o)return 1;if(!r&&!s&&!u&&e<t||u&&n&&o&&!r&&!s||l&&n&&o||!a&&o||!c)return-1}return 0}function Mi(e,t,n,i){for(var o=-1,s=e.length,a=n.length,l=-1,c=t.length,u=gn(s-a,0),h=r(c+u),d=!i;++l<c;)h[l]=t[l];for(;++o<a;)(d||o<s)&&(h[n[o]]=e[o]);for(;u--;)h[l++]=e[o++];return h}function Ei(e,t,n,i){for(var o=-1,s=e.length,a=-1,l=n.length,c=-1,u=t.length,h=gn(s-l,0),d=r(h+u),p=!i;++o<h;)d[o]=e[o];for(var f=o;++c<u;)d[f+c]=t[c];for(;++a<l;)(p||o<s)&&(d[f+n[a]]=e[o++]);return d}function Ti(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function Ci(e,t,n,r){var o=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var l=t[s],c=r?r(n[l],e[l],l,n,e):i;c===i&&(c=e[l]),o?rr(n,l,c):Qn(n,l,c)}return n}function Ai(e,t){return function(n,r){var i=Gs(n)?Mt:tr,o=t?t():{};return i(n,e,oo(r,2),o)}}function Ii(e){return $r((function(t,n){var r=-1,o=n.length,s=o>1?n[o-1]:i,a=o>2?n[2]:i;for(s=e.length>3&&"function"==typeof s?(o--,s):i,a&&yo(n[0],n[1],a)&&(s=o<3?i:s,o=1),t=Me(t);++r<o;){var l=n[r];l&&e(t,l,r,s)}return t}))}function Pi(e,t){return function(n,r){if(null==n)return n;if(!Zs(n))return e(n,r);for(var i=n.length,o=t?i:-1,s=Me(n);(t?o--:++o<i)&&!1!==r(s[o],o,s););return n}}function Ri(e){return function(t,n,r){for(var i=-1,o=Me(t),s=r(t),a=s.length;a--;){var l=s[e?a:++i];if(!1===n(o[l],l,o))break}return t}}function Li(e){return function(t){var n=rn(t=ya(t))?hn(t):i,r=n?n[0]:t.charAt(0),o=n?vi(n,1).join(""):t.slice(1);return r[e]()+o}}function Di(e){return function(t){return Dt(Ya(Va(t).replace(Ye,"")),e,"")}}function Oi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Bn(e.prototype),r=e.apply(n,t);return Qs(r)?r:n}}function Ni(e){return function(t,n,r){var o=Me(t);if(!Zs(t)){var s=oo(n,3);t=Pa(t),n=function(e){return s(o[e],e,o)}}var a=e(t,n,r);return a>-1?o[s?t[a]:a]:i}}function ki(e){return Qi((function(t){var n=t.length,r=n,s=jn.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new Ce(o);if(s&&!l&&"wrapper"==ro(a))var l=new jn([],!0)}for(r=l?r:n;++r<n;){var c=ro(a=t[r]),u="wrapper"==c?no(a):i;l=u&&_o(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[ro(u[0])].apply(l,u[3]):1==a.length&&_o(a)?l[c]():l.thru(a)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&Gs(r))return l.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}}))}function Fi(e,t,n,o,s,a,l,u,h,d){var p=t&c,f=1&t,m=2&t,g=24&t,y=512&t,v=m?i:Oi(e);return function c(){for(var _=arguments.length,x=r(_),b=_;b--;)x[b]=arguments[b];if(g)var w=io(c),S=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(x,w);if(o&&(x=Mi(x,o,s,g)),a&&(x=Ei(x,a,l,g)),_-=S,g&&_<d){var M=an(x,w);return Hi(e,t,Fi,c.placeholder,n,x,M,u,h,d-_)}var E=f?n:this,T=m?E[e]:e;return _=x.length,u?x=function(e,t){for(var n=e.length,r=yn(t.length,n),o=Ti(e);r--;){var s=t[r];e[r]=go(s,n)?o[s]:i}return e}(x,u):y&&_>1&&x.reverse(),p&&h<_&&(x.length=h),this&&this!==ht&&this instanceof c&&(T=v||Oi(T)),T.apply(E,x)}}function zi(e,t){return function(n,r){return function(e,t,n,r){return vr(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function Bi(e,t){return function(n,r){var o;if(n===i&&r===i)return t;if(n!==i&&(o=n),r!==i){if(o===i)return r;"string"==typeof n||"string"==typeof r?(n=si(n),r=si(r)):(n=oi(n),r=oi(r)),o=e(n,r)}return o}}function Ui(e){return Qi((function(t){return t=Rt(t,Xt(oo())),$r((function(n){var r=this;return e(t,(function(e){return St(e,r,n)}))}))}))}function ji(e,t){var n=(t=t===i?" ":si(t)).length;if(n<2)return n?Wr(t,e):t;var r=Wr(t,dt(e/un(t)));return rn(t)?vi(hn(r),0,e).join(""):r.slice(0,e)}function Vi(e){return function(t,n,o){return o&&"number"!=typeof o&&yo(t,n,o)&&(n=o=i),t=da(t),n===i?(n=t,t=0):n=da(n),function(e,t,n,i){for(var o=-1,s=gn(dt((t-e)/(n||1)),0),a=r(s);s--;)a[i?s:++o]=e,e+=n;return a}(t,n,o=o===i?t<n?1:-1:da(o),e)}}function Gi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ma(t),n=ma(n)),e(t,n)}}function Hi(e,t,n,r,o,s,a,c,u,h){var d=8&t;t|=d?l:64,4&(t&=~(d?64:l))||(t&=-4);var p=[e,t,o,d?s:i,d?a:i,d?i:s,d?i:a,c,u,h],f=n.apply(i,p);return _o(e)&&Co(f,p),f.placeholder=r,Po(f,e,t)}function Zi(e){var t=Se[e];return function(e,n){if(e=ma(e),(n=null==n?0:yn(pa(n),292))&&kt(e)){var r=(ya(e)+"e").split("e");return+((r=(ya(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Wi=En&&1/ln(new En([,-0]))[1]==u?function(e){return new En(e)}:al;function $i(e){return function(t){var n=ho(t);return n==w?on(t):n==C?cn(t):function(e,t){return Rt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function qi(e,t,n,s,u,h,d,p){var f=2&t;if(!f&&"function"!=typeof e)throw new Ce(o);var m=s?s.length:0;if(m||(t&=-97,s=u=i),d=d===i?d:gn(pa(d),0),p=p===i?p:pa(p),m-=u?u.length:0,64&t){var g=s,y=u;s=u=i}var v=f?i:no(e),_=[e,t,n,s,u,g,y,h,d,p];if(v&&function(e,t){var n=e[1],r=t[1],i=n|r,o=i<131,s=r==c&&8==n||r==c&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!o&&!s)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?Mi(u,l,t[4]):l,e[4]=u?an(e[3],a):t[4]}(l=t[5])&&(u=e[5],e[5]=u?Ei(u,l,t[6]):l,e[6]=u?an(e[5],a):t[6]),(l=t[7])&&(e[7]=l),r&c&&(e[8]=null==e[8]?t[8]:yn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(_,v),e=_[0],t=_[1],n=_[2],s=_[3],u=_[4],!(p=_[9]=_[9]===i?f?0:e.length:gn(_[9]-m,0))&&24&t&&(t&=-25),t&&1!=t)x=8==t||16==t?function(e,t,n){var o=Oi(e);return function s(){for(var a=arguments.length,l=r(a),c=a,u=io(s);c--;)l[c]=arguments[c];var h=a<3&&l[0]!==u&&l[a-1]!==u?[]:an(l,u);return(a-=h.length)<n?Hi(e,t,Fi,s.placeholder,i,l,h,i,i,n-a):St(this&&this!==ht&&this instanceof s?o:e,this,l)}}(e,t,p):t!=l&&33!=t||u.length?Fi.apply(i,_):function(e,t,n,i){var o=1&t,s=Oi(e);return function t(){for(var a=-1,l=arguments.length,c=-1,u=i.length,h=r(u+l),d=this&&this!==ht&&this instanceof t?s:e;++c<u;)h[c]=i[c];for(;l--;)h[c++]=arguments[++a];return St(d,o?n:this,h)}}(e,t,n,s);else var x=function(e,t,n){var r=1&t,i=Oi(e);return function t(){return(this&&this!==ht&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,n);return Po((v?Kr:Co)(x,_),e,t)}function Xi(e,t,n,r){return e===i||Bs(e,Pe[n])&&!De.call(r,n)?t:e}function Yi(e,t,n,r,o,s){return Qs(e)&&Qs(t)&&(s.set(t,e),Br(e,t,i,Yi,s),s.delete(t)),e}function Ki(e){return ra(e)?i:e}function Ji(e,t,n,r,o,s){var a=1&n,l=e.length,c=t.length;if(l!=c&&!(a&&c>l))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var d=-1,p=!0,f=2&n?new Wn:i;for(s.set(e,t),s.set(t,e);++d<l;){var m=e[d],g=t[d];if(r)var y=a?r(g,m,d,t,e,s):r(m,g,d,e,t,s);if(y!==i){if(y)continue;p=!1;break}if(f){if(!Nt(t,(function(e,t){if(!Kt(f,t)&&(m===e||o(m,e,n,r,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!o(m,g,n,r,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function Qi(e){return Io(Mo(e,i,Ho),e+"")}function eo(e){return wr(e,Pa,co)}function to(e){return wr(e,Ra,uo)}var no=An?function(e){return An.get(e)}:al;function ro(e){for(var t=e.name+"",n=In[t],r=De.call(In,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function io(e){return(De.call(zn,"placeholder")?zn:e).placeholder}function oo(){var e=zn.iteratee||rl;return e=e===rl?Dr:e,arguments.length?e(arguments[0],arguments[1]):e}function so(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ao(e){for(var t=Pa(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,wo(i)]}return t}function lo(e,t){var n=function(e,t){return null==e?i:e[t]}(e,t);return Lr(n)?n:i}var co=mt?function(e){return null==e?[]:(e=Me(e),At(mt(e),(function(t){return We.call(e,t)})))}:fl,uo=mt?function(e){for(var t=[];e;)Lt(t,co(e)),e=He(e);return t}:fl,ho=Sr;function po(e,t,n){for(var r=-1,i=(t=gi(t,e)).length,o=!1;++r<i;){var s=ko(t[r]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Js(i)&&go(s,i)&&(Gs(e)||Vs(e))}function fo(e){return"function"!=typeof e.constructor||bo(e)?{}:Bn(He(e))}function mo(e){return Gs(e)||Vs(e)||!!(qe&&e&&e[qe])}function go(e,t){var n=typeof e;return!!(t=null==t?h:t)&&("number"==n||"symbol"!=n&&ye.test(e))&&e>-1&&e%1==0&&e<t}function yo(e,t,n){if(!Qs(n))return!1;var r=typeof t;return!!("number"==r?Zs(n)&&go(t,n.length):"string"==r&&t in n)&&Bs(n[t],e)}function vo(e,t){if(Gs(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!aa(e))||Q.test(e)||!J.test(e)||null!=t&&e in Me(t)}function _o(e){var t=ro(e),n=zn[t];if("function"!=typeof n||!(t in Vn.prototype))return!1;if(e===n)return!0;var r=no(n);return!!r&&e===r[0]}(wn&&ho(new wn(new ArrayBuffer(1)))!=L||Sn&&ho(new Sn)!=w||Mn&&ho(Mn.resolve())!=E||En&&ho(new En)!=C||Tn&&ho(new Tn)!=P)&&(ho=function(e){var t=Sr(e),n=t==M?e.constructor:i,r=n?Fo(n):"";if(r)switch(r){case Pn:return L;case Rn:return w;case Ln:return E;case Dn:return C;case On:return P}return t});var xo=Re?Ys:ml;function bo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Pe)}function wo(e){return e==e&&!Qs(e)}function So(e,t){return function(n){return null!=n&&n[e]===t&&(t!==i||e in Me(n))}}function Mo(e,t,n){return t=gn(t===i?e.length-1:t,0),function(){for(var i=arguments,o=-1,s=gn(i.length-t,0),a=r(s);++o<s;)a[o]=i[t+o];o=-1;for(var l=r(t+1);++o<t;)l[o]=i[o];return l[t]=n(a),St(e,this,l)}}function Eo(e,t){return t.length<2?e:br(e,ei(t,0,-1))}function To(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Co=Ro(Kr),Ao=ut||function(e,t){return ht.setTimeout(e,t)},Io=Ro(Jr);function Po(e,t,n){var r=t+"";return Io(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(oe,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Et(f,(function(n){var r="_."+n[0];t&n[1]&&!It(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(se);return t?t[1].split(ae):[]}(r),n)))}function Ro(e){var t=0,n=0;return function(){var r=vn(),o=16-(r-n);if(n=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Lo(e,t){var n=-1,r=e.length,o=r-1;for(t=t===i?r:t;++n<t;){var s=Zr(n,o),a=e[s];e[s]=e[n],e[n]=a}return e.length=t,e}var Do,Oo,No=(Do=Ds((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ee,(function(e,n,r,i){t.push(r?i.replace(ue,"$1"):n||e)})),t}),(function(e){return 500===Oo.size&&Oo.clear(),e})),Oo=Do.cache,Do);function ko(e){if("string"==typeof e||aa(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Fo(e){if(null!=e){try{return Le.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function zo(e){if(e instanceof Vn)return e.clone();var t=new jn(e.__wrapped__,e.__chain__);return t.__actions__=Ti(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Bo=$r((function(e,t){return Ws(e)?cr(e,mr(t,1,Ws,!0)):[]})),Uo=$r((function(e,t){var n=Xo(t);return Ws(n)&&(n=i),Ws(e)?cr(e,mr(t,1,Ws,!0),oo(n,2)):[]})),jo=$r((function(e,t){var n=Xo(t);return Ws(n)&&(n=i),Ws(e)?cr(e,mr(t,1,Ws,!0),i,n):[]}));function Vo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:pa(n);return i<0&&(i=gn(r+i,0)),zt(e,oo(t,3),i)}function Go(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r-1;return n!==i&&(o=pa(n),o=n<0?gn(r+o,0):yn(o,r-1)),zt(e,oo(t,3),o,!0)}function Ho(e){return null!=e&&e.length?mr(e,1):[]}function Zo(e){return e&&e.length?e[0]:i}var Wo=$r((function(e){var t=Rt(e,fi);return t.length&&t[0]===e[0]?Cr(t):[]})),$o=$r((function(e){var t=Xo(e),n=Rt(e,fi);return t===Xo(n)?t=i:n.pop(),n.length&&n[0]===e[0]?Cr(n,oo(t,2)):[]})),qo=$r((function(e){var t=Xo(e),n=Rt(e,fi);return(t="function"==typeof t?t:i)&&n.pop(),n.length&&n[0]===e[0]?Cr(n,i,t):[]}));function Xo(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Yo=$r(Ko);function Ko(e,t){return e&&e.length&&t&&t.length?Gr(e,t):e}var Jo=Qi((function(e,t){var n=null==e?0:e.length,r=ir(e,t);return Hr(e,Rt(t,(function(e){return go(e,n)?+e:e})).sort(Si)),r}));function Qo(e){return null==e?e:bn.call(e)}var es=$r((function(e){return ai(mr(e,1,Ws,!0))})),ts=$r((function(e){var t=Xo(e);return Ws(t)&&(t=i),ai(mr(e,1,Ws,!0),oo(t,2))})),ns=$r((function(e){var t=Xo(e);return t="function"==typeof t?t:i,ai(mr(e,1,Ws,!0),i,t)}));function rs(e){if(!e||!e.length)return[];var t=0;return e=At(e,(function(e){if(Ws(e))return t=gn(e.length,t),!0})),$t(t,(function(t){return Rt(e,Gt(t))}))}function is(e,t){if(!e||!e.length)return[];var n=rs(e);return null==t?n:Rt(n,(function(e){return St(t,i,e)}))}var os=$r((function(e,t){return Ws(e)?cr(e,t):[]})),ss=$r((function(e){return di(At(e,Ws))})),as=$r((function(e){var t=Xo(e);return Ws(t)&&(t=i),di(At(e,Ws),oo(t,2))})),ls=$r((function(e){var t=Xo(e);return t="function"==typeof t?t:i,di(At(e,Ws),i,t)})),cs=$r(rs),us=$r((function(e){var t=e.length,n=t>1?e[t-1]:i;return n="function"==typeof n?(e.pop(),n):i,is(e,n)}));function hs(e){var t=zn(e);return t.__chain__=!0,t}function ds(e,t){return t(e)}var ps=Qi((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,o=function(t){return ir(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Vn&&go(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:ds,args:[o],thisArg:i}),new jn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(o)})),fs=Ai((function(e,t,n){De.call(e,n)?++e[n]:rr(e,n,1)})),ms=Ni(Vo),gs=Ni(Go);function ys(e,t){return(Gs(e)?Et:ur)(e,oo(t,3))}function vs(e,t){return(Gs(e)?Tt:hr)(e,oo(t,3))}var _s=Ai((function(e,t,n){De.call(e,n)?e[n].push(t):rr(e,n,[t])})),xs=$r((function(e,t,n){var i=-1,o="function"==typeof t,s=Zs(e)?r(e.length):[];return ur(e,(function(e){s[++i]=o?St(t,e,n):Ar(e,t,n)})),s})),bs=Ai((function(e,t,n){rr(e,n,t)}));function ws(e,t){return(Gs(e)?Rt:kr)(e,oo(t,3))}var Ss=Ai((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),Ms=$r((function(e,t){if(null==e)return[];var n=t.length;return n>1&&yo(e,t[0],t[1])?t=[]:n>2&&yo(t[0],t[1],t[2])&&(t=[t[0]]),jr(e,mr(t,1),[])})),Es=ct||function(){return ht.Date.now()};function Ts(e,t,n){return t=n?i:t,t=e&&null==t?e.length:t,qi(e,c,i,i,i,i,t)}function Cs(e,t){var n;if("function"!=typeof t)throw new Ce(o);return e=pa(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=i),n}}var As=$r((function(e,t,n){var r=1;if(n.length){var i=an(n,io(As));r|=l}return qi(e,r,t,n,i)})),Is=$r((function(e,t,n){var r=3;if(n.length){var i=an(n,io(Is));r|=l}return qi(t,r,e,n,i)}));function Ps(e,t,n){var r,s,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new Ce(o);function m(t){var n=r,o=s;return r=s=i,h=t,l=e.apply(o,n)}function g(e){var n=e-u;return u===i||n>=t||n<0||p&&e-h>=a}function y(){var e=Es();if(g(e))return v(e);c=Ao(y,function(e){var n=t-(e-u);return p?yn(n,a-(e-h)):n}(e))}function v(e){return c=i,f&&r?m(e):(r=s=i,l)}function _(){var e=Es(),n=g(e);if(r=arguments,s=this,u=e,n){if(c===i)return function(e){return h=e,c=Ao(y,t),d?m(e):l}(u);if(p)return _i(c),c=Ao(y,t),m(u)}return c===i&&(c=Ao(y,t)),l}return t=ma(t)||0,Qs(n)&&(d=!!n.leading,a=(p="maxWait"in n)?gn(ma(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),_.cancel=function(){c!==i&&_i(c),h=0,r=u=s=c=i},_.flush=function(){return c===i?l:v(Es())},_}var Rs=$r((function(e,t){return lr(e,1,t)})),Ls=$r((function(e,t,n){return lr(e,ma(t)||0,n)}));function Ds(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ce(o);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(Ds.Cache||Zn),n}function Os(e){if("function"!=typeof e)throw new Ce(o);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ds.Cache=Zn;var Ns=yi((function(e,t){var n=(t=1==t.length&&Gs(t[0])?Rt(t[0],Xt(oo())):Rt(mr(t,1),Xt(oo()))).length;return $r((function(r){for(var i=-1,o=yn(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return St(e,this,r)}))})),ks=$r((function(e,t){var n=an(t,io(ks));return qi(e,l,i,t,n)})),Fs=$r((function(e,t){var n=an(t,io(Fs));return qi(e,64,i,t,n)})),zs=Qi((function(e,t){return qi(e,256,i,i,i,t)}));function Bs(e,t){return e===t||e!=e&&t!=t}var Us=Gi(Mr),js=Gi((function(e,t){return e>=t})),Vs=Ir(function(){return arguments}())?Ir:function(e){return ea(e)&&De.call(e,"callee")&&!We.call(e,"callee")},Gs=r.isArray,Hs=yt?Xt(yt):function(e){return ea(e)&&Sr(e)==R};function Zs(e){return null!=e&&Js(e.length)&&!Ys(e)}function Ws(e){return ea(e)&&Zs(e)}var $s=gt||ml,qs=vt?Xt(vt):function(e){return ea(e)&&Sr(e)==v};function Xs(e){if(!ea(e))return!1;var t=Sr(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ra(e)}function Ys(e){if(!Qs(e))return!1;var t=Sr(e);return t==x||t==b||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ks(e){return"number"==typeof e&&e==pa(e)}function Js(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=h}function Qs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ea(e){return null!=e&&"object"==typeof e}var ta=_t?Xt(_t):function(e){return ea(e)&&ho(e)==w};function na(e){return"number"==typeof e||ea(e)&&Sr(e)==S}function ra(e){if(!ea(e)||Sr(e)!=M)return!1;var t=He(e);if(null===t)return!0;var n=De.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Le.call(n)==Fe}var ia=xt?Xt(xt):function(e){return ea(e)&&Sr(e)==T},oa=bt?Xt(bt):function(e){return ea(e)&&ho(e)==C};function sa(e){return"string"==typeof e||!Gs(e)&&ea(e)&&Sr(e)==A}function aa(e){return"symbol"==typeof e||ea(e)&&Sr(e)==I}var la=wt?Xt(wt):function(e){return ea(e)&&Js(e.length)&&!!it[Sr(e)]},ca=Gi(Nr),ua=Gi((function(e,t){return e<=t}));function ha(e){if(!e)return[];if(Zs(e))return sa(e)?hn(e):Ti(e);if(Xe&&e[Xe])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Xe]());var t=ho(e);return(t==w?on:t==C?ln:Ba)(e)}function da(e){return e?(e=ma(e))===u||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function pa(e){var t=da(e),n=t%1;return t==t?n?t-n:t:0}function fa(e){return e?or(pa(e),0,p):0}function ma(e){if("number"==typeof e)return e;if(aa(e))return d;if(Qs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Qs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=qt(e);var n=fe.test(e);return n||ge.test(e)?lt(e.slice(2),n?2:8):pe.test(e)?d:+e}function ga(e){return Ci(e,Ra(e))}function ya(e){return null==e?"":si(e)}var va=Ii((function(e,t){if(bo(t)||Zs(t))Ci(t,Pa(t),e);else for(var n in t)De.call(t,n)&&Qn(e,n,t[n])})),_a=Ii((function(e,t){Ci(t,Ra(t),e)})),xa=Ii((function(e,t,n,r){Ci(t,Ra(t),e,r)})),ba=Ii((function(e,t,n,r){Ci(t,Pa(t),e,r)})),wa=Qi(ir),Sa=$r((function(e,t){e=Me(e);var n=-1,r=t.length,o=r>2?t[2]:i;for(o&&yo(t[0],t[1],o)&&(r=1);++n<r;)for(var s=t[n],a=Ra(s),l=-1,c=a.length;++l<c;){var u=a[l],h=e[u];(h===i||Bs(h,Pe[u])&&!De.call(e,u))&&(e[u]=s[u])}return e})),Ma=$r((function(e){return e.push(i,Yi),St(Da,i,e)}));function Ea(e,t,n){var r=null==e?i:br(e,t);return r===i?n:r}function Ta(e,t){return null!=e&&po(e,t,Tr)}var Ca=zi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ke.call(t)),e[t]=n}),Qa(nl)),Aa=zi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ke.call(t)),De.call(e,t)?e[t].push(n):e[t]=[n]}),oo),Ia=$r(Ar);function Pa(e){return Zs(e)?qn(e):Or(e)}function Ra(e){return Zs(e)?qn(e,!0):function(e){if(!Qs(e))return function(e){var t=[];if(null!=e)for(var n in Me(e))t.push(n);return t}(e);var t=bo(e),n=[];for(var r in e)("constructor"!=r||!t&&De.call(e,r))&&n.push(r);return n}(e)}var La=Ii((function(e,t,n){Br(e,t,n)})),Da=Ii((function(e,t,n,r){Br(e,t,n,r)})),Oa=Qi((function(e,t){var n={};if(null==e)return n;var r=!1;t=Rt(t,(function(t){return t=gi(t,e),r||(r=t.length>1),t})),Ci(e,to(e),n),r&&(n=sr(n,7,Ki));for(var i=t.length;i--;)li(n,t[i]);return n})),Na=Qi((function(e,t){return null==e?{}:function(e,t){return Vr(e,t,(function(t,n){return Ta(e,n)}))}(e,t)}));function ka(e,t){if(null==e)return{};var n=Rt(to(e),(function(e){return[e]}));return t=oo(t),Vr(e,n,(function(e,n){return t(e,n[0])}))}var Fa=$i(Pa),za=$i(Ra);function Ba(e){return null==e?[]:Yt(e,Pa(e))}var Ua=Di((function(e,t,n){return t=t.toLowerCase(),e+(n?ja(t):t)}));function ja(e){return Xa(ya(e).toLowerCase())}function Va(e){return(e=ya(e))&&e.replace(ve,en).replace(Ke,"")}var Ga=Di((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ha=Di((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Za=Li("toLowerCase"),Wa=Di((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),$a=Di((function(e,t,n){return e+(n?" ":"")+Xa(t)})),qa=Di((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Xa=Li("toUpperCase");function Ya(e,t,n){return e=ya(e),(t=n?i:t)===i?function(e){return tt.test(e)}(e)?function(e){return e.match(Qe)||[]}(e):function(e){return e.match(le)||[]}(e):e.match(t)||[]}var Ka=$r((function(e,t){try{return St(e,i,t)}catch(e){return Xs(e)?e:new be(e)}})),Ja=Qi((function(e,t){return Et(t,(function(t){t=ko(t),rr(e,t,As(e[t],e))})),e}));function Qa(e){return function(){return e}}var el=ki(),tl=ki(!0);function nl(e){return e}function rl(e){return Dr("function"==typeof e?e:sr(e,1))}var il=$r((function(e,t){return function(n){return Ar(n,e,t)}})),ol=$r((function(e,t){return function(n){return Ar(e,n,t)}}));function sl(e,t,n){var r=Pa(t),i=xr(t,r);null!=n||Qs(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=xr(t,Pa(t)));var o=!(Qs(n)&&"chain"in n&&!n.chain),s=Ys(e);return Et(i,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=Ti(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Lt([this.value()],arguments))})})),e}function al(){}var ll=Ui(Rt),cl=Ui(Ct),ul=Ui(Nt);function hl(e){return vo(e)?Gt(ko(e)):function(e){return function(t){return br(t,e)}}(e)}var dl=Vi(),pl=Vi(!0);function fl(){return[]}function ml(){return!1}var gl,yl=Bi((function(e,t){return e+t}),0),vl=Zi("ceil"),_l=Bi((function(e,t){return e/t}),1),xl=Zi("floor"),bl=Bi((function(e,t){return e*t}),1),wl=Zi("round"),Sl=Bi((function(e,t){return e-t}),0);return zn.after=function(e,t){if("function"!=typeof t)throw new Ce(o);return e=pa(e),function(){if(--e<1)return t.apply(this,arguments)}},zn.ary=Ts,zn.assign=va,zn.assignIn=_a,zn.assignInWith=xa,zn.assignWith=ba,zn.at=wa,zn.before=Cs,zn.bind=As,zn.bindAll=Ja,zn.bindKey=Is,zn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Gs(e)?e:[e]},zn.chain=hs,zn.chunk=function(e,t,n){t=(n?yo(e,t,n):t===i)?1:gn(pa(t),0);var o=null==e?0:e.length;if(!o||t<1)return[];for(var s=0,a=0,l=r(dt(o/t));s<o;)l[a++]=ei(e,s,s+=t);return l},zn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},zn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Lt(Gs(n)?Ti(n):[n],mr(t,1))},zn.cond=function(e){var t=null==e?0:e.length,n=oo();return e=t?Rt(e,(function(e){if("function"!=typeof e[1])throw new Ce(o);return[n(e[0]),e[1]]})):[],$r((function(n){for(var r=-1;++r<t;){var i=e[r];if(St(i[0],this,n))return St(i[1],this,n)}}))},zn.conforms=function(e){return function(e){var t=Pa(e);return function(n){return ar(n,e,t)}}(sr(e,1))},zn.constant=Qa,zn.countBy=fs,zn.create=function(e,t){var n=Bn(e);return null==t?n:nr(n,t)},zn.curry=function e(t,n,r){var o=qi(t,8,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},zn.curryRight=function e(t,n,r){var o=qi(t,16,i,i,i,i,i,n=r?i:n);return o.placeholder=e.placeholder,o},zn.debounce=Ps,zn.defaults=Sa,zn.defaultsDeep=Ma,zn.defer=Rs,zn.delay=Ls,zn.difference=Bo,zn.differenceBy=Uo,zn.differenceWith=jo,zn.drop=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,(t=n||t===i?1:pa(t))<0?0:t,r):[]},zn.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,0,(t=r-(t=n||t===i?1:pa(t)))<0?0:t):[]},zn.dropRightWhile=function(e,t){return e&&e.length?ui(e,oo(t,3),!0,!0):[]},zn.dropWhile=function(e,t){return e&&e.length?ui(e,oo(t,3),!0):[]},zn.fill=function(e,t,n,r){var o=null==e?0:e.length;return o?(n&&"number"!=typeof n&&yo(e,t,n)&&(n=0,r=o),function(e,t,n,r){var o=e.length;for((n=pa(n))<0&&(n=-n>o?0:o+n),(r=r===i||r>o?o:pa(r))<0&&(r+=o),r=n>r?0:fa(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},zn.filter=function(e,t){return(Gs(e)?At:fr)(e,oo(t,3))},zn.flatMap=function(e,t){return mr(ws(e,t),1)},zn.flatMapDeep=function(e,t){return mr(ws(e,t),u)},zn.flatMapDepth=function(e,t,n){return n=n===i?1:pa(n),mr(ws(e,t),n)},zn.flatten=Ho,zn.flattenDeep=function(e){return null!=e&&e.length?mr(e,u):[]},zn.flattenDepth=function(e,t){return null!=e&&e.length?mr(e,t=t===i?1:pa(t)):[]},zn.flip=function(e){return qi(e,512)},zn.flow=el,zn.flowRight=tl,zn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},zn.functions=function(e){return null==e?[]:xr(e,Pa(e))},zn.functionsIn=function(e){return null==e?[]:xr(e,Ra(e))},zn.groupBy=_s,zn.initial=function(e){return null!=e&&e.length?ei(e,0,-1):[]},zn.intersection=Wo,zn.intersectionBy=$o,zn.intersectionWith=qo,zn.invert=Ca,zn.invertBy=Aa,zn.invokeMap=xs,zn.iteratee=rl,zn.keyBy=bs,zn.keys=Pa,zn.keysIn=Ra,zn.map=ws,zn.mapKeys=function(e,t){var n={};return t=oo(t,3),vr(e,(function(e,r,i){rr(n,t(e,r,i),e)})),n},zn.mapValues=function(e,t){var n={};return t=oo(t,3),vr(e,(function(e,r,i){rr(n,r,t(e,r,i))})),n},zn.matches=function(e){return Fr(sr(e,1))},zn.matchesProperty=function(e,t){return zr(e,sr(t,1))},zn.memoize=Ds,zn.merge=La,zn.mergeWith=Da,zn.method=il,zn.methodOf=ol,zn.mixin=sl,zn.negate=Os,zn.nthArg=function(e){return e=pa(e),$r((function(t){return Ur(t,e)}))},zn.omit=Oa,zn.omitBy=function(e,t){return ka(e,Os(oo(t)))},zn.once=function(e){return Cs(2,e)},zn.orderBy=function(e,t,n,r){return null==e?[]:(Gs(t)||(t=null==t?[]:[t]),Gs(n=r?i:n)||(n=null==n?[]:[n]),jr(e,t,n))},zn.over=ll,zn.overArgs=Ns,zn.overEvery=cl,zn.overSome=ul,zn.partial=ks,zn.partialRight=Fs,zn.partition=Ss,zn.pick=Na,zn.pickBy=ka,zn.property=hl,zn.propertyOf=function(e){return function(t){return null==e?i:br(e,t)}},zn.pull=Yo,zn.pullAll=Ko,zn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Gr(e,t,oo(n,2)):e},zn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Gr(e,t,i,n):e},zn.pullAt=Jo,zn.range=dl,zn.rangeRight=pl,zn.rearg=zs,zn.reject=function(e,t){return(Gs(e)?At:fr)(e,Os(oo(t,3)))},zn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=oo(t,3);++r<o;){var s=e[r];t(s,r,e)&&(n.push(s),i.push(r))}return Hr(e,i),n},zn.rest=function(e,t){if("function"!=typeof e)throw new Ce(o);return $r(e,t=t===i?t:pa(t))},zn.reverse=Qo,zn.sampleSize=function(e,t,n){return t=(n?yo(e,t,n):t===i)?1:pa(t),(Gs(e)?Yn:Xr)(e,t)},zn.set=function(e,t,n){return null==e?e:Yr(e,t,n)},zn.setWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:Yr(e,t,n,r)},zn.shuffle=function(e){return(Gs(e)?Kn:Qr)(e)},zn.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&yo(e,t,n)?(t=0,n=r):(t=null==t?0:pa(t),n=n===i?r:pa(n)),ei(e,t,n)):[]},zn.sortBy=Ms,zn.sortedUniq=function(e){return e&&e.length?ii(e):[]},zn.sortedUniqBy=function(e,t){return e&&e.length?ii(e,oo(t,2)):[]},zn.split=function(e,t,n){return n&&"number"!=typeof n&&yo(e,t,n)&&(t=n=i),(n=n===i?p:n>>>0)?(e=ya(e))&&("string"==typeof t||null!=t&&!ia(t))&&!(t=si(t))&&rn(e)?vi(hn(e),0,n):e.split(t,n):[]},zn.spread=function(e,t){if("function"!=typeof e)throw new Ce(o);return t=null==t?0:gn(pa(t),0),$r((function(n){var r=n[t],i=vi(n,0,t);return r&&Lt(i,r),St(e,this,i)}))},zn.tail=function(e){var t=null==e?0:e.length;return t?ei(e,1,t):[]},zn.take=function(e,t,n){return e&&e.length?ei(e,0,(t=n||t===i?1:pa(t))<0?0:t):[]},zn.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?ei(e,(t=r-(t=n||t===i?1:pa(t)))<0?0:t,r):[]},zn.takeRightWhile=function(e,t){return e&&e.length?ui(e,oo(t,3),!1,!0):[]},zn.takeWhile=function(e,t){return e&&e.length?ui(e,oo(t,3)):[]},zn.tap=function(e,t){return t(e),e},zn.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Ce(o);return Qs(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Ps(e,t,{leading:r,maxWait:t,trailing:i})},zn.thru=ds,zn.toArray=ha,zn.toPairs=Fa,zn.toPairsIn=za,zn.toPath=function(e){return Gs(e)?Rt(e,ko):aa(e)?[e]:Ti(No(ya(e)))},zn.toPlainObject=ga,zn.transform=function(e,t,n){var r=Gs(e),i=r||$s(e)||la(e);if(t=oo(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:Qs(e)&&Ys(o)?Bn(He(e)):{}}return(i?Et:vr)(e,(function(e,r,i){return t(n,e,r,i)})),n},zn.unary=function(e){return Ts(e,1)},zn.union=es,zn.unionBy=ts,zn.unionWith=ns,zn.uniq=function(e){return e&&e.length?ai(e):[]},zn.uniqBy=function(e,t){return e&&e.length?ai(e,oo(t,2)):[]},zn.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?ai(e,i,t):[]},zn.unset=function(e,t){return null==e||li(e,t)},zn.unzip=rs,zn.unzipWith=is,zn.update=function(e,t,n){return null==e?e:ci(e,t,mi(n))},zn.updateWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:ci(e,t,mi(n),r)},zn.values=Ba,zn.valuesIn=function(e){return null==e?[]:Yt(e,Ra(e))},zn.without=os,zn.words=Ya,zn.wrap=function(e,t){return ks(mi(t),e)},zn.xor=ss,zn.xorBy=as,zn.xorWith=ls,zn.zip=cs,zn.zipObject=function(e,t){return pi(e||[],t||[],Qn)},zn.zipObjectDeep=function(e,t){return pi(e||[],t||[],Yr)},zn.zipWith=us,zn.entries=Fa,zn.entriesIn=za,zn.extend=_a,zn.extendWith=xa,sl(zn,zn),zn.add=yl,zn.attempt=Ka,zn.camelCase=Ua,zn.capitalize=ja,zn.ceil=vl,zn.clamp=function(e,t,n){return n===i&&(n=t,t=i),n!==i&&(n=(n=ma(n))==n?n:0),t!==i&&(t=(t=ma(t))==t?t:0),or(ma(e),t,n)},zn.clone=function(e){return sr(e,4)},zn.cloneDeep=function(e){return sr(e,5)},zn.cloneDeepWith=function(e,t){return sr(e,5,t="function"==typeof t?t:i)},zn.cloneWith=function(e,t){return sr(e,4,t="function"==typeof t?t:i)},zn.conformsTo=function(e,t){return null==t||ar(e,t,Pa(t))},zn.deburr=Va,zn.defaultTo=function(e,t){return null==e||e!=e?t:e},zn.divide=_l,zn.endsWith=function(e,t,n){e=ya(e),t=si(t);var r=e.length,o=n=n===i?r:or(pa(n),0,r);return(n-=t.length)>=0&&e.slice(n,o)==t},zn.eq=Bs,zn.escape=function(e){return(e=ya(e))&&q.test(e)?e.replace(W,tn):e},zn.escapeRegExp=function(e){return(e=ya(e))&&ne.test(e)?e.replace(te,"\\$&"):e},zn.every=function(e,t,n){var r=Gs(e)?Ct:dr;return n&&yo(e,t,n)&&(t=i),r(e,oo(t,3))},zn.find=ms,zn.findIndex=Vo,zn.findKey=function(e,t){return Ft(e,oo(t,3),vr)},zn.findLast=gs,zn.findLastIndex=Go,zn.findLastKey=function(e,t){return Ft(e,oo(t,3),_r)},zn.floor=xl,zn.forEach=ys,zn.forEachRight=vs,zn.forIn=function(e,t){return null==e?e:gr(e,oo(t,3),Ra)},zn.forInRight=function(e,t){return null==e?e:yr(e,oo(t,3),Ra)},zn.forOwn=function(e,t){return e&&vr(e,oo(t,3))},zn.forOwnRight=function(e,t){return e&&_r(e,oo(t,3))},zn.get=Ea,zn.gt=Us,zn.gte=js,zn.has=function(e,t){return null!=e&&po(e,t,Er)},zn.hasIn=Ta,zn.head=Zo,zn.identity=nl,zn.includes=function(e,t,n,r){e=Zs(e)?e:Ba(e),n=n&&!r?pa(n):0;var i=e.length;return n<0&&(n=gn(i+n,0)),sa(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Bt(e,t,n)>-1},zn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:pa(n);return i<0&&(i=gn(r+i,0)),Bt(e,t,i)},zn.inRange=function(e,t,n){return t=da(t),n===i?(n=t,t=0):n=da(n),function(e,t,n){return e>=yn(t,n)&&e<gn(t,n)}(e=ma(e),t,n)},zn.invoke=Ia,zn.isArguments=Vs,zn.isArray=Gs,zn.isArrayBuffer=Hs,zn.isArrayLike=Zs,zn.isArrayLikeObject=Ws,zn.isBoolean=function(e){return!0===e||!1===e||ea(e)&&Sr(e)==y},zn.isBuffer=$s,zn.isDate=qs,zn.isElement=function(e){return ea(e)&&1===e.nodeType&&!ra(e)},zn.isEmpty=function(e){if(null==e)return!0;if(Zs(e)&&(Gs(e)||"string"==typeof e||"function"==typeof e.splice||$s(e)||la(e)||Vs(e)))return!e.length;var t=ho(e);if(t==w||t==C)return!e.size;if(bo(e))return!Or(e).length;for(var n in e)if(De.call(e,n))return!1;return!0},zn.isEqual=function(e,t){return Pr(e,t)},zn.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:i)?n(e,t):i;return r===i?Pr(e,t,i,n):!!r},zn.isError=Xs,zn.isFinite=function(e){return"number"==typeof e&&kt(e)},zn.isFunction=Ys,zn.isInteger=Ks,zn.isLength=Js,zn.isMap=ta,zn.isMatch=function(e,t){return e===t||Rr(e,t,ao(t))},zn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:i,Rr(e,t,ao(t),n)},zn.isNaN=function(e){return na(e)&&e!=+e},zn.isNative=function(e){if(xo(e))throw new be("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Lr(e)},zn.isNil=function(e){return null==e},zn.isNull=function(e){return null===e},zn.isNumber=na,zn.isObject=Qs,zn.isObjectLike=ea,zn.isPlainObject=ra,zn.isRegExp=ia,zn.isSafeInteger=function(e){return Ks(e)&&e>=-9007199254740991&&e<=h},zn.isSet=oa,zn.isString=sa,zn.isSymbol=aa,zn.isTypedArray=la,zn.isUndefined=function(e){return e===i},zn.isWeakMap=function(e){return ea(e)&&ho(e)==P},zn.isWeakSet=function(e){return ea(e)&&"[object WeakSet]"==Sr(e)},zn.join=function(e,t){return null==e?"":Ht.call(e,t)},zn.kebabCase=Ga,zn.last=Xo,zn.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r;return n!==i&&(o=(o=pa(n))<0?gn(r+o,0):yn(o,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,o):zt(e,jt,o,!0)},zn.lowerCase=Ha,zn.lowerFirst=Za,zn.lt=ca,zn.lte=ua,zn.max=function(e){return e&&e.length?pr(e,nl,Mr):i},zn.maxBy=function(e,t){return e&&e.length?pr(e,oo(t,2),Mr):i},zn.mean=function(e){return Vt(e,nl)},zn.meanBy=function(e,t){return Vt(e,oo(t,2))},zn.min=function(e){return e&&e.length?pr(e,nl,Nr):i},zn.minBy=function(e,t){return e&&e.length?pr(e,oo(t,2),Nr):i},zn.stubArray=fl,zn.stubFalse=ml,zn.stubObject=function(){return{}},zn.stubString=function(){return""},zn.stubTrue=function(){return!0},zn.multiply=bl,zn.nth=function(e,t){return e&&e.length?Ur(e,pa(t)):i},zn.noConflict=function(){return ht._===this&&(ht._=ze),this},zn.noop=al,zn.now=Es,zn.pad=function(e,t,n){e=ya(e);var r=(t=pa(t))?un(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return ji(pt(i),n)+e+ji(dt(i),n)},zn.padEnd=function(e,t,n){e=ya(e);var r=(t=pa(t))?un(e):0;return t&&r<t?e+ji(t-r,n):e},zn.padStart=function(e,t,n){e=ya(e);var r=(t=pa(t))?un(e):0;return t&&r<t?ji(t-r,n)+e:e},zn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),_n(ya(e).replace(re,""),t||0)},zn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&yo(e,t,n)&&(t=n=i),n===i&&("boolean"==typeof t?(n=t,t=i):"boolean"==typeof e&&(n=e,e=i)),e===i&&t===i?(e=0,t=1):(e=da(e),t===i?(t=e,e=0):t=da(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var o=xn();return yn(e+o*(t-e+at("1e-"+((o+"").length-1))),t)}return Zr(e,t)},zn.reduce=function(e,t,n){var r=Gs(e)?Dt:Zt,i=arguments.length<3;return r(e,oo(t,4),n,i,ur)},zn.reduceRight=function(e,t,n){var r=Gs(e)?Ot:Zt,i=arguments.length<3;return r(e,oo(t,4),n,i,hr)},zn.repeat=function(e,t,n){return t=(n?yo(e,t,n):t===i)?1:pa(t),Wr(ya(e),t)},zn.replace=function(){var e=arguments,t=ya(e[0]);return e.length<3?t:t.replace(e[1],e[2])},zn.result=function(e,t,n){var r=-1,o=(t=gi(t,e)).length;for(o||(o=1,e=i);++r<o;){var s=null==e?i:e[ko(t[r])];s===i&&(r=o,s=n),e=Ys(s)?s.call(e):s}return e},zn.round=wl,zn.runInContext=e,zn.sample=function(e){return(Gs(e)?Xn:qr)(e)},zn.size=function(e){if(null==e)return 0;if(Zs(e))return sa(e)?un(e):e.length;var t=ho(e);return t==w||t==C?e.size:Or(e).length},zn.snakeCase=Wa,zn.some=function(e,t,n){var r=Gs(e)?Nt:ti;return n&&yo(e,t,n)&&(t=i),r(e,oo(t,3))},zn.sortedIndex=function(e,t){return ni(e,t)},zn.sortedIndexBy=function(e,t,n){return ri(e,t,oo(n,2))},zn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=ni(e,t);if(r<n&&Bs(e[r],t))return r}return-1},zn.sortedLastIndex=function(e,t){return ni(e,t,!0)},zn.sortedLastIndexBy=function(e,t,n){return ri(e,t,oo(n,2),!0)},zn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=ni(e,t,!0)-1;if(Bs(e[n],t))return n}return-1},zn.startCase=$a,zn.startsWith=function(e,t,n){return e=ya(e),n=null==n?0:or(pa(n),0,e.length),t=si(t),e.slice(n,n+t.length)==t},zn.subtract=Sl,zn.sum=function(e){return e&&e.length?Wt(e,nl):0},zn.sumBy=function(e,t){return e&&e.length?Wt(e,oo(t,2)):0},zn.template=function(e,t,n){var r=zn.templateSettings;n&&yo(e,t,n)&&(t=i),e=ya(e),t=xa({},t,r,Xi);var o,s,a=xa({},t.imports,r.imports,Xi),l=Pa(a),c=Yt(a,l),u=0,h=t.interpolate||_e,d="__p += '",p=Ee((t.escape||_e).source+"|"+h.source+"|"+(h===K?he:_e).source+"|"+(t.evaluate||_e).source+"|$","g"),f="//# sourceURL="+(De.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";e.replace(p,(function(t,n,r,i,a,l){return r||(r=i),d+=e.slice(u,l).replace(xe,nn),n&&(o=!0,d+="' +\n__e("+n+") +\n'"),a&&(s=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),d+="';\n";var m=De.call(t,"variable")&&t.variable;if(m){if(ce.test(m))throw new be("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(V,""):d).replace(G,"$1").replace(H,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Ka((function(){return we(l,f+"return "+d).apply(i,c)}));if(g.source=d,Xs(g))throw g;return g},zn.times=function(e,t){if((e=pa(e))<1||e>h)return[];var n=p,r=yn(e,p);t=oo(t),e-=p;for(var i=$t(r,t);++n<e;)t(n);return i},zn.toFinite=da,zn.toInteger=pa,zn.toLength=fa,zn.toLower=function(e){return ya(e).toLowerCase()},zn.toNumber=ma,zn.toSafeInteger=function(e){return e?or(pa(e),-9007199254740991,h):0===e?e:0},zn.toString=ya,zn.toUpper=function(e){return ya(e).toUpperCase()},zn.trim=function(e,t,n){if((e=ya(e))&&(n||t===i))return qt(e);if(!e||!(t=si(t)))return e;var r=hn(e),o=hn(t);return vi(r,Jt(r,o),Qt(r,o)+1).join("")},zn.trimEnd=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.slice(0,dn(e)+1);if(!e||!(t=si(t)))return e;var r=hn(e);return vi(r,0,Qt(r,hn(t))+1).join("")},zn.trimStart=function(e,t,n){if((e=ya(e))&&(n||t===i))return e.replace(re,"");if(!e||!(t=si(t)))return e;var r=hn(e);return vi(r,Jt(r,hn(t))).join("")},zn.truncate=function(e,t){var n=30,r="...";if(Qs(t)){var o="separator"in t?t.separator:o;n="length"in t?pa(t.length):n,r="omission"in t?si(t.omission):r}var s=(e=ya(e)).length;if(rn(e)){var a=hn(e);s=a.length}if(n>=s)return e;var l=n-un(r);if(l<1)return r;var c=a?vi(a,0,l).join(""):e.slice(0,l);if(o===i)return c+r;if(a&&(l+=c.length-l),ia(o)){if(e.slice(l).search(o)){var u,h=c;for(o.global||(o=Ee(o.source,ya(de.exec(o))+"g")),o.lastIndex=0;u=o.exec(h);)var d=u.index;c=c.slice(0,d===i?l:d)}}else if(e.indexOf(si(o),l)!=l){var p=c.lastIndexOf(o);p>-1&&(c=c.slice(0,p))}return c+r},zn.unescape=function(e){return(e=ya(e))&&$.test(e)?e.replace(Z,pn):e},zn.uniqueId=function(e){var t=++Oe;return ya(e)+t},zn.upperCase=qa,zn.upperFirst=Xa,zn.each=ys,zn.eachRight=vs,zn.first=Zo,sl(zn,(gl={},vr(zn,(function(e,t){De.call(zn.prototype,t)||(gl[t]=e)})),gl),{chain:!1}),zn.VERSION="4.17.21",Et(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){zn[e].placeholder=zn})),Et(["drop","take"],(function(e,t){Vn.prototype[e]=function(n){n=n===i?1:gn(pa(n),0);var r=this.__filtered__&&!t?new Vn(this):this.clone();return r.__filtered__?r.__takeCount__=yn(n,r.__takeCount__):r.__views__.push({size:yn(n,p),type:e+(r.__dir__<0?"Right":"")}),r},Vn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Et(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Vn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:oo(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),Et(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Vn.prototype[e]=function(){return this[n](1).value()[0]}})),Et(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Vn.prototype[e]=function(){return this.__filtered__?new Vn(this):this[n](1)}})),Vn.prototype.compact=function(){return this.filter(nl)},Vn.prototype.find=function(e){return this.filter(e).head()},Vn.prototype.findLast=function(e){return this.reverse().find(e)},Vn.prototype.invokeMap=$r((function(e,t){return"function"==typeof e?new Vn(this):this.map((function(n){return Ar(n,e,t)}))})),Vn.prototype.reject=function(e){return this.filter(Os(oo(e)))},Vn.prototype.slice=function(e,t){e=pa(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Vn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==i&&(n=(t=pa(t))<0?n.dropRight(-t):n.take(t-e)),n)},Vn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Vn.prototype.toArray=function(){return this.take(p)},vr(Vn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),o=zn[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);o&&(zn.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,l=t instanceof Vn,c=a[0],u=l||Gs(t),h=function(e){var t=o.apply(zn,Lt([e],a));return r&&d?t[0]:t};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&u){t=m?t:new Vn(this);var g=e.apply(t,a);return g.__actions__.push({func:ds,args:[h],thisArg:i}),new jn(g,d)}return f&&m?e.apply(this,a):(g=this.thru(h),f?r?g.value()[0]:g.value():g)})})),Et(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ae[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);zn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Gs(i)?i:[],e)}return this[n]((function(n){return t.apply(Gs(n)?n:[],e)}))}})),vr(Vn.prototype,(function(e,t){var n=zn[t];if(n){var r=n.name+"";De.call(In,r)||(In[r]=[]),In[r].push({name:t,func:n})}})),In[Fi(i,2).name]=[{name:"wrapper",func:i}],Vn.prototype.clone=function(){var e=new Vn(this.__wrapped__);return e.__actions__=Ti(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ti(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ti(this.__views__),e},Vn.prototype.reverse=function(){if(this.__filtered__){var e=new Vn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Vn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Gs(e),r=t<0,i=n?e.length:0,o=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=yn(t,e+s);break;case"takeRight":e=gn(e,t-s)}}return{start:e,end:t}}(0,i,this.__views__),s=o.start,a=o.end,l=a-s,c=r?a:s-1,u=this.__iteratees__,h=u.length,d=0,p=yn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return hi(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[c+=t];++m<h;){var y=u[m],v=y.iteratee,_=y.type,x=v(g);if(2==_)g=x;else if(!x){if(1==_)continue e;break e}}f[d++]=g}return f},zn.prototype.at=ps,zn.prototype.chain=function(){return hs(this)},zn.prototype.commit=function(){return new jn(this.value(),this.__chain__)},zn.prototype.next=function(){this.__values__===i&&(this.__values__=ha(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},zn.prototype.plant=function(e){for(var t,n=this;n instanceof Un;){var r=zo(n);r.__index__=0,r.__values__=i,t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t},zn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Vn){var t=e;return this.__actions__.length&&(t=new Vn(this)),(t=t.reverse()).__actions__.push({func:ds,args:[Qo],thisArg:i}),new jn(t,this.__chain__)}return this.thru(Qo)},zn.prototype.toJSON=zn.prototype.valueOf=zn.prototype.value=function(){return hi(this.__wrapped__,this.__actions__)},zn.prototype.first=zn.prototype.head,Xe&&(zn.prototype[Xe]=function(){return this}),zn}();ht._=fn,(r=function(){return fn}.call(t,n,t,e))===i||(e.exports=r)}.call(this)},1843:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,i){for(var o,s,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))n.call(o,c)&&(a[c]=o[c]);if(t){s=t(o);for(var u=0;u<s.length;u++)r.call(o,s[u])&&(a[s[u]]=o[s[u]])}}return a}},4091:e=>{"use strict";var t=function(e){return e!=e};e.exports=function(e,n){return 0===e&&0===n?1/e==1/n:e===n||!(!t(e)||!t(n))}},8199:(e,t,n)=>{"use strict";var r=n(9959),i=n(9962),o=n(4091),s=n(4584),a=n(8229),l=i(s(),Object);r(l,{getPolyfill:s,implementation:o,shim:a}),e.exports=l},4584:(e,t,n)=>{"use strict";var r=n(4091);e.exports=function(){return"function"==typeof Object.is?Object.is:r}},8229:(e,t,n)=>{"use strict";var r=n(4584),i=n(9959);e.exports=function(){var e=r();return i(Object,{is:e},{is:function(){return Object.is!==e}}),e}},2782:(e,t,n)=>{"use strict";var r;if(!Object.keys){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=n(2950),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&i.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();r=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===o.call(e),r=s(e),a=t&&"[object String]"===o.call(e),d=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var f=c&&n;if(a&&e.length>0&&!i.call(e,0))for(var m=0;m<e.length;++m)d.push(String(m));if(r&&e.length>0)for(var g=0;g<e.length;++g)d.push(String(g));else for(var y in e)f&&"prototype"===y||!i.call(e,y)||d.push(String(y));if(l)for(var v=function(e){if("undefined"==typeof window||!p)return h(e);try{return h(e)}catch(e){return!1}}(e),_=0;_<u.length;++_)v&&"constructor"===u[_]||!i.call(e,u[_])||d.push(u[_]);return d}}e.exports=r},6328:(e,t,n)=>{"use strict";var r=Array.prototype.slice,i=n(2950),o=Object.keys,s=o?function(e){return o(e)}:n(2782),a=Object.keys;s.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return i(e)?a(r.call(e)):a(e)})}else Object.keys=s;return Object.keys||s},e.exports=s},2950:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),r="[object Arguments]"===n;return r||(r="[object Array]"!==n&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),r}},2885:e=>{e.exports=function(e,t,n,r){var i=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===r&&(r=t.length);for(var a=(r-n)/2,l=0,c=a-1;l<a;c=l++){var u=t[n+2*l+0],h=t[n+2*l+1],d=t[n+2*c+0],p=t[n+2*c+1];h>o!=p>o&&i<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},3826:(e,t,n)=>{var r=n(2885),i=n(4672);e.exports=function(e,t,n,o){return t.length>0&&Array.isArray(t[0])?i(e,t,n,o):r(e,t,n,o)},e.exports.nested=i,e.exports.flat=r},4672:e=>{e.exports=function(e,t,n,r){var i=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===r&&(r=t.length);for(var a=r-n,l=0,c=a-1;l<a;c=l++){var u=t[l+n][0],h=t[l+n][1],d=t[c+n][0],p=t[c+n][1];h>o!=p>o&&i<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},906:function(e){e.exports=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}var r=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n){for(var i=new r(null,null),o=i,s=i;;){var a=n(e,t.key);if(a<0){if(null===t.left)break;if(n(e,t.left.key)<0){var l=t.left;if(t.left=l.right,l.right=t,null===(t=l).left)break}s.left=t,s=t,t=t.left}else{if(!(a>0))break;if(null===t.right)break;if(n(e,t.right.key)>0&&(l=t.right,t.right=l.left,l.left=t,null===(t=l).right))break;o.right=t,o=t,t=t.right}}return o.right=t.left,s.left=t.right,t.left=i.right,t.right=i.left,t}function s(e,t,n,i){var s=new r(e,t);if(null===n)return s.left=s.right=null,s;var a=i(e,(n=o(e,n,i)).key);return a<0?(s.left=n.left,s.right=n,n.left=null):a>=0&&(s.right=n.right,s.left=n,n.right=null),s}function a(e,t,n){var r=null,i=null;if(t){var s=n((t=o(e,t,n)).key,e);0===s?(r=t.left,i=t.right):s<0?(i=t.right,t.right=null,r=t):(r=t.left,t.left=null,i=t)}return{left:r,right:i}}function l(e,t,n,r,i){if(e){r(t+(n?" ":" ")+i(e)+"\n");var o=t+(n?"    ":"   ");e.left&&l(e.left,o,!1,r,i),e.right&&l(e.right,o,!0,r,i)}}var c=function(){function e(e){void 0===e&&(e=i),this._root=null,this._size=0,this._comparator=e}return e.prototype.insert=function(e,t){return this._size++,this._root=s(e,t,this._root,this._comparator)},e.prototype.add=function(e,t){var n=new r(e,t);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,s=o(e,this._root,i),a=i(e,s.key);return 0===a?this._root=s:(a<0?(n.left=s.left,n.right=s,s.left=null):a>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},e.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=o(e,t,n)).key)?(null===t.left?r=t.right:(r=o(e,t.left,n)).right=t.right,this._size--,r):t},e.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=o(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},e.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},e.prototype.find=function(e){return this._root&&(this._root=o(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},e.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},e.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},e.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(o((s=i.pop()).key,t)>0)break;if(o(s.key,e)>=0&&n.call(r,s))return this;s=s.right}return this},e.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},e.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},e.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},e.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},e.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return function(e){for(var t=e,n=[],i=!1,o=new r(null,null),s=o;!i;)t?(n.push(t),t=t.left):n.length>0?t=(t=s=s.next=n.pop()).right:i=!0;return s.next=null,o.next}(this._root)},e.prototype.load=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n=!1);var i=e.length,o=this._comparator;if(n&&d(e,t,0,i-1,o),null===this._root)this._root=u(e,t,0,i),this._size=i;else{var s=function(e,t,n){for(var i=new r(null,null),o=i,s=e,a=t;null!==s&&null!==a;)n(s.key,a.key)<0?(o.next=s,s=s.next):(o.next=a,a=a.next),o=o.next;return null!==s?o.next=s:null!==a&&(o.next=a),i.next}(this.toList(),function(e,t){for(var n=new r(null,null),i=n,o=0;o<e.length;o++)i=i.next=new r(e[o],t[o]);return i.next=null,n.next}(e,t),o);i=this._size+i,this._root=h({head:s},0,i)}return this},e.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return l(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},e.prototype.update=function(e,t,n){var r=this._comparator,i=a(e,this._root,r),l=i.left,c=i.right;r(e,t)<0?c=s(t,n,c,r):l=s(t,n,l,r),this._root=function(e,t,n){return null===t?e:(null===e||((t=o(e.key,t,n)).left=e),t)}(l,c,r)},e.prototype.split=function(e){return a(e,this._root,this._comparator)},e}();function u(e,t,n,i){var o=i-n;if(o>0){var s=n+Math.floor(o/2),a=e[s],l=t[s],c=new r(a,l);return c.left=u(e,t,n,s),c.right=u(e,t,s+1,i),c}return null}function h(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),o=h(e,t,i),s=e.head;return s.left=o,e.head=e.head.next,s.right=h(e,i+1,n),s}return null}function d(e,t,n,r,i){if(!(n>=r)){for(var o=e[n+r>>1],s=n-1,a=r+1;;){do{s++}while(i(e[s],o)<0);do{a--}while(i(e[a],o)>0);if(s>=a)break;var l=e[s];e[s]=e[a],e[a]=l,l=t[s],t[s]=t[a],t[a]=l}d(e,t,n,a,i),d(e,t,a+1,r,i)}}var p=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},f=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},m=Number.EPSILON;void 0===m&&(m=Math.pow(2,-52));var g=m*m,y=function(e,t){if(-m<e&&e<m&&-m<t&&t<m)return 0;var n=e-t;return n*n<g*e*t?0:e<t?-1:1},v=function(){function t(){e(this,t),this.reset()}return n(t,[{key:"reset",value:function(){this.xRounder=new _,this.yRounder=new _}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),t}(),_=function(){function t(){e(this,t),this.tree=new c,this.round(0)}return n(t,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===y(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===y(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),t}(),x=new v,b=function(e,t){return e.x*t.y-e.y*t.x},w=function(e,t){return e.x*t.x+e.y*t.y},S=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},o=b(r,i);return y(o,0)},M=function(e){return Math.sqrt(w(e,e))},E=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return w(i,r)/M(i)/M(r)},T=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},C=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},A=function(){function t(n,r){e(this,t),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:P.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),n(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,s,a,l,c=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,s=c.point,a={x:o.x-i.x,y:o.y-i.y},l={x:s.x-i.x,y:s.y-i.y},b(l,a)/M(l)/M(a)),cosine:E(t.point,e.point,c.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,s=i.cosine,a=n.get(t),l=a.sine,c=a.cosine;return o>=0&&l>=0?s<c?1:s>c?-1:0:o<0&&l<0?s<c?-1:s>c?1:0:l<o?-1:l>o?1:0}}}]),t}(),I=0,P=function(){function t(n,r,i,o){e(this,t),this.id=++I,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(t,null,[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=e.leftSE.point.y,a=t.leftSE.point.y,l=e.rightSE.point.y,c=t.rightSE.point.y;if(n<r){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;var u=e.comparePoint(t.leftSE.point);if(u<0)return 1;if(u>0)return-1;var h=t.comparePoint(e.rightSE.point);return 0!==h?h:-1}if(n>r){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;var d=t.comparePoint(e.leftSE.point);if(0!==d)return d;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(i<o){var f=t.comparePoint(e.rightSE.point);if(0!==f)return f}if(i>o){var m=e.comparePoint(t.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(i!==o){var g=l-s,y=i-n,v=c-a,_=o-r;if(g>y&&v<_)return 1;if(g<y&&v>_)return-1}return i>o?1:i<o||l<c?-1:l>c?1:e.id<t.id?-1:e.id>t.id?1:0}}]),n(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var s=(e.x-t.x)/r.x,a=t.y+s*r.y;return e.y===a?0:e.y<a?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=f(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=e.leftSE.point,a=e.rightSE.point,l=p(t,s)&&0===this.comparePoint(s),c=p(n,i)&&0===e.comparePoint(i),u=p(t,a)&&0===this.comparePoint(a),h=p(n,o)&&0===e.comparePoint(o);if(c&&l)return h&&!u?o:!h&&u?a:null;if(c)return u&&i.x===a.x&&i.y===a.y?null:i;if(l)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&u)return null;if(h)return o;if(u)return a;var d=function(e,t,n,r){if(0===t.x)return C(n,r,e.x);if(0===r.x)return C(e,t,n.x);if(0===t.y)return T(n,r,e.y);if(0===r.y)return T(e,t,n.y);var i=b(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},s=b(o,t)/i,a=b(o,r)/i;return{x:(e.x+a*t.x+(n.x+s*r.x))/2,y:(e.y+a*t.y+(n.y+s*r.y))/2}}(i,this.vector(),s,e.vector());return null===d?null:p(r,d)?x.round(d.x,d.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new A(e,!0),o=new A(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var a=new t(i,s,this.rings.slice(),this.windings.slice());return A.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),A.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var a=0,l=r.rings.length;a<l;a++){var c=r.rings[a],u=r.windings[a],h=n.rings.indexOf(c);-1===h?(n.rings.push(c),n.windings.push(u)):n.windings[h]+=u}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],a=this.windings[i],l=t.indexOf(s);-1===l?(t.push(s),n.push(a)):n[l]+=a}for(var c=[],u=[],h=0,d=t.length;h<d;h++)if(0!==n[h]){var p=t[h],f=p.poly;if(-1===u.indexOf(f))if(p.isExterior)c.push(f);else{-1===u.indexOf(f)&&u.push(f);var m=c.indexOf(p.poly);-1!==m&&c.splice(m,1)}}for(var g=0,y=c.length;g<y;g++){var v=c[g].multiPoly;-1===r.indexOf(v)&&r.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(U.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===U.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(e.length-t.length);this._isInResult=s%2==1;break;case"difference":var a=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=a(e)!==a(t);break;default:throw new Error("Unrecognized operation type found ".concat(U.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,s,a=A.comparePoints(e,n);if(a<0)i=e,o=n,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,s=-1}return new t(new A(i,!0),new A(o,!1),[r],[s])}}]),t}(),R=function(){function t(n,r,i){if(e(this,t),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof n[0][0]||"number"!=typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=x.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var s=o,a=1,l=n.length;a<l;a++){if("number"!=typeof n[a][0]||"number"!=typeof n[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var c=x.round(n[a][0],n[a][1]);c.x===s.x&&c.y===s.y||(this.segments.push(P.fromRing(s,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),s=c)}o.x===s.x&&o.y===s.y||this.segments.push(P.fromRing(s,o,this))}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),t}(),L=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new R(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var s=new R(n[i],this,!1);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),D=function(){function t(n,r){if(e(this,t),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof n[0][0][0]&&(n=[n])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var s=new L(n[i],this);s.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=r}return n(t,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),t}(),O=function(){function t(n){e(this,t),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,l=o.rightSE,c=[a],u=a.point,h=[];s=a,a=l,c.push(a),a.point!==u;)for(;;){var d=a.getAvailableLinkedEvents();if(0===d.length){var p=c[0].point,f=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(f.x,", ").concat(f.y,"]."))}if(1===d.length){l=d[0].otherSE;break}for(var m=null,g=0,y=h.length;g<y;g++)if(h[g].point===a.point){m=g;break}if(null===m){h.push({index:c.length,point:a.point});var v=a.getLeftmostComparator(s);l=d.sort(v)[0].otherSE;break}var _=h.splice(m)[0],x=c.splice(_.index);x.unshift(x[0].otherSE),n.push(new t(x.reverse()))}n.push(new t(c))}}return n}}]),n(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==S(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var s=t[0],a=t[1];0===S(s,e,a)&&t.shift(),t.push(t[0]);for(var l=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,u=this.isExteriorRing()?t.length:-1,h=[],d=c;d!=u;d+=l)h.push([t[d].x,t[d].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];A.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),N=function(){function t(n){e(this,t),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),t}(),k=function(){function t(n){e(this,t),this.rings=n,this.polys=this._composePolys(n)}return n(t,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new N(i));else{var o=i.enclosingRing();o.poly||t.push(new N(o)),o.poly.addInterior(i)}}return t}}]),t}(),F=function(){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.compare;e(this,t),this.queue=n,this.tree=new c(r),this.segments=[]}return n(t,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.insert(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,a=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(e.isLeft){var l=null;if(s){var c=s.getIntersection(t);if(null!==c&&(t.isAnEndpoint(c)||(l=c),!s.isAnEndpoint(c)))for(var u=this._splitSafely(s,c),h=0,d=u.length;h<d;h++)n.push(u[h])}var p=null;if(a){var f=a.getIntersection(t);if(null!==f&&(t.isAnEndpoint(f)||(p=f),!a.isAnEndpoint(f)))for(var m=this._splitSafely(a,f),g=0,y=m.length;g<y;g++)n.push(m[g])}if(null!==l||null!==p){var v;v=null===l?p:null===p||A.comparePoints(l,p)<=0?l:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(v),x=0,b=_.length;x<b;x++)n.push(_[x])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&a){var w=s.getIntersection(a);if(null!==w){if(!s.isAnEndpoint(w))for(var S=this._splitSafely(s,w),M=0,E=S.length;M<E;M++)n.push(S[M]);if(!a.isAnEndpoint(w))for(var T=this._splitSafely(a,w),C=0,I=T.length;C<I;C++)n.push(T[C])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.insert(e),r}}]),t}(),z="undefined"!=typeof process&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,B="undefined"!=typeof process&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,U=new(function(){function t(){e(this,t)}return n(t,[{key:"run",value:function(e,t,n){U.type=e,x.reset();for(var r=[new D(t,!0)],i=0,o=n.length;i<o;i++)r.push(new D(n[i],!1));if(U.numMultiPolys=r.length,"difference"===U.type)for(var s=r[0],a=1;a<r.length;)null!==f(r[a].bbox,s.bbox)?a++:r.splice(a,1);if("intersection"===U.type)for(var l=0,u=r.length;l<u;l++)for(var h=r[l],d=l+1,p=r.length;d<p;d++)if(null===f(h.bbox,r[d].bbox))return[];for(var m=new c(A.compare),g=0,y=r.length;g<y;g++)for(var v=r[g].getSweepEvents(),_=0,b=v.length;_<b;_++)if(m.insert(v[_]),m.size>z)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new F(m),S=m.size,M=m.pop();M;){var E=M.key;if(m.size===S){var T=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(m.size>z)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>B)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var C=w.process(E),I=0,P=C.length;I<P;I++){var R=C[I];void 0===R.consumedBy&&m.insert(R)}S=m.size,M=m.pop()}x.reset();var L=O.factory(w.segments);return new k(L).getGeom()}}]),t}());return{union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return U.run("difference",e,n)}}}()},1729:(e,t,n)=>{"use strict";var r=n(9165);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,s){if(s!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},5192:(e,t,n)=>{e.exports=n(1729)()},9165:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},5876:(e,t,n)=>{"use strict";e.exports=i,e.exports.default=i;var r=n(8552);function i(e,t){if(!(this instanceof i))return new i(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function o(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function s(e,t){a(e,0,e.children.length,t,e)}function a(e,t,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=t;s<n;s++)o=e.children[s],l(i,e.leaf?r(o):o);return i}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,n,i,o){for(var s,a=[t,n];a.length;)(n=a.pop())-(t=a.pop())<=i||(s=t+Math.ceil((n-t)/i/2)*i,r(e,s,t,n,o),a.push(t,s,s,n))}i.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],r=this.toBBox;if(!f(e,t))return n;for(var i,o,s,a,l=[];t;){for(i=0,o=t.children.length;i<o;i++)s=t.children[i],f(e,a=t.leaf?r(s):s)&&(t.leaf?n.push(s):p(e,a)?this._all(s,n):l.push(s));t=l.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!f(e,t))return!1;for(var r,i,o,s,a=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],f(e,s=t.leaf?n(o):o)){if(t.leaf||p(e,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(e,t){if(!e)return this;for(var n,r,i,s,a=this.data,l=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),r=c[c.length-1],n=u.pop(),s=!0),a.leaf&&-1!==(i=o(e,a.children,t)))return a.children.splice(i,1),c.push(a),this._condense(c),this;s||a.leaf||!p(a,l)?r?(n++,a=r.children[n],s=!1):a=null:(c.push(a),u.push(n),n=0,r=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var i,o=n-t+1,a=this._maxEntries;if(o<=a)return s(i=m(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(i=m([])).leaf=!1,i.height=r;var l,c,u,h,d=Math.ceil(o/a),p=d*Math.ceil(Math.sqrt(a));for(g(e,t,n,p,this.compareMinX),l=t;l<=n;l+=p)for(g(e,l,u=Math.min(l+p-1,n),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),i.children.push(this._build(e,c,h,r-1));return s(i,this.toBBox),i},_chooseSubtree:function(e,t,n,r){for(var i,o,s,a,l,c,u,d,p,f;r.push(t),!t.leaf&&r.length-1!==n;){for(u=d=1/0,i=0,o=t.children.length;i<o;i++)l=h(s=t.children[i]),p=e,f=s,(c=(Math.max(f.maxX,p.maxX)-Math.min(f.minX,p.minX))*(Math.max(f.maxY,p.maxY)-Math.min(f.minY,p.minY))-l)<d?(d=c,u=l<u?l:u,a=s):c===d&&l<u&&(u=l,a=s);t=a||t.children[0]}return t},_insert:function(e,t,n){var r=this.toBBox,i=n?e:r(e),o=[],s=this._chooseSubtree(i,this.data,t,o);for(s.children.push(e),l(s,i);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=m(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,s(n,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},_splitRoot:function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){var r,i,o,s,l,c,u,d,p,f,m,g,y,v;for(c=u=1/0,r=t;r<=n-t;r++)p=i=a(e,0,r,this.toBBox),f=o=a(e,r,n,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(p.minX,f.minX),g=Math.max(p.minY,f.minY),y=Math.min(p.maxX,f.maxX),v=Math.min(p.maxY,f.maxY),s=Math.max(0,y-m)*Math.max(0,v-g),l=h(i)+h(o),s<c?(c=s,d=r,u=l<u?l:u):s===c&&l<u&&(u=l,d=r);return d},_chooseSplitAxis:function(e,t,n){var r=e.leaf?this.compareMinX:c,i=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},_allDistMargin:function(e,t,n,r){e.children.sort(r);var i,o,s=this.toBBox,c=a(e,0,t,s),u=a(e,n-t,n,s),h=d(c)+d(u);for(i=t;i<n-t;i++)o=e.children[i],l(c,e.leaf?s(o):o),h+=d(c);for(i=n-t-1;i>=t;i--)o=e.children[i],l(u,e.leaf?s(o):o),h+=d(u);return h},_adjustParentBBoxes:function(e,t,n){for(var r=n;r>=0;r--)l(t[r],e)},_condense:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():s(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},8552:function(e){e.exports=function(){"use strict";function e(n,r,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,l=r-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var d=n[r],p=i,f=o;for(t(n,i,r),s(n[o],d)>0&&t(n,i,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[i],d)?t(n,i,f):t(n,++f,o),f<=r&&(i=f+1),r<=f&&(o=f-1)}}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}return function(t,r,i,o,s){e(t,r,i||0,o||t.length-1,s||n)}}()},534:(e,t,n)=>{"use strict";var r=n(7313),i=n(2224);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function _(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null==t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(f,e)||!h.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function N(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=O&&e[O]||e["@@iterator"])?e:null}var k,F=Object.assign;function z(e){if(void 0===k)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);k=t&&t[1]||""}return"\n"+k+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function j(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return U(e.type,!1);case 11:return U(e.type.render,!1);case 1:return U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case M:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return V(e(t))}catch(e){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=Z(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function $(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Z(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function q(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function K(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function J(e,t){K(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Q(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ye=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Me=null;function Ee(e){if(e=_i(e)){if("function"!=typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=bi(t),we(e.stateNode,e.type,t))}}function Te(e){Se?Me?Me.push(e):Me=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Me;if(Me=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ae(e,t){return e(t)}function Ie(){}var Pe=!1;function Re(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ae(e,t,n)}finally{Pe=!1,(null!==Se||null!==Me)&&(Ie(),Ce())}}function Le(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(o(231,t,typeof n));return n}var De=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){De=!1}function Ne(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(e){this.onError(e)}}var ke=!1,Fe=null,ze=!1,Be=null,Ue={onError:function(e){ke=!0,Fe=e}};function je(e,t,n,r,i,o,s,a,l){ke=!1,Fe=null,Ne.apply(Ue,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(o(188))}function Ze(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return He(i),e;if(s===r)return He(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var $e=i.unstable_scheduleCallback,qe=i.unstable_cancelCallback,Xe=i.unstable_shouldYield,Ye=i.unstable_requestPaint,Ke=i.unstable_now,Je=i.unstable_getCurrentPriorityLevel,Qe=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null,st=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2,ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=ht(a):0!=(o&=s)&&(r=ht(o))}else 0!=(s=n&~i)?r=ht(s):0!==o&&(r=ht(o));if(0===r)return 0;if(0!==t&&t!==r&&0==(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!=(4194240&o)))return t;if(0!=(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0==(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var _t=0;function xt(e){return 1<(e&=-e)?4<e?0!=(268435455&e)?16:536870912:4:1}var bt,wt,St,Mt,Et,Tt=!1,Ct=[],At=null,It=null,Pt=null,Rt=new Map,Lt=new Map,Dt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lt.delete(t.pointerId)}}function kt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&null!==(t=_i(t))&&wt(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ft(e){var t=vi(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Et(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=_i(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){zt(e)&&n.delete(t)}function Ut(){Tt=!1,null!==At&&zt(At)&&(At=null),null!==It&&zt(It)&&(It=null),null!==Pt&&zt(Pt)&&(Pt=null),Rt.forEach(Bt),Lt.forEach(Bt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ut)))}function Vt(e){function t(t){return jt(t,e)}if(0<Ct.length){jt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&jt(At,e),null!==It&&jt(It,e),null!==Pt&&jt(Pt,e),Rt.forEach(t),Lt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Dt.shift()}var Gt=x.ReactCurrentBatchConfig,Ht=!0;function Zt(e,t,n,r){var i=_t,o=Gt.transition;Gt.transition=null;try{_t=1,$t(e,t,n,r)}finally{_t=i,Gt.transition=o}}function Wt(e,t,n,r){var i=_t,o=Gt.transition;Gt.transition=null;try{_t=4,$t(e,t,n,r)}finally{_t=i,Gt.transition=o}}function $t(e,t,n,r){if(Ht){var i=Xt(e,t,n,r);if(null===i)Hr(e,t,r,qt,n),Nt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=kt(At,e,t,n,r,i),!0;case"dragenter":return It=kt(It,e,t,n,r,i),!0;case"mouseover":return Pt=kt(Pt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Rt.set(o,kt(Rt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Lt.set(o,kt(Lt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Nt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var o=_i(i);if(null!==o&&bt(o),null===(o=Xt(e,t,n,r))&&Hr(e,t,r,qt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var qt=null;function Xt(e,t,n,r){if(qt=null,null!==(e=vi(e=be(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Qe:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Kt=null,Jt=null,Qt=null;function en(){if(Qt)return Qt;var e,t,n=Jt,r=n.length,i="value"in Kt?Kt.value:Kt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Qt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),hn=F({},cn,{view:0,detail:0}),dn=on(hn),pn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(F({},pn,{dataTransfer:0})),gn=on(F({},hn,{relatedTarget:0})),yn=on(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),_n=on(vn),xn=on(F({},cn,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function En(){return Mn}var Tn=F({},hn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=on(Tn),An=on(F({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=on(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),Pn=on(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=F({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ln=on(Rn),Dn=[9,13,27,32],On=u&&"CompositionEvent"in window,Nn=null;u&&"documentMode"in document&&(Nn=document.documentMode);var kn=u&&"TextEvent"in window&&!Nn,Fn=u&&(!On||Nn&&8<Nn&&11>=Nn),zn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1,Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Zn(e,t,n,r){Te(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,$n=null;function qn(e){zr(e,0)}function Xn(e){if($(xi(e)))return e}function Yn(e,t){if("change"===e)return t}var Kn=!1;if(u){var Jn;if(u){var Qn="oninput"in document;if(!Qn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Qn="function"==typeof er.oninput}Jn=Qn}else Jn=!1;Kn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),$n=Wn=null)}function nr(e){if("value"===e.propertyName&&Xn($n)){var t=[];Zn(t,$n,e,be(e)),Re(qn,t)}}function rr(e,t,n){"focusin"===e?(tr(),$n=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn($n)}function or(e,t){if("click"===e)return Xn(t)}function sr(e,t){if("input"===e||"change"===e)return Xn(t)}var ar="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function lr(e,t){if(ar(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,yr=null,vr=null,_r=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==gr||gr!==q(r)||(r="selectionStart"in(r=gr)&&pr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Wr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},Sr={},Mr={};function Er(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mr)return Sr[e]=n[t];return e}u&&(Mr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Tr=Er("animationend"),Cr=Er("animationiteration"),Ar=Er("animationstart"),Ir=Er("transitionend"),Pr=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Lr(e,t){Pr.set(e,t),l(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Or=Rr[Dr];Lr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Lr(Tr,"onAnimationEnd"),Lr(Cr,"onAnimationIteration"),Lr(Ar,"onAnimationStart"),Lr("dblclick","onDoubleClick"),Lr("focusin","onFocus"),Lr("focusout","onBlur"),Lr(Ir,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nr));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,l,c){if(je.apply(this,arguments),ke){if(!ke)throw Error(o(198));var u=Fe;ke=!1,Fe=null,ze||(ze=!0,Be=u)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Fr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Fr(i,a,c),o=l}}}if(ze)throw e=Be,ze=!1,Be=null,e}function Br(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var jr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[jr]){e[jr]=!0,s.forEach((function(t){"selectionchange"!==t&&(kr.has(t)||Ur(t,!1,e),Ur(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jr]||(t[jr]=!0,Ur("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Yt(t)){case 1:var i=Zt;break;case 4:i=Wt;break;default:i=$t}n=i.bind(null,t,n,e),i=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var o=r;if(0==(1&t)&&0==(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=vi(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}Re((function(){var r=o,i=be(n),s=[];e:{var a=Pr.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Tr:case Cr:case Ar:l=yn;break;case Ir:l=Pn;break;case"scroll":l=dn;break;case"wheel":l=Ln;break;case"copy":case"cut":case"paste":l=_n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var u=0!=(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&null!=(m=Le(f,d))&&u.push(Zr(f,m,p))),h)break;f=f.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!vi(c)&&!c[fi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vi(c):null)&&(c!==(h=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=An,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?a:xi(l),p=null==c?a:xi(c),(a=new u(m,f+"leave",l,n,i)).target=h,a.relatedTarget=p,m=null,vi(i)===r&&((u=new u(d,f+"enter",c,n,i)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=$r(p))f++;for(p=0,m=d;m;m=$r(m))p++;for(;0<f-p;)u=$r(u),f--;for(;0<p-f;)d=$r(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=$r(u),d=$r(d)}u=null}else u=null;null!==l&&qr(s,a,l,u,!1),null!==c&&null!==h&&qr(s,h,c,u,!0)}if("select"===(l=(a=r?xi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Yn;else if(Hn(a))if(Kn)g=sr;else{g=ir;var y=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(e,r))?Zn(s,g,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?xi(r):window,e){case"focusin":(Hn(y)||"true"===y.contentEditable)&&(gr=y,yr=r,vr=null);break;case"focusout":vr=yr=gr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,xr(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(s,n,i)}var v;if(On)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Vn?Un(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(v=en()):(Jt="value"in(Kt=i)?Kt.value:Kt.textContent,Vn=!0)),0<(y=Wr(r,_)).length&&(_=new xn(_,e,null,n,i),s.push({event:_,listeners:y}),(v||null!==(v=jn(n)))&&(_.data=v))),(v=kn?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,zn);case"textInput":return(e=t.data)===zn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!On&&Un(e,t)?(e=en(),Qt=Jt=Kt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(r=Wr(r,"onBeforeInput")).length&&(i=new xn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=v)}zr(s,t)}))}function Zr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Le(e,n))&&r.unshift(Zr(e,o,i)),null!=(o=Le(e,t))&&r.push(Zr(e,o,i))),e=e.return}return r}function $r(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=Le(n,o))&&s.unshift(Zr(n,l,a)):i||null!=(l=Le(n,o))&&s.push(Zr(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Kr(e){return("string"==typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function Jr(e,t,n){if(t=Kr(t),Kr(e)!==t&&n)throw Error(o(425))}function Qr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"==typeof setTimeout?setTimeout:void 0,ii="function"==typeof clearTimeout?clearTimeout:void 0,oi="function"==typeof Promise?Promise:void 0,si="function"==typeof queueMicrotask?queueMicrotask:void 0!==oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,pi="__reactProps$"+hi,fi="__reactContainer$"+hi,mi="__reactEvents$"+hi,gi="__reactListeners$"+hi,yi="__reactHandles$"+hi;function vi(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[di])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function _i(e){return!(e=e[di]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function bi(e){return e[pi]||null}var wi=[],Si=-1;function Mi(e){return{current:e}}function Ei(e){0>Si||(e.current=wi[Si],wi[Si]=null,Si--)}function Ti(e,t){Si++,wi[Si]=e.current,e.current=t}var Ci={},Ai=Mi(Ci),Ii=Mi(!1),Pi=Ci;function Ri(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Li(e){return null!=e.childContextTypes}function Di(){Ei(Ii),Ei(Ai)}function Oi(e,t,n){if(Ai.current!==Ci)throw Error(o(168));Ti(Ai,t),Ti(Ii,n)}function Ni(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,G(e)||"Unknown",i));return F({},n,r)}function ki(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Pi=Ai.current,Ti(Ai,e),Ti(Ii,Ii.current),!0}function Fi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Ni(e,t,Pi),r.__reactInternalMemoizedMergedChildContext=e,Ei(Ii),Ei(Ai),Ti(Ai,e)):Ei(Ii),Ti(Ii,n)}var zi=null,Bi=!1,Ui=!1;function ji(e){null===zi?zi=[e]:zi.push(e)}function Vi(){if(!Ui&&null!==zi){Ui=!0;var e=0,t=_t;try{var n=zi;for(_t=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}zi=null,Bi=!1}catch(t){throw null!==zi&&(zi=zi.slice(e+1)),$e(Qe,Vi),t}finally{_t=t,Ui=!1}}return null}var Gi=[],Hi=0,Zi=null,Wi=0,$i=[],qi=0,Xi=null,Yi=1,Ki="";function Ji(e,t){Gi[Hi++]=Wi,Gi[Hi++]=Zi,Zi=e,Wi=t}function Qi(e,t,n){$i[qi++]=Yi,$i[qi++]=Ki,$i[qi++]=Xi,Xi=e;var r=Yi;e=Ki;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Yi=1<<32-st(t)+i|n<<i|r,Ki=o+e}else Yi=1<<o|n<<i|r,Ki=e}function eo(e){null!==e.return&&(Ji(e,1),Qi(e,1,0))}function to(e){for(;e===Zi;)Zi=Gi[--Hi],Gi[Hi]=null,Wi=Gi[--Hi],Gi[Hi]=null;for(;e===Xi;)Xi=$i[--qi],$i[qi]=null,Ki=$i[--qi],$i[qi]=null,Yi=$i[--qi],$i[qi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xi?{id:Yi,overflow:Ki}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function lo(e){return 0!=(1&e.mode)&&0==(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(lo(e))throw po(),Error(o(418));for(;t;)so(e,t),t=ci(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=ci(e.nextSibling)}function fo(){ro=no=null,io=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=x.ReactCurrentBatchConfig;function yo(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var vo=Mi(null),_o=null,xo=null,bo=null;function wo(){bo=xo=_o=null}function So(e){var t=vo.current;Ei(vo),e._currentValue=t}function Mo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t){_o=e,bo=xo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(xa=!0),e.firstContext=null)}function To(e){var t=e._currentValue;if(bo!==e)if(e={context:e,memoizedValue:t,next:null},null===xo){if(null===_o)throw Error(o(308));xo=e,_o.dependencies={lanes:0,firstContext:e}}else xo=xo.next=e;return t}var Co=null;function Ao(e){null===Co?Co=[e]:Co.push(e)}function Io(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ao(t)):(n.next=i.next,i.next=n),t.interleaved=n,Po(e,r)}function Po(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ro=!1;function Lo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Do(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function No(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!=(2&Il)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Po(e,n)}return null===(i=r.interleaved)?(t.next=t,Ao(r)):(t.next=i.next,i.next=t),r.interleaved=t,Po(e,n)}function ko(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Fo(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zo(e,t,n,r){var i=e.updateQueue;Ro=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&(a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l)}if(null!==o){var h=i.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,p=a.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(d=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,h,d):f))break e;h=F({},h,d);break e;case 2:Ro=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else p={eventTime:p,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Fl|=s,e.lanes=s,e.memoizedState=h}}function Bo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(o(191,i));i.call(r)}}}var Uo=(new r.Component).refs;function jo(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vo={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Oo(r,i);o.payload=t,null!=n&&(o.callback=n),null!==(t=No(e,o,i))&&(rc(t,e,i,r),ko(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Oo(r,i);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=No(e,o,i))&&(rc(t,e,i,r),ko(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),i=Oo(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=No(e,i,r))&&(rc(t,e,r,n),ko(t,e,r))}};function Go(e,t,n,r,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!(t.prototype&&t.prototype.isPureReactComponent&&lr(n,r)&&lr(i,o))}function Ho(e,t,n){var r=!1,i=Ci,o=t.contextType;return"object"==typeof o&&null!==o?o=To(o):(i=Li(t)?Pi:Ai.current,o=(r=null!=(r=t.contextTypes))?Ri(e,i):Ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Zo(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Vo.enqueueReplaceState(t,t.state,null)}function Wo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Uo,Lo(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=To(o):(o=Li(t)?Pi:Ai.current,i.context=Ri(e,o)),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(jo(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Vo.enqueueReplaceState(i,i.state,null),zo(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function $o(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Uo&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function qo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xo(e){return(0,e._init)(e._payload)}function Yo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Oc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===S?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===L&&Xo(o)===t.type)?((r=i(t,n.props)).ref=$o(e,t,n),r.return=e,r):((r=Nc(n.type,n.key,n.props,null,e.mode,r)).ref=$o(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=kc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Nc(t.type,t.key,t.props,null,e.mode,n)).ref=$o(e,null,t),n.return=e,n;case w:return(t=Bc(t,e.mode,n)).return=e,t;case L:return d(e,(0,t._init)(t._payload),n)}if(te(t)||N(t))return(t=kc(t,e.mode,n,null)).return=e,t;qo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:l(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?c(e,t,n,r):null;case w:return n.key===i?u(e,t,n,r):null;case L:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||N(n))return null!==i?null:h(e,t,n,r,null);qo(e,n)}return null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case b:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case w:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case L:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||N(r))return h(t,e=e.get(n)||null,r,i,null);qo(t,r)}return null}function m(i,o,a,l){for(var c=null,u=null,h=o,m=o=0,g=null;null!==h&&m<a.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var y=p(i,h,a[m],l);if(null===y){null===h&&(h=g);break}e&&h&&null===y.alternate&&t(i,h),o=s(y,o,m),null===u?c=y:u.sibling=y,u=y,h=g}if(m===a.length)return n(i,h),io&&Ji(i,m),c;if(null===h){for(;m<a.length;m++)null!==(h=d(i,a[m],l))&&(o=s(h,o,m),null===u?c=h:u.sibling=h,u=h);return io&&Ji(i,m),c}for(h=r(i,h);m<a.length;m++)null!==(g=f(h,i,m,a[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),o=s(g,o,m),null===u?c=g:u.sibling=g,u=g);return e&&h.forEach((function(e){return t(i,e)})),io&&Ji(i,m),c}function g(i,a,l,c){var u=N(l);if("function"!=typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var _=p(i,m,v.value,c);if(null===_){null===m&&(m=y);break}e&&m&&null===_.alternate&&t(i,m),a=s(_,a,g),null===h?u=_:h.sibling=_,h=_,m=y}if(v.done)return n(i,m),io&&Ji(i,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(i,v.value,c))&&(a=s(v,a,g),null===h?u=v:h.sibling=v,h=v);return io&&Ji(i,g),u}for(m=r(i,m);!v.done;g++,v=l.next())null!==(v=f(m,i,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=s(v,a,g),null===h?u=v:h.sibling=v,h=v);return e&&m.forEach((function(e){return t(i,e)})),io&&Ji(i,g),u}return function e(r,o,s,l){if("object"==typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"==typeof c&&null!==c&&c.$$typeof===L&&Xo(c)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=$o(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===S?((o=kc(s.props.children,r.mode,l,s.key)).return=r,r=o):((l=Nc(s.type,s.key,s.props,null,r.mode,l)).ref=$o(r,o,s),l.return=r,r=l)}return a(r);case w:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Bc(s,r.mode,l)).return=r,r=o}return a(r);case L:return e(r,o,(u=s._init)(s._payload),l)}if(te(s))return m(r,o,s,l);if(N(s))return g(r,o,s,l);qo(r,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=zc(s,r.mode,l)).return=r,r=o),a(r)):n(r,o)}}var Ko=Yo(!0),Jo=Yo(!1),Qo={},es=Mi(Qo),ts=Mi(Qo),ns=Mi(Qo);function rs(e){if(e===Qo)throw Error(o(174));return e}function is(e,t){switch(Ti(ns,t),Ti(ts,e),Ti(es,Qo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ei(es),Ti(es,t)}function os(){Ei(es),Ei(ts),Ei(ns)}function ss(e){rs(ns.current);var t=rs(es.current),n=le(t,e.type);t!==n&&(Ti(ts,e),Ti(es,n))}function as(e){ts.current===e&&(Ei(es),Ei(ts))}var ls=Mi(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function hs(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var ds=x.ReactCurrentDispatcher,ps=x.ReactCurrentBatchConfig,fs=0,ms=null,gs=null,ys=null,vs=!1,_s=!1,xs=0,bs=0;function ws(){throw Error(o(321))}function Ss(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function Ms(e,t,n,r,i,s){if(fs=s,ms=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?aa:la,e=n(r,i),_s){s=0;do{if(_s=!1,xs=0,25<=s)throw Error(o(301));s+=1,ys=gs=null,t.updateQueue=null,ds.current=ca,e=n(r,i)}while(_s)}if(ds.current=sa,t=null!==gs&&null!==gs.next,fs=0,ys=gs=ms=null,vs=!1,t)throw Error(o(300));return e}function Es(){var e=0!==xs;return xs=0,e}function Ts(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ys?ms.memoizedState=ys=e:ys=ys.next=e,ys}function Cs(){if(null===gs){var e=ms.alternate;e=null!==e?e.memoizedState:null}else e=gs.next;var t=null===ys?ms.memoizedState:ys.next;if(null!==t)ys=t,gs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(gs=e).memoizedState,baseState:gs.baseState,baseQueue:gs.baseQueue,queue:gs.queue,next:null},null===ys?ms.memoizedState=ys=e:ys=ys.next=e}return ys}function As(e,t){return"function"==typeof t?t(e):t}function Is(e){var t=Cs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=gs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=a=null,c=null,u=s;do{var h=u.lane;if((fs&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=r):c=c.next=d,ms.lanes|=h,Fl|=h}u=u.next}while(null!==u&&u!==s);null===c?a=r:c.next=l,ar(r,t.memoizedState)||(xa=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,ms.lanes|=s,Fl|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ps(e){var t=Cs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(xa=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Rs(){}function Ls(e,t){var n=ms,r=Cs(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,xa=!0),r=r.queue,Hs(Ns.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==ys&&1&ys.memoizedState.tag){if(n.flags|=2048,Bs(9,Os.bind(null,n,r,i,t),void 0,null),null===Pl)throw Error(o(349));0!=(30&fs)||Ds(n,t,i)}return i}function Ds(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Os(e,t,n,r){t.value=n,t.getSnapshot=r,ks(t)&&Fs(e)}function Ns(e,t,n){return n((function(){ks(t)&&Fs(e)}))}function ks(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(e){return!0}}function Fs(e){var t=Po(e,1);null!==t&&rc(t,e,1,-1)}function zs(e){var t=Ts();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:As,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,ms,e),[t.memoizedState,e]}function Bs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=ms.updateQueue)?(t={lastEffect:null,stores:null},ms.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Us(){return Cs().memoizedState}function js(e,t,n,r){var i=Ts();ms.flags|=e,i.memoizedState=Bs(1|t,n,void 0,void 0===r?null:r)}function Vs(e,t,n,r){var i=Cs();r=void 0===r?null:r;var o=void 0;if(null!==gs){var s=gs.memoizedState;if(o=s.destroy,null!==r&&Ss(r,s.deps))return void(i.memoizedState=Bs(t,n,o,r))}ms.flags|=e,i.memoizedState=Bs(1|t,n,o,r)}function Gs(e,t){return js(8390656,8,e,t)}function Hs(e,t){return Vs(2048,8,e,t)}function Zs(e,t){return Vs(4,2,e,t)}function Ws(e,t){return Vs(4,4,e,t)}function $s(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qs(e,t,n){return n=null!=n?n.concat([e]):null,Vs(4,4,$s.bind(null,t,e),n)}function Xs(){}function Ys(e,t){var n=Cs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ss(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ks(e,t){var n=Cs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ss(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Js(e,t,n){return 0==(21&fs)?(e.baseState&&(e.baseState=!1,xa=!0),e.memoizedState=n):(ar(n,t)||(n=mt(),ms.lanes|=n,Fl|=n,e.baseState=!0),t)}function Qs(e,t){var n=_t;_t=0!==n&&4>n?n:4,e(!0);var r=ps.transition;ps.transition={};try{e(!1),t()}finally{_t=n,ps.transition=r}}function ea(){return Cs().memoizedState}function ta(e,t,n){var r=nc(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e)?ia(t,n):null!==(n=Io(e,t,n,r))&&(rc(n,e,r,tc()),oa(n,t,r))}function na(e,t,n){var r=nc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var l=t.interleaved;return null===l?(i.next=i,Ao(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(e){}null!==(n=Io(e,t,i,r))&&(rc(n,e,r,i=tc()),oa(n,t,r))}}function ra(e){var t=e.alternate;return e===ms||null!==t&&t===ms}function ia(e,t){_s=vs=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!=(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var sa={readContext:To,useCallback:ws,useContext:ws,useEffect:ws,useImperativeHandle:ws,useInsertionEffect:ws,useLayoutEffect:ws,useMemo:ws,useReducer:ws,useRef:ws,useState:ws,useDebugValue:ws,useDeferredValue:ws,useTransition:ws,useMutableSource:ws,useSyncExternalStore:ws,useId:ws,unstable_isNewReconciler:!1},aa={readContext:To,useCallback:function(e,t){return Ts().memoizedState=[e,void 0===t?null:t],e},useContext:To,useEffect:Gs,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,js(4194308,4,$s.bind(null,t,e),n)},useLayoutEffect:function(e,t){return js(4194308,4,e,t)},useInsertionEffect:function(e,t){return js(4,2,e,t)},useMemo:function(e,t){var n=Ts();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ts();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,ms,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ts().memoizedState=e},useState:zs,useDebugValue:Xs,useDeferredValue:function(e){return Ts().memoizedState=e},useTransition:function(){var e=zs(!1),t=e[0];return e=Qs.bind(null,e[1]),Ts().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ms,i=Ts();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Pl)throw Error(o(349));0!=(30&fs)||Ds(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Gs(Ns.bind(null,r,s,e),[e]),r.flags|=2048,Bs(9,Os.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Ts(),t=Pl.identifierPrefix;if(io){var n=Ki;t=":"+t+"R"+(n=(Yi&~(1<<32-st(Yi)-1)).toString(32)+n),0<(n=xs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:To,useCallback:Ys,useContext:To,useEffect:Hs,useImperativeHandle:qs,useInsertionEffect:Zs,useLayoutEffect:Ws,useMemo:Ks,useReducer:Is,useRef:Us,useState:function(){return Is(As)},useDebugValue:Xs,useDeferredValue:function(e){return Js(Cs(),gs.memoizedState,e)},useTransition:function(){return[Is(As)[0],Cs().memoizedState]},useMutableSource:Rs,useSyncExternalStore:Ls,useId:ea,unstable_isNewReconciler:!1},ca={readContext:To,useCallback:Ys,useContext:To,useEffect:Hs,useImperativeHandle:qs,useInsertionEffect:Zs,useLayoutEffect:Ws,useMemo:Ks,useReducer:Ps,useRef:Us,useState:function(){return Ps(As)},useDebugValue:Xs,useDeferredValue:function(e){var t=Cs();return null===gs?t.memoizedState=e:Js(t,gs.memoizedState,e)},useTransition:function(){return[Ps(As)[0],Cs().memoizedState]},useMutableSource:Rs,useSyncExternalStore:Ls,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",r=t;do{n+=j(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var pa="function"==typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Oo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Zl||(Zl=!0,Wl=r),da(0,t)},n}function ma(e,t,n){(n=Oo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!=typeof r&&(null===$l?$l=new Set([this]):$l.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new pa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Tc.bind(null,e,t,n),t.then(e,e))}function ya(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function va(e,t,n,r,i){return 0==(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Oo(-1,1)).tag=2,No(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var _a=x.ReactCurrentOwner,xa=!1;function ba(e,t,n,r){t.child=null===e?Jo(t,null,n,r):Ko(t,e.child,n,r)}function wa(e,t,n,r,i){n=n.render;var o=t.ref;return Eo(t,i),r=Ms(e,t,n,r,o,i),n=Es(),null===e||xa?(io&&n&&eo(t),t.flags|=1,ba(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Za(e,t,i))}function Sa(e,t,n,r,i){if(null===e){var o=n.type;return"function"!=typeof o||Dc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ma(e,t,o,r,i))}if(o=e.child,0==(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return Za(e,t,i)}return t.flags|=1,(e=Oc(o,r)).ref=t.ref,e.return=t,t.child=e}function Ma(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(lr(o,r)&&e.ref===t.ref){if(xa=!1,t.pendingProps=r=o,0==(e.lanes&i))return t.lanes=e.lanes,Za(e,t,i);0!=(131072&e.flags)&&(xa=!0)}}return Ca(e,t,n,r,i)}function Ea(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0==(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Ol,Dl),Dl|=n;else{if(0==(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Ol,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ti(Ol,Dl),Dl|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ti(Ol,Dl),Dl|=r;return ba(e,t,i,n),t.child}function Ta(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ca(e,t,n,r,i){var o=Li(n)?Pi:Ai.current;return o=Ri(t,o),Eo(t,i),n=Ms(e,t,n,r,o,i),r=Es(),null===e||xa?(io&&r&&eo(t),t.flags|=1,ba(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Za(e,t,i))}function Aa(e,t,n,r,i){if(Li(n)){var o=!0;ki(t)}else o=!1;if(Eo(t,i),null===t.stateNode)Ha(e,t),Ho(t,n,r),Wo(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;c="object"==typeof c&&null!==c?To(c):Ri(t,c=Li(n)?Pi:Ai.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;h||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==r||l!==c)&&Zo(t,s,r,c),Ro=!1;var d=t.memoizedState;s.state=d,zo(t,r,s,i),l=t.memoizedState,a!==r||d!==l||Ii.current||Ro?("function"==typeof u&&(jo(t,n,u,r),l=t.memoizedState),(a=Ro||Go(t,n,a,r,d,l,c))?(h||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"==typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Do(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:yo(t.type,a),s.props=c,h=t.pendingProps,d=s.context,l="object"==typeof(l=n.contextType)&&null!==l?To(l):Ri(t,l=Li(n)?Pi:Ai.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==h||d!==l)&&Zo(t,s,r,l),Ro=!1,d=t.memoizedState,s.state=d,zo(t,r,s,i);var f=t.memoizedState;a!==h||d!==f||Ii.current||Ro?("function"==typeof p&&(jo(t,n,p,r),f=t.memoizedState),(c=Ro||Go(t,n,c,r,d,f,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=l,r=c):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ia(e,t,n,r,o,i)}function Ia(e,t,n,r,i,o){Ta(e,t);var s=0!=(128&t.flags);if(!r&&!s)return i&&Fi(t,n,!1),Za(e,t,o);r=t.stateNode,_a.current=t;var a=s&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Ko(t,e.child,null,o),t.child=Ko(t,null,a,o)):ba(e,t,a,o),t.memoizedState=r.state,i&&Fi(t,n,!0),t.child}function Pa(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),is(e,t.containerInfo)}function Ra(e,t,n,r,i){return fo(),mo(i),t.flags|=256,ba(e,t,n,r),t.child}var La,Da,Oa,Na,ka={dehydrated:null,treeContext:null,retryLane:0};function Fa(e){return{baseLanes:e,cachePool:null,transitions:null}}function za(e,t,n){var r,i=t.pendingProps,s=ls.current,a=!1,l=0!=(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!=(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ti(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0==(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},0==(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Fc(l,i,0,null),e=kc(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Fa(n),t.memoizedState=ka,e):Ba(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Ua(e,t,a,r=ha(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Fc({mode:"visible",children:r.children},i,0,null),(s=kc(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!=(1&t.mode)&&Ko(t,e.child,null,a),t.child.memoizedState=Fa(a),t.memoizedState=ka,s);if(0==(1&t.mode))return Ua(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Ua(e,t,a,r=ha(s=Error(o(419)),r,void 0))}if(l=0!=(a&e.childLanes),xa||l){if(null!==(r=Pl)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!=(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Po(e,i),rc(r,e,i,-1))}return gc(),Ua(e,t,a,r=ha(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&($i[qi++]=Yi,$i[qi++]=Ki,$i[qi++]=Xi,Yi=e.id,Ki=e.overflow,Xi=t),(t=Ba(t,r.children)).flags|=4096,t)}(e,t,l,i,r,s,n);if(a){a=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0==(1&l)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Oc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Oc(r,a):(a=kc(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?Fa(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=ka,i}return e=(a=e.child).sibling,i=Oc(a,{mode:"visible",children:i.children}),0==(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Ba(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ua(e,t,n,r){return null!==r&&mo(r),Ko(t,e.child,null,n),(e=Ba(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ja(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Mo(e.return,t,n)}function Va(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Ga(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ba(e,t,r.children,n),0!=(2&(r=ls.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ja(e,n,t);else if(19===e.tag)ja(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ti(ls,r),0==(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===cs(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Va(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===cs(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Va(t,!0,n,null,o);break;case"together":Va(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0==(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Za(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0==(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Oc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function $a(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qa(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $a(t),null;case 1:case 17:return Li(t.type)&&Di(),$a(t),null;case 3:return r=t.stateNode,os(),Ei(Ii),Ei(Ai),hs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Da(e,t),$a(t),null;case 5:as(t);var i=rs(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)Oa(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return $a(t),null}if(e=rs(es.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[di]=t,r[pi]=s,e=0!=(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Y(r,s),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Br("invalid",r);break;case"textarea":ie(r,s),Br("invalid",r)}for(var l in ve(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"==typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Jr(r.textContent,c,e),i=["children",c]):"number"==typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Jr(r.textContent,c,e),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(n){case"input":W(r),Q(r,s,!0);break;case"textarea":W(r),se(r);break;case"select":case"option":break;default:"function"==typeof s.onClick&&(r.onclick=Qr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[di]=t,e[pi]=r,La(e,t,!1,!1),t.stateNode=e;e:{switch(l=_e(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Nr.length;i++)Br(Nr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":Y(e,r),i=X(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(s in ve(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ge(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"==typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"==typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Br("scroll",e):null!=u&&_(e,s,u,l))}switch(n){case"input":W(e),Q(e,r,!1);break;case"textarea":W(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Qr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return $a(t),null;case 6:if(e&&null!=t.stateNode)Na(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(o(166));if(n=rs(ns.current),rs(es.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Jr(r.nodeValue,n,0!=(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!=(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return $a(t),null;case 13:if(Ei(ls),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!=(1&t.mode)&&0==(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[di]=t}else fo(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;$a(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!=(128&t.flags)?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!=(1&t.mode)&&(null===e||0!=(1&ls.current)?0===Nl&&(Nl=3):gc())),null!==t.updateQueue&&(t.flags|=4),$a(t),null);case 4:return os(),Da(e,t),null===e&&Vr(t.stateNode.containerInfo),$a(t),null;case 10:return So(t.type._context),$a(t),null;case 19:if(Ei(ls),null===(s=t.memoizedState))return $a(t),null;if(r=0!=(128&t.flags),null===(l=s.rendering))if(r)Wa(s,!1);else{if(0!==Nl||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,Wa(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Ke()>Gl&&(t.flags|=128,r=!0,Wa(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=cs(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!io)return $a(t),null}else 2*Ke()-s.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,r=!0,Wa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ke(),t.sibling=null,n=ls.current,Ti(ls,r?1&n|2:1&n),t):($a(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!=(1&t.mode)?0!=(1073741824&Dl)&&($a(t),6&t.subtreeFlags&&(t.flags|=8192)):$a(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Xa(e,t){switch(to(t),t.tag){case 1:return Li(t.type)&&Di(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Ei(Ii),Ei(Ai),hs(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Ei(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ei(ls),null;case 4:return os(),null;case 10:return So(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}La=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},Oa=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,rs(es.current);var o,s=null;switch(n){case"input":i=X(e,i),r=X(e,r),s=[];break;case"select":i=F({},i,{value:void 0}),r=F({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Qr)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Br("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Na=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ya=!1,Ka=!1,Ja="function"==typeof WeakSet?WeakSet:Set,Qa=null;function el(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ec(e,t,n)}else n.current=null}function tl(e,t,n){try{n()}catch(n){Ec(e,t,n)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&tl(t,n,o)}i=i.next}while(i!==r)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[di],delete t[pi],delete t[mi],delete t[gi],delete t[yi]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Qr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function pl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"==typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(e){}switch(n.tag){case 5:Ka||el(n,t);case 6:var r=hl,i=dl;hl=null,pl(e,t,n),dl=i,null!==(hl=r)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Vt(e)):li(hl,n.stateNode));break;case 4:r=hl,i=dl,hl=n.stateNode.containerInfo,dl=!0,pl(e,t,n),hl=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Ka&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!=(2&o)||0!=(4&o))&&tl(n,t,s),i=i.next}while(i!==r)}pl(e,t,n);break;case 1:if(!Ka&&(el(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){Ec(n,t,e)}pl(e,t,n);break;case 21:pl(e,t,n);break;case 22:1&n.mode?(Ka=(r=Ka)||null!==n.memoizedState,pl(e,t,n),Ka=r):pl(e,t,n);break;default:pl(e,t,n)}}function ml(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ja),t.forEach((function(t){var r=Ic.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));fl(s,a,i),hl=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){Ec(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)yl(t,e),t=t.sibling}function yl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),vl(e),4&r){try{rl(3,e,e.return),il(3,e)}catch(t){Ec(e,e.return,t)}try{rl(5,e,e.return)}catch(t){Ec(e,e.return,t)}}break;case 1:gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(gl(t,e),vl(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(t){Ec(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&K(i,s),_e(l,a);var u=_e(l,s);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?ge(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):_(i,h,d,u)}switch(l){case"input":J(i,s);break;case"textarea":oe(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(t){Ec(e,e.return,t)}}break;case 6:if(gl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(t){Ec(e,e.return,t)}}break;case 3:if(gl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(t){Ec(e,e.return,t)}break;case 4:default:gl(t,e),vl(e);break;case 13:gl(t,e),vl(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Vl=Ke())),4&r&&ml(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ka=(u=Ka)||h,gl(t,e),Ka=u):gl(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!=(1&e.mode))for(Qa=e,h=e.child;null!==h;){for(d=Qa=h;null!==Qa;){switch(f=(p=Qa).child,p.tag){case 0:case 11:case 14:case 15:rl(4,p,p.return);break;case 1:el(p,p.return);var m=p.stateNode;if("function"==typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(e){Ec(r,n,e)}}break;case 5:el(p,p.return);break;case 22:if(null!==p.memoizedState){wl(d);continue}}null!==f?(f.return=p,Qa=f):wl(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"==typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,a=null!=(c=d.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(t){Ec(e,e.return,t)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(t){Ec(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gl(t,e),vl(e),4&r&&ml(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),ul(e,ll(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(t){Ec(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function _l(e,t,n){Qa=e,xl(e,t,n)}function xl(e,t,n){for(var r=0!=(1&e.mode);null!==Qa;){var i=Qa,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Ya;if(!s){var a=i.alternate,l=null!==a&&null!==a.memoizedState||Ka;a=Ya;var c=Ka;if(Ya=s,(Ka=l)&&!c)for(Qa=i;null!==Qa;)l=(s=Qa).child,22===s.tag&&null!==s.memoizedState?Sl(i):null!==l?(l.return=s,Qa=l):Sl(i);for(;null!==o;)Qa=o,xl(o,t,n),o=o.sibling;Qa=i,Ya=a,Ka=c}bl(e)}else 0!=(8772&i.subtreeFlags)&&null!==o?(o.return=i,Qa=o):bl(e)}}function bl(e){for(;null!==Qa;){var t=Qa;if(0!=(8772&t.flags)){var n=t.alternate;try{if(0!=(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ka||il(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ka)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:yo(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Bo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Bo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(o(163))}Ka||512&t.flags&&ol(t)}catch(e){Ec(t,t.return,e)}}if(t===e){Qa=null;break}if(null!==(n=t.sibling)){n.return=t.return,Qa=n;break}Qa=t.return}}function wl(e){for(;null!==Qa;){var t=Qa;if(t===e){Qa=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Qa=n;break}Qa=t.return}}function Sl(e){for(;null!==Qa;){var t=Qa;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(e){Ec(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Ec(t,i,e)}}var o=t.return;try{ol(t)}catch(e){Ec(t,o,e)}break;case 5:var s=t.return;try{ol(t)}catch(e){Ec(t,s,e)}}}catch(e){Ec(t,t.return,e)}if(t===e){Qa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Qa=a;break}Qa=t.return}}var Ml,El=Math.ceil,Tl=x.ReactCurrentDispatcher,Cl=x.ReactCurrentOwner,Al=x.ReactCurrentBatchConfig,Il=0,Pl=null,Rl=null,Ll=0,Dl=0,Ol=Mi(0),Nl=0,kl=null,Fl=0,zl=0,Bl=0,Ul=null,jl=null,Vl=0,Gl=1/0,Hl=null,Zl=!1,Wl=null,$l=null,ql=!1,Xl=null,Yl=0,Kl=0,Jl=null,Ql=-1,ec=0;function tc(){return 0!=(6&Il)?Ke():-1!==Ql?Ql:Ql=Ke()}function nc(e){return 0==(1&e.mode)?1:0!=(2&Il)&&0!==Ll?Ll&-Ll:null!==go.transition?(0===ec&&(ec=mt()),ec):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function rc(e,t,n,r){if(50<Kl)throw Kl=0,Jl=null,Error(o(185));yt(e,n,r),0!=(2&Il)&&e===Pl||(e===Pl&&(0==(2&Il)&&(zl|=n),4===Nl&&lc(e,Ll)),ic(e,r),1===n&&0===Il&&0==(1&t.mode)&&(Gl=Ke()+500,Bi&&Vi()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=i[s];-1===l?0!=(a&n)&&0==(a&r)||(i[s]=pt(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=dt(e,e===Pl?Ll:0);if(0===r)null!==n&&qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&qe(n),1===t)0===e.tag?function(e){Bi=!0,ji(e)}(cc.bind(null,e)):ji(cc.bind(null,e)),si((function(){0==(6&Il)&&Vi()})),n=null;else{switch(xt(r)){case 1:n=Qe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Pc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Ql=-1,ec=0,0!=(6&Il))throw Error(o(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=dt(e,e===Pl?Ll:0);if(0===r)return null;if(0!=(30&r)||0!=(r&e.expiredLanes)||t)t=yc(e,r);else{t=r;var i=Il;Il|=2;var s=mc();for(Pl===e&&Ll===t||(Hl=null,Gl=Ke()+500,pc(e,t));;)try{_c();break}catch(t){fc(e,t)}wo(),Tl.current=s,Il=i,null!==Rl?t=0:(Pl=null,Ll=0,t=Nl)}if(0!==t){if(2===t&&0!==(i=ft(e))&&(r=i,t=sc(e,i)),1===t)throw n=kl,pc(e,0),lc(e,r),ic(e,Ke()),n;if(6===t)lc(e,r);else{if(i=e.current.alternate,0==(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=yc(e,r))&&0!==(s=ft(e))&&(r=s,t=sc(e,s)),1===t))throw n=kl,pc(e,0),lc(e,r),ic(e,Ke()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:wc(e,jl,Hl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=Vl+500-Ke())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(wc.bind(null,e,jl,Hl),t);break}wc(e,jl,Hl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Ke()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=ri(wc.bind(null,e,jl,Hl),r);break}wc(e,jl,Hl);break;default:throw Error(o(329))}}}return ic(e,Ke()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=Ul;return e.current.memoizedState.isDehydrated&&(pc(e,t).flags|=256),2!==(e=yc(e,t))&&(t=jl,jl=n,null!==t&&ac(t)),e}function ac(e){null===jl?jl=e:jl.push.apply(jl,e)}function lc(e,t){for(t&=~Bl,t&=~zl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!=(6&Il))throw Error(o(327));Sc();var t=dt(e,0);if(0==(1&t))return ic(e,Ke()),null;var n=yc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=kl,pc(e,0),lc(e,t),ic(e,Ke()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,jl,Hl),ic(e,Ke()),null}function uc(e,t){var n=Il;Il|=1;try{return e(t)}finally{0===(Il=n)&&(Gl=Ke()+500,Bi&&Vi())}}function hc(e){null!==Xl&&0===Xl.tag&&0==(6&Il)&&Sc();var t=Il;Il|=1;var n=Al.transition,r=_t;try{if(Al.transition=null,_t=1,e)return e()}finally{_t=r,Al.transition=n,0==(6&(Il=t))&&Vi()}}function dc(){Dl=Ol.current,Ei(Ol)}function pc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Rl)for(n=Rl.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&Di();break;case 3:os(),Ei(Ii),Ei(Ai),hs();break;case 5:as(r);break;case 4:os();break;case 13:case 19:Ei(ls);break;case 10:So(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Pl=e,Rl=e=Oc(e.current,null),Ll=Dl=t,Nl=0,kl=null,Bl=zl=Fl=0,jl=Ul=null,null!==Co){for(t=0;t<Co.length;t++)if(null!==(r=(n=Co[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Co=null}return e}function fc(e,t){for(;;){var n=Rl;try{if(wo(),ds.current=sa,vs){for(var r=ms.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}vs=!1}if(fs=0,ys=gs=ms=null,_s=!1,xs=0,Cl.current=null,null===n||null===n.return){Nl=1,kl=t,Rl=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=Ll,l.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,h=l,d=h.tag;if(0==(1&h.mode)&&(0===d||11===d||15===d)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=ya(a);if(null!==f){f.flags&=-257,va(f,a,l,0,t),1&f.mode&&ga(s,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0==(1&t)){ga(s,u,t),gc();break e}c=Error(o(426))}else if(io&&1&l.mode){var y=ya(a);if(null!==y){0==(65536&y.flags)&&(y.flags|=256),va(y,a,l,0,t),mo(ua(c,l));break e}}s=c=ua(c,l),4!==Nl&&(Nl=2),null===Ul?Ul=[s]:Ul.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,fa(0,c,t));break e;case 1:l=c;var v=s.type,_=s.stateNode;if(0==(128&s.flags)&&("function"==typeof v.getDerivedStateFromError||null!==_&&"function"==typeof _.componentDidCatch&&(null===$l||!$l.has(_)))){s.flags|=65536,t&=-t,s.lanes|=t,Fo(s,ma(s,l,t));break e}}s=s.return}while(null!==s)}bc(n)}catch(e){t=e,Rl===n&&null!==n&&(Rl=n=n.return);continue}break}}function mc(){var e=Tl.current;return Tl.current=sa,null===e?sa:e}function gc(){0!==Nl&&3!==Nl&&2!==Nl||(Nl=4),null===Pl||0==(268435455&Fl)&&0==(268435455&zl)||lc(Pl,Ll)}function yc(e,t){var n=Il;Il|=2;var r=mc();for(Pl===e&&Ll===t||(Hl=null,pc(e,t));;)try{vc();break}catch(t){fc(e,t)}if(wo(),Il=n,Tl.current=r,null!==Rl)throw Error(o(261));return Pl=null,Ll=0,Nl}function vc(){for(;null!==Rl;)xc(Rl)}function _c(){for(;null!==Rl&&!Xe();)xc(Rl)}function xc(e){var t=Ml(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?bc(e):Rl=t,Cl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0==(32768&t.flags)){if(null!==(n=qa(n,t,Dl)))return void(Rl=n)}else{if(null!==(n=Xa(n,t)))return n.flags&=32767,void(Rl=n);if(null===e)return Nl=6,void(Rl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rl=t);Rl=t=e}while(null!==t);0===Nl&&(Nl=5)}function wc(e,t,n){var r=_t,i=Al.transition;try{Al.transition=null,_t=1,function(e,t,n,r){do{Sc()}while(null!==Xl);if(0!=(6&Il))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Pl&&(Rl=Pl=null,Ll=0),0==(2064&n.subtreeFlags)&&0==(2064&n.flags)||ql||(ql=!0,Pc(tt,(function(){return Sc(),null}))),s=0!=(15990&n.flags),0!=(15990&n.subtreeFlags)||s){s=Al.transition,Al.transition=null;var a=_t;_t=1;var l=Il;Il|=4,Cl.current=null,function(e,t){if(ei=Ht,pr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(e){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,p=null;t:for(;;){for(var f;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==s||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===n&&++u===i&&(l=a),p===s&&++h===r&&(c=a),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,Qa=t;null!==Qa;)if(e=(t=Qa).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,Qa=e;else for(;null!==Qa;){t=Qa;try{var m=t.alternate;if(0!=(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,_=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:yo(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(o(163))}}catch(e){Ec(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,Qa=e;break}Qa=t.return}m=nl,nl=!1}(e,n),yl(n,e),fr(ti),Ht=!!ei,ti=ei=null,e.current=n,_l(n,e,i),Ye(),Il=l,_t=a,Al.transition=s}else e.current=n;if(ql&&(ql=!1,Xl=e,Yl=i),0===(s=e.pendingLanes)&&($l=null),function(e){if(ot&&"function"==typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128==(128&e.current.flags))}catch(e){}}(n.stateNode),ic(e,Ke()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Zl)throw Zl=!1,e=Wl,Wl=null,e;0!=(1&Yl)&&0!==e.tag&&Sc(),0!=(1&(s=e.pendingLanes))?e===Jl?Kl++:(Kl=0,Jl=e):Kl=0,Vi()}(e,t,n,r)}finally{Al.transition=i,_t=r}return null}function Sc(){if(null!==Xl){var e=xt(Yl),t=Al.transition,n=_t;try{if(Al.transition=null,_t=16>e?16:e,null===Xl)var r=!1;else{if(e=Xl,Xl=null,Yl=0,0!=(6&Il))throw Error(o(331));var i=Il;for(Il|=4,Qa=e.current;null!==Qa;){var s=Qa,a=s.child;if(0!=(16&Qa.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Qa=u;null!==Qa;){var h=Qa;switch(h.tag){case 0:case 11:case 15:rl(8,h,s)}var d=h.child;if(null!==d)d.return=h,Qa=d;else for(;null!==Qa;){var p=(h=Qa).sibling,f=h.return;if(sl(h),h===u){Qa=null;break}if(null!==p){p.return=f,Qa=p;break}Qa=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}Qa=s}}if(0!=(2064&s.subtreeFlags)&&null!==a)a.return=s,Qa=a;else e:for(;null!==Qa;){if(0!=(2048&(s=Qa).flags))switch(s.tag){case 0:case 11:case 15:rl(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,Qa=v;break e}Qa=s.return}}var _=e.current;for(Qa=_;null!==Qa;){var x=(a=Qa).child;if(0!=(2064&a.subtreeFlags)&&null!==x)x.return=a,Qa=x;else e:for(a=_;null!==Qa;){if(0!=(2048&(l=Qa).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(e){Ec(l,l.return,e)}if(l===a){Qa=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Qa=b;break e}Qa=l.return}}if(Il=i,Vi(),ot&&"function"==typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(e){}r=!0}return r}finally{_t=n,Al.transition=t}}return!1}function Mc(e,t,n){e=No(e,t=fa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(yt(e,1,t),ic(e,t))}function Ec(e,t,n){if(3===e.tag)Mc(e,e,n);else for(;null!==t;){if(3===t.tag){Mc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===$l||!$l.has(r))){t=No(t,e=ma(t,e=ua(n,e),1),1),e=tc(),null!==t&&(yt(t,1,e),ic(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Pl===e&&(Ll&n)===n&&(4===Nl||3===Nl&&(130023424&Ll)===Ll&&500>Ke()-Vl?pc(e,0):Bl|=n),ic(e,t)}function Cc(e,t){0===t&&(0==(1&e.mode)?t=1:(t=ut,0==(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=Po(e,t))&&(yt(e,t,n),ic(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Cc(e,n)}function Pc(e,t){return $e(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,n,r){return new Rc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oc(e,t){var n=e.alternate;return null===n?((n=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nc(e,t,n,r,i,s){var a=2;if(r=e,"function"==typeof e)Dc(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case S:return kc(n.children,i,s,t);case M:a=8,i|=8;break;case E:return(e=Lc(12,n,t,2|i)).elementType=E,e.lanes=s,e;case I:return(e=Lc(13,n,t,i)).elementType=I,e.lanes=s,e;case P:return(e=Lc(19,n,t,i)).elementType=P,e.lanes=s,e;case D:return Fc(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case T:a=10;break e;case C:a=9;break e;case A:a=11;break e;case R:a=14;break e;case L:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Lc(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function kc(e,t,n,r){return(e=Lc(7,e,r,t)).lanes=n,e}function Fc(e,t,n,r){return(e=Lc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Lc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Uc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,i,o,s,a,l){return e=new Uc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Lc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lo(o),e}function Vc(e){if(!e)return Ci;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Li(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Li(n))return Ni(e,n,t)}return t}function Gc(e,t,n,r,i,o,s,a,l){return(e=jc(n,r,!0,e,0,o,0,a,l)).context=Vc(null),n=e.current,(o=Oo(r=tc(),i=nc(n))).callback=null!=t?t:null,No(n,o,i),e.current.lanes=i,yt(e,i,r),ic(e,r),e}function Hc(e,t,n,r){var i=t.current,o=tc(),s=nc(i);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Oo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=No(i,t,s))&&(rc(e,i,s,o),ko(e,i,s)),s}function Zc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function $c(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Ml=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)xa=!0;else{if(0==(e.lanes&n)&&0==(128&t.flags))return xa=!1,function(e,t,n){switch(t.tag){case 3:Pa(t),fo();break;case 5:ss(t);break;case 1:Li(t.type)&&ki(t);break;case 4:is(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ti(vo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ti(ls,1&ls.current),t.flags|=128,null):0!=(n&t.child.childLanes)?za(e,t,n):(Ti(ls,1&ls.current),null!==(e=Za(e,t,n))?e.sibling:null);Ti(ls,1&ls.current);break;case 19:if(r=0!=(n&t.childLanes),0!=(128&e.flags)){if(r)return Ga(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti(ls,ls.current),r)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return Za(e,t,n)}(e,t,n);xa=0!=(131072&e.flags)}else xa=!1,io&&0!=(1048576&t.flags)&&Qi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ha(e,t),e=t.pendingProps;var i=Ri(t,Ai.current);Eo(t,n),i=Ms(null,t,r,e,i,n);var s=Es();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Li(r)?(s=!0,ki(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Lo(t),i.updater=Vo,t.stateNode=i,i._reactInternals=t,Wo(t,r,e,n),t=Ia(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),ba(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return Dc(e)?1:0;if(null!=e){if((e=e.$$typeof)===A)return 11;if(e===R)return 14}return 2}(r),e=yo(r,e),i){case 0:t=Ca(null,t,r,e,n);break e;case 1:t=Aa(null,t,r,e,n);break e;case 11:t=wa(null,t,r,e,n);break e;case 14:t=Sa(null,t,r,yo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ca(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 1:return r=t.type,i=t.pendingProps,Aa(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 3:e:{if(Pa(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,Do(e,t),zo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Ra(e,t,r,n,i=ua(Error(o(423)),t));break e}if(r!==i){t=Ra(e,t,r,n,i=ua(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Jo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===i){t=Za(e,t,n);break e}ba(e,t,r,n)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ta(e,t),ba(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return za(e,t,n);case 4:return is(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ko(t,null,r,n):ba(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,wa(e,t,r,i=t.elementType===r?i:yo(r,i),n);case 7:return ba(e,t,t.pendingProps,n),t.child;case 8:case 12:return ba(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ti(vo,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Ii.current){t=Za(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Oo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Mo(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Mo(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ba(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Eo(t,n),r=r(i=To(i)),t.flags|=1,ba(e,t,r,n),t.child;case 14:return i=yo(r=t.type,t.pendingProps),Sa(e,t,r,i=yo(r.type,i),n);case 15:return Ma(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:yo(r,i),Ha(e,t),t.tag=1,Li(r)?(e=!0,ki(t)):e=!1,Eo(t,n),Ho(t,r,i),Wo(t,r,i,n),Ia(null,t,r,!0,e,n);case 19:return Ga(e,t,n);case 22:return Ea(e,t,n)}throw Error(o(156,t.tag))};var qc="function"==typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qc(){}function eu(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"==typeof i){var a=i;i=function(){var e=Zc(s);a.call(e)}}Hc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"==typeof r){var o=r;r=function(){var e=Zc(s);o.call(e)}}var s=Gc(t,r,e,0,null,!1,0,"",Qc);return e._reactRootContainer=s,e[fi]=s.current,Vr(8===e.nodeType?e.parentNode:e),hc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var a=r;r=function(){var e=Zc(l);a.call(e)}}var l=jc(e,0,!1,null,0,!1,0,"",Qc);return e._reactRootContainer=l,e[fi]=l.current,Vr(8===e.nodeType?e.parentNode:e),hc((function(){Hc(t,l,n,r)})),l}(n,t,e,i,r);return Zc(s)}Yc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Hc(e,t,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Hc(null,e,null,null)})),t[fi]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ft(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(vt(t,1|n),ic(t,Ke()),0==(6&Il)&&(Gl=Ke()+500,Vi()))}break;case 13:hc((function(){var t=Po(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),$c(e,1)}},wt=function(e){if(13===e.tag){var t=Po(e,134217728);null!==t&&rc(t,e,134217728,tc()),$c(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=Po(e,t);null!==n&&rc(n,e,t,tc()),$c(e,t)}},Mt=function(){return _t},Et=function(e,t){var n=_t;try{return _t=e,t()}finally{_t=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(o(90));$(r),J(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=uc,Ie=hc;var tu={usingClientEntryPoint:!1,Events:[_i,xi,bi,Te,Ce,uc]},nu={findFiberByHostInstance:vi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{it=iu.inject(ru),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Kc(e))throw Error(o(299));var n=!1,r="",i=qc;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=Ze(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Kc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=qc;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,i,0,s,a),e[fi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Yc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1739:(e,t,n)=>{"use strict";var r=n(1168);t.s=r.createRoot,r.hydrateRoot},1168:(e,t,n)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(534)},5918:(e,t,n)=>{"use strict";var r=n(7313),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},306:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function v(){}function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=_.prototype=new v;x.constructor=_,m(x,y.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)w.call(t,i)&&!M.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function T(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function I(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===o?"."+A(l,0):o,b(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),I(s,t,i,"",(function(e){return e}))):null!=s&&(T(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",b(e))for(var c=0;c<e.length;c++){var u=o+A(a=e[c],c);l+=I(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=I(a=a.value,t,i,u=o+A(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var r=[],i=0;return I(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},D={transition:null},O={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};t.Children={map:P,forEach:function(e,t,n){P(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return P(e,(function(){t++})),t},toArray:function(e){return P(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=s,t.PureComponent=_,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!M.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return L.current.useTransition()},t.version="18.2.0"},7313:(e,t,n)=>{"use strict";e.exports=n(306)},6417:(e,t,n)=>{"use strict";e.exports=n(5918)},9390:(e,t,n)=>{"use strict";var r=n(6889).functionsHaveConfigurableNames(),i=Object,o=TypeError;e.exports=function(){if(null!=this&&this!==i(this))throw new o("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},r&&Object.defineProperty&&Object.defineProperty(e.exports,"name",{value:"get flags"})},9012:(e,t,n)=>{"use strict";var r=n(9959),i=n(9962),o=n(9390),s=n(533),a=n(6068),l=i(s());r(l,{getPolyfill:s,implementation:o,shim:a}),e.exports=l},533:(e,t,n)=>{"use strict";var r=n(9390),i=n(9959).supportsDescriptors,o=Object.getOwnPropertyDescriptor;e.exports=function(){if(i&&"gim"===/a/gim.flags){var e=o(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),"dy"===t)return e.get}}return r}},6068:(e,t,n)=>{"use strict";var r=n(9959).supportsDescriptors,i=n(533),o=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=TypeError,l=Object.getPrototypeOf,c=/a/;e.exports=function(){if(!r||!l)throw new a("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=i(),t=l(c),n=o(t,"flags");return n&&n.get===e||s(t,"flags",{configurable:!0,enumerable:!1,get:e}),e}},4820:function(e,t){!function(e){"use strict";const t=134217729;function n(e,t,n,r,i){let o,s,a,l,c=t[0],u=r[0],h=0,d=0;u>c==u>-c?(o=c,c=t[++h]):(o=u,u=r[++d]);let p=0;if(h<e&&d<n)for(u>c==u>-c?(a=o-((s=c+o)-c),c=t[++h]):(a=o-((s=u+o)-u),u=r[++d]),o=s,0!==a&&(i[p++]=a);h<e&&d<n;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++d]),o=s,0!==a&&(i[p++]=a);for(;h<e;)a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h],o=s,0!==a&&(i[p++]=a);for(;d<n;)a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++d],o=s,0!==a&&(i[p++]=a);return 0===o&&0!==p||(i[p++]=o),p}function r(e){return new Float64Array(e)}const i=r(4),o=r(8),s=r(12),a=r(16),l=r(4);e.orient2d=function(e,r,c,u,h,d){const p=(r-d)*(c-h),f=(e-h)*(u-d),m=p-f;if(0===p||0===f||p>0!=f>0)return m;const g=Math.abs(p+f);return Math.abs(m)>=33306690738754716e-32*g?m:-function(e,r,c,u,h,d,p){let f,m,g,y,v,_,x,b,w,S,M,E,T,C,A,I,P,R;const L=e-h,D=c-h,O=r-d,N=u-d;v=(A=(b=L-(x=(_=t*L)-(_-L)))*(S=N-(w=(_=t*N)-(_-N)))-((C=L*N)-x*w-b*w-x*S))-(M=A-(P=(b=O-(x=(_=t*O)-(_-O)))*(S=D-(w=(_=t*D)-(_-D)))-((I=O*D)-x*w-b*w-x*S))),i[0]=A-(M+v)+(v-P),v=(T=C-((E=C+M)-(v=E-C))+(M-v))-(M=T-I),i[1]=T-(M+v)+(v-I),v=(R=E+M)-E,i[2]=E-(R-v)+(M-v),i[3]=R;let k=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,i),F=22204460492503146e-32*p;if(k>=F||-k>=F)return k;if(f=e-(L+(v=e-L))+(v-h),g=c-(D+(v=c-D))+(v-h),m=r-(O+(v=r-O))+(v-d),y=u-(N+(v=u-N))+(v-d),0===f&&0===m&&0===g&&0===y)return k;if(F=11093356479670487e-47*p+33306690738754706e-32*Math.abs(k),(k+=L*y+N*f-(O*g+D*m))>=F||-k>=F)return k;v=(A=(b=f-(x=(_=t*f)-(_-f)))*(S=N-(w=(_=t*N)-(_-N)))-((C=f*N)-x*w-b*w-x*S))-(M=A-(P=(b=m-(x=(_=t*m)-(_-m)))*(S=D-(w=(_=t*D)-(_-D)))-((I=m*D)-x*w-b*w-x*S))),l[0]=A-(M+v)+(v-P),v=(T=C-((E=C+M)-(v=E-C))+(M-v))-(M=T-I),l[1]=T-(M+v)+(v-I),v=(R=E+M)-E,l[2]=E-(R-v)+(M-v),l[3]=R;const z=n(4,i,4,l,o);v=(A=(b=L-(x=(_=t*L)-(_-L)))*(S=y-(w=(_=t*y)-(_-y)))-((C=L*y)-x*w-b*w-x*S))-(M=A-(P=(b=O-(x=(_=t*O)-(_-O)))*(S=g-(w=(_=t*g)-(_-g)))-((I=O*g)-x*w-b*w-x*S))),l[0]=A-(M+v)+(v-P),v=(T=C-((E=C+M)-(v=E-C))+(M-v))-(M=T-I),l[1]=T-(M+v)+(v-I),v=(R=E+M)-E,l[2]=E-(R-v)+(M-v),l[3]=R;const B=n(z,o,4,l,s);v=(A=(b=f-(x=(_=t*f)-(_-f)))*(S=y-(w=(_=t*y)-(_-y)))-((C=f*y)-x*w-b*w-x*S))-(M=A-(P=(b=m-(x=(_=t*m)-(_-m)))*(S=g-(w=(_=t*g)-(_-g)))-((I=m*g)-x*w-b*w-x*S))),l[0]=A-(M+v)+(v-P),v=(T=C-((E=C+M)-(v=E-C))+(M-v))-(M=T-I),l[1]=T-(M+v)+(v-I),v=(R=E+M)-E,l[2]=E-(R-v)+(M-v),l[3]=R;const U=n(B,s,4,l,a);return a[U-1]}(e,r,c,u,h,d,g)},e.orient2dfast=function(e,t,n,r,i,o){return(t-o)*(n-i)-(e-i)*(r-o)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},3095:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,p=3,f=!1,m=!1,g=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,_="undefined"!=typeof setImmediate?setImmediate:null;function x(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function b(e){if(g=!1,x(e),!m)if(null!==r(c))m=!0,D(w);else{var t=r(u);null!==t&&O(b,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,v(T),T=-1),f=!0;var o=p;try{for(x(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!I());){var s=d.callback;if("function"==typeof s){d.callback=null,p=d.priorityLevel;var a=s(d.expirationTime<=n);n=t.unstable_now(),"function"==typeof a?d.callback=a:d===r(c)&&i(c),x(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&O(b,h.startTime-n),l=!1}return l}finally{d=null,p=o,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,M=!1,E=null,T=-1,C=5,A=-1;function I(){return!(t.unstable_now()-A<C)}function P(){if(null!==E){var e=t.unstable_now();A=e;var n=!0;try{n=E(!0,e)}finally{n?S():(M=!1,E=null)}}else M=!1}if("function"==typeof _)S=function(){_(P)};else if("undefined"!=typeof MessageChannel){var R=new MessageChannel,L=R.port2;R.port1.onmessage=P,S=function(){L.postMessage(null)}}else S=function(){y(P,0)};function D(e){E=e,M||(M=!0,S())}function O(e,n){T=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(g?(v(T),T=-1):g=!0,O(b,o-s))):(e.sortIndex=a,n(c,e),m||f||(m=!0,D(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},2224:(e,t,n)=>{"use strict";e.exports=n(3095)},7460:e=>{"use strict";e.exports={eudist:function(e,t,n){for(var r=e.length,i=0,o=0;o<r;o++){var s=(e[o]||0)-(t[o]||0);i+=s*s}return n?Math.sqrt(i):i},mandist:function(e,t,n){for(var r=e.length,i=0,o=0;o<r;o++)i+=Math.abs((e[o]||0)-(t[o]||0));return n?Math.sqrt(i):i},dist:function(e,t,n){var r=Math.abs(e-t);return n?r:r*r}}},5424:(e,t,n)=>{"use strict";var r=n(7460),i=r.eudist,o=r.dist;e.exports={kmrand:function(e,t){for(var n={},r=[],i=t<<2,o=e.length,s=e[0].length>0;r.length<t&&i-- >0;){var a=e[Math.floor(Math.random()*o)],l=s?a.join("_"):""+a;n[l]||(n[l]=!0,r.push(a))}if(r.length<t)throw new Error("Error initializating clusters");return r},kmpp:function(e,t){var n=e[0].length?i:o,r=[],s=e.length,a=e[0].length>0,l=e[Math.floor(Math.random()*s)];for(a&&l.join("_"),r.push(l);r.length<t;){for(var c=[],u=r.length,h=0,d=[],p=0;p<s;p++){for(var f=1/0,m=0;m<u;m++){var g=n(e[p],r[m]);g<=f&&(f=g)}c[p]=f}for(var y=0;y<s;y++)h+=c[y];for(var v=0;v<s;v++)d[v]={i:v,v:e[v],pr:c[v]/h,cs:0};d.sort((function(e,t){return e.pr-t.pr})),d[0].cs=d[0].pr;for(var _=1;_<s;_++)d[_].cs=d[_-1].cs+d[_].pr;for(var x=Math.random(),b=0;b<s-1&&d[b++].cs<x;);r.push(d[b-1].v)}return r}}},2094:(e,t,n)=>{"use strict";var r=n(7460),i=n(5424),o=r.eudist,s=(r.mandist,r.dist,i.kmrand),a=i.kmpp;function l(e,t,n){n=n||[];for(var r=0;r<e;r++)n[r]=t;return n}e.exports=function(e,t,n,r){var i=[],c=[],u=[],h=[],d=!1,p=r||1e4,f=e.length,m=e[0].length,g=m>0,y=[];if(n)i="kmrand"==n?s(e,t):"kmpp"==n?a(e,t):n;else for(var v={};i.length<t;){var _=Math.floor(Math.random()*f);v[_]||(v[_]=!0,i.push(e[_]))}do{l(t,0,y);for(var x=0;x<f;x++){for(var b=1/0,w=0,S=0;S<t;S++)(h=g?o(e[x],i[S]):Math.abs(e[x]-i[S]))<=b&&(b=h,w=S);u[x]=w,y[w]++}for(var M=[],E=(c=[],0);E<t;E++)M[E]=g?l(m,0,M[E]):0,c[E]=i[E];if(g){for(var T=0;T<t;T++)i[T]=[];for(var C=0;C<f;C++)for(var A=M[u[C]],I=e[C],P=0;P<m;P++)A[P]+=I[P];d=!0;for(var R=0;R<t;R++){for(var L=i[R],D=M[R],O=c[R],N=y[R],k=0;k<m;k++)L[k]=D[k]/N||0;if(d)for(var F=0;F<m;F++)if(O[F]!=L[F]){d=!1;break}}}else{for(var z=0;z<f;z++)M[u[z]]+=e[z];for(var B=0;B<t;B++)i[B]=M[B]/y[B]||0;d=!0;for(var U=0;U<t;U++)if(c[U]!=i[U]){d=!1;break}}d=d||--p<=0}while(!d);return{it:1e4-p,k:t,idxs:u,centroids:i}}},1462:(e,t,n)=>{e.exports={Threebox:n(5772),THREE:n(61)}},5772:(e,t,n)=>{const r=n(61),i=n(4306),o=n(4132),s=n(1639),a=n(8604),l=n(3019),c=n(6475),u=n(9849),h=n(444),d=n(5749),p=n(6148),f=n(6057),m=n(7089),g=n(7981),y=n(8818),v=n(5919),_=n(1118);function x(e,t,n){this.init(e,t,n)}x.prototype={repaint:function(){this.map.repaint=!0},init:function(e,t,n){this.options=o._validate(n||{},b),this.map=e,this.map.tb=this,this.objects=new l,this.mapboxVersion=parseFloat(this.map.version),this.renderer=new r.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,canvas:e.getCanvas(),context:t}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=r.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new v(this.map),this.scene=new r.Scene,this.world=new r.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new r.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=o.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.defaultCursor="default",this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.skyLayerName="sky-layer",this.terrainSourceName="mapbox-dem",this.terrainExaggeration=1,this.terrainLayerName="",this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.enableHelpTooltips=this.options.enableHelpTooltips||!1,this.map.on("style.load",(function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(e,t){},render:function(e,t){this.map.tb.update()}}),this.once("idle",(()=>{this.tb.setObjectsScale()})),this.tb.options.sky&&(this.tb.sky=!0),this.tb.options.terrain&&(this.tb.terrain=!0),["satellite","mapbox-mapbox-satellite","satelliteLayer"].forEach((e=>{this.getLayer(e)&&(this.tb.terrainLayerName=e)}))})),this.map.on("load",(function(){let t;this.selectedObject,this.selectedFeature,this.draggedObject,this.overedObject,this.overedFeature;let n,r=this.getCanvasContainer();this.getCanvasContainer().style.cursor=this.tb.defaultCursor;let i,s,a,l,c=[];function u(e){var t=r.getBoundingClientRect();return{x:e.originalEvent.clientX-t.left-r.clientLeft,y:e.originalEvent.clientY-t.top-r.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(e){void 0!==e.id&&(this.setFeatureState({source:e.source,sourceLayer:e.sourceLayer,id:e.id},{select:!1}),this.removeTooltip(e),(e=this.queryRenderedFeatures({layers:[e.layer.id],filter:["==",["id"],e.id]})[0])&&this.fire("SelectedFeatureChange",{detail:e}),this.selectedFeature=null)},this.selectFeature=function(e){this.selectedFeature=e,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(t){this.overedFeature&&void 0!==this.overedFeature&&this.overedFeature.id!=t&&(e.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(e){if(!this.tb.enableTooltips)return;let t=this.tb.getFeatureCenter(e),n=this.tb.tooltip({text:e.properties.name||e.id||e.type,mapboxStyle:!0,feature:e});n.setCoords(t),this.tb.add(n,e.layer.id),e.tooltip=n,e.tooltip.tooltip.visible=!0},this.removeTooltip=function(e){e.tooltip&&(e.tooltip.visibility=!1,this.tb.remove(e.tooltip),e.tooltip=null)},e.onContextMenu=function(e){alert("contextMenu")},this.onClick=function(t){let n,r=[];if(e.tb.enableSelectingObjects&&(r=this.tb.queryRenderedFeatures(t.point)),n="object"==typeof r[0],n){let e=x.prototype.findParent3DObject(r[0]);if(e){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),this.selectedObject){if(this.selectedObject.uuid!=e.uuid)this.selectedObject.selected=!1,e.selected=!0,this.selectedObject=e;else if(this.selectedObject.uuid==e.uuid)return void this.unselectObject()}else this.selectedObject=e,this.selectedObject.selected=!0;this.selectedObject.dispatchEvent({type:"Wireframed",detail:this.selectedObject}),this.selectedObject.dispatchEvent({type:"IsPlayingChanged",detail:this.selectedObject}),this.repaint=!0,t.preventDefault()}}else{let n=[];if(e.tb.enableSelectingFeatures&&(n=this.queryRenderedFeatures(t.point)),n.length>0&&"fill-extrusion"==n[0].layer.type&&void 0!==n[0].id)if(this.selectedObject&&this.unselectObject(),this.selectedFeature){if(this.selectedFeature.id!=n[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(n[0]);else if(this.selectedFeature.id==n[0].id)return void this.unselectFeature(this.selectedFeature)}else this.selectFeature(n[0])}},this.onMouseMove=function(r){let o,c=u(r);if(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,r.originalEvent.altKey&&this.draggedObject){if(!e.tb.enableRotatingObjects)return;t="rotate",this.getCanvasContainer().style.cursor="move",Math.min(n.x,c.x),Math.max(n.x,c.x),Math.min(n.y,c.y),Math.max(n.y,c.y);let r={x:0,y:0,z:Math.round(l[2]+~~((c.x-n.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};return this.draggedObject.setRotation(r),void(e.tb.enableHelpTooltips&&this.draggedObject.addHelp("rot: "+r.z+"&#176;"))}if(r.originalEvent.shiftKey&&this.draggedObject){if(!e.tb.enableDraggingObjects)return;t="translate",this.getCanvasContainer().style.cursor="move";let n=r.lngLat,o=[Number((n.lng+i).toFixed(this.tb.gridStep)),Number((n.lat+s).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];return this.draggedObject.setCoords(o),void(e.tb.enableHelpTooltips&&this.draggedObject.addHelp("lng: "+o[0]+"&#176;, lat: "+o[1]+"&#176;"))}if(r.originalEvent.ctrlKey&&this.draggedObject){if(!e.tb.enableDraggingObjects)return;t="altitude",this.getCanvasContainer().style.cursor="move";let n=r.point.y*this.tb.altitudeStep,i=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-n-a).toFixed(this.tb.gridStep))];return this.draggedObject.setCoords(i),void(e.tb.enableHelpTooltips&&this.draggedObject.addHelp("alt: "+i[2]+"m"))}let h=[];if(e.tb.enableSelectingObjects&&(h=this.tb.queryRenderedFeatures(r.point)),o="object"==typeof h[0],o){let e=x.prototype.findParent3DObject(h[0]);e&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",this.selectedObject&&e.uuid==this.selectedObject.uuid?this.selectedObject&&e.uuid==this.selectedObject.uuid&&(e.over=!0,this.overedObject=e):(this.overedObject&&this.overedObject.uuid!=e.uuid&&this.outObject(),e.over=!0,this.overedObject=e),this.repaint=!0,r.preventDefault())}else{this.overedObject&&this.outObject();let t=[];e.tb.enableSelectingFeatures&&(t=this.queryRenderedFeatures(r.point)),t.length>0&&(this.outFeature(t[0]),"fill-extrusion"==t[0].layer.type&&void 0!==t[0].id&&(this.selectedFeature&&this.selectedFeature.id==t[0].id||(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=t[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=e.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature))))}},this.onMouseDown=function(t){(t.originalEvent.shiftKey||t.originalEvent.altKey||t.originalEvent.ctrlKey)&&0===t.originalEvent.button&&this.selectedObject&&(e.tb.enableDraggingObjects||e.tb.enableRotatingObjects)&&(t.preventDefault(),e.getCanvasContainer().style.cursor="move",e.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,n=u(t),c=this.draggedObject.coordinates,l=o.degreeify(this.draggedObject.rotation),i=c[0]-t.lngLat.lng,s=c[1]-t.lngLat.lat,a=-this.draggedObject.modelHeight-t.point.y*this.tb.altitudeStep)},this.onMouseUp=function(e){this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent({type:"ObjectDragged",detail:{draggedObject:this.draggedObject,draggedAction:t}}),this.draggedObject.removeHelp(),this.draggedObject=null,t=null)},this.onMouseOut=function(e){if(this.overedFeature){let t=this.queryRenderedFeatures(e.point);t.length>0&&this.overedFeature.id!=t[0].id&&(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.outFeature(t[0]))}},this.onZoom=function(e){this.tb.zoomLayers.forEach((e=>{this.tb.toggleLayer(e)})),this.tb.setObjectsScale()};let h=!1,d=!1;this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),this.on("zoomend",this.onZoom),document.addEventListener("keydown",function(t){17!==t.which&&91!==t.which||(h=!0),16===t.which&&(d=!0);let n=this.selectedObject;if(d&&83===t.which&&n){let t=o.toDecimal;if(n.help)n.removeHelp();else{let r=n.modelSize,i=1;"meters"!==n.userData.units&&(i=o.projectedUnitsPerMeter(n.coordinates[1]),i||(i=1),i=t(i,7)),e.tb.enableHelpTooltips&&n.addHelp("size(m): "+t(r.x/i,3)+" W, "+t(r.y/i,3)+" L, "+t(r.z/i,3)+" H"),this.repaint=!0}return!1}}.bind(this),!0),document.addEventListener("keyup",function(e){17!=e.which&&91!=e.which||(h=!1),16===e.which&&(d=!1)}.bind(this))}))},get sky(){return this.options.sky},set sky(e){e?this.createSkyLayer():this.removeLayer(this.skyLayerName),this.options.sky=e},get terrain(){return this.options.terrain},set terrain(e){if(this.terrainLayerName="",e)this.createTerrainLayer();else{if(this.mapboxVersion<2)return void console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0");this.map.getTerrain()&&(this.map.setTerrain(null),this.map.removeSource(this.terrainSourceName))}this.options.terrain=e},get fov(){return this.options.fov},set fov(e){this.camera instanceof r.PerspectiveCamera&&this.options.fov!==e&&(this.map.transform.fov=e,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=e)},get orthographic(){return this.options.orthographic},set orthographic(e){const t=this.map.getCanvas().clientHeight,n=this.map.getCanvas().clientWidth;e?(this.map.transform.fov=0,this.camera=new r.OrthographicCamera(n/-2,n/2,t/2,t/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new r.PerspectiveCamera(this.map.transform.fov,n/t,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new i(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=e},createSkyLayer:function(){if(this.mapboxVersion<2)return console.warn("Sky layer are only supported by Mapbox-gl-js > v2.0"),void(this.options.sky=!1);this.map.getLayer(this.skyLayerName)||(this.map.addLayer({id:this.skyLayerName,type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun":this.getSunSky(this.lightDateTime),"sky-atmosphere-sun-intensity":10}}),this.map.once("idle",(()=>{this.setSunlight(),this.repaint()})))},createTerrainLayer:function(){if(this.mapboxVersion<2)return console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0"),void(this.options.terrain=!1);this.map.getTerrain()||(this.map.addSource(this.terrainSourceName,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.map.setTerrain({source:this.terrainSourceName,exaggeration:this.terrainExaggeration}),this.map.once("idle",(()=>{this.cameraSync.updateCamera(),this.repaint()})))},sphere:function(e){return this.setDefaultView(e,this.options),u(e,this.world)},line:g,label:d,tooltip:p,tube:function(e){return this.setDefaultView(e,this.options),y(e,this.world)},extrusion:function(e){return this.setDefaultView(e,this.options),h(e)},Object3D:function(e){return this.setDefaultView(e,this.options),m(e)},loadObj:async function(e,t){if(this.setDefaultView(e,this.options),!1===e.clone)return new Promise((async n=>{f(e,t,(async e=>{n(e)}))}));{let n=this.objectsCache.get(e.obj);n?n.promise.then((n=>{t(n.duplicate(e))})).catch((t=>{this.objectsCache.delete(e.obj),console.error("Could not load model file: "+e.obj)})):this.objectsCache.set(e.obj,{promise:new Promise((async(n,r)=>{f(e,t,(async e=>{e.duplicate?n(e.duplicate()):r(e)}))}))})}},material:function(e){return c(e)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:o,SunCalc:s,Constants:a,projectToWorld:function(e){return this.utils.projectToWorld(e)},unprojectFromWorld:function(e){return this.utils.unprojectFromWorld(e)},projectedUnitsPerMeter:function(e){return this.utils.projectedUnitsPerMeter(e)},getFeatureCenter:function(e,t,n){return o.getFeatureCenter(e,t,n)},getObjectHeightOnFloor:function(e,t,n){return o.getObjectHeightOnFloor(e,t,n)},queryRenderedFeatures:function(e){let t=new r.Vector2;return t.x=e.x/this.map.transform.width*2-1,t.y=1-e.y/this.map.transform.height*2,this.raycaster.setFromCamera(t,this.camera),this.raycaster.intersectObjects(this.world.children,!0)},findParent3DObject:function(e){var t;return e.object.traverseAncestors((function(e){e.parent&&"Group"==e.parent.type&&e.userData.obj&&(t=e)})),t},setLayoutProperty:function(e,t,n){this.map.setLayoutProperty(e,t,n),null!=n&&"visibility"===t&&this.world.children.filter((t=>t.layer===e)).forEach((e=>{e.visibility=n}))},setLayerZoomRange:function(e,t,n){this.map.getLayer(e)&&(this.map.setLayerZoomRange(e,t,n),this.zoomLayers.includes(e)||this.zoomLayers.push(e),this.toggleLayer(e))},setLayerHeigthProperty:function(e,t){let n=this.map.getLayer(e);if(n)if("fill-extrusion"==n.type){let e=this.map.getStyle().sources[n.source].data;e.features.forEach((function(e){e.properties.level=t})),this.map.getSource(n.source).setData(e)}else"custom"==n.type&&this.world.children.forEach((function(n){let r=n.userData.feature;if(r&&r.layer===e){let e=this.tb.getFeatureCenter(r,n,t);n.setCoords(e)}}))},setObjectsScale:function(){this.world.children.filter((e=>null!=e.fixedZoom)).forEach((e=>{e.setObjectScale(this.map.transform.scale)}))},setStyle:function(e,t){this.clear().then((()=>{this.map.setStyle(e,t)}))},toggleLayer:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.map.getLayer(e);if(n){if(!t)return void this.toggle(n.id,!1);let e=this.map.getZoom();if(n.minzoom&&e<n.minzoom)return void this.toggle(n.id,!1);if(n.maxzoom&&e>=n.maxzoom)return void this.toggle(n.id,!1);this.toggle(n.id,!0)}},toggle:function(e,t){this.setLayoutProperty(e,"visibility",t?"visible":"none"),this.labelRenderer.toggleLabels(e,t)},update:function(){this.map.repaint&&(this.map.repaint=!1);var e=Date.now();this.objects.animationManager.update(e),this.updateLightHelper(),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),!1===this.options.passiveRendering&&this.map.triggerRepaint()},add:function(e,t,n){if(!this.enableTooltips&&e.tooltip&&(e.tooltip.visibility=!1),this.world.add(e),t){e.layer=t,e.source=n;let r=this.map.getLayer(t);if(r){let t=r.visibility,n=void 0===t;e.visibility=!(!n&&"visible"!==t)}}},removeByName:function(e){let t=this.world.getObjectByName(e);t&&this.remove(t)},remove:function(e){this.map.selectedObject&&e.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&e.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),e.dispose&&e.dispose(),this.world.remove(e),e=null},clear:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(((n,r)=>{let i=[];this.world.children.forEach((function(e){i.push(e)}));for(let t=0;t<i.length;t++){let n=i[t];n.layer!==e&&e||this.remove(n)}t&&this.objectsCache.forEach((e=>{e.promise.then((e=>{e.dispose(),e=null}))})),n("clear")}))},removeLayer:function(e){this.clear(e,!0).then((()=>{this.map.removeLayer(e)}))},getSunPosition:function(e,t){return s.getPosition(e||Date.now(),t[1],t[0])},getSunTimes:function(e,t){return s.getTimes(e,t[1],t[0],t[2]?t[2]:0)},setBuildingShadows:function(e){if(this.map.getLayer(e.buildingsLayerId)){let t=new _(e,this);this.map.addLayer(t,e.buildingsLayerId)}else console.warn("The layer '"+e.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1?arguments[1]:void 0;if(!this.lights.dirLight||!this.options.realSunlight)return void console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");var n=new Date(e.getTime());if(t?t.lng&&t.lat?this.mapCenter=t:this.mapCenter={lng:t[0],lat:t[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===n.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=n,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(n,[this.mapCenter.lng,this.mapCenter.lat]);let r=this.sunPosition.altitude,i=Math.PI+this.sunPosition.azimuth,o=a.WORLD_SIZE/2,s=Math.sin(r),l=Math.cos(r),c=Math.cos(i)*l,u=Math.sin(i)*l;this.lights.dirLight.position.set(u,c,s),this.lights.dirLight.position.multiplyScalar(o),this.lights.dirLight.intensity=Math.max(s,0),this.lights.hemiLight.intensity=Math.max(1*s,.1),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&(this.updateSunGround(this.sunPosition),this.map.setLight({anchor:"map",position:[3,180+180*this.sunPosition.azimuth/Math.PI,90-180*this.sunPosition.altitude/Math.PI],intensity:Math.cos(this.sunPosition.altitude),color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${Math.max(20,20+96*Math.sin(this.sunPosition.altitude))}%)`},{duration:0}),this.sky&&this.updateSunSky(this.getSunSky(n,this.sunPosition)))},getSunSky:function(e,t){if(!t){var n=this.map.getCenter();t=this.getSunPosition(e||Date.now(),[n.lng,n.lat])}return[180+180*t.azimuth/Math.PI,90-180*t.altitude/Math.PI]},updateSunSky:function(e){this.sky&&this.map.setPaintProperty(this.skyLayerName,"sky-atmosphere-sun",e)},updateSunGround:function(e){""!=this.terrainLayerName&&this.map.setPaintProperty(this.terrainLayerName,"raster-opacity",Math.max(Math.min(1,4*e.altitude),.25))},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise((e=>{e(this.clear(null,!0).then((e=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),e))))}))},defaultLights:function(){this.lights.ambientLight=new r.AmbientLight(new r.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new r.DirectionalLight(new r.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new r.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),e&&(this.lights.dirLightHelper=new r.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper)),this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=2,this.lights.dirLight.shadow.mapSize.width=8192,this.lights.dirLight.shadow.mapSize.height=8192,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=1e3,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-1e3,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new r.HemisphereLight(new r.Color(16777215),new r.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight(),this.map.once("idle",(()=>{this.setSunlight(),this.repaint()}))},setDefaultView:function(e,t){e.bbox=(e.bbox||null==e.bbox)&&t.enableSelectingObjects,e.tooltip=(e.tooltip||null==e.tooltip)&&t.enableTooltips,e.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.2.7"};var b={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,enableHelpTooltips:!1,multiLayer:!1,orthographic:!1,fov:a.FOV_DEGREES,sky:!1,terrain:!1};e.exports=x},3799:(e,t,n)=>{const r=n(61),i=n(4132);function o(e){this.map=e,this.enrolledObjects=[],this.previousFrameTime}o.prototype={unenroll:function(e){this.enrolledObjects.splice(this.enrolledObjects.indexOf(e),1)},enroll:function(e){if(e.clock=new r.Clock,e.hasDefaultAnimation=!1,e.defaultAction,e.actions=[],e.mixer,e.animations&&e.animations.length>0){e.hasDefaultAnimation=!0;let n=e.userData.defaultAnimation?e.userData.defaultAnimation:0;e.mixer=new r.AnimationMixer(e),t(n)}function t(t){for(let n=0;n<e.animations.length;n++){t>e.animations.length&&console.log("The animation index "+t+" doesn't exist for this object");let r=e.animations[n],i=e.mixer.clipAction(r);e.actions.push(i),t===n?(e.defaultAction=i,i.setEffectiveWeight(1)):i.setEffectiveWeight(0),i.play()}}let n=!1;Object.defineProperty(e,"isPlaying",{get:()=>n,set(t){n!=t&&(n=t,e.dispatchEvent({type:"IsPlayingChanged",detail:e}))}}),this.enrolledObjects.push(e),e.animationQueue=[],e.set=function(t){if(t.duration>0){let n={start:Date.now(),expiration:Date.now()+t.duration,endState:{}};i.extend(t,n);let o=t.coords,s=t.rotation,a=t.scale||t.scaleX||t.scaleY||t.scaleZ;if(s){let n=e.rotation;t.startRotation=[n.x,n.y,n.z],t.endState.rotation=i.types.rotation(t.rotation,t.startRotation),t.rotationPerMs=t.endState.rotation.map((function(e,n){return(e-t.startRotation[n])/t.duration}))}if(a){let n=e.scale;t.startScale=[n.x,n.y,n.z],t.endState.scale=i.types.scale(t.scale,t.startScale),t.scalePerMs=t.endState.scale.map((function(e,n){return(e-t.startScale[n])/t.duration}))}o&&(t.pathCurve=new r.CatmullRomCurve3(i.lnglatsToWorld([e.coordinates,t.coords])));let l={type:"set",parameters:t};this.animationQueue.push(l),tb.map.repaint=!0}else this.stop(),t.rotation=i.radify(t.rotation),this._setObject(t);return this},e.animationMethod=null,e.stop=function(t){return e.mixer&&(e.isPlaying=!1,cancelAnimationFrame(e.animationMethod)),this.animationQueue=[],this},e.followPath=function(e,t){let n={type:"followPath",parameters:i._validate(e,s.followPath)};return i.extend(n.parameters,{pathCurve:new r.CatmullRomCurve3(i.lnglatsToWorld(e.path)),start:Date.now(),expiration:Date.now()+n.parameters.duration,cb:t}),this.animationQueue.push(n),tb.map.repaint=!0,this},e._setObject=function(t){e.setScale();let n=t.position,o=t.rotation,s=t.scale,a=t.worldCoordinates,l=t.quaternion,c=t.translate,u=t.worldTranslate;if(n){this.coordinates=n;let e=i.projectToWorld(n);this.position.copy(e)}if(c){this.coordinates=[this.coordinates[0]+c[0],this.coordinates[1]+c[1],this.coordinates[2]+c[2]];let e=i.projectToWorld(c);this.position.copy(e),t.position=this.coordinates}if(u){this.translateX(u.x),this.translateY(u.y),this.translateZ(u.z);let e=i.unprojectFromWorld(this.position);this.coordinates=t.position=e}if(o&&(this.rotation.set(o[0],o[1],o[2]),t.rotation=new r.Vector3(o[0],o[1],o[2])),s&&(this.scale.set(s[0],s[1],s[2]),t.scale=this.scale),l&&(this.quaternion.setFromAxisAngle(l[0],l[1]),t.rotation=l[0].multiplyScalar(l[1])),a){this.position.copy(a);let e=i.unprojectFromWorld(a);this.coordinates=t.position=e}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0;let h={type:"ObjectChanged",detail:{object:this,action:{position:t.position,rotation:t.rotation,scale:t.scale}}};this.dispatchEvent(h)},e.playDefault=function(t){if(e.mixer&&e.hasDefaultAnimation){let n={start:Date.now(),expiration:Date.now()+t.duration,endState:{}};i.extend(t,n),e.mixer.timeScale=t.speed||1;let r={type:"playDefault",parameters:t};return this.animationQueue.push(r),tb.map.repaint=!0,this}},e.playAnimation=function(n){e.mixer&&(n.animation&&t(n.animation),e.playDefault(n))},e.pauseAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.paused=!0}))},e.unPauseAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.paused=!1}))},e.deactivateAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.stop()}))},e.activateAllActions=function(){e.mixer&&e.actions.forEach((function(e){e.play()}))},e.idle=function(){return e.mixer&&e.mixer.update(.01),tb.map.repaint=!0,this}},update:function(e){if(void 0===this.previousFrameTime&&(this.previousFrameTime=e),!this.enrolledObjects)return!1;for(let t=this.enrolledObjects.length-1;t>=0;t--){let n=this.enrolledObjects[t];if(n.animationQueue&&0!==n.animationQueue.length)for(let t=n.animationQueue.length-1;t>=0;t--){let i=n.animationQueue[t];if(!i)continue;let o=i.parameters;if(!o.expiration)return n.animationQueue.splice(t,1),void(n.animationQueue[t]&&(n.animationQueue[t].parameters.start=e));if(e>=o.expiration)o.expiration=!1,"playDefault"===i.type?n.stop():(o.endState&&n._setObject(o.endState),void 0!==o.cb&&o.cb());else{let t=(e-o.start)/o.duration;if("set"===i.type){let e={};o.pathCurve&&(e.worldCoordinates=o.pathCurve.getPoint(t)),o.rotationPerMs&&(e.rotation=o.startRotation.map((function(e,n){return e+o.rotationPerMs[n]*t*o.duration}))),o.scalePerMs&&(e.scale=o.startScale.map((function(e,n){return e+o.scalePerMs[n]*t*o.duration}))),n._setObject(e)}if("followPath"===i.type){let e={worldCoordinates:o.pathCurve.getPointAt(t)};if(o.trackHeading){let n=o.pathCurve.getTangentAt(t).normalize(),i=new r.Vector3(0,0,0),s=new r.Vector3(0,1,0);i.crossVectors(s,n).normalize();let a=Math.acos(s.dot(n));e.quaternion=[i,a]}n._setObject(e)}"playDefault"===i.type&&(n.activateAllActions(),n.isPlaying=!0,n.animationMethod=requestAnimationFrame(this.update),n.mixer.update(n.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=e}};const s={followPath:{path:null,duration:1e3,trackHeading:!0}};e.exports=o},4306:(e,t,n)=>{const r=n(61),i=n(4132),o=n(8604);function s(e,t,n){this.map=e,this.camera=t,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=n||new r.Group,this.world.position.x=this.world.position.y=o.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:(new r.Matrix4).makeTranslation(o.WORLD_SIZE/2,-o.WORLD_SIZE/2,0),worldSizeRatio:o.TILE_SIZE/o.WORLD_SIZE,worldSize:o.TILE_SIZE*this.map.transform.scale};let i=this;this.map.on("move",(function(){i.updateCamera()})).on("resize",(function(){i.setupCamera()})),this.setupCamera()}s.prototype={setupCamera:function(){const e=this.map.transform;this.camera.aspect=e.width/e.height,this.halfFov=e._fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*e.height;const t=e._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-t,this.updateCamera()},updateCamera:function(e){if(!this.camera)return void console.log("nocamera");const t=this.map.transform;this.camera.aspect=t.width/t.height;const n=t.centerOffset||new r.Vector3;let o=0,a=0;this.halfFov=t._fov/2;const l=Math.PI/2+t._pitch,c=Math.cos(Math.PI/2-t._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*t.height;let u=1;const h=this.worldSize();if(this.map.tb.mapboxVersion>=2){u=this.mercatorZfromAltitude(1,t.center.lat)*h;const e=t._fov*(.5+t.centerOffset.y/t.height),n=t.elevation?t.elevation.getMinElevationBelowMSL()*u:0,r=(t._camera.position[2]*h-n)/Math.cos(t._pitch);a=c*(Math.sin(e)*r/Math.sin(i.clamp(Math.PI-l-e,.01,Math.PI-.01)))+r;const s=r*(1/t._horizonShift);o=Math.min(1.01*a,s)}else a=c*(Math.sin(this.halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-l-this.halfFov))+this.cameraToCenterDistance,o=1.01*a;this.cameraTranslateZ=(new r.Matrix4).makeTranslation(0,0,this.cameraToCenterDistance);const d=t.height/50,p=Math.max(d*c,d),f=t.height,m=t.width;this.camera instanceof r.OrthographicCamera?this.camera.projectionMatrix=i.makeOrthographicMatrix(m/-2,m/2,f/2,f/-2,p,o):this.camera.projectionMatrix=i.makePerspectiveMatrix(t._fov,m/f,p,o),this.camera.projectionMatrix.elements[8]=2*-n.x/t.width,this.camera.projectionMatrix.elements[9]=2*n.y/t.height;let g=this.calcCameraMatrix(t._pitch,t.angle);t.elevation&&(g.elements[14]=t._camera.position[2]*h),this.camera.matrixWorld.copy(g);let y=t.scale*this.state.worldSizeRatio,v=new r.Matrix4,_=new r.Matrix4,x=new r.Matrix4;v.makeScale(y,y,y);let b=t.x||t.point.x,w=t.y||t.point.y;_.makeTranslation(-b,w,0),x.makeRotationZ(Math.PI),this.world.matrix=(new r.Matrix4).premultiply(x).premultiply(this.state.translateCenter).premultiply(v).premultiply(_),this.map.fire("CameraSynced",{detail:{nearZ:p,farZ:o,pitch:t._pitch,angle:t.angle,furthestDistance:a,cameraToCenterDistance:this.cameraToCenterDistance,t:this.map.transform,tbProjMatrix:this.camera.projectionMatrix.elements,tbWorldMatrix:this.world.matrix.elements,cameraSyn:s}})},worldSize(){let e=this.map.transform;return e.tileSize*e.scale},worldSizeFromZoom(){let e=this.map.transform;return Math.pow(2,e.zoom)*e.tileSize},mercatorZfromAltitude(e,t){return e/this.circumferenceAtLatitude(t)},mercatorZfromZoom(){return this.cameraToCenterDistance/this.worldSizeFromZoom()},circumferenceAtLatitude:e=>o.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180),calcCameraMatrix(e,t,n){const i=this.map.transform,o=void 0===e?i._pitch:e,s=void 0===t?i.angle:t,a=void 0===n?this.cameraTranslateZ:n;return(new r.Matrix4).premultiply(a).premultiply((new r.Matrix4).makeRotationX(o)).premultiply((new r.Matrix4).makeRotationZ(s))},updateCameraState(){let e=this.map.transform;if(!e.height)return;const t=e._camera.forward(),n=e.cameraToCenterDistance,r=e.point,i=(e._cameraZoom?e._cameraZoom:e._zoom,this.mercatorZfromZoom(e)-this.mercatorZfromAltitude(e._centerAltitude,e.center.lat)),o=e.cameraToCenterDistance/i;return[r.x/this.worldSize()-t[0]*n/o,r.y/this.worldSize()-t[1]*n/o,this.mercatorZfromAltitude(e._centerAltitude,e._center.lat)+-t[2]*n/o]},getWorldToCamera(e,t){let n=this.map.transform;const i=new r.Matrix4,o=new r.Matrix4,s=n._camera._orientation,a=n._camera.position,l=new r.Vector3(a[0],a[1],a[2]),c=new r.Quaternion;c.set(s[0],s[1],s[2],s[3]);const u=c.conjugate();return l.multiplyScalar(-e),o.makeTranslation(l.x,l.y,l.z),i.makeRotationFromQuaternion(u).premultiply(o),i.elements[1]*=-1,i.elements[5]*=-1,i.elements[9]*=-1,i.elements[13]*=-1,i.elements[8]*=t,i.elements[9]*=t,i.elements[10]*=t,i.elements[11]*=t,i},translate(e,t,n){let r,i,o,s,a,l,c,u,h,d,p,f,m=n[0]||n.x,g=n[1]||n.y,y=n[2]||n.z;return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+a*g+h*y+t[12],e[13]=i*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e}},e.exports=s},7145:(e,t,n)=>{const r=n(61);!function(){class e extends r.Object3D{constructor(e){super(),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",(function(){this.remove()}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}e.prototype.isCSS2DObject=!0;const t=new r.Vector3,n=new r.Matrix4,i=new r.Matrix4,o=new r.Vector3,s=new r.Vector3;r.CSS2DObject=e,r.CSS2DRenderer=class{constructor(){const e=this;let r,a,l,c;const u={objects:new WeakMap,list:new Map};this.cacheList=u.list;const h=document.createElement("div");function d(n,r,a){if(n.isCSS2DObject)if(n.visible){n.onBeforeRender(e,r,a),t.setFromMatrixPosition(n.matrixWorld),t.applyMatrix4(i);const d=n.element;var p;p=/apple/i.test(navigator.vendor)?"translate(-50%,-50%) translate("+Math.round(t.x*l+l)+"px,"+Math.round(-t.y*c+c)+"px)":"translate(-50%,-50%) translate("+(t.x*l+l)+"px,"+(-t.y*c+c)+"px)",d.style.WebkitTransform=p,d.style.MozTransform=p,d.style.oTransform=p,d.style.transform=p,d.style.display=n.visible&&t.z>=-1&&t.z<=1?"":"none";const g={distanceToCameraSquared:(f=a,m=n,o.setFromMatrixPosition(f.matrixWorld),s.setFromMatrixPosition(m.matrixWorld),o.distanceToSquared(s))};u.objects.set({key:n.uuid},g),u.list.set(n.uuid,n),d.parentNode!==h&&h.appendChild(d),n.onAfterRender(e,r,a)}else u.objects.delete({key:n.uuid}),u.list.delete(n.uuid),n.remove();var f,m;for(let e=0,t=n.children.length;e<t;e++)d(n.children[e],r,a)}h.style.overflow="hidden",this.domElement=h,this.getSize=function(){return{width:r,height:a}},this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),n.copy(t.matrixWorldInverse),i.multiplyMatrices(t.projectionMatrix,n),d(e,e,t),function(e){const t=function(e){const t=[];return e.traverse((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){let n=u.objects.get({key:e.uuid}),r=u.objects.get({key:t.uuid});if(n&&r)return n.distanceToCameraSquared-r.distanceToCameraSquared})),n=t.length;for(let e=0,r=t.length;e<r;e++)t[e].element.style.zIndex=n-e}(e)},this.setSize=function(e,t){r=e,a=t,l=r/2,c=a/2,h.style.width=e+"px",h.style.height=t+"px"}}}}(),e.exports={CSS2DRenderer:r.CSS2DRenderer,CSS2DObject:r.CSS2DObject}},5919:(e,t,n)=>{const r=n(7145);e.exports=function(e){this.map=e,this.renderer=new r.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(e,t){this.renderer.setSize(e,t)},this.map.on("resize",function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}.bind(this)),this.state={reset:function(){}},this.render=async function(e,t){return this.scene=e,this.camera=t,new Promise((n=>{n(this.renderer.render(e,t))}))},this.toggleLabels=async function(e,t){return new Promise((n=>{n(this.setVisibility(e,t,this.scene,this.camera,this.renderer))}))},this.setVisibility=function(e,t,n,r,i){this.renderer.cacheList.forEach((function(o){o.visible!=t&&o.layer===e&&(t&&o.alwaysVisible||!t)&&(o.visible=t,i.renderObject(o,n,r))}))}}},7089:(e,t,n)=>{const r=n(3019),i=n(4132);e.exports=function(e){let t=(e=i._validate(e,r.prototype._defaults.Object3D)).obj;const n=i.types.rotation(e.rotation,[0,0,0]),o=i.types.scale(e.scale,[1,1,1]);t.rotation.set(n[0],n[1],n[2]),t.scale.set(o[0],o[1],o[2]),t.name="model";let s=r.prototype._makeGroup(t,e);return e.obj.name="model",r.prototype._addMethods(s),s.setAnchor(e.anchor),s.setCenter(e.adjustment),s.raycasted=e.raycasted,s.visibility=!0,s}},1118:(e,t,n)=>{n(1639),e.exports=class{constructor(e,t){this.id=e.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=e.buildingsLayerId,this.minAltitude=e.minAltitude||.1,this.tb=t}onAdd(e,t){this.map=e;const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,"\n\t\t\tuniform mat4 u_matrix;\n\t\t\tuniform float u_height_factor;\n\t\t\tuniform float u_altitude;\n\t\t\tuniform float u_azimuth;\n\t\t\tattribute vec2 a_pos;\n\t\t\tattribute vec4 a_normal_ed;\n\t\t\tattribute lowp vec2 a_base;\n\t\t\tattribute lowp vec2 a_height;\n\t\t\tvoid main() {\n\t\t\t\tfloat base = max(0.0, a_base.x);\n\t\t\t\tfloat height = max(0.0, a_height.x);\n\t\t\t\tfloat t = mod(a_normal_ed.x, 2.0);\n\t\t\t\tvec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);\n\t\t\t\tfloat len = pos.z * u_height_factor / tan(u_altitude);\n\t\t\t\tpos.x += cos(u_azimuth) * len;\n\t\t\t\tpos.y += sin(u_azimuth) * len;\n\t\t\t\tpos.z = 0.0;\n\t\t\t\tgl_Position = u_matrix * pos;\n\t\t\t}\n\t\t\t"),t.compileShader(n);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,"\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);\n\t\t\t}\n\t\t\t"),t.compileShader(r),this.program=t.createProgram(),t.attachShader(this.program,n),t.attachShader(this.program,r),t.linkProgram(this.program),t.validateProgram(this.program),this.uMatrix=t.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=t.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=t.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=t.getUniformLocation(this.program,"u_azimuth"),this.aPos=t.getAttribLocation(this.program,"a_pos"),this.aNormal=t.getAttribLocation(this.program,"a_normal_ed"),this.aBase=t.getAttribLocation(this.program,"a_base"),this.aHeight=t.getAttribLocation(this.program,"a_height")}render(e,t){e.useProgram(this.program);const n=this.map.style.sourceCaches.composite,r=n.getVisibleCoordinates().reverse(),i=this.map.getLayer(this.buildingsLayerId),o=this.map.painter.context,{lng:s,lat:a}=this.map.getCenter(),l=this.tb.getSunPosition(this.tb.lightDateTime,[s,a]);e.uniform1f(this.uAltitude,l.altitude>this.minAltitude?l.altitude:0),e.uniform1f(this.uAzimuth,l.azimuth+3*Math.PI/2),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.getExtension("EXT_blend_minmax"),e.disable(e.DEPTH_TEST);for(const t of r){const r=n.getTile(t),s=r.getBucket(i);if(!s)continue;const[a,l]=s.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;e.uniformMatrix4fv(this.uMatrix,!1,t.posMatrix),e.uniform1f(this.uHeightFactor,Math.pow(2,t.overscaledZ)/r.tileSize/8);for(const t of s.segments.get()){const n=o.currentNumAttributes||0,r=2;for(let t=r;t<n;t++)e.disableVertexAttribArray(t);const i=t.vertexOffset||0;e.enableVertexAttribArray(this.aPos),e.enableVertexAttribArray(this.aNormal),e.enableVertexAttribArray(this.aHeight),e.enableVertexAttribArray(this.aBase),s.layoutVertexBuffer.bind(),e.vertexAttribPointer(this.aPos,2,e.SHORT,!1,12,12*i),e.vertexAttribPointer(this.aNormal,4,e.SHORT,!1,12,4+12*i),a.bind(),e.vertexAttribPointer(this.aHeight,1,e.FLOAT,!1,4,4*i),l.bind(),e.vertexAttribPointer(this.aBase,1,e.FLOAT,!1,4,4*i),s.indexBuffer.bind(),o.currentNumAttributes=r,e.drawElements(e.TRIANGLES,3*t.primitiveLength,e.UNSIGNED_SHORT,3*t.primitiveOffset*2)}}}}},444:(e,t,n)=>{const r=n(3019),i=n(4132),o=n(61),s=n(7089);function a(e){e=i._validate(e,r.prototype._defaults.extrusion);let t=a.prototype.buildShape(e.coordinates),n=a.prototype.buildGeometry(t,e.geometryOptions),l=new o.Mesh(n,e.materials);return e.obj=l,new s(e)}a.prototype={buildShape:function(e){if(e[0]instanceof(o.Vector2||o.Vector3))return new o.Shape(e);let t=new o.Shape;for(let n=0;n<e.length;n++)0===n?t=new o.Shape(this.buildPoints(e[0],e[0])):t.holes.push(new o.Path(this.buildPoints(e[n],e[0])));return t},buildPoints:function(e,t){const n=[];let r=i.projectToWorld([t[0][0],t[0][1],0]);for(let t=0;t<e.length;t++){let s=i.projectToWorld([e[t][0],e[t][1],0]);n.push(new o.Vector2(i.toDecimal(s.x-r.x,9),i.toDecimal(s.y-r.y,9)))}return n},buildGeometry:function(e,t){let n=new o.ExtrudeBufferGeometry(e,t);return n.computeBoundingBox(),n}},e.exports=a},9024:(e,t)=>{e.exports=function(){var e={__esModule:!0},n=function(e){"use strict";var n;try{n("require('worker_threads')").Worker}catch(n){}return t.default=function(e,t,n,r,i){setImmediate((function(){return i(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)}));var o=function(){};return{terminate:o,postMessage:o}},{}}(),r=Uint8Array,i=Uint16Array,o=Uint32Array,s=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(e,t){for(var n=new i(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var s=new o(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)s[a]=a-n[r]<<5|r;return[n,s]},u=c(s,2),h=u[0],d=u[1];h[28]=258,d[258]=28;for(var p=c(a,0),f=p[0],m=p[1],g=new i(32768),y=0;y<32768;++y){var v=(43690&y)>>>1|(21845&y)<<1;g[y]=((65280&(v=(61680&(v=(52428&v)>>>2|(13107&v)<<2))>>>4|(3855&v)<<4))>>>8|(255&v)<<8)>>>1}var _=function(e,t,n){for(var r=e.length,o=0,s=new i(t);o<r;++o)++s[e[o]-1];var a,l=new i(t);for(o=0;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;if(n){a=new i(1<<t);var c=15-t;for(o=0;o<r;++o)if(e[o])for(var u=o<<4|e[o],h=t-e[o],d=l[e[o]-1]++<<h,p=d|(1<<h)-1;d<=p;++d)a[g[d]>>>c]=u}else for(a=new i(r),o=0;o<r;++o)e[o]&&(a[o]=g[l[e[o]-1]++]>>>15-e[o]);return a},x=new r(288);for(y=0;y<144;++y)x[y]=8;for(y=144;y<256;++y)x[y]=9;for(y=256;y<280;++y)x[y]=7;for(y=280;y<288;++y)x[y]=8;var b=new r(32);for(y=0;y<32;++y)b[y]=5;var w=_(x,9,0),S=_(x,9,1),M=_(b,5,0),E=_(b,5,1),T=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},C=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},A=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},I=function(e){return(e/8|0)+(7&e&&1)},P=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var s=new(e instanceof i?i:e instanceof o?o:r)(n-t);return s.set(e.subarray(t,n)),s},R=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new r(0);var o=!t||n,c=!n||n.i;n||(n={}),t||(t=new r(3*i));var u=function(e){var n=t.length;if(e>n){var i=new r(Math.max(2*n,e));i.set(t),t=i}},d=n.f||0,p=n.p||0,m=n.b||0,g=n.l,y=n.d,v=n.m,x=n.n,b=8*i;do{if(!g){n.f=d=C(e,p,1);var w=C(e,p+1,3);if(p+=3,!w){var M=e[(j=I(p)+4)-4]|e[j-3]<<8,R=j+M;if(R>i){if(c)throw"unexpected EOF";break}o&&u(m+M),t.set(e.subarray(j,R),m),n.b=m+=M,n.p=p=8*R;continue}if(1==w)g=S,y=E,v=9,x=5;else{if(2!=w)throw"invalid block type";var L=C(e,p,31)+257,D=C(e,p+10,15)+4,O=L+C(e,p+5,31)+1;p+=14;for(var N=new r(O),k=new r(19),F=0;F<D;++F)k[l[F]]=C(e,p+3*F,7);p+=3*D;var z=T(k),B=(1<<z)-1;if(!c&&p+O*(z+7)>b)break;var U=_(k,z,1);for(F=0;F<O;){var j,V=U[C(e,p,B)];if(p+=15&V,(j=V>>>4)<16)N[F++]=j;else{var G=0,H=0;for(16==j?(H=3+C(e,p,3),p+=2,G=N[F-1]):17==j?(H=3+C(e,p,7),p+=3):18==j&&(H=11+C(e,p,127),p+=7);H--;)N[F++]=G}}var Z=N.subarray(0,L),W=N.subarray(L);v=T(Z),x=T(W),g=_(Z,v,1),y=_(W,x,1)}if(p>b)throw"unexpected EOF"}o&&u(m+131072);for(var $=(1<<v)-1,q=(1<<x)-1,X=v+x+18;c||p+X<b;){var Y=(G=g[A(e,p)&$])>>>4;if((p+=15&G)>b)throw"unexpected EOF";if(!G)throw"invalid length/literal";if(Y<256)t[m++]=Y;else{if(256==Y){g=null;break}var K=Y-254;Y>264&&(K=C(e,p,(1<<(ee=s[F=Y-257]))-1)+h[F],p+=ee);var J=y[A(e,p)&q],Q=J>>>4;if(!J)throw"invalid distance";if(p+=15&J,W=f[Q],Q>3){var ee=a[Q];W+=A(e,p)&(1<<ee)-1,p+=ee}if(p>b)throw"unexpected EOF";o&&u(m+131072);for(var te=m+K;m<te;m+=4)t[m]=t[m-W],t[m+1]=t[m+1-W],t[m+2]=t[m+2-W],t[m+3]=t[m+3-W];m=te}}n.l=g,n.p=p,n.b=m,g&&(d=1,n.m=v,n.d=y,n.n=x)}while(!d);return m==t.length?t:P(t,0,m)},L=function(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[r+1]|=n>>>8},D=function(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[r+1]|=n>>>8,e[r+2]|=n>>>16},O=function(e,t){for(var n=[],o=0;o<e.length;++o)e[o]&&n.push({s:o,f:e[o]});var s=n.length,a=n.slice();if(!s)return[j,0];if(1==s){var l=new r(n[0].s+1);return l[n[0].s]=1,[l,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var c=n[0],u=n[1],h=0,d=1,p=2;for(n[0]={s:-1,f:c.f+u.f,l:c,r:u};d!=s-1;)c=n[n[h].f<n[p].f?h++:p++],u=n[h!=d&&n[h].f<n[p].f?h++:p++],n[d++]={s:-1,f:c.f+u.f,l:c,r:u};var f=a[0].s;for(o=1;o<s;++o)a[o].s>f&&(f=a[o].s);var m=new i(f+1),g=N(n[d-1],m,0);if(g>t){o=0;var y=0,v=g-t,_=1<<v;for(a.sort((function(e,t){return m[t.s]-m[e.s]||e.f-t.f}));o<s;++o){var x=a[o].s;if(!(m[x]>t))break;y+=_-(1<<g-m[x]),m[x]=t}for(y>>>=v;y>0;){var b=a[o].s;m[b]<t?y-=1<<t-m[b]++-1:++o}for(;o>=0&&y;--o){var w=a[o].s;m[w]==t&&(--m[w],++y)}g=t}return[new r(m),g]},N=function(e,t,n){return-1==e.s?Math.max(N(e.l,t,n+1),N(e.r,t,n+1)):t[e.s]=n},k=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new i(++t),r=0,o=e[0],s=1,a=function(e){n[r++]=e},l=1;l<=t;++l)if(e[l]==o&&l!=t)++s;else{if(!o&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(o),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(o);s=1,o=e[l]}return[n.subarray(0,r),t]},F=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},z=function(e,t,n){var r=n.length,i=I(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<r;++o)e[i+o+4]=n[o];return 8*(i+4+r)},B=function(e,t,n,r,o,c,u,h,d,p,f){L(t,f++,n),++o[256];for(var m=O(o,15),g=m[0],y=m[1],v=O(c,15),S=v[0],E=v[1],T=k(g),C=T[0],A=T[1],I=k(S),P=I[0],R=I[1],N=new i(19),B=0;B<C.length;++B)N[31&C[B]]++;for(B=0;B<P.length;++B)N[31&P[B]]++;for(var U=O(N,7),j=U[0],V=U[1],G=19;G>4&&!j[l[G-1]];--G);var H,Z,W,$,q=p+5<<3,X=F(o,x)+F(c,b)+u,Y=F(o,g)+F(c,S)+u+14+3*G+F(N,j)+(2*N[16]+3*N[17]+7*N[18]);if(q<=X&&q<=Y)return z(t,f,e.subarray(d,d+p));if(L(t,f,1+(Y<X)),f+=2,Y<X){H=_(g,y,0),Z=g,W=_(S,E,0),$=S;var K=_(j,V,0);for(L(t,f,A-257),L(t,f+5,R-1),L(t,f+10,G-4),f+=14,B=0;B<G;++B)L(t,f+3*B,j[l[B]]);f+=3*G;for(var J=[C,P],Q=0;Q<2;++Q){var ee=J[Q];for(B=0;B<ee.length;++B)L(t,f,K[te=31&ee[B]]),f+=j[te],te>15&&(L(t,f,ee[B]>>>5&127),f+=ee[B]>>>12)}}else H=w,Z=x,W=M,$=b;for(B=0;B<h;++B)if(r[B]>255){var te;D(t,f,H[257+(te=r[B]>>>18&31)]),f+=Z[te+257],te>7&&(L(t,f,r[B]>>>23&31),f+=s[te]);var ne=31&r[B];D(t,f,W[ne]),f+=$[ne],ne>3&&(D(t,f,r[B]>>>5&8191),f+=a[ne])}else D(t,f,H[r[B]]),f+=Z[r[B]];return D(t,f,H[256]),f+Z[256]},U=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),j=new r(0),V=function(e,t,n,l,c,u){var h=e.length,p=new r(l+h+5*(1+Math.ceil(h/7e3))+c),f=p.subarray(l,p.length-c),g=0;if(!t||h<8)for(var y=0;y<=h;y+=65535){var v=y+65535;v<h?g=z(f,g,e.subarray(y,v)):(f[y]=u,g=z(f,g,e.subarray(y,h)))}else{for(var _=U[t-1],x=_>>>13,b=8191&_,w=(1<<n)-1,S=new i(32768),M=new i(w+1),E=Math.ceil(n/3),T=2*E,C=function(t){return(e[t]^e[t+1]<<E^e[t+2]<<T)&w},A=new o(25e3),R=new i(288),L=new i(32),D=0,O=0,N=(y=0,0),k=0,F=0;y<h;++y){var V=C(y),G=32767&y,H=M[V];if(S[G]=H,M[V]=G,k<=y){var Z=h-y;if((D>7e3||N>24576)&&Z>423){g=B(e,f,0,A,R,L,O,N,F,y-F,g),N=D=O=0,F=y;for(var W=0;W<286;++W)R[W]=0;for(W=0;W<30;++W)L[W]=0}var $=2,q=0,X=b,Y=G-H&32767;if(Z>2&&V==C(y-Y))for(var K=Math.min(x,Z)-1,J=Math.min(32767,y),Q=Math.min(258,Z);Y<=J&&--X&&G!=H;){if(e[y+$]==e[y+$-Y]){for(var ee=0;ee<Q&&e[y+ee]==e[y+ee-Y];++ee);if(ee>$){if($=ee,q=Y,ee>K)break;var te=Math.min(Y,ee-2),ne=0;for(W=0;W<te;++W){var re=y-Y+W+32768&32767,ie=re-S[re]+32768&32767;ie>ne&&(ne=ie,H=re)}}}Y+=(G=H)-(H=S[G])+32768&32767}if(q){A[N++]=268435456|d[$]<<18|m[q];var oe=31&d[$],se=31&m[q];O+=s[oe]+a[se],++R[257+oe],++L[se],k=y+$,++D}else A[N++]=e[y],++R[e[y]]}}g=B(e,f,u,A,R,L,O,N,F,y-F,g),!u&&7&g&&(g=z(f,g+1,j))}return P(p,0,l+I(g)+c)},G=function(){for(var e=new o(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),H=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=G[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},Z=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,o=n.length,s=0;s!=o;){for(var a=Math.min(s+2655,o);s<a;++s)i+=r+=n[s];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return((e%=65521)>>>8<<16|(255&(t%=65521))<<8|t>>>8)+2*((255&e)<<23)}}},W=function(e,t,n,r,i){return V(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},$=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},q=function(e,t,n){for(var r=e(),i=""+e,o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<r.length;++s){var a=r[s],l=o[s];if("function"==typeof a){t+=";"+l+"=";var c=""+a;if(a.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else for(var h in t+=c,a.prototype)t+=";"+l+".prototype."+h+"="+a.prototype[h];else t+=c}else n[l]=a}return[t,n]},X=[],Y=function(e){var t=[];for(var n in e)(e[n]instanceof r||e[n]instanceof i||e[n]instanceof o)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t},K=function(e,t,r,i){var o;if(!X[r]){for(var s="",a={},l=e.length-1,c=0;c<l;++c)s=(o=q(e[c],s,a))[0],a=o[1];X[r]=q(e[l],s,a)}var u=$({},X[r][1]);return n.default(X[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t+"}",r,u,Y(u),i)},J=function(){return[r,i,o,s,a,l,h,f,S,E,g,_,T,C,A,I,P,R,Ce,ie,oe]},Q=function(){return[r,i,o,s,a,l,d,m,w,x,M,b,g,U,j,_,L,D,O,N,k,F,z,B,I,P,V,W,Se,ie]},ee=function(){return[pe,ge,de,H,G]},te=function(){return[fe,me]},ne=function(){return[ye,de,Z]},re=function(){return[ve]},ie=function(e){return postMessage(e,[e.buffer])},oe=function(e){return e&&e.size&&new r(e.size)},se=function(e,t,n,r,i,o){var s=K(n,r,i,(function(e,t){s.terminate(),o(e,t)}));return s.postMessage([e,t],t.consume?[e.buffer]:[]),function(){s.terminate()}},ae=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},le=function(e,t,n,r,i){var o,s=K(e,r,i,(function(e,n){e?(s.terminate(),t.ondata.call(t,e)):(n[1]&&s.terminate(),t.ondata.call(t,e,n[0],n[1]))}));s.postMessage(n),t.push=function(e,n){if(o)throw"stream finished";if(!t.ondata)throw"no stream handler";s.postMessage([e,o=n],[e.buffer])},t.terminate=function(){s.terminate()}},ce=function(e,t){return e[t]|e[t+1]<<8},ue=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},he=function(e,t){return ue(e,t)|4294967296*ue(e,t)},de=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},pe=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&de(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},fe=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},me=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},ge=function(e){return 10+(e.filename&&e.filename.length+1||0)},ye=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},ve=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function _e(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var xe=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(W(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}();e.Deflate=xe;var be=function(e,t){le([Q,function(){return[ae,xe]}],this,_e.call(this,e,t),(function(e){var t=new xe(e.data);onmessage=ae(t)}),6)};function we(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[Q],(function(e){return ie(Se(e.data[0],e.data[1]))}),0,n)}function Se(e,t){return W(e,t||{},0,0)}e.AsyncDeflate=be,e.deflate=we,e.deflateSync=Se;var Me=function(){function e(e){this.s={},this.p=new r(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new r(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=R(this.p,this.o,this.s);this.ondata(P(n,t,this.s.b),this.d),this.o=P(n,this.s.b-32768),this.s.b=this.o.length,this.p=P(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}();e.Inflate=Me;var Ee=function(e){this.ondata=e,le([J,function(){return[ae,Me]}],this,0,(function(){var e=new Me;onmessage=ae(e)}),7)};function Te(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[J],(function(e){return ie(Ce(e.data[0],oe(e.data[1])))}),1,n)}function Ce(e,t){return R(e,t)}e.AsyncInflate=Ee,e.inflate=Te,e.inflateSync=Ce;var Ae=function(){function e(e,t){this.c=H(),this.l=0,this.v=1,xe.call(this,e,t)}return e.prototype.push=function(e,t){xe.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=W(e,this.o,this.v&&ge(this.o),t&&8,!t);this.v&&(pe(n,this.o),this.v=0),t&&(de(n,n.length-8,this.c.d()),de(n,n.length-4,this.l)),this.ondata(n,t)},e}();e.Gzip=Ae,e.Compress=Ae;var Ie=function(e,t){le([Q,ee,function(){return[ae,xe,Ae]}],this,_e.call(this,e,t),(function(e){var t=new Ae(e.data);onmessage=ae(t)}),8)};function Pe(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[Q,ee,function(){return[Re]}],(function(e){return ie(Re(e.data[0],e.data[1]))}),2,n)}function Re(e,t){t||(t={});var n=H(),r=e.length;n.p(e);var i=W(e,t,ge(t),8),o=i.length;return pe(i,t),de(i,o-8,n.d()),de(i,o-4,r),i}e.AsyncGzip=Ie,e.AsyncCompress=Ie,e.gzip=Pe,e.compress=Pe,e.gzipSync=Re,e.compressSync=Re;var Le=function(){function e(e){this.v=1,Me.call(this,e)}return e.prototype.push=function(e,t){if(Me.prototype.e.call(this,e),this.v){var n=this.p.length>3?fe(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Me.prototype.c.call(this,t)},e}();e.Gunzip=Le;var De=function(e){this.ondata=e,le([J,te,function(){return[ae,Me,Le]}],this,0,(function(){var e=new Le;onmessage=ae(e)}),9)};function Oe(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[J,te,function(){return[Ne]}],(function(e){return ie(Ne(e.data[0]))}),3,n)}function Ne(e,t){return R(e.subarray(fe(e),-8),t||new r(me(e)))}e.AsyncGunzip=De,e.gunzip=Oe,e.gunzipSync=Ne;var ke=function(){function e(e,t){this.c=Z(),this.v=1,xe.call(this,e,t)}return e.prototype.push=function(e,t){xe.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=W(e,this.o,this.v&&2,t&&4,!t);this.v&&(ye(n,this.o),this.v=0),t&&de(n,n.length-4,this.c.d()),this.ondata(n,t)},e}();e.Zlib=ke;function Fe(e,t){t||(t={});var n=Z();n.p(e);var r=W(e,t,2,4);return ye(r,t),de(r,r.length-4,n.d()),r}e.AsyncZlib=function(e,t){le([Q,ne,function(){return[ae,xe,ke]}],this,_e.call(this,e,t),(function(e){var t=new ke(e.data);onmessage=ae(t)}),10)},e.zlib=function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[Q,ne,function(){return[Fe]}],(function(e){return ie(Fe(e.data[0],e.data[1]))}),4,n)},e.zlibSync=Fe;var ze=function(){function e(e){this.v=1,Me.call(this,e)}return e.prototype.push=function(e,t){if(Me.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Me.prototype.c.call(this,t)},e}();e.Unzlib=ze;var Be=function(e){this.ondata=e,le([J,re,function(){return[ae,Me,ze]}],this,0,(function(){var e=new ze;onmessage=ae(e)}),11)};function Ue(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return se(e,t,[J,re,function(){return[je]}],(function(e){return ie(je(e.data[0],oe(e.data[1])))}),5,n)}function je(e,t){return R((ve(e),e.subarray(2,-4)),t)}e.AsyncUnzlib=Be,e.unzlib=Ue,e.unzlibSync=je;var Ve=function(){function e(e){this.G=Le,this.I=Me,this.Z=ze,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new r(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,o=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(o):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},e}();e.Decompress=Ve;var Ge=function(){function e(e){this.G=De,this.I=Ee,this.Z=Be,this.ondata=e}return e.prototype.push=function(e,t){Ve.prototype.push.call(this,e,t)},e}();e.AsyncDecompress=Ge,e.decompress=function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Oe(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Te(e,t,n):Ue(e,t,n)},e.decompressSync=function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Ne(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ce(e,t):je(e,t)};var He=function(e,t,n,i){for(var o in e){var s=e[o],a=t+o;s instanceof r?n[a]=[s,i]:Array.isArray(s)?n[a]=[s[0],$(i,s[1])]:He(s,a+"/",n,i)}},Ze="undefined"!=typeof TextEncoder&&new TextEncoder,We="undefined"!=typeof TextDecoder&&new TextDecoder,$e=0;try{We.decode(j,{stream:!0}),$e=1}catch(n){}var qe=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,P(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=String.fromCharCode(1&i?(31&r)<<6|63&e[n++]:(15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},Xe=function(){function e(e){this.ondata=e,$e?this.t=new TextDecoder:this.p=j}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t||(t=!1),this.t)return this.ondata(this.t.decode(e,{stream:!t}),t);var n=new r(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=qe(n),o=i[0],s=i[1];if(t&&s.length)throw"invalid utf-8 data";this.p=s,this.ondata(o,t)},e}();e.DecodeUTF8=Xe;var Ye=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";this.ondata(Ke(e),t||!1)},e}();function Ke(e,t){if(t){for(var n=new r(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(Ze)return Ze.encode(e);var o=e.length,s=new r(e.length+(e.length>>1)),a=0,l=function(e){s[a++]=e};for(i=0;i<o;++i){if(a+5>s.length){var c=new r(a+8+(o-i<<1));c.set(s),s=c}var u=e.charCodeAt(i);u<128||t?l(u):u<2048?(l(192|u>>>6),l(128|63&u)):u>55295&&u<57344?(l(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++i))>>>18),l(128|u>>>12&63),l(128|u>>>6&63),l(128|63&u)):(l(224|u>>>12),l(128|u>>>6&63),l(128|63&u))}return P(s,0,a)}function Je(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(We)return We.decode(e);var i=qe(e);if(i[1].length)throw"invalid utf-8 data";return i[0]}e.EncodeUTF8=Ye,e.strToU8=Ke,e.strFromU8=Je;var Qe=function(e){return 1==e?3:e<6?2:9==e?1:0},et=function(e,t){return t+30+ce(e,t+26)+ce(e,t+28)},tt=function(e,t,n){var r=ce(e,t+28),i=Je(e.subarray(t+46,t+46+r),!(2048&ce(e,t+8))),o=t+46+r,s=ue(e,t+20),a=n&&4294967295==s?nt(e,o):[s,ue(e,t+24),ue(e,t+42)],l=a[0],c=a[1],u=a[2];return[ce(e,t+10),l,c,i,o+ce(e,t+30)+ce(e,t+32),u]},nt=function(e,t){for(;1!=ce(e,t);t+=4+ce(e,t+2));return[he(e,t+12),he(e,t+4),he(e,t+20)]},rt=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},it=function(e,t,n,r,i,o,s,a){var l=r.length,c=n.extra,u=a&&a.length,h=rt(c);de(e,t,null!=s?33639248:67324752),t+=4,null!=s&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==o&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(de(e,t,2*(p<<24)|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=o&&(de(e,t,n.crc),de(e,t+4,o),de(e,t+8,n.size)),de(e,t+12,l),de(e,t+14,h),t+=16,null!=s&&(de(e,t,u),de(e,t+6,n.attrs),de(e,t+10,s),t+=14),e.set(r,t),t+=l,h)for(var f in c){var m=c[f],g=m.length;de(e,t,+f),de(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(a,t),t+=u),t},ot=function(e,t,n,r,i){de(e,t,101010256),de(e,t+8,n),de(e,t+10,n),de(e,t+12,r),de(e,t+16,i)},st=function(){function e(e){this.filename=e,this.c=H(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}();e.ZipPassThrough=st;var at=function(){function e(e,t){var n=this;t||(t={}),st.call(this,e),this.d=new xe(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=Qe(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){st.prototype.push.call(this,e,t)},e}();e.ZipDeflate=at;var lt=function(){function e(e,t){var n=this;t||(t={}),st.call(this,e),this.d=new be(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=Qe(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){st.prototype.push.call(this,e,t)},e}();e.AsyncZipDeflate=lt;var ct=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Ke(e.filename),i=n.length,o=e.comment,s=o&&Ke(o),a=i!=e.filename.length||s&&o.length!=s.length,l=i+rt(e.extra)+30;if(i>65535)throw"filename too long";var c=new r(l);it(c,0,e,n,a);var u=[c],h=function(){for(var e=0,n=u;e<n.length;e++)t.ondata(null,n[e],!1);u=[]},d=this.d;this.d=0;var p=this.u.length,f=$(e,{f:n,u:a,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(h(),d){var e=t.u[p+1];e?e.r():t.d=1}d=1}}),m=0;e.ondata=function(n,i,o){if(n)t.ondata(n,i,o),t.terminate();else if(m+=i.length,u.push(i),o){var s=new r(16);de(s,0,134695760),de(s,4,e.crc),de(s,8,m),de(s,12,e.size),u.push(s),f.c=m,f.b=l+m+16,f.crc=e.crc,f.size=e.size,d&&f.r(),d=1}else d&&h()},this.u.push(f)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,i=0,o=this.u;i<o.length;i++)n+=46+(c=o[i]).f.length+rt(c.extra)+(c.o?c.o.length:0);for(var s=new r(n+22),a=0,l=this.u;a<l.length;a++){var c;it(s,e,c=l[a],c.f,c.u,c.c,t,c.o),e+=46+c.f.length+rt(c.extra)+(c.o?c.o.length:0),t+=c.b}ot(s,e,this.u.length,n,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();e.Zip=ct,e.zip=function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var i={};He(e,"",i,t);var o=Object.keys(i),s=o.length,a=0,l=0,c=s,u=Array(s),h=[],d=function(){for(var e=0;e<h.length;++e)h[e]()},p=function(){var e=new r(l+22),t=a,i=l-a;l=0;for(var o=0;o<c;++o){var s=u[o];try{var h=s.c.length;it(e,l,s,s.f,s.u,h);var d=30+s.f.length+rt(s.extra),p=l+d;e.set(s.c,p),it(e,a,s,s.f,s.u,h,l,s.m),a+=16+d+(s.m?s.m.length:0),l=p+h}catch(e){return n(e,null)}}ot(e,a,u.length,i,t),n(null,e)};s||p();for(var f=function(e){var t=o[e],r=i[t],c=r[0],f=r[1],m=H(),g=c.length;m.p(c);var y=Ke(t),v=y.length,_=f.comment,x=_&&Ke(_),b=x&&x.length,w=rt(f.extra),S=0==f.level?0:8,M=function(r,i){if(r)d(),n(r,null);else{var o=i.length;u[e]=$(f,{size:g,crc:m.d(),c:i,f:y,m:x,u:v!=t.length||x&&_.length!=b,compression:S}),a+=30+v+w+o,l+=76+2*(v+w)+(b||0)+o,--s||p()}};if(v>65535&&M("filename too long",null),S)if(g<16e4)try{M(null,Se(c,f))}catch(e){M(e,null)}else h.push(we(c,f,M));else M(null,c)},m=0;m<c;++m)f(m);return d},e.zipSync=function(e,t){t||(t={});var n={},i=[];He(e,"",n,t);var o=0,s=0;for(var a in n){var l=n[a],c=l[0],u=l[1],h=0==u.level?0:8,d=(M=Ke(a)).length,p=u.comment,f=p&&Ke(p),m=f&&f.length,g=rt(u.extra);if(d>65535)throw"filename too long";var y=h?Se(c,u):c,v=y.length,_=H();_.p(c),i.push($(u,{size:c.length,crc:_.d(),c:y,f:M,m:f,u:d!=a.length||f&&p.length!=m,o,compression:h})),o+=30+d+g+v,s+=76+2*(d+g)+(m||0)+v}for(var x=new r(s+22),b=o,w=s-o,S=0;S<i.length;++S){var M;it(x,(M=i[S]).o,M,M.f,M.u,M.c.length);var E=30+M.f.length+rt(M.extra);x.set(M.c,M.o+E),it(x,o,M,M.f,M.u,M.c.length,M.o,M.m),o+=16+E+(M.m?M.m.length:0)}return ot(x,o,i.length,w,b),x};var ut=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}();e.UnzipPassThrough=ut;var ht=function(){function e(){var e=this;this.i=new Me((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}();e.UnzipInflate=ht;var dt=function(){function e(e,t){var n=this;t<32e4?this.i=new Me((function(e,t){n.ondata(null,e,t)})):(this.i=new Ee((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=P(e,0)),this.i.push(e,t)},e.compression=8,e}();e.AsyncUnzipInflate=dt;var pt=function(){function e(e){this.onfile=e,this.k=[],this.o={0:ut},this.p=j}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(this.c>0){var i=Math.min(this.c,e.length),o=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(i)).length)return this.push(e,t)}else{var s=0,a=0,l=void 0,c=void 0;this.p.length?e.length?((c=new r(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,h=this.c,d=h&&this.d,p=function(){var e,t=ue(c,a);if(67324752==t){s=1,l=a,f.d=null,f.c=0;var r=ce(c,a+6),i=ce(c,a+8),o=2048&r,d=8&r,p=ce(c,a+26),m=ce(c,a+28);if(u>a+30+p+m){var g=[];f.k.unshift(g),s=2;var y=ue(c,a+18),v=ue(c,a+22),_=Je(c.subarray(a+30,a+=30+p),!o);4294967295==y?(e=d?[-2]:nt(c,a),y=e[0],v=e[1]):d&&(y=-1),a+=m,f.c=y;var x={name:_,compression:i,start:function(){if(!x.ondata)throw"no callback";if(y){var e=n.o[i];if(!e)throw"unknown compression type "+i;var t=y<0?new e(_):new e(_,y,v);t.ondata=function(e,t,n){x.ondata(e,t,n)};for(var r=0,o=g;r<o.length;r++)t.push(o[r],!1);n.k[0]==g?n.d=t:t.push(j,!0)}else x.ondata(null,j,!0)},terminate:function(){n.k[0]==g&&n.d.terminate&&n.d.terminate()}};y>=0&&(x.size=y,x.originalSize=v),f.onfile(x)}return"break"}if(h){if(134695760==t)return l=a+=12+(-2==h&&8),s=2,f.c=0,"break";if(33639248==t)return l=a-=4,s=2,f.c=0,"break"}},f=this;a<u-4&&"break"!==p();++a);if(this.p=j,h<0){var m=c.subarray(0,s?l-12-(-2==h&&8)-(134695760==ue(c,l-16)&&4):a);d?d.push(m,!!s):this.k[+(2==s)].push(m)}if(2&s)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t&&this.c)throw"invalid zip file"},e.prototype.register=function(e){this.o[e.compression]=e},e}();return e.Unzip=pt,e.unzip=function(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],i=function(){for(var e=0;e<n.length;++e)n[e]()},o={},s=e.length-22;101010256!=ue(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var a=ce(e,s+8);a||t(null,{});var l=a,c=ue(e,s+16),u=4294967295==c;if(u){if(s=ue(e,s-12),101075792!=ue(e,s))return void t("invalid zip file",null);l=a=ue(e,s+32),c=ue(e,s+48)}for(var h=function(s){var l=tt(e,c,u),h=l[0],d=l[1],p=l[2],f=l[3],m=l[4],g=et(e,l[5]);c=m;var y=function(e,n){e?(i(),t(e,null)):(o[f]=n,--a||t(null,o))};if(h)if(8==h){var v=e.subarray(g,g+d);if(d<32e4)try{y(null,Ce(v,new r(p)))}catch(e){y(e,null)}else n.push(Te(v,{size:p},y))}else y("unknown compression type "+h,null);else y(null,P(e,g,g+d))},d=0;d<l;++d)h();return i},e.unzipSync=function(e){for(var t={},n=e.length-22;101010256!=ue(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var i=ce(e,n+8);if(!i)return{};var o=ue(e,n+16),s=4294967295==o;if(s){if(n=ue(e,n-12),101075792!=ue(e,n))throw"invalid zip file";i=ue(e,n+32),o=ue(e,n+48)}for(var a=0;a<i;++a){var l=tt(e,o,s),c=l[0],u=l[1],h=l[2],d=l[3],p=l[4],f=et(e,l[5]);if(o=p,c){if(8!=c)throw"unknown compression type "+c;t[d]=Ce(e.subarray(f,f+u),new r(h))}else t[d]=P(e,f,f+u)}return t},e}()},5749:(e,t,n)=>{const r=n(4132),i=n(3019),o=n(7145);e.exports=function(e){e=r._validate(e,i.prototype._defaults.label);let t=i.prototype.drawLabelHTML(e.htmlElement,e.cssClass),n=new o.CSS2DObject(t);n.name="label",n.visible=e.alwaysVisible,n.alwaysVisible=e.alwaysVisible;var s=i.prototype._makeGroup(n,e);return i.prototype._addMethods(s),s.visibility=e.alwaysVisible,s}},7981:(e,t,n)=>{const r=n(61),i=n(4132),o=n(3019);function s(e){e=i._validate(e,o.prototype._defaults.line);var t=i.lnglatsToWorld(e.geometry),n=i.normalizeVertices(t),a=i.flattenVectors(n.vertices),l=new r.LineGeometry;l.setPositions(a);let c=new r.LineMaterial({color:e.color,linewidth:e.width,dashed:!1,opacity:e.opacity});return c.resolution.set(window.innerWidth,window.innerHeight),c.isMaterial=!0,c.transparent=!0,c.depthWrite=!1,(s=new r.Line2(l,c)).position.copy(n.position),s.computeLineDistances(),s}e.exports=s,function(){const e=new r.Box3,t=new r.Vector3;class n extends r.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new r.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new r.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new r.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new r.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new r.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new r.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new r.InterleavedBufferAttribute(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new r.WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new r.Box3);const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==t&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(t),e.setFromBufferAttribute(n),this.boundingBox.union(e))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new r.Sphere),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==e&&void 0!==n){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let o=0,s=e.count;o<s;o++)t.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(t)),t.fromBufferAttribute(n,o),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}n.prototype.isLineSegmentsGeometry=!0,r.LineSegmentsGeometry=n}(),function(){class e extends r.LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}fromLine(e){var t=e.geometry;if(!t.isGeometry)return t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this;console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.")}}e.prototype.isLineGeometry=!0,r.LineGeometry=e}(),function(){class e extends r.LineSegmentsGeometry{constructor(e){super(),this.type="WireframeGeometry2",this.fromWireframeGeometry(new r.WireframeGeometry(e))}}e.prototype.isWireframeGeometry2=!0,r.WireframeGeometry2=e}(),function(){r.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new r.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},r.ShaderLib.line={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 worldPos;\n\t\tvarying vec3 worldStart;\n\t\tvarying vec3 worldEnd;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\tworldStart = start.xyz;\n\t\t\tworldEnd = end.xyz;\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// get the offset direction as perpendicular to the view vector\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 offset;\n\t\t\t\tif ( position.y < 0.5 ) {\n\n\t\t\t\t\toffset = normalize( cross( start.xyz, worldDir ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toffset = normalize( cross( end.xyz, worldDir ) );\n\n\t\t\t\t}\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\tfloat forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// extend the line bounds to encompass  endcaps\n\t\t\t\t\tstart.xyz += - worldDir * linewidth * 0.5;\n\t\t\t\t\tend.xyz += worldDir * linewidth * 0.5;\n\n\t\t\t\t\t// shift the position of the quad so it hugs the forward edge of the line\n\t\t\t\t\toffset.xy -= dir * forwardOffset;\n\t\t\t\t\toffset.z += 0.5;\n\n\t\t\t\t#endif\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\toffset.xy += dir * 2.0 * forwardOffset;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth * 0.5;\n\n\t\t\t\t// set the world position\n\t\t\t\tworldPos = ( position.y < 0.5 ) ? start : end;\n\t\t\t\tworldPos.xyz += offset;\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segements overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\t\tvarying vec4 worldPos;\n\t\tvarying vec3 worldStart;\n\t\tvarying vec3 worldEnd;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tfloat alpha = opacity;\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class e extends r.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:r.UniformsUtils.clone(r.ShaderLib.line.uniforms),vertexShader:r.ShaderLib.line.vertexShader,fragmentShader:r.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(e){Boolean(e)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("ALPHA_TO_COVERAGE"in this.defines)},set:function(e){Boolean(e)!==Boolean("ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),!0===e?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}e.prototype.isLineMaterial=!0,r.LineMaterial=e}(),function(){const e=new r.Vector3,t=new r.Vector3,n=new r.Vector4,i=new r.Vector4,o=new r.Vector4,s=new r.Vector3,a=new r.Matrix4,l=new r.Line3,c=new r.Vector3,u=new r.Box3,h=new r.Sphere,d=new r.Vector4;class p extends r.Mesh{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.LineSegmentsGeometry,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.LineMaterial({color:16777215*Math.random()})),this.type="LineSegments2"}computeLineDistances(){const n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,s=new Float32Array(2*i.count);for(let n=0,r=0,a=i.count;n<a;n++,r+=2)e.fromBufferAttribute(i,n),t.fromBufferAttribute(o,n),s[r]=0===r?0:s[r-1],s[r+1]=s[r]+e.distanceTo(t);const a=new r.InstancedInterleavedBuffer(s,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(a,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(a,1,1)),this}raycast(e,t){null===e.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');const p=void 0!==e.params.Line2&&e.params.Line2.threshold||0,f=e.ray,m=e.camera,g=m.projectionMatrix,y=this.matrixWorld,v=this.geometry,_=this.material,x=_.resolution,b=_.linewidth+p,w=v.attributes.instanceStart,S=v.attributes.instanceEnd,M=-m.near,E=2*Math.max(b/x.width,b/x.height);null===v.boundingSphere&&v.computeBoundingSphere(),h.copy(v.boundingSphere).applyMatrix4(y);const T=Math.max(m.near,h.distanceToPoint(f.origin));d.set(0,0,-T,1).applyMatrix4(m.projectionMatrix),d.multiplyScalar(1/d.w),d.applyMatrix4(m.projectionMatrixInverse);const C=.5*Math.abs(E/d.w);if(h.radius+=C,!1===e.ray.intersectsSphere(h))return;null===v.boundingBox&&v.computeBoundingBox(),u.copy(v.boundingBox).applyMatrix4(y);const A=Math.max(m.near,u.distanceToPoint(f.origin));d.set(0,0,-A,1).applyMatrix4(m.projectionMatrix),d.multiplyScalar(1/d.w),d.applyMatrix4(m.projectionMatrixInverse);const I=.5*Math.abs(E/d.w);if(u.max.x+=I,u.max.y+=I,u.max.z+=I,u.min.x-=I,u.min.y-=I,u.min.z-=I,!1!==e.ray.intersectsBox(u)){f.at(1,o),o.w=1,o.applyMatrix4(m.matrixWorldInverse),o.applyMatrix4(g),o.multiplyScalar(1/o.w),o.x*=x.x/2,o.y*=x.y/2,o.z=0,s.copy(o),a.multiplyMatrices(m.matrixWorldInverse,y);for(let e=0,o=w.count;e<o;e++){if(n.fromBufferAttribute(w,e),i.fromBufferAttribute(S,e),n.w=1,i.w=1,n.applyMatrix4(a),i.applyMatrix4(a),n.z>M&&i.z>M)continue;if(n.z>M){const e=n.z-i.z,t=(n.z-M)/e;n.lerp(i,t)}else if(i.z>M){const e=i.z-n.z,t=(i.z-M)/e;i.lerp(n,t)}n.applyMatrix4(g),i.applyMatrix4(g),n.multiplyScalar(1/n.w),i.multiplyScalar(1/i.w),n.x*=x.x/2,n.y*=x.y/2,i.x*=x.x/2,i.y*=x.y/2,l.start.copy(n),l.start.z=0,l.end.copy(i),l.end.z=0;const o=l.closestPointToPointParameter(s,!0);l.at(o,c);const u=r.MathUtils.lerp(n.z,i.z,o),h=u>=-1&&u<=1,d=s.distanceTo(c)<.5*b;if(h&&d){l.start.fromBufferAttribute(w,e),l.end.fromBufferAttribute(S,e),l.start.applyMatrix4(y),l.end.applyMatrix4(y);const n=new r.Vector3,i=new r.Vector3;f.distanceSqToSegment(l.start,l.end,i,n),t.push({point:i,pointOnLine:n,distance:f.origin.distanceTo(i),object:this,face:null,faceIndex:e,uv:null,uv2:null})}}}}}p.prototype.LineSegments2=!0,r.LineSegments2=p}(),function(){class e extends r.LineSegments2{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.LineGeometry,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.LineMaterial({color:16777215*Math.random()})),this.type="Line2"}}e.prototype.isLine2=!0,r.Line2=e}(),function(){const e=new r.Vector3,t=new r.Vector3;class n extends r.Mesh{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.LineSegmentsGeometry,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new r.LineMaterial({color:16777215*Math.random()})),this.type="Wireframe"}computeLineDistances(){const n=this.geometry,i=n.attributes.instanceStart,o=n.attributes.instanceEnd,s=new Float32Array(2*i.count);for(let n=0,r=0,a=i.count;n<a;n++,r+=2)e.fromBufferAttribute(i,n),t.fromBufferAttribute(o,n),s[r]=0===r?0:s[r-1],s[r+1]=s[r]+e.distanceTo(t);const a=new r.InstancedInterleavedBuffer(s,2,1);return n.setAttribute("instanceDistanceStart",new r.InterleavedBufferAttribute(a,1,0)),n.setAttribute("instanceDistanceEnd",new r.InterleavedBufferAttribute(a,1,1)),this}}n.prototype.isWireframe=!0,r.Wireframe=n}()},6057:(e,t,n)=>{const r=n(4132),i=n(3019),o=n(1115),s=n(1724),a=n(9934),l=n(5691),c=n(6510),u=new o,h=new s,d=new l,p=new a,f=new c;e.exports=function(e,t,n){if(void 0===e)return console.error("Invalid options provided to loadObj()");let o;switch((e=r._validate(e,i.prototype._defaults.loadObj)).type||(e.type="mtl"),e.type){case"mtl":o=u;break;case"gltf":case"glb":o=d;break;case"fbx":o=p;break;case"dae":o=f}h.load(e.mtl,(function(s){s&&"mtl"==e.type&&(s.preload(),o.setMaterials(s)),o.load(e.obj,(o=>{let s=[];switch(e.type){case"mtl":o=o.children[0];break;case"gltf":case"glb":case"dae":s=o.animations,o=o.scene;break;case"fbx":s=o.animations}o.animations=s;const a=r.types.rotation(e.rotation,[0,0,0]),l=r.types.scale(e.scale,[1,1,1]);o.rotation.set(a[0],a[1],a[2]),o.scale.set(l[0],l[1],l[2]),e.normalize&&o.traverse((function(e){if(e.isMesh){let t;"MeshStandardMaterial"==e.material.type?(e.material.metalness&&(e.material.metalness*=.1),e.material.glossiness&&(e.material.glossiness*=.25),t=new THREE.Color(12,12,12)):"MeshPhongMaterial"==e.material.type&&(e.material.shininess=.1,t=new THREE.Color(20,20,20)),e.material.specular&&e.material.specular.isColor&&(e.material.specular=t)}})),o.name="model";let c=i.prototype._makeGroup(o,e);i.prototype._addMethods(c),c.setAnchor(e.anchor),c.setCenter(e.adjustment),c.raycasted=e.raycasted,n(c),t(c),c.setFixedZoom(e.mapScale),c.idle()}),(()=>null),(t=>{console.error("Could not load model file: "+e.obj+" \n "+t.stack),n("Error loading the model")}))}),(()=>null),(e=>{console.warn("No material file found "+e.stack)}))}},6510:(e,t,n)=>{const r=n(61);!function(){class e extends r.Loader{constructor(e){super(e)}load(e,t,n,i){const o=this,s=""===o.path?r.LoaderUtils.extractUrlBase(e):o.path,a=new r.FileLoader(o.manager);a.setPath(o.path),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(n){try{t(o.parse(n,s))}catch(t){i?i(t):console.error(t),o.manager.itemError(e)}}),n,i)}parse(e,t){function n(e,t){const n=[],r=e.childNodes;for(let e=0,i=r.length;e<i;e++){const i=r[e];i.nodeName===t&&n.push(i)}return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=t[e];return n}function o(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=parseFloat(t[e]);return n}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,r=t.length;e<r;e++)n[e]=parseInt(t[e]);return n}function a(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function c(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,i){const o=n(e,t)[0];if(void 0!==o){const e=n(o,r);for(let t=0;t<e.length;t++)i(e[t])}}function d(e,t){for(const n in e)e[n].build=t(e[n])}function p(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){const e=a(r.getAttribute("source")),n=r.getAttribute("semantic");t.inputs[n]=e}}return t}function m(e){const t={};let n=e.getAttribute("target").split("/");const r=n.shift();let i=n.shift();const o=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)n=i.split("."),i=n.shift(),t.member=n.shift();else if(o){const e=i.split("(");i=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=r,t.sid=i,t.arraySyntax=o,t.memberSyntax=s,t.sampler=a(e.getAttribute("source")),t}function g(e){const t=[],n=e.channels,r=e.samplers,i=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const o=n[e],s=r[o.sampler],a=s.inputs.INPUT,l=s.inputs.OUTPUT;w(v(o,i[a],i[l]),t)}return t}function y(e){return p(Xe.animations[e],g)}function v(e,t,n){const r=Xe.nodes[e.id],i=ke(r.id),o=r.transforms[e.sid],s=r.matrix.clone().transpose();let a,l,c,u,h,d;const p={};switch(o){case"matrix":for(c=0,u=t.array.length;c<u;c++)if(a=t.array[c],l=c*n.stride,void 0===p[a]&&(p[a]={}),!0===e.arraySyntax){const t=n.array[l],r=e.indices[0]+4*e.indices[1];p[a][r]=t}else for(h=0,d=n.stride;h<d;h++)p[a][h]=n.array[l+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',o)}const f=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort((function(e,t){return e.time-t.time}));for(let e=0;e<16;e++)S(n,e,t.elements[e]);return n}(p,s);return{name:i.uuid,keyframes:f}}const _=new r.Vector3,x=new r.Vector3,b=new r.Quaternion;function w(e,t){const n=e.keyframes,i=e.name,o=[],s=[],a=[],l=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.time,i=t.value;Ee.fromArray(i).transpose(),Ee.decompose(_,b,x),o.push(r),s.push(_.x,_.y,_.z),a.push(b.x,b.y,b.z,b.w),l.push(x.x,x.y,x.z)}return s.length>0&&t.push(new r.VectorKeyframeTrack(i+".position",o,s)),a.length>0&&t.push(new r.QuaternionKeyframeTrack(i+".quaternion",o,a)),l.length>0&&t.push(new r.VectorKeyframeTrack(i+".scale",o,l)),t}function S(e,t,n){let r,i,o,s=!0;for(i=0,o=e.length;i<o;i++)r=e[i],void 0===r.value[t]?r.value[t]=null:s=!1;if(!0===s)for(i=0,o=e.length;i<o;i++)r=e[i],r.value[t]=n;else!function(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){const o=e[i];if(null===o.value[t]){if(n=M(e,i,t),r=E(e,i,t),null===n){o.value[t]=r.value[t];continue}if(null===r){o.value[t]=n.value[t];continue}T(o,n,r,t)}}}(e,t)}function M(e,t,n){for(;t>=0;){const r=e[t];if(null!==r.value[n])return r;t--}return null}function E(e,t,n){for(;t<e.length;){const r=e[t];if(null!==r.value[n])return r;t++}return null}function T(e,t,n,r){n.time-t.time!=0?e.value[r]=(e.time-t.time)*(n.value[r]-t.value[r])/(n.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function C(e){const t=[],n=e.name,i=e.end-e.start||-1,o=e.animations;for(let e=0,n=o.length;e<n;e++){const n=y(o[e]);for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return new r.AnimationClip(n,i,t)}function A(e){return p(Xe.clips[e],C)}function I(e){const t={sources:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=o(r.textContent);break;case"source":const e=r.getAttribute("id");t.sources[e]=oe(r);break;case"joints":t.joints=P(r);break;case"vertex_weights":t.vertexWeights=R(r)}}return t}function P(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType&&"input"===r.nodeName){const e=r.getAttribute("semantic"),n=a(r.getAttribute("source"));t.inputs[e]=n}}return t}function R(e){const t={inputs:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=r.getAttribute("semantic"),n=a(r.getAttribute("source")),i=parseInt(r.getAttribute("offset"));t.inputs[e]={id:n,offset:i};break;case"vcount":t.vcount=s(r.textContent);break;case"v":t.v=s(r.textContent)}}return t}function L(e){const t={id:e.id},n=Xe.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){const t={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=e.sources,i=e.vertexWeights,o=i.vcount,s=i.v,a=i.inputs.JOINT.offset,l=i.inputs.WEIGHT.offset,c=e.sources[e.joints.inputs.JOINT],u=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=n[i.inputs.WEIGHT.id].array;let d,p,f,m=0;for(d=0,f=o.length;d<f;d++){const e=o[d],n=[];for(p=0;p<e;p++){const e=s[m+a],t=h[s[m+l]];n.push({index:e,weight:t}),m+=2}for(n.sort(g),p=0;p<4;p++){const e=n[p];void 0!==e?(t.indices.array.push(e.index),t.weights.array.push(e.weight)):(t.indices.array.push(0),t.weights.array.push(0))}}for(e.bindShapeMatrix?t.bindMatrix=(new r.Matrix4).fromArray(e.bindShapeMatrix).transpose():t.bindMatrix=(new r.Matrix4).identity(),d=0,f=c.array.length;d<f;d++){const e=c.array[d],n=(new r.Matrix4).fromArray(u.array,d*u.stride).transpose();t.joints.push({name:e,boneInverse:n})}return t;function g(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function D(e){return void 0!==e.build?e.build:e.init_from}function O(e){const t=Xe.images[e];return void 0!==t?p(t,D):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function N(e){const t={surfaces:{},samplers:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"newparam":k(r,t);break;case"technique":t.technique=B(r);break;case"extra":t.extra=Z(r)}}return t}function k(e,t){const n=e.getAttribute("sid");for(let r=0,i=e.childNodes.length;r<i;r++){const i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[n]=F(i);break;case"sampler2D":t.samplers[n]=z(i)}}}function F(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"init_from"===r.nodeName&&(t.init_from=r.textContent)}return t}function z(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"source"===r.nodeName&&(t.source=r.textContent)}return t}function B(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=r.nodeName,t.parameters=U(r)}}return t}function U(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[r.nodeName]=j(r);break;case"transparent":t[r.nodeName]={opaque:r.getAttribute("opaque"),data:j(r)}}}return t}function j(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"color":t[r.nodeName]=o(r.textContent);break;case"float":t[r.nodeName]=parseFloat(r.textContent);break;case"texture":t[r.nodeName]={id:r.getAttribute("texture"),extra:V(r)}}}return t}function V(e){const t={technique:{}};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"extra"===r.nodeName&&G(r,t)}return t}function G(e,t){for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"technique"===r.nodeName&&H(r,t)}}function H(e,t){for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[r.nodeName]=parseFloat(r.textContent);break;case"wrapU":case"wrapV":"TRUE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=1:"FALSE"===r.textContent.toUpperCase()?t.technique[r.nodeName]=0:t.technique[r.nodeName]=parseInt(r.textContent)}}}function Z(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"technique"===r.nodeName&&(t.technique=W(r))}return t}function W(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"double_sided"===r.nodeName&&(t[r.nodeName]=parseInt(r.textContent))}return t}function $(e){return e}function q(e){const t=(n=e.url,p(Xe.effects[n],$));var n;const i=t.profile.technique,o=t.profile.extra;let s;switch(i.type){case"phong":case"blinn":s=new r.MeshPhongMaterial;break;case"lambert":s=new r.MeshLambertMaterial;break;default:s=new r.MeshBasicMaterial}function a(e){const n=t.profile.samplers[e.id];let i=null;if(void 0!==n?i=O(t.profile.surfaces[n.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=O(e.id)),null!==i){const t=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));return n=n.toLowerCase(),t="tga"===n?Ze:He,t}(i);if(void 0!==t){const n=t.load(i),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===l(o.technique)){const e=o.technique;n.wrapS=e.wrapU?r.RepeatWrapping:r.ClampToEdgeWrapping,n.wrapT=e.wrapV?r.RepeatWrapping:r.ClampToEdgeWrapping,n.offset.set(e.offsetU||0,e.offsetV||0),n.repeat.set(e.repeatU||1,e.repeatV||1)}else n.wrapS=r.RepeatWrapping,n.wrapT=r.RepeatWrapping;return n}return console.warn("THREE.ColladaLoader: THREE.Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}s.name=e.name||"";const c=i.parameters;for(const e in c){const t=c[e];switch(e){case"diffuse":t.color&&s.color.fromArray(t.color),t.texture&&(s.map=a(t.texture));break;case"specular":t.color&&s.specular&&s.specular.fromArray(t.color),t.texture&&(s.specularMap=a(t.texture));break;case"bump":t.texture&&(s.normalMap=a(t.texture));break;case"ambient":t.texture&&(s.lightMap=a(t.texture));break;case"shininess":t.float&&s.shininess&&(s.shininess=t.float);break;case"emission":t.color&&s.emissive&&s.emissive.fromArray(t.color),t.texture&&(s.emissiveMap=a(t.texture))}}let u=c.transparent,h=c.transparency;if(void 0===h&&u&&(h={float:1}),void 0===u&&h&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&h)if(u.data.texture)s.transparent=!0;else{const e=u.data.color;switch(u.opaque){case"A_ONE":s.opacity=e[3]*h.float;break;case"RGB_ZERO":s.opacity=1-e[0]*h.float;break;case"A_ZERO":s.opacity=1-e[3]*h.float;break;case"RGB_ONE":s.opacity=e[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}s.opacity<1&&(s.transparent=!0)}return void 0!==o&&void 0!==o.technique&&1===o.technique.double_sided&&(s.side=r.DoubleSide),s}function X(e){return p(Xe.materials[e],q)}function Y(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return K(n)}return{}}function K(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=J(r)}}return t}function J(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function Q(e){let t;switch(e.optics.technique){case"perspective":t=new r.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let n=e.optics.parameters.ymag,i=e.optics.parameters.xmag;const o=e.optics.parameters.aspect_ratio;i=void 0===i?n*o:i,n=void 0===n?i/o:n,i*=.5,n*=.5,t=new r.OrthographicCamera(-i,i,n,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new r.PerspectiveCamera}return t.name=e.name||"",t}function ee(e){const t=Xe.cameras[e];return void 0!==t?p(t,Q):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=r.nodeName,t.parameters=ne(r)}}return t}function ne(e){const t={};for(let n=0,i=e.childNodes.length;n<i;n++){const i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"color":const e=o(i.textContent);t.color=(new r.Color).fromArray(e);break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":const n=parseFloat(i.textContent);t.distance=n?Math.sqrt(1/n):0}}return t}function re(e){let t;switch(e.technique){case"directional":t=new r.DirectionalLight;break;case"point":t=new r.PointLight;break;case"spot":t=new r.SpotLight;break;case"ambient":t=new r.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function ie(e){const t=Xe.lights[e];return void 0!==t?p(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function oe(e){const t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=o(s.textContent);break;case"Name_array":t.array=i(s.textContent);break;case"technique_common":const e=n(s,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function se(e){const t={};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&(t[r.getAttribute("semantic")]=a(r.getAttribute("source")))}return t}function ae(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"input":const e=a(r.getAttribute("source")),n=r.getAttribute("semantic"),i=parseInt(r.getAttribute("offset")),o=parseInt(r.getAttribute("set")),l=o>0?n+o:n;t.inputs[l]={id:e,offset:i},t.stride=Math.max(t.stride,i+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=s(r.textContent);break;case"p":t.p=s(r.textContent)}}return t}function le(e){let t=0;for(let n=0,r=e.length;n<r;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ce(e){const t={},n=e.sources,r=e.vertices,i=e.primitives;if(0===i.length)return{};const o=function(e){const t={};for(let n=0;n<e.length;n++){const r=e[n];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(i);for(const e in o){const i=o[e];le(i),t[e]=ue(i,n,r)}return t}function ue(e,t,n){const i={},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},l={array:[],stride:0},c={array:[],stride:0},u=[],h=[],d=new r.BufferGeometry,p=[];let f=0;for(let r=0;r<e.length;r++){const i=e[r],m=i.inputs;let g=0;switch(i.type){case"lines":case"linestrips":g=2*i.count;break;case"triangles":g=3*i.count;break;case"polylist":for(let e=0;e<i.count;e++){const t=i.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",i.type)}d.addGroup(f,g,r),f+=g,i.material&&p.push(i.material);for(const r in m){const d=m[r];switch(r){case"VERTEX":for(const r in n){const p=n[r];switch(r){case"POSITION":const n=o.array.length;if(he(i,t[p],d.offset,o.array),o.stride=t[p].stride,t.skinWeights&&t.skinIndices&&(he(i,t.skinIndices,d.offset,u),he(i,t.skinWeights,d.offset,h)),!1===i.hasUV&&!0===e.uvsNeedsFix){const e=(o.array.length-n)/o.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":he(i,t[p],d.offset,s.array),s.stride=t[p].stride;break;case"COLOR":he(i,t[p],d.offset,c.array),c.stride=t[p].stride;break;case"TEXCOORD":he(i,t[p],d.offset,a.array),a.stride=t[p].stride;break;case"TEXCOORD1":he(i,t[p],d.offset,l.array),a.stride=t[p].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',r)}}break;case"NORMAL":he(i,t[d.id],d.offset,s.array),s.stride=t[d.id].stride;break;case"COLOR":he(i,t[d.id],d.offset,c.array),c.stride=t[d.id].stride;break;case"TEXCOORD":he(i,t[d.id],d.offset,a.array),a.stride=t[d.id].stride;break;case"TEXCOORD1":he(i,t[d.id],d.offset,l.array),l.stride=t[d.id].stride}}}return o.array.length>0&&d.setAttribute("position",new r.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&d.setAttribute("normal",new r.Float32BufferAttribute(s.array,s.stride)),c.array.length>0&&d.setAttribute("color",new r.Float32BufferAttribute(c.array,c.stride)),a.array.length>0&&d.setAttribute("uv",new r.Float32BufferAttribute(a.array,a.stride)),l.array.length>0&&d.setAttribute("uv2",new r.Float32BufferAttribute(l.array,l.stride)),u.length>0&&d.setAttribute("skinIndex",new r.Float32BufferAttribute(u,4)),h.length>0&&d.setAttribute("skinWeight",new r.Float32BufferAttribute(h,4)),i.data=d,i.type=e[0].type,i.materialKeys=p,i}function he(e,t,n,r){const i=e.p,o=e.stride,s=e.vcount;function a(e){let t=i[e+n]*c;const o=t+c;for(;t<o;t++)r.push(l[t])}const l=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=s.length;t<n;t++){const n=s[t];if(4===n){const t=e+1*o,n=e+2*o,r=e+3*o;a(e+0*o),a(t),a(r),a(t),a(n),a(r)}else if(3===n){const t=e+1*o,n=e+2*o;a(e+0*o),a(t),a(n)}else if(n>4)for(let t=1,r=n-2;t<=r;t++){const n=e+o*t,r=e+o*(t+1);a(e+0*o),a(n),a(r)}e+=o*n}}else for(let e=0,t=i.length;e<t;e+=o)a(e)}function de(e){return p(Xe.geometries[e],ce)}function pe(e){return void 0!==e.build?e.build:e}function fe(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=me(r);break;case"link":t.links.push(ye(r))}}}function me(e){let t;for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=ge(r)}}return t}function ge(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new r.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":const e=o(r.textContent);t.axis.fromArray(e);break;case"limits":const n=r.getElementsByTagName("max")[0],i=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(n.textContent),t.limits.min=parseFloat(i.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function ye(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ve(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(r))}}return t}function ve(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(ye(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(r))}}return t}function _e(e){const t={type:e.nodeName},n=o(e.textContent);switch(t.type){case"matrix":t.obj=new r.Matrix4,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new r.Vector3,t.obj.fromArray(n);break;case"rotate":t.obj=new r.Vector3,t.obj.fromArray(n),t.angle=r.MathUtils.degToRad(n[3])}return t}function xe(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&be(r,t)}}function be(e,t){for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=o(r.textContent);break;case"mass":t.mass=o(r.textContent)[0]}}}function we(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];if(1===r.nodeType&&"axis"===r.nodeName){const e=r.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substr(0,n.length-1)}}return t}function Se(e){return void 0!==e.build?e.build:e}function Me(e){const t=[],n=Ue.querySelector('[id="'+e.id+'"]');for(let e=0;e<n.childNodes.length;e++){const i=n.childNodes[e];if(1!==i.nodeType)continue;let s,a;switch(i.nodeName){case"matrix":s=o(i.textContent);const e=(new r.Matrix4).fromArray(s).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:e});break;case"translate":case"scale":s=o(i.textContent),a=(new r.Vector3).fromArray(s),t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a});break;case"rotate":s=o(i.textContent),a=(new r.Vector3).fromArray(s);const n=r.MathUtils.degToRad(s[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:a,angle:n})}}return t}const Ee=new r.Matrix4,Te=new r.Vector3;function Ce(e){const t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new r.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;let s;switch(i.nodeName){case"node":t.nodes.push(i.getAttribute("id")),Ce(i);break;case"instance_camera":t.instanceCameras.push(a(i.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ae(i));break;case"instance_light":t.instanceLights.push(a(i.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ae(i));break;case"instance_node":t.instanceNodes.push(a(i.getAttribute("url")));break;case"matrix":s=o(i.textContent),t.matrix.multiply(Ee.fromArray(s).transpose()),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"translate":s=o(i.textContent),Te.fromArray(s),t.matrix.multiply(Ee.makeTranslation(Te.x,Te.y,Te.z)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"rotate":s=o(i.textContent);const e=r.MathUtils.degToRad(s[3]);t.matrix.multiply(Ee.makeRotationAxis(Te.fromArray(s),e)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"scale":s=o(i.textContent),t.matrix.scale(Te.fromArray(s)),t.transforms[i.getAttribute("sid")]=i.nodeName;break;case"extra":break;default:console.log(i)}}return Ne(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):Xe.nodes[t.id]=t,t}function Ae(e){const t={id:a(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];switch(r.nodeName){case"bind_material":const e=r.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const r=e[n],i=r.getAttribute("symbol"),o=r.getAttribute("target");t.materials[i]=a(o)}break;case"skeleton":t.skeletons.push(a(r.textContent))}}return t}function Ie(e,t){const n=[],i=[];let o,s,a;for(o=0;o<e.length;o++){const r=e[o];let i;if(Ne(r))i=ke(r),Pe(i,t,n);else if(l=r,void 0!==Xe.visualScenes[l]){const e=Xe.visualScenes[r].children;for(let r=0;r<e.length;r++){const i=e[r];"JOINT"===i.type&&Pe(ke(i.id),t,n)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",r)}var l;for(o=0;o<t.length;o++)for(s=0;s<n.length;s++)if(a=n[s],a.bone.name===t[o].name){i[o]=a,a.processed=!0;break}for(o=0;o<n.length;o++)a=n[o],!1===a.processed&&(i.push(a),a.processed=!0);const c=[],u=[];for(o=0;o<i.length;o++)a=i[o],c.push(a.bone),u.push(a.boneInverse);return new r.Skeleton(c,u)}function Pe(e,t,n){e.traverse((function(e){if(!0===e.isBone){let i;for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e.name){i=r.boneInverse;break}}void 0===i&&(i=new r.Matrix4),n.push({bone:e,boneInverse:i,processed:!1})}}))}function Re(e){const t=[],n=e.matrix,i=e.nodes,o=e.type,s=e.instanceCameras,a=e.instanceControllers,l=e.instanceLights,c=e.instanceGeometries,u=e.instanceNodes;for(let e=0,n=i.length;e<n;e++)t.push(ke(i[e]));for(let e=0,n=s.length;e<n;e++){const n=ee(s[e]);null!==n&&t.push(n.clone())}for(let e=0,n=a.length;e<n;e++){const n=a[e],r=(h=n.id,p(Xe.controllers[h],L)),i=Oe(de(r.id),n.materials),o=Ie(n.skeletons,r.skin.joints);for(let e=0,n=i.length;e<n;e++){const n=i[e];n.isSkinnedMesh&&(n.bind(o,r.skin.bindMatrix),n.normalizeSkinWeights()),t.push(n)}}var h;for(let e=0,n=l.length;e<n;e++){const n=ie(l[e]);null!==n&&t.push(n.clone())}for(let e=0,n=c.length;e<n;e++){const n=c[e],r=Oe(de(n.id),n.materials);for(let e=0,n=r.length;e<n;e++)t.push(r[e])}for(let e=0,n=u.length;e<n;e++)t.push(ke(u[e]).clone());let d;if(0===i.length&&1===t.length)d=t[0];else{d="JOINT"===o?new r.Bone:new r.Group;for(let e=0;e<t.length;e++)d.add(t[e])}return d.name="JOINT"===o?e.sid:e.name,d.matrix.copy(n),d.matrix.decompose(d.position,d.quaternion,d.scale),d}const Le=new r.MeshBasicMaterial({color:16711935});function De(e,t){const n=[];for(let r=0,i=e.length;r<i;r++){const i=t[e[r]];void 0===i?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(Le)):n.push(X(i))}return n}function Oe(e,t){const n=[];for(const i in e){const o=e[i],s=De(o.materialKeys,t);0===s.length&&("lines"===i||"linestrips"===i?s.push(new r.LineBasicMaterial):s.push(new r.MeshPhongMaterial));const a=void 0!==o.data.attributes.skinIndex,l=1===s.length?s[0]:s;let c;switch(i){case"lines":c=new r.LineSegments(o.data,l);break;case"linestrips":c=new r.Line(o.data,l);break;case"triangles":case"polylist":c=a?new r.SkinnedMesh(o.data,l):new r.Mesh(o.data,l)}n.push(c)}return n}function Ne(e){return void 0!==Xe.nodes[e]}function ke(e){return p(Xe.nodes[e],Re)}function Fe(e){const t=new r.Group;t.name=e.name;const n=e.children;for(let e=0;e<n.length;e++){const r=n[e];t.add(ke(r.id))}return t}function ze(e){return p(Xe.visualScenes[e],Fe)}if(0===e.length)return{scene:new r.Scene};const Be=(new DOMParser).parseFromString(e,"application/xml"),Ue=n(Be,"COLLADA")[0],je=Be.getElementsByTagName("parsererror")[0];if(void 0!==je){const e=n(je,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(je),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const Ve=Ue.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ve);const Ge=function(e){return{unit:c(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(Ue,"asset")[0]),He=new r.TextureLoader(this.manager);let Ze;He.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),r.TGALoader&&(Ze=new r.TGALoader(this.manager),Ze.setPath(this.resourcePath||t));const We=[];let $e={},qe=0;const Xe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(Ue,"library_animations","animation",(function e(t){const n={sources:{},samplers:{},channels:{}};let i=!1;for(let r=0,o=t.childNodes.length;r<o;r++){const o=t.childNodes[r];if(1!==o.nodeType)continue;let s;switch(o.nodeName){case"source":s=o.getAttribute("id"),n.sources[s]=oe(o);break;case"sampler":s=o.getAttribute("id"),n.samplers[s]=f(o);break;case"channel":s=o.getAttribute("target"),n.channels[s]=m(o);break;case"animation":e(o),i=!0;break;default:console.log(o)}}!1===i&&(Xe.animations[t.getAttribute("id")||r.MathUtils.generateUUID()]=n)})),h(Ue,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"instance_animation"===r.nodeName&&t.animations.push(a(r.getAttribute("url")))}Xe.clips[e.getAttribute("id")]=t})),h(Ue,"library_controllers","controller",(function(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"skin":t.id=a(r.getAttribute("source")),t.skin=I(r);break;case"morph":t.id=a(r.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Xe.controllers[e.getAttribute("id")]=t})),h(Ue,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Xe.images[e.getAttribute("id")]=t})),h(Ue,"library_effects","effect",(function(e){const t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"profile_COMMON"===r.nodeName&&(t.profile=N(r))}Xe.effects[e.getAttribute("id")]=t})),h(Ue,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"instance_effect"===r.nodeName&&(t.url=a(r.getAttribute("url")))}Xe.materials[e.getAttribute("id")]=t})),h(Ue,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"optics"===r.nodeName&&(t.optics=Y(r))}Xe.cameras[e.getAttribute("id")]=t})),h(Ue,"library_lights","light",(function(e){let t={};for(let n=0,r=e.childNodes.length;n<r;n++){const r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&(t=te(r))}Xe.lights[e.getAttribute("id")]=t})),h(Ue,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){const n=r.childNodes[e];if(1!==n.nodeType)continue;const i=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[i]=oe(n);break;case"vertices":t.vertices=se(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ae(n));break;default:console.log(n)}}Xe.geometries[e.getAttribute("id")]=t}})),h(Ue,"library_nodes","node",Ce),h(Ue,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+qe++)}}(e);const r=n(e,"node");for(let e=0;e<r.length;e++)t.children.push(Ce(r[e]));Xe.visualScenes[e.getAttribute("id")]=t})),h(Ue,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&"technique_common"===r.nodeName&&fe(r,t)}Xe.kinematicsModels[e.getAttribute("id")]=t})),h(Ue,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&"rigid_body"===r.nodeName&&(t.rigidBodies[r.getAttribute("name")]={},xe(r,t.rigidBodies[r.getAttribute("name")]))}Xe.physicsModels[e.getAttribute("id")]=t})),h(Ue,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const r=e.childNodes[n];1===r.nodeType&&"bind_joint_axis"===r.nodeName&&t.bindJointAxis.push(we(r))}Xe.kinematicsScenes[a(e.getAttribute("url"))]=t})),d(Xe.animations,g),d(Xe.clips,C),d(Xe.controllers,L),d(Xe.images,D),d(Xe.effects,$),d(Xe.materials,q),d(Xe.cameras,Q),d(Xe.lights,re),d(Xe.geometries,ce),d(Xe.visualScenes,Fe),function(){const e=Xe.clips;if(!0===l(e)){if(!1===l(Xe.animations)){const e=[];for(const t in Xe.animations){const n=y(t);for(let t=0,r=n.length;t<r;t++)e.push(n[t])}We.push(new r.AnimationClip("default",-1,e))}}else for(const t in e)We.push(A(t))}(),function(){const e=Object.keys(Xe.kinematicsModels)[0],t=Object.keys(Xe.kinematicsScenes)[0],n=Object.keys(Xe.visualScenes)[0];if(void 0===e||void 0===t)return;const i=(o=e,p(Xe.kinematicsModels[o],pe));var o;const s=function(e){return p(Xe.kinematicsScenes[e],Se)}(t),a=ze(n),l=s.bindJointAxis,c={};for(let e=0,t=l.length;e<t;e++){const t=l[e],n=Ue.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;u(t.jointIndex,e)}}function u(e,t){const n=t.getAttribute("name"),r=i.joints[e];a.traverse((function(i){i.name===n&&(c[e]={object:i,transforms:Me(t),joint:r,position:r.zeroPosition})}))}const h=new r.Matrix4;$e={joints:i&&i.joints,getJointValue:function(e){const t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){const n=c[e];if(n){const i=n.joint;if(t>i.limits.max||t<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{const o=n.object,s=i.axis,a=n.transforms;Ee.identity();for(let n=0;n<a.length;n++){const o=a[n];if(o.sid&&-1!==o.sid.indexOf(e))switch(i.type){case"revolute":Ee.multiply(h.makeRotationAxis(s,r.MathUtils.degToRad(t)));break;case"prismatic":Ee.multiply(h.makeTranslation(s.x*t,s.y*t,s.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(o.type){case"matrix":Ee.multiply(o.obj);break;case"translate":Ee.multiply(h.makeTranslation(o.obj.x,o.obj.y,o.obj.z));break;case"scale":Ee.scale(o.obj);break;case"rotate":Ee.multiply(h.makeRotationAxis(o.obj,o.angle))}}o.matrix.copy(Ee),o.matrix.decompose(o.position,o.quaternion,o.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();const Ye=function(e){return ze(a(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(Ue,"scene")[0]);return Ye.animations=We,"Z_UP"===Ge.upAxis&&Ye.quaternion.setFromEuler(new r.Euler(-Math.PI/2,0,0)),Ye.scale.multiplyScalar(Ge.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),We},kinematics:$e,library:Xe,scene:Ye}}}r.ColladaLoader=e}(),e.exports=r.ColladaLoader},9934:(e,t,n)=>{const r=n(61),i=n(9024);!function(){let e,t,n;class o extends r.Loader{constructor(e){super(e)}load(e,t,n,i){const o=this,s=""===o.path?r.LoaderUtils.extractUrlBase(e):o.path,a=new r.FileLoader(this.manager);a.setPath(o.path),a.setResponseType("arraybuffer"),a.setRequestHeader(o.requestHeader),a.setWithCredentials(o.withCredentials),a.load(e,(function(n){try{t(o.parse(n,s))}catch(t){i?i(t):console.error(t),o.manager.itemError(e)}}),n,i)}parse(t,n){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===w(e,0,21)}(t))e=(new u).parse(t);else{const n=w(t);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let e=0;e<t.length;++e)if(r(1)===t[e])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(p(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+p(n));e=(new c).parse(n)}const i=new r.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new s(i,this.manager).parse(e)}}class s{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){t=this.parseConnections();const e=this.parseImages(),r=this.parseTextures(e),i=this.parseMaterials(r),o=this.parseDeformers(),s=(new a).parse(o);return this.parseScene(o,s,i),n}parseConnections(){const t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){const n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});const o={ID:r,relationship:i};t.get(n).parents.push(o),t.has(r)||t.set(r,{parents:[],children:[]});const s={ID:n,relationship:i};t.get(r).children.push(s)})),t}parseImages(){const t={},n={};if("Video"in e.Objects){const r=e.Objects.Video;for(const e in r){const i=r[e];if(t[parseInt(e)]=i.RelativeFilename||i.Filename,"Content"in i){const t=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,o="string"==typeof i.Content&&""!==i.Content;if(t||o){const t=this.parseImage(r[e]);n[i.RelativeFilename||i.Filename]=t}}}}for(const e in t){const r=t[e];void 0!==n[r]?t[e]=n[r]:t[e]=t[e].split("\\").pop()}return t}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let i;switch(r){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof t)return"data:"+i+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:i}))}}parseTextures(t){const n=new Map;if("Texture"in e.Objects){const r=e.Objects.Texture;for(const e in r){const i=this.parseTexture(r[e],t);n.set(parseInt(e),i)}}return n}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,o=e.WrapModeV,s=void 0!==i?i.value:0,a=void 0!==o?o.value:0;if(n.wrapS=0===s?r.RepeatWrapping:r.ClampToEdgeWrapping,n.wrapT=0===a?r.RepeatWrapping:r.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;n.repeat.x=t[0],n.repeat.y=t[1]}return n}loadTexture(e,n){let i;const o=this.textureLoader.path,s=t.get(e.id).children;let a;void 0!==s&&s.length>0&&void 0!==n[s[0].ID]&&(i=n[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));const l=e.FileName.slice(-3).toLowerCase();if("tga"===l){const t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new r.Texture):(t.setPath(this.textureLoader.path),a=t.load(i))}else"psd"===l?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new r.Texture):a=this.textureLoader.load(i);return this.textureLoader.setPath(o),a}parseMaterials(t){const n=new Map;if("Material"in e.Objects){const r=e.Objects.Material;for(const e in r){const i=this.parseMaterial(r[e],t);null!==i&&n.set(parseInt(e),i)}}return n}parseMaterial(e,n){const i=e.id,o=e.attrName;let s=e.ShadingModel;if("object"==typeof s&&(s=s.value),!t.has(i))return null;const a=this.parseParameters(e,n,i);let l;switch(s.toLowerCase()){case"phong":l=new r.MeshPhongMaterial;break;case"lambert":l=new r.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to THREE.MeshPhongMaterial.',s),l=new r.MeshPhongMaterial}return l.setValues(a),l.name=o,l}parseParameters(e,n,i){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new r.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(o.color=(new r.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new r.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(o.emissive=(new r.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new r.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new r.Color).fromArray(e.SpecularColor.value));const s=this;return t.get(i).children.forEach((function(e){const t=e.relationship;switch(t){case"Bump":o.bumpMap=s.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=s.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=s.getTexture(n,e.ID),void 0!==o.map&&(o.map.encoding=r.sRGBEncoding);break;case"DisplacementColor":o.displacementMap=s.getTexture(n,e.ID);break;case"EmissiveColor":o.emissiveMap=s.getTexture(n,e.ID),void 0!==o.emissiveMap&&(o.emissiveMap.encoding=r.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=s.getTexture(n,e.ID);break;case"ReflectionColor":o.envMap=s.getTexture(n,e.ID),void 0!==o.envMap&&(o.envMap.mapping=r.EquirectangularReflectionMapping,o.envMap.encoding=r.sRGBEncoding);break;case"SpecularColor":o.specularMap=s.getTexture(n,e.ID),void 0!==o.specularMap&&(o.specularMap.encoding=r.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=s.getTexture(n,e.ID),o.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),o}getTexture(n,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),r=t.get(r).children[0].ID),n.get(r)}parseDeformers(){const n={},r={};if("Deformer"in e.Objects){const i=e.Objects.Deformer;for(const e in i){const o=i[e],s=t.get(parseInt(e));if("Skin"===o.attrType){const t=this.parseSkeleton(s,i);t.ID=e,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=s.parents[0].ID,n[e]=t}else if("BlendShape"===o.attrType){const t={id:e};t.rawTargets=this.parseMorphTargets(s,i),t.id=e,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),r[e]=t}}}return{skeletons:n,morphTargets:r}}parseSkeleton(e,t){const n=[];return e.children.forEach((function(e){const i=t[e.ID];if("Cluster"!==i.attrType)return;const o={ID:e.ID,indices:[],weights:[],transformLink:(new r.Matrix4).fromArray(i.TransformLink.a)};"Indexes"in i&&(o.indices=i.Indexes.a,o.weights=i.Weights.a),n.push(o)})),{rawBones:n,bones:[]}}parseMorphTargets(e,n){const r=[];for(let i=0;i<e.children.length;i++){const o=e.children[i],s=n[o.ID],a={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;a.geoID=t.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(a)}return r}parseScene(i,o,s){n=new r.Group;const a=this.parseModels(i.skeletons,o,s),c=e.Objects.Model,u=this;a.forEach((function(e){const r=c[e.ID];u.setLookAtProperties(e,r),t.get(e.ID).parents.forEach((function(t){const n=a.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(i.skeletons,o,a),this.createAmbientLight(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=_(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const h=(new l).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=h,n=n.children[0]),n.animations=h}parseModels(n,i,o){const s=new Map,a=e.Objects.Model;for(const e in a){const l=parseInt(e),c=a[e],u=t.get(l);let h=this.buildSkeleton(u,n,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(u);break;case"Light":h=this.createLight(u);break;case"Mesh":h=this.createMesh(u,i,o);break;case"NurbsCurve":h=this.createCurve(u,i);break;case"LimbNode":case"Root":h=new r.Bone;break;default:h=new r.Group}h.name=c.attrName?r.PropertyBinding.sanitizeNodeName(c.attrName):"",h.ID=l}this.getTransformData(h,c),s.set(l,h)}return s}buildSkeleton(e,t,n,i){let o=null;return e.parents.forEach((function(e){for(const s in t){const a=t[s];a.rawBones.forEach((function(t,s){if(t.ID===e.ID){const e=o;o=new r.Bone,o.matrixWorld.copy(t.transformLink),o.name=i?r.PropertyBinding.sanitizeNodeName(i):"",o.ID=n,a.bones[s]=o,null!==e&&o.add(e)}}))}})),o}createCamera(t){let n,i;if(t.children.forEach((function(t){const n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{let e=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(e=1);let t=1;void 0!==i.NearPlane&&(t=i.NearPlane.value/1e3);let o=1e3;void 0!==i.FarPlane&&(o=i.FarPlane.value/1e3);let s=window.innerWidth,a=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(s=i.AspectWidth.value,a=i.AspectHeight.value);const l=s/a;let c=45;void 0!==i.FieldOfView&&(c=i.FieldOfView.value);const u=i.FocalLength?i.FocalLength.value:null;switch(e){case 0:n=new r.PerspectiveCamera(c,l,t,o),null!==u&&n.setFocalLength(u);break;case 1:n=new r.OrthographicCamera(-s/2,s/2,a/2,-a/2,t,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),n=new r.Object3D}}return n}createLight(t){let n,i;if(t.children.forEach((function(t){const n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)})),void 0===i)n=new r.Object3D;else{let e;e=void 0===i.LightType?0:i.LightType.value;let t=16777215;void 0!==i.Color&&(t=(new r.Color).fromArray(i.Color.value));let o=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(o=0);let s=0;void 0!==i.FarAttenuationEnd&&(s=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);const a=1;switch(e){case 0:n=new r.PointLight(t,o,s,a);break;case 1:n=new r.DirectionalLight(t,o);break;case 2:let e=Math.PI/3;void 0!==i.InnerAngle&&(e=r.MathUtils.degToRad(i.InnerAngle.value));let l=0;void 0!==i.OuterAngle&&(l=r.MathUtils.degToRad(i.OuterAngle.value),l=Math.max(l,1)),n=new r.SpotLight(t,o,s,e,l,a);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a THREE.PointLight."),n=new r.PointLight(t,o)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(n.castShadow=!0)}return n}createMesh(e,t,n){let i,o=null,s=null;const a=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),n.has(e.ID)&&a.push(n.get(e.ID))})),a.length>1?s=a:a.length>0?s=a[0]:(s=new r.MeshPhongMaterial({color:13421772}),a.push(s)),"color"in o.attributes&&a.forEach((function(e){e.vertexColors=!0})),o.FBX_Deformer?(i=new r.SkinnedMesh(o,s),i.normalizeSkinWeights()):i=new r.Mesh(o,s),i}createCurve(e,t){const n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),i=new r.LineBasicMaterial({color:3342591,linewidth:1});return new r.Line(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?x(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(i,o){"LookAtProperty"in o&&t.get(i.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){const o=e.Objects.Model[t.ID];if("Lcl_Translation"in o){const e=o.Lcl_Translation.value;void 0!==i.target?(i.target.position.fromArray(e),n.add(i.target)):i.lookAt((new r.Vector3).fromArray(e))}}}))}bindSkeleton(e,n,i){const o=this.parsePoseNodes();for(const s in e){const a=e[s];t.get(parseInt(a.ID)).parents.forEach((function(e){if(n.has(e.ID)){const n=e.ID;t.get(n).parents.forEach((function(e){i.has(e.ID)&&i.get(e.ID).bind(new r.Skeleton(a.bones),o[e.ID])}))}}))}}parsePoseNodes(){const t={};if("Pose"in e.Objects){const n=e.Objects.Pose;for(const e in n)if("BindPose"===n[e].attrType){const i=n[e].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new r.Matrix4).fromArray(e.Matrix.a)})):t[i.Node]=(new r.Matrix4).fromArray(i.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){const t=e.GlobalSettings.AmbientColor.value,i=t[0],o=t[1],s=t[2];if(0!==i||0!==o||0!==s){const e=new r.Color(i,o,s);n.add(new r.AmbientLight(e,1))}}}}class a{parse(n){const r=new Map;if("Geometry"in e.Objects){const i=e.Objects.Geometry;for(const e in i){const o=t.get(parseInt(e)),s=this.parseGeometry(o,i[e],n);r.set(parseInt(e),s)}}return r}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(t,n,r){const i=r.skeletons,o=[],s=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0===s.length)return;const a=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&o.push(r.morphTargets[e.ID])}));const l=s[0],c={};"RotationOrder"in l&&(c.eulerOrder=x(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=_(c);return this.genGeometry(n,a,o,u)}genGeometry(e,t,n,i){const o=new r.BufferGeometry;e.attrName&&(o.name=e.attrName);const s=this.parseGeoNode(e,t),a=this.genBuffers(s),l=new r.Float32BufferAttribute(a.vertex,3);if(l.applyMatrix4(i),o.setAttribute("position",l),a.colors.length>0&&o.setAttribute("color",new r.Float32BufferAttribute(a.colors,3)),t&&(o.setAttribute("skinIndex",new r.Uint16BufferAttribute(a.weightsIndices,4)),o.setAttribute("skinWeight",new r.Float32BufferAttribute(a.vertexWeights,4)),o.FBX_Deformer=t),a.normal.length>0){const e=(new r.Matrix3).getNormalMatrix(i),t=new r.Float32BufferAttribute(a.normal,3);t.applyNormalMatrix(e),o.setAttribute("normal",t)}if(a.uvs.forEach((function(e,t){let n="uv"+(t+1).toString();0===t&&(n="uv"),o.setAttribute(n,new r.Float32BufferAttribute(a.uvs[t],2))})),s.material&&"AllSame"!==s.material.mappingType){let e=a.materialIndex[0],t=0;if(a.materialIndex.forEach((function(n,r){n!==e&&(o.addGroup(t,r-t,e),e=n,t=r)})),o.groups.length>0){const t=o.groups[o.groups.length-1],n=t.start+t.count;n!==a.materialIndex.length&&o.addGroup(n,a.materialIndex.length-n,e)}0===o.groups.length&&o.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(o,e,n,i),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,i=!1,o=[],s=[],a=[],l=[],c=[],u=[];const h=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let y=[],v=[];if(o.push(3*d,3*d+1,3*d+2),e.color){const t=g(p,n,d,e.color);a.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),y.push(e.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(n,r){let i=n,o=y[r];t.forEach((function(t,n,r){if(i>t){r[n]=i,i=t;const s=e[n];e[n]=o,o=s}}))})),y=e,v=t}for(;v.length<4;)v.push(0),y.push(0);for(let e=0;e<4;++e)c.push(v[e]),u.push(y[e])}if(e.normal){const t=g(p,n,d,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=g(p,n,d,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const r=g(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,m&&(h.genFace(t,e,o,f,s,a,l,c,u,r),n++,r=0,o=[],s=[],a=[],l=[],c=[],u=[])})),t}genFace(e,t,n,r,i,o,s,a,l,c){for(let u=2;u<c;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(a[0]),e.vertexWeights.push(a[1]),e.vertexWeights.push(a[2]),e.vertexWeights.push(a[3]),e.vertexWeights.push(a[4*(u-1)]),e.vertexWeights.push(a[4*(u-1)+1]),e.vertexWeights.push(a[4*(u-1)+2]),e.vertexWeights.push(a[4*(u-1)+3]),e.vertexWeights.push(a[4*u]),e.vertexWeights.push(a[4*u+1]),e.vertexWeights.push(a[4*u+2]),e.vertexWeights.push(a[4*u+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(u-1)]),e.weightsIndices.push(l[4*(u-1)+1]),e.weightsIndices.push(l[4*(u-1)+2]),e.weightsIndices.push(l[4*(u-1)+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[3*(u-1)]),e.colors.push(o[3*(u-1)+1]),e.colors.push(o[3*(u-1)+2]),e.colors.push(o[3*u]),e.colors.push(o[3*u+1]),e.colors.push(o[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(u-1)]),e.normal.push(i[3*(u-1)+1]),e.normal.push(i[3*(u-1)+2]),e.normal.push(i[3*u]),e.normal.push(i[3*u+1]),e.normal.push(i[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(s[n][0]),e.uvs[n].push(s[n][1]),e.uvs[n].push(s[n][2*(u-1)]),e.uvs[n].push(s[n][2*(u-1)+1]),e.uvs[n].push(s[n][2*u]),e.uvs[n].push(s[n][2*u+1])}))}addMorphTargets(t,n,r,i){if(0===r.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const o=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const s=e.Objects.Geometry[r.geoID];void 0!==s&&o.genMorphGeometry(t,n,s,i,r.name)}))}))}genMorphGeometry(e,t,n,i,o){const s=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],a=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let e=0;e<l.length;e++){const t=3*l[e];u[t]=a[3*e],u[t+1]=a[3*e+1],u[t+2]=a[3*e+2]}const h={vertexIndices:s,vertexPositions:u},d=this.genBuffers(h),p=new r.Float32BufferAttribute(d.vertex,3);p.name=o||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,i=[];for(let e=0;e<r.length;++e)i.push(e);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===r.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new r.BufferGeometry;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new r.BufferGeometry;const n=t-1,i=e.KnotVector.a,o=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)o.push((new r.Vector4).fromArray(s,e));let a,l;if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){a=n,l=i.length-1-a;for(let e=0;e<n;++e)o.push(o[e])}const c=new r.NURBSCurve(n,i,o,a,l).getPoints(12*o.length);return(new r.BufferGeometry).setFromPoints(c)}}class l{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=t[n],i=this.addClip(r);e.push(i)}return e}parseClips(){if(void 0===e.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}parseAnimationCurveNodes(){const t=e.Objects.AnimationCurveNode,n=new Map;for(const e in t){const r=t[e];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};n.set(e.id,e)}}return n}parseAnimationCurves(n){const r=e.Objects.AnimationCurve;for(const e in r){const i={id:r[e].id,times:r[e].KeyTime.a.map(f),values:r[e].KeyValueFloat.a},o=t.get(i.id);if(void 0!==o){const e=o.parents[0].ID,t=o.parents[0].relationship;t.match(/X/)?n.get(e).curves.x=i:t.match(/Y/)?n.get(e).curves.y=i:t.match(/Z/)?n.get(e).curves.z=i:t.match(/d|DeformPercent/)&&n.has(e)&&(n.get(e).curves.morph=i)}}}parseAnimationLayers(i){const o=e.Objects.AnimationLayer,s=new Map;for(const a in o){const o=[],l=t.get(parseInt(a));void 0!==l&&(l.children.forEach((function(s,a){if(i.has(s.ID)){const l=i.get(s.ID);if(void 0!==l.curves.x||void 0!==l.curves.y||void 0!==l.curves.z){if(void 0===o[a]){const i=t.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==i){const t=e.Objects.Model[i.toString()];if(void 0===t)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);const l={modelName:t.attrName?r.PropertyBinding.sanitizeNodeName(t.attrName):"",ID:t.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===t.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new r.Matrix4),"PreRotation"in t&&(l.preRotation=t.PreRotation.value),"PostRotation"in t&&(l.postRotation=t.PostRotation.value),o[a]=l}}o[a]&&(o[a][l.attr]=l)}else if(void 0!==l.curves.morph){if(void 0===o[a]){const n=t.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,i=t.get(n).parents[0].ID,l=t.get(i).parents[0].ID,c=t.get(l).parents[0].ID,u=e.Objects.Model[c],h={modelName:u.attrName?r.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:e.Objects.Deformer[n].attrName};o[a]=h}o[a][l.attr]=l}}})),s.set(parseInt(a),o))}return s}parseAnimStacks(n){const r=e.Objects.AnimationStack,i={};for(const e in r){const o=t.get(parseInt(e)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=n.get(o[0].ID);i[e]={name:r[e].attrName,layer:s}}return i}addClip(e){let t=[];const n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new r.AnimationClip(e.name,-1,t)}generateTracks(e){const t=[];let n=new r.Vector3,i=new r.Quaternion,o=new r.Vector3;if(e.transform&&e.transform.decompose(n,i,o),n=n.toArray(),i=(new r.Euler).setFromQuaternion(i,e.eulerOrder).toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const r=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==r&&t.push(r)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const n=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==n&&t.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const n=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==n&&t.push(n)}if(void 0!==e.DeformPercent){const n=this.generateMorphTrack(e);void 0!==n&&t.push(n)}return t}generateVectorTrack(e,t,n,i){const o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);return new r.VectorKeyframeTrack(e+"."+i,o,s)}generateRotationTrack(e,t,n,i,o,s){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(r.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(r.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(r.MathUtils.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);void 0!==i&&((i=i.map(r.MathUtils.degToRad)).push(s),i=(new r.Euler).fromArray(i),i=(new r.Quaternion).setFromEuler(i)),void 0!==o&&((o=o.map(r.MathUtils.degToRad)).push(s),o=(new r.Euler).fromArray(o),o=(new r.Quaternion).setFromEuler(o).invert());const c=new r.Quaternion,u=new r.Euler,h=[];for(let e=0;e<l.length;e+=3)u.set(l[e],l[e+1],l[e+2],s),c.setFromEuler(u),void 0!==i&&c.premultiply(i),void 0!==o&&c.multiply(o),c.toArray(h,e/3*4);return new r.QuaternionKeyframeTrack(e+".quaternion",a,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map((function(e){return e/100})),o=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new r.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+o+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==n&&(t[e]=i,n=i,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,i=[];let o=-1,s=-1,a=-1;return e.forEach((function(e){if(t.x&&(o=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(a=t.z.times.indexOf(e)),-1!==o){const e=t.x.values[o];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==s){const e=t.y.values[s];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==a){const e=t.z.values[a];i.push(e),r[2]=e}else i.push(r[2])})),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){const o=i/180,s=r/o;let a=n+s;const l=e.times[t-1],c=(e.times[t]-l)/o;let u=l+c;const h=[],d=[];for(;u<e.times[t];)h.push(u),u+=c,d.push(a),a+=s;e.times=S(e.times,t,h),e.values=S(e.values,t,d)}}}}class c{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new d,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){const i=e.match(/^[\s\t]*;/),o=e.match(/^[\s\t]*$/);if(i||o)return;const s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),a=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):a?t.parseNodeProperty(e,a,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},o=this.parseNodeAttr(r),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in s?("PoseNode"===n?s.PoseNode.push(i):void 0!==s[n].id&&(s[n]={},s[n][s[n].id]=s[n]),""!==o.id&&(s[n][o.id]=i)):"number"==typeof o.id?(s[n]={},s[n][o.id]=i):"Properties70"!==n&&(s[n]="PoseNode"===n?[i]:i),"number"==typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){const e=i.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let s=i.split(",").slice(3);s=s.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",i=[t,n],function(e,t){for(let n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i,s),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=i),r in o&&Array.isArray(o[r])?o[r].push(i):"a"!==r?o[r]=i:o.a=i,this.setCurrentProp(o,r),"a"===r&&","!==i.slice(-1)&&(o.a=b(i))}else this.parseNodeSpecialProperty(e,r,i)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],o=r[1],s=r[2],a=r[3];let l=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:o,type2:s,flag:a,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class u{parse(e){const t=new h(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new d;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),s=e.getString(o);if(0===r)return null;const a=[];for(let t=0;t<i;t++)a.push(this.parseProperty(e));const l=a.length>0?a[0]:"",c=a.length>1?a[1]:"",u=a.length>2?a[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(s,n,r)}return n.propertyList=a,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==u&&(n.attrType=u),""!==s&&(n.name=s),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],o=n.propertyList[3];let s;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),s="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:i,flag:o,value:s}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),s=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===i&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=i.unzlibSync(new Uint8Array(e.getArrayBuffer(s))),l=new h(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(r);case"d":return l.getFloat64Array(r);case"f":return l.getFloat32Array(r);case"i":return l.getInt32Array(r);case"l":return l.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class h{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let n=0;n<e;n++)t[n]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),r.LoaderUtils.decodeText(new Uint8Array(t))}}class d{add(e,t){this[e]=t}}function p(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}const m=[];function g(e,t,n,r){let i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);const o=i*r.dataSize,s=o+r.dataSize;return function(e,t,n,r){for(let i=n,o=0;i<r;i++,o++)e[o]=t[i];return e}(m,r.buffer,o,s)}const y=new r.Euler,v=new r.Vector3;function _(e){const t=new r.Matrix4,n=new r.Matrix4,i=new r.Matrix4,o=new r.Matrix4,s=new r.Matrix4,a=new r.Matrix4,l=new r.Matrix4,c=new r.Matrix4,u=new r.Matrix4,h=new r.Matrix4,d=new r.Matrix4,p=new r.Matrix4,f=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(v.fromArray(e.translation)),e.preRotation){const t=e.preRotation.map(r.MathUtils.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(y.fromArray(t))}if(e.rotation){const t=e.rotation.map(r.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(y.fromArray(t))}if(e.postRotation){const t=e.postRotation.map(r.MathUtils.degToRad);t.push(e.eulerOrder),o.makeRotationFromEuler(y.fromArray(t)),o.invert()}e.scale&&s.scale(v.fromArray(e.scale)),e.scalingOffset&&l.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&a.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&c.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=n.clone().multiply(i).multiply(o),g=new r.Matrix4;g.extractRotation(h);const _=new r.Matrix4;_.copyPosition(h);const x=_.clone().invert().multiply(h),b=g.clone().invert().multiply(x),w=s,S=new r.Matrix4;if(0===f)S.copy(g).multiply(m).multiply(b).multiply(w);else if(1===f)S.copy(g).multiply(b).multiply(m).multiply(w);else{const e=(new r.Matrix4).scale((new r.Vector3).setFromMatrixScale(d)).clone().invert(),t=b.clone().multiply(e);S.copy(g).multiply(m).multiply(t).multiply(w)}const M=u.clone().invert(),E=a.clone().invert();let T=t.clone().multiply(c).multiply(u).multiply(n).multiply(i).multiply(o).multiply(M).multiply(l).multiply(a).multiply(s).multiply(E);const C=(new r.Matrix4).copyPosition(T),A=h.clone().multiply(C);return p.copyPosition(A),T=p.clone().multiply(S),T.premultiply(h.invert()),T}function x(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported THREE.Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function w(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),r.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function S(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}r.FBXLoader=o}(),e.exports=r.FBXLoader},5691:(e,t,n)=>{const r=n(61);!function(){class e extends r.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new p(e)}))}load(e,t,n,i){const o=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{o.parse(n,s,(function(n){t(n),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let a;const l={},c={};if("string"==typeof e)a=e;else if(r.LoaderUtils.decodeText(new Uint8Array(e,0,4))===f){try{l[n.KHR_BINARY_GLTF]=new m(e)}catch(e){return void(s&&s(e))}a=l[n.KHR_BINARY_GLTF].content}else a=r.LoaderUtils.decodeText(new Uint8Array(e));const u=JSON.parse(a);if(void 0===u.asset||u.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new z(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](h);c[t.name]=t,l[t.name]=!0}if(u.extensionsUsed)for(let e=0;e<u.extensionsUsed.length;++e){const t=u.extensionsUsed[e],r=u.extensionsRequired||[];switch(t){case n.KHR_MATERIALS_UNLIT:l[t]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[t]=new _;break;case n.KHR_DRACO_MESH_COMPRESSION:l[t]=new g(u,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:l[t]=new y;break;case n.KHR_MESH_QUANTIZATION:l[t]=new x;break;default:r.indexOf(t)>=0&&void 0===c[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}h.setExtensions(l),h.setPlugins(c),h.parse(i,s)}}function t(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class i{constructor(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let a;const l=new r.Color(16777215);void 0!==s.color&&l.fromArray(s.color);const c=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new r.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new r.PointLight(l),a.distance=c;break;case"spot":a=new r.SpotLight(l),a.distance=c,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class o{constructor(){this.name=n.KHR_MATERIALS_UNLIT}getMaterialType(){return r.MeshBasicMaterial}extendParams(e,t,n){const i=[];e.color=new r.Color(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(i)}}class s{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],s=i.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.Vector2(e,-e)}return Promise.all(o)}}class a{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class l{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],s=i.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&o.push(n.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||0;const a=s.attenuationColor||[1,1,1];return t.attenuationTint=new r.Color(a[0],a[1],a[2]),Promise.all(o)}}class c{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class u{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],s=i.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&o.push(n.assignTexture(t,"specularIntensityMap",s.specularTexture));const a=s.specularColorFactor||[1,1,1];return t.specularTint=new r.Color(a[0],a[1],a[2]),void 0!==s.specularColorTexture&&o.push(n.assignTexture(t,"specularTintMap",s.specularColorTexture).then((function(e){e.encoding=r.sRGBEncoding}))),Promise.all(o)}}class h{constructor(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],o=n.images[i.source],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,s)}}class d{constructor(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],s=r.images[o.source];let a=n.textureLoader;if(s.uri){const e=n.options.manager.getHandler(s.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,s,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class p{constructor(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,o=e.count,s=e.byteStride,a=new ArrayBuffer(o*s),l=new Uint8Array(t[0],n,r);return i.decodeGltfBuffer(new Uint8Array(a),o,s,l,e.mode,e.filter),a}))}return null}}const f="glTF";class m{constructor(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,o=new DataView(e,12);let s=0;for(;s<i;){const t=o.getUint32(s,!0);s+=4;const n=o.getUint32(s,!0);if(s+=4,1313821514===n){const n=new Uint8Array(e,12+s,t);this.content=r.LoaderUtils.decodeText(n)}else if(5130562===n){const n=12+s;this.body=e.slice(n,n+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class g{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,s={},a={},l={};for(const e in o){const t=A[e]||e.toLowerCase();s[t]=o[e]}for(const t in e.attributes){const r=A[t]||t.toLowerCase();if(void 0!==o[t]){const i=n.accessors[e.attributes[t]],o=M[i.componentType];l[r]=o,a[r]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),s,l)}))}))}}class y{constructor(){this.name=n.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class v extends r.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new r.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class _{constructor(){this.name=n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return v}extendParams(e,t,n){const i=t.extensions[this.name];e.color=new r.Color(1,1,1),e.opacity=1;const o=[];if(Array.isArray(i.diffuseFactor)){const t=i.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new r.Color(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new r.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",t)),o.push(n.assignTexture(e,"specularMap",t))}return Promise.all(o)}createMaterial(e){const t=new v(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=r.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class x{constructor(){this.name=n.KHR_MESH_QUANTIZATION}}class b extends r.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}}b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=2*s,l=3*s,c=r-t,u=(n-t)/c,h=u*u,d=h*u,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,y=1-m,v=g-h+u;for(let e=0;e!==s;e++){const t=o[f+e+s],n=o[f+e+a]*c,r=o[p+e+s],l=o[p+e]*c;i[e]=y*t+v*n+m*r+g*l}return i};const w=new r.Quaternion;class S extends b{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return w.fromArray(i).normalize().toArray(i),i}}const M={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},E={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},T={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},A={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete};function R(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function L(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function D(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function O(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function N(e){const t=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+k(t.attributes):e.indices+":"+k(e.attributes)+":"+e.mode,r}function k(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function F(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class z{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new r.ImageBitmapLoader(this.options.manager):this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};L(i,o,r),D(o,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,n){r.load(R(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(e){const o=e[0],s=C[i.type],a=M[i.componentType],l=a.BYTES_PER_ELEMENT,c=l*s,u=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let p,f;if(h&&h!==c){const e=Math.floor(u/h),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=t.cache.get(n);c||(p=new a(o,e*h,i.count*h/l),c=new r.InterleavedBuffer(p,h/l),t.cache.add(n,c)),f=new r.InterleavedBufferAttribute(c,s,u%h/l,d)}else p=null===o?new a(i.count*s):new a(o,u,i.count*s),f=new r.BufferAttribute(p,s,d);if(void 0!==i.sparse){const t=C.SCALAR,n=M[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,u=new n(e[1],l,i.sparse.count*t),h=new a(e[2],c,i.sparse.count*s);null!==o&&(f=new r.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(f.setX(t,h[e*s]),s>=2&&f.setY(t,h[e*s+1]),s>=3&&f.setZ(t,h[e*s+2]),s>=4&&f.setW(t,h[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source];let o=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(o=e)}return this.loadTextureImage(e,i,o)}loadTextureImage(e,t,n){const i=this,o=this.json,s=this.options,a=o.textures[e],l=(t.uri||t.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let u=t.uri||"",h=!1,d=!0;const p=u.search(/\.jpe?g($|\?)/i)>0||0===u.search(/^data\:image\/jpeg/);if(("image/jpeg"===t.mimeType||p)&&(d=!1),void 0!==t.bufferView)u=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);d=6===t||4===t||3===t}h=!0;const n=new Blob([e],{type:t.mimeType});return u=c.createObjectURL(n),u}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(u).then((function(e){return new Promise((function(t,i){let o=t;!0===n.isImageBitmapLoader&&(o=function(e){const n=new r.Texture(e);n.needsUpdate=!0,t(n)}),n.load(R(e,s.path),o,void 0,i)}))})).then((function(t){!0===h&&c.revokeObjectURL(u),t.flipY=!1,a.name&&(t.name=a.name),d||(t.format=r.RGBFormat);const n=(o.samplers||{})[a.sampler]||{};return t.magFilter=E[n.magFilter]||r.LinearFilter,t.minFilter=E[n.minFilter]||r.LinearMipmapLinearFilter,t.wrapS=T[n.wrapS]||r.RepeatWrapping,t.wrapT=T[n.wrapT]||r.RepeatWrapping,i.associations.set(t,{type:"textures",index:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null}));return this.textureCache[l]=f,f}assignTexture(e,t,r){const i=this;return this.getDependency("texture",r.index).then((function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),i.associations.set(o,t)}}return e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new r.PointsMaterial,r.Material.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new r.LineBasicMaterial,r.Material.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(i||o||s){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),i&&(e+="vertex-tangents:"),o&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),o&&(t.vertexColors=!0),s&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return r.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,o=this.extensions,s=i.materials[e];let a;const l={},c=s.extensions||{},u=[];if(c[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=e.getMaterialType(),u.push(e.extendParams(l,s,t))}else if(c[n.KHR_MATERIALS_UNLIT]){const e=o[n.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),u.push(e.extendParams(l,s,t))}else{const n=s.pbrMetallicRoughness||{};if(l.color=new r.Color(1,1,1),l.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==n.baseColorTexture&&u.push(t.assignTexture(l,"map",n.baseColorTexture)),l.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,l.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(u.push(t.assignTexture(l,"metalnessMap",n.metallicRoughnessTexture)),u.push(t.assignTexture(l,"roughnessMap",n.metallicRoughnessTexture))),a=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),u.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===s.doubleSided&&(l.side=r.DoubleSide);const h=s.alphaMode||"OPAQUE";return"BLEND"===h?(l.transparent=!0,l.depthWrite=!1):(l.format=r.RGBFormat,l.transparent=!1,"MASK"===h&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&a!==r.MeshBasicMaterial&&(u.push(t.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.Vector2(1,-1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&a!==r.MeshBasicMaterial&&(u.push(t.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&a!==r.MeshBasicMaterial&&(l.emissive=(new r.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&a!==r.MeshBasicMaterial&&u.push(t.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(u).then((function(){let i;return i=a===v?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new a(l),s.name&&(i.name=s.name),i.map&&(i.map.encoding=r.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=r.sRGBEncoding),D(i,s),t.associations.set(i,{type:"materials",index:e}),s.extensions&&L(o,i,s),i}))}createUniqueName(e){const t=r.PropertyBinding.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,i=this.extensions,o=this.primitiveCache;function s(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return U(n,e,t)}))}const a=[];for(let i=0,l=e.length;i<l;i++){const l=e[i],c=N(l),u=o[c];if(u)a.push(u.promise);else{let e;e=l.extensions&&l.extensions[n.KHR_DRACO_MESH_COMPRESSION]?s(l):U(new r.BufferGeometry,l,t),o[c]={primitive:l,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,o=n.meshes[e],s=o.primitives,a=[];for(let e=0,t=s.length;e<t;e++){const t=void 0===s[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),l.DefaultMaterial):this.getDependency("material",s[e].material);a.push(t)}var l;return a.push(t.loadGeometries(s)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),l=n[n.length-1],c=[];for(let n=0,u=l.length;n<u;n++){const u=l[n],h=s[n];let d;const p=a[n];if(4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)d=!0===o.isSkinnedMesh?new r.SkinnedMesh(u,p):new r.Mesh(u,p),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),5===h.mode?d.geometry=j(d.geometry,r.TriangleStripDrawMode):6===h.mode&&(d.geometry=j(d.geometry,r.TriangleFanDrawMode));else if(1===h.mode)d=new r.LineSegments(u,p);else if(3===h.mode)d=new r.Line(u,p);else if(2===h.mode)d=new r.LineLoop(u,p);else{if(0!==h.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);d=new r.Points(u,p)}Object.keys(d.geometry.morphAttributes).length>0&&O(d,o),d.name=t.createUniqueName(o.name||"mesh_"+e),D(d,o),h.extensions&&L(i,d,h),t.assignFinalMaterial(d),c.push(d)}if(1===c.length)return c[0];const u=new r.Group;for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u}))}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new r.PerspectiveCamera(r.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new r.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),D(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],i=[],o=[],s=[],a=[];for(let e=0,r=t.channels.length;e<r;e++){const r=t.channels[e],l=t.samplers[r.sampler],c=r.target,u=void 0!==c.node?c.node:c.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),s.push(l),a.push(c)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(s),Promise.all(a)]).then((function(n){const i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],c=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=o[e],u=s[e],h=a[e],d=l[e];if(void 0===t)continue;let p;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,I[d.path]){case I.weights:p=r.NumberKeyframeTrack;break;case I.rotation:p=r.QuaternionKeyframeTrack;break;default:p=r.VectorKeyframeTrack}const f=t.name?t.name:t.uuid,m=void 0!==h.interpolation?P[h.interpolation]:r.InterpolateLinear,g=[];I[d.path]===I.weights?t.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(f);let y=u.array;if(u.normalized){const e=F(y.constructor),t=new Float32Array(y.length);for(let n=0,r=y.length;n<r;n++)t[n]=y[n]*e;y=t}for(let e=0,t=g.length;e<t;e++){const t=new p(g[e]+"."+I[d.path],n.array,y,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new(this instanceof r.QuaternionKeyframeTrack?S:b)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const u=t.name?t.name:"animation_"+e;return new r.AnimationClip(u,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,i=this,o=t.nodes[e],s=o.name?i.createUniqueName(o.name):"";return function(){const t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let a;if(a=!0===o.isBone?new r.Bone:t.length>1?new r.Group:1===t.length?t[0]:new r.Object3D,a!==t[0])for(let e=0,n=t.length;e<n;e++)a.add(t[e]);if(o.name&&(a.userData.name=o.name,a.name=s),D(a,o),o.extensions&&L(n,a,o),void 0!==o.matrix){const e=new r.Matrix4;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return i.associations.set(a,{type:"nodes",index:e}),a}))}loadScene(e){const t=this.json,n=this.extensions,i=this.json.scenes[e],o=this,s=new r.Group;i.name&&(s.name=o.createUniqueName(i.name)),D(s,i),i.extensions&&L(n,s,i);const a=i.nodes||[],l=[];for(let e=0,n=a.length;e<n;e++)l.push(B(a[e],s,t,o));return Promise.all(l).then((function(){return s}))}}function B(e,t,n,i){const o=n.nodes[e];return i.getDependency("node",e).then((function(e){if(void 0===o.skin)return e;let t;return i.getDependency("skin",o.skin).then((function(e){t=e;const n=[];for(let e=0,r=t.joints.length;e<r;e++)n.push(i.getDependency("node",t.joints[e]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const i=[],o=[];for(let e=0,s=n.length;e<s;e++){const s=n[e];if(s){i.push(s);const n=new r.Matrix4;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*e),o.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new r.Skeleton(i,o),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const r=[];if(o.children){const t=o.children;for(let o=0,s=t.length;o<s;o++){const s=t[o];r.push(B(s,e,n,i))}}return Promise.all(r)}))}function U(e,t,n){const i=t.attributes,o=[];function s(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const t in i){const n=A[t]||t.toLowerCase();n in e.attributes||o.push(s(i[t],n))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(r)}return D(e,t),function(e,t,n){const i=t.attributes,o=new r.Box3;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,s=e.max;if(void 0===t||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new r.Vector3(t[0],t[1],t[2]),new r.Vector3(s[0],s[1],s[2])),e.normalized){const t=F(M[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const s=t.targets;if(void 0!==s){const e=new r.Vector3,t=new r.Vector3;for(let r=0,i=s.length;r<i;r++){const i=s[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],o=r.min,s=r.max;if(void 0!==o&&void 0!==s){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),r.normalized){const e=F(M[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(e)}e.boundingBox=o;const a=new r.Sphere;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}(e,t,n),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);const o=[],s=[];for(let a=0,l=t.length;a<l;a++){const l=t[a];if(r){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;s.push(t)}}return Promise.all([Promise.all(o),Promise.all(s)]).then((function(t){const n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function j(e,t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,o=[];if(t===r.TriangleFanDrawMode)for(let e=1;e<=i;e++)o.push(n.getX(0)),o.push(n.getX(e)),o.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(o.push(n.getX(e)),o.push(n.getX(e+1)),o.push(n.getX(e+2))):(o.push(n.getX(e+2)),o.push(n.getX(e+1)),o.push(n.getX(e)));o.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(o),s}r.GLTFLoader=e}(),e.exports=r.GLTFLoader},1724:(e,t,n)=>{const r=n(61);!function(){class e extends r.Loader{constructor(e){super(e)}load(e,t,n,i){const o=this,s=""===this.path?r.LoaderUtils.extractUrlBase(e||""):this.path,a=new r.FileLoader(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(o.parse(n,s))}catch(t){i?i(t):console.error(t),o.manager.itemError(e)}}),n,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,n){const r=e.split("\n");let i={};const o=/\s+/,s={};for(let e=0;e<r.length;e++){let t=r[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const n=t.indexOf(" ");let a=n>=0?t.substring(0,n):t;a=a.toLowerCase();let l=n>=0?t.substring(n+1):"";if(l=l.trim(),"newmtl"===a)i={name:l},s[l]=i;else if("ka"===a||"kd"===a||"ks"===a||"ke"===a){const e=l.split(o,3);i[a]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[a]=l}const a=new t(this.resourcePath||n,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(s),a}}class t{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:r.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:r.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],i={};t[n]=i;for(const e in r){let t=!0,n=r[e];const o=e.toLowerCase();switch(o){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[2]&&(t=!1)}t&&(i[o]=n)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],i={name:e,side:this.side};function o(e,n){if(i[e])return;const r=t.getTextureParams(n,i),o=t.loadTexture((s=t.baseUrl,"string"!=typeof(a=r.url)||""===a?"":/^https?:\/\//i.test(a)?a:s+a));var s,a;o.repeat.copy(r.scale),o.offset.copy(r.offset),o.wrapS=t.wrap,o.wrapT=t.wrap,i[e]=o}for(const e in n){const t=n[e];let s;if(""!==t)switch(e.toLowerCase()){case"kd":i.color=(new r.Color).fromArray(t);break;case"ks":i.specular=(new r.Color).fromArray(t);break;case"ke":i.emissive=(new r.Color).fromArray(t);break;case"map_kd":o("map",t);break;case"map_ks":o("specularMap",t);break;case"map_ke":o("emissiveMap",t);break;case"norm":o("normalMap",t);break;case"map_bump":case"bump":o("bumpMap",t);break;case"map_d":o("alphaMap",t),i.transparent=!0;break;case"ns":i.shininess=parseFloat(t);break;case"d":s=parseFloat(t),s<1&&(i.opacity=s,i.transparent=!0);break;case"tr":s=parseFloat(t),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(i.opacity=1-s,i.transparent=!0)}}return this.materials[e]=new r.MeshPhongMaterial(i),this.materials[e]}getTextureParams(e,t){const n={scale:new r.Vector2(1,1),offset:new r.Vector2(0,0)},i=e.split(/\s+/);let o;return o=i.indexOf("-bm"),o>=0&&(t.bumpScale=parseFloat(i[o+1]),i.splice(o,2)),o=i.indexOf("-s"),o>=0&&(n.scale.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),o=i.indexOf("-o"),o>=0&&(n.offset.set(parseFloat(i[o+1]),parseFloat(i[o+2])),i.splice(o,4)),n.url=i.join(" ").trim(),n}loadTexture(e,t,n,i,o){const s=void 0!==this.manager?this.manager:r.DefaultLoadingManager;let a=s.getHandler(e);null===a&&(a=new r.TextureLoader(s)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const l=a.load(e,n,i,o);return void 0!==t&&(l.mapping=t),l}}r.MTLLoader=e}(),e.exports=r.MTLLoader},1115:(e,t,n)=>{const r=n(61);!function(){const e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,i=/^usemap /,o=new r.Vector3,s=new r.Vector3,a=new r.Vector3,l=new r.Vector3,c=new r.Vector3;function u(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){const e=n.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const r=this.vertices,i=this.object.geometry.vertices;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,i=this.object.geometry.normals;i.push(r[e+0],r[e+1],r[e+2]),i.push(r[t+0],r[t+1],r[t+2]),i.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,i=this.object.geometry.normals;o.fromArray(r,e),s.fromArray(r,t),a.fromArray(r,n),c.subVectors(a,s),l.subVectors(o,s),c.cross(l),c.normalize(),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z),i.push(c.x,c.y,c.z)},addColor:function(e,t,n){const r=this.colors,i=this.object.geometry.colors;void 0!==r[e]&&i.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&i.push(r[t+0],r[t+1],r[t+2]),void 0!==r[n]&&i.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,i=this.object.geometry.uvs;i.push(r[e+0],r[e+1]),i.push(r[t+0],r[t+1]),i.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,i,o,s,a,l){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),h=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(u,h,d),this.addColor(u,h,d),void 0!==s&&""!==s){const e=this.normals.length;u=this.parseNormalIndex(s,e),h=this.parseNormalIndex(a,e),d=this.parseNormalIndex(l,e),this.addNormal(u,h,d)}else this.addFaceNormal(u,h,d);if(void 0!==r&&""!==r){const e=this.uvs.length;u=this.parseUVIndex(r,e),h=this.parseUVIndex(i,e),d=this.parseUVIndex(o,e),this.addUV(u,h,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let t=0,r=e.length;t<r;t++)this.addVertexLine(this.parseVertexIndex(e[t],n));for(let e=0,n=t.length;e<n;e++)this.addUVLine(this.parseUVIndex(t[e],r))}};return e.startObject("",!1),e}class h extends r.Loader{constructor(e){super(e),this.materials=null}load(e,t,n,i){const o=this,s=new r.FileLoader(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(o.parse(n))}catch(t){i?i(t):console.error(t),o.manager.itemError(e)}}),n,i)}setMaterials(e){return this.materials=e,this}parse(o){const s=new u;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));const a=o.split("\n");let l="",c="",h=0,d=[];const p="function"==typeof"".trimLeft;for(let r=0,o=a.length;r<o;r++)if(l=a[r],l=p?l.trimLeft():l.trim(),h=l.length,0!==h&&(c=l.charAt(0),"#"!==c))if("v"===c){const e=l.split(/\s+/);switch(e[0]){case"v":s.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?s.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):s.colors.push(void 0,void 0,void 0);break;case"vn":s.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":s.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===c){const e=l.substr(1).trim().split(/\s+/),t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.length>0){const e=r.split("/");t.push(e)}}const n=t[0];for(let e=1,r=t.length-1;e<r;e++){const r=t[e],i=t[e+1];s.addFace(n[0],r[0],i[0],n[1],r[1],i[1],n[2],r[2],i[2])}}else if("l"===c){const e=l.substring(1).trim().split(" ");let t=[];const n=[];if(-1===l.indexOf("/"))t=e;else for(let r=0,i=e.length;r<i;r++){const i=e[r].split("/");""!==i[0]&&t.push(i[0]),""!==i[1]&&n.push(i[1])}s.addLineGeometry(t,n)}else if("p"===c){const e=l.substr(1).trim().split(" ");s.addPointGeometry(e)}else if(null!==(d=e.exec(l))){const e=(" "+d[0].substr(1).trim()).substr(1);s.startObject(e)}else if(n.test(l))s.object.startMaterial(l.substring(7).trim(),s.materialLibraries);else if(t.test(l))s.materialLibraries.push(l.substring(7).trim());else if(i.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if(d=l.split(" "),d.length>1){const e=d[1].trim().toLowerCase();s.object.smooth="0"!==e&&"off"!==e}else s.object.smooth=!0;const e=s.object.currentMaterial();e&&(e.smooth=s.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}s.finalize();const f=new r.Group;if(f.materialLibraries=[].concat(s.materialLibraries),!0==!(1===s.objects.length&&0===s.objects[0].geometry.vertices.length))for(let e=0,t=s.objects.length;e<t;e++){const t=s.objects[e],n=t.geometry,i=t.materials,o="Line"===n.type,a="Points"===n.type;let l=!1;if(0===n.vertices.length)continue;const c=new r.BufferGeometry;c.setAttribute("position",new r.Float32BufferAttribute(n.vertices,3)),n.normals.length>0&&c.setAttribute("normal",new r.Float32BufferAttribute(n.normals,3)),n.colors.length>0&&(l=!0,c.setAttribute("color",new r.Float32BufferAttribute(n.colors,3))),!0===n.hasUVIndices&&c.setAttribute("uv",new r.Float32BufferAttribute(n.uvs,2));const u=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],n=t.name+"_"+t.smooth+"_"+l;let c=s.materials[n];if(null!==this.materials)if(c=this.materials.create(t.name),!o||!c||c instanceof r.LineBasicMaterial){if(a&&c&&!(c instanceof r.PointsMaterial)){const e=new r.PointsMaterial({size:10,sizeAttenuation:!1});r.Material.prototype.copy.call(e,c),e.color.copy(c.color),e.map=c.map,c=e}}else{const e=new r.LineBasicMaterial;r.Material.prototype.copy.call(e,c),e.color.copy(c.color),c=e}void 0===c&&(c=o?new r.LineBasicMaterial:a?new r.PointsMaterial({size:1,sizeAttenuation:!1}):new r.MeshPhongMaterial,c.name=t.name,c.flatShading=!t.smooth,c.vertexColors=l,s.materials[n]=c),u.push(c)}let h;if(u.length>1){for(let e=0,t=i.length;e<t;e++){const t=i[e];c.addGroup(t.groupStart,t.groupCount,e)}h=o?new r.LineSegments(c,u):a?new r.Points(c,u):new r.Mesh(c,u)}else h=o?new r.LineSegments(c,u[0]):a?new r.Points(c,u[0]):new r.Mesh(c,u[0]);h.name=t.name,f.add(h)}else if(s.vertices.length>0){const e=new r.PointsMaterial({size:1,sizeAttenuation:!1}),t=new r.BufferGeometry;t.setAttribute("position",new r.Float32BufferAttribute(s.vertices,3)),s.colors.length>0&&void 0!==s.colors[0]&&(t.setAttribute("color",new r.Float32BufferAttribute(s.colors,3)),e.vertexColors=!0);const n=new r.Points(t,e);f.add(n)}return f}}r.OBJLoader=h}(),e.exports=r.OBJLoader},3019:(e,t,n)=>{const r=n(4132),i=(n(6475),n(61)),s=n(3799),a=n(7145);function l(){}l.prototype={line:function(e){e=r._validate(e,this._defaults.line);var t=r.lnglatsToWorld(e.geometry),n=r.normalizeVertices(t),o=r.flattenVectors(n.vertices),s=new Float32Array(o),a=new i.BufferGeometry;a.setAttribute("position",new i.BufferAttribute(s,3));var l=new i.LineBasicMaterial({color:16711680,linewidth:21}),c=new i.Line(a,l);return c.options=options||{},c.position.copy(n.position),c},extrusion:function(e){},unenroll:function(e,t){t||this.animationManager.unenroll(e)},_addMethods:function(e,t){var n=this;const o="label",s="tooltip",c="help",u="shadowPlane";if(t);else{function h(e,t,n,i){let o=r.radify(i);e.position.sub(t),e.position.applyAxisAngle(n,o),e.position.add(t),e.rotateOnAxis(n,o),tb.map.repaint=!0}e.coordinates||(e.coordinates=[0,0,0]),Object.defineProperty(e,"model",{get:()=>e.getObjectByName("model")}),Object.defineProperty(e,"animations",{get(){const t=e.model;return t?t.animations:null}}),n.animationManager.enroll(e),e.setCoords=function(t){return e.userData.topMargin&&e.userData.feature&&(t[2]+=((e.userData.feature.properties.height||0)-(e.userData.feature.properties.base_height||e.userData.feature.properties.min_height||0))*(e.userData.topMargin||0)),e.coordinates=t,e.set({position:t}),e},e.setTranslate=function(t){return e.set({translate:t}),e},e.setRotation=function(t){"number"==typeof t&&(t={z:t});var n={x:r.radify(t.x)||e.rotation.x,y:r.radify(t.y)||e.rotation.y,z:r.radify(t.z)||e.rotation.z};e._setObject({rotation:[n.x,n.y,n.z]})},e.calculateAdjustedPosition=function(t,n,i){let o=t.slice(),s=r.unprojectFromWorld(e.modelSize);return i?(o[0]-=0!=n.x?s[0]/n.x:0,o[1]-=0!=n.y?s[1]/n.y:0,o[2]-=0!=n.z?s[2]/n.z:0):(o[0]+=0!=n.x?s[0]/n.x:0,o[1]+=0!=n.y?s[1]/n.y:0,o[2]+=0!=n.z?s[2]/n.z:0),o},e.setRotationAxis=function(t){"number"==typeof t&&(t={z:t});let n=e.modelBox(),r=new i.Vector3(n.max.x,n.max.y,n.min.z);0!=t.x&&h(e,r,new i.Vector3(0,0,1),t.x),0!=t.y&&h(e,r,new i.Vector3(0,0,1),t.y),0!=t.z&&h(e,r,new i.Vector3(0,0,1),t.z)},Object.defineProperty(e,"scaleGroup",{get:()=>e.getObjectByName("scaleGroup")}),Object.defineProperty(e,"boxGroup",{get:()=>e.getObjectByName("boxGroup")}),Object.defineProperty(e,"boundingBox",{get:()=>e.getObjectByName("boxModel")}),Object.defineProperty(e,"boundingBoxShadow",{get:()=>e.getObjectByName("boxShadow")}),e.drawBoundingBox=function(){let t=e.box3(),n=new i.Group;n.name="boxGroup",n.updateMatrixWorld(!0);let r=new i.Box3Helper(t,l.prototype._defaults.colors.yellow);r.name="boxModel",n.add(r),r.layers.disable(0);let o=t.clone();o.max.z=o.min.z;let s=new i.Box3Helper(o,l.prototype._defaults.colors.black);s.name="boxShadow",n.add(s),s.layers.disable(0),n.visible=!1,e.scaleGroup.add(n),e.setBoundingBoxShadowFloor()},e.setBoundingBoxShadowFloor=function(){if(e.boundingBoxShadow){let t=-e.modelHeight,n=e.rotation,r=e.boundingBoxShadow;r.box.max.z=r.box.min.z=t,r.rotation.y=n.y,r.rotation.x=-n.x}},e.setAnchor=function(t){const n=e.box3(),r=n.getCenter(new i.Vector3);switch(e.none={x:0,y:0,z:0},e.center={x:r.x,y:r.y,z:n.min.z},e.bottom={x:r.x,y:n.max.y,z:n.min.z},e.bottomLeft={x:n.max.x,y:n.max.y,z:n.min.z},e.bottomRight={x:n.min.x,y:n.max.y,z:n.min.z},e.top={x:r.x,y:n.min.y,z:n.min.z},e.topLeft={x:n.max.x,y:n.min.y,z:n.min.z},e.topRight={x:n.min.x,y:n.min.y,z:n.min.z},e.left={x:n.max.x,y:r.y,z:n.min.z},e.right={x:n.min.x,y:r.y,z:n.min.z},t){case"center":e.anchor=e.center;break;case"top":e.anchor=e.top;break;case"top-left":e.anchor=e.topLeft;break;case"top-right":e.anchor=e.topRight;break;case"left":e.anchor=e.left;break;case"right":e.anchor=e.right;break;case"bottom":e.anchor=e.bottom;break;case"bottom-left":default:e.anchor=e.bottomLeft;break;case"bottom-right":e.anchor=e.bottomRight;break;case"auto":case"none":e.anchor=e.none}e.model.position.set(-e.anchor.x,-e.anchor.y,-e.anchor.z)},e.setCenter=function(t){if(t&&(0!=t.x||0!=t.y||0!=t.z)){let n=e.getSize();e.anchor={x:e.anchor.x-n.x*t.x,y:e.anchor.y-n.y*t.y,z:e.anchor.z-n.z*t.z},e.model.position.set(-e.anchor.x,-e.anchor.y,-e.anchor.z)}},Object.defineProperty(e,"label",{get:()=>e.getObjectByName(o)}),Object.defineProperty(e,"tooltip",{get:()=>e.getObjectByName(s)}),Object.defineProperty(e,"help",{get:()=>e.getObjectByName(c)});let p=!1;Object.defineProperty(e,"hidden",{get:()=>p,set(t){p!=t&&(p=t,e.visibility=!p)}}),Object.defineProperty(e,"visibility",{get:()=>e.visible,set(t){let n=t;if("visible"==t||1==t)n=!0,e.label&&(e.label.visible=n);else{if("none"!=t&&0!=t)return;n=!1,e.label&&e.label.alwaysVisible&&(e.label.visible=n),e.tooltip&&(e.tooltip.visible=n)}if(e.visible!=n){if(e.hidden&&n)return;e.visible=n,e.model&&e.model.traverse((function(t){"Mesh"!=t.type&&"SkinnedMesh"!=t.type||(n&&e.raycasted?t.layers.enable(0):t.layers.disable(0)),"LineSegments"==t.type&&t.layers.disableAll()}))}}}),e.addLabel=function(t,n,r,i){t&&e.drawLabelHTML(t,n,r,i)},e.removeLabel=function(){e.removeCSS2D(o)},e.drawLabelHTML=function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.anchor,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=n.drawLabelHTML(t,l.prototype._defaults.label.cssClass),c=e.addCSS2D(a,o,i,s);return c.alwaysVisible=r,c.visible=r,c},e.addTooltip=function(t,n,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=e.addHelp(t,s,n,r,o);a.visible=!1,a.custom=i},e.removeTooltip=function(){e.removeCSS2D(s)},e.addHelp=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.anchor,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=n.drawTooltip(t,i),l=e.addCSS2D(a,r,o,s);return l.visible=!0,l},e.removeHelp=function(){e.removeCSS2D(c)},e.addCSS2D=function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.anchor,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(t){const s=e.box3(),l=s.getSize(new i.Vector3);let c={x:s.max.x,y:s.max.y,z:s.min.z};e.removeCSS2D(n);let u=new a.CSS2DObject(t);return u.name=n,u.position.set(.5*-l.x-e.model.position.x-r.x+c.x,.5*-l.y-e.model.position.y-r.y+c.y,l.z*o),u.visible=!1,e.scaleGroup.add(u),u}},e.removeCSS2D=function(t){let n=e.getObjectByName(t);if(n){n.dispose();let t=e.scaleGroup.children;t.splice(t.indexOf(n),1)}},Object.defineProperty(e,"shadowPlane",{get:()=>e.getObjectByName(u)});let f=!1;Object.defineProperty(e,"castShadow",{get:()=>f,set(t){if(e.model&&f!==t){if(e.model.traverse((function(e){e.isMesh&&(e.castShadow=!0)})),t){const n=e.modelSize,r=[n.x,n.y,n.z,e.modelHeight],o=10*Math.max(...r),s=new i.PlaneBufferGeometry(o,o),a=new i.ShadowMaterial;a.opacity=.5;let l=new i.Mesh(s,a);l.name=u,l.layers.enable(1),l.layers.disable(0),l.receiveShadow=t,e.add(l)}else e.traverse((function(t){t.isMesh&&t.material instanceof i.ShadowMaterial&&e.remove(t)}));f=t}}}),e.setReceiveShadowFloor=function(){if(e.castShadow){let t=e.shadowPlane,n=t.position,r=t.rotation;if(n.z=-e.modelHeight,r.y=e.rotation.y,r.x=-e.rotation.x,"meters"===e.userData.units){const r=e.modelSize,i=[r.x,r.y,r.z,-n.z],o=10*Math.max(...i)/t.geometry.parameters.width;t.scale.set(o,o,o)}}};let m=!1;Object.defineProperty(e,"receiveShadow",{get:()=>m,set(t){e.model&&m!==t&&(e.model.traverse((function(e){e.isMesh&&(e.receiveShadow=!0)})),m=t)}});let g=!1;Object.defineProperty(e,"wireframe",{get:()=>g,set(t){e.model&&g!==t&&(e.model.traverse((function(e){if("Mesh"==e.type||"SkinnedMesh"==e.type){let n=[];Array.isArray(e.material)?n=e.material:n.push(e.material);let r=n[0];t?(e.userData.materials=r,e.material=r.clone(),e.material.wireframe=e.material.transparent=t,e.material.opacity=.3):(e.material.dispose(),e.material=e.userData.materials,e.userData.materials.dispose(),e.userData.materials=null),t?(e.layers.disable(0),e.layers.enable(1)):(e.layers.disable(1),e.layers.enable(0))}"LineSegments"==e.type&&e.layers.disableAll()})),g=t,e.dispatchEvent({type:"Wireframed",detail:e}))}});let y=null;Object.defineProperty(e,"color",{get:()=>y,set(t){e.model&&y!==t&&(e.model.traverse((function(e){if("Mesh"==e.type||"SkinnedMesh"==e.type){let n=[];Array.isArray(e.material)?n=e.material:n.push(e.material);let r=n[0];t?(e.userData.materials=r,e.material=new i.MeshStandardMaterial,e.material.color.setHex(t)):(e.material.dispose(),e.material=e.userData.materials,e.userData.materials.dispose(),e.userData.materials=null)}})),y=t)}});let v=!1;Object.defineProperty(e,"selected",{get:()=>v,set(t){t?(e.userData.bbox&&!e.boundingBox&&e.drawBoundingBox(),e.boxGroup&&(e.boundingBox.material=l.prototype._defaults.materials.boxSelectedMaterial,e.boundingBox.parent.visible=!0,e.boundingBox.layers.enable(1),e.boundingBoxShadow.layers.enable(1)),e.label&&!e.label.alwaysVisible&&(e.label.visible=!0)):(e.boxGroup&&e.remove(e.boxGroup),e.label&&!e.label.alwaysVisible&&(e.label.visible=!1),e.removeHelp()),e.tooltip&&(e.tooltip.visible=t),v!=t&&(v=t,e.dispatchEvent({type:"SelectedChange",detail:e}))}});let _=!0;Object.defineProperty(e,"raycasted",{get:()=>_,set(t){e.model&&_!==t&&(e.model.traverse((function(e){"Mesh"!=e.type&&"SkinnedMesh"!=e.type||(t?(e.layers.disable(1),e.layers.enable(0)):(e.layers.disable(0),e.layers.enable(1)))})),_=t)}});let x=!1;Object.defineProperty(e,"over",{get:()=>x,set(t){t?(e.selected||(e.userData.bbox&&!e.boundingBox&&e.drawBoundingBox(),e.userData.tooltip&&!e.tooltip&&e.addTooltip(e.uuid,!0,e.anchor,!1),e.boxGroup&&(e.boundingBox.material=l.prototype._defaults.materials.boxOverMaterial,e.boundingBox.parent.visible=!0,e.boundingBox.layers.enable(1),e.boundingBoxShadow.layers.enable(1))),e.label&&!e.label.alwaysVisible&&(e.label.visible=!0),e.dispatchEvent({type:"ObjectMouseOver",detail:e})):(e.selected||(e.boxGroup&&(e.remove(e.boxGroup),e.tooltip&&!e.tooltip.custom&&e.removeTooltip()),e.label&&!e.label.alwaysVisible&&(e.label.visible=!1)),e.dispatchEvent({type:"ObjectMouseOut",detail:e})),e.tooltip&&(e.tooltip.visible=t||e.selected),x=t}}),e.box3=function(){let t;if(e.updateMatrix(),e.updateMatrixWorld(!0,!0),e.model){let n=e.clone(!0),r=e.model.clone();if(t=(new i.Box3).setFromObject(r),e.parent){let o=new i.Matrix4,s=new i.Matrix4;e.matrix.extractRotation(o),s.copy(o).invert(),n.setRotationFromMatrix(s),t=(new i.Box3).setFromObject(r)}}return t},e.modelBox=function(){return e.box3()},e.getSize=function(){return e.box3().getSize(new i.Vector3(0,0,0))};let b=!1;Object.defineProperty(e,"modelSize",{get:()=>(b=e.getSize(),b),set(e){b!=e&&(b=e)}}),Object.defineProperty(e,"modelHeight",{get(){let t=e.coordinates[2]||0;return"scene"===e.userData.units&&(t*=e.unitsPerMeter/e.scale.x),t}}),Object.defineProperty(e,"unitsPerMeter",{get:()=>Number(r.projectedUnitsPerMeter(e.coordinates[1]).toFixed(7))}),Object.defineProperty(e,"fixedZoom",{get:()=>e.userData.fixedZoom,set(t){e.userData.fixedZoom!==t&&(e.userData.fixedZoom=t,e.userData.units=t?"scene":"meters")}}),e.setFixedZoom=function(t){if(null!=e.fixedZoom&&0!=e.fixedZoom){t||(t=e.userData.mapScale);let r=(n=e.fixedZoom,Math.pow(2,n));if(r>t){let n=r/t;e.scale.set(n,n,n)}else e.scale.set(1,1,1)}var n},e.setScale=function(t){if("scene"!=e.userData.units){let t=e.unitsPerMeter;e.scale.set(t,t,t)}else e.fixedZoom?(t&&(e.userData.mapScale=t),e.setFixedZoom(e.userData.mapScale)):e.scale.set(1,1,1)},e.setObjectScale=function(t){e.setScale(t),e.setBoundingBoxShadowFloor(),e.setReceiveShadowFloor()}}e.add=function(t){return e.scaleGroup.add(t),t.position.z=e.coordinates[2]?-e.coordinates[2]:0,t},e.remove=function(t){t&&(t.traverse((e=>{if(e.geometry&&e.geometry.dispose(),e.material)if(e.material.isMaterial)d(e.material);else for(const t of e.material)d(t);e.dispose&&e.dispose()})),e.scaleGroup.remove(t),tb.map.repaint=!0)},e.duplicate=function(t){let i=e.clone(!0);if(i.getObjectByName("model").animations=e.animations,i.userData.feature&&(t&&t.feature&&(i.userData.feature=t.feature),i.userData.feature.properties.uuid=i.uuid),n._addMethods(i),!t||r.equal(t.scale,e.userData.scale))return i.copyAnchor(e),i;{i.userData=t,i.userData.isGeoGroup=!0,i.remove(i.boxGroup);const e=r.types.rotation(t.rotation,[0,0,0]),n=r.types.scale(t.scale,[1,1,1]);return i.model.position.set(0,0,0),i.model.rotation.set(e[0],e[1],e[2]),i.model.scale.set(n[0],n[1],n[2]),i.setAnchor(t.anchor),i.setCenter(t.adjustment),i}},e.copyAnchor=function(t){e.anchor=t.anchor,e.none={x:0,y:0,z:0},e.center=t.center,e.bottom=t.bottom,e.bottomLeft=t.bottomLeft,e.bottomRight=t.bottomRight,e.top=t.top,e.topLeft=t.topLeft,e.topRight=t.topRight,e.left=t.left,e.right=t.right},e.dispose=function(){l.prototype.unenroll(e),e.traverse((e=>{if((!e.parent||"world"!=e.parent.name)&&"threeboxObject"!==e.name){if(e.geometry&&e.geometry.dispose(),e.material)if(e.material.isMaterial)d(e.material);else for(const t of e.material)d(t);e.dispose&&e.dispose()}})),e.children=[]};const d=e=>{e.dispose();for(const t of Object.keys(e)){const n=e[t];n&&"object"==typeof n&&"minFilter"in n&&n.dispose()}let t=e;(t.map||t.alphaMap||t.aoMap||t.bumpMap||t.displacementMap||t.emissiveMap||t.envMap||t.lightMap||t.metalnessMap||t.normalMap||t.roughnessMap)&&(t.map&&t.map.dispose(),t.alphaMap&&t.alphaMap.dispose(),t.aoMap&&t.aoMap.dispose(),t.bumpMap&&t.bumpMap.dispose(),t.displacementMap&&t.displacementMap.dispose(),t.emissiveMap&&t.emissiveMap.dispose(),t.envMap&&t.envMap.dispose(),t.lightMap&&t.lightMap.dispose(),t.metalnessMap&&t.metalnessMap.dispose(),t.normalMap&&t.normalMap.dispose(),t.roughnessMap&&t.roughnessMap.dispose())};return e},_makeGroup:function(e,t){let n=new i.Group;n.name="scaleGroup",n.add(e);var r=new i.Group;if(r.userData=t||{},r.userData.isGeoGroup=!0,r.userData.feature&&(r.userData.feature.properties.uuid=r.uuid),n.length)for(o of n)r.add(o);else r.add(n);return r.name="threeboxObject",r},animationManager:new s,drawTooltip:function(e){if(e){let t;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){let n=document.createElement("div");n.className="mapboxgl-popup-content";let r=document.createElement("strong");r.innerHTML=e,n.appendChild(r);let i=document.createElement("div");i.className="mapboxgl-popup-tip";let o=document.createElement("div");o.className="marker mapboxgl-popup-anchor-bottom",o.appendChild(i),o.appendChild(n),t=document.createElement("div"),t.className+="label3D",t.appendChild(o)}else t=document.createElement("span"),t.className=this._defaults.tooltip.cssClass,t.innerHTML=e;return t}},drawLabelHTML:function(e,t){let n=document.createElement("div");return n.className+=t,n.innerHTML="string"==typeof e?e:e.outerHTML,n},_defaults:{colors:{red:new i.Color(16711680),yellow:new i.Color(16776960),green:new i.Color(65280),black:new i.Color(0)},materials:{boxNormalMaterial:new i.LineBasicMaterial({color:new i.Color(16711680)}),boxOverMaterial:new i.LineBasicMaterial({color:new i.Color(16776960)}),boxSelectedMaterial:new i.LineBasicMaterial({color:new i.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0,clone:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:new i.MeshPhongMaterial({color:6684672,side:i.DoubleSide}),scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},e.exports=l},9849:(e,t,n)=>{const r=n(4132),i=n(6475),o=n(61),s=n(3019),a=n(7089);e.exports=function(e){e=r._validate(e,s.prototype._defaults.sphere);let t=new o.SphereBufferGeometry(e.radius,e.sides,e.sides),n=i(e),l=new o.Mesh(t,n);return new a({obj:l,units:e.units,anchor:e.anchor,adjustment:e.adjustment,bbox:e.bbox,tooltip:e.tooltip,raycasted:e.raycasted})}},6148:(e,t,n)=>{const r=n(4132),i=n(3019),o=n(7145);n(61),e.exports=function(e){if((e=r._validate(e,i.prototype._defaults.tooltip)).text){let n=i.prototype.drawTooltip(e.text,e.mapboxStyle),r=new o.CSS2DObject(n);r.visible=!1,r.name="tooltip";var t=i.prototype._makeGroup(r,e);return i.prototype._addMethods(t),t}}},8818:(e,t,n)=>{const r=n(4132),i=n(6475),o=n(3019),s=n(61),a=n(7089);e.exports=function(e,t){e=r._validate(e,o.prototype._defaults.tube);let n=[];e.geometry.forEach((e=>{n.push(new s.Vector3(e[0],e[1],e[2]))}));const l=new s.CatmullRomCurve3(n);let c=new s.TubeGeometry(l,n.length,e.radius,e.sides,!1),u=i(e),h=new s.Mesh(c,u);return new a({obj:h,units:e.units,anchor:e.anchor,adjustment:e.adjustment,bbox:e.bbox,tooltip:e.tooltip,raycasted:e.raycasted})}},61:function(e,t){!function(e){"use strict";const t="132",n=100,r=300,i=301,o=302,s=303,a=304,l=306,c=307,u=1e3,h=1001,d=1002,p=1003,f=1004,m=1005,g=1006,y=1007,v=1008,_=1009,x=1012,b=1014,w=1015,S=1016,M=1020,E=1022,T=1023,C=1026,A=1027,I=33776,P=33777,R=33778,L=33779,D=35840,O=35841,N=35842,k=35843,F=37492,z=37496,B=2300,U=2301,j=2302,V=2400,G=2401,H=2402,Z=2501,W=3e3,$=3001,q=3007,X=3002,Y=3004,K=3005,J=3006,Q=7680,ee=35044,te=35048,ne="300 es";class re{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const ie=[];for(let e=0;e<256;e++)ie[e]=(e<16?"0":"")+e.toString(16);let oe=1234567;const se=Math.PI/180,ae=180/Math.PI;function le(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ie[255&e]+ie[e>>8&255]+ie[e>>16&255]+ie[e>>24&255]+"-"+ie[255&t]+ie[t>>8&255]+"-"+ie[t>>16&15|64]+ie[t>>24&255]+"-"+ie[63&n|128]+ie[n>>8&255]+"-"+ie[n>>16&255]+ie[n>>24&255]+ie[255&r]+ie[r>>8&255]+ie[r>>16&255]+ie[r>>24&255]).toUpperCase()}function ce(e,t,n){return Math.max(t,Math.min(n,e))}function ue(e,t){return(e%t+t)%t}function he(e,t,n){return(1-n)*e+n*t}function de(e){return 0==(e&e-1)&&0!==e}function pe(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function fe(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var me=Object.freeze({__proto__:null,DEG2RAD:se,RAD2DEG:ae,generateUUID:le,clamp:ce,euclideanModulo:ue,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:he,damp:function(e,t,n,r){return he(e,t,1-Math.exp(-n*r))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(ue(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(oe=e%2147483647),oe=16807*oe%2147483647,(oe-1)/2147483646},degToRad:function(e){return e*se},radToDeg:function(e){return e*ae},isPowerOfTwo:de,ceilPowerOfTwo:pe,floorPowerOfTwo:fe,setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),l=s(n/2),c=o((t+r)/2),u=s((t+r)/2),h=o((t-r)/2),d=s((t-r)/2),p=o((r-t)/2),f=s((r-t)/2);switch(i){case"XYX":e.set(a*u,l*h,l*d,a*c);break;case"YZY":e.set(l*d,a*u,l*h,a*c);break;case"ZXZ":e.set(l*h,l*d,a*u,a*c);break;case"XZX":e.set(a*u,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*u,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class ge{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}ge.prototype.isVector2=!0;class ye{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=o*f+s*y+a*x,i[3]=o*m+s*v+a*b,i[6]=o*g+s*_+a*w,i[1]=l*f+c*y+u*x,i[4]=l*m+c*v+u*b,i[7]=l*g+c*_+u*w,i[2]=h*f+d*y+p*x,i[5]=h*m+d*v+p*b,i[8]=h*g+d*_+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*i*c+n*s*a+r*i*l-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*i,d=l*i-o*a,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(s*n-r*o)*f,e[3]=h*f,e[4]=(c*t-r*a)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-r*l,r*a,-r*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],l=r[4],c=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*l,r[6]=t*s+n*c,r[1]=-n*i+t*a,r[4]=-n*o+t*l,r[7]=-n*s+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}let ve;ye.prototype.isMatrix3=!0;class _e{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ve&&(ve=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ve.width=e.width,ve.height=e.height;const n=ve.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ve}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let xe=0;class be extends re{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1001,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1001,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:3e3;super(),Object.defineProperty(this,"id",{value:xe++}),this.uuid=le(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new ge(0,0),this.repeat=new ge(1,1),this.center=new ge(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ye,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=le()),!t&&void 0===e.images[r.uuid]){let t;if(Array.isArray(r)){t=[];for(let e=0,n=r.length;e<n;e++)r[e].isDataTexture?t.push(we(r[e].image)):t.push(we(r[e]))}else t=we(r);e.images[r.uuid]={uuid:r.uuid,url:t}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==r)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case u:e.x=e.x-Math.floor(e.x);break;case h:e.x=e.x<0?0:1;break;case d:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case u:e.y=e.y-Math.floor(e.y);break;case h:e.y=e.y<0?0:1;break;case d:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function we(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?_e.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}be.DEFAULT_IMAGE=void 0,be.DEFAULT_MAPPING=r,be.prototype.isTexture=!0;class Se{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(c+h)/4,_=(u+f)/4,x=(p+m)/4;return e>a&&e>y?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=_/n):a>y?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=x/r):y<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=x/i),this.set(n,r,i,t),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Se.prototype.isVector4=!0;class Me extends re{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Se(0,0,e,t),this.scissorTest=!1,this.viewport=new Se(0,0,e,t),this.texture=new be(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:g,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Me.prototype.isWebGLRenderTarget=!0;class Ee extends Me{constructor(e,t,n){super(e,t);const r=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=r.clone()}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}Ee.prototype.isWebGLMultipleRenderTargets=!0;class Te extends Me{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Te.prototype.isWebGLMultisampleRenderTarget=!0;class Ce{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+h*i,l=l*e+d*i,c=c*e+p*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(i-l)*e,this._z=(o-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-r)/e,this._x=(i+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ce(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+r*l-i*a,this._y=r*c+o*a+i*s-n*l,this._z=i*c+o*l+n*a-r*s,this._w=o*c-n*s-r*a-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Ce.prototype.isQuaternion=!0;class Ae{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Pe.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Pe.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*n,c=a*n+s*t-i*r,u=a*r+i*n-o*t,h=-i*t-o*n-s*r;return this.x=l*a+h*-i+c*-s-u*-o,this.y=c*a+h*-o+u*-i-l*-s,this.z=u*a+h*-s+l*-o-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ie.copy(this).projectOnVector(e),this.sub(Ie)}reflect(e){return this.sub(Ie.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ce(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Ae.prototype.isVector3=!0;const Ie=new Ae,Pe=new Ce;class Re{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae(-1/0,-1/0,-1/0);this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],u=e[a+2];l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),u=e.getZ(a);l<t&&(t=l),c<n&&(n=c),u<r&&(r=u),l>i&&(i=l),c>o&&(o=c),u>s&&(s=u)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=De.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Oe.copy(t.boundingBox),Oe.applyMatrix4(e.matrixWorld),this.union(Oe));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,De),De.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(je),Ve.subVectors(this.max,je),Ne.subVectors(e.a,je),ke.subVectors(e.b,je),Fe.subVectors(e.c,je),ze.subVectors(ke,Ne),Be.subVectors(Fe,ke),Ue.subVectors(Ne,Fe);let t=[0,-ze.z,ze.y,0,-Be.z,Be.y,0,-Ue.z,Ue.y,ze.z,0,-ze.x,Be.z,0,-Be.x,Ue.z,0,-Ue.x,-ze.y,ze.x,0,-Be.y,Be.x,0,-Ue.y,Ue.x,0];return!!Ze(t,Ne,ke,Fe,Ve)&&(t=[1,0,0,0,1,0,0,0,1],!!Ze(t,Ne,ke,Fe,Ve)&&(Ge.crossVectors(ze,Be),t=[Ge.x,Ge.y,Ge.z],Ze(t,Ne,ke,Fe,Ve)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return De.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(De).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Le[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Le[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Le[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Le[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Le[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Le[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Le[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Le[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Le)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Re.prototype.isBox3=!0;const Le=[new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae],De=new Ae,Oe=new Re,Ne=new Ae,ke=new Ae,Fe=new Ae,ze=new Ae,Be=new Ae,Ue=new Ae,je=new Ae,Ve=new Ae,Ge=new Ae,He=new Ae;function Ze(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){He.fromArray(e,o);const s=i.x*Math.abs(He.x)+i.y*Math.abs(He.y)+i.z*Math.abs(He.z),a=t.dot(He),l=n.dot(He),c=r.dot(He);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const We=new Re,$e=new Ae,qe=new Ae,Xe=new Ae;class Ye{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):We.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Xe.subVectors(e,this.center);const t=Xe.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Xe.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return qe.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint($e.copy(e.center).add(qe)),this.expandByPoint($e.copy(e.center).sub(qe)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ke=new Ae,Je=new Ae,Qe=new Ae,et=new Ae,tt=new Ae,nt=new Ae,rt=new Ae;class it{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ke)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ke.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ke.copy(this.direction).multiplyScalar(t).add(this.origin),Ke.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Je.copy(e).add(t).multiplyScalar(.5),Qe.copy(t).sub(e).normalize(),et.copy(this.origin).sub(Je);const i=.5*e.distanceTo(t),o=-this.direction.dot(Qe),s=et.dot(this.direction),a=-et.dot(Qe),l=et.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=i*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Qe).multiplyScalar(h).add(Je),d}intersectSphere(e,t){Ke.subVectors(e.center,this.origin);const n=Ke.dot(this.direction),r=Ke.dot(Ke)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ke)}intersectTriangle(e,t,n,r,i){tt.subVectors(t,e),nt.subVectors(n,e),rt.crossVectors(tt,nt);let o,s=this.direction.dot(rt);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}et.subVectors(this.origin,e);const a=o*this.direction.dot(nt.crossVectors(et,nt));if(a<0)return null;const l=o*this.direction.dot(tt.cross(et));if(l<0)return null;if(a+l>s)return null;const c=-o*et.dot(rt);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ot{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ot).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/st.setFromMatrixColumn(e,0).length(),i=1/st.setFromMatrixColumn(e,1).length(),o=1/st.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*a,t[2]=i-e*l,t[6]=r+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-o*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*c,t[9]=i-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=a*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=o*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(lt,e,ct)}lookAt(e,t,n){const r=this.elements;return dt.subVectors(e,t),0===dt.lengthSq()&&(dt.z=1),dt.normalize(),ut.crossVectors(n,dt),0===ut.lengthSq()&&(1===Math.abs(n.z)?dt.x+=1e-4:dt.z+=1e-4,dt.normalize(),ut.crossVectors(n,dt)),ut.normalize(),ht.crossVectors(dt,ut),r[0]=ut.x,r[4]=ht.x,r[8]=dt.x,r[1]=ut.y,r[5]=ht.y,r[9]=dt.y,r[2]=ut.z,r[6]=ht.z,r[10]=dt.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],C=r[9],A=r[13],I=r[2],P=r[6],R=r[10],L=r[14],D=r[3],O=r[7],N=r[11],k=r[15];return i[0]=o*b+s*E+a*I+l*D,i[4]=o*w+s*T+a*P+l*O,i[8]=o*S+s*C+a*R+l*N,i[12]=o*M+s*A+a*L+l*k,i[1]=c*b+u*E+h*I+d*D,i[5]=c*w+u*T+h*P+d*O,i[9]=c*S+u*C+h*R+d*N,i[13]=c*M+u*A+h*L+d*k,i[2]=p*b+f*E+m*I+g*D,i[6]=p*w+f*T+m*P+g*O,i[10]=p*S+f*C+m*R+g*N,i[14]=p*M+f*A+m*L+g*k,i[3]=y*b+v*E+_*I+x*D,i[7]=y*w+v*T+_*P+x*O,i[11]=y*S+v*C+_*R+x*N,i[15]=y*M+v*A+_*L+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-r*l*u-i*s*h+n*l*h+r*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+i*o*h-r*o*d+r*l*c-i*a*c)+e[11]*(+t*l*u-t*s*d-i*o*u+n*o*d+i*s*c-n*l*c)+e[15]*(-r*s*c-t*a*u+t*s*h+r*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],y=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,v=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,_=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*y+n*v+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=y*w,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(s*m*i-f*a*i+f*r*l-n*m*l-s*r*g+n*a*g)*w,e[3]=(u*a*i-s*h*i-u*r*l+n*h*l+s*r*d-n*a*d)*w,e[4]=v*w,e[5]=(c*m*i-p*h*i+p*r*d-t*m*d-c*r*g+t*h*g)*w,e[6]=(p*a*i-o*m*i-p*r*l+t*m*l+o*r*g-t*a*g)*w,e[7]=(o*h*i-c*a*i+c*r*l-t*h*l-o*r*d+t*a*d)*w,e[8]=_*w,e[9]=(p*u*i-c*f*i-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(o*f*i-p*s*i+p*n*l-t*f*l-o*n*g+t*s*g)*w,e[11]=(c*s*i-o*u*i-c*n*l+t*u*l+o*n*d-t*s*d)*w,e[12]=x*w,e[13]=(c*f*r-p*u*r+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*s*r-o*f*r-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*r-c*s*r+c*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,c*s+n,c*a-r*o,0,l*a-r*s,c*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,l=i+i,c=o+o,u=s+s,h=i*l,d=i*c,p=i*u,f=o*c,m=o*u,g=s*u,y=a*l,v=a*c,_=a*u,x=n.x,b=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+_)*x,r[2]=(p-v)*x,r[3]=0,r[4]=(d-_)*b,r[5]=(1-(h+g))*b,r[6]=(m+y)*b,r[7]=0,r[8]=(p+v)*w,r[9]=(m-y)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=st.set(r[0],r[1],r[2]).length();const o=st.set(r[4],r[5],r[6]).length(),s=st.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],at.copy(this);const a=1/i,l=1/o,c=1/s;return at.elements[0]*=a,at.elements[1]*=a,at.elements[2]*=a,at.elements[4]*=l,at.elements[5]*=l,at.elements[6]*=l,at.elements[8]*=c,at.elements[9]*=c,at.elements[10]*=c,t.setFromRotationMatrix(at),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(t-e),l=2*i/(n-r),c=(t+e)/(t-e),u=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,o){const s=this.elements,a=1/(t-e),l=1/(n-r),c=1/(o-i),u=(t+e)*a,h=(n+r)*l,d=(o+i)*c;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}ot.prototype.isMatrix4=!0;const st=new Ae,at=new ot,lt=new Ae(0,0,0),ct=new Ae(1,1,1),ut=new Ae,ht=new Ae,dt=new Ae,pt=new ot,ft=new Ce;class mt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mt.DefaultOrder;this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,i=r[0],o=r[4],s=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ce(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ce(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(ce(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-ce(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(ce(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-ce(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return pt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pt,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return ft.setFromEuler(this),this.setFromQuaternion(ft,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Ae(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}mt.prototype.isEuler=!0,mt.DefaultOrder="XYZ",mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class gt{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let yt=0;const vt=new Ae,_t=new Ce,xt=new ot,bt=new Ae,wt=new Ae,St=new Ae,Mt=new Ce,Et=new Ae(1,0,0),Tt=new Ae(0,1,0),Ct=new Ae(0,0,1),At={type:"added"},It={type:"removed"};class Pt extends re{constructor(){super(),Object.defineProperty(this,"id",{value:yt++}),this.uuid=le(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pt.DefaultUp.clone();const e=new Ae,t=new mt,n=new Ce,r=new Ae(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ot},normalMatrix:{value:new ye}}),this.matrix=new ot,this.matrixWorld=new ot,this.matrixAutoUpdate=Pt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new gt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _t.setFromAxisAngle(e,t),this.quaternion.multiply(_t),this}rotateOnWorldAxis(e,t){return _t.setFromAxisAngle(e,t),this.quaternion.premultiply(_t),this}rotateX(e){return this.rotateOnAxis(Et,e)}rotateY(e){return this.rotateOnAxis(Tt,e)}rotateZ(e){return this.rotateOnAxis(Ct,e)}translateOnAxis(e,t){return vt.copy(e).applyQuaternion(this.quaternion),this.position.add(vt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Et,e)}translateY(e){return this.translateOnAxis(Tt,e)}translateZ(e){return this.translateOnAxis(Ct,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(xt.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?bt.copy(e):bt.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),wt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xt.lookAt(wt,bt,this.up):xt.lookAt(bt,wt,this.up),this.quaternion.setFromRotationMatrix(xt),r&&(xt.extractRotation(r.matrixWorld),_t.setFromRotationMatrix(xt),this.quaternion.premultiply(_t.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(At)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(It)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(It)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),xt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),xt.multiply(e.parent.matrixWorld)),e.applyMatrix4(xt),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wt,e,St),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wt,Mt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Pt.DefaultUp=new Ae(0,1,0),Pt.DefaultMatrixAutoUpdate=!0,Pt.prototype.isObject3D=!0;const Rt=new Ae,Lt=new Ae,Dt=new Ae,Ot=new Ae,Nt=new Ae,kt=new Ae,Ft=new Ae,zt=new Ae,Bt=new Ae,Ut=new Ae;class jt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ae;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Rt.subVectors(e,t),r.cross(Rt);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Rt.subVectors(r,t),Lt.subVectors(n,t),Dt.subVectors(e,t);const o=Rt.dot(Rt),s=Rt.dot(Lt),a=Rt.dot(Dt),l=Lt.dot(Lt),c=Lt.dot(Dt),u=o*l-s*s;if(0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Ot),Ot.x>=0&&Ot.y>=0&&Ot.x+Ot.y<=1}static getUV(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,Ot),a.set(0,0),a.addScaledVector(i,Ot.x),a.addScaledVector(o,Ot.y),a.addScaledVector(s,Ot.z),a}static isFrontFacing(e,t,n,r){return Rt.subVectors(n,t),Lt.subVectors(e,t),Rt.cross(Lt).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Rt.subVectors(this.c,this.b),Lt.subVectors(this.a,this.b),.5*Rt.cross(Lt).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return jt.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return jt.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return jt.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return jt.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return jt.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,s;Nt.subVectors(r,n),kt.subVectors(i,n),zt.subVectors(e,n);const a=Nt.dot(zt),l=kt.dot(zt);if(a<=0&&l<=0)return t.copy(n);Bt.subVectors(e,r);const c=Nt.dot(Bt),u=kt.dot(Bt);if(c>=0&&u<=c)return t.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(Nt,o);Ut.subVectors(e,i);const d=Nt.dot(Ut),p=kt.dot(Ut);if(p>=0&&d<=p)return t.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(kt,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Ft.subVectors(i,r),s=(u-c)/(u-c+(d-p)),t.copy(r).addScaledVector(Ft,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(Nt,o).addScaledVector(kt,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Vt=0;class Gt extends re{constructor(){super(),Object.defineProperty(this,"id",{value:Vt++}),this.uuid=le(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=T,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Q,this.stencilZFail=Q,this.stencilZPass=Q,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==T&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Gt.prototype.isMaterial=!0;const Ht={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zt={h:0,s:0,l:0},Wt={h:0,s:0,l:0};function $t(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function qt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Xt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Yt{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=ue(e,1),t=ce(t,0,1),n=ce(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=$t(i,r,e+1/3),this.g=$t(i,r,e),this.b=$t(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ht[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=qt(e.r),this.g=qt(e.g),this.b=qt(e.b),this}copyLinearToSRGB(e){return this.r=Xt(e.r),this.g=Xt(e.g),this.b=Xt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let s,a;const l=(o+i)/2;if(o===i)s=0,a=0;else{const e=i-o;switch(a=l<=.5?e/(i+o):e/(2-i-o),i){case t:s=(n-r)/e+(n<r?6:0);break;case n:s=(r-t)/e+2;break;case r:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Zt),Zt.h+=e,Zt.s+=t,Zt.l+=n,this.setHSL(Zt.h,Zt.s,Zt.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Zt),e.getHSL(Wt);const n=he(Zt.h,Wt.h,t),r=he(Zt.s,Wt.s,t),i=he(Zt.l,Wt.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Yt.NAMES=Ht,Yt.prototype.isColor=!0,Yt.prototype.r=1,Yt.prototype.g=1,Yt.prototype.b=1;class Kt extends Gt{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Kt.prototype.isMeshBasicMaterial=!0;const Jt=new Ae,Qt=new ge;class en{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=ee,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Yt),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new ge),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Ae),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Se),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Qt.fromBufferAttribute(this,t),Qt.applyMatrix3(e),this.setXY(t,Qt.x,Qt.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Jt.fromBufferAttribute(this,t),Jt.applyMatrix3(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.applyMatrix4(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.applyNormalMatrix(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.transformDirection(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ee&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}en.prototype.isBufferAttribute=!0;class tn extends en{constructor(e,t,n){super(new Int8Array(e),t,n)}}class nn extends en{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class rn extends en{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class on extends en{constructor(e,t,n){super(new Int16Array(e),t,n)}}class sn extends en{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class an extends en{constructor(e,t,n){super(new Int32Array(e),t,n)}}class ln extends en{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class cn extends en{constructor(e,t,n){super(new Uint16Array(e),t,n)}}cn.prototype.isFloat16BufferAttribute=!0;class un extends en{constructor(e,t,n){super(new Float32Array(e),t,n)}}class hn extends en{constructor(e,t,n){super(new Float64Array(e),t,n)}}function dn(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}const pn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fn(e,t){return new pn[e](t)}let mn=0;const gn=new ot,yn=new Pt,vn=new Ae,_n=new Re,xn=new Re,bn=new Ae;class wn extends re{constructor(){super(),Object.defineProperty(this,"id",{value:mn++}),this.uuid=le(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(dn(e)>65535?ln:sn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new ye).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return gn.makeRotationFromQuaternion(e),this.applyMatrix4(gn),this}rotateX(e){return gn.makeRotationX(e),this.applyMatrix4(gn),this}rotateY(e){return gn.makeRotationY(e),this.applyMatrix4(gn),this}rotateZ(e){return gn.makeRotationZ(e),this.applyMatrix4(gn),this}translate(e,t,n){return gn.makeTranslation(e,t,n),this.applyMatrix4(gn),this}scale(e,t,n){return gn.makeScale(e,t,n),this.applyMatrix4(gn),this}lookAt(e){return yn.lookAt(e),yn.updateMatrix(),this.applyMatrix4(yn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vn).negate(),this.translate(vn.x,vn.y,vn.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new un(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Re);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ae(-1/0,-1/0,-1/0),new Ae(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];_n.setFromBufferAttribute(n),this.morphTargetsRelative?(bn.addVectors(this.boundingBox.min,_n.min),this.boundingBox.expandByPoint(bn),bn.addVectors(this.boundingBox.max,_n.max),this.boundingBox.expandByPoint(bn)):(this.boundingBox.expandByPoint(_n.min),this.boundingBox.expandByPoint(_n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ye);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ae,1/0);if(e){const n=this.boundingSphere.center;if(_n.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];xn.setFromBufferAttribute(n),this.morphTargetsRelative?(bn.addVectors(_n.min,xn.min),_n.expandByPoint(bn),bn.addVectors(_n.max,xn.max),_n.expandByPoint(bn)):(_n.expandByPoint(xn.min),_n.expandByPoint(xn.max))}_n.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)bn.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(bn));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)bn.fromBufferAttribute(o,t),s&&(vn.fromBufferAttribute(e,t),bn.add(vn)),r=Math.max(r,n.distanceToSquared(bn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,s=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new en(new Float32Array(4*s),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new Ae,c[e]=new Ae;const u=new Ae,h=new Ae,d=new Ae,p=new ge,f=new ge,m=new ge,g=new Ae,y=new Ae;function v(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),y.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(y),c[t].add(y),c[n].add(y))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)v(n[e+0],n[e+1],n[e+2])}const x=new Ae,b=new Ae,w=new Ae,S=new Ae;function M(e){w.fromArray(i,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(S,t);const n=b.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=n}for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)M(n[e+0]),M(n[e+1]),M(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new en(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Ae,i=new Ae,o=new Ae,s=new Ae,a=new Ae,l=new Ae,c=new Ae,u=new Ae;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,l=Math.min(s.length,i.length-a);for(let e=0,t=a;e<l;e++,t++)i[t]=s[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)bn.fromBufferAttribute(e,t),bn.normalize(),e.setXYZ(t,bn.x,bn.y,bn.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let i=0,l=t.length;i<l;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new en(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new wn,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new wn).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}wn.prototype.isBufferGeometry=!0;const Sn=new ot,Mn=new it,En=new Ye,Tn=new Ae,Cn=new Ae,An=new Ae,In=new Ae,Pn=new Ae,Rn=new Ae,Ln=new Ae,Dn=new Ae,On=new Ae,Nn=new ge,kn=new ge,Fn=new ge,zn=new Ae,Bn=new Ae;class Un extends Pt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kt;super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),En.copy(n.boundingSphere),En.applyMatrix4(i),!1===e.ray.intersectsSphere(En))return;if(Sn.copy(i).invert(),Mn.copy(e.ray).applyMatrix4(Sn),null!==n.boundingBox&&!1===Mn.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,u=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=r[p.materialIndex];for(let n=Math.max(p.start,d.start),r=Math.min(p.start+p.count,d.start+d.count);n<r;n+=3){const r=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=jn(this,f,e,Mn,s,a,l,c,u,r,h,d),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else for(let n=Math.max(0,d.start),h=Math.min(i.count,d.start+d.count);n<h;n+=3){const h=i.getX(n),d=i.getX(n+1),p=i.getX(n+2);o=jn(this,r,e,Mn,s,a,l,c,u,h,d,p),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=h.length;n<i;n++){const i=h[n],p=r[i.materialIndex];for(let n=Math.max(i.start,d.start),r=Math.min(i.start+i.count,d.start+d.count);n<r;n+=3)o=jn(this,p,e,Mn,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}else for(let n=Math.max(0,d.start),i=Math.min(s.count,d.start+d.count);n<i;n+=3)o=jn(this,r,e,Mn,s,a,l,c,u,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function jn(e,t,n,r,i,o,s,a,l,c,u,h){Tn.fromBufferAttribute(i,c),Cn.fromBufferAttribute(i,u),An.fromBufferAttribute(i,h);const d=e.morphTargetInfluences;if(o&&d){Ln.set(0,0,0),Dn.set(0,0,0),On.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=d[e],n=o[e];0!==t&&(In.fromBufferAttribute(n,c),Pn.fromBufferAttribute(n,u),Rn.fromBufferAttribute(n,h),s?(Ln.addScaledVector(In,t),Dn.addScaledVector(Pn,t),On.addScaledVector(Rn,t)):(Ln.addScaledVector(In.sub(Tn),t),Dn.addScaledVector(Pn.sub(Cn),t),On.addScaledVector(Rn.sub(An),t)))}Tn.add(Ln),Cn.add(Dn),An.add(On)}e.isSkinnedMesh&&(e.boneTransform(c,Tn),e.boneTransform(u,Cn),e.boneTransform(h,An));const p=function(e,t,n,r,i,o,s,a){let l;if(l=1===t.side?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,2!==t.side,a),null===l)return null;Bn.copy(a),Bn.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Bn);return c<n.near||c>n.far?null:{distance:c,point:Bn.clone(),object:e}}(e,t,n,r,Tn,Cn,An,zn);if(p){a&&(Nn.fromBufferAttribute(a,c),kn.fromBufferAttribute(a,u),Fn.fromBufferAttribute(a,h),p.uv=jt.getUV(zn,Tn,Cn,An,Nn,kn,Fn,new ge)),l&&(Nn.fromBufferAttribute(l,c),kn.fromBufferAttribute(l,u),Fn.fromBufferAttribute(l,h),p.uv2=jt.getUV(zn,Tn,Cn,An,Nn,kn,Fn,new ge));const e={a:c,b:u,c:h,normal:new Ae,materialIndex:0};jt.getNormal(Tn,Cn,An,e.normal),p.face=e}return p}Un.prototype.isMesh=!0;class Vn extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,y){const v=o/m,_=p/g,x=o/2,b=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const C=new Ae;for(let o=0;o<M;o++){const s=o*_-b;for(let a=0;a<S;a++){const h=a*v-x;C[e]=h*r,C[t]=s*i,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(a/m),u.push(1-o/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,r=h+t+S*(e+1),i=h+(t+1)+S*(e+1),o=h+(t+1)+S*e;a.push(n,r,o),a.push(r,i,o),T+=6}s.addGroup(d,T,y),d+=T,h+=E}p("z","y","x",-1,-1,n,t,e,o,i,0),p("z","y","x",1,-1,n,t,-e,o,i,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new un(l,3)),this.setAttribute("normal",new un(c,3)),this.setAttribute("uv",new un(u,2))}static fromJSON(e){return new Vn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Gn(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Hn(e){const t={};for(let n=0;n<e.length;n++){const r=Gn(e[n]);for(const e in r)t[e]=r[e]}return t}const Zn={clone:Gn,merge:Hn};class Wn extends Gt{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Gn(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Wn.prototype.isShaderMaterial=!0;class $n extends Pt{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new ot,this.projectionMatrix=new ot,this.projectionMatrixInverse=new ot}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}$n.prototype.isCamera=!0;class qn extends $n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ae*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*se*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ae*Math.atan(Math.tan(.5*se*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*se*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}qn.prototype.isPerspectiveCamera=!0;const Xn=90;class Yn extends Pt{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new qn(Xn,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Ae(1,0,0)),this.add(r);const i=new qn(Xn,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Ae(-1,0,0)),this.add(i);const o=new qn(Xn,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Ae(0,1,0)),this.add(o);const s=new qn(Xn,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new Ae(0,-1,0)),this.add(s);const a=new qn(Xn,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Ae(0,0,1)),this.add(a);const l=new qn(Xn,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Ae(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,s,a,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class Kn extends be{constructor(e,t,n,r,o,s,a,l,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:i,n,r,o,s,a=void 0!==a?a:E,l,c,u),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Kn.prototype.isCubeTexture=!0;class Jn extends Me{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Kn(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:g,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=T,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new Vn(5,5,5),s=new Wn({name:"CubemapFromEquirect",uniforms:Gn(n),vertexShader:r,fragmentShader:i,side:1,blending:0});s.uniforms.tEquirect.value=t;const a=new Un(o,s),l=t.minFilter;return t.minFilter===v&&(t.minFilter=g),new Yn(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}Jn.prototype.isWebGLCubeRenderTarget=!0;const Qn=new Ae,er=new Ae,tr=new ye;class nr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Qn.subVectors(n,t).cross(er.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Qn),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||tr.getNormalMatrix(e),r=this.coplanarPoint(Qn).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}nr.prototype.isPlane=!0;const rr=new Ye,ir=new Ae;class or{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new nr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new nr,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new nr,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new nr;this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],y=n[14],v=n[15];return t[0].setComponents(s-r,u-a,f-h,v-m).normalize(),t[1].setComponents(s+r,u+a,f+h,v+m).normalize(),t[2].setComponents(s+i,u+l,f+d,v+g).normalize(),t[3].setComponents(s-i,u-l,f-d,v-g).normalize(),t[4].setComponents(s-o,u-c,f-p,v-y).normalize(),t[5].setComponents(s+o,u+c,f+p,v+y).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),rr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(rr)}intersectsSprite(e){return rr.center.set(0,0,0),rr.radius=.7071067811865476,rr.applyMatrix4(e.matrixWorld),this.intersectsSphere(rr)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(ir.x=r.normal.x>0?e.max.x:e.min.x,ir.y=r.normal.y>0?e.max.y:e.min.y,ir.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(ir)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function sr(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function ar(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,s=e.createBuffer();e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback();let a=5126;return i instanceof Float32Array?a=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:i instanceof Int16Array?a=5122:i instanceof Uint32Array?a=5125:i instanceof Int32Array?a=5124:i instanceof Int8Array?a=5120:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(a=5121),{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){const o=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class lr extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),o=t+1+l*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new un(p,3)),this.setAttribute("normal",new un(f,3)),this.setAttribute("uv",new un(m,2))}static fromJSON(e){return new lr(e.width,e.height,e.widthSegments,e.heightSegments)}}const cr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in GeometricContext geometry ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ur={common:{diffuse:{value:new Yt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ye},uv2Transform:{value:new ye},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ge(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ye}},sprite:{diffuse:{value:new Yt(16777215)},opacity:{value:1},center:{value:new ge(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ye}}},hr={basic:{uniforms:Hn([ur.common,ur.specularmap,ur.envmap,ur.aomap,ur.lightmap,ur.fog]),vertexShader:cr.meshbasic_vert,fragmentShader:cr.meshbasic_frag},lambert:{uniforms:Hn([ur.common,ur.specularmap,ur.envmap,ur.aomap,ur.lightmap,ur.emissivemap,ur.fog,ur.lights,{emissive:{value:new Yt(0)}}]),vertexShader:cr.meshlambert_vert,fragmentShader:cr.meshlambert_frag},phong:{uniforms:Hn([ur.common,ur.specularmap,ur.envmap,ur.aomap,ur.lightmap,ur.emissivemap,ur.bumpmap,ur.normalmap,ur.displacementmap,ur.fog,ur.lights,{emissive:{value:new Yt(0)},specular:{value:new Yt(1118481)},shininess:{value:30}}]),vertexShader:cr.meshphong_vert,fragmentShader:cr.meshphong_frag},standard:{uniforms:Hn([ur.common,ur.envmap,ur.aomap,ur.lightmap,ur.emissivemap,ur.bumpmap,ur.normalmap,ur.displacementmap,ur.roughnessmap,ur.metalnessmap,ur.fog,ur.lights,{emissive:{value:new Yt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cr.meshphysical_vert,fragmentShader:cr.meshphysical_frag},toon:{uniforms:Hn([ur.common,ur.aomap,ur.lightmap,ur.emissivemap,ur.bumpmap,ur.normalmap,ur.displacementmap,ur.gradientmap,ur.fog,ur.lights,{emissive:{value:new Yt(0)}}]),vertexShader:cr.meshtoon_vert,fragmentShader:cr.meshtoon_frag},matcap:{uniforms:Hn([ur.common,ur.bumpmap,ur.normalmap,ur.displacementmap,ur.fog,{matcap:{value:null}}]),vertexShader:cr.meshmatcap_vert,fragmentShader:cr.meshmatcap_frag},points:{uniforms:Hn([ur.points,ur.fog]),vertexShader:cr.points_vert,fragmentShader:cr.points_frag},dashed:{uniforms:Hn([ur.common,ur.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cr.linedashed_vert,fragmentShader:cr.linedashed_frag},depth:{uniforms:Hn([ur.common,ur.displacementmap]),vertexShader:cr.depth_vert,fragmentShader:cr.depth_frag},normal:{uniforms:Hn([ur.common,ur.bumpmap,ur.normalmap,ur.displacementmap,{opacity:{value:1}}]),vertexShader:cr.meshnormal_vert,fragmentShader:cr.meshnormal_frag},sprite:{uniforms:Hn([ur.sprite,ur.fog]),vertexShader:cr.sprite_vert,fragmentShader:cr.sprite_frag},background:{uniforms:{uvTransform:{value:new ye},t2D:{value:null}},vertexShader:cr.background_vert,fragmentShader:cr.background_frag},cube:{uniforms:Hn([ur.envmap,{opacity:{value:1}}]),vertexShader:cr.cube_vert,fragmentShader:cr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cr.equirect_vert,fragmentShader:cr.equirect_frag},distanceRGBA:{uniforms:Hn([ur.common,ur.displacementmap,{referencePosition:{value:new Ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cr.distanceRGBA_vert,fragmentShader:cr.distanceRGBA_frag},shadow:{uniforms:Hn([ur.lights,ur.fog,{color:{value:new Yt(0)},opacity:{value:1}}]),vertexShader:cr.shadow_vert,fragmentShader:cr.shadow_frag}};function dr(e,t,n,r,i){const o=new Yt(0);let s,a,c=0,u=null,h=0,d=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return o},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;o.set(e),c=t,p(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,p(o,c)},render:function(n,i){let f=!1,m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,y=g.getSession&&g.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?p(o,c):m&&m.isColor&&(p(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===l)?(void 0===a&&(a=new Un(new Vn(1,1,1),new Wn({name:"BackgroundCubeMaterial",uniforms:Gn(hr.cube.uniforms),vertexShader:hr.cube.vertexShader,fragmentShader:hr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,u===m&&h===m.version&&d===e.toneMapping||(a.material.needsUpdate=!0,u=m,h=m.version,d=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===s&&(s=new Un(new lr(2,2),new Wn({name:"BackgroundMaterial",uniforms:Gn(hr.background.uniforms),vertexShader:hr.background.vertexShader,fragmentShader:hr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),s.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&h===m.version&&d===e.toneMapping||(s.material.needsUpdate=!0,u=m,h=m.version,d=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function pr(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},l=d(null);let c=l;function u(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,i){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,s,a):e.vertexAttribIPointer(t,n,i,s,a)}function v(){_(),c!==l&&(c=l,u(c.object))}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,v,_){let x=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];return void 0===u&&(u=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[s]=u),u}(v,h,l);c!==t&&(c=t,u(c.object)),x=function(e,t){const n=c.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return c.attributesNum!==i||c.index!==t}(v,_),x&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}c.attributes=n,c.attributesNum=i,c.index=t}(v,_)}else{const e=!0===l.wireframe;c.geometry===v.id&&c.program===h.id&&c.wireframe===e||(c.geometry=v.id,c.program=h.id,c.wireframe=e,x=!0)}!0===i.isInstancedMesh&&(x=!0),null!==_&&n.update(_,34963),x&&(function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const r=c[t];if(r.location>=0){let o=l[t];if(void 0===o&&("instanceMatrix"===t&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const t=o.normalized,s=o.itemSize,l=n.get(o);if(void 0===l)continue;const c=l.buffer,u=l.type,h=l.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,l=n.stride,d=o.offset;if(n&&n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)m(r.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)y(r.location+e,s/r.locationSize,u,t,l*h,(d+s/r.locationSize*e)*h)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)m(r.location+e,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)f(r.location+e);e.bindBuffer(34962,c);for(let e=0;e<r.locationSize;e++)y(r.location+e,s/r.locationSize,u,t,s*h,s/r.locationSize*e*h)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}g()}(i,l,h,v),null!==_&&e.bindBuffer(34963,n.get(_).buffer))},reset:v,resetDefaultState:_,dispose:function(){v();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)h(r[e].object),delete r[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function fr(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,r,s,a),n.update(s,o,a)}}function mr(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=o||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),y=e.getParameter(36349),v=h>0,_=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:_,floatVertexTextures:v&&_,maxSamples:o?e.getParameter(36183):0}}function gr(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new nr,a=new ye,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(e,n,r,i){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==i||null===c){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==r||i;return i=t,n=u(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,s,a){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!i||null===h||0===h.length||o&&!p)o?u(null):c();else{const e=o?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=u(h,s,t,a);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function yr(e){let t=new WeakMap;function n(e,t){return t===s?e.mapping=i:t===a&&(e.mapping=o),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping;if(o===s||o===a){if(t.has(i))return n(t.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const s=e.getRenderTarget(),a=new Jn(o.height/2);return a.fromEquirectangularTexture(e,i),t.set(i,a),e.setRenderTarget(s),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}hr.physical={uniforms:Hn([hr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ge(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new Yt(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ge},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Yt(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Yt(1,1,1)},specularTintMap:{value:null}}]),vertexShader:cr.meshphysical_vert,fragmentShader:cr.meshphysical_frag};class vr extends $n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}vr.prototype.isOrthographicCamera=!0;class _r extends Wn{constructor(e){super(e),this.type="RawShaderMaterial"}}_r.prototype.isRawShaderMaterial=!0;const xr=Math.pow(2,8),br=[.125,.215,.35,.446,.526,.582],wr=5+br.length,Sr={[W]:0,[$]:1,[X]:2,[Y]:3,[K]:4,[J]:5,[q]:6},Mr=new vr,{_lodPlanes:Er,_sizeLods:Tr,_sigmas:Cr}=function(){const e=[],t=[],n=[];let r=8;for(let i=0;i<wr;i++){const o=Math.pow(2,r);t.push(o);let s=1/o;i>4?s=br[i-8+4-1]:0==i&&(s=0),n.push(s);const a=1/(o-1),l=-a/2,c=1+a/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),y=new Float32Array(f*d*h),v=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(r,p*d*e),y.set(u,f*d*e);const i=[e,e,e,e,e,e];v.set(i,m*d*e)}const _=new wn;_.setAttribute("position",new en(g,p)),_.setAttribute("uv",new en(y,f)),_.setAttribute("faceIndex",new en(v,m)),e.push(_),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Ar=new Yt;let Ir=null;const Pr=(1+Math.sqrt(5))/2,Rr=1/Pr,Lr=[new Ae(1,1,1),new Ae(-1,1,1),new Ae(1,1,-1),new Ae(-1,1,-1),new Ae(0,Pr,Rr),new Ae(0,Pr,-Rr),new Ae(Rr,0,Pr),new Ae(-Rr,0,Pr),new Ae(Pr,Rr,0),new Ae(-Pr,Rr,0)];class Dr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),n=new Ae(0,1,0);return new _r({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Sr[3e3]},outputEncoding:{value:Sr[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Ir=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=zr(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Fr(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Er.length;e++)Er[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Ir),e.scissorTest=!1,kr(e,0,0,e.width,e.height)}_fromTexture(e){Ir=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:p,minFilter:p,generateMipmaps:!1,type:_,format:1023,encoding:Or(e)?e.encoding:X,depthBuffer:!1},n=Nr(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Nr(t),n}_compileMaterial(e){const t=new Un(Er[0],e);this._renderer.compile(t,Mr)}_sceneToCubeUV(e,t,n,r){const i=new qn(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,u=a.toneMapping;a.getClearColor(Ar),a.toneMapping=0,a.outputEncoding=W,a.autoClear=!1;const h=new Kt({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new Un(new Vn,h);let p=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,p=!0):(h.color.copy(Ar),p=!0);for(let t=0;t<6;t++){const n=t%3;0==n?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1==n?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t])),kr(r,n*xr,t>2?xr:0,xr,xr),a.setRenderTarget(r),p&&a.render(d,i),a.render(e,i)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=u,a.outputEncoding=c,a.autoClear=l,e.background=f}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=zr()):null==this._equirectShader&&(this._equirectShader=Fr());const r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Un(Er[0],r),o=r.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Sr[e.encoding],o.outputEncoding.value=Sr[t.texture.encoding],kr(t,0,0,3*xr,2*xr),n.setRenderTarget(t),n.render(i,Mr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<wr;t++){const n=Math.sqrt(Cr[t]*Cr[t]-Cr[t-1]*Cr[t-1]),r=Lr[(t-1)%Lr.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Un(Er[r],l),u=l.uniforms,h=Tr[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s),u.dTheta.value=d,u.mipInt.value=8-n,u.inputEncoding.value=Sr[e.texture.encoding],u.outputEncoding.value=Sr[e.texture.encoding];const y=Tr[r];kr(t,3*Math.max(0,xr-2*y),(0===r?0:2*xr)+2*y*(r>4?r-8+4:0),3*y,2*y),a.setRenderTarget(t),a.render(c,Mr)}}function Or(e){return void 0!==e&&e.type===_&&(e.encoding===W||e.encoding===$||e.encoding===q)}function Nr(e){const t=new Me(3*xr,3*xr,e);return t.texture.mapping=l,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function kr(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Fr(){const e=new ge(1,1);return new _r({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Sr[3e3]},outputEncoding:{value:Sr[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function zr(){return new _r({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Sr[3e3]},outputEncoding:{value:Sr[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Br(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(l){if(l&&l.isTexture&&!1===l.isRenderTargetTexture){const c=l.mapping,u=c===s||c===a,h=c===i||c===o;if(u||h){if(t.has(l))return t.get(l).texture;{const i=l.image;if(u&&i&&i.height>0||h&&i&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(i)){const i=e.getRenderTarget();null===n&&(n=new Dr(e));const o=u?n.fromEquirectangular(l):n.fromCubemap(l);return t.set(l,o),e.setRenderTarget(i),l.addEventListener("dispose",r),o.texture}return null}}}return l},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ur(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function jr(e,t,n,r){const i={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",s),delete i[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(dn(n)>65535?ln:sn)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Vr(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,s,r*a,c),n.update(l,o,c)}}function Gr(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Hr(e,t){return e[0]-t[0]}function Zr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Wr(e){const t={},n=new Float32Array(8),r=[];for(let e=0;e<8;e++)r[e]=[e,0];return{update:function(i,o,s,a){const l=i.morphTargetInfluences,c=void 0===l?0:l.length;let u=t[o.id];if(void 0===u||u.length!==c){u=[];for(let e=0;e<c;e++)u[e]=[e,0];t[o.id]=u}for(let e=0;e<c;e++){const t=u[e];t[0]=e,t[1]=l[e]}u.sort(Zr);for(let e=0;e<8;e++)e<c&&u[e][1]?(r[e][0]=u[e][0],r[e][1]=u[e][1]):(r[e][0]=Number.MAX_SAFE_INTEGER,r[e][1]=0);r.sort(Hr);const h=o.morphAttributes.position,d=o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=r[e],i=t[0],s=t[1];i!==Number.MAX_SAFE_INTEGER&&s?(h&&o.getAttribute("morphTarget"+e)!==h[i]&&o.setAttribute("morphTarget"+e,h[i]),d&&o.getAttribute("morphNormal"+e)!==d[i]&&o.setAttribute("morphNormal"+e,d[i]),n[e]=s,p+=s):(h&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),d&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),n[e]=0)}const f=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function $r(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=r.render.frame,a=e.geometry,l=t.get(e,a);return i.get(l)!==s&&(t.update(l),i.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}class qr extends be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=p,this.minFilter=p,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}qr.prototype.isDataTexture2DArray=!0;class Xr extends be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=p,this.minFilter=p,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Xr.prototype.isDataTexture3D=!0;const Yr=new be,Kr=new qr,Jr=new Xr,Qr=new Kn,ei=[],ti=[],ni=new Float32Array(16),ri=new Float32Array(9),ii=new Float32Array(4);function oi(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=ei[i];if(void 0===o&&(o=new Float32Array(i),ei[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function si(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ai(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function li(e,t){let n=ti[t];void 0===n&&(n=new Int32Array(t),ti[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function ci(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ui(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(si(n,t))return;e.uniform2fv(this.addr,t),ai(n,t)}}function hi(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(si(n,t))return;e.uniform3fv(this.addr,t),ai(n,t)}}function di(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(si(n,t))return;e.uniform4fv(this.addr,t),ai(n,t)}}function pi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(si(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ai(n,t)}else{if(si(n,r))return;ii.set(r),e.uniformMatrix2fv(this.addr,!1,ii),ai(n,r)}}function fi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(si(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ai(n,t)}else{if(si(n,r))return;ri.set(r),e.uniformMatrix3fv(this.addr,!1,ri),ai(n,r)}}function mi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(si(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ai(n,t)}else{if(si(n,r))return;ni.set(r),e.uniformMatrix4fv(this.addr,!1,ni),ai(n,r)}}function gi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function yi(e,t){const n=this.cache;si(n,t)||(e.uniform2iv(this.addr,t),ai(n,t))}function vi(e,t){const n=this.cache;si(n,t)||(e.uniform3iv(this.addr,t),ai(n,t))}function _i(e,t){const n=this.cache;si(n,t)||(e.uniform4iv(this.addr,t),ai(n,t))}function xi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function bi(e,t){const n=this.cache;si(n,t)||(e.uniform2uiv(this.addr,t),ai(n,t))}function wi(e,t){const n=this.cache;si(n,t)||(e.uniform3uiv(this.addr,t),ai(n,t))}function Si(e,t){const n=this.cache;si(n,t)||(e.uniform4uiv(this.addr,t),ai(n,t))}function Mi(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Yr,i)}function Ei(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Jr,i)}function Ti(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Qr,i)}function Ci(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Kr,i)}function Ai(e,t){e.uniform1fv(this.addr,t)}function Ii(e,t){const n=oi(t,this.size,2);e.uniform2fv(this.addr,n)}function Pi(e,t){const n=oi(t,this.size,3);e.uniform3fv(this.addr,n)}function Ri(e,t){const n=oi(t,this.size,4);e.uniform4fv(this.addr,n)}function Li(e,t){const n=oi(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Di(e,t){const n=oi(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Oi(e,t){const n=oi(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ni(e,t){e.uniform1iv(this.addr,t)}function ki(e,t){e.uniform2iv(this.addr,t)}function Fi(e,t){e.uniform3iv(this.addr,t)}function zi(e,t){e.uniform4iv(this.addr,t)}function Bi(e,t){e.uniform1uiv(this.addr,t)}function Ui(e,t){e.uniform2uiv(this.addr,t)}function ji(e,t){e.uniform3uiv(this.addr,t)}function Vi(e,t){e.uniform4uiv(this.addr,t)}function Gi(e,t,n){const r=t.length,i=li(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||Yr,i[e])}function Hi(e,t,n){const r=t.length,i=li(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||Qr,i[e])}function Zi(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ci;case 35664:return ui;case 35665:return hi;case 35666:return di;case 35674:return pi;case 35675:return fi;case 35676:return mi;case 5124:case 35670:return gi;case 35667:case 35671:return yi;case 35668:case 35672:return vi;case 35669:case 35673:return _i;case 5125:return xi;case 36294:return bi;case 36295:return wi;case 36296:return Si;case 35678:case 36198:case 36298:case 36306:case 35682:return Mi;case 35679:case 36299:case 36307:return Ei;case 35680:case 36300:case 36308:case 36293:return Ti;case 36289:case 36303:case 36311:case 36292:return Ci}}(t.type)}function Wi(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ai;case 35664:return Ii;case 35665:return Pi;case 35666:return Ri;case 35674:return Li;case 35675:return Di;case 35676:return Oi;case 5124:case 35670:return Ni;case 35667:case 35671:return ki;case 35668:case 35672:return Fi;case 35669:case 35673:return zi;case 5125:return Bi;case 36294:return Ui;case 36295:return ji;case 36296:return Vi;case 35678:case 36198:case 36298:case 36306:case 35682:return Gi;case 35680:case 36300:case 36308:case 36293:return Hi}}(t.type)}function $i(e){this.id=e,this.seq=[],this.map={}}Wi.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ai(t,e)},$i.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const qi=/(\w+)(\])?(\[|\.)?/g;function Xi(e,t){e.seq.push(t),e.map[t.id]=t}function Yi(e,t,n){const r=e.name,i=r.length;for(qi.lastIndex=0;;){const o=qi.exec(r),s=qi.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===i){Xi(n,void 0===c?new Zi(a,e,t):new Wi(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new $i(a),Xi(n,e)),n=e}}}function Ki(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Yi(n,e.getUniformLocation(t,n.name),this)}}function Ji(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Ki.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Ki.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},Ki.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},Ki.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let Qi=0;function eo(e){switch(e){case W:return["Linear","( value )"];case $:return["sRGB","( value )"];case X:return["RGBE","( value )"];case Y:return["RGBM","( value, 7.0 )"];case K:return["RGBM","( value, 16.0 )"];case J:return["RGBD","( value, 256.0 )"];case q:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function to(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function no(e,t){const n=eo(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function ro(e,t){const n=eo(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function io(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function oo(e){return""!==e}function so(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ao(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const lo=/^[ \t]*#include +<([\w\d./]+)>/gm;function co(e){return e.replace(lo,uo)}function uo(e,t){const n=cr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return co(n)}const ho=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,po=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function fo(e){return e.replace(po,go).replace(ho,mo)}function mo(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),go(0,t,n,r)}function go(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function yo(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function vo(e,t,n,r){const s=e.getContext(),a=n.defines;let u=n.vertexShader,h=n.fragmentShader;const d=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),p=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case i:case o:t="ENVMAP_TYPE_CUBE";break;case l:case c:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),f=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case o:case c:t="ENVMAP_MODE_REFRACTION"}return t}(n),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),g=e.gammaFactor>0?e.gammaFactor:1,y=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(oo).join("\n")}(n),v=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),_=s.createProgram();let x,b,w=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(x=[v].filter(oo).join("\n"),x.length>0&&(x+="\n"),b=[y,v].filter(oo).join("\n"),b.length>0&&(b+="\n")):(x=[yo(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(oo).join("\n"),b=[y,yo(n),"#define SHADER_NAME "+n.shaderName,v,"#define GAMMA_FACTOR "+g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheenTint?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?cr.tonemapping_pars_fragment:"",0!==n.toneMapping?io("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===E?"#define OPAQUE":"",cr.encodings_pars_fragment,n.map?no("mapTexelToLinear",n.mapEncoding):"",n.matcap?no("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?no("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?no("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularTintMap?no("specularTintMapTexelToLinear",n.specularTintMapEncoding):"",n.lightMap?no("lightMapTexelToLinear",n.lightMapEncoding):"",ro("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(oo).join("\n")),u=co(u),u=so(u,n),u=ao(u,n),h=co(h),h=so(h,n),h=ao(h,n),u=fo(u),h=fo(h),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(w="#version 300 es\n",x=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,b=["#define varying in",n.glslVersion===ne?"":"out highp vec4 pc_fragColor;",n.glslVersion===ne?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const S=w+b+h,M=Ji(s,35633,w+x+u),T=Ji(s,35632,S);if(s.attachShader(_,M),s.attachShader(_,T),void 0!==n.index0AttributeName?s.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(_,0,"position"),s.linkProgram(_),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(_).trim(),t=s.getShaderInfoLog(M).trim(),n=s.getShaderInfoLog(T).trim();let r=!0,i=!0;if(!1===s.getProgramParameter(_,35714)){r=!1;const t=to(s,M,"vertex"),n=to(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(_,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(i=!1);i&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:n,prefix:b}})}let C,A;return s.deleteShader(M),s.deleteShader(T),this.getUniforms=function(){return void 0===C&&(C=new Ki(s,_)),C},this.getAttributes=function(){return void 0===A&&(A=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),o=r.name;let s=1;35674===r.type&&(s=2),35675===r.type&&(s=3),35676===r.type&&(s=4),n[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(s,_)),A},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=Qi++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=M,this.fragmentShader=T,this}function _o(e,t,n,r,i,o,s){const a=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.floatVertexTextures,p=i.maxVertexUniforms,f=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},y=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=W,t}return{getParameters:function(o,a,y,_,x){const b=_.fog,w=o.isMeshStandardMaterial?_.environment:null,S=(o.isMeshStandardMaterial?n:t).get(o.envMap||w),M=g[o.type],E=x.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(d)return 1024;{const e=p,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(x):0;let T,C;if(null!==o.precision&&(m=i.getMaxPrecision(o.precision),m!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",m,"instead.")),M){const e=hr[M];T=e.vertexShader,C=e.fragmentShader}else T=o.vertexShader,C=o.fragmentShader;const A=e.getRenderTarget(),I=o.alphaTest>0,P=o.clearcoat>0;return{isWebGL2:u,shaderID:M,shaderName:o.type,vertexShader:T,fragmentShader:C,defines:o.defines,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:m,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:f,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!o.map,mapEncoding:v(o.map),matcap:!!o.matcap,matcapEncoding:v(o.matcap),envMap:!!S,envMapMode:S&&S.mapping,envMapEncoding:v(S),envMapCubeUV:!!S&&(S.mapping===l||S.mapping===c),lightMap:!!o.lightMap,lightMapEncoding:v(o.lightMap),aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,emissiveMapEncoding:v(o.emissiveMap),bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,clearcoat:P,clearcoatMap:P&&!!o.clearcoatMap,clearcoatRoughnessMap:P&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularTintMap:!!o.specularTintMap,specularTintMapEncoding:v(o.specularTintMap),alphaMap:!!o.alphaMap,alphaTest:I,gradientMap:!!o.gradientMap,sheenTint:!!o.sheenTint&&(o.sheenTint.r>0||o.sheenTint.g>0||o.sheenTint.b>0),transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!x.geometry&&!!x.geometry.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!x.geometry&&!!x.geometry.attributes.color&&4===x.geometry.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularTintMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularTintMap||!o.displacementMap),fog:!!b,useFog:o.fog,fogExp2:b&&b.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===x.isSkinnedMesh&&E>0,maxBones:E,useVertexTexture:d,morphTargets:!!x.geometry&&!!x.geometry.morphAttributes.position,morphNormals:!!x.geometry&&!!x.geometry.morphAttributes.normal,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,format:o.format,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&y.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<y.length;e++)n.push(t[y[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=g[e.type];let n;if(t){const e=hr[t];n=Zn.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new vo(e,n,t,o),a.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function xo(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function bo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function wo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function So(e){const t=[];let n=0;const r=[],i=[],o=[],s={id:-1};function a(r,i,o,a,l,c){let u=t[n];const h=e.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||s,groupOrder:a,renderOrder:r.renderOrder,z:l,group:c},t[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||s,u.groupOrder=a,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transmissive:i,transparent:o,init:function(){n=0,r.length=0,i.length=0,o.length=0},push:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?i.push(u):!0===n.transparent?o.push(u):r.push(u)},unshift:function(e,t,n,s,l,c){const u=a(e,t,n,s,l,c);n.transmission>0?i.unshift(u):!0===n.transparent?o.unshift(u):r.unshift(u)},finish:function(){for(let e=n,r=t.length;e<r;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){r.length>1&&r.sort(e||bo),i.length>1&&i.sort(t||wo),o.length>1&&o.sort(t||wo)}}}function Mo(e){let t=new WeakMap;return{get:function(n,r){let i;return!1===t.has(n)?(i=new So(e),t.set(n,[i])):r>=t.get(n).length?(i=new So(e),t.get(n).push(i)):i=t.get(n)[r],i},dispose:function(){t=new WeakMap}}}function Eo(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Ae,color:new Yt};break;case"SpotLight":n={position:new Ae,direction:new Ae,color:new Yt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ae,color:new Yt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ae,skyColor:new Yt,groundColor:new Yt};break;case"RectAreaLight":n={color:new Yt,position:new Ae,halfWidth:new Ae,halfHeight:new Ae}}return e[t.id]=n,n}}}let To=0;function Co(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ao(e,t){const n=new Eo,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ge};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ge,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new Ae);const o=new Ae,s=new ot,a=new ot;return{setup:function(o,s){let a=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0;o.sort(Co);const v=!0!==s?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.color,_=t.intensity,x=t.distance,b=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=s.r*_*v,l+=s.g*_*v,c+=s.b*_*v;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],_);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=b,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(_*v),e.distance=x,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[d]=n,i.spotShadowMap[d]=b,i.spotShadowMatrix[d]=t.shadow.matrix,y++}i.spot[d]=e,d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(_),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=b,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(_*v),e.groundColor.copy(t.groundColor).multiplyScalar(_*v),i.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=ur.LTC_FLOAT_1,i.rectAreaLTC2=ur.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ur.LTC_HALF_1,i.rectAreaLTC2=ur.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=l,i.ambient[2]=c;const _=i.hash;_.directionalLength===u&&_.pointLength===h&&_.spotLength===d&&_.rectAreaLength===p&&_.hemiLength===f&&_.numDirectionalShadows===m&&_.numPointShadows===g&&_.numSpotShadows===y||(i.directional.length=u,i.spot.length=d,i.rectArea.length=p,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=y,_.directionalLength=u,_.pointLength=h,_.spotLength=d,_.rectAreaLength=p,_.hemiLength=f,_.numDirectionalShadows=m,_.numPointShadows=g,_.numSpotShadows=y,i.version=To++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),u++}}},state:i}}function Io(e,t){const n=new Ao(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Po(e,t){let n=new WeakMap;return{get:function(r){let i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new Io(e,t),n.set(r,[i])):o>=n.get(r).length?(i=new Io(e,t),n.get(r).push(i)):i=n.get(r)[o],i},dispose:function(){n=new WeakMap}}}class Ro extends Gt{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Ro.prototype.isMeshDepthMaterial=!0;class Lo extends Gt{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Ae,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Do(e,t,n){let r=new or;const i=new ge,o=new ge,s=new Se,a=new Ro({depthPacking:3201}),l=new Lo,c={},u=n.maxTextureSize,h={0:1,1:0,2:2},d=new Wn({uniforms:{shadow_pass:{value:null},resolution:{value:new ge},radius:{value:4},samples:{value:8}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new wn;m.setAttribute("position",new en(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Un(m,d),v=this;function _(n,r){const i=t.update(y);d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,d.uniforms.samples.value=n.blurSamples,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,d,y,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,f.uniforms.samples.value=n.blurSamples,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,f,y,null)}function x(t,n,r,i,o,s,u){let d=null;const p=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(d=void 0!==p?p:!0===i.isPointLight?l:a,e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0){const e=d.uuid,t=r.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let i=n[t];void 0===i&&(i=d.clone(),n[t]=i),d=i}return d.visible=r.visible,d.wireframe=r.wireframe,d.side=3===u?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],d.alphaMap=r.alphaMap,d.alphaTest=r.alphaTest,d.clipShadows=r.clipShadows,d.clippingPlanes=r.clippingPlanes,d.clipIntersection=r.clipIntersection,d.displacementMap=r.displacementMap,d.displacementScale=r.displacementScale,d.displacementBias=r.displacementBias,d.wireframeLinewidth=r.wireframeLinewidth,d.linewidth=r.linewidth,!0===i.isPointLight&&!0===d.isMeshDistanceMaterial&&(d.referencePosition.setFromMatrixPosition(i.matrixWorld),d.nearDistance=o,d.farDistance=s),d}function b(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],u=i[c.materialIndex];if(u&&u.visible){const t=x(n,0,u,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,c)}}}else if(i.visible){const t=x(n,0,i,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,a){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const f=h.getFrameExtents();if(i.multiply(f),o.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/f.x),i.x=o.x*f.x,h.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/f.y),i.y=o.y*f.y,h.mapSize.y=o.y)),null===h.map&&!h.isPointLightShadow&&3===this.type){const e={minFilter:g,magFilter:g,format:T};h.map=new Me(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.mapPass=new Me(i.x,i.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:p,magFilter:p,format:T};h.map=new Me(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(c,e),r=h.getFrustum(),b(n,a,h.camera,c,this.type)}h.isPointLightShadow||3!==this.type||_(h,a),h.needsUpdate=!1}v.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function Oo(e,t,r){const i=r.isWebGL2,o=new function(){let t=!1;const n=new Se;let r=null;const i=new Se(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?z(2929):B(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?z(2960):B(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&l===r||(e.stencilOp(t,n,r),s=t,a=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null}}};let l={},c=null,u={},h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,x=!1,b=null,w=null,S=null,M=null,E=null;const T=e.getParameter(35661);let C=!1,A=0;const I=e.getParameter(7938);-1!==I.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(I)[1]),C=A>=1):-1!==I.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),C=A>=2);let P=null,R={};const L=e.getParameter(3088),D=e.getParameter(2978),O=(new Se).fromArray(L),N=(new Se).fromArray(D);function k(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const F={};function z(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function B(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}F[3553]=k(3553,3553,1),F[34067]=k(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),a.setClear(0),z(2929),s.setFunc(3),G(!1),H(1),z(2884),V(0);const U={[n]:32774,101:32778,102:32779};if(i)U[103]=32775,U[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(U[103]=e.MIN_EXT,U[104]=e.MAX_EXT)}const j={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function V(t,r,i,o,s,a,l,c){if(0!==t){if(!1===d&&(z(3042),d=!0),5===t)s=s||r,a=a||i,l=l||o,r===f&&s===y||(e.blendEquationSeparate(U[r],U[s]),f=r,y=s),i===m&&o===g&&a===v&&l===_||(e.blendFuncSeparate(j[i],j[o],j[a],j[l]),m=i,g=o,v=a,_=l),p=t,x=null;else if(t!==p||c!==x){if(f===n&&y===n||(e.blendEquation(32774),f=n,y=n),c)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,g=null,v=null,_=null,p=t,x=c}}else!0===d&&(B(3042),d=!1)}function G(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function H(t){0!==t?(z(2884),t!==w&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):B(2884),w=t}function Z(t,n,r){t?(z(32823),M===n&&E===r||(e.polygonOffset(n,r),M=n,E=r)):B(32823)}function W(t){void 0===t&&(t=33984+T-1),P!==t&&(e.activeTexture(t),P=t)}return{buffers:{color:o,depth:s,stencil:a},enable:z,disable:B,bindFramebuffer:function(t,n){return null===n&&null!==c&&(n=c),u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(36009===t&&(u[36160]=n),36160===t&&(u[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==c&&(e.bindFramebuffer(36160,t),c=t)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:V,setMaterial:function(e,t){2===e.side?B(2884):z(2884);let n=1===e.side;t&&(n=!n),G(n),1===e.blending&&!1===e.transparent?V(0):V(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);const r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(32926):B(32926)},setFlipSided:G,setCullFace:H,setLineWidth:function(t){t!==S&&(C&&e.lineWidth(t),S=t)},setPolygonOffset:Z,setScissorTest:function(e){e?z(3089):B(3089)},activeTexture:W,bindTexture:function(t,n){null===P&&W();let r=R[P];void 0===r&&(r={type:void 0,texture:void 0},R[P]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||F[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=R[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},P=null,R={},c=null,u={},h=null,d=!1,p=null,f=null,m=null,g=null,y=null,v=null,_=null,x=!1,b=null,w=null,S=null,M=null,E=null,O.set(0,0,e.canvas.width,e.canvas.height),N.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),a.reset()}}}function No(e,t,n,r,i,o,s){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,_=i.maxTextureSize,I=i.maxSamples,P=new WeakMap;let R,L=!1;try{L="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function D(e,t){return L?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function O(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?fe:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===R&&(R=D(o,s));const a=n?D(o,s):R;return a.width=o,a.height=s,a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function N(e){return de(e.width)&&de(e.height)}function k(e,t){return e.generateMipmaps&&t&&e.minFilter!==p&&e.minFilter!==g}function F(t,n,i,o){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log2(Math.max(i,o,s))}function z(n,r,i){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function B(e){return e===p||e===f||e===m?9728:9729}function U(t){const n=t.target;n.removeEventListener("dispose",U),function(t){const n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}(n),n.isVideoTexture&&P.delete(n),s.memory.textures--}function j(t){const n=t.target;n.removeEventListener("dispose",j),function(t){const n=t.texture,i=r.get(t),o=r.get(n);if(t){if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),s.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}}(n)}let V=0;function G(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;P.get(e)!==t&&(P.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void X(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function H(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;q(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const s=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),l=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=s||l?l?r.image[e].image:r.image[e]:O(r.image[e],!1,!0,c);const h=u[0],d=N(h)||a,p=o.convert(r.format),f=o.convert(r.type),m=z(r.internalFormat,p,f);let g;if($(34067,r,d),s){for(let e=0;e<6;e++){g=u[e].mipmaps;for(let t=0;t<g.length;t++){const i=g[t];r.format!==T&&r.format!==E?null!==p?n.compressedTexImage2D(34069+e,t,m,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,i.width,i.height,0,p,f,i.data)}}t.__maxMipLevel=g.length-1}else{g=r.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,u[e].width,u[e].height,0,p,f,u[e].data);for(let t=0;t<g.length;t++){const r=g[t].image[e].image;n.texImage2D(34069+e,t+1,m,r.width,r.height,0,p,f,r.data)}}else{n.texImage2D(34069+e,0,m,p,f,u[e]);for(let t=0;t<g.length;t++){const r=g[t];n.texImage2D(34069+e,t+1,m,p,f,r.image[e])}}t.__maxMipLevel=g.length}k(r,d)&&F(34067,r,h.width,h.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(s,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,s.__webglTexture))}const Z={[u]:10497,[h]:33071,[d]:33648},W={[p]:9728,[f]:9984,[m]:9986,[g]:9729,[y]:9985,[v]:9987};function $(n,o,s){if(s?(e.texParameteri(n,10242,Z[o.wrapS]),e.texParameteri(n,10243,Z[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,Z[o.wrapR]),e.texParameteri(n,10240,W[o.magFilter]),e.texParameteri(n,10241,W[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===h&&o.wrapT===h||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,B(o.magFilter)),e.texParameteri(n,10241,B(o.minFilter)),o.minFilter!==p&&o.minFilter!==g&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(o.type===w&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&o.type===S&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function q(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",U),t.__webglTexture=e.createTexture(),s.memory.textures++)}function X(t,r,i){let s=3553;r.isDataTexture2DArray&&(s=35866),r.isDataTexture3D&&(s=32879),q(t,r),n.activeTexture(33984+i),n.bindTexture(s,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==h||e.wrapT!==h||e.minFilter!==p&&e.minFilter!==g)}(r)&&!1===N(r.image),c=O(r.image,l,!1,_),u=N(c)||a,d=o.convert(r.format);let f,m=o.convert(r.type),y=z(r.internalFormat,d,m);$(s,r,u);const v=r.mipmaps;if(r.isDepthTexture)y=6402,a?y=r.type===w?36012:r.type===b?33190:r.type===M?35056:33189:r.type===w&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===C&&6402===y&&r.type!==x&&r.type!==b&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=x,m=o.convert(r.type)),r.format===A&&6402===y&&(y=34041,r.type!==M&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=M,m=o.convert(r.type))),n.texImage2D(3553,0,y,c.width,c.height,0,d,m,null);else if(r.isDataTexture)if(v.length>0&&u){for(let e=0,t=v.length;e<t;e++)f=v[e],n.texImage2D(3553,e,y,f.width,f.height,0,d,m,f.data);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,y,c.width,c.height,0,d,m,c.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(let e=0,t=v.length;e<t;e++)f=v[e],r.format!==T&&r.format!==E?null!==d?n.compressedTexImage2D(3553,e,y,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,y,f.width,f.height,0,d,m,f.data);t.__maxMipLevel=v.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,y,c.width,c.height,c.depth,0,d,m,c.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,y,c.width,c.height,c.depth,0,d,m,c.data),t.__maxMipLevel=0;else if(v.length>0&&u){for(let e=0,t=v.length;e<t;e++)f=v[e],n.texImage2D(3553,e,y,d,m,f);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,y,d,m,c),t.__maxMipLevel=0;k(r,u)&&F(s,r,c.width,c.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function Y(t,i,s,a,l){const c=o.convert(s.format),u=o.convert(s.type),h=z(s.internalFormat,c,u);32879===l||35866===l?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,r.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function K(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===w?i=36012:t.type===b&&(i=33190));const r=J(n);e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const t=J(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(t.format),s=o.convert(t.type),a=z(t.internalFormat,i,s);if(r){const t=J(n);e.renderbufferStorageMultisample(36161,t,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function J(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(I,e.samples):0}let Q=!1,ee=!1;this.allocateTextureUnit=function(){const e=V;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),V+=1,e},this.resetTextureUnits=function(){V=0},this.setTexture2D=G,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?X(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?X(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=H,this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",j),!0!==t.isWebGLMultipleRenderTargets&&(u.__webglTexture=e.createTexture(),u.__version=l.version,s.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=N(t)||a;if(!a||l.format!==E||l.type!==w&&l.type!==S||(l.format=T,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),d)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const r=o.convert(l.format),i=o.convert(l.type),s=z(l.internalFormat,r,i),a=J(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),K(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,u.__webglTexture),$(34067,l,m);for(let e=0;e<6;e++)Y(c.__webglFramebuffer[e],t,l,36064,34069+e);k(l,m)&&F(34067,l,t.width,t.height),n.unbindTexture()}else if(d){const e=t.texture;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=r.get(o);n.bindTexture(3553,s.__webglTexture),$(3553,o,m),Y(c.__webglFramebuffer,t,o,36064+i,3553),k(o,m)&&F(3553,o,t.width,t.height)}n.unbindTexture()}else{let e=3553;f&&(a?e=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(e,u.__webglTexture),$(e,l,m),Y(c.__webglFramebuffer,t,l,36064,e),k(l,m)&&F(e,l,t.width,t.height,t.depth),n.unbindTexture()}t.depthBuffer&&function(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),G(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===C)e.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==A)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),K(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),K(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=N(e)||a,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,s=i.length;o<s;o++){const s=i[o];if(k(s,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,i=r.get(s).__webglTexture;n.bindTexture(t,i),F(t,s,e.width,e.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const i=t.width,o=t.height;let s=16384;t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024);const a=r.get(t);n.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===Q&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Q=!0),e=e.texture),G(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===ee&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ee=!0),e=e.texture),H(e,t)}}function ko(e,t,n){const r=n.isWebGL2;return{convert:function(e){let n;if(e===_)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===x)return 5123;if(1013===e)return 5124;if(e===b)return 5125;if(e===w)return 5126;if(e===S)return r?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(e===E)return 6407;if(e===T)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===C)return 6402;if(e===A)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(e===I||e===P||e===R||e===L){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===I)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===P)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===R)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===L)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===D||e===O||e===N||e===k){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===D)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===O)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===N)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===k)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===F||e===z)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===F)return n.COMPRESSED_RGB8_ETC2;if(e===z)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):36492===e?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===M?r?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}Lo.prototype.isMeshDistanceMaterial=!0;class Fo extends qn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.cameras=e}}Fo.prototype.isArrayCamera=!0;class zo extends Pt{constructor(){super(),this.type="Group"}}zo.prototype.isGroup=!0;const Bo={type:"move"};class Uo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new zo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new zo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ae,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ae),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new zo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ae,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ae),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==s&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Bo))),l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===l.joints[r.jointName]){const e=new zo;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[r.jointName]=e,l.add(e)}const i=l.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==o),this}}class jo extends re{constructor(e,t){super();const n=this,r=e.state;let i=null,o=1,s=null,a="local-floor",l=null,c=null,u=null,h=null,d=null,p=!1,f=null,m=null,g=null,y=null,v=null,_=null;const x=[],b=new Map,w=new qn;w.layers.enable(1),w.viewport=new Se;const S=new qn;S.layers.enable(2),S.viewport=new Se;const M=[w,S],E=new Fo;E.layers.enable(1),E.layers.enable(2);let T=null,C=null;function A(e){const t=b.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function I(){b.forEach((function(e,t){e.disconnect(t)})),b.clear(),T=null,C=null,r.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),u&&t.deleteFramebuffer(u),f&&t.deleteFramebuffer(f),m&&t.deleteRenderbuffer(m),g&&t.deleteRenderbuffer(g),u=null,f=null,m=null,g=null,d=null,h=null,c=null,i=null,N.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function P(e){const t=i.inputSources;for(let e=0;e<x.length;e++)b.set(t[e],x[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=b.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),b.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=b.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=x[e];return void 0===t&&(t=new Uo,x[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=x[e];return void 0===t&&(t=new Uo,x[e]=t),t.getGripSpace()},this.getHand=function(e){let t=x[e];return void 0===t&&(t=new Uo,x[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return c},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(e){if(i=e,null!==i){i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",I),i.addEventListener("inputsourceschange",P);const e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers){const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d})}else if(t instanceof WebGLRenderingContext){const n={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:o};d=new XRWebGLLayer(i,t,n),i.updateRenderState({layers:[d]})}else{p=e.antialias;let n=null;e.depth&&(_=256,e.stencil&&(_|=1024),v=e.stencil?33306:36096,n=e.stencil?35056:33190);const s={colorFormat:e.alpha?32856:32849,depthFormat:n,scaleFactor:o};c=new XRWebGLBinding(i,t),h=c.createProjectionLayer(s),u=t.createFramebuffer(),i.updateRenderState({layers:[h]}),p&&(f=t.createFramebuffer(),m=t.createRenderbuffer(),t.bindRenderbuffer(36161,m),t.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),r.bindFramebuffer(36160,f),t.framebufferRenderbuffer(36160,36064,36161,m),t.bindRenderbuffer(36161,null),null!==n&&(g=t.createRenderbuffer(),t.bindRenderbuffer(36161,g),t.renderbufferStorageMultisample(36161,4,n,h.textureWidth,h.textureHeight),t.framebufferRenderbuffer(36160,v,36161,g),t.bindRenderbuffer(36161,null)),r.bindFramebuffer(36160,null))}s=await i.requestReferenceSpace(a),N.setContext(i),N.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const R=new Ae,L=new Ae;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;E.near=S.near=w.near=e.near,E.far=S.far=w.far=e.far,T===E.near&&C===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),T=E.near,C=E.far);const t=e.parent,n=E.cameras;D(E,t);for(let e=0;e<n.length;e++)D(n[e],t);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),e.position.copy(E.position),e.quaternion.copy(E.quaternion),e.scale.copy(E.scale),e.matrix.copy(E.matrix),e.matrixWorld.copy(E.matrixWorld);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);const r=R.distanceTo(L),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,y=a+f,v=d-m,_=p+(r-m),x=l*a/y*g,b=c*a/y*g;e.projectionMatrix.makePerspective(v,_,x,b,g,y)}(E,w,S):E.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let O=null;const N=new sr;N.setAnimationLoop((function(e,n){if(l=n.getViewerPose(s),y=n,null!==l){const e=l.views;null!==d&&r.bindXRFramebuffer(d.framebuffer);let n=!1;e.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const o=e[i];let s=null;if(null!==d)s=d.getViewport(o);else{const e=c.getViewSubImage(h,o);r.bindXRFramebuffer(u),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,v,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),s=e.viewport}const a=M[i];a.matrix.fromArray(o.transform.matrix),a.projectionMatrix.fromArray(o.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&E.matrix.copy(a.matrix),!0===n&&E.cameras.push(a)}p&&(r.bindXRFramebuffer(f),null!==_&&t.clear(_))}const o=i.inputSources;for(let e=0;e<x.length;e++){const t=x[e],r=o[e];t.update(r,n,s)}if(O&&O(e,n),p){const e=h.textureWidth,n=h.textureHeight;r.bindFramebuffer(36008,f),r.bindFramebuffer(36009,u),t.invalidateFramebuffer(36008,[v]),t.invalidateFramebuffer(36009,[v]),t.blitFramebuffer(0,0,e,n,0,0,e,n,16384,9728),t.invalidateFramebuffer(36008,[36064]),r.bindFramebuffer(36008,null),r.bindFramebuffer(36009,null),r.bindFramebuffer(36160,f)}y=null})),this.setAnimationLoop=function(e){O=e},this.dispose=function(){}}}function Vo(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;if(r){t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio;const i=e.get(r).__maxMipLevel;void 0!==i&&(t.maxMipLevel.value=i)}let i,o;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularTintMap?i=n.specularTintMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap&&(i=n.thicknessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o,s){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.ior.value=t.ior,t.sheenTint&&e.sheenTint.value.copy(t.sheenTint),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate())),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationTint.value.copy(t.attenuationTint)),e.specularIntensity.value=t.specularIntensity,e.specularTint.value.copy(t.specularTint),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularTintMap&&(e.specularTintMap.value=t.specularTintMap)}(e,r,s):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=void 0!==e.canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d=null,f=null;const m=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=W,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,b=0,M=0,E=null,C=-1,A=null;const I=new Se,P=new Se;let R=null,L=t.width,D=t.height,O=1,N=null,k=null;const F=new Se(0,0,L,D),z=new Se(0,0,L,D);let B=!1;const U=[],j=new or;let V=!1,G=!1,H=null;const Z=new ot,$=new Ae,q={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function X(){return null===E?O:1}let Y,K,J,Q,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,he,de,pe,fe,me,ge,ye,ve,_e=n;function xe(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",Ce,!1),null===_e){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),_e=xe(t,e),null===_e)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===_e.getShaderPrecisionFormat&&(_e.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function be(){Y=new Ur(_e),K=new mr(_e,Y,e),Y.init(K),ye=new ko(_e,Y,K),J=new Oo(_e,Y,K),U[0]=1029,Q=new Gr(_e),ee=new xo,te=new No(_e,Y,J,ee,K,ye,Q),ne=new yr(y),re=new Br(y),ie=new ar(_e,K),ve=new pr(_e,Y,ie,K),oe=new jr(_e,ie,Q,ve),se=new $r(_e,oe,ie,Q),fe=new Wr(_e),he=new gr(ee),ae=new _o(y,ne,re,Y,K,ve,he),le=new Vo(ee),ce=new Mo(ee),ue=new Po(Y,K),pe=new dr(y,ne,J,se,a),de=new Do(y,se,K),me=new fr(_e,Y,Q,K),ge=new Vr(_e,Y,Q,K),Q.programs=ae.programs,y.capabilities=K,y.extensions=Y,y.properties=ee,y.renderLists=ce,y.shadowMap=de,y.state=J,y.info=Q}be();const we=new jo(y,_e);function Ee(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Ce(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=Q.autoReset,t=de.enabled,n=de.autoUpdate,r=de.needsUpdate,i=de.type;be(),Q.autoReset=e,de.enabled=t,de.autoUpdate=n,de.needsUpdate=r,de.type=i}function Ie(e){const t=e.target;t.removeEventListener("dispose",Ie),function(e){(function(e){const t=ee.get(e).programs;void 0!==t&&t.forEach((function(e){ae.releaseProgram(e)}))})(e),ee.remove(e)}(t)}this.xr=we,this.getContext=function(){return _e},this.getContextAttributes=function(){return _e.getContextAttributes()},this.forceContextLoss=function(){const e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(L,D,!1))},this.getSize=function(e){return e.set(L,D)},this.setSize=function(e,n,r){we.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(L=e,D=n,t.width=Math.floor(e*O),t.height=Math.floor(n*O),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(L*O,D*O).floor()},this.setDrawingBufferSize=function(e,n,r){L=e,D=n,O=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(I)},this.getViewport=function(e){return e.copy(F)},this.setViewport=function(e,t,n,r){e.isVector4?F.set(e.x,e.y,e.z,e.w):F.set(e,t,n,r),J.viewport(I.copy(F).multiplyScalar(O).floor())},this.getScissor=function(e){return e.copy(z)},this.setScissor=function(e,t,n,r){e.isVector4?z.set(e.x,e.y,e.z,e.w):z.set(e,t,n,r),J.scissor(P.copy(z).multiplyScalar(O).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(e){J.setScissorTest(B=e)},this.setOpaqueSort=function(e){N=e},this.setTransparentSort=function(e){k=e},this.getClearColor=function(e){return e.copy(pe.getClearColor())},this.setClearColor=function(){pe.setClearColor.apply(pe,arguments)},this.getClearAlpha=function(){return pe.getClearAlpha()},this.setClearAlpha=function(){pe.setClearAlpha.apply(pe,arguments)},this.clear=function(e,t,n){let r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),_e.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",Ce,!1),ce.dispose(),ue.dispose(),ee.dispose(),ne.dispose(),re.dispose(),se.dispose(),ve.dispose(),we.dispose(),we.removeEventListener("sessionstart",Re),we.removeEventListener("sessionend",Le),H&&(H.dispose(),H=null),De.stop()},this.renderBufferImmediate=function(e,t){ve.initAttributes();const n=ee.get(e);e.hasPositions&&!n.position&&(n.position=_e.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=_e.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=_e.createBuffer()),e.hasColors&&!n.color&&(n.color=_e.createBuffer());const r=t.getAttributes();e.hasPositions&&(_e.bindBuffer(34962,n.position),_e.bufferData(34962,e.positionArray,35048),ve.enableAttribute(r.position.location),_e.vertexAttribPointer(r.position.location,3,5126,!1,0,0)),e.hasNormals&&(_e.bindBuffer(34962,n.normal),_e.bufferData(34962,e.normalArray,35048),ve.enableAttribute(r.normal.location),_e.vertexAttribPointer(r.normal.location,3,5126,!1,0,0)),e.hasUvs&&(_e.bindBuffer(34962,n.uv),_e.bufferData(34962,e.uvArray,35048),ve.enableAttribute(r.uv.location),_e.vertexAttribPointer(r.uv.location,2,5126,!1,0,0)),e.hasColors&&(_e.bindBuffer(34962,n.color),_e.bufferData(34962,e.colorArray,35048),ve.enableAttribute(r.color.location),_e.vertexAttribPointer(r.color.location,3,5126,!1,0,0)),ve.disableUnusedAttributes(),_e.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=q);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=Ue(e,t,r,i);J.setMaterial(r,s);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let u,h=1;!0===r.wireframe&&(l=oe.getWireframeAttribute(n),h=2),void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||fe.update(i,n,r,a),ve.setup(i,r,a,n,l);let d=me;null!==l&&(u=ie.get(l),d=ge,d.setIndex(u));const p=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,y=null!==o?o.count*h:1/0,v=Math.max(f,g),_=Math.min(p,f+m,g+y)-1,x=Math.max(0,_-v+1);if(0!==x){if(i.isMesh)!0===r.wireframe?(J.setLineWidth(r.wireframeLinewidth*X()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),J.setLineWidth(e*X()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(v,x,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(v,x,e)}else d.render(v,x)}},this.compile=function(e,t){f=ue.get(e),f.init(),g.push(f),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(y.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++)ze(n[r],e,t);else ze(n,e,t)})),g.pop(),f=null};let Pe=null;function Re(){De.stop()}function Le(){De.start()}const De=new sr;function Oe(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||j.intersectsSprite(e)){r&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z);const t=se.update(e),i=e.material;i.visible&&d.push(e,t,i,n,$.z,null)}}else if(e.isImmediateRenderObject)r&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z),d.push(e,null,e.material,n,$.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||j.intersectsObject(e))){r&&$.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Z);const t=se.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&d.push(e,t,a,n,$.z,s)}}else i.visible&&d.push(e,t,i,n,$.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)Oe(i[e],t,n,r)}function Ne(e,t,n,r){const i=e.opaque,o=e.transmissive,a=e.transparent;f.setupLightsView(n),o.length>0&&function(e,t,n){if(null===H){const e=!0===s&&!0===K.isWebGL2;H=new(e?Te:Me)(1024,1024,{generateMipmaps:!0,type:null!==ye.convert(S)?S:_,minFilter:v,magFilter:p,wrapS:h,wrapT:h})}const r=y.getRenderTarget();y.setRenderTarget(H),y.clear();const i=y.toneMapping;y.toneMapping=0,ke(e,t,n),y.toneMapping=i,te.updateMultisampleRenderTarget(H),te.updateRenderTargetMipmap(H),y.setRenderTarget(r)}(i,t,n),r&&J.viewport(I.copy(r)),i.length>0&&ke(i,t,n),o.length>0&&ke(o,t,n),a.length>0&&ke(a,t,n)}function ke(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,l=null===r?o.material:r,c=o.group;s.layers.test(n.layers)&&Fe(s,t,n,a,l,c)}}function Fe(e,t,n,r,i,o){if(e.onBeforeRender(y,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const r=Ue(n,t,i,e);J.setMaterial(i),ve.reset(),function(e,t){e.render((function(e){y.renderBufferImmediate(e,t)}))}(e,r)}else!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,o),i.side=0,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,o),i.side=2):y.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(y,t,n,r,i,o)}function ze(e,t,n){!0!==t.isScene&&(t=q);const r=ee.get(e),i=f.state.lights,o=f.state.shadowsArray,s=i.state.version,a=ae.getParameters(e,i.state,o,t,n),l=ae.getProgramCacheKey(a);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?re:ne).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Ie),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return Be(e,a),u}else a.uniforms=ae.getUniforms(e),e.onBuild(a,y),e.onBeforeCompile(a,y),u=ae.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;const h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=he.uniform),Be(e,a),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=u.getUniforms(),p=Ki.seqWithValue(d.seq,h);return r.currentProgram=u,r.uniformsList=p,u}function Be(e,t){const n=ee.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function Ue(e,t,n,r){!0!==t.isScene&&(t=q),te.resetTextureUnits();const i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,s=null===E?y.outputEncoding:E.texture.encoding,a=(n.isMeshStandardMaterial?re:ne).get(n.envMap||o),l=!0===n.vertexColors&&!!r.geometry&&!!r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=!!r.geometry&&!!r.geometry.attributes.tangent,u=!!r.geometry&&!!r.geometry.morphAttributes.position,h=!!r.geometry&&!!r.geometry.morphAttributes.normal,d=ee.get(n),p=f.state.lights;if(!0===V&&(!0===G||e!==A)){const t=e===A&&n.id===C;he.setState(n,e,t)}let m=!1;n.version===d.__version?d.needsLights&&d.lightsStateVersion!==p.state.version||d.outputEncoding!==s||r.isInstancedMesh&&!1===d.instancing?m=!0:r.isInstancedMesh||!0!==d.instancing?r.isSkinnedMesh&&!1===d.skinning?m=!0:r.isSkinnedMesh||!0!==d.skinning?d.envMap!==a||n.fog&&d.fog!==i?m=!0:void 0===d.numClippingPlanes||d.numClippingPlanes===he.numPlanes&&d.numIntersection===he.numIntersection?(d.vertexAlphas!==l||d.vertexTangents!==c||d.morphTargets!==u||d.morphNormals!==h)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,d.__version=n.version);let g=d.currentProgram;!0===m&&(g=ze(n,t,r));let v=!1,_=!1,x=!1;const b=g.getUniforms(),w=d.uniforms;if(J.useProgram(g.program)&&(v=!0,_=!0,x=!0),n.id!==C&&(C=n.id,_=!0),v||A!==e){if(b.setValue(_e,"projectionMatrix",e.projectionMatrix),K.logarithmicDepthBuffer&&b.setValue(_e,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),A!==e&&(A=e,_=!0,x=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=b.map.cameraPosition;void 0!==t&&t.setValue(_e,$.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&b.setValue(_e,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&b.setValue(_e,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){b.setOptional(_e,r,"bindMatrix"),b.setOptional(_e,r,"bindMatrixInverse");const e=r.skeleton;e&&(K.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),b.setValue(_e,"boneTexture",e.boneTexture,te),b.setValue(_e,"boneTextureSize",e.boneTextureSize)):b.setOptional(_e,e,"boneMatrices"))}var S,M;return(_||d.receiveShadow!==r.receiveShadow)&&(d.receiveShadow=r.receiveShadow,b.setValue(_e,"receiveShadow",r.receiveShadow)),_&&(b.setValue(_e,"toneMappingExposure",y.toneMappingExposure),d.needsLights&&(M=x,(S=w).ambientLightColor.needsUpdate=M,S.lightProbe.needsUpdate=M,S.directionalLights.needsUpdate=M,S.directionalLightShadows.needsUpdate=M,S.pointLights.needsUpdate=M,S.pointLightShadows.needsUpdate=M,S.spotLights.needsUpdate=M,S.spotLightShadows.needsUpdate=M,S.rectAreaLights.needsUpdate=M,S.hemisphereLights.needsUpdate=M),i&&n.fog&&le.refreshFogUniforms(w,i),le.refreshMaterialUniforms(w,n,O,D,H),Ki.upload(_e,d.uniformsList,w,te)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Ki.upload(_e,d.uniformsList,w,te),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(_e,"center",r.center),b.setValue(_e,"modelViewMatrix",r.modelViewMatrix),b.setValue(_e,"normalMatrix",r.normalMatrix),b.setValue(_e,"modelMatrix",r.matrixWorld),g}De.setAnimationLoop((function(e){Pe&&Pe(e)})),"undefined"!=typeof window&&De.setContext(window),this.setAnimationLoop=function(e){Pe=e,we.setAnimationLoop(e),null===e?De.stop():De.start()},we.addEventListener("sessionstart",Re),we.addEventListener("sessionend",Le),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===we.enabled&&!0===we.isPresenting&&(!0===we.cameraAutoUpdate&&we.updateCamera(t),t=we.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,E),f=ue.get(e,g.length),f.init(),g.push(f),Z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),j.setFromProjectionMatrix(Z),G=this.localClippingEnabled,V=he.init(this.clippingPlanes,G,t),d=ce.get(e,m.length),d.init(),m.push(d),Oe(e,t,0,y.sortObjects),d.finish(),!0===y.sortObjects&&d.sort(N,k),!0===V&&he.beginShadows();const n=f.state.shadowsArray;if(de.render(n,e,t),!0===V&&he.endShadows(),!0===this.info.autoReset&&this.info.reset(),pe.render(d,e),f.setupLights(y.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Ne(d,e,r,r.viewport)}}else Ne(d,e,t);null!==E&&(te.updateMultisampleRenderTarget(E),te.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(y,e,t),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1),ve.resetDefaultState(),C=-1,A=null,g.pop(),f=g.length>0?g[g.length-1]:null,m.pop(),d=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;E=e,b=t,M=n,e&&void 0===ee.get(e).__webglFramebuffer&&te.setupRenderTarget(e);let r=null,i=!1,o=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(o=!0);const s=ee.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=s[t],i=!0):r=e.isWebGLMultisampleRenderTarget?ee.get(e).__webglMultisampledFramebuffer:s,I.copy(e.viewport),P.copy(e.scissor),R=e.scissorTest}else I.copy(F).multiplyScalar(O).floor(),P.copy(z).multiplyScalar(O).floor(),R=B;if(J.bindFramebuffer(36160,r)&&K.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(U.length!==n.length||36064!==U[0]){for(let e=0,t=n.length;e<t;e++)U[e]=36064+e;U.length=n.length,t=!0}}else 1===U.length&&36064===U[0]||(U[0]=36064,U.length=1,t=!0);else 1===U.length&&1029===U[0]||(U[0]=1029,U.length=1,t=!0);t&&(K.isWebGL2?_e.drawBuffers(U):Y.get("WEBGL_draw_buffers").drawBuffersWEBGL(U))}if(J.viewport(I),J.scissor(P),J.setScissorTest(R),i){const r=ee.get(e.texture);_e.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}else if(o){const r=ee.get(e.texture),i=t||0;_e.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}C=-1},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){J.bindFramebuffer(36160,a);try{const s=e.texture,a=s.format,l=s.type;if(a!==T&&ye.convert(a)!==_e.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===S&&(Y.has("EXT_color_buffer_half_float")||K.isWebGL2&&Y.has("EXT_color_buffer_float"));if(!(l===_||ye.convert(l)===_e.getParameter(35738)||l===w&&(K.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===_e.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&_e.readPixels(t,n,r,i,ye.convert(a),ye.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==E?ee.get(E).__webglFramebuffer:null;J.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);let s=ye.convert(t.format);K.isWebGL2&&(6407===s&&(s=32849),6408===s&&(s=32856)),te.setTexture2D(t,0),_e.copyTexImage2D(3553,n,s,e.x,e.y,i,o,0),J.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=t.image.width,o=t.image.height,s=ye.convert(n.format),a=ye.convert(n.type);te.setTexture2D(n,0),_e.pixelStorei(37440,n.flipY),_e.pixelStorei(37441,n.premultiplyAlpha),_e.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?_e.texSubImage2D(3553,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?_e.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):_e.texSubImage2D(3553,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&_e.generateMipmap(3553),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=ye.convert(r.format),c=ye.convert(r.type);let u;if(r.isDataTexture3D)te.setTexture3D(r,0),u=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");te.setTexture2DArray(r,0),u=35866}_e.pixelStorei(37440,r.flipY),_e.pixelStorei(37441,r.premultiplyAlpha),_e.pixelStorei(3317,r.unpackAlignment);const h=_e.getParameter(3314),d=_e.getParameter(32878),p=_e.getParameter(3316),f=_e.getParameter(3315),m=_e.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;_e.pixelStorei(3314,g.width),_e.pixelStorei(32878,g.height),_e.pixelStorei(3316,e.min.x),_e.pixelStorei(3315,e.min.y),_e.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?_e.texSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_e.compressedTexSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,g.data)):_e.texSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,c,g),_e.pixelStorei(3314,h),_e.pixelStorei(32878,d),_e.pixelStorei(3316,p),_e.pixelStorei(3315,f),_e.pixelStorei(32877,m),0===i&&r.generateMipmaps&&_e.generateMipmap(u),J.unbindTexture()},this.initTexture=function(e){te.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){b=0,M=0,E=null,J.reset(),ve.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Ho extends Go{}Ho.prototype.isWebGL1Renderer=!0;class Zo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.name="",this.color=new Yt(e),this.density=t}clone(){return new Zo(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Zo.prototype.isFogExp2=!0;class Wo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.name="",this.color=new Yt(e),this.near=t,this.far=n}clone(){return new Wo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Wo.prototype.isFog=!0;class $o extends Pt{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}$o.prototype.isScene=!0;class qo{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ee,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=le()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=le()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=le()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}qo.prototype.isInterleavedBuffer=!0;const Xo=new Ae;class Yo{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Xo.x=this.getX(t),Xo.y=this.getY(t),Xo.z=this.getZ(t),Xo.applyMatrix4(e),this.setXYZ(t,Xo.x,Xo.y,Xo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Xo.x=this.getX(t),Xo.y=this.getY(t),Xo.z=this.getZ(t),Xo.applyNormalMatrix(e),this.setXYZ(t,Xo.x,Xo.y,Xo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Xo.x=this.getX(t),Xo.y=this.getY(t),Xo.z=this.getZ(t),Xo.transformDirection(e),this.setXYZ(t,Xo.x,Xo.y,Xo.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new en(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Yo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Yo.prototype.isInterleavedBufferAttribute=!0;class Ko extends Gt{constructor(e){super(),this.type="SpriteMaterial",this.color=new Yt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Jo;Ko.prototype.isSpriteMaterial=!0;const Qo=new Ae,es=new Ae,ts=new Ae,ns=new ge,rs=new ge,is=new ot,os=new Ae,ss=new Ae,as=new Ae,ls=new ge,cs=new ge,us=new ge;class hs extends Pt{constructor(e){if(super(),this.type="Sprite",void 0===Jo){Jo=new wn;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new qo(e,5);Jo.setIndex([0,1,2,0,2,3]),Jo.setAttribute("position",new Yo(t,3,0,!1)),Jo.setAttribute("uv",new Yo(t,2,3,!1))}this.geometry=Jo,this.material=void 0!==e?e:new Ko,this.center=new ge(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),es.setFromMatrixScale(this.matrixWorld),is.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ts.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&es.multiplyScalar(-ts.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;ds(os.set(-.5,-.5,0),ts,o,es,r,i),ds(ss.set(.5,-.5,0),ts,o,es,r,i),ds(as.set(.5,.5,0),ts,o,es,r,i),ls.set(0,0),cs.set(1,0),us.set(1,1);let s=e.ray.intersectTriangle(os,ss,as,!1,Qo);if(null===s&&(ds(ss.set(-.5,.5,0),ts,o,es,r,i),cs.set(0,1),s=e.ray.intersectTriangle(os,as,ss,!1,Qo),null===s))return;const a=e.ray.origin.distanceTo(Qo);a<e.near||a>e.far||t.push({distance:a,point:Qo.clone(),uv:jt.getUV(Qo,os,ss,as,ls,cs,us,new ge),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function ds(e,t,n,r,i,o){ns.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(rs.x=o*ns.x-i*ns.y,rs.y=i*ns.x+o*ns.y):rs.copy(ns),e.copy(t),e.x+=rs.x,e.y+=rs.y,e.applyMatrix4(is)}hs.prototype.isSprite=!0;const ps=new Ae,fs=new Ae;class ms extends Pt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ps.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(ps);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ps.setFromMatrixPosition(e.matrixWorld),fs.setFromMatrixPosition(this.matrixWorld);const n=ps.distanceTo(fs)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const gs=new Ae,ys=new Se,vs=new Se,_s=new Ae,xs=new ot;class bs extends Un{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ot,this.bindMatrixInverse=new ot}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Se,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;ys.fromBufferAttribute(r.attributes.skinIndex,e),vs.fromBufferAttribute(r.attributes.skinWeight,e),gs.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=vs.getComponent(e);if(0!==r){const i=ys.getComponent(e);xs.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(_s.copy(gs).applyMatrix4(xs),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}bs.prototype.isSkinnedMesh=!0;class ws extends Pt{constructor(){super(),this.type="Bone"}}ws.prototype.isBone=!0;class Ss extends be{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1003,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1003;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,r,i,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.image={data:e,width:t,height:n},this.magFilter=r,this.minFilter=i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ss.prototype.isDataTexture=!0;const Ms=new ot,Es=new ot;class Ts{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=le(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ot)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new ot;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Es;Ms.multiplyMatrices(i,t[r]),Ms.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Ts(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=pe(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Ss(t,e,e,T,w);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new ws),this.bones.push(i),this.boneInverses.push((new ot).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}class Cs extends en{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Cs.prototype.isInstancedBufferAttribute=!0;const As=new ot,Is=new ot,Ps=[],Rs=new Un;class Ls extends Un{constructor(e,t,n){super(e,t),this.instanceMatrix=new Cs(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Rs.geometry=this.geometry,Rs.material=this.material,void 0!==Rs.material)for(let i=0;i<r;i++){this.getMatrixAt(i,As),Is.multiplyMatrices(n,As),Rs.matrixWorld=Is,Rs.raycast(e,Ps);for(let e=0,n=Ps.length;e<n;e++){const n=Ps[e];n.instanceId=i,n.object=this,t.push(n)}Ps.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Cs(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Ls.prototype.isInstancedMesh=!0;class Ds extends Gt{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Yt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ds.prototype.isLineBasicMaterial=!0;const Os=new Ae,Ns=new Ae,ks=new ot,Fs=new it,zs=new Ye;class Bs extends Pt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ds;super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Os.fromBufferAttribute(t,e-1),Ns.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Os.distanceTo(Ns);e.setAttribute("lineDistance",new un(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),zs.copy(n.boundingSphere),zs.applyMatrix4(r),zs.radius+=i,!1===e.ray.intersectsSphere(zs))return;ks.copy(r).invert(),Fs.copy(e.ray).applyMatrix4(ks);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new Ae,c=new Ae,u=new Ae,h=new Ae,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r)for(let n=Math.max(0,o.start),s=Math.min(r.count,o.start+o.count)-1;n<s;n+=d){const o=r.getX(n),s=r.getX(n+1);if(l.fromBufferAttribute(i,o),c.fromBufferAttribute(i,s),Fs.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=d){if(l.fromBufferAttribute(i,n),c.fromBufferAttribute(i,n+1),Fs.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Bs.prototype.isLine=!0;const Us=new Ae,js=new Ae;class Vs extends Bs{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Us.fromBufferAttribute(t,e),js.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Us.distanceTo(js);e.setAttribute("lineDistance",new un(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Vs.prototype.isLineSegments=!0;class Gs extends Bs{constructor(e,t){super(e,t),this.type="LineLoop"}}Gs.prototype.isLineLoop=!0;class Hs extends Gt{constructor(e){super(),this.type="PointsMaterial",this.color=new Yt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Hs.prototype.isPointsMaterial=!0;const Zs=new ot,Ws=new it,$s=new Ye,qs=new Ae;class Xs extends Pt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Hs;super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),$s.copy(n.boundingSphere),$s.applyMatrix4(r),$s.radius+=i,!1===e.ray.intersectsSphere($s))return;Zs.copy(r).invert(),Ws.copy(e.ray).applyMatrix4(Zs);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i)for(let n=Math.max(0,o.start),l=Math.min(i.count,o.start+o.count);n<l;n++){const o=i.getX(n);qs.fromBufferAttribute(s,o),Ys(qs,o,a,r,e,t,this)}else for(let n=Math.max(0,o.start),i=Math.min(s.count,o.start+o.count);n<i;n++)qs.fromBufferAttribute(s,n),Ys(qs,n,a,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Ys(e,t,n,r,i,o,s){const a=Ws.distanceSqToPoint(e);if(a<n){const n=new Ae;Ws.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}Xs.prototype.isPoints=!0;class Ks extends be{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,o,s,a,l),this.format=void 0!==s?s:E,this.minFilter=void 0!==o?o:g,this.magFilter=void 0!==i?i:g,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Ks.prototype.isVideoTexture=!0;class Js extends be{constructor(e,t,n,r,i,o,s,a,l,c,u,h){super(null,o,s,a,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}Js.prototype.isCompressedTexture=!0;class Qs extends be{constructor(e,t,n,r,i,o,s,a,l){super(e,t,n,r,i,o,s,a,l),this.needsUpdate=!0}}Qs.prototype.isCanvasTexture=!0;class ea extends be{constructor(e,t,n,r,i,o,s,a,l,c){if((c=void 0!==c?c:C)!==C&&c!==A)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===C&&(n=x),void 0===n&&c===A&&(n=M),super(null,r,i,o,s,a,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:p,this.minFilter=void 0!==a?a:p,this.flipY=!1,this.generateMipmaps=!1}}ea.prototype.isDepthTexture=!0;class ta extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],s=[],a=[],l=new Ae,c=new ge;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){const h=n+i/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),o.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(o[u]/e+1)/2,c.y=(o[u+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new un(o,3)),this.setAttribute("normal",new un(s,3)),this.setAttribute("uv",new un(a,2))}static fromJSON(e){return new ta(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class na extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const l=this;r=Math.floor(r),i=Math.floor(i);const c=[],u=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function y(n){const i=p,o=new ge,f=new Ae;let y=0;const v=!0===n?e:t,_=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*_,0),h.push(0,_,0),d.push(.5,.5),p++;const x=p;for(let e=0;e<=r;e++){const t=e/r*a+s,n=Math.cos(t),i=Math.sin(t);f.x=v*i,f.y=m*_,f.z=v*n,u.push(f.x,f.y,f.z),h.push(0,_,0),o.x=.5*n+.5,o.y=.5*i*_+.5,d.push(o.x,o.y),p++}for(let e=0;e<r;e++){const t=i+e,r=x+e;!0===n?c.push(r,r+1,t):c.push(r+1,r,t),y+=3}l.addGroup(g,y,!0===n?1:2),g+=y}!function(){const o=new Ae,y=new Ae;let v=0;const _=(t-e)/n;for(let l=0;l<=i;l++){const c=[],g=l/i,v=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*a+s,l=Math.sin(i),f=Math.cos(i);y.x=v*l,y.y=-g*n+m,y.z=v*f,u.push(y.x,y.y,y.z),o.set(l,_,f).normalize(),h.push(o.x,o.y,o.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],o=f[t][e+1];c.push(n,r,o),c.push(r,i,o),v+=6}l.addGroup(g,v,0),g+=v}(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new un(u,3)),this.setAttribute("normal",new un(h,3)),this.setAttribute("uv",new un(d,2))}static fromJSON(e){return new na(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ra extends na{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}static fromJSON(e){return new ra(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ia extends wn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function s(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const s=e.clone().lerp(n,r/i),a=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)o[r][e]=0===e&&r===i?s:s.clone().lerp(a,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(o[e][n+1]),a(o[e+1][n]),a(o[e][n])):(a(o[e][n+1]),a(o[e+1][n+1]),a(o[e+1][n]))}}function a(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function c(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new Ae,r=new Ae,i=new Ae;for(let o=0;o<t.length;o+=3)l(t[o+0],n),l(t[o+1],r),l(t[o+2],i),s(n,r,i,e)}(r),function(e){const t=new Ae;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new Ae;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=u(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-s)}var t;(function(){const e=new Ae,t=new Ae,n=new Ae,r=new Ae,s=new ge,a=new ge,l=new ge;for(let h=0,d=0;h<i.length;h+=9,d+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),s.set(o[d+0],o[d+1]),a.set(o[d+2],o[d+3]),l.set(o[d+4],o[d+5]),r.copy(e).add(t).add(n).divideScalar(3);const p=u(r);c(s,d+0,e,p),c(a,d+2,t,p),c(l,d+4,n,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new un(i,3)),this.setAttribute("normal",new un(i.slice(),3)),this.setAttribute("uv",new un(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new ia(e.vertices,e.indices,e.radius,e.details)}}class oa extends ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new oa(e.radius,e.detail)}}const sa=new Ae,aa=new Ae,la=new Ae,ca=new jt;class ua extends wn{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0===e.isGeometry)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const n=Math.pow(10,4),r=Math.cos(se*t),i=e.getIndex(),o=e.getAttribute("position"),s=i?i.count:o.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),u={},h=[];for(let e=0;e<s;e+=3){i?(a[0]=i.getX(e),a[1]=i.getX(e+1),a[2]=i.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:s,c:d}=ca;if(t.fromBufferAttribute(o,a[0]),s.fromBufferAttribute(o,a[1]),d.fromBufferAttribute(o,a[2]),ca.getNormal(la),c[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,c[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,c[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],i=c[t],o=ca[l[e]],s=ca[l[t]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(la.dot(u[p].normal)<=r&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:a[e],index1:a[t],normal:la.clone()})}}for(const e in u)if(u[e]){const{index0:t,index1:n}=u[e];sa.fromBufferAttribute(o,t),aa.fromBufferAttribute(o,n),h.push(sa.x,sa.y,sa.z),h.push(aa.x,aa.y,aa.z)}this.setAttribute("position",new un(h,3))}}class ha{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=t||(o.isVector2?new ge:new Ae);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Ae,r=[],i=[],o=[],s=new Ae,a=new ot;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Ae),r[t].normalize()}i[0]=new Ae,o[0]=new Ae;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(ce(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(ce(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class da extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new ge,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}da.prototype.isEllipseCurve=!0;class pa extends da{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.type="ArcCurve"}}function fa(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+a)+(r-n)/a;l*=s,c*=s,i(t,n,l,c)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}pa.prototype.isArcCurve=!0;const ma=new Ae,ga=new fa,ya=new fa,va=new fa;class _a extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=this.points,r=n.length,i=(r-(this.closed?0:1))*e;let o,s,a=Math.floor(i),l=i-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:0===l&&a===r-1&&(a=r-2,l=1),this.closed||a>0?o=n[(a-1)%r]:(ma.subVectors(n[0],n[1]).add(n[0]),o=ma);const c=n[a%r],u=n[(a+1)%r];if(this.closed||a+2<r?s=n[(a+2)%r]:(ma.subVectors(n[r-1],n[r-2]).add(n[r-1]),s=ma),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),ga.initNonuniformCatmullRom(o.x,c.x,u.x,s.x,t,n,r),ya.initNonuniformCatmullRom(o.y,c.y,u.y,s.y,t,n,r),va.initNonuniformCatmullRom(o.z,c.z,u.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(ga.initCatmullRom(o.x,c.x,u.x,s.x,this.tension),ya.initCatmullRom(o.y,c.y,u.y,s.y,this.tension),va.initCatmullRom(o.z,c.z,u.z,s.z,this.tension));return t.set(ga.calc(l),ya.calc(l),va.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Ae).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function xa(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function ba(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function wa(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}_a.prototype.isCatmullRomCurve3=!0;class Sa extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ge,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ge,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ge;super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(wa(e,n.x,r.x,i.x,o.x),wa(e,n.y,r.y,i.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Sa.prototype.isCubicBezierCurve=!0;class Ma extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ae,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Ae;super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(wa(e,n.x,r.x,i.x,o.x),wa(e,n.y,r.y,i.y,o.y),wa(e,n.z,r.z,i.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Ma.prototype.isCubicBezierCurve3=!0;class Ea extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ge,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge;super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new ge;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ea.prototype.isLineCurve=!0;class Ta extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae;super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ca extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ge,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ge;super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge,n=this.v0,r=this.v1,i=this.v2;return t.set(ba(e,n.x,r.x,i.x),ba(e,n.y,r.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ca.prototype.isQuadraticBezierCurve=!0;class Aa extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ae;super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae,n=this.v0,r=this.v1,i=this.v2;return t.set(ba(e,n.x,r.x,i.x),ba(e,n.y,r.y,i.y),ba(e,n.z,r.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Aa.prototype.isQuadraticBezierCurve3=!0;class Ia extends ha{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge,n=this.points,r=(n.length-1)*e,i=Math.floor(r),o=r-i,s=n[0===i?i:i-1],a=n[i],l=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return t.set(xa(o,s.x,a.x,l.x,c.x),xa(o,s.y,a.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new ge).fromArray(n))}return this}}Ia.prototype.isSplineCurve=!0;var Pa=Object.freeze({__proto__:null,ArcCurve:pa,CatmullRomCurve3:_a,CubicBezierCurve:Sa,CubicBezierCurve3:Ma,EllipseCurve:da,LineCurve:Ea,LineCurve3:Ta,QuadraticBezierCurve:Ca,QuadraticBezierCurve3:Aa,SplineCurve:Ia});function Ra(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=Ja(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=Ja(o,e[o],e[o+1],s);return s&&Wa(s,s.next)&&(Qa(s),s=s.next),s}function La(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Wa(r,r.next)&&0!==Za(r.prev,r,r.next))r=r.next;else{if(Qa(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Da(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=ja(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ,r);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Na(e,r,i,o):Oa(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),Qa(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Da(e=ka(La(e),t,n),t,n,r,i,o,2):2===s&&Fa(e,t,n,r,i,o):Da(La(e),t,n,r,i,o,1);break}}function Oa(e){const t=e.prev,n=e,r=e.next;if(Za(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(Ga(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Za(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Na(e,t,n,r){const i=e.prev,o=e,s=e.next;if(Za(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,c=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=ja(a,l,t,n,r),d=ja(c,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Ga(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Za(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Ga(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Za(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Ga(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Za(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Ga(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&Za(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ka(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Wa(i,o)&&$a(i,r,r.next,o)&&Ya(i,o)&&Ya(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Qa(r),Qa(r.next),r=e=o),r=r.next}while(r!==e);return La(r)}function Fa(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Ha(s,e)){let a=Ka(s,e);return s=La(s,s.next),a=La(a,a.next),Da(s,t,n,r,i,o),void Da(a,t,n,r,i,o)}e=e.next}s=s.next}while(s!==e)}function za(e,t){return e.x-t.x}function Ba(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s){if(s=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===s)return o;const a=o,l=o.x,c=o.y;let u,h=1/0;n=o;do{r>=n.x&&n.x>=l&&r!==n.x&&Ga(i<c?r:s,i,l,c,i<c?s:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),Ya(n,e)&&(u<h||u===h&&(n.x>o.x||n.x===o.x&&Ua(o,n)))&&(o=n,h=u)),n=n.next}while(n!==a);return o}(e,t)){const n=Ka(t,e);La(t,t.next),La(n,n.next)}}function Ua(e,t){return Za(e.prev,e,t.prev)<0&&Za(t.next,e,e.next)<0}function ja(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Va(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ga(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Ha(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&$a(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ya(e,t)&&Ya(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Za(e.prev,e,t.prev)||Za(e,t.prev,t))||Wa(e,t)&&Za(e.prev,e,e.next)>0&&Za(t.prev,t,t.next)>0)}function Za(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Wa(e,t){return e.x===t.x&&e.y===t.y}function $a(e,t,n,r){const i=Xa(Za(e,t,n)),o=Xa(Za(e,t,r)),s=Xa(Za(n,r,e)),a=Xa(Za(n,r,t));return i!==o&&s!==a||!(0!==i||!qa(e,n,t))||!(0!==o||!qa(e,r,t))||!(0!==s||!qa(n,e,r))||!(0!==a||!qa(n,t,r))}function qa(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Xa(e){return e>0?1:e<0?-1:0}function Ya(e,t){return Za(e.prev,e,e.next)<0?Za(e,t,e.next)>=0&&Za(e,e.prev,t)>=0:Za(e,t,e.prev)<0||Za(e,e.next,t)<0}function Ka(e,t){const n=new el(e.i,e.x,e.y),r=new el(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ja(e,t,n,r){const i=new el(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function el(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class tl{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return tl.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];nl(e),rl(n,e);let o=e.length;t.forEach(nl);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,rl(n,t[e]);const s=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=Ra(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*r,l=o<s-1?t[o+1]*r:e.length,c=Ra(e,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Va(c));for(i.sort(za),o=0;o<i.length;o++)Ba(i[o],n),n=La(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?1/p:0}return Da(o,s,n,a,l,p),s}(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function nl(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function rl(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class il extends wn{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:ol;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,y,v,_,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,y=f.computeFrenetFrames(a,!1),v=new Ae,_=new Ae,x=new Ae),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let S=w.shape;const M=w.holes;if(!tl.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];tl.isClockWise(t)&&(M[e]=t.reverse())}}const E=tl.triangulateShape(S,M),T=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function C(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const A=S.length,I=E.length;function P(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);r=p+s*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new ge(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new ge(r/o,i/o)}const R=[];for(let e=0,t=T.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),R[e]=P(T[e],T[n],T[r]);const L=[];let D,O=R.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];D=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),D[e]=P(t[e],t[r],t[i]);L.push(D),O=O.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=C(T[e],R[e],r);F(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];D=L[e];for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);F(i.x,i.y,-n)}}}const N=h+d;for(let e=0;e<A;e++){const t=c?C(S[e],O[e],N):S[e];b?(_.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(v),F(x.x,x.y,x.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const n=c?C(S[t],O[t],N):S[t];b?(_.copy(y.normals[e]).multiplyScalar(n.x),v.copy(y.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(_).add(v),F(x.x,x.y,x.z)):F(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=C(T[e],R[e],r);F(t.x,t.y,l+n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];D=L[e];for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);b?F(i.x,i.y+g[a-1].y,g[a-1].x+n):F(i.x,i.y,l+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=A*e,o=A*(e+1);B(t+r+n,t+i+n,t+i+o,t+r+o)}}}function F(e,t,n){o.push(e),o.push(t),o.push(n)}function z(e,t,i){U(e),U(t),U(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[2])}function B(e,t,i,o){U(e),U(t),U(o),U(t),U(i),U(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function U(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function j(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=A*e;for(let e=0;e<I;e++){const n=E[e];z(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<I;e++){const n=E[e];z(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<I;e++){const t=E[e];z(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=E[e];z(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;k(T,t),t+=T.length;for(let e=0,n=M.length;e<n;e++){const n=M[e];k(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new un(r,3)),this.setAttribute("uv",new un(i,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Pa[r.type]).fromJSON(r)),new il(n,e.options)}}const ol={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new ge(o,s),new ge(a,l),new ge(c,u)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new ge(s,1-l),new ge(c,1-h),new ge(d,1-f),new ge(m,1-y)]:[new ge(a,1-l),new ge(u,1-h),new ge(p,1-f),new ge(g,1-y)]}};class sl extends ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sl(e.radius,e.detail)}}class al extends wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=ce(r,0,2*Math.PI);const i=[],o=[],s=[],a=1/t,l=new Ae,c=new ge;for(let i=0;i<=t;i++){const u=n+i*a*r,h=Math.sin(u),d=Math.cos(u);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,o.push(l.x,l.y,l.z),c.x=i/t,c.y=n/(e.length-1),s.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,s=r+e.length,a=r+e.length+1,l=r+1;i.push(o,s,l),i.push(s,a,l)}if(this.setIndex(i),this.setAttribute("position",new un(o,3)),this.setAttribute("uv",new un(s,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new Ae,i=new Ae,o=new Ae,s=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)r.x=n[a+0],r.y=n[a+1],r.z=n[a+2],i.x=n[s+a+0],i.y=n[s+a+1],i.z=n[s+a+2],o.addVectors(r,i).normalize(),n[a+0]=n[s+a+0]=o.x,n[a+1]=n[s+a+1]=o.y,n[a+2]=n[s+a+2]=o.z}}static fromJSON(e){return new al(e.points,e.segments,e.phiStart,e.phiLength)}}class ll extends ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ll(e.radius,e.detail)}}class cl extends wn{constructor(e,t,n){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const r=[],i=[],o=[],s=[],a=1e-5,l=new Ae,c=new Ae,u=new Ae,h=new Ae,d=new Ae;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let r=0;r<=n;r++){const p=r/n;for(let n=0;n<=t;n++){const r=n/t;e(r,p,c),i.push(c.x,c.y,c.z),r-a>=0?(e(r-a,p,u),h.subVectors(c,u)):(e(r+a,p,u),h.subVectors(u,c)),p-a>=0?(e(r,p-a,u),d.subVectors(c,u)):(e(r,p+a,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),o.push(l.x,l.y,l.z),s.push(r,p)}}for(let e=0;e<n;e++)for(let n=0;n<t;n++){const t=e*p+n,i=e*p+n+1,o=(e+1)*p+n+1,s=(e+1)*p+n;r.push(t,i,s),r.push(i,o,s)}this.setIndex(r),this.setAttribute("position",new un(i,3)),this.setAttribute("normal",new un(o,3)),this.setAttribute("uv",new un(s,2))}}class ul extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const s=[],a=[],l=[],c=[];let u=e;const h=(t-e)/(r=Math.max(1,r)),d=new Ae,p=new ge;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;d.x=u*Math.cos(r),d.y=u*Math.sin(r),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,a=r+n+2,l=r+1;s.push(i,o,l),s.push(o,a,l)}}this.setIndex(s),this.setAttribute("position",new un(a,3)),this.setAttribute("normal",new un(l,3)),this.setAttribute("uv",new un(c,2))}static fromJSON(e){return new ul(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class hl extends wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,a,t),s+=a,a=0;function l(e){const s=r.length/3,l=e.extractPoints(t);let c=l.shape;const u=l.holes;!1===tl.isClockWise(c)&&(c=c.reverse());for(let e=0,t=u.length;e<t;e++){const t=u[e];!0===tl.isClockWise(t)&&(u[e]=t.reverse())}const h=tl.triangulateShape(c,u);for(let e=0,t=u.length;e<t;e++){const t=u[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new un(r,3)),this.setAttribute("normal",new un(i,3)),this.setAttribute("uv",new un(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new hl(n,e.curveSegments)}}class dl extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let l=0;const c=[],u=new Ae,h=new Ae,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],y=d/n;let v=0;0==d&&0==o?v=.5/t:d==n&&a==Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const a=n/t;u.x=-e*Math.cos(r+a*i)*Math.sin(o+y*s),u.y=e*Math.cos(o+y*s),u.z=e*Math.sin(r+a*i)*Math.sin(o+y*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(a+v,1-y),g.push(l++)}c.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=c[e][r+1],i=c[e][r],s=c[e+1][r],l=c[e+1][r+1];(0!==e||o>0)&&d.push(t,i,l),(e!==n-1||a<Math.PI)&&d.push(i,s,l)}this.setIndex(d),this.setAttribute("position",new un(p,3)),this.setAttribute("normal",new un(f,3)),this.setAttribute("uv",new un(m,2))}static fromJSON(e){return new dl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class pl extends ia{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new pl(e.radius,e.detail)}}class fl extends il{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new wn;const r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t),this.type="TextGeometry"}}class ml extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],l=[],c=new Ae,u=new Ae,h=new Ae;for(let o=0;o<=n;o++)for(let d=0;d<=r;d++){const p=d/r*i,f=o/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(u,c).normalize(),a.push(h.x,h.y,h.z),l.push(d/r),l.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,a=(r+1)*e+t;o.push(n,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute("position",new un(s,3)),this.setAttribute("normal",new un(a,3)),this.setAttribute("uv",new un(l,2))}static fromJSON(e){return new ml(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class gl extends wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],l=[],c=[],u=new Ae,h=new Ae,d=new Ae,p=new Ae,f=new Ae,m=new Ae,g=new Ae;for(let s=0;s<=n;++s){const v=s/n*i*Math.PI*2;y(v,i,o,e,d),y(v+.01,i,o,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),p=t*Math.sin(i);u.x=d.x+(o*g.x+p*f.x),u.y=d.y+(o*g.y+p*f.y),u.z=d.z+(o*g.z+p*f.z),a.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(s/n),c.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;s.push(n,i,a),s.push(i,o,a)}function y(e,t,n,r,i){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new un(a,3)),this.setAttribute("normal",new un(l,3)),this.setAttribute("uv",new un(c,2))}static fromJSON(e){return new gl(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class yl extends wn{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Ae,a=new Ae,l=new ge;let c=new Ae;const u=[],h=[],d=[],p=[];function f(i){c=e.getPointAt(i/t,c);const l=o.normals[i],d=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+i*d.x,a.y=o*l.y+i*d.y,a.z=o*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new un(u,3)),this.setAttribute("normal",new un(h,3)),this.setAttribute("uv",new un(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new yl((new Pa[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class vl extends wn{constructor(e){if(super(),this.type="WireframeGeometry",!0===e.isGeometry)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const t=[],n=new Set,r=new Ae,i=new Ae;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let a=0;a<3;a++){const l=s.getX(e+a),c=s.getX(e+(a+1)%3);r.fromBufferAttribute(o,l),i.fromBufferAttribute(o,c),!0===_l(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let s=0;s<3;s++){const a=3*e+s,l=3*e+(s+1)%3;r.fromBufferAttribute(o,a),i.fromBufferAttribute(o,l),!0===_l(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new un(t,3))}}function _l(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r,i),!0)}var xl=Object.freeze({__proto__:null,BoxGeometry:Vn,BoxBufferGeometry:Vn,CircleGeometry:ta,CircleBufferGeometry:ta,ConeGeometry:ra,ConeBufferGeometry:ra,CylinderGeometry:na,CylinderBufferGeometry:na,DodecahedronGeometry:oa,DodecahedronBufferGeometry:oa,EdgesGeometry:ua,ExtrudeGeometry:il,ExtrudeBufferGeometry:il,IcosahedronGeometry:sl,IcosahedronBufferGeometry:sl,LatheGeometry:al,LatheBufferGeometry:al,OctahedronGeometry:ll,OctahedronBufferGeometry:ll,ParametricGeometry:cl,ParametricBufferGeometry:cl,PlaneGeometry:lr,PlaneBufferGeometry:lr,PolyhedronGeometry:ia,PolyhedronBufferGeometry:ia,RingGeometry:ul,RingBufferGeometry:ul,ShapeGeometry:hl,ShapeBufferGeometry:hl,SphereGeometry:dl,SphereBufferGeometry:dl,TetrahedronGeometry:pl,TetrahedronBufferGeometry:pl,TextGeometry:fl,TextBufferGeometry:fl,TorusGeometry:ml,TorusBufferGeometry:ml,TorusKnotGeometry:gl,TorusKnotBufferGeometry:gl,TubeGeometry:yl,TubeBufferGeometry:yl,WireframeGeometry:vl});class bl extends Gt{constructor(e){super(),this.type="ShadowMaterial",this.color=new Yt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}bl.prototype.isShadowMaterial=!0;class wl extends Gt{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Yt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}wl.prototype.isMeshStandardMaterial=!0;class Sl extends wl{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ge(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ce(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenTint=new Yt(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new Yt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new Yt(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}Sl.prototype.isMeshPhysicalMaterial=!0;class Ml extends Gt{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Yt(16777215),this.specular=new Yt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Ml.prototype.isMeshPhongMaterial=!0;class El extends Gt{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Yt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}El.prototype.isMeshToonMaterial=!0;class Tl extends Gt{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Tl.prototype.isMeshNormalMaterial=!0;class Cl extends Gt{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Cl.prototype.isMeshLambertMaterial=!0;class Al extends Gt{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Yt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Al.prototype.isMeshMatcapMaterial=!0;class Il extends Ds{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Il.prototype.isLineDashedMaterial=!0;var Pl=Object.freeze({__proto__:null,ShadowMaterial:bl,SpriteMaterial:Ko,RawShaderMaterial:_r,ShaderMaterial:Wn,PointsMaterial:Hs,MeshPhysicalMaterial:Sl,MeshStandardMaterial:wl,MeshPhongMaterial:Ml,MeshToonMaterial:El,MeshNormalMaterial:Tl,MeshLambertMaterial:Cl,MeshDepthMaterial:Ro,MeshDistanceMaterial:Lo,MeshBasicMaterial:Kt,MeshMatcapMaterial:Al,LineDashedMaterial:Il,LineBasicMaterial:Ds,Material:Gt});const Rl={arraySlice:function(e,t,n){return Rl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){l.push(t.times[e]);for(let n=0;n<a;++n)c.push(t.values[e*a+n])}}0!==l.length&&(t.times=Rl.convertArray(l,t.times.constructor),t.values=Rl.convertArray(c,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);const h=r.times.length-1;let d;if(o<=r.times[0]){const e=a,t=l-a;d=Rl.arraySlice(r.values,e,t)}else if(o>=r.times[h]){const e=h*l+a,t=e+l-a;d=Rl.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=l-a;e.evaluate(o),d=Rl.arraySlice(e.resultBuffer,t,n)}"quaternion"===i&&(new Ce).fromArray(d).normalize().conjugate().toArray(d);const p=s.times.length;for(let e=0;e<p;++e){const t=e*u+c;if("quaternion"===i)Ce.multiplyQuaternionsFlat(s.values,t,d,0,s.values,t);else{const e=u-2*c;for(let n=0;n<e;++n)s.values[t+n]-=d[n]}}}return e.blendMode=Z,e}};class Ll{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Ll.prototype.beforeStart_=Ll.prototype.copySampleValue_,Ll.prototype.afterEnd_=Ll.prototype.copySampleValue_;class Dl extends Ll{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:V,endingEnd:V}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case G:i=e,s=2*t-n;break;case H:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case G:o=e,a=2*n-t;break;case H:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=o*c}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*o[c+e]+y*o[l+e]+v*o[a+e]+_*o[u+e];return i}}class Ol extends Ll{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==s;++e)i[e]=o[l+e]*u+o[a+e]*c;return i}}class Nl extends Ll{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class kl{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Rl.convertArray(t,this.TimeBufferType),this.values=Rl.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Rl.convertArray(e.times,Array),values:Rl.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Nl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ol(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Dl(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case B:t=this.InterpolantFactoryMethodDiscrete;break;case U:t=this.InterpolantFactoryMethodLinear;break;case j:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return B;case this.InterpolantFactoryMethodLinear:return U;case this.InterpolantFactoryMethodSmooth:return j}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=Rl.arraySlice(n,i,o),this.values=Rl.arraySlice(this.values,i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&Rl.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=Rl.arraySlice(this.times),t=Rl.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===j,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=Rl.arraySlice(e,0,o),this.values=Rl.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Rl.arraySlice(this.times,0),t=Rl.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}kl.prototype.TimeBufferType=Float32Array,kl.prototype.ValueBufferType=Float32Array,kl.prototype.DefaultInterpolation=U;class Fl extends kl{}Fl.prototype.ValueTypeName="bool",Fl.prototype.ValueBufferType=Array,Fl.prototype.DefaultInterpolation=B,Fl.prototype.InterpolantFactoryMethodLinear=void 0,Fl.prototype.InterpolantFactoryMethodSmooth=void 0;class zl extends kl{}zl.prototype.ValueTypeName="color";class Bl extends kl{}Bl.prototype.ValueTypeName="number";class Ul extends Ll{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let l=e*s;for(let e=l+s;l!==e;l+=4)Ce.slerpFlat(i,0,o,l-s,o,l,a);return i}}class jl extends kl{InterpolantFactoryMethodLinear(e){return new Ul(this.times,this.values,this.getValueSize(),e)}}jl.prototype.ValueTypeName="quaternion",jl.prototype.DefaultInterpolation=U,jl.prototype.InterpolantFactoryMethodSmooth=void 0;class Vl extends kl{}Vl.prototype.ValueTypeName="string",Vl.prototype.ValueBufferType=Array,Vl.prototype.DefaultInterpolation=B,Vl.prototype.InterpolantFactoryMethodLinear=void 0,Vl.prototype.InterpolantFactoryMethodSmooth=void 0;class Gl extends kl{}Gl.prototype.ValueTypeName="vector";class Hl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2500;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=le(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Zl(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(kl.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const l=Rl.getKeyframeOrder(s);s=Rl.sortedArray(s,1,l),a=Rl.sortedArray(a,1,l),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new Bl(".morphTargetInfluences["+t[e].name+"]",s,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],s=[];Rl.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new Bl(".morphTargetInfluence["+n+"]",e,o))}a=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";n(Gl,o+".position",i,"pos",r),n(jl,o+".quaternion",i,"rot",r),n(Gl,o+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,a,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Zl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Bl;case"vector":case"vector2":case"vector3":case"vector4":return Gl;case"color":return zl;case"quaternion":return jl;case"bool":case"boolean":return Fl;case"string":return Vl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];Rl.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Wl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class $l{constructor(e,t,n){const r=this;let i,o=!1,s=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==r.onStart&&r.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,a),s===a&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const ql=new $l;class Xl{constructor(e){this.manager=void 0!==e?e:ql,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Yl={};class Kl extends Xl{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Wl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0!==Yl[e])return void Yl[e].push({onLoad:t,onProgress:n,onError:r});const s=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(s){const n=s[1],o=!!s[2];let a=s[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let r;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);r="blob"===o?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(a,n);break;case"json":r=JSON.parse(a);break;default:r=a}setTimeout((function(){t&&t(r),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{Yl[e]=[],Yl[e].push({onLoad:t,onProgress:n,onError:r}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const n=this.response,r=Yl[e];if(delete Yl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Wl.add(e,n);for(let e=0,t=r.length;e<t;e++){const t=r[e];t.onLoad&&t.onLoad(n)}i.manager.itemEnd(e)}else{for(let e=0,n=r.length;e<n;e++){const n=r[e];n.onError&&n.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const n=Yl[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onProgress&&r.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const n=Yl[e];delete Yl[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const n=Yl[e];delete Yl[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return i.manager.itemStart(e),a}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Jl extends Xl{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Wl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),Wl.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){s.removeEventListener("load",a,!1),s.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class Ql extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=new Kn,o=new Jl(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}class ec extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Ss,s=new Kl(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:h,o.wrapT=void 0!==n.wrapT?n.wrapT:h,o.magFilter=void 0!==n.magFilter?n.magFilter:g,o.minFilter=void 0!==n.minFilter?n.minFilter:g,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=v),1===n.mipmapCount&&(o.minFilter=g),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}class tc extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=new be,o=new Jl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;const r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?E:T,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class nc extends ha{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ea(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){const e=n[r]-t,i=this.curves[r],o=i.getLength(),s=0===o?0:1-e/o;return i.getPointAt(s)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new Pa[n.type]).fromJSON(n))}return this}}class rc extends nc{constructor(e){super(),this.type="Path",this.currentPoint=new ge,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Ea(this.currentPoint.clone(),new ge(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Ca(this.currentPoint.clone(),new ge(e,t),new ge(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const s=new Sa(this.currentPoint.clone(),new ge(e,t),new ge(n,r),new ge(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ia(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,s,a),this}absellipse(e,t,n,r,i,o,s,a){const l=new da(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ic extends rc{constructor(e){super(e),this.uuid=le(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new rc).fromJSON(n))}return this}}class oc extends Pt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.type="Light",this.color=new Yt(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}oc.prototype.isLight=!0;class sc extends oc{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.groundColor=new Yt(t)}copy(e){return oc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}sc.prototype.isHemisphereLight=!0;const ac=new ot,lc=new Ae,cc=new Ae;class uc{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ge(512,512),this.map=null,this.mapPass=null,this.matrix=new ot,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new or,this._frameExtents=new ge(1,1),this._viewportCount=1,this._viewports=[new Se(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;lc.setFromMatrixPosition(e.matrixWorld),t.position.copy(lc),cc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(cc),t.updateMatrixWorld(),ac.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ac),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class hc extends uc{constructor(){super(new qn(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*ae*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}hc.prototype.isSpotLightShadow=!0;class dc extends oc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(e,t),this.type="SpotLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new hc}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}dc.prototype.isSpotLight=!0;const pc=new ot,fc=new Ae,mc=new Ae;class gc extends uc{constructor(){super(new qn(90,1,.5,500)),this._frameExtents=new ge(4,2),this._viewportCount=6,this._viewports=[new Se(2,1,1,1),new Se(0,1,1,1),new Se(3,1,1,1),new Se(1,1,1,1),new Se(3,0,1,1),new Se(1,0,1,1)],this._cubeDirections=[new Ae(1,0,0),new Ae(-1,0,0),new Ae(0,0,1),new Ae(0,0,-1),new Ae(0,1,0),new Ae(0,-1,0)],this._cubeUps=[new Ae(0,1,0),new Ae(0,1,0),new Ae(0,1,0),new Ae(0,1,0),new Ae(0,0,1),new Ae(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),fc.setFromMatrixPosition(e.matrixWorld),n.position.copy(fc),mc.copy(n.position),mc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(mc),n.updateMatrixWorld(),r.makeTranslation(-fc.x,-fc.y,-fc.z),pc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pc)}}gc.prototype.isPointLightShadow=!0;class yc extends oc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new gc}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}yc.prototype.isPointLight=!0;class vc extends uc{constructor(){super(new vr(-5,5,5,-5,.5,500))}}vc.prototype.isDirectionalLightShadow=!0;class _c extends oc{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,this.shadow=new vc}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}_c.prototype.isDirectionalLight=!0;class xc extends oc{constructor(e,t){super(e,t),this.type="AmbientLight"}}xc.prototype.isAmbientLight=!0;class bc extends oc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}bc.prototype.isRectAreaLight=!0;class wc{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ae)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}wc.prototype.isSphericalHarmonics3=!0;class Sc extends oc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new wc;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Sc.prototype.isLightProbe=!0;class Mc extends Xl{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,o=new Kl(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=new Pl[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheenTint&&(r.sheenTint=(new Yt).setHex(e.sheenTint)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularTint&&void 0!==r.specularTint&&r.specularTint.setHex(e.specularTint),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationTint&&void 0!==r.attenuationTint&&r.attenuationTint.setHex(e.attenuationTint),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.format&&(r.format=e.format),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Yt).setHex(i.value);break;case"v2":r.uniforms[t].value=(new ge).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new Ae).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new Se).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new ye).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new ot).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new ge).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularTintMap&&(r.specularTintMap=n(e.specularTintMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new ge).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),r}setTextures(e){return this.textures=e,this}}class Ec{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class Tc extends wn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Tc.prototype.isInstancedBufferGeometry=!0;class Cc extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Kl(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=fn(i.type,o),a=new qo(s,i.stride);return a.uuid=i.uuid,t[r]=a,a}const i=e.isInstancedBufferGeometry?new Tc:new wn,o=e.data.index;if(void 0!==o){const e=fn(o.type,o.array);i.setIndex(new en(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);o=new Yo(t,n.itemSize,n.offset,n.normalized)}else{const e=fn(n.type,n.array);o=new(n.isInstancedBufferAttribute?Cs:en)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);s=new Yo(t,i.itemSize,i.offset,i.normalized)}else{const e=fn(i.type,i.array);s=new en(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Ae;void 0!==c.center&&e.fromArray(c.center),i.boundingSphere=new Ye(e,c.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const Ac={UVMapping:r,CubeReflectionMapping:i,CubeRefractionMapping:o,EquirectangularReflectionMapping:s,EquirectangularRefractionMapping:a,CubeUVReflectionMapping:l,CubeUVRefractionMapping:c},Ic={RepeatWrapping:u,ClampToEdgeWrapping:h,MirroredRepeatWrapping:d},Pc={NearestFilter:p,NearestMipmapNearestFilter:f,NearestMipmapLinearFilter:m,LinearFilter:g,LinearMipmapNearestFilter:y,LinearMipmapLinearFilter:v};class Rc extends Xl{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=Wl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){Wl.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}Rc.prototype.isImageBitmapLoader=!0;class Lc{constructor(){this.type="ShapePath",this.color=new Yt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new rc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new ic;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],s=t[o],a=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[o],a=-a,s=t[i],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const i=tl.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,l;const c=[];if(1===o.length)return a=o[0],l=new ic,l.curves=a.curves,c.push(l),c;let u=!i(o[0].getPoints());u=e?!u:u;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],p=a.getPoints(),s=i(p),s=e?!s:s,s?(!u&&d[g]&&g++,d[g]={s:new ic,p},d[g].s.curves=a.curves,u&&g++,m[g]=[]):m[g].push({h:a,p:p[0]});if(!d[0])return n(o);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,i=d.length;n<i;n++){const i=m[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<d.length;i++)r(s.p,d[i].p)&&(n!==i&&t.push({froms:n,tos:i,hole:o}),a?(a=!1,h[i].push(s)):e=!0);a&&h[n].push(s)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,c.push(l),f=m[e];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return c}}class Dc{constructor(e){this.type="Font",this.data=e}generateShapes(e){const t=[],n=function(e,t,n){const r=Array.from(e),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[];let a=0,l=0;for(let e=0;e<r.length;e++){const t=r[e];if("\n"===t)a=0,l-=o;else{const e=Oc(t,i,a,l,n);a+=e.offsetX,s.push(e.path)}}return s}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,this.data);for(let e=0,r=n.length;e<r;e++)Array.prototype.push.apply(t,n[e].toShapes());return t}}function Oc(e,t,n,r,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const s=new Lc;let a,l,c,u,h,d,p,f;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;)switch(e[i++]){case"m":a=e[i++]*t+n,l=e[i++]*t+r,s.moveTo(a,l);break;case"l":a=e[i++]*t+n,l=e[i++]*t+r,s.lineTo(a,l);break;case"q":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,s.quadraticCurveTo(h,d,c,u);break;case"b":c=e[i++]*t+n,u=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,p=e[i++]*t+n,f=e[i++]*t+r,s.bezierCurveTo(h,d,p,f,c,u)}}return{offsetX:o.ha*t,path:s}}let Nc;Dc.prototype.isFont=!0;const kc={getContext:function(){return void 0===Nc&&(Nc=new(window.AudioContext||window.webkitAudioContext)),Nc},setContext:function(e){Nc=e}};class Fc extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Kl(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);kc.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class zc extends Sc{constructor(e,t){super(void 0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);const n=(new Yt).set(e),r=(new Yt).set(t),i=new Ae(n.r,n.g,n.b),o=new Ae(r.r,r.g,r.b),s=Math.sqrt(Math.PI),a=s*Math.sqrt(.75);this.sh.coefficients[0].copy(i).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(i).sub(o).multiplyScalar(a)}}zc.prototype.isHemisphereLightProbe=!0;class Bc extends Sc{constructor(e){super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);const t=(new Yt).set(e);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Bc.prototype.isAmbientLightProbe=!0;const Uc=new ot,jc=new ot;class Vc{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Gc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Gc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Gc(){return("undefined"==typeof performance?Date:performance).now()}const Hc=new Ae,Zc=new Ce,Wc=new Ae,$c=new Ae;class qc extends Pt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Xc=new Ae,Yc=new Ce,Kc=new Ae,Jc=new Ae;class Qc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class eu{constructor(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){Ce.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;Ce.multiplyQuaternionsFlat(e,o,e,t,e,n),Ce.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}}const tu=new RegExp("[\\[\\]\\.:\\/]","g"),nu="[^\\[\\]\\.:\\/]",ru="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",iu=/((?:WC+[\/:])*)/.source.replace("WC",nu),ou=/(WCOD+)?/.source.replace("WCOD",ru),su=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nu),au=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nu),lu=new RegExp("^"+iu+ou+su+au+"$"),cu=["material","materials","bones"];class uu{constructor(e,t,n){this.path=t,this.parsedPath=n||uu.parseTrackName(t),this.node=uu.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new uu.Composite(e,t,n):new uu(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tu,"")}static parseTrackName(e){const t=lu.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==cu.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=uu.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}uu.Composite=class{constructor(e,t,n){const r=n||uu.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},uu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},uu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},uu.prototype.GetterByBindingType=[uu.prototype._getValue_direct,uu.prototype._getValue_array,uu.prototype._getValue_arrayElement,uu.prototype._getValue_toArray],uu.prototype.SetterByBindingTypeAndVersioning=[[uu.prototype._setValue_direct,uu.prototype._setValue_direct_setNeedsUpdate,uu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_array,uu.prototype._setValue_array_setNeedsUpdate,uu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_arrayElement,uu.prototype._setValue_arrayElement_setNeedsUpdate,uu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[uu.prototype._setValue_fromArray,uu.prototype._setValue_fromArray_setNeedsUpdate,uu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class hu{constructor(){this.uuid=le(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s,a=e.length,l=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const u=arguments[c],h=u.uuid;let d=t[h];if(void 0===d){d=a++,t[h]=d,e.push(u);for(let e=0,t=o;e!==t;++e)i[e].push(new uu(u,n[e],r[e]))}else if(d<l){s=e[d];const a=--l,c=e[a];t[c.uuid]=d,e[d]=c,t[h]=a,e[a]=u;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[d];t[d]=o,void 0===s&&(s=new uu(u,n[e],r[e])),t[a]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,l=t[a];if(void 0!==l&&l>=i){const o=i++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[l];t[l]=r,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<i){const s=--i,a=e[s],c=--o,u=e[c];t[a.uuid]=l,e[l]=a,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[c];t[l]=r,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(u);for(let n=c,r=a.length;n!==r;++n){const r=a[n];u[n]=new uu(r,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}hu.prototype.isAnimationObjectGroup=!0;class du{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:V,endingEnd:V};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,l=s.sampleValues;return a[0]=i,a[1]=i+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Z)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=2202===n;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=G,r.endingEnd=G):(r.endingStart=e?this.zeroSlopeAtStart?G:V:H,r.endingEnd=t?this.zeroSlopeAtEnd?G:V:H)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}class pu extends re{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let u=c[l];if(void 0!==u)o[e]=u;else{if(u=o[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;u=new eu(uu.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,l),o[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Ol(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?Hl.findByName(r,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new du(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,s,i),c}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?Hl.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(r,e,i,o);const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}pu.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class fu{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new fu(void 0===this.value.clone?this.value:this.value.clone())}}class mu extends qo{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}mu.prototype.isInstancedInterleavedBuffer=!0;class gu{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}function yu(e,t){return e.distance-t.distance}function vu(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)vu(r[e],t,n,!0)}}gu.prototype.isGLBufferAttribute=!0;const _u=new ge;class xu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ge(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ge(-1/0,-1/0);this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=_u.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return _u.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}xu.prototype.isBox2=!0;const bu=new Ae,wu=new Ae;class Su{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){bu.subVectors(e,this.start),wu.subVectors(this.end,this.start);const n=wu.dot(wu);let r=wu.dot(bu)/n;return t&&(r=ce(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class Mu extends Pt{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}Mu.prototype.isImmediateRenderObject=!0;const Eu=new Ae,Tu=new Ae,Cu=new ot,Au=new ot;class Iu extends Vs{constructor(e){const t=Pu(e),n=new wn,r=[],i=[],o=new Yt(0,0,1),s=new Yt(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new un(r,3)),n.setAttribute("color",new un(i,3)),super(n,new Ds({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Au.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Cu.multiplyMatrices(Au,i.matrixWorld),Tu.setFromMatrixPosition(Cu),r.setXYZ(n,Tu.x,Tu.y,Tu.z),Cu.multiplyMatrices(Au,i.parent.matrixWorld),Tu.setFromMatrixPosition(Cu),r.setXYZ(n+1,Tu.x,Tu.y,Tu.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Pu(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Pu(e.children[n]));return t}const Ru=new Ae,Lu=new Yt,Du=new Yt;class Ou extends Vs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new Yt(n),r=new Yt(r);const i=t/2,o=e/t,s=e/2,a=[],l=[];for(let e=0,c=0,u=-s;e<=t;e++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);const t=e===i?n:r;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new wn;c.setAttribute("position",new un(a,3)),c.setAttribute("color",new un(l,3)),super(c,new Ds({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Nu=new Ae,ku=new Ae,Fu=new Ae,zu=new Ae,Bu=new $n;function Uu(e,t,n,r,i,o,s){zu.set(i,o,s).unproject(r);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],zu.x,zu.y,zu.z)}}const ju=new Re;class Vu extends Vs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new wn;i.setIndex(new en(n,1)),i.setAttribute("position",new en(r,3)),super(i,new Ds({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ju.setFromObject(this.object),ju.isEmpty())return;const t=ju.min,n=ju.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Vs.prototype.copy.call(this,e),this.object=e.object,this}}const Gu=new Ae;let Hu,Zu;class Wu extends Vs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new wn;n.setAttribute("position",new un(t,3)),n.setAttribute("color",new un([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new Ds({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Yt,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const $u=new Float32Array(1),qu=new Int32Array($u.buffer);ha.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(ha.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},rc.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},Ou.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Iu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Xl.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ec.extractUrlBase(e)},Xl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},xu.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},xu.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},xu.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},xu.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Re.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Re.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Re.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Re.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Re.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Ye.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},or.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Su.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},ye.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},ye.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ye.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ye.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},ye.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ye.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},ot.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},ot.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},ot.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Ae).setFromMatrixColumn(this,3)},ot.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},ot.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},ot.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ot.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ot.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},ot.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},ot.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ot.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},ot.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},ot.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},ot.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},ot.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},ot.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},ot.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},ot.prototype.makeFrustum=function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},ot.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},nr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Ce.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Ce.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},it.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},it.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},it.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},jt.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},jt.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},jt.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},jt.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},jt.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},jt.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),jt.getBarycoord(e,t,n,r,i)},jt.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),jt.getNormal(e,t,n,r)},ic.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},ic.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new il(this,e)},ic.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new hl(this,e)},ge.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},ge.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},ge.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ae.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Ae.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Ae.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Ae.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Ae.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Ae.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Ae.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Ae.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Ae.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Se.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Se.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Pt.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Pt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Pt.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Pt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Pt.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Pt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Un.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Un.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),bs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},qn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(oc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(en.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===te},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(te)}}}),en.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?te:ee),this},en.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},en.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},wn.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},wn.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new en(arguments[1],arguments[2])))},wn.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},wn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},wn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},wn.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},wn.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(wn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),qo.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?te:ee),this},qo.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},il.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},il.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},il.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},$o.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},fu.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Gt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Yt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Wn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Go.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Go.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Go.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Go.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Go.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Go.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Go.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Go.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Go.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Go.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Go.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Go.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Go.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Go.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Go.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Go.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Go.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Go.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Go.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Go.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Go.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Go.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Go.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Go.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Go.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Go.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?$:W}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Do.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Me.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),qc.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Fc).load(e,(function(e){t.setBuffer(e)})),this},Qc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Yn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Yn.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},_e.crossOrigin=void 0,_e.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new tc;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},_e.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Ql;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},_e.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},_e.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Xu={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t),e.ACESFilmicToneMapping=4,e.AddEquation=n,e.AddOperation=2,e.AdditiveAnimationBlendMode=Z,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=xc,e.AmbientLightProbe=Bc,e.AnimationClip=Hl,e.AnimationLoader=class extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Kl(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=Hl.parse(e[n]);t.push(r)}return t}},e.AnimationMixer=pu,e.AnimationObjectGroup=hu,e.AnimationUtils=Rl,e.ArcCurve=pa,e.ArrayCamera=Fo,e.ArrowHelper=class extends Pt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ae(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ae(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*i;super(),this.type="ArrowHelper",void 0===Hu&&(Hu=new wn,Hu.setAttribute("position",new un([0,0,0,0,1,0],3)),Zu=new na(0,.5,1,5,1),Zu.translate(0,-.5,0)),this.position.copy(t),this.line=new Bs(Hu,new Ds({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Un(Zu,new Kt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Gu.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Gu,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},e.Audio=qc,e.AudioAnalyser=Qc,e.AudioContext=kc,e.AudioListener=class extends Pt{constructor(){super(),this.type="AudioListener",this.context=kc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Vc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Hc,Zc,Wc),$c.set(0,0,-1).applyQuaternion(Zc),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Hc.x,e),t.positionY.linearRampToValueAtTime(Hc.y,e),t.positionZ.linearRampToValueAtTime(Hc.z,e),t.forwardX.linearRampToValueAtTime($c.x,e),t.forwardY.linearRampToValueAtTime($c.y,e),t.forwardZ.linearRampToValueAtTime($c.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Hc.x,Hc.y,Hc.z),t.setOrientation($c.x,$c.y,$c.z,n.x,n.y,n.z)}},e.AudioLoader=Fc,e.AxesHelper=Wu,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Wu(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ec(e)},e.Bone=ws,e.BooleanKeyframeTrack=Fl,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Vu(e,t)},e.Box2=xu,e.Box3=Re,e.Box3Helper=class extends Vs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new wn;r.setIndex(new en(n,1)),r.setAttribute("position",new un([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Ds({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},e.BoxBufferGeometry=Vn,e.BoxGeometry=Vn,e.BoxHelper=Vu,e.BufferAttribute=en,e.BufferGeometry=wn,e.BufferGeometryLoader=Cc,e.ByteType=1010,e.Cache=Wl,e.Camera=$n,e.CameraHelper=class extends Vs{constructor(e){const t=new wn,n=new Ds({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new Yt(16755200),a=new Yt(16711680),l=new Yt(43775),c=new Yt(16777215),u=new Yt(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),t.setAttribute("position",new un(r,3)),t.setAttribute("color",new un(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Bu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Uu("c",t,e,Bu,0,0,-1),Uu("t",t,e,Bu,0,0,1),Uu("n1",t,e,Bu,-1,-1,-1),Uu("n2",t,e,Bu,1,-1,-1),Uu("n3",t,e,Bu,-1,1,-1),Uu("n4",t,e,Bu,1,1,-1),Uu("f1",t,e,Bu,-1,-1,1),Uu("f2",t,e,Bu,1,-1,1),Uu("f3",t,e,Bu,-1,1,1),Uu("f4",t,e,Bu,1,1,1),Uu("u1",t,e,Bu,.7,1.1,-1),Uu("u2",t,e,Bu,-.7,1.1,-1),Uu("u3",t,e,Bu,0,2,-1),Uu("cf1",t,e,Bu,-1,0,1),Uu("cf2",t,e,Bu,1,0,1),Uu("cf3",t,e,Bu,0,-1,1),Uu("cf4",t,e,Bu,0,1,1),Uu("cn1",t,e,Bu,-1,0,-1),Uu("cn2",t,e,Bu,1,0,-1),Uu("cn3",t,e,Bu,0,-1,-1),Uu("cn4",t,e,Bu,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=Qs,e.CatmullRomCurve3=_a,e.CineonToneMapping=3,e.CircleBufferGeometry=ta,e.CircleGeometry=ta,e.ClampToEdgeWrapping=h,e.Clock=Vc,e.Color=Yt,e.ColorKeyframeTrack=zl,e.CompressedTexture=Js,e.CompressedTextureLoader=class extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=[],s=new Js,a=new Kl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const n=i.parse(e,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=g),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)c(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=g),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}},e.ConeBufferGeometry=ra,e.ConeGeometry=ra,e.CubeCamera=Yn,e.CubeReflectionMapping=i,e.CubeRefractionMapping=o,e.CubeTexture=Kn,e.CubeTextureLoader=Ql,e.CubeUVReflectionMapping=l,e.CubeUVRefractionMapping=c,e.CubicBezierCurve=Sa,e.CubicBezierCurve3=Ma,e.CubicInterpolant=Dl,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=ha,e.CurvePath=nc,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=na,e.CylinderGeometry=na,e.Cylindrical=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},e.DataTexture=Ss,e.DataTexture2DArray=qr,e.DataTexture3D=Xr,e.DataTextureLoader=ec,e.DataUtils=class{static toHalfFloat(e){$u[0]=e;const t=qu[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=ql,e.DepthFormat=C,e.DepthStencilFormat=A,e.DepthTexture=ea,e.DirectionalLight=_c,e.DirectionalLightHelper=class extends Pt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new wn;r.setAttribute("position",new un([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new Ds({fog:!1,toneMapped:!1});this.lightPlane=new Bs(r,i),this.add(this.lightPlane),r=new wn,r.setAttribute("position",new un([0,0,0,0,0,1],3)),this.targetLine=new Bs(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Nu.setFromMatrixPosition(this.light.matrixWorld),ku.setFromMatrixPosition(this.light.target.matrixWorld),Fu.subVectors(ku,Nu),this.lightPlane.lookAt(ku),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ku),this.targetLine.scale.z=Fu.length()}},e.DiscreteInterpolant=Nl,e.DodecahedronBufferGeometry=oa,e.DodecahedronGeometry=oa,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new en(e,t).setUsage(te)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=te,e.DynamicReadUsage=35049,e.EdgesGeometry=ua,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Vs(new ua(e.geometry),new Ds({color:void 0!==t?t:16777215}))},e.EllipseCurve=da,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=s,e.EquirectangularRefractionMapping=a,e.Euler=mt,e.EventDispatcher=re,e.ExtrudeBufferGeometry=il,e.ExtrudeGeometry=il,e.FaceColors=1,e.FileLoader=Kl,e.FlatShading=1,e.Float16BufferAttribute=cn,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new un(e,t)},e.Float32BufferAttribute=un,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new hn(e,t)},e.Float64BufferAttribute=hn,e.FloatType=w,e.Fog=Wo,e.FogExp2=Zo,e.Font=Dc,e.FontLoader=class extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Kl(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const r=i.parse(n);t&&t(r)}),n,r)}parse(e){return new Dc(e)}},e.FrontSide=0,e.Frustum=or,e.GLBufferAttribute=gu,e.GLSL1="100",e.GLSL3=ne,e.GammaEncoding=q,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Ou,e.Group=zo,e.HalfFloatType=S,e.HemisphereLight=sc,e.HemisphereLightHelper=class extends Pt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new ll(t);r.rotateY(.5*Math.PI),this.material=new Kt({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new en(o,3)),this.add(new Un(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Lu.copy(this.light.color),Du.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?Lu:Du;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Ru.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.HemisphereLightProbe=zc,e.IcosahedronBufferGeometry=sl,e.IcosahedronGeometry=sl,e.ImageBitmapLoader=Rc,e.ImageLoader=Jl,e.ImageUtils=_e,e.ImmediateRenderObject=Mu,e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Cs,e.InstancedBufferGeometry=Tc,e.InstancedInterleavedBuffer=mu,e.InstancedMesh=Ls,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new on(e,t)},e.Int16BufferAttribute=on,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new an(e,t)},e.Int32BufferAttribute=an,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new tn(e,t)},e.Int8BufferAttribute=tn,e.IntType=1013,e.InterleavedBuffer=qo,e.InterleavedBufferAttribute=Yo,e.Interpolant=Ll,e.InterpolateDiscrete=B,e.InterpolateLinear=U,e.InterpolateSmooth=j,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=Q,e.KeyframeTrack=kl,e.LOD=ms,e.LatheBufferGeometry=al,e.LatheGeometry=al,e.Layers=gt,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=oc,e.LightProbe=Sc,e.Line=Bs,e.Line3=Su,e.LineBasicMaterial=Ds,e.LineCurve=Ea,e.LineCurve3=Ta,e.LineDashedMaterial=Il,e.LineLoop=Gs,e.LinePieces=1,e.LineSegments=Vs,e.LineStrip=0,e.LinearEncoding=W,e.LinearFilter=g,e.LinearInterpolant=Ol,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=v,e.LinearMipmapNearestFilter=y,e.LinearToneMapping=1,e.Loader=Xl,e.LoaderUtils=Ec,e.LoadingManager=$l,e.LogLuvEncoding=3003,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=Gt,e.MaterialLoader=Mc,e.Math=me,e.MathUtils=me,e.Matrix3=ye,e.Matrix4=ot,e.MaxEquation=104,e.Mesh=Un,e.MeshBasicMaterial=Kt,e.MeshDepthMaterial=Ro,e.MeshDistanceMaterial=Lo,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=Cl,e.MeshMatcapMaterial=Al,e.MeshNormalMaterial=Tl,e.MeshPhongMaterial=Ml,e.MeshPhysicalMaterial=Sl,e.MeshStandardMaterial=wl,e.MeshToonMaterial=El,e.MinEquation=103,e.MirroredRepeatWrapping=d,e.MixOperation=1,e.MultiMaterial=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=p,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=m,e.NearestMipmapNearestFilter=f,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=2500,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=Bl,e.Object3D=Pt,e.ObjectLoader=class extends Xl{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===this.path?Ec.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new Kl(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}async loadAsync(e,t){const n=""===this.path?Ec.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new Kl(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),o=JSON.parse(i),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,a,s,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,r,s,o,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new ic).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Ts).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new Cc;for(let i=0,o=e.length;i<o;i++){let o;const s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in xl?o=xl[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new Mc;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=Hl.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:fn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new $l(t);i=new Jl(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){r[n.uuid]=[];for(let e=0,t=i.length;e<t;e++){const t=o(i[e]);null!==t&&(t instanceof HTMLImageElement?r[n.uuid].push(t):r[n.uuid].push(new Ss(t.data,t.width,t.height)))}}else{const e=o(n.url);null!==e&&(r[n.uuid]=e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:fn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Jl(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.url;if(Array.isArray(o)){n[r.uuid]=[];for(let e=0,t=o.length;e<t;e++){const t=o[e],s=await i(t);null!==s&&(s instanceof HTMLImageElement?n[r.uuid].push(s):n[r.uuid].push(new Ss(s.data,s.width,s.height)))}}else{const e=await i(r.url);null!==e&&(n[r.uuid]=e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];let s;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=t[o.image];Array.isArray(a)?(s=new Kn(a),6===a.length&&(s.needsUpdate=!0)):(s=a&&a.data?new Ss(a.data,a.width,a.height):new be(a),a&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,Ac)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],Ic),s.wrapT=n(o.wrap[1],Ic)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,Pc)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,Pc)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}parseObject(e,t,n,r,i){let o,s,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new $o,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Yt(e.background):o.background=u(e.background)),void 0!==e.environment&&(o.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new Wo(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Zo(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new qn(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new vr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new xc(e.color,e.intensity);break;case"DirectionalLight":o=new _c(e.color,e.intensity);break;case"PointLight":o=new yc(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new bc(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new dc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new sc(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new Sc).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),a=c(e.material),o=new bs(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),a=c(e.material),o=new Un(s,a);break;case"InstancedMesh":s=l(e.geometry),a=c(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;o=new Ls(s,a,t),o.instanceMatrix=new Cs(new Float32Array(n.array),16),void 0!==r&&(o.instanceColor=new Cs(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new ms;break;case"Line":o=new Bs(l(e.geometry),c(e.material));break;case"LineLoop":o=new Gs(l(e.geometry),c(e.material));break;case"LineSegments":o=new Vs(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new Xs(l(e.geometry),c(e.material));break;case"Sprite":o=new hs(c(e.material));break;case"Group":o=new zo;break;case"Bone":o=new ws;break;default:o=new Pt}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=o.getObjectByProperty("uuid",n.object);void 0!==r&&o.addLevel(r,n.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=ll,e.OctahedronGeometry=ll,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=vr,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=Dr,e.ParametricBufferGeometry=cl,e.ParametricGeometry=cl,e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new hs(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Hs(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Xs(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Hs(e)},e.Path=rc,e.PerspectiveCamera=qn,e.Plane=nr,e.PlaneBufferGeometry=lr,e.PlaneGeometry=lr,e.PlaneHelper=class extends Bs{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,r=new wn;r.setAttribute("position",new un([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Ds({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const i=new wn;i.setAttribute("position",new un([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),i.computeBoundingSphere(),this.add(new Un(i,new Kt({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Xs(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Hs(e)},e.PointLight=yc,e.PointLightHelper=class extends Un{constructor(e,t,n){super(new dl(t,4,2),new Kt({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=Xs,e.PointsMaterial=Hs,e.PolarGridHelper=class extends Vs{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;i=new Yt(i),o=new Yt(o);const s=[],a=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,c=Math.cos(r)*e;s.push(0,0,0),s.push(l,0,c);const u=1&n?i:o;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let t=0;t<=n;t++){const l=1&t?i:o,c=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c;s.push(n,0,i),a.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*c,i=Math.cos(t)*c,s.push(n,0,i),a.push(l.r,l.g,l.b)}}const l=new wn;l.setAttribute("position",new un(s,3)),l.setAttribute("color",new un(a,3)),super(l,new Ds({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=ia,e.PolyhedronGeometry=ia,e.PositionalAudio=class extends qc{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Xc,Yc,Kc),Jc.set(0,0,1).applyQuaternion(Yc);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Xc.x,e),t.positionY.linearRampToValueAtTime(Xc.y,e),t.positionZ.linearRampToValueAtTime(Xc.z,e),t.orientationX.linearRampToValueAtTime(Jc.x,e),t.orientationY.linearRampToValueAtTime(Jc.y,e),t.orientationZ.linearRampToValueAtTime(Jc.z,e)}else t.setPosition(Xc.x,Xc.y,Xc.z),t.setOrientation(Jc.x,Jc.y,Jc.z)}},e.PropertyBinding=uu,e.PropertyMixer=eu,e.QuadraticBezierCurve=Ca,e.QuadraticBezierCurve3=Aa,e.Quaternion=Ce,e.QuaternionKeyframeTrack=jl,e.QuaternionLinearInterpolant=Ul,e.REVISION=t,e.RGBADepthPacking=3201,e.RGBAFormat=T,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_BPTC_Format=36492,e.RGBA_ETC2_EAC_Format=z,e.RGBA_PVRTC_2BPPV1_Format=k,e.RGBA_PVRTC_4BPPV1_Format=N,e.RGBA_S3TC_DXT1_Format=P,e.RGBA_S3TC_DXT3_Format=R,e.RGBA_S3TC_DXT5_Format=L,e.RGBDEncoding=J,e.RGBEEncoding=X,e.RGBEFormat=1023,e.RGBFormat=E,e.RGBIntegerFormat=1032,e.RGBM16Encoding=K,e.RGBM7Encoding=Y,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=F,e.RGB_PVRTC_2BPPV1_Format=O,e.RGB_PVRTC_4BPPV1_Format=D,e.RGB_S3TC_DXT1_Format=I,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=_r,e.Ray=it,e.Raycaster=class{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new it(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new gt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return vu(e,this,t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),t.sort(yu),t}intersectObjects(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let r=0,i=e.length;r<i;r++)vu(e[r],this,n,t);return n.sort(yu),n}},e.RectAreaLight=bc,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=u,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=ul,e.RingGeometry=ul,e.SRGB8_ALPHA8_ASTC_10x10_Format=37851,e.SRGB8_ALPHA8_ASTC_10x5_Format=37848,e.SRGB8_ALPHA8_ASTC_10x6_Format=37849,e.SRGB8_ALPHA8_ASTC_10x8_Format=37850,e.SRGB8_ALPHA8_ASTC_12x10_Format=37852,e.SRGB8_ALPHA8_ASTC_12x12_Format=37853,e.SRGB8_ALPHA8_ASTC_4x4_Format=37840,e.SRGB8_ALPHA8_ASTC_5x4_Format=37841,e.SRGB8_ALPHA8_ASTC_5x5_Format=37842,e.SRGB8_ALPHA8_ASTC_6x5_Format=37843,e.SRGB8_ALPHA8_ASTC_6x6_Format=37844,e.SRGB8_ALPHA8_ASTC_8x5_Format=37845,e.SRGB8_ALPHA8_ASTC_8x6_Format=37846,e.SRGB8_ALPHA8_ASTC_8x8_Format=37847,e.Scene=$o,e.SceneUtils=Xu,e.ShaderChunk=cr,e.ShaderLib=hr,e.ShaderMaterial=Wn,e.ShadowMaterial=bl,e.Shape=ic,e.ShapeBufferGeometry=hl,e.ShapeGeometry=hl,e.ShapePath=Lc,e.ShapeUtils=tl,e.ShortType=1011,e.Skeleton=Ts,e.SkeletonHelper=Iu,e.SkinnedMesh=bs,e.SmoothShading=2,e.Sphere=Ye,e.SphereBufferGeometry=dl,e.SphereGeometry=dl,e.Spherical=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ce(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=wc,e.SplineCurve=Ia,e.SpotLight=dc,e.SpotLightHelper=class extends Pt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new wn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new un(r,3));const i=new Ds({fog:!1,toneMapped:!1});this.cone=new Vs(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Eu.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Eu),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=hs,e.SpriteMaterial=Ko,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=ee,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new qn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new qn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),r=t.eyeSep/2,i=r*t.near/t.focus,o=t.near*Math.tan(se*t.fov*.5)/t.zoom;let s,a;jc.elements[12]=-r,Uc.elements[12]=r,s=-o*t.aspect+i,a=o*t.aspect+i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(n),s=-o*t.aspect-i,a=o*t.aspect-i,n.elements[0]=2*t.near/(a-s),n.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(jc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Uc)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=Vl,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=pl,e.TetrahedronGeometry=pl,e.TextBufferGeometry=fl,e.TextGeometry=fl,e.Texture=be,e.TextureLoader=tc,e.TorusBufferGeometry=ml,e.TorusGeometry=ml,e.TorusKnotBufferGeometry=gl,e.TorusKnotGeometry=gl,e.Triangle=jt,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=yl,e.TubeGeometry=yl,e.UVMapping=r,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new sn(e,t)},e.Uint16BufferAttribute=sn,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new ln(e,t)},e.Uint32BufferAttribute=ln,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new nn(e,t)},e.Uint8BufferAttribute=nn,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new rn(e,t)},e.Uint8ClampedBufferAttribute=rn,e.Uniform=fu,e.UniformsLib=ur,e.UniformsUtils=Zn,e.UnsignedByteType=_,e.UnsignedInt248Type=M,e.UnsignedIntType=b,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedShortType=x,e.VSMShadowMap=3,e.Vector2=ge,e.Vector3=Ae,e.Vector4=Se,e.VectorKeyframeTrack=Gl,e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Ae(e,t,n)},e.VertexColors=2,e.VideoTexture=Ks,e.WebGL1Renderer=Ho,e.WebGLCubeRenderTarget=Jn,e.WebGLMultipleRenderTargets=Ee,e.WebGLMultisampleRenderTarget=Te,e.WebGLRenderTarget=Me,e.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Jn(e,n)},e.WebGLRenderer=Go,e.WebGLUtils=ko,e.WireframeGeometry=vl,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Vs(new vl(e.geometry),new Ds({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=H,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Kl(e)},e.ZeroCurvatureEnding=V,e.ZeroFactor=200,e.ZeroSlopeEnding=G,e.ZeroStencilOp=0,e.sRGBEncoding=$,Object.defineProperty(e,"__esModule",{value:!0})}(t)},8604:(e,t)=>{const n=1024e3,r=.1/180*Math.PI,i=Math.atan(3/4),o=6371008.8;e.exports={WORLD_SIZE:n,PROJECTION_WORLD_SIZE:n/(o*Math.PI*2),MERCATOR_A:o,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:o,EARTH_CIRCUMFERENCE:2*Math.PI*o,EARTH_CIRCUMFERENCE_EQUATOR:40075017,FOV_ORTHO:r,FOV:i,FOV_DEGREES:180*i/Math.PI,TILE_SIZE:512}},6475:(e,t,n)=>{var r=n(4132),i=n(61),o={material:"MeshBasicMaterial",color:"black",opacity:1};e.exports=function(e){var t;function n(){return new i[o.material]({color:o.color})}return e?((t=(e=r._validate(e,o)).material&&e.material.isMaterial?e.material:e.material||e.color||e.opacity?new i[e.material]({color:e.color,transparent:e.opacity<1}):n()).opacity=e.opacity,e.side&&(t.side=e.side)):t=n(),t}},1639:(e,t)=>{!function(){"use strict";var t=Math.PI,n=Math.sin,r=Math.cos,i=Math.tan,o=Math.asin,s=Math.atan2,a=Math.acos,l=t/180,c=864e5,u=2440588,h=2451545;function d(e){return e.valueOf()/c-.5+u}function p(e){return new Date((e+.5-u)*c)}function f(e){return d(e)-h}var m=23.4397*l;function g(e,t){return s(n(e)*r(m)-i(t)*n(m),r(e))}function y(e,t){return o(n(t)*r(m)+r(t)*n(m)*n(e))}function v(e,t,o){return s(n(e),r(e)*n(t)-i(o)*r(t))}function _(e,t,i){return o(n(t)*n(i)+r(t)*r(i)*r(e))}function x(e,t){return l*(280.16+360.9856235*e)-t}function b(e){return l*(357.5291+.98560028*e)}function w(e){return e+l*(1.9148*n(e)+.02*n(2*e)+3e-4*n(3*e))+102.9372*l+t}function S(e){var t=w(b(e));return{dec:y(t,0),ra:g(t,0)}}var M={getPosition:function(e,t,n){var r=l*-n,i=l*t,o=f(e),s=S(o),a=x(o,r)-s.ra;return{azimuth:v(a,i,s.dec),altitude:_(a,i,s.dec)}},toJulian:function(e){return d(e)}},E=M.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];M.addTime=function(e,t,n){E.push([e,t,n])};var T=9e-4;function C(e,n,r){return T+(e+n)/(2*t)+r}function A(e,t,r){return h+e+.0053*n(t)-.0069*n(2*r)}function I(e,t,i,o,s,l,c){var u=function(e,t,i){return a((n(e)-n(t)*n(i))/(r(t)*r(i)))}(e,i,o);return A(C(u,t,s),l,c)}function P(e){var t=l*(134.963+13.064993*e),i=l*(93.272+13.22935*e),o=l*(218.316+13.176396*e)+6.289*l*n(t),s=5.128*l*n(i),a=385001-20905*r(t);return{ra:g(o,s),dec:y(o,s),dist:a}}function R(e,t){return new Date(e.valueOf()+t*c/24)}M.getTimes=function(e,n,r,i){var o,s,a,c,u,h=l*-r,d=l*n,m=function(e){return-2.076*Math.sqrt(e)/60}(i=i||0),g=function(e,n){return Math.round(e-T-n/(2*t))}(f(e),h),v=C(0,h,g),_=b(v),x=w(_),S=y(x,0),M=A(v,_,x),P={solarNoon:p(M),nadir:p(M-.5)};for(o=0,s=E.length;o<s;o+=1)u=M-((c=I(((a=E[o])[0]+m)*l,h,d,S,g,_,x))-M),P[a[1]]=p(u),P[a[2]]=p(c);return P},M.getMoonPosition=function(e,t,o){var a=l*-o,c=l*t,u=f(e),h=P(u),d=x(u,a)-h.ra,p=_(d,c,h.dec),m=s(n(d),i(c)*r(h.dec)-n(h.dec)*r(d));return p+=function(e){return e<0&&(e=0),2967e-7/Math.tan(e+.00312536/(e+.08901179))}(p),{azimuth:v(d,c,h.dec),altitude:p,distance:h.dist,parallacticAngle:m}},M.getMoonIllumination=function(e){var t=f(e||new Date),i=S(t),o=P(t),l=149598e3,c=a(n(i.dec)*n(o.dec)+r(i.dec)*r(o.dec)*r(i.ra-o.ra)),u=s(l*n(c),o.dist-l*r(c)),h=s(r(i.dec)*n(i.ra-o.ra),n(i.dec)*r(o.dec)-r(i.dec)*n(o.dec)*r(i.ra-o.ra));return{fraction:(1+r(u))/2,phase:.5+.5*u*(h<0?-1:1)/Math.PI,angle:h}},M.getMoonTimes=function(e,t,n,r){var i=new Date(e);r?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var o,s,a,c,u,h,d,p,f,m,g,y,v,_=.133*l,x=M.getMoonPosition(i,t,n).altitude-_,b=1;b<=24&&(o=M.getMoonPosition(R(i,b),t,n).altitude-_,p=((u=(x+(s=M.getMoonPosition(R(i,b+1),t,n).altitude-_))/2-o)*(d=-(h=(s-x)/2)/(2*u))+h)*d+o,m=0,(f=h*h-4*u*o)>=0&&(g=d-(v=Math.sqrt(f)/(2*Math.abs(u))),y=d+v,Math.abs(g)<=1&&m++,Math.abs(y)<=1&&m++,g<-1&&(g=y)),1===m?x<0?a=b+g:c=b+g:2===m&&(a=b+(p<0?y:g),c=b+(p<0?g:y)),!a||!c);b+=2)x=s;var w={};return a&&(w.rise=R(i,a)),c&&(w.set=R(i,c)),a||c||(w[p>0?"alwaysUp":"alwaysDown"]=!0),w},e.exports=M}()},4132:(e,t,n)=>{var r=n(61),i=n(8604),o={prettyPrintMatrix:function(e){for(var t=0;t<4;t++){var n=[e[t],e[t+4],e[t+8],e[t+12]];console.log(n.map((function(e){return e.toFixed(4)})))}},makePerspectiveMatrix:function(e,t,n,i){var o=new r.Matrix4,s=1/Math.tan(e/2),a=1/(n-i),l=[s/t,0,0,0,0,s,0,0,0,0,(i+n)*a,-1,0,0,2*i*n*a,0];return o.elements=l,o},makeOrthographicMatrix:function(e,t,n,i,o,s){var a=new r.Matrix4;const l=1/(t-e),c=1/(n-i),u=1/(s-o);var h=[2*l,0,0,0,0,2*c,0,0,0,0,-1*u,0,-(t+e)*l,-(n+i)*c,-o*u,1];return a.elements=h,a},radify:function(e){function t(e){return e=e||0,2*Math.PI*e/360}return"object"==typeof e?e.length>0?e.map((function(e){return t(e)})):[t(e.x),t(e.y),t(e.z)]:t(e)},degreeify:function(e){function t(e){return 360*(e=e||0)/(2*Math.PI)}return"object"==typeof e?[t(e.x),t(e.y),t(e.z)]:t(e)},projectToWorld:function(e){var t=[-i.MERCATOR_A*i.DEG2RAD*e[0]*i.PROJECTION_WORLD_SIZE,-i.MERCATOR_A*Math.log(Math.tan(.25*Math.PI+.5*i.DEG2RAD*e[1]))*i.PROJECTION_WORLD_SIZE];if(e[2]){var n=this.projectedUnitsPerMeter(e[1]);t.push(e[2]*n)}else t.push(0);return new r.Vector3(t[0],t[1],t[2])},projectedUnitsPerMeter:function(e){return Math.abs(i.WORLD_SIZE/Math.cos(i.DEG2RAD*e)/i.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(e){return i.EARTH_CIRCUMFERENCE*Math.cos(e*Math.PI/180)},mercatorZfromAltitude:function(e,t){return e/this._circumferenceAtLatitude(t)},_scaleVerticesToMeters:function(e,t){for(var n=this.projectedUnitsPerMeter(e[1]),r=(this.projectToWorld(e),0);r<t.length;r++)t[r].multiplyScalar(n);return t},projectToScreen:function(e){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(e){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(e){var t=[-e.x/(i.MERCATOR_A*i.DEG2RAD*i.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(e.y/(i.PROJECTION_WORLD_SIZE*-i.MERCATOR_A)))-Math.PI/4)/i.DEG2RAD],n=this.projectedUnitsPerMeter(t[1]),r=e.z||0;return t.push(r/n),t},toScreenPosition:function(e,t){var n=new r.Vector3,i=.5*renderer.context.canvas.width,o=.5*renderer.context.canvas.height;return e.updateMatrixWorld(),n.setFromMatrixPosition(e.matrixWorld),n.project(t),n.x=n.x*i+i,n.y=-n.y*o+o,{x:n.x,y:n.y}},getFeatureCenter:function(e,t,n){let r=[],i=0,o=0,s=0,a=[...e.geometry.coordinates[0]];return"Point"===e.geometry.type?r=[...a[0]]:("MultiPolygon"===e.geometry.type&&(a=a[0]),a.splice(-1,1),a.forEach((function(e){i+=e[0],o+=e[1]})),r=[i/a.length,o/a.length]),s=this.getObjectHeightOnFloor(e,t,n),r.length<3?r.push(s):r[2]=s,r},getObjectHeightOnFloor:function(e,t){let n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.properties.level||0)*(e.properties.levelHeight||0),r=e.properties.base_height||e.properties.min_height||0;return n+((t&&t.model?0:e.properties.height-r)+r)},_flipMaterialSides:function(e){},normalizeVertices(e){let t=new r.BufferGeometry,n=[];for(var i=0;i<e.length;i++){let t=e[i];n.push(t.x,t.y,t.z),n.push(t.x,t.y,t.z)}t.setAttribute("position",new r.BufferAttribute(new Float32Array(n),3)),t.computeBoundingSphere();var o=t.boundingSphere.center;return{vertices:e.map((function(e){return e.sub(o)})),position:o}},flattenVectors(e){var t=[];for(let n of e)t.push(n.x,n.y,n.z);return t},lnglatsToWorld:function(e){return e.map((function(e){var t=o.projectToWorld(e);return new r.Vector3(t.x,t.y,t.z)}))},extend:function(e,t){for(let n in t)e[n]=t[n]},clone:function(e){var t={};for(let n in e)t[n]=e[n];return t},clamp:function(e,t,n){return Math.min(n,Math.max(t,e))},types:{rotation:function(e,t){e||(e=0),"number"==typeof e&&(e={z:e});var n=this.applyDefault([e.x,e.y,e.z],t);return o.radify(n)},scale:function(e,t){return e||(e=1),"number"==typeof e?[e,e,e]:this.applyDefault([e.x,e.y,e.z],t)},applyDefault:function(e,t){return e.map((function(e,n){return e||t[n]}))}},toDecimal:function(e,t){return Number(e.toFixed(t))},equal:function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;if(0==n.length&&0==r.length&&n!==r)return!1;for(const r of n){const n=e[r],i=t[r],o=this.isObject(n)&&this.isObject(i);if(o&&!equal(n,i)||!o&&n!==i)return!1}return!0},isObject:function(e){return null!=e&&"object"==typeof e},curveToLine:(e,t)=>{let{width:n,color:i}=t,o=(new r.BufferGeometry).setFromPoints(e.getPoints(100)),s=new r.LineBasicMaterial({color:i,linewidth:n});return new r.Line(o,s)},curvesToLines:e=>{var t=[16711680,2031360,2490623];return e.map(((e,n)=>curveToLine(e,{width:3,color:t[n]||"purple"})))},_validate:function(e,t){e=e||{};var n={};o.extend(n,e);for(let r of Object.keys(t))if(void 0===e[r]){if(null===t[r])return void console.error(r+" is required");n[r]=t[r]}else n[r]=e[r];return n},Validator:new(n(7854)),exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};e.exports=o},7854:(e,t)=>{function n(){}n.prototype={Coords:function(e){if(e.constructor===Array)if(e.length<2)console.error("Coords length must be at least 2");else{for(const t of e)if(t.constructor!==Number)return void console.error("Coords values must be numbers");if(!(Math.abs(e[1])>90))return e;console.error("Latitude must be between -90 and 90")}else console.error("Coords must be an array")},Line:function(e){if(e.constructor===Array){for(const t of e)if(!this.Coords(t))return void console.error("Each coordinate in a line must be a valid Coords type");return e}console.error("Line must be an array")},Rotation:function(e){if(e.constructor===Number)e={z:e};else{if(e.constructor!==Object)return void console.error("Rotation must be an object or a number");for(const t of Object.keys(e)){if(!["x","y","z"].includes(t))return void console.error("Rotation parameters must be x, y, or z");if(e[t].constructor!==Number)return void console.error("Individual rotation values must be numbers")}}return e},Scale:function(e){if(e.constructor===Number)e={x:e,y:e,z:e};else{if(e.constructor!==Object)return void console.error("Scale must be an object or a number");for(const t of Object.keys(e)){if(!["x","y","z"].includes(t))return void console.error("Scale parameters must be x, y, or z");if(e[t].constructor!==Number)return void console.error("Individual scale values must be numbers")}}return e}},e.exports=n},3550:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1),o=t[r];const s=r+1;if(s<this.length&&n(t[s],o)<0&&(r=s,o=t[s]),n(o,i)>=0)break;t[e]=o,e=r}t[e]=i}}function i(e,t){return e<t?-1:e>t?1:0}},1062:function(e,t){!function(e){"use strict";function t(){}function n(e){this.message=e||""}function r(e){this.message=e||""}function i(e){this.message=e||""}function o(){}function s(e){return null===e?Oe:e.color}function a(e){return null===e?null:e.parent}function l(e,t){null!==e&&(e.color=t)}function c(e){return null===e?null:e.left}function u(e){return null===e?null:e.right}function h(){this.root_=null,this.size_=0}function d(){}function p(){this.array_=[],arguments[0]instanceof xe&&this.addAll(arguments[0])}function f(){}function m(e){this.message=e||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(null==this)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)t[r]=e,++r;return t},writable:!0}),Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!=e},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var y=function(){};y.prototype.interfaces_=function(){return[]},y.prototype.getClass=function(){return y},y.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var v=function(e){function t(t){e.call(this,t),this.name="IllegalArgumentException",this.message=t,this.stack=(new e).stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),_=function(){},x={MAX_VALUE:{configurable:!0}};_.isNaN=function(e){return Number.isNaN(e)},_.doubleToLongBits=function(e){return e},_.longBitsToDouble=function(e){return e},_.isInfinite=function(e){return!Number.isFinite(e)},x.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(_,x);var b=function(){},w=function(){},S=function(){},M=function e(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},E={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};M.prototype.setOrdinate=function(e,t){switch(e){case M.X:this.x=t;break;case M.Y:this.y=t;break;case M.Z:this.z=t;break;default:throw new v("Invalid ordinate index: "+e)}},M.prototype.equals2D=function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!y.equalsWithTolerance(this.x,t.x,n)&&!!y.equalsWithTolerance(this.y,t.y,n)}},M.prototype.getOrdinate=function(e){switch(e){case M.X:return this.x;case M.Y:return this.y;case M.Z:return this.z}throw new v("Invalid ordinate index: "+e)},M.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||_.isNaN(this.z))&&_.isNaN(e.z)},M.prototype.equals=function(e){return e instanceof M&&this.equals2D(e)},M.prototype.equalInZ=function(e,t){return y.equalsWithTolerance(this.z,e.z,t)},M.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0},M.prototype.clone=function(){},M.prototype.copy=function(){return new M(this)},M.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},M.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)},M.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},M.prototype.hashCode=function(){var e=17;return 37*(e=37*e+M.hashCode(this.x))+M.hashCode(this.y)},M.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z},M.prototype.interfaces_=function(){return[b,w,t]},M.prototype.getClass=function(){return M},M.hashCode=function(){if(1===arguments.length){var e=_.doubleToLongBits(arguments[0]);return Math.trunc((e^e)>>>32)}},E.DimensionalComparator.get=function(){return T},E.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},E.NULL_ORDINATE.get=function(){return _.NaN},E.X.get=function(){return 0},E.Y.get=function(){return 1},E.Z.get=function(){return 2},Object.defineProperties(M,E);var T=function(e){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new v("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};T.prototype.compare=function(e,t){var n=e,r=t,i=T.compare(n.x,r.x);if(0!==i)return i;var o=T.compare(n.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:T.compare(n.z,r.z)},T.prototype.interfaces_=function(){return[S]},T.prototype.getClass=function(){return T},T.compare=function(e,t){return e<t?-1:e>t?1:_.isNaN(e)?_.isNaN(t)?0:-1:_.isNaN(t)?1:0};var C=function(){};C.prototype.create=function(){},C.prototype.interfaces_=function(){return[]},C.prototype.getClass=function(){return C};var A=function(){},I={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};A.prototype.interfaces_=function(){return[]},A.prototype.getClass=function(){return A},A.toLocationSymbol=function(e){switch(e){case A.EXTERIOR:return"e";case A.BOUNDARY:return"b";case A.INTERIOR:return"i";case A.NONE:return"-"}throw new v("Unknown location value: "+e)},I.INTERIOR.get=function(){return 0},I.BOUNDARY.get=function(){return 1},I.EXTERIOR.get=function(){return 2},I.NONE.get=function(){return-1},Object.defineProperties(A,I);var P=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},R=function(){},L={LOG_10:{configurable:!0}};R.prototype.interfaces_=function(){return[]},R.prototype.getClass=function(){return R},R.log10=function(e){var t=Math.log(e);return _.isInfinite(t)||_.isNaN(t)?t:t/R.LOG_10},R.min=function(e,t,n,r){var i=e;return t<i&&(i=t),n<i&&(i=n),r<i&&(i=r),i},R.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],o=arguments[2];return r<i?i:r>o?o:r}},R.wrap=function(e,t){return e<0?t- -e%t:e%t},R.max=function(){if(3===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[0];return e>n&&(n=e),t>n&&(n=t),n}if(4===arguments.length){var r=arguments[1],i=arguments[2],o=arguments[3],s=arguments[0];return r>s&&(s=r),i>s&&(s=i),o>s&&(s=o),s}},R.average=function(e,t){return(e+t)/2},L.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(R,L);var D=function(e){this.str=e};D.prototype.append=function(e){this.str+=e},D.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)},D.prototype.toString=function(e){return this.str};var O=function(e){this.value=e};O.prototype.intValue=function(){return this.value},O.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},O.isNaN=function(e){return Number.isNaN(e)};var N=function(){};N.isWhitespace=function(e){return e<=32&&e>=0||127===e},N.toUpperCase=function(e){return e.toUpperCase()};var k=function e(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else"string"==typeof arguments[0]&&e.call(this,e.parse(arguments[0]));else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r,i)}},F={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};k.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo},k.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),r=k.magnitude(n._hi),i=k.TEN.pow(r);(n=n.divide(i)).gt(k.TEN)?(n=n.divide(k.TEN),r+=1):n.lt(k.ONE)&&(n=n.multiply(k.TEN),r-=1);for(var o=r+1,s=new D,a=k.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){e&&l===o&&s.append(".");var c=Math.trunc(n._hi);if(c<0)break;var u=!1,h=0;c>9?(u=!0,h="9"):h="0"+c,s.append(h),n=n.subtract(k.valueOf(c)).multiply(k.TEN),u&&n.selfAdd(k.TEN);var d=!0,p=k.magnitude(n._hi);if(p<0&&Math.abs(p)>=a-l&&(d=!1),!d)break}return t[0]=r,s.toString()},k.prototype.sqr=function(){return this.multiply(this)},k.prototype.doubleValue=function(){return this._hi+this._lo},k.prototype.subtract=function(){if(arguments[0]instanceof k){var e=arguments[0];return this.add(e.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},k.prototype.equals=function(){if(1===arguments.length){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}},k.prototype.isZero=function(){return 0===this._hi&&0===this._lo},k.prototype.selfSubtract=function(){if(arguments[0]instanceof k){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},k.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},k.prototype.min=function(e){return this.le(e)?this:e},k.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof k){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var n,r,i,o,s=arguments[0],a=arguments[1],l=null,c=null,u=null,h=null;return i=this._hi/s,h=(l=(u=k.SPLIT*i)-(l=u-i))*(c=(h=k.SPLIT*s)-(c=h-s))-(o=i*s)+l*(r=s-c)+(n=i-l)*c+n*r,h=i+(u=(this._hi-o-h+this._lo-i*a)/s),this._hi=h,this._lo=i-h+u,this}},k.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},k.prototype.divide=function(){if(arguments[0]instanceof k){var e,t,n,r,i=arguments[0],o=null,s=null,a=null,l=null;return e=(n=this._hi/i._hi)-(o=(a=k.SPLIT*n)-(o=a-n)),l=o*(s=(l=k.SPLIT*i._hi)-(s=l-i._hi))-(r=n*i._hi)+o*(t=i._hi-s)+e*s+e*t,a=(this._hi-r-l+this._lo-n*i._lo)/i._hi,new k(l=n+a,n-l+a)}if("number"==typeof arguments[0]){var c=arguments[0];return _.isNaN(c)?k.createNaN():k.copy(this).selfDivide(c,0)}},k.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo},k.prototype.pow=function(e){if(0===e)return k.valueOf(1);var t=new k(this),n=k.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2==1&&n.selfMultiply(t),(r/=2)>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n},k.prototype.ceil=function(){if(this.isNaN())return k.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new k(e,t)},k.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0},k.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},k.prototype.setValue=function(){if(arguments[0]instanceof k){var e=arguments[0];return this.init(e),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},k.prototype.max=function(e){return this.ge(e)?this:e},k.prototype.sqrt=function(){if(this.isZero())return k.valueOf(0);if(this.isNegative())return k.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=k.valueOf(t),r=this.subtract(n.sqr())._hi*(.5*e);return n.add(r)},k.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof k){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}if("number"==typeof arguments[0]){var t,n,r,i,o,s=arguments[0],a=null;return a=(r=this._hi+s)-(i=r-this._hi),n=(o=(a=s-i+(this._hi-a))+this._lo)+(r-(t=r+o)),this._hi=t+n,this._lo=n+(t-this._hi),this}}else if(2===arguments.length){var l,c,u,h,d=arguments[0],p=arguments[1],f=null,m=null,g=null;u=this._hi+d,c=this._lo+p,m=u-(g=u-this._hi),f=c-(h=c-this._lo);var y=(l=u+(g=(m=d-g+(this._hi-m))+c))+(g=(f=p-h+(this._lo-f))+(g+(u-l))),v=g+(l-y);return this._hi=y,this._lo=v,this}},k.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof k){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var n,r,i=arguments[0],o=arguments[1],s=null,a=null,l=null,c=null;s=(l=k.SPLIT*this._hi)-this._hi,c=k.SPLIT*i,s=l-s,n=this._hi-s,a=c-i;var u=(l=this._hi*i)+(c=s*(a=c-a)-l+s*(r=i-a)+n*a+n*r+(this._hi*o+this._lo*i)),h=c+(s=l-u);return this._hi=u,this._lo=h,this}},k.prototype.selfSqr=function(){return this.selfMultiply(this)},k.prototype.floor=function(){if(this.isNaN())return k.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new k(e,t)},k.prototype.negate=function(){return this.isNaN()?this:new k(-this._hi,-this._lo)},k.prototype.clone=function(){},k.prototype.multiply=function(){if(arguments[0]instanceof k){var e=arguments[0];return e.isNaN()?k.createNaN():k.copy(this).selfMultiply(e)}if("number"==typeof arguments[0]){var t=arguments[0];return _.isNaN(t)?k.createNaN():k.copy(this).selfMultiply(t,0)}},k.prototype.isNaN=function(){return _.isNaN(this._hi)},k.prototype.intValue=function(){return Math.trunc(this._hi)},k.prototype.toString=function(){var e=k.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()},k.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),r=t[0]+1,i=n;if("."===n.charAt(0))i="0"+n;else if(r<0)i="0."+k.stringOfChar("0",-r)+n;else if(-1===n.indexOf(".")){var o=r-n.length;i=n+k.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+i:i},k.prototype.reciprocal=function(){var e,t,n,r,i=null,o=null,s=null,a=null;e=(n=1/this._hi)-(i=(s=k.SPLIT*n)-(i=s-n)),o=(a=k.SPLIT*this._hi)-this._hi;var l=n+(s=(1-(r=n*this._hi)-(a=i*(o=a-o)-r+i*(t=this._hi-o)+e*o+e*t)-n*this._lo)/this._hi);return new k(l,n-l+s)},k.prototype.toSciNotation=function(){if(this.isZero())return k.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=k.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var o=n.charAt(0)+"."+i;return this.isNegative()?"-"+o+r:o+r},k.prototype.abs=function(){return this.isNaN()?k.NaN:this.isNegative()?this.negate():new k(this)},k.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},k.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo},k.prototype.add=function(){if(arguments[0]instanceof k){var e=arguments[0];return k.copy(this).selfAdd(e)}if("number"==typeof arguments[0]){var t=arguments[0];return k.copy(this).selfAdd(t)}},k.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof k){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}},k.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo},k.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},k.prototype.trunc=function(){return this.isNaN()?k.NaN:this.isPositive()?this.floor():this.ceil()},k.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},k.prototype.interfaces_=function(){return[t,b,w]},k.prototype.getClass=function(){return k},k.sqr=function(e){return k.valueOf(e).selfMultiply(e)},k.valueOf=function(){return"string"==typeof arguments[0]?k.parse(arguments[0]):"number"==typeof arguments[0]?new k(arguments[0]):void 0},k.sqrt=function(e){return k.valueOf(e).sqrt()},k.parse=function(e){for(var t=0,n=e.length;N.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<n){var i=e.charAt(t);"-"!==i&&"+"!==i||(t++,"-"===i&&(r=!0))}for(var o=new k,s=0,a=0,l=0;!(t>=n);){var c=e.charAt(t);if(t++,N.isDigit(c)){var u=c-"0";o.selfMultiply(k.TEN),o.selfAdd(u),s++}else{if("."!==c){if("e"===c||"E"===c){var h=e.substring(t);try{l=O.parseInt(h)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+h+" in string "+e):t}break}throw new Error("Unexpected character '"+c+"' at position "+t+" in string "+e)}a=s}}var d=o,p=s-a-l;if(0===p)d=o;else if(p>0){var f=k.TEN.pow(p);d=o.divide(f)}else if(p<0){var m=k.TEN.pow(-p);d=o.multiply(m)}return r?d.negate():d},k.createNaN=function(){return new k(_.NaN,_.NaN)},k.copy=function(e){return new k(e)},k.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n));return 10*Math.pow(10,r)<=t&&(r+=1),r},k.stringOfChar=function(e,t){for(var n=new D,r=0;r<t;r++)n.append(e);return n.toString()},F.PI.get=function(){return new k(3.141592653589793,12246467991473532e-32)},F.TWO_PI.get=function(){return new k(6.283185307179586,24492935982947064e-32)},F.PI_2.get=function(){return new k(1.5707963267948966,6123233995736766e-32)},F.E.get=function(){return new k(2.718281828459045,14456468917292502e-32)},F.NaN.get=function(){return new k(_.NaN,_.NaN)},F.EPS.get=function(){return 123259516440783e-46},F.SPLIT.get=function(){return 134217729},F.MAX_PRINT_DIGITS.get=function(){return 32},F.TEN.get=function(){return k.valueOf(10)},F.ONE.get=function(){return k.valueOf(1)},F.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},F.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(k,F);var z=function(){},B={DP_SAFE_EPSILON:{configurable:!0}};z.prototype.interfaces_=function(){return[]},z.prototype.getClass=function(){return z},z.orientationIndex=function(e,t,n){var r=z.orientationIndexFilter(e,t,n);if(r<=1)return r;var i=k.valueOf(t.x).selfAdd(-e.x),o=k.valueOf(t.y).selfAdd(-e.y),s=k.valueOf(n.x).selfAdd(-t.x),a=k.valueOf(n.y).selfAdd(-t.y);return i.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},z.signOfDet2x2=function(e,t,n,r){return e.multiply(r).selfSubtract(t.multiply(n)).signum()},z.intersection=function(e,t,n,r){var i=k.valueOf(r.y).selfSubtract(n.y).selfMultiply(k.valueOf(t.x).selfSubtract(e.x)),o=k.valueOf(r.x).selfSubtract(n.x).selfMultiply(k.valueOf(t.y).selfSubtract(e.y)),s=i.subtract(o),a=k.valueOf(r.x).selfSubtract(n.x).selfMultiply(k.valueOf(e.y).selfSubtract(n.y)),l=k.valueOf(r.y).selfSubtract(n.y).selfMultiply(k.valueOf(e.x).selfSubtract(n.x)),c=a.subtract(l).selfDivide(s).doubleValue(),u=k.valueOf(e.x).selfAdd(k.valueOf(t.x).selfSubtract(e.x).selfMultiply(c)).doubleValue(),h=k.valueOf(t.x).selfSubtract(e.x).selfMultiply(k.valueOf(e.y).selfSubtract(n.y)),d=k.valueOf(t.y).selfSubtract(e.y).selfMultiply(k.valueOf(e.x).selfSubtract(n.x)),p=h.subtract(d).selfDivide(s).doubleValue(),f=k.valueOf(n.y).selfAdd(k.valueOf(r.y).selfSubtract(n.y).selfMultiply(p)).doubleValue();return new M(u,f)},z.orientationIndexFilter=function(e,t,n){var r=null,i=(e.x-n.x)*(t.y-n.y),o=(e.y-n.y)*(t.x-n.x),s=i-o;if(i>0){if(o<=0)return z.signum(s);r=i+o}else{if(!(i<0))return z.signum(s);if(o>=0)return z.signum(s);r=-i-o}var a=z.DP_SAFE_EPSILON*r;return s>=a||-s>=a?z.signum(s):2},z.signum=function(e){return e>0?1:e<0?-1:0},B.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(z,B);var U=function(){},j={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};j.X.get=function(){return 0},j.Y.get=function(){return 1},j.Z.get=function(){return 2},j.M.get=function(){return 3},U.prototype.setOrdinate=function(e,t,n){},U.prototype.size=function(){},U.prototype.getOrdinate=function(e,t){},U.prototype.getCoordinate=function(){},U.prototype.getCoordinateCopy=function(e){},U.prototype.getDimension=function(){},U.prototype.getX=function(e){},U.prototype.clone=function(){},U.prototype.expandEnvelope=function(e){},U.prototype.copy=function(){},U.prototype.getY=function(e){},U.prototype.toCoordinateArray=function(){},U.prototype.interfaces_=function(){return[w]},U.prototype.getClass=function(){return U},Object.defineProperties(U,j);var V=function(){},G=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(V),H=function(){};H.arraycopy=function(e,t,n,r,i){for(var o=0,s=t;s<t+i;s++)n[r+o]=e[s],o++},H.getProperty=function(e){return{"line.separator":"\n"}[e]};var Z=function e(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var i=arguments[0],o=arguments[1];this.x=i.y*o.w-o.y*i.w,this.y=o.x*i.w-i.x*o.w,this.w=i.x*o.y-o.x*i.y}else if(arguments[0]instanceof M&&arguments[1]instanceof M){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],d=arguments[1],p=arguments[2],f=arguments[3],m=h.y-d.y,g=d.x-h.x,y=h.x*d.y-d.x*h.y,v=p.y-f.y,_=f.x-p.x,x=p.x*f.y-f.x*p.y;this.x=g*x-_*y,this.y=v*y-m*x,this.w=m*_-v*g}};Z.prototype.getY=function(){var e=this.y/this.w;if(_.isNaN(e)||_.isInfinite(e))throw new G;return e},Z.prototype.getX=function(){var e=this.x/this.w;if(_.isNaN(e)||_.isInfinite(e))throw new G;return e},Z.prototype.getCoordinate=function(){var e=new M;return e.x=this.getX(),e.y=this.getY(),e},Z.prototype.interfaces_=function(){return[]},Z.prototype.getClass=function(){return Z},Z.intersection=function(e,t,n,r){var i=e.y-t.y,o=t.x-e.x,s=e.x*t.y-t.x*e.y,a=n.y-r.y,l=r.x-n.x,c=n.x*r.y-r.x*n.y,u=i*l-a*o,h=(o*c-l*s)/u,d=(a*s-i*c)/u;if(_.isNaN(h)||_.isInfinite(h)||_.isNaN(d)||_.isInfinite(d))throw new G;return new M(h,d)};var W=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof M){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}},$={serialVersionUID:{configurable:!0}};W.prototype.getArea=function(){return this.getWidth()*this.getHeight()},W.prototype.equals=function(e){if(!(e instanceof W))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()},W.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new W;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,i=this._maxy<e._maxy?this._maxy:e._maxy;return new W(t,r,n,i)},W.prototype.isNull=function(){return this._maxx<this._minx},W.prototype.getMaxX=function(){return this._maxx},W.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof M){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof W){var t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}},W.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof W){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}if(arguments[0]instanceof M){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return!this.isNull()&&!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}},W.prototype.getMinY=function(){return this._miny},W.prototype.getMinX=function(){return this._minx},W.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof M){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof W){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},W.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t},W.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},W.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0},W.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)},W.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},W.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},W.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},W.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t},W.prototype.expandBy=function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},W.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof W){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof M){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.covers(n,r)}},W.prototype.centre=function(){return this.isNull()?null:new M((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},W.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof M){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof W){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];i<o?(this._minx=i,this._maxx=o):(this._minx=o,this._maxx=i),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},W.prototype.getMaxY=function(){return this._maxy},W.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),0===t?n:0===n?t:Math.sqrt(t*t+n*n)},W.prototype.hashCode=function(){var e=17;return 37*(e=37*(e=37*(e=37*e+M.hashCode(this._minx))+M.hashCode(this._maxx))+M.hashCode(this._miny))+M.hashCode(this._maxy)},W.prototype.interfaces_=function(){return[b,t]},W.prototype.getClass=function(){return W},W.intersects=function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),c=Math.min(r.x,i.x),u=Math.max(r.x,i.x);return!(c>l||u<a||(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),c=Math.min(r.y,i.y),u=Math.max(r.y,i.y),c>l||u<a))}},$.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(W,$);var q={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},X=function(e){this.geometryFactory=e||new yt};X.prototype.read=function(e){var t,n,r;e=e.replace(/[\n\r]/g," ");var i=q.typeStr.exec(e);if(-1!==e.search("EMPTY")&&((i=q.emptyTypeStr.exec(e))[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],K[n]&&(t=K[n].apply(this,[r]))),void 0===t)throw new Error("Could not parse WKT "+e);return t},X.prototype.write=function(e){return this.extractGeometry(e)},X.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Y[t])return null;var n=t.toUpperCase();return e.isEmpty()?n+" EMPTY":n+"("+Y[t].apply(this,[e])+")"};var Y={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Y.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Y.point.apply(this,[e._geometries[n]])+")");return t.join(",")},linestring:function(e){for(var t=[],n=0,r=e._points._coordinates.length;n<r;++n)t.push(Y.coordinate.apply(this,[e._points._coordinates[n]]));return t.join(",")},linearring:function(e){for(var t=[],n=0,r=e._points._coordinates.length;n<r;++n)t.push(Y.coordinate.apply(this,[e._points._coordinates[n]]));return t.join(",")},multilinestring:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Y.linestring.apply(this,[e._geometries[n]])+")");return t.join(",")},polygon:function(e){var t=[];t.push("("+Y.linestring.apply(this,[e._shell])+")");for(var n=0,r=e._holes.length;n<r;++n)t.push("("+Y.linestring.apply(this,[e._holes[n]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push("("+Y.polygon.apply(this,[e._geometries[n]])+")");return t.join(",")},geometrycollection:function(e){for(var t=[],n=0,r=e._geometries.length;n<r;++n)t.push(this.extractGeometry(e._geometries[n]));return t.join(",")}},K={point:function(e){if(void 0===e)return this.geometryFactory.createPoint();var t=e.trim().split(q.spaces);return this.geometryFactory.createPoint(new M(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){if(void 0===e)return this.geometryFactory.createMultiPoint();for(var t,n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(q.trimParens,"$1"),r.push(K.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(void 0===e)return this.geometryFactory.createLineString();for(var t,n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].trim().split(q.spaces),r.push(new M(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(void 0===e)return this.geometryFactory.createLinearRing();for(var t,n=e.trim().split(","),r=[],i=0,o=n.length;i<o;++i)t=n[i].trim().split(q.spaces),r.push(new M(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){if(void 0===e)return this.geometryFactory.createMultiLineString();for(var t,n=e.trim().split(q.parenComma),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(q.trimParens,"$1"),r.push(K.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){if(void 0===e)return this.geometryFactory.createPolygon();for(var t,n,r,i,o=e.trim().split(q.parenComma),s=[],a=0,l=o.length;a<l;++a)t=o[a].replace(q.trimParens,"$1"),n=K.linestring.apply(this,[t]),r=this.geometryFactory.createLinearRing(n._points),0===a?i=r:s.push(r);return this.geometryFactory.createPolygon(i,s)},multipolygon:function(e){if(void 0===e)return this.geometryFactory.createMultiPolygon();for(var t,n=e.trim().split(q.doubleParenComma),r=[],i=0,o=n.length;i<o;++i)t=n[i].replace(q.trimParens,"$1"),r.push(K.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){if(void 0===e)return this.geometryFactory.createGeometryCollection();for(var t=(e=e.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],r=0,i=t.length;r<i;++r)n.push(this.read(t[r]));return this.geometryFactory.createGeometryCollection(n)}},J=function(e){this.parser=new X(e)};J.prototype.write=function(e){return this.parser.write(e)},J.toLineString=function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Q=function(e){function t(t){e.call(this,t),this.name="RuntimeException",this.message=t,this.stack=(new e).stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),ee=function(e){function t(){if(e.call(this),0===arguments.length)e.call(this);else if(1===arguments.length){var t=arguments[0];e.call(this,t)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Q),te=function(){};te.prototype.interfaces_=function(){return[]},te.prototype.getClass=function(){return te},te.shouldNeverReachHere=function(){if(0===arguments.length)te.shouldNeverReachHere(null);else if(1===arguments.length){var e=arguments[0];throw new ee("Should never reach here"+(null!==e?": "+e:""))}},te.isTrue=function(){var e;if(1===arguments.length)te.isTrue(arguments[0],null);else if(2===arguments.length&&(e=arguments[1],!arguments[0]))throw null===e?new ee:new ee(e)},te.equals=function(){var e,t,n;if(2===arguments.length)te.equals(e=arguments[0],t=arguments[1],null);else if(3===arguments.length&&(e=arguments[0],n=arguments[2],!(t=arguments[1]).equals(e)))throw new ee("Expected "+e+" but encountered "+t+(null!==n?": "+n:""))};var ne=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new M,this._intPt[1]=new M,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},re={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ne.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]},ne.prototype.getTopologySummary=function(){var e=new D;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},ne.prototype.computeIntersection=function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)},ne.prototype.getIntersectionNum=function(){return this._result},ne.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}},ne.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},ne.prototype.setPrecisionModel=function(e){this._precisionModel=e},ne.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}},ne.prototype.getIntersection=function(e){return this._intPt[e]},ne.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},ne.prototype.hasIntersection=function(){return this._result!==ne.NO_INTERSECTION},ne.prototype.getEdgeDistance=function(e,t){return ne.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1])},ne.prototype.isCollinear=function(){return this._result===ne.COLLINEAR_INTERSECTION},ne.prototype.toString=function(){return J.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+J.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},ne.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]},ne.prototype.isIntersection=function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1},ne.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne},ne.computeEdgeDistance=function(e,t,n){var r=Math.abs(n.x-t.x),i=Math.abs(n.y-t.y),o=-1;if(e.equals(t))o=0;else if(e.equals(n))o=r>i?r:i;else{var s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);0!==(o=r>i?s:a)||e.equals(t)||(o=Math.max(s,a))}return te.isTrue(!(0===o&&!e.equals(t)),"Bad distance calculation"),o},ne.nonRobustComputeEdgeDistance=function(e,t,n){var r=e.x-t.x,i=e.y-t.y,o=Math.sqrt(r*r+i*i);return te.isTrue(!(0===o&&!e.equals(t)),"Invalid distance calculation"),o},re.DONT_INTERSECT.get=function(){return 0},re.DO_INTERSECT.get=function(){return 1},re.COLLINEAR.get=function(){return 2},re.NO_INTERSECTION.get=function(){return 0},re.POINT_INTERSECTION.get=function(){return 1},re.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(ne,re);var ie=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(e){var t=new W(this._inputLines[0][0],this._inputLines[0][1]),n=new W(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&n.contains(e)},t.prototype.computeIntersection=function(){if(3!==arguments.length)return e.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],n=arguments[1],r=arguments[2];if(this._isProper=!1,W.intersects(n,r,t)&&0===ae.orientationIndex(n,r,t)&&0===ae.orientationIndex(r,n,t))return this._isProper=!0,(t.equals(n)||t.equals(r))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION},t.prototype.normalizeToMinimum=function(e,t,n,r,i){i.x=this.smallestInAbsValue(e.x,t.x,n.x,r.x),i.y=this.smallestInAbsValue(e.y,t.y,n.y,r.y),e.x-=i.x,e.y-=i.y,t.x-=i.x,t.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},t.prototype.safeHCoordinateIntersection=function(e,n,r,i){var o=null;try{o=Z.intersection(e,n,r,i)}catch(s){if(!(s instanceof G))throw s;o=t.nearestEndpoint(e,n,r,i)}return o},t.prototype.intersection=function(e,n,r,i){var o=this.intersectionWithNormalization(e,n,r,i);return this.isInSegmentEnvelopes(o)||(o=new M(t.nearestEndpoint(e,n,r,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},t.prototype.smallestInAbsValue=function(e,t,n,r){var i=e,o=Math.abs(i);return Math.abs(t)<o&&(i=t,o=Math.abs(t)),Math.abs(n)<o&&(i=n,o=Math.abs(n)),Math.abs(r)<o&&(i=r),i},t.prototype.checkDD=function(e,t,n,r,i){var o=z.intersection(e,t,n,r),s=this.isInSegmentEnvelopes(o);H.out.println("DD in env = "+s+"  --------------------- "+o),i.distance(o)>1e-4&&H.out.println("Distance = "+i.distance(o))},t.prototype.intersectionWithNormalization=function(e,t,n,r){var i=new M(e),o=new M(t),s=new M(n),a=new M(r),l=new M;this.normalizeToEnvCentre(i,o,s,a,l);var c=this.safeHCoordinateIntersection(i,o,s,a);return c.x+=l.x,c.y+=l.y,c},t.prototype.computeCollinearIntersection=function(t,n,r,i){var o=W.intersects(t,n,r),s=W.intersects(t,n,i),a=W.intersects(r,i,t),l=W.intersects(r,i,n);return o&&s?(this._intPt[0]=r,this._intPt[1]=i,e.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=t,this._intPt[1]=n,e.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||s||l?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):o&&l?(this._intPt[0]=r,this._intPt[1]=n,!r.equals(n)||s||a?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||o||l?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):s&&l?(this._intPt[0]=i,this._intPt[1]=n,!i.equals(n)||o||a?e.COLLINEAR_INTERSECTION:e.POINT_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(e,t,n,r,i){var o=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y,a=e.x>t.x?e.x:t.x,l=e.y>t.y?e.y:t.y,c=n.x<r.x?n.x:r.x,u=n.y<r.y?n.y:r.y,h=n.x>r.x?n.x:r.x,d=n.y>r.y?n.y:r.y,p=((o>c?o:c)+(a<h?a:h))/2,f=((s>u?s:u)+(l<d?l:d))/2;i.x=p,i.y=f,e.x-=i.x,e.y-=i.y,t.x-=i.x,t.y-=i.y,n.x-=i.x,n.y-=i.y,r.x-=i.x,r.y-=i.y},t.prototype.computeIntersect=function(t,n,r,i){if(this._isProper=!1,!W.intersects(t,n,r,i))return e.NO_INTERSECTION;var o=ae.orientationIndex(t,n,r),s=ae.orientationIndex(t,n,i);if(o>0&&s>0||o<0&&s<0)return e.NO_INTERSECTION;var a=ae.orientationIndex(r,i,t),l=ae.orientationIndex(r,i,n);return a>0&&l>0||a<0&&l<0?e.NO_INTERSECTION:0===o&&0===s&&0===a&&0===l?this.computeCollinearIntersection(t,n,r,i):(0===o||0===s||0===a||0===l?(this._isProper=!1,t.equals2D(r)||t.equals2D(i)?this._intPt[0]=t:n.equals2D(r)||n.equals2D(i)?this._intPt[0]=n:0===o?this._intPt[0]=new M(r):0===s?this._intPt[0]=new M(i):0===a?this._intPt[0]=new M(t):0===l&&(this._intPt[0]=new M(n))):(this._isProper=!0,this._intPt[0]=this.intersection(t,n,r,i)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(e,t,n,r){var i=e,o=ae.distancePointLine(e,n,r),s=ae.distancePointLine(t,n,r);return s<o&&(o=s,i=t),(s=ae.distancePointLine(n,e,t))<o&&(o=s,i=n),(s=ae.distancePointLine(r,e,t))<o&&(o=s,i=r),i},t}(ne),oe=function(){};oe.prototype.interfaces_=function(){return[]},oe.prototype.getClass=function(){return oe},oe.orientationIndex=function(e,t,n){var r=t.x-e.x,i=t.y-e.y,o=n.x-t.x,s=n.y-t.y;return oe.signOfDet2x2(r,i,o,s)},oe.signOfDet2x2=function(e,t,n,r){var i=null,o=null,s=null;if(i=1,0===e||0===r)return 0===t||0===n?0:t>0?n>0?-i:i:n>0?i:-i;if(0===t||0===n)return r>0?e>0?i:-i:e>0?-i:i;if(t>0?r>0?t<=r||(i=-i,o=e,e=n,n=o,o=t,t=r,r=o):t<=-r?(i=-i,n=-n,r=-r):(o=e,e=-n,n=o,o=t,t=-r,r=o):r>0?-t<=r?(i=-i,e=-e,t=-t):(o=-e,e=n,n=o,o=-t,t=r,r=o):t>=r?(e=-e,t=-t,n=-n,r=-r):(i=-i,o=-e,e=-n,n=o,o=-t,t=-r,r=o),e>0){if(!(n>0))return i;if(!(e<=n))return i}else{if(n>0)return-i;if(!(e>=n))return-i;i=-i,e=-e,n=-n}for(;;){if((r-=(s=Math.floor(n/e))*t)<0)return-i;if(r>t)return i;if(e>(n-=s*e)+n){if(t<r+r)return i}else{if(t>r+r)return-i;n=e-n,r=t-r,i=-i}if(0===r)return 0===n?0:-i;if(0===n)return i;if((t-=(s=Math.floor(e/n))*r)<0)return i;if(t>r)return-i;if(n>(e-=s*n)+e){if(r<t+t)return-i}else{if(r>t+t)return i;e=n-e,t=r-t,i=-i}if(0===t)return 0===e?0:i;if(0===e)return-i}};var se=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};se.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var i=e.x-this._p.x,o=e.y-this._p.y,s=t.x-this._p.x,a=t.y-this._p.y,l=oe.signOfDet2x2(i,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},se.prototype.isPointInPolygon=function(){return this.getLocation()!==A.EXTERIOR},se.prototype.getLocation=function(){return this._isPointOnSegment?A.BOUNDARY:this._crossingCount%2==1?A.INTERIOR:A.EXTERIOR},se.prototype.isOnSegment=function(){return this._isPointOnSegment},se.prototype.interfaces_=function(){return[]},se.prototype.getClass=function(){return se},se.locatePointInRing=function(){if(arguments[0]instanceof M&&P(arguments[1],U)){for(var e=arguments[1],t=new se(arguments[0]),n=new M,r=new M,i=1;i<e.size();i++)if(e.getCoordinate(i,n),e.getCoordinate(i-1,r),t.countSegment(n,r),t.isOnSegment())return t.getLocation();return t.getLocation()}if(arguments[0]instanceof M&&arguments[1]instanceof Array){for(var o=arguments[1],s=new se(arguments[0]),a=1;a<o.length;a++){var l=o[a],c=o[a-1];if(s.countSegment(l,c),s.isOnSegment())return s.getLocation()}return s.getLocation()}};var ae=function(){},le={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};ae.prototype.interfaces_=function(){return[]},ae.prototype.getClass=function(){return ae},ae.orientationIndex=function(e,t,n){return z.orientationIndex(e,t,n)},ae.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var i=e[r].x-n,o=e[r+1].y;t+=i*(e[r-1].y-o)}return t/2}if(P(arguments[0],U)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new M,c=new M,u=new M;s.getCoordinate(0,c),s.getCoordinate(1,u);var h=c.x;u.x-=h;for(var d=0,p=1;p<a-1;p++)l.y=c.y,c.x=u.x,c.y=u.y,s.getCoordinate(p+1,u),u.x-=h,d+=c.x*(l.y-u.y);return d/2}},ae.distanceLineLine=function(e,t,n,r){if(e.equals(t))return ae.distancePointLine(e,n,r);if(n.equals(r))return ae.distancePointLine(r,e,t);var i=!1;if(W.intersects(e,t,n,r)){var o=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(0===o)i=!0;else{var s=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),a=((e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(i=!0)}}else i=!0;return i?R.min(ae.distancePointLine(e,n,r),ae.distancePointLine(t,n,r),ae.distancePointLine(n,e,t),ae.distancePointLine(r,e,t)):0},ae.isPointInRing=function(e,t){return ae.locatePointInRing(e,t)!==A.EXTERIOR},ae.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new M;e.getCoordinate(0,r);for(var i=r.x,o=r.y,s=1;s<t;s++){e.getCoordinate(s,r);var a=r.x,l=r.y,c=a-i,u=l-o;n+=Math.sqrt(c*c+u*u),i=a,o=l}return n},ae.isCCW=function(e){var t=e.length-1;if(t<3)throw new v("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],r=0,i=1;i<=t;i++){var o=e[i];o.y>n.y&&(n=o,r=i)}var s=r;do{(s-=1)<0&&(s=t)}while(e[s].equals2D(n)&&s!==r);var a=r;do{a=(a+1)%t}while(e[a].equals2D(n)&&a!==r);var l=e[s],c=e[a];if(l.equals2D(n)||c.equals2D(n)||l.equals2D(c))return!1;var u=ae.computeOrientation(l,n,c);return 0===u?l.x>c.x:u>0},ae.locatePointInRing=function(e,t){return se.locatePointInRing(e,t)},ae.distancePointLinePerpendicular=function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),i=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(i)*Math.sqrt(r)},ae.computeOrientation=function(e,t,n){return ae.orientationIndex(e,t,n)},ae.distancePointLine=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(0===t.length)throw new v("Line array must contain at least one vertex");for(var n=e.distance(t[0]),r=0;r<t.length-1;r++){var i=ae.distancePointLine(e,t[r],t[r+1]);i<n&&(n=i)}return n}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var u=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(u)*Math.sqrt(l)}},ae.isOnLine=function(e,t){for(var n=new ie,r=1;r<t.length;r++){var i=t[r-1],o=t[r];if(n.computeIntersection(e,i,o),n.hasIntersection())return!0}return!1},le.CLOCKWISE.get=function(){return-1},le.RIGHT.get=function(){return ae.CLOCKWISE},le.COUNTERCLOCKWISE.get=function(){return 1},le.LEFT.get=function(){return ae.COUNTERCLOCKWISE},le.COLLINEAR.get=function(){return 0},le.STRAIGHT.get=function(){return ae.COLLINEAR},Object.defineProperties(ae,le);var ce=function(){};ce.prototype.filter=function(e){},ce.prototype.interfaces_=function(){return[]},ce.prototype.getClass=function(){return ce};var ue=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},he={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ue.prototype.isGeometryCollection=function(){return this.getSortIndex()===ue.SORTINDEX_GEOMETRYCOLLECTION},ue.prototype.getFactory=function(){return this._factory},ue.prototype.getGeometryN=function(e){return this},ue.prototype.getArea=function(){return 0},ue.prototype.isRectangle=function(){return!1},ue.prototype.equals=function(){if(arguments[0]instanceof ue){var e=arguments[0];return null!==e&&this.equalsTopo(e)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof ue))return!1;var n=t;return this.equalsExact(n)}},ue.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)},ue.prototype.geometryChanged=function(){this.apply(ue.geometryChangedFilter)},ue.prototype.geometryChangedAction=function(){this._envelope=null},ue.prototype.equalsNorm=function(e){return null!==e&&this.norm().equalsExact(e.norm())},ue.prototype.getLength=function(){return 0},ue.prototype.getNumGeometries=function(){return 1},ue.prototype.compareTo=function(){if(1===arguments.length){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}},ue.prototype.getUserData=function(){return this._userData},ue.prototype.getSRID=function(){return this._SRID},ue.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ue.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===ue.SORTINDEX_GEOMETRYCOLLECTION)throw new v("This method does not support GeometryCollection arguments")},ue.prototype.equal=function(e,t,n){return 0===n?e.equals(t):e.distance(t)<=n},ue.prototype.norm=function(){var e=this.copy();return e.normalize(),e},ue.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ue.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new W(this._envelope)},ue.prototype.setSRID=function(e){this._SRID=e},ue.prototype.setUserData=function(e){this._userData=e},ue.prototype.compare=function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),o=r.next(),s=i.compareTo(o);if(0!==s)return s}return n.hasNext()?1:r.hasNext()?-1:0},ue.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ue.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ue.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ue.SORTINDEX_MULTIPOINT||this.getSortIndex()===ue.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ue.SORTINDEX_MULTIPOLYGON},ue.prototype.interfaces_=function(){return[w,b,t]},ue.prototype.getClass=function(){return ue},ue.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1},ue.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1},he.serialVersionUID.get=function(){return 0x799ea46522854c00},he.SORTINDEX_POINT.get=function(){return 0},he.SORTINDEX_MULTIPOINT.get=function(){return 1},he.SORTINDEX_LINESTRING.get=function(){return 2},he.SORTINDEX_LINEARRING.get=function(){return 3},he.SORTINDEX_MULTILINESTRING.get=function(){return 4},he.SORTINDEX_POLYGON.get=function(){return 5},he.SORTINDEX_MULTIPOLYGON.get=function(){return 6},he.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},he.geometryChangedFilter.get=function(){return de},Object.defineProperties(ue,he);var de=function(){};de.interfaces_=function(){return[ce]},de.filter=function(e){e.geometryChangedAction()};var pe=function(){};pe.prototype.filter=function(e){},pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe};var fe=function(){},me={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};fe.prototype.isInBoundary=function(e){},fe.prototype.interfaces_=function(){return[]},fe.prototype.getClass=function(){return fe},me.Mod2BoundaryNodeRule.get=function(){return ge},me.EndPointBoundaryNodeRule.get=function(){return ye},me.MultiValentEndPointBoundaryNodeRule.get=function(){return ve},me.MonoValentEndPointBoundaryNodeRule.get=function(){return _e},me.MOD2_BOUNDARY_RULE.get=function(){return new ge},me.ENDPOINT_BOUNDARY_RULE.get=function(){return new ye},me.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ve},me.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _e},me.OGC_SFS_BOUNDARY_RULE.get=function(){return fe.MOD2_BOUNDARY_RULE},Object.defineProperties(fe,me);var ge=function(){};ge.prototype.isInBoundary=function(e){return e%2==1},ge.prototype.interfaces_=function(){return[fe]},ge.prototype.getClass=function(){return ge};var ye=function(){};ye.prototype.isInBoundary=function(e){return e>0},ye.prototype.interfaces_=function(){return[fe]},ye.prototype.getClass=function(){return ye};var ve=function(){};ve.prototype.isInBoundary=function(e){return e>1},ve.prototype.interfaces_=function(){return[fe]},ve.prototype.getClass=function(){return ve};var _e=function(){};_e.prototype.isInBoundary=function(e){return 1===e},_e.prototype.interfaces_=function(){return[fe]},_e.prototype.getClass=function(){return _e};var xe=function(){};xe.prototype.add=function(){},xe.prototype.addAll=function(){},xe.prototype.isEmpty=function(){},xe.prototype.iterator=function(){},xe.prototype.size=function(){},xe.prototype.toArray=function(){},xe.prototype.remove=function(){},(n.prototype=new Error).name="IndexOutOfBoundsException";var be=function(){};be.prototype.hasNext=function(){},be.prototype.next=function(){},be.prototype.remove=function(){};var we=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(xe);(r.prototype=new Error).name="NoSuchElementException";var Se=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof xe&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,xe]},t.prototype.add=function(e){return 1===arguments.length?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(e,t){var n=this.array_[e];return this.array_[e]=t,n},t.prototype.iterator=function(){return new Me(this)},t.prototype.get=function(e){if(e<0||e>=this.size())throw new n;return this.array_[e]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},t.prototype.remove=function(e){for(var t=!1,n=0,r=this.array_.length;n<r;n++)if(this.array_[n]===e){this.array_.splice(n,1),t=!0;break}return t},t}(we),Me=function(e){function t(t){e.call(this),this.arrayList_=t,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new r;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(be),Ee=function(e){function t(){if(e.call(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.ensureCapacity(n.length),this.add(n,r)}}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(e){return this.get(e)},t.prototype.addAll=function(){if(2===arguments.length){for(var t=arguments[1],n=!1,r=arguments[0].iterator();r.hasNext();)this.add(r.next(),t),n=!0;return n}return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var t=e.prototype.clone.call(this),n=0;n<this.size();n++)t.add(n,this.get(n).copy());return t},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){if(1===arguments.length){var t=arguments[0];e.prototype.add.call(this,t)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var n=arguments[0],r=arguments[1];return this.add(n,r,!0),!0}if(arguments[0]instanceof M&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(i))return null;e.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return this.add(o,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],l);else for(var u=a.length-1;u>=0;u--)this.add(a[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof M){var h=arguments[0],d=arguments[1];if(!arguments[2]){var p=this.size();if(p>0){if(h>0&&this.get(h-1).equals2D(d))return null;if(h<p&&this.get(h).equals2D(d))return null}}e.prototype.add.call(this,h,d)}}else if(4===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],y=arguments[3],v=1;g>y&&(v=-1);for(var _=g;_!==y;_+=v)this.add(f[_],m);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new M(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(Se),Te=function(){},Ce={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ce.ForwardComparator.get=function(){return Ae},Ce.BidirectionalComparator.get=function(){return Ie},Ce.coordArrayType.get=function(){return new Array(0).fill(null)},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te},Te.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))},Te.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(Te.indexOf(r,t)<0)return r}return null},Te.scroll=function(e,t){var n=Te.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);H.arraycopy(e,n,r,0,e.length-n),H.arraycopy(e,0,r,e.length-n,n),H.arraycopy(r,0,e,0,e.length)},Te.equals=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];if(r===i)return!0;if(null===r||null===i)return!1;if(r.length!==i.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],i[s]))return!1;return!0}},Te.intersection=function(e,t){for(var n=new Ee,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()},Te.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1},Te.removeRepeatedPoints=function(e){return Te.hasRepeatedPoints(e)?new Ee(e,!1).toCoordinateArray():e},Te.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var i=e[r];e[r]=e[t-r],e[t-r]=i}},Te.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)null!==e[n]&&t++;var r=new Array(t).fill(null);if(0===t)return r;for(var i=0,o=0;o<e.length;o++)null!==e[o]&&(r[i++]=e[o]);return r},Te.copyDeep=function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new M(e[n]);return t}if(5===arguments.length)for(var r=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new M(r[i+l])},Te.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[e.length-n-1];if(0!==r.compareTo(i))return!1}return!0},Te.envelope=function(e){for(var t=new W,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t},Te.toCoordinateArray=function(e){return e.toArray(Te.coordArrayType)},Te.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]},Te.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1},Te.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(0!==r)return r}return 1},Te.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(0!==r)return r;n++}return n<t.length?-1:n<e.length?1:0},Te.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(null===t||t.compareTo(e[n])>0)&&(t=e[n]);return t},Te.extract=function(e,t,n){t=R.clamp(t,0,e.length);var r=(n=R.clamp(n,-1,e.length))-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var i=new Array(r).fill(null);if(0===r)return i;for(var o=0,s=t;s<=n;s++)i[o++]=e[s];return i},Object.defineProperties(Te,Ce);var Ae=function(){};Ae.prototype.compare=function(e,t){return Te.compare(e,t)},Ae.prototype.interfaces_=function(){return[S]},Ae.prototype.getClass=function(){return Ae};var Ie=function(){};Ie.prototype.compare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;var i=Te.compare(n,r);return Te.isEqualReversed(n,r)?0:i},Ie.prototype.OLDcompare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(0===n.length)return 0;for(var i=Te.increasingDirection(n),o=Te.increasingDirection(r),s=i>0?0:n.length-1,a=o>0?0:n.length-1,l=0;l<n.length;l++){var c=n[s].compareTo(r[a]);if(0!==c)return c;s+=i,a+=o}return 0},Ie.prototype.interfaces_=function(){return[S]},Ie.prototype.getClass=function(){return Ie};var Pe=function(){};Pe.prototype.get=function(){},Pe.prototype.put=function(){},Pe.prototype.size=function(){},Pe.prototype.values=function(){},Pe.prototype.entrySet=function(){};var Re=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Pe);(i.prototype=new Error).name="OperationNotSupported",(o.prototype=new xe).contains=function(){};var Le=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof xe&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(e){for(var t=0,n=this.array_.length;t<n;t++)if(this.array_[t]===e)return!0;return!1},t.prototype.add=function(e){return!this.contains(e)&&(this.array_.push(e),!0)},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(e){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},t.prototype.iterator=function(){return new De(this)},t}(o),De=function(e){function t(t){e.call(this),this.hashSet_=t,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new r;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new i},t}(be),Oe=0;(h.prototype=new Re).get=function(e){for(var t=this.root_;null!==t;){var n=e.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null},h.prototype.put=function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:Oe,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,r,i=this.root_;do{if(n=i,(r=e.compareTo(i.key))<0)i=i.left;else{if(!(r>0)){var o=i.value;return i.value=t,o}i=i.right}}while(null!==i);var s={key:e,left:null,right:null,value:t,parent:n,color:Oe,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},h.prototype.fixAfterInsertion=function(e){for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)if(a(e)===c(a(a(e)))){var t=u(a(a(e)));1===s(t)?(l(a(e),Oe),l(t,Oe),l(a(a(e)),1),e=a(a(e))):(e===u(a(e))&&(e=a(e),this.rotateLeft(e)),l(a(e),Oe),l(a(a(e)),1),this.rotateRight(a(a(e))))}else{var n=c(a(a(e)));1===s(n)?(l(a(e),Oe),l(n,Oe),l(a(a(e)),1),e=a(a(e))):(e===c(a(e))&&(e=a(e),this.rotateRight(e)),l(a(e),Oe),l(a(a(e)),1),this.rotateLeft(a(a(e))))}this.root_.color=Oe},h.prototype.values=function(){var e=new Se,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=h.successor(t));)e.add(t.value);return e},h.prototype.entrySet=function(){var e=new Le,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=h.successor(t));)e.add(t);return e},h.prototype.rotateLeft=function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}},h.prototype.rotateRight=function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}},h.prototype.getFirstEntry=function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e},h.successor=function(e){if(null===e)return null;if(null!==e.right){for(var t=e.right;null!==t.left;)t=t.left;return t}for(var n=e.parent,r=e;null!==n&&r===n.right;)r=n,n=n.parent;return n},h.prototype.size=function(){return this.size_};var Ne=function(){};Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne},d.prototype=new o,(p.prototype=new d).contains=function(e){for(var t=0,n=this.array_.length;t<n;t++)if(0===this.array_[t].compareTo(e))return!0;return!1},p.prototype.add=function(e){if(this.contains(e))return!1;for(var t=0,n=this.array_.length;t<n;t++)if(1===this.array_[t].compareTo(e))return this.array_.splice(t,0,e),!0;return this.array_.push(e),!0},p.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},p.prototype.remove=function(e){throw new i},p.prototype.size=function(){return this.array_.length},p.prototype.isEmpty=function(){return 0===this.array_.length},p.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e},p.prototype.iterator=function(){return new ke(this)};var ke=function(e){this.treeSet_=e,this.position_=0};ke.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new r;return this.treeSet_.array_[this.position_++]},ke.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},ke.prototype.remove=function(){throw new i};var Fe=function(){};Fe.sort=function(){var e,t,n,r,i=arguments[0];if(1===arguments.length)r=function(e,t){return e.compareTo(t)},i.sort(r);else if(2===arguments.length)n=arguments[1],r=function(e,t){return n.compare(e,t)},i.sort(r);else if(3===arguments.length){(t=i.slice(arguments[1],arguments[2])).sort();var o=i.slice(0,arguments[1]).concat(t,i.slice(arguments[2],i.length));for(i.splice(0,i.length),e=0;e<o.length;e++)i.push(o[e])}else if(4===arguments.length)for(t=i.slice(arguments[1],arguments[2]),n=arguments[3],r=function(e,t){return n.compare(e,t)},t.sort(r),o=i.slice(0,arguments[1]).concat(t,i.slice(arguments[2],i.length)),i.splice(0,i.length),e=0;e<o.length;e++)i.push(o[e])},Fe.asList=function(e){for(var t=new Se,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};var ze=function(){},Be={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Be.P.get=function(){return 0},Be.L.get=function(){return 1},Be.A.get=function(){return 2},Be.FALSE.get=function(){return-1},Be.TRUE.get=function(){return-2},Be.DONTCARE.get=function(){return-3},Be.SYM_FALSE.get=function(){return"F"},Be.SYM_TRUE.get=function(){return"T"},Be.SYM_DONTCARE.get=function(){return"*"},Be.SYM_P.get=function(){return"0"},Be.SYM_L.get=function(){return"1"},Be.SYM_A.get=function(){return"2"},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze},ze.toDimensionSymbol=function(e){switch(e){case ze.FALSE:return ze.SYM_FALSE;case ze.TRUE:return ze.SYM_TRUE;case ze.DONTCARE:return ze.SYM_DONTCARE;case ze.P:return ze.SYM_P;case ze.L:return ze.SYM_L;case ze.A:return ze.SYM_A}throw new v("Unknown dimension value: "+e)},ze.toDimensionValue=function(e){switch(N.toUpperCase(e)){case ze.SYM_FALSE:return ze.FALSE;case ze.SYM_TRUE:return ze.TRUE;case ze.SYM_DONTCARE:return ze.DONTCARE;case ze.SYM_P:return ze.P;case ze.SYM_L:return ze.L;case ze.SYM_A:return ze.A}throw new v("Unknown dimension symbol: "+e)},Object.defineProperties(ze,Be);var Ue=function(){};Ue.prototype.filter=function(e){},Ue.prototype.interfaces_=function(){return[]},Ue.prototype.getClass=function(){return Ue};var je=function(){};je.prototype.filter=function(e,t){},je.prototype.isDone=function(){},je.prototype.isGeometryChanged=function(){},je.prototype.interfaces_=function(){return[]},je.prototype.getClass=function(){return je};var Ve=function(e){function t(t,n){if(e.call(this,n),this._geometries=t||[],e.hasNullElements(this._geometries))throw new v("geometries must not contain null elements")}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var e=new W,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e},t.prototype.getGeometryN=function(e){return this._geometries[e]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this._geometries.length;n++)for(var r=this._geometries[n].getCoordinates(),i=0;i<r.length;i++)e[++t]=r[i];return e},t.prototype.getArea=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._geometries.length!==r._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(r._geometries[i],n))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();Fe.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var e=ze.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e},t.prototype.getDimension=function(){for(var e=ze.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e},t.prototype.getLength=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e},t.prototype.getNumPoints=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(t)},t.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=new p(Fe.asList(this._geometries)),n=new p(Fe.asList(e._geometries));return this.compare(t,n)}if(2===arguments.length){for(var r=arguments[1],i=arguments[0],o=this.getNumGeometries(),s=i.getNumGeometries(),a=0;a<o&&a<s;){var l=this.getGeometryN(a),c=i.getGeometryN(a),u=l.compareToSameClass(c,r);if(0!==u)return u;a++}return a<o?1:a<s?-1:0}},t.prototype.apply=function(){if(P(arguments[0],pe))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(P(arguments[0],je)){var n=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(n),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else if(P(arguments[0],Ue)){var i=arguments[0];i.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(i)}else if(P(arguments[0],ce)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),te.shouldNeverReachHere(),null},t.prototype.clone=function(){var t=e.prototype.clone.call(this);t._geometries=new Array(this._geometries.length).fill(null);for(var n=0;n<this._geometries.length;n++)t._geometries[n]=this._geometries[n].clone();return t},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),n=0;n<e.length;n++)e[n]=this._geometries[n].copy();return new t(e,this._factory)},t.prototype.isEmpty=function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(t,n),t}(ue),Ge=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ue.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&e.prototype.equalsExact.call(this,t,n)}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ze.FALSE:0},t.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[e-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(t)},t.prototype.getBoundary=function(){return new He(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),n=0;n<e.length;n++)e[n]=this._geometries[n].copy();return new t(e,this._factory)},t.prototype.interfaces_=function(){return[Ne]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(t,n),t}(Ve),He=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var e=arguments[0],t=fe.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};He.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return 1===t.length?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)},He.prototype.getBoundary=function(){return this._geom instanceof Xe?this.boundaryLineString(this._geom):this._geom instanceof Ge?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},He.prototype.boundaryLineString=function(e){return this._geom.isEmpty()?this.getEmptyMultiPoint():e.isClosed()?this._bnRule.isInBoundary(2)?e.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},He.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},He.prototype.computeBoundaryCoordinates=function(e){var t=new Se;this._endpointMap=new h;for(var n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var i=this._endpointMap.entrySet().iterator();i.hasNext();){var o=i.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&t.add(o.getKey())}return Te.toCoordinateArray(t)},He.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);null===t&&(t=new Ze,this._endpointMap.put(e,t)),t.count++},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He},He.getBoundary=function(){return 1===arguments.length?new He(arguments[0]).getBoundary():2===arguments.length?new He(arguments[0],arguments[1]).getBoundary():void 0};var Ze=function(){this.count=null};Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze};var We=function(){},$e={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We},We.chars=function(e,t){for(var n=new Array(t).fill(null),r=0;r<t;r++)n[r]=e;return String(n)},We.getStackTrace=function(){if(1===arguments.length){var e=arguments[0],t=new function(){},n=new function(){}(t);return e.printStackTrace(n),t.toString()}if(2===arguments.length){for(var r=arguments[1],i="",o=new function(){}(new function(){}(We.getStackTrace(arguments[0]))),s=0;s<r;s++)try{i+=o.readLine()+We.NEWLINE}catch(e){if(!(e instanceof f))throw e;te.shouldNeverReachHere()}return i}},We.split=function(e,t){for(var n=t.length,r=new Se,i=""+e,o=i.indexOf(t);o>=0;){var s=i.substring(0,o);r.add(s),o=(i=i.substring(o+n)).indexOf(t)}i.length>0&&r.add(i);for(var a=new Array(r.size()).fill(null),l=0;l<a.length;l++)a[l]=r.get(l);return a},We.toString=function(){if(1===arguments.length){var e=arguments[0];return We.SIMPLE_ORDINATE_FORMAT.format(e)}},We.spaces=function(e){return We.chars(" ",e)},$e.NEWLINE.get=function(){return H.getProperty("line.separator")},$e.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(We,$e);var qe=function(){};qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe},qe.copyCoord=function(e,t,n,r){for(var i=Math.min(e.getDimension(),n.getDimension()),o=0;o<i;o++)n.setOrdinate(r,o,e.getOrdinate(t,o))},qe.isRing=function(e){var t=e.size();return 0===t||!(t<=3)&&e.getOrdinate(0,U.X)===e.getOrdinate(t-1,U.X)&&e.getOrdinate(0,U.Y)===e.getOrdinate(t-1,U.Y)},qe.isEqual=function(e,t){var n=e.size();if(n!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),i=0;i<n;i++)for(var o=0;o<r;o++){var s=e.getOrdinate(i,o),a=t.getOrdinate(i,o);if(!(e.getOrdinate(i,o)===t.getOrdinate(i,o)||_.isNaN(s)&&_.isNaN(a)))return!1}return!0},qe.extend=function(e,t,n){var r=e.create(n,t.getDimension()),i=t.size();if(qe.copy(t,0,r,0,i),i>0)for(var o=i;o<n;o++)qe.copy(t,i-1,r,o,1);return r},qe.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)qe.swap(e,r,t-r)},qe.swap=function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var i=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,i)}},qe.copy=function(e,t,n,r,i){for(var o=0;o<i;o++)qe.copyCoord(e,t+o,n,r+o)},qe.toString=function(){if(1===arguments.length){var e=arguments[0],t=e.size();if(0===t)return"()";var n=e.getDimension(),r=new D;r.append("(");for(var i=0;i<t;i++){i>0&&r.append(" ");for(var o=0;o<n;o++)o>0&&r.append(","),r.append(We.toString(e.getOrdinate(i,o)))}return r.append(")"),r.toString()}},qe.ensureValidRing=function(e,t){var n=t.size();return 0===n?t:n<=3?qe.createClosedRing(e,t,4):t.getOrdinate(0,U.X)===t.getOrdinate(n-1,U.X)&&t.getOrdinate(0,U.Y)===t.getOrdinate(n-1,U.Y)?t:qe.createClosedRing(e,t,n+1)},qe.createClosedRing=function(e,t,n){var r=e.create(n,t.getDimension()),i=t.size();qe.copy(t,0,r,0,i);for(var o=i;o<n;o++)qe.copy(t,0,r,o,1);return r};var Xe=function(e){function t(t,n){e.call(this,n),this._points=null,this.init(t)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new W:this._points.expandEnvelope(new W)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t;if(this._points.size()!==r._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),r._points.getCoordinate(i),n))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t)))return this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0&&qe.reverse(this._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ze.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return ae.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var e=this._points.copy();return qe.reverse(e),this.getFactory().createLineString(e)},t.prototype.compareToSameClass=function(){if(1===arguments.length){for(var e=arguments[0],t=0,n=0;t<this._points.size()&&n<e._points.size();){var r=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(n));if(0!==r)return r;t++,n++}return t<this._points.size()?1:n<e._points.size()?-1:0}if(2===arguments.length){var i=arguments[0];return arguments[1].compare(this._points,i._points)}},t.prototype.apply=function(){if(P(arguments[0],pe))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(P(arguments[0],je)){var n=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(n.filter(this._points,r),!n.isDone());r++);n.isGeometryChanged()&&this.geometryChanged()}else(P(arguments[0],Ue)||P(arguments[0],ce))&&arguments[0].filter(this)},t.prototype.getBoundary=function(){return new He(this).getBoundary()},t.prototype.isEquivalentClass=function(e){return e instanceof t},t.prototype.clone=function(){var t=e.prototype.clone.call(this);return t._points=this._points.clone(),t},t.prototype.getCoordinateN=function(e){return this._points.getCoordinate(e)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return 0===this._points.size()},t.prototype.init=function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new v("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e},t.prototype.isCoordinate=function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))},t.prototype.interfaces_=function(){return[Ne]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(ue),Ye=function(){};Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ke=function(e){function t(t,n){e.call(this,n),this._coordinates=t||null,this.init(this._coordinates)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new W;var e=new W;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),n))}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return ze.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}},t.prototype.apply=function(){if(P(arguments[0],pe)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(P(arguments[0],je)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else(P(arguments[0],Ue)||P(arguments[0],ce))&&arguments[0].filter(this)},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var t=e.prototype.clone.call(this);return t._coordinates=this._coordinates.clone(),t},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return 0===this._coordinates.size()},t.prototype.init=function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),te.isTrue(e.size()<=1),this._coordinates=e},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Ye]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(t,n),t}(ue),Je=function(){};Je.prototype.interfaces_=function(){return[]},Je.prototype.getClass=function(){return Je};var Qe=function(e){function t(t,n,r){if(e.call(this,r),this._shell=null,this._holes=null,null===t&&(t=this.getFactory().createLinearRing()),null===n&&(n=[]),e.hasNullElements(n))throw new v("holes must not contain null elements");if(t.isEmpty()&&e.hasNonEmptyElements(n))throw new v("shell is empty but holes are not");this._shell=t,this._holes=n}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,n=this._shell.getCoordinates(),r=0;r<n.length;r++)e[++t]=n[r];for(var i=0;i<this._holes.length;i++)for(var o=this._holes[i].getCoordinates(),s=0;s<o.length;s++)e[++t]=o[s];return e},t.prototype.getArea=function(){var e=0;e+=Math.abs(ae.signedArea(this._shell.getCoordinateSequence()));for(var t=0;t<this._holes.length;t++)e-=Math.abs(ae.signedArea(this._holes[t].getCoordinateSequence()));return e},t.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var r=e.getX(n);if(r!==t.getMinX()&&r!==t.getMaxX())return!1;var i=e.getY(n);if(i!==t.getMinY()&&i!==t.getMaxY())return!1}for(var o=e.getX(0),s=e.getY(0),a=1;a<=4;a++){var l=e.getX(a),c=e.getY(a);if(l!==o==(c!==s))return!1;o=l,s=c}return!0},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];if(!this.isEquivalentClass(t))return!1;var r=t,i=this._shell,o=r._shell;if(!i.equalsExact(o,n))return!1;if(this._holes.length!==r._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(r._holes[s],n))return!1;return!0}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)this.normalize(this._holes[e],!1);Fe.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(t.isEmpty())return null;var r=new Array(t.getCoordinates().length-1).fill(null);H.arraycopy(t.getCoordinates(),0,r,0,r.length);var i=Te.minCoordinate(t.getCoordinates());Te.scroll(r,i),H.arraycopy(r,0,t.getCoordinates(),0,r.length),t.getCoordinates()[r.length]=r[0],ae.isCCW(t.getCoordinates())===n&&Te.reverse(t.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e},t.prototype.getNumPoints=function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e},t.prototype.reverse=function(){var e=this.copy();e._shell=this._shell.copy().reverse(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].copy().reverse();return e},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=this._shell,n=e._shell;return t.compareToSameClass(n)}if(2===arguments.length){var r=arguments[1],i=arguments[0],o=this._shell,s=i._shell,a=o.compareToSameClass(s,r);if(0!==a)return a;for(var l=this.getNumInteriorRing(),c=i.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),d=i.getInteriorRingN(u),p=h.compareToSameClass(d,r);if(0!==p)return p;u++}return u<l?1:u<c?-1:0}},t.prototype.apply=function(e){if(P(e,pe)){this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(P(e,je)){if(this._shell.apply(e),!e.isDone())for(var n=0;n<this._holes.length&&(this._holes[n].apply(e),!e.isDone());n++);e.isGeometryChanged()&&this.geometryChanged()}else if(P(e,Ue))e.filter(this);else if(P(e,ce)){e.filter(this),this._shell.apply(e);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(e)}},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},t.prototype.clone=function(){var t=e.prototype.clone.call(this);t._shell=this._shell.clone(),t._holes=new Array(this._holes.length).fill(null);for(var n=0;n<this._holes.length;n++)t._holes[n]=this._holes[n].clone();return t},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var e=this._shell.copy(),n=new Array(this._holes.length).fill(null),r=0;r<n.length;r++)n[r]=this._holes[r].copy();return new t(e,n,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(e){return this._holes[e]},t.prototype.interfaces_=function(){return[Je]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(ue),et=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ue.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&e.prototype.equalsExact.call(this,t,n)}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._geometries[t].getCoordinate()}return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return ze.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),n=0;n<e.length;n++)e[n]=this._geometries[n].copy();return new t(e,this._factory)},t.prototype.interfaces_=function(){return[Ye]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(t,n),t}(Ve),tt=function(e){function t(t,n){t instanceof M&&n instanceof yt&&(t=n.getCoordinateSequenceFactory().create(t)),e.call(this,t,n),this.validateConstruction()}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ue.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return ze.FALSE},t.prototype.isClosed=function(){return!!this.isEmpty()||e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var e=this._points.copy();return qe.reverse(e),this.getFactory().createLinearRing(e)},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new v("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new v("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Xe),nt=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ue.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&e.prototype.equalsExact.call(this,t,n)}return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),n=0;n<this._geometries.length;n++)t[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(t)},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new Se,t=0;t<this._geometries.length;t++)for(var n=this._geometries[t].getBoundary(),r=0;r<n.getNumGeometries();r++)e.add(n.getGeometryN(r));var i=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(i))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),n=0;n<e.length;n++)e[n]=this._geometries[n].copy();return new t(e,this._factory)},t.prototype.interfaces_=function(){return[Je]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(Ve),rt=function(e){this._factory=e||null,this._isUserDataCopied=!1},it={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};rt.prototype.setCopyUserData=function(e){this._isUserDataCopied=e},rt.prototype.edit=function(e,t){if(null===e)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n},rt.prototype.editInternal=function(e,t){return null===this._factory&&(this._factory=e.getFactory()),e instanceof Ve?this.editGeometryCollection(e,t):e instanceof Qe?this.editPolygon(e,t):e instanceof Ke||e instanceof Xe?t.edit(e,this._factory):(te.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},rt.prototype.editGeometryCollection=function(e,t){for(var n=t.edit(e,this._factory),r=new Se,i=0;i<n.getNumGeometries();i++){var o=this.edit(n.getGeometryN(i),t);null===o||o.isEmpty()||r.add(o)}return n.getClass()===et?this._factory.createMultiPoint(r.toArray([])):n.getClass()===Ge?this._factory.createMultiLineString(r.toArray([])):n.getClass()===nt?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},rt.prototype.editPolygon=function(e,t){var n=t.edit(e,this._factory);if(null===n&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var r=this.edit(n.getExteriorRing(),t);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var i=new Se,o=0;o<n.getNumInteriorRing();o++){var s=this.edit(n.getInteriorRingN(o),t);null===s||s.isEmpty()||i.add(s)}return this._factory.createPolygon(r,i.toArray([]))},rt.prototype.interfaces_=function(){return[]},rt.prototype.getClass=function(){return rt},rt.GeometryEditorOperation=function(){},it.NoOpGeometryOperation.get=function(){return ot},it.CoordinateOperation.get=function(){return st},it.CoordinateSequenceOperation.get=function(){return at},Object.defineProperties(rt,it);var ot=function(){};ot.prototype.edit=function(e,t){return e},ot.prototype.interfaces_=function(){return[rt.GeometryEditorOperation]},ot.prototype.getClass=function(){return ot};var st=function(){};st.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return null===n?e:e instanceof tt?t.createLinearRing(n):e instanceof Xe?t.createLineString(n):e instanceof Ke?n.length>0?t.createPoint(n[0]):t.createPoint():e},st.prototype.interfaces_=function(){return[rt.GeometryEditorOperation]},st.prototype.getClass=function(){return st};var at=function(){};at.prototype.edit=function(e,t){return e instanceof tt?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Xe?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Ke?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e},at.prototype.interfaces_=function(){return[rt.GeometryEditorOperation]},at.prototype.getClass=function(){return at};var lt=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var t=0;t<e;t++)this._coordinates[t]=new M}else if(P(arguments[0],U)){var n=arguments[0];if(null===n)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=n.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var i=arguments[0],o=arguments[1];this._coordinates=i,this._dimension=o,null===i&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new M}},ct={serialVersionUID:{configurable:!0}};lt.prototype.setOrdinate=function(e,t,n){switch(t){case U.X:this._coordinates[e].x=n;break;case U.Y:this._coordinates[e].y=n;break;case U.Z:this._coordinates[e].z=n;break;default:throw new v("invalid ordinateIndex")}},lt.prototype.size=function(){return this._coordinates.length},lt.prototype.getOrdinate=function(e,t){switch(t){case U.X:return this._coordinates[e].x;case U.Y:return this._coordinates[e].y;case U.Z:return this._coordinates[e].z}return _.NaN},lt.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}},lt.prototype.getCoordinateCopy=function(e){return new M(this._coordinates[e])},lt.prototype.getDimension=function(){return this._dimension},lt.prototype.getX=function(e){return this._coordinates[e].x},lt.prototype.clone=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].clone();return new lt(e,this._dimension)},lt.prototype.expandEnvelope=function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e},lt.prototype.copy=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].copy();return new lt(e,this._dimension)},lt.prototype.toString=function(){if(this._coordinates.length>0){var e=new D(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"},lt.prototype.getY=function(e){return this._coordinates[e].y},lt.prototype.toCoordinateArray=function(){return this._coordinates},lt.prototype.interfaces_=function(){return[U,t]},lt.prototype.getClass=function(){return lt},ct.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(lt,ct);var ut=function(){},ht={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ut.prototype.readResolve=function(){return ut.instance()},ut.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new lt(arguments[0]);if(P(arguments[0],U))return new lt(arguments[0])}else if(2===arguments.length){var e=arguments[0],t=arguments[1];return t>3&&(t=3),t<2?new lt(e):new lt(e,t)}},ut.prototype.interfaces_=function(){return[C,t]},ut.prototype.getClass=function(){return ut},ut.instance=function(){return ut.instanceObject},ht.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},ht.instanceObject.get=function(){return new ut},Object.defineProperties(ut,ht);var dt=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e){return this.map_.get(e)||null},t.prototype.put=function(e,t){return this.map_.set(e,t),t},t.prototype.values=function(){for(var e=new Se,t=this.map_.values(),n=t.next();!n.done;)e.add(n.value),n=t.next();return e},t.prototype.entrySet=function(){var e=new Le;return this.map_.entries().forEach((function(t){return e.add(t)})),e},t.prototype.size=function(){return this.map_.size()},t}(Pe),pt=function e(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof mt){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},ft={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};pt.prototype.equals=function(e){if(!(e instanceof pt))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale},pt.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new O(n).compareTo(new O(r))},pt.prototype.getScale=function(){return this._scale},pt.prototype.isFloating=function(){return this._modelType===pt.FLOATING||this._modelType===pt.FLOATING_SINGLE},pt.prototype.getType=function(){return this._modelType},pt.prototype.toString=function(){var e="UNKNOWN";return this._modelType===pt.FLOATING?e="Floating":this._modelType===pt.FLOATING_SINGLE?e="Floating-Single":this._modelType===pt.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},pt.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var e=arguments[0];return _.isNaN(e)||this._modelType===pt.FLOATING_SINGLE?e:this._modelType===pt.FIXED?Math.round(e*this._scale)/this._scale:e}if(arguments[0]instanceof M){var t=arguments[0];if(this._modelType===pt.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},pt.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===pt.FLOATING?e=16:this._modelType===pt.FLOATING_SINGLE?e=6:this._modelType===pt.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},pt.prototype.setScale=function(e){this._scale=Math.abs(e)},pt.prototype.interfaces_=function(){return[t,b]},pt.prototype.getClass=function(){return pt},pt.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t},ft.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ft.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(pt,ft);var mt=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},gt={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};mt.prototype.readResolve=function(){return mt.nameToTypeMap.get(this._name)},mt.prototype.toString=function(){return this._name},mt.prototype.interfaces_=function(){return[t]},mt.prototype.getClass=function(){return mt},gt.serialVersionUID.get=function(){return-552860263173159e4},gt.nameToTypeMap.get=function(){return new dt},Object.defineProperties(mt,gt),pt.Type=mt,pt.FIXED=new mt("FIXED"),pt.FLOATING=new mt("FLOATING"),pt.FLOATING_SINGLE=new mt("FLOATING SINGLE");var yt=function e(){this._precisionModel=new pt,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?P(arguments[0],C)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof pt&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},vt={serialVersionUID:{configurable:!0}};yt.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new M(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new M(e.getMinX(),e.getMinY()),new M(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new M(e.getMinX(),e.getMinY()),new M(e.getMinX(),e.getMaxY()),new M(e.getMaxX(),e.getMaxY()),new M(e.getMaxX(),e.getMinY()),new M(e.getMinX(),e.getMinY())]),null)},yt.prototype.createLineString=function(e){return e?e instanceof Array?new Xe(this.getCoordinateSequenceFactory().create(e),this):P(e,U)?new Xe(e,this):void 0:new Xe(this.getCoordinateSequenceFactory().create([]),this)},yt.prototype.createMultiLineString=function(){return 0===arguments.length?new Ge(null,this):1===arguments.length?new Ge(arguments[0],this):void 0},yt.prototype.buildGeometry=function(e){for(var t=null,n=!1,r=!1,i=e.iterator();i.hasNext();){var o=i.next(),s=o.getClass();null===t&&(t=s),s!==t&&(n=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===t)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(yt.toGeometryArray(e));var a=e.iterator().next();if(e.size()>1){if(a instanceof Qe)return this.createMultiPolygon(yt.toPolygonArray(e));if(a instanceof Xe)return this.createMultiLineString(yt.toLineStringArray(e));if(a instanceof Ke)return this.createMultiPoint(yt.toPointArray(e));te.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},yt.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)},yt.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof M){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(P(arguments[0],U))return new Ke(arguments[0],this)}},yt.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},yt.prototype.createPolygon=function(){if(0===arguments.length)return new Qe(null,null,this);if(1===arguments.length){if(P(arguments[0],U)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof tt){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Qe(arguments[0],arguments[1],this)},yt.prototype.getSRID=function(){return this._SRID},yt.prototype.createGeometryCollection=function(){return 0===arguments.length?new Ve(null,this):1===arguments.length?new Ve(arguments[0],this):void 0},yt.prototype.createGeometry=function(e){return new rt(this).edit(e,{edit:function(){if(2===arguments.length){var e=arguments[0];return this._coordinateSequenceFactory.create(e)}}})},yt.prototype.getPrecisionModel=function(){return this._precisionModel},yt.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(P(arguments[0],U))return new tt(arguments[0],this)}},yt.prototype.createMultiPolygon=function(){return 0===arguments.length?new nt(null,this):1===arguments.length?new nt(arguments[0],this):void 0},yt.prototype.createMultiPoint=function(){if(0===arguments.length)return new et(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new et(arguments[0],this);if(arguments[0]instanceof Array){var e=arguments[0];return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(P(arguments[0],U)){var t=arguments[0];if(null===t)return this.createMultiPoint(new Array(0).fill(null));for(var n=new Array(t.size()).fill(null),r=0;r<t.size();r++){var i=this.getCoordinateSequenceFactory().create(1,t.getDimension());qe.copy(t,r,i,0,1),n[r]=this.createPoint(i)}return this.createMultiPoint(n)}}},yt.prototype.interfaces_=function(){return[t]},yt.prototype.getClass=function(){return yt},yt.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toGeometryArray=function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.getDefaultCoordinateSequenceFactory=function(){return ut.instance()},yt.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},yt.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)},vt.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(yt,vt);var _t=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],xt=function(e){this.geometryFactory=e||new yt};xt.prototype.read=function(e){var t,n=(t="string"==typeof e?JSON.parse(e):e).type;if(!bt[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==_t.indexOf(n)?bt[n].apply(this,[t.coordinates]):"GeometryCollection"===n?bt[n].apply(this,[t.geometries]):bt[n].apply(this,[t])},xt.prototype.write=function(e){var t=e.getGeometryType();if(!wt[t])throw new Error("Geometry is not supported");return wt[t].apply(this,[e])};var bt={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var r=e.geometry.type;if(!bt[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=bt.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var n=0;n<e.features.length;++n)t.features.push(this.read(e.features[n]))}return e.bbox&&(t.bbox=this.parse.bbox.apply(this,[e.bbox])),t},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(new M(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new M(e[0],e[1]),new M(e[2],e[1]),new M(e[2],e[3]),new M(e[0],e[3]),new M(e[0],e[1])])},Point:function(e){var t=new M(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],n=0;n<e.length;++n)t.push(bt.Point.apply(this,[e[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=bt.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],n=0;n<e.length;++n)t.push(bt.LineString.apply(this,[e[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=bt.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(t),r=[],i=1;i<e.length;++i){var o=e[i],s=bt.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(n,r)},MultiPolygon:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(bt.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];t.push(this.read(r))}return this.geometryFactory.createGeometryCollection(t)}},wt={coordinate:function(e){return[e.x,e.y]},Point:function(e){return{type:"Point",coordinates:wt.coordinate.apply(this,[e.getCoordinate()])}},MultiPoint:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=wt.Point.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],n=e.getCoordinates(),r=0;r<n.length;++r){var i=n[r];t.push(wt.coordinate.apply(this,[i]))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=wt.LineString.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],n=wt.LineString.apply(this,[e._shell]);t.push(n.coordinates);for(var r=0;r<e._holes.length;++r){var i=e._holes[r],o=wt.LineString.apply(this,[i]);t.push(o.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=wt.Polygon.apply(this,[r]);t.push(i.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],n=0;n<e._geometries.length;++n){var r=e._geometries[n],i=r.getGeometryType();t.push(wt[i].apply(this,[r]))}return{type:"GeometryCollection",geometries:t}}},St=function(e){this.geometryFactory=e||new yt,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new xt(this.geometryFactory)};St.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===pt.FIXED&&this.reducePrecision(t),t},St.prototype.reducePrecision=function(e){var t,n;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(t=0,n=e.points.length;t<n;t++)this.precisionModel.makePrecise(e.points[t]);else if(e.geometries)for(t=0,n=e.geometries.length;t<n;t++)this.reducePrecision(e.geometries[t])};var Mt=function(){this.parser=new xt(this.geometryFactory)};Mt.prototype.write=function(e){return this.parser.write(e)};var Et=function(){},Tt={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Et.prototype.interfaces_=function(){return[]},Et.prototype.getClass=function(){return Et},Et.opposite=function(e){return e===Et.LEFT?Et.RIGHT:e===Et.RIGHT?Et.LEFT:e},Tt.ON.get=function(){return 0},Tt.LEFT.get=function(){return 1},Tt.RIGHT.get=function(){return 2},Object.defineProperties(Et,Tt),(m.prototype=new Error).name="EmptyStackException",(g.prototype=new we).add=function(e){return this.array_.push(e),!0},g.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]},g.prototype.push=function(e){return this.array_.push(e),e},g.prototype.pop=function(e){if(0===this.array_.length)throw new m;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new m;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(e){return this.array_.indexOf(e)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var e=[],t=0,n=this.array_.length;t<n;t++)e.push(this.array_[t]);return e};var Ct=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ct.prototype.getCoordinate=function(){return this._minCoord},Ct.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n},Ct.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();te.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=ae.computeOrientation(this._minCoord,n,t),i=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===ae.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===ae.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)},Ct.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var r=Et.LEFT;return n[t].y<n[t+1].y&&(r=Et.RIGHT),r},Ct.prototype.getEdge=function(){return this._orientedDe},Ct.prototype.checkForRightmostCoordinate=function(e){for(var t=e.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this._minCoord||t[n].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=n,this._minCoord=t[n])},Ct.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ct.prototype.findEdge=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}te.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Et.LEFT&&(this._orientedDe=this._minDe.getSym())},Ct.prototype.interfaces_=function(){return[]},Ct.prototype.getClass=function(){return Ct};var At=function(e){function t(n,r){e.call(this,t.msgWithCoord(n,r)),this.pt=r?new M(r):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(e,t){return t?e:e+" [ "+t+" ]"},t}(Q),It=function(){this.array_=[]};It.prototype.addLast=function(e){this.array_.push(e)},It.prototype.removeFirst=function(){return this.array_.shift()},It.prototype.isEmpty=function(){return 0===this.array_.length};var Pt=function(){this._finder=null,this._dirEdgeList=new Se,this._nodes=new Se,this._rightMostCoord=null,this._env=null,this._finder=new Ct};Pt.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)},Pt.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Pt.prototype.computeNodeDepth=function(e){for(var t=null,n=e.getEdges().iterator();n.hasNext();){var r=n.next();if(r.isVisited()||r.getSym().isVisited()){t=r;break}}if(null===t)throw new At("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var i=e.getEdges().iterator();i.hasNext();){var o=i.next();o.setVisited(!0),this.copySymDepths(o)}},Pt.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(Et.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)},Pt.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Pt.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(Et.RIGHT)>=1&&t.getDepth(Et.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},Pt.prototype.computeDepths=function(e){var t=new Le,n=new It,r=e.getNode();for(n.addLast(r),t.add(r),e.setVisited(!0);!n.isEmpty();){var i=n.removeFirst();t.add(i),this.computeNodeDepth(i);for(var o=i.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();t.contains(a)||(n.addLast(a),t.add(a))}}}},Pt.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0},Pt.prototype.getEnvelope=function(){if(null===this._env){for(var e=new W,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),r=0;r<n.length-1;r++)e.expandToInclude(n[r]);this._env=e}return this._env},Pt.prototype.addReachable=function(e){var t=new g;for(t.add(e);!t.empty();){var n=t.pop();this.add(n,t)}},Pt.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(Et.LEFT,e.getDepth(Et.RIGHT)),t.setDepth(Et.RIGHT,e.getDepth(Et.LEFT))},Pt.prototype.add=function(e,t){e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var r=n.next();this._dirEdgeList.add(r);var i=r.getSym().getNode();i.isVisited()||t.push(i)}},Pt.prototype.getNodes=function(){return this._nodes},Pt.prototype.getDirectedEdges=function(){return this._dirEdgeList},Pt.prototype.interfaces_=function(){return[b]},Pt.prototype.getClass=function(){return Pt};var Rt=function e(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[Et.ON]=n}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var i=0;i<this.location.length;i++)this.location[i]=r.location[i]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[Et.ON]=o,this.location[Et.LEFT]=s,this.location[Et.RIGHT]=a}};Rt.prototype.setAllLocations=function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e},Rt.prototype.isNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==A.NONE)return!1;return!0},Rt.prototype.setAllLocationsIfNull=function(e){for(var t=0;t<this.location.length;t++)this.location[t]===A.NONE&&(this.location[t]=e)},Rt.prototype.isLine=function(){return 1===this.location.length},Rt.prototype.merge=function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[Et.ON]=this.location[Et.ON],t[Et.LEFT]=A.NONE,t[Et.RIGHT]=A.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===A.NONE&&n<e.location.length&&(this.location[n]=e.location[n])},Rt.prototype.getLocations=function(){return this.location},Rt.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[Et.LEFT];this.location[Et.LEFT]=this.location[Et.RIGHT],this.location[Et.RIGHT]=e},Rt.prototype.toString=function(){var e=new D;return this.location.length>1&&e.append(A.toLocationSymbol(this.location[Et.LEFT])),e.append(A.toLocationSymbol(this.location[Et.ON])),this.location.length>1&&e.append(A.toLocationSymbol(this.location[Et.RIGHT])),e.toString()},Rt.prototype.setLocations=function(e,t,n){this.location[Et.ON]=e,this.location[Et.LEFT]=t,this.location[Et.RIGHT]=n},Rt.prototype.get=function(e){return e<this.location.length?this.location[e]:A.NONE},Rt.prototype.isArea=function(){return this.location.length>1},Rt.prototype.isAnyNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===A.NONE)return!0;return!1},Rt.prototype.setLocation=function(){if(1===arguments.length){var e=arguments[0];this.setLocation(Et.ON,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}},Rt.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(A.NONE)},Rt.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]},Rt.prototype.allPositionsEqual=function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0},Rt.prototype.interfaces_=function(){return[]},Rt.prototype.getClass=function(){return Rt};var Lt=function e(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Rt(t),this.elt[1]=new Rt(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Rt(n.elt[0]),this.elt[1]=new Rt(n.elt[1])}}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.elt[0]=new Rt(A.NONE),this.elt[1]=new Rt(A.NONE),this.elt[r].setLocation(i)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Rt(o,s,a),this.elt[1]=new Rt(o,s,a)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Rt(A.NONE,A.NONE,A.NONE),this.elt[1]=new Rt(A.NONE,A.NONE,A.NONE),this.elt[l].setLocations(c,u,h)}};Lt.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},Lt.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)},Lt.prototype.isNull=function(e){return this.elt[e].isNull()},Lt.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}},Lt.prototype.isLine=function(e){return this.elt[e].isLine()},Lt.prototype.merge=function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new Rt(e.elt[t]):this.elt[t].merge(e.elt[t])},Lt.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Lt.prototype.getLocation=function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get(Et.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}},Lt.prototype.toString=function(){var e=new D;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},Lt.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}},Lt.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()},Lt.prototype.setLocation=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(Et.ON,t)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}},Lt.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)},Lt.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)},Lt.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new Rt(this.elt[e].location[0]))},Lt.prototype.interfaces_=function(){return[]},Lt.prototype.getClass=function(){return Lt},Lt.toLineLabel=function(e){for(var t=new Lt(A.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var Dt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Se,this._pts=new Se,this._label=new Lt(A.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Se,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};Dt.prototype.computeRing=function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=ae.isCCW(this._ring.getCoordinates())},Dt.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Dt.prototype.computePoints=function(e){this._startDe=e;var t=e,n=!0;do{if(null===t)throw new At("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new At("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var r=t.getLabel();te.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)},Dt.prototype.getLinearRing=function(){return this._ring},Dt.prototype.getCoordinate=function(e){return this._pts.get(e)},Dt.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Dt.prototype.addPoints=function(e,t,n){var r=e.getCoordinates();if(t){var i=1;n&&(i=0);for(var o=i;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;n&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},Dt.prototype.isHole=function(){return this._isHole},Dt.prototype.setInResult=function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)},Dt.prototype.containsPoint=function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!ae.isPointInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(e))return!1;return!0},Dt.prototype.addHole=function(e){this._holes.add(e)},Dt.prototype.isShell=function(){return null===this._shell},Dt.prototype.getLabel=function(){return this._label},Dt.prototype.getEdges=function(){return this._edges},Dt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Dt.prototype.getShell=function(){return this._shell},Dt.prototype.mergeLabel=function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[1],n=arguments[0].getLocation(t,Et.RIGHT);if(n===A.NONE)return null;if(this._label.getLocation(t)===A.NONE)return this._label.setLocation(t,n),null}},Dt.prototype.setShell=function(e){this._shell=e,null!==e&&e.addHole(this)},Dt.prototype.toPolygon=function(e){for(var t=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)t[n]=this._holes.get(n).getLinearRing();return e.createPolygon(this.getLinearRing(),t)},Dt.prototype.interfaces_=function(){return[]},Dt.prototype.getClass=function(){return Dt};var Ot=function(e){function t(){var t=arguments[0],n=arguments[1];e.call(this,t,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(e,t){e.setMinEdgeRing(t)},t.prototype.getNext=function(e){return e.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Dt),Nt=function(e){function t(){var t=arguments[0],n=arguments[1];e.call(this,t,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var e=new Se,t=this._startDe;do{if(null===t.getMinEdgeRing()){var n=new Ot(t,this._geometryFactory);e.add(n)}t=t.getNext()}while(t!==this._startDe);return e},t.prototype.setEdgeRing=function(e,t){e.setEdgeRing(t)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)},t.prototype.getNext=function(e){return e.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Dt),kt=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}};kt.prototype.setVisited=function(e){this._isVisited=e},kt.prototype.setInResult=function(e){this._isInResult=e},kt.prototype.isCovered=function(){return this._isCovered},kt.prototype.isCoveredSet=function(){return this._isCoveredSet},kt.prototype.setLabel=function(e){this._label=e},kt.prototype.getLabel=function(){return this._label},kt.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0},kt.prototype.updateIM=function(e){te.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)},kt.prototype.isInResult=function(){return this._isInResult},kt.prototype.isVisited=function(){return this._isVisited},kt.prototype.interfaces_=function(){return[]},kt.prototype.getClass=function(){return kt};var Ft=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var t=arguments[0],n=arguments[1];this._coord=t,this._edges=n,this._label=new Lt(0,A.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1},t.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(e){e.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(e){},t.prototype.computeMergedLocation=function(e,t){var n=A.NONE;if(n=this._label.getLocation(t),!e.isNull(t)){var r=e.getLocation(t);n!==A.BOUNDARY&&(n=r)}return n},t.prototype.setLabel=function(){if(2!==arguments.length)return e.prototype.setLabel.apply(this,arguments);var t=arguments[0],n=arguments[1];null===this._label?this._label=new Lt(t,n):this._label.setLocation(t,n)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){if(arguments[0]instanceof t){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof Lt)for(var n=arguments[0],r=0;r<2;r++){var i=this.computeMergedLocation(n,r);this._label.getLocation(r)===A.NONE&&this._label.setLocation(r,i)}},t.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},t.prototype.setLabelBoundary=function(e){if(null===this._label)return null;var t=A.NONE;null!==this._label&&(t=this._label.getLocation(e));var n=null;if(t===A.BOUNDARY)n=A.INTERIOR;else n=A.BOUNDARY;this._label.setLocation(e,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(kt),zt=function(){this.nodeMap=new h,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};zt.prototype.find=function(e){return this.nodeMap.get(e)},zt.prototype.addNode=function(){if(arguments[0]instanceof M){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof Ft){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return null===r?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}},zt.prototype.print=function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)},zt.prototype.iterator=function(){return this.nodeMap.values().iterator()},zt.prototype.values=function(){return this.nodeMap.values()},zt.prototype.getBoundaryNodes=function(e){for(var t=new Se,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===A.BOUNDARY&&t.add(r)}return t},zt.prototype.add=function(e){var t=e.getCoordinate();this.addNode(t).add(e)},zt.prototype.interfaces_=function(){return[]},zt.prototype.getClass=function(){return zt};var Bt=function(){},Ut={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Bt.prototype.interfaces_=function(){return[]},Bt.prototype.getClass=function(){return Bt},Bt.isNorthern=function(e){return e===Bt.NE||e===Bt.NW},Bt.isOpposite=function(e,t){return e!==t&&2==(e-t+4)%4},Bt.commonHalfPlane=function(e,t){if(e===t)return e;if(2==(e-t+4)%4)return-1;var n=e<t?e:t;return 0===n&&3===(e>t?e:t)?3:n},Bt.isInHalfPlane=function(e,t){return t===Bt.SE?e===Bt.SE||e===Bt.SW:e===t||e===t+1},Bt.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new v("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?Bt.NE:Bt.SE:t>=0?Bt.NW:Bt.SW}if(arguments[0]instanceof M&&arguments[1]instanceof M){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new v("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Bt.NE:Bt.SE:r.y>=n.y?Bt.NW:Bt.SW}},Ut.NE.get=function(){return 0},Ut.NW.get=function(){return 1},Ut.SW.get=function(){return 2},Ut.SE.get=function(){return 3},Object.defineProperties(Bt,Ut);var jt=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var e=arguments[0];this._edge=e}else if(3===arguments.length){var t=arguments[0],n=arguments[1],r=arguments[2];this._edge=t,this.init(n,r),this._label=null}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=i,this.init(o,s),this._label=a}};jt.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:ae.computeOrientation(e._p0,e._p1,this._p1)},jt.prototype.getDy=function(){return this._dy},jt.prototype.getCoordinate=function(){return this._p0},jt.prototype.setNode=function(e){this._node=e},jt.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);e.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)},jt.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)},jt.prototype.getDirectedCoordinate=function(){return this._p1},jt.prototype.getDx=function(){return this._dx},jt.prototype.getLabel=function(){return this._label},jt.prototype.getEdge=function(){return this._edge},jt.prototype.getQuadrant=function(){return this._quadrant},jt.prototype.getNode=function(){return this._node},jt.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label},jt.prototype.computeLabel=function(e){},jt.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Bt.quadrant(this._dx,this._dy),te.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},jt.prototype.interfaces_=function(){return[b]},jt.prototype.getClass=function(){return jt};var Vt=function(e){function t(){var t=arguments[0],n=arguments[1];if(e.call(this,t),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var r=t.getNumPoints()-1;this.init(t.getCoordinate(r),t.getCoordinate(r-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(e){return this._depth[e]},t.prototype.setVisited=function(e){this._isVisited=e},t.prototype.computeDirectedLabel=function(){this._label=new Lt(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new At("assigned depths do not match",this.getCoordinate());this._depth[e]=t},t.prototype.isInteriorAreaEdge=function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,Et.LEFT)===A.INTERIOR&&this._label.getLocation(t,Et.RIGHT)===A.INTERIOR||(e=!1);return e},t.prototype.setNextMin=function(e){this._nextMin=e},t.prototype.print=function(t){e.prototype.print.call(this,t),t.print(" "+this._depth[Et.LEFT]+"/"+this._depth[Et.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},t.prototype.setMinEdgeRing=function(e){this._minEdgeRing=e},t.prototype.isLineEdge=function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,A.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,A.EXTERIOR);return e&&t&&n},t.prototype.setEdgeRing=function(e){this._edgeRing=e},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e},t.prototype.setInResult=function(e){this._isInResult=e},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)},t.prototype.setSym=function(e){this._sym=e},t.prototype.setVisitedEdge=function(e){this.setVisited(e),this._sym.setVisited(e)},t.prototype.setEdgeDepths=function(e,t){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var r=1;e===Et.LEFT&&(r=-1);var i=Et.opposite(e),o=t+n*r;this.setDepth(e,t),this.setDepth(i,o)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(e){this._next=e},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(e,t){return e===A.EXTERIOR&&t===A.INTERIOR?1:e===A.INTERIOR&&t===A.EXTERIOR?-1:0},t}(jt),Gt=function(){};Gt.prototype.createNode=function(e){return new Ft(e,null)},Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt};var Ht=function(){if(this._edges=new Se,this._nodes=null,this._edgeEndList=new Se,0===arguments.length)this._nodes=new zt(new Gt);else if(1===arguments.length){var e=arguments[0];this._nodes=new zt(e)}};Ht.prototype.printEdges=function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var n=this._edges.get(t);n.print(e),n.eiList.print(e)}},Ht.prototype.find=function(e){return this._nodes.find(e)},Ht.prototype.addNode=function(){if(arguments[0]instanceof Ft){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof M){var t=arguments[0];return this._nodes.addNode(t)}},Ht.prototype.getNodeIterator=function(){return this._nodes.iterator()},Ht.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},Ht.prototype.debugPrintln=function(e){H.out.println(e)},Ht.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(null===n)return!1;var r=n.getLabel();return null!==r&&r.getLocation(e)===A.BOUNDARY},Ht.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()},Ht.prototype.matchInSameDirection=function(e,t,n,r){return!!e.equals(n)&&ae.computeOrientation(e,t,r)===ae.COLLINEAR&&Bt.quadrant(e,t)===Bt.quadrant(n,r)},Ht.prototype.getEdgeEnds=function(){return this._edgeEndList},Ht.prototype.debugPrint=function(e){H.out.print(e)},Ht.prototype.getEdgeIterator=function(){return this._edges.iterator()},Ht.prototype.findEdgeInSameDirection=function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(this.matchInSameDirection(e,t,i[0],i[1]))return r;if(this.matchInSameDirection(e,t,i[i.length-1],i[i.length-2]))return r}return null},Ht.prototype.insertEdge=function(e){this._edges.add(e)},Ht.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null},Ht.prototype.addEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this._edges.add(n);var r=new Vt(n,!0),i=new Vt(n,!1);r.setSym(i),i.setSym(r),this.add(r),this.add(i)}},Ht.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)},Ht.prototype.getNodes=function(){return this._nodes.values()},Ht.prototype.findEdge=function(e,t){for(var n=0;n<this._edges.size();n++){var r=this._edges.get(n),i=r.getCoordinates();if(e.equals(i[0])&&t.equals(i[1]))return r}return null},Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht},Ht.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()};var Zt=function(){this._geometryFactory=null,this._shellList=new Se;var e=arguments[0];this._geometryFactory=e};Zt.prototype.sortShellsAndHoles=function(e,t,n){for(var r=e.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):t.add(i)}},Zt.prototype.computePolygons=function(e){for(var t=new Se,n=e.iterator();n.hasNext();){var r=n.next().toPolygon(this._geometryFactory);t.add(r)}return t},Zt.prototype.placeFreeHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();if(null===r.getShell()){var i=this.findEdgeRingContaining(r,e);if(null===i)throw new At("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(i)}}},Zt.prototype.buildMinimalEdgeRings=function(e,t,n){for(var r=new Se,i=e.iterator();i.hasNext();){var o=i.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),t.add(a)):n.addAll(s)}else r.add(o)}return r},Zt.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();)if(t.next().containsPoint(e))return!0;return!1},Zt.prototype.buildMaximalEdgeRings=function(e){for(var t=new Se,n=e.iterator();n.hasNext();){var r=n.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var i=new Nt(r,this._geometryFactory);t.add(i),i.setInResult()}}return t},Zt.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}},Zt.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Zt.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),o=null,s=null,a=t.iterator();a.hasNext();){var l=a.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;u.contains(r)&&ae.isPointInRing(i,c.getCoordinates())&&(h=!0),h&&(null===o||s.contains(u))&&(o=l)}return o},Zt.prototype.findShell=function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,t++)}return te.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n},Zt.prototype.add=function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0];Ht.linkResultDirectedEdges(arguments[1]);var n=this.buildMaximalEdgeRings(t),r=new Se,i=this.buildMinimalEdgeRings(n,this._shellList,r);this.sortShellsAndHoles(i,this._shellList,r),this.placeFreeHoles(this._shellList,r)}},Zt.prototype.interfaces_=function(){return[]},Zt.prototype.getClass=function(){return Zt};var Wt=function(){};Wt.prototype.getBounds=function(){},Wt.prototype.interfaces_=function(){return[]},Wt.prototype.getClass=function(){return Wt};var $t=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};$t.prototype.getItem=function(){return this._item},$t.prototype.getBounds=function(){return this._bounds},$t.prototype.interfaces_=function(){return[Wt,t]},$t.prototype.getClass=function(){return $t};var qt=function(){this._size=null,this._items=null,this._size=0,this._items=new Se,this._items.add(null)};qt.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e},qt.prototype.size=function(){return this._size},qt.prototype.reorder=function(e){for(var t=null,n=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(n)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,n)},qt.prototype.clear=function(){this._size=0,this._items.clear()},qt.prototype.isEmpty=function(){return 0===this._size},qt.prototype.add=function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)},qt.prototype.interfaces_=function(){return[]},qt.prototype.getClass=function(){return qt};var Xt=function(){};Xt.prototype.visitItem=function(e){},Xt.prototype.interfaces_=function(){return[]},Xt.prototype.getClass=function(){return Xt};var Yt=function(){};Yt.prototype.insert=function(e,t){},Yt.prototype.remove=function(e,t){},Yt.prototype.query=function(){},Yt.prototype.interfaces_=function(){return[]},Yt.prototype.getClass=function(){return Yt};var Kt=function(){if(this._childBoundables=new Se,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}},Jt={serialVersionUID:{configurable:!0}};Kt.prototype.getLevel=function(){return this._level},Kt.prototype.size=function(){return this._childBoundables.size()},Kt.prototype.getChildBoundables=function(){return this._childBoundables},Kt.prototype.addChildBoundable=function(e){te.isTrue(null===this._bounds),this._childBoundables.add(e)},Kt.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Kt.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Kt.prototype.interfaces_=function(){return[Wt,t]},Kt.prototype.getClass=function(){return Kt},Jt.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Kt,Jt);var Qt=function(){};Qt.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}},Qt.min=function(e){return Qt.sort(e),e.get(0)},Qt.sort=function(e,t){var n=e.toArray();t?Fe.sort(n,t):Fe.sort(n);for(var r=e.iterator(),i=0,o=n.length;i<o;i++)r.next(),r.set(n[i])},Qt.singletonList=function(e){var t=new Se;return t.add(e),t};var en=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};en.prototype.expandToQueue=function(e,t){var n=en.isComposite(this._boundable1),r=en.isComposite(this._boundable2);if(n&&r)return en.area(this._boundable1)>en.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new v("neither boundable is composite")},en.prototype.isLeaves=function(){return!(en.isComposite(this._boundable1)||en.isComposite(this._boundable2))},en.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0},en.prototype.expand=function(e,t,n,r){for(var i=e.getChildBoundables().iterator();i.hasNext();){var o=i.next(),s=new en(o,t,this._itemDistance);s.getDistance()<r&&n.add(s)}},en.prototype.getBoundable=function(e){return 0===e?this._boundable1:this._boundable2},en.prototype.getDistance=function(){return this._distance},en.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},en.prototype.interfaces_=function(){return[b]},en.prototype.getClass=function(){return en},en.area=function(e){return e.getBounds().getArea()},en.isComposite=function(e){return e instanceof Kt};var tn=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new Se,this._nodeCapacity=null,0===arguments.length){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(1===arguments.length){var n=arguments[0];te.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},nn={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};tn.prototype.getNodeCapacity=function(){return this._nodeCapacity},tn.prototype.lastNode=function(e){return e.get(e.size()-1)},tn.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();n instanceof Kt?e+=this.size(n):n instanceof $t&&(e+=1)}return e}},tn.prototype.removeItem=function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof $t&&i.getItem()===t&&(n=i)}return null!==n&&(e.getChildBoundables().remove(n),!0)},tn.prototype.itemsTree=function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new Se:e}if(1===arguments.length){for(var t=arguments[0],n=new Se,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Kt){var o=this.itemsTree(i);null!==o&&n.add(o)}else i instanceof $t?n.add(i.getItem()):te.shouldNeverReachHere()}return n.size()<=0?null:n}},tn.prototype.insert=function(e,t){te.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new $t(e,t))},tn.prototype.boundablesAtLevel=function(){if(1===arguments.length){var e=arguments[0],t=new Se;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];if(te.isTrue(n>-2),r.getLevel()===n)return i.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Kt?this.boundablesAtLevel(n,s,i):(te.isTrue(s instanceof $t),-1===n&&i.add(s))}return null}},tn.prototype.query=function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new Se;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,t),t}if(2===arguments.length){var n=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,r)}else if(3===arguments.length)if(P(arguments[2],Xt)&&arguments[0]instanceof Object&&arguments[1]instanceof Kt)for(var i=arguments[0],o=arguments[2],s=arguments[1].getChildBoundables(),a=0;a<s.size();a++){var l=s.get(a);this.getIntersectsOp().intersects(l.getBounds(),i)&&(l instanceof Kt?this.query(i,l,o):l instanceof $t?o.visitItem(l.getItem()):te.shouldNeverReachHere())}else if(P(arguments[2],we)&&arguments[0]instanceof Object&&arguments[1]instanceof Kt)for(var c=arguments[0],u=arguments[2],h=arguments[1].getChildBoundables(),d=0;d<h.size();d++){var p=h.get(d);this.getIntersectsOp().intersects(p.getBounds(),c)&&(p instanceof Kt?this.query(c,p,u):p instanceof $t?u.add(p.getItem()):te.shouldNeverReachHere())}},tn.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},tn.prototype.getRoot=function(){return this.build(),this._root},tn.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=this.removeItem(r,i);if(o)return!0;for(var s=null,a=r.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),n)&&l instanceof Kt&&(o=this.remove(n,l,i))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),o}},tn.prototype.createHigherLevels=function(e,t){te.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)},tn.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var n=t.next();if(n instanceof Kt){var r=this.depth(n);r>e&&(e=r)}}return e+1}},tn.prototype.createParentBoundables=function(e,t){te.isTrue(!e.isEmpty());var n=new Se;n.add(this.createNode(t));var r=new Se(e);Qt.sort(r,this.getComparator());for(var i=r.iterator();i.hasNext();){var o=i.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(o)}return n},tn.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},tn.prototype.interfaces_=function(){return[t]},tn.prototype.getClass=function(){return tn},tn.compareDoubles=function(e,t){return e>t?1:e<t?-1:0},nn.IntersectsOp.get=function(){return rn},nn.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},nn.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(tn,nn);var rn=function(){},on=function(){};on.prototype.distance=function(e,t){},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on};var sn=function(e){function n(t){t=t||n.DEFAULT_NODE_CAPACITY,e.call(this,t)}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return n.prototype.createParentBoundablesFromVerticalSlices=function(e,t){te.isTrue(e.length>0);for(var n=new Se,r=0;r<e.length;r++)n.addAll(this.createParentBoundablesFromVerticalSlice(e[r],t));return n},n.prototype.createNode=function(e){return new an(e)},n.prototype.size=function(){return 0===arguments.length?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},n.prototype.insert=function(){if(2!==arguments.length)return e.prototype.insert.apply(this,arguments);var t=arguments[0],n=arguments[1];if(t.isNull())return null;e.prototype.insert.call(this,t,n)},n.prototype.getIntersectsOp=function(){return n.intersectsOp},n.prototype.verticalSlices=function(e,t){for(var n=Math.trunc(Math.ceil(e.size()/t)),r=new Array(t).fill(null),i=e.iterator(),o=0;o<t;o++){r[o]=new Se;for(var s=0;i.hasNext()&&s<n;){var a=i.next();r[o].add(a),s++}}return r},n.prototype.query=function(){if(1===arguments.length){var t=arguments[0];return e.prototype.query.call(this,t)}if(2===arguments.length){var n=arguments[0],r=arguments[1];e.prototype.query.call(this,n,r)}else if(3===arguments.length)if(P(arguments[2],Xt)&&arguments[0]instanceof Object&&arguments[1]instanceof Kt){var i=arguments[0],o=arguments[1],s=arguments[2];e.prototype.query.call(this,i,o,s)}else if(P(arguments[2],we)&&arguments[0]instanceof Object&&arguments[1]instanceof Kt){var a=arguments[0],l=arguments[1],c=arguments[2];e.prototype.query.call(this,a,l,c)}},n.prototype.getComparator=function(){return n.yComparator},n.prototype.createParentBoundablesFromVerticalSlice=function(t,n){return e.prototype.createParentBoundables.call(this,t,n)},n.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return e.prototype.remove.call(this,t,n)}return e.prototype.remove.apply(this,arguments)},n.prototype.depth=function(){return 0===arguments.length?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},n.prototype.createParentBoundables=function(e,t){te.isTrue(!e.isEmpty());var r=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),i=new Se(e);Qt.sort(i,n.xComparator);var o=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,t)},n.prototype.nearestNeighbour=function(){if(1===arguments.length){if(P(arguments[0],on)){var e=arguments[0],t=new en(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof en){var r=arguments[0];return this.nearestNeighbour(r,_.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof n&&P(arguments[1],on)){var i=arguments[0],o=arguments[1],s=new en(this.getRoot(),i.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof en&&"number"==typeof arguments[1]){var a=arguments[0],l=arguments[1],c=null,u=new qt;for(u.add(a);!u.isEmpty()&&l>0;){var h=u.poll(),d=h.getDistance();if(d>=l)break;h.isLeaves()?(l=d,c=h):h.expandToQueue(u,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var p=arguments[2],f=new $t(arguments[0],arguments[1]),m=new en(this.getRoot(),f,p);return this.nearestNeighbour(m)[0]}},n.prototype.interfaces_=function(){return[Yt,t]},n.prototype.getClass=function(){return n},n.centreX=function(e){return n.avg(e.getMinX(),e.getMaxX())},n.avg=function(e,t){return(e+t)/2},n.centreY=function(e){return n.avg(e.getMinY(),e.getMaxY())},r.STRtreeNode.get=function(){return an},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[S]},compare:function(t,r){return e.compareDoubles(n.centreX(t.getBounds()),n.centreX(r.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[S]},compare:function(t,r){return e.compareDoubles(n.centreY(t.getBounds()),n.centreY(r.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(e,t){return e.intersects(t)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(n,r),n}(tn),an=function(e){function t(){var t=arguments[0];e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===e?e=new W(n.getBounds()):e.expandToInclude(n.getBounds())}return e},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kt),ln=function(){};ln.prototype.interfaces_=function(){return[]},ln.prototype.getClass=function(){return ln},ln.relativeSign=function(e,t){return e<t?-1:e>t?1:0},ln.compare=function(e,t,n){if(t.equals2D(n))return 0;var r=ln.relativeSign(t.x,n.x),i=ln.relativeSign(t.y,n.y);switch(e){case 0:return ln.compareValue(r,i);case 1:return ln.compareValue(i,r);case 2:return ln.compareValue(i,-r);case 3:return ln.compareValue(-r,i);case 4:return ln.compareValue(-r,-i);case 5:return ln.compareValue(-i,-r);case 6:return ln.compareValue(-i,r);case 7:return ln.compareValue(r,-i)}return te.shouldNeverReachHere("invalid octant value"),0},ln.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var cn=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._segString=e,this.coord=new M(t),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(n))};cn.prototype.getCoordinate=function(){return this.coord},cn.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},cn.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:ln.compare(this._segmentOctant,this.coord,t.coord)},cn.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e},cn.prototype.isInterior=function(){return this._isInterior},cn.prototype.interfaces_=function(){return[b]},cn.prototype.getClass=function(){return cn};var un=function(){this._nodeMap=new h,this._edge=null;var e=arguments[0];this._edge=e};un.prototype.getSplitCoordinates=function(){var e=new Ee;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next();this.addEdgeCoordinates(n,r,e),n=r}return e.toCoordinateArray()},un.prototype.addCollapsedNodes=function(){var e=new Se;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._edge.getCoordinate(n),n)}},un.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},un.prototype.findCollapsesFromExistingVertices=function(e){for(var t=0;t<this._edge.size()-2;t++){var n=this._edge.getCoordinate(t),r=this._edge.getCoordinate(t+2);n.equals2D(r)&&e.add(new O(t+1))}},un.prototype.addEdgeCoordinates=function(e,t,n){var r=this._edge.getCoordinate(t.segmentIndex),i=t.isInterior()||!t.coord.equals2D(r);n.add(new M(e.coord),!1);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)n.add(this._edge.getCoordinate(o));i&&n.add(new M(t.coord))},un.prototype.iterator=function(){return this._nodeMap.values().iterator()},un.prototype.addSplitEdges=function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}},un.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,1===r&&(n[0]=e.segmentIndex+1,!0)},un.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=new Array(1).fill(null),n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();this.findCollapseIndex(r,i,t)&&e.add(new O(t[0])),r=i}},un.prototype.getEdge=function(){return this._edge},un.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)},un.prototype.createSplitEdge=function(e,t){var n=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),i=t.isInterior()||!t.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new M(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return i&&(o[s]=new M(t.coord)),new fn(o,this._edge.getData())},un.prototype.add=function(e,t){var n=new cn(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return null!==r?(te.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)},un.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new Q("bad split edge start point at "+n);var r=e.get(e.size()-1).getCoordinates(),i=r[r.length-1];if(!i.equals2D(t[t.length-1]))throw new Q("bad split edge end point at "+i)},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un};var hn=function(){};hn.prototype.interfaces_=function(){return[]},hn.prototype.getClass=function(){return hn},hn.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new v("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?n>=r?0:1:n>=r?7:6:t>=0?n>=r?3:2:n>=r?4:5}if(arguments[0]instanceof M&&arguments[1]instanceof M){var i=arguments[0],o=arguments[1],s=o.x-i.x,a=o.y-i.y;if(0===s&&0===a)throw new v("Cannot compute the octant for two identical points "+i);return hn.octant(s,a)}};var dn=function(){};dn.prototype.getCoordinates=function(){},dn.prototype.size=function(){},dn.prototype.getCoordinate=function(e){},dn.prototype.isClosed=function(){},dn.prototype.setData=function(e){},dn.prototype.getData=function(){},dn.prototype.interfaces_=function(){return[]},dn.prototype.getClass=function(){return dn};var pn=function(){};pn.prototype.addIntersection=function(e,t){},pn.prototype.interfaces_=function(){return[dn]},pn.prototype.getClass=function(){return pn};var fn=function(){this._nodeList=new un(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};fn.prototype.getCoordinates=function(){return this._pts},fn.prototype.size=function(){return this._pts.length},fn.prototype.getCoordinate=function(e){return this._pts[e]},fn.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},fn.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},fn.prototype.setData=function(e){this._data=e},fn.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:hn.octant(e,t)},fn.prototype.getData=function(){return this._data},fn.prototype.addIntersection=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var n=arguments[1],r=arguments[3],i=new M(arguments[0].getIntersection(r));this.addIntersection(i,n)}},fn.prototype.toString=function(){return J.toLineString(new lt(this._pts))},fn.prototype.getNodeList=function(){return this._nodeList},fn.prototype.addIntersectionNode=function(e,t){var n=t,r=n+1;if(r<this._pts.length){var i=this._pts[r];e.equals2D(i)&&(n=r)}return this._nodeList.add(e,n)},fn.prototype.addIntersections=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)},fn.prototype.interfaces_=function(){return[pn]},fn.prototype.getClass=function(){return fn},fn.getNodedSubstrings=function(){if(1===arguments.length){var e=arguments[0],t=new Se;return fn.getNodedSubstrings(e,t),t}if(2===arguments.length)for(var n=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(n)};var mn=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new M,this.p1=new M;else if(1===arguments.length){var e=arguments[0];this.p0=new M(e.p0),this.p1=new M(e.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new M(t,n),this.p1=new M(r,i)}},gn={serialVersionUID:{configurable:!0}};mn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},mn.prototype.orientationIndex=function(){if(arguments[0]instanceof mn){var e=arguments[0],t=ae.orientationIndex(this.p0,this.p1,e.p0),n=ae.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}if(arguments[0]instanceof M){var r=arguments[0];return ae.orientationIndex(this.p0,this.p1,r)}},mn.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])},mn.prototype.isVertical=function(){return this.p0.x===this.p1.x},mn.prototype.equals=function(e){if(!(e instanceof mn))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},mn.prototype.intersection=function(e){var t=new ie;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null},mn.prototype.project=function(){if(arguments[0]instanceof M){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new M(e);var t=this.projectionFactor(e),n=new M;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof mn){var r=arguments[0],i=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(i>=1&&o>=1)return null;if(i<=0&&o<=0)return null;var s=this.project(r.p0);i<0&&(s=this.p0),i>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new mn(s,a)}},mn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},mn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},mn.prototype.getCoordinate=function(e){return 0===e?this.p0:this.p1},mn.prototype.distancePerpendicular=function(e){return ae.distancePointLinePerpendicular(e,this.p0,this.p1)},mn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},mn.prototype.midPoint=function(){return mn.midPoint(this.p0,this.p1)},mn.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;return r<=0?_.NaN:((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r},mn.prototype.closestPoints=function(e){var t=this.intersection(e);if(null!==t)return[t,t];var n=new Array(2).fill(null),r=_.MAX_VALUE,i=null,o=this.closestPoint(e.p0);r=o.distance(e.p0),n[0]=o,n[1]=e.p0;var s=this.closestPoint(e.p1);(i=s.distance(e.p1))<r&&(r=i,n[0]=s,n[1]=e.p1);var a=e.closestPoint(this.p0);(i=a.distance(this.p0))<r&&(r=i,n[0]=this.p0,n[1]=a);var l=e.closestPoint(this.p1);return(i=l.distance(this.p1))<r&&(r=i,n[0]=this.p1,n[1]=l),n},mn.prototype.closestPoint=function(e){var t=this.projectionFactor(e);return t>0&&t<1?this.project(e):this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1},mn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},mn.prototype.getLength=function(){return this.p0.distance(this.p1)},mn.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)},mn.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e},mn.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)},mn.prototype.lineIntersection=function(e){try{return Z.intersection(this.p0,this.p1,e.p0,e.p1)}catch(e){if(!(e instanceof G))throw e}return null},mn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},mn.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(i*i+o*o),a=0,l=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*i/s,l=t*o/s}return new M(n-l,r+a)},mn.prototype.setCoordinates=function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}},mn.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||_.isNaN(t))&&(t=1),t},mn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},mn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},mn.prototype.distance=function(){if(arguments[0]instanceof mn){var e=arguments[0];return ae.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof M){var t=arguments[0];return ae.distancePointLine(t,this.p0,this.p1)}},mn.prototype.pointAlong=function(e){var t=new M;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t},mn.prototype.hashCode=function(){var e=_.doubleToLongBits(this.p0.x);e^=31*_.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),n=_.doubleToLongBits(this.p1.x);return n^=31*_.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)},mn.prototype.interfaces_=function(){return[b,t]},mn.prototype.getClass=function(){return mn},mn.midPoint=function(e,t){return new M((e.x+t.x)/2,(e.y+t.y)/2)},gn.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(mn,gn);var yn=function(){this.tempEnv1=new W,this.tempEnv2=new W,this._overlapSeg1=new mn,this._overlapSeg2=new mn};yn.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[1],t=arguments[2],n=arguments[3];arguments[0].getLineSegment(e,this._overlapSeg1),t.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn};var vn=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=r};vn.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]},vn.prototype.computeSelect=function(e,t,n,r){var i=this._pts[t],o=this._pts[n];if(r.tempEnv1.init(i,o),n-t==1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var s=Math.trunc((t+n)/2);t<s&&this.computeSelect(e,t,s,r),s<n&&this.computeSelect(e,s,n,r)},vn.prototype.getCoordinates=function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,n=this._start;n<=this._end;n++)e[t++]=this._pts[n];return e},vn.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)},vn.prototype.setId=function(e){this._id=e},vn.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)},vn.prototype.getEnvelope=function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new W(e,t)}return this._env},vn.prototype.getEndIndex=function(){return this._end},vn.prototype.getStartIndex=function(){return this._start},vn.prototype.getContext=function(){return this._context},vn.prototype.getId=function(){return this._id},vn.prototype.computeOverlapsInternal=function(e,t,n,r,i,o){var s=this._pts[e],a=this._pts[t],l=n._pts[r],c=n._pts[i];if(t-e==1&&i-r==1)return o.overlap(this,e,n,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((e+t)/2),h=Math.trunc((r+i)/2);e<u&&(r<h&&this.computeOverlapsInternal(e,u,n,r,h,o),h<i&&this.computeOverlapsInternal(e,u,n,h,i,o)),u<t&&(r<h&&this.computeOverlapsInternal(u,t,n,r,h,o),h<i&&this.computeOverlapsInternal(u,t,n,h,i,o))},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn};var _n=function(){};_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},_n.getChainStartIndices=function(e){var t=0,n=new Se;n.add(new O(t));do{var r=_n.findChainEnd(e,t);n.add(new O(r)),t=r}while(t<e.length-1);return _n.toIntArray(n)},_n.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=Bt.quadrant(e[n],e[n+1]),i=t+1;i<e.length&&(e[i-1].equals2D(e[i])||Bt.quadrant(e[i-1],e[i])===r);)i++;return i-1},_n.getChains=function(){if(1===arguments.length)return _n.getChains(arguments[0],null);if(2===arguments.length){for(var e=arguments[0],t=arguments[1],n=new Se,r=_n.getChainStartIndices(e),i=0;i<r.length-1;i++){var o=new vn(e,r[i],r[i+1],t);n.add(o)}return n}},_n.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var xn=function(){};xn.prototype.computeNodes=function(e){},xn.prototype.getNodedSubstrings=function(){},xn.prototype.interfaces_=function(){return[]},xn.prototype.getClass=function(){return xn};var bn=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}};bn.prototype.setSegmentIntersector=function(e){this._segInt=e},bn.prototype.interfaces_=function(){return[xn]},bn.prototype.getClass=function(){return bn};var wn=function(e){function t(t){t?e.call(this,t):e.call(this),this._monoChains=new Se,this._index=new sn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return fn.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(e){for(var t=_n.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var n=t.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},t.prototype.computeNodes=function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var e=new Sn(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var n=t.next(),r=this._index.query(n.getEnvelope()).iterator();r.hasNext();){var i=r.next();if(i.getId()>n.getId()&&(n.computeOverlaps(i,e),this._nOverlaps++),this._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return Sn},Object.defineProperties(t,n),t}(bn),Sn=function(e){function t(){e.call(this),this._si=null;var t=arguments[0];this._si=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(4!==arguments.length)return e.prototype.overlap.apply(this,arguments);var t=arguments[1],n=arguments[2],r=arguments[3],i=arguments[0].getContext(),o=n.getContext();this._si.processIntersections(i,t,o,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(yn),Mn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(4===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},En={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Mn.prototype.getEndCapStyle=function(){return this._endCapStyle},Mn.prototype.isSingleSided=function(){return this._isSingleSided},Mn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,0===this._quadrantSegments&&(this._joinStyle=Mn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Mn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Mn.JOIN_ROUND&&(this._quadrantSegments=Mn.DEFAULT_QUADRANT_SEGMENTS)},Mn.prototype.getJoinStyle=function(){return this._joinStyle},Mn.prototype.setJoinStyle=function(e){this._joinStyle=e},Mn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e},Mn.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Mn.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Mn.prototype.setEndCapStyle=function(e){this._endCapStyle=e},Mn.prototype.getMitreLimit=function(){return this._mitreLimit},Mn.prototype.setMitreLimit=function(e){this._mitreLimit=e},Mn.prototype.setSingleSided=function(e){this._isSingleSided=e},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn},Mn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)},En.CAP_ROUND.get=function(){return 1},En.CAP_FLAT.get=function(){return 2},En.CAP_SQUARE.get=function(){return 3},En.JOIN_ROUND.get=function(){return 1},En.JOIN_MITRE.get=function(){return 2},En.JOIN_BEVEL.get=function(){return 3},En.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},En.DEFAULT_MITRE_LIMIT.get=function(){return 5},En.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Mn,En);var Tn=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ae.COUNTERCLOCKWISE,this._inputLine=e||null},Cn={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Tn.prototype.isDeletable=function(e,t,n,r){var i=this._inputLine[e],o=this._inputLine[t],s=this._inputLine[n];return!!this.isConcave(i,o,s)&&!!this.isShallow(i,o,s,r)&&this.isShallowSampled(i,o,e,n,r)},Tn.prototype.deleteShallowConcavities=function(){for(var e=1,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t),r=!1;n<this._inputLine.length;){var i=!1;this.isDeletable(e,t,n,this._distanceTol)&&(this._isDeleted[t]=Tn.DELETE,i=!0,r=!0),e=i?n:t,t=this.findNextNonDeletedIndex(e),n=this.findNextNonDeletedIndex(t)}return r},Tn.prototype.isShallowConcavity=function(e,t,n,r){return ae.computeOrientation(e,t,n)===this._angleOrientation&&ae.distancePointLine(t,e,n)<r},Tn.prototype.isShallowSampled=function(e,t,n,r,i){var o=Math.trunc((r-n)/Tn.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=n;s<r;s+=o)if(!this.isShallow(e,t,this._inputLine[s],i))return!1;return!0},Tn.prototype.isConcave=function(e,t,n){return ae.computeOrientation(e,t,n)===this._angleOrientation},Tn.prototype.simplify=function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=ae.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},Tn.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===Tn.DELETE;)t++;return t},Tn.prototype.isShallow=function(e,t,n,r){return ae.distancePointLine(t,e,n)<r},Tn.prototype.collapseLine=function(){for(var e=new Ee,t=0;t<this._inputLine.length;t++)this._isDeleted[t]!==Tn.DELETE&&e.add(this._inputLine[t]);return e.toCoordinateArray()},Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Tn.simplify=function(e,t){return new Tn(e).simplify(t)},Cn.INIT.get=function(){return 0},Cn.DELETE.get=function(){return 1},Cn.KEEP.get=function(){return 1},Cn.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Tn,Cn);var An=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Se},In={COORDINATE_ARRAY_TYPE:{configurable:!0}};An.prototype.getCoordinates=function(){return this._ptList.toArray(An.COORDINATE_ARRAY_TYPE)},An.prototype.setPrecisionModel=function(e){this._precisionModel=e},An.prototype.addPt=function(e){var t=new M(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)},An.prototype.revere=function(){},An.prototype.addPts=function(e,t){if(t)for(var n=0;n<e.length;n++)this.addPt(e[n]);else for(var r=e.length-1;r>=0;r--)this.addPt(e[r])},An.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance},An.prototype.toString=function(){return(new yt).createLineString(this.getCoordinates()).toString()},An.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new M(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)},An.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e},An.prototype.interfaces_=function(){return[]},An.prototype.getClass=function(){return An},In.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(An,In);var Pn=function(){},Rn={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.toDegrees=function(e){return 180*e/Math.PI},Pn.normalize=function(e){for(;e>Math.PI;)e-=Pn.PI_TIMES_2;for(;e<=-Math.PI;)e+=Pn.PI_TIMES_2;return e},Pn.angle=function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],r=n.x-t.x,i=n.y-t.y;return Math.atan2(i,r)}},Pn.isAcute=function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)>0},Pn.isObtuse=function(e,t,n){var r=e.x-t.x,i=e.y-t.y;return r*(n.x-t.x)+i*(n.y-t.y)<0},Pn.interiorAngle=function(e,t,n){var r=Pn.angle(t,e),i=Pn.angle(t,n);return Math.abs(i-r)},Pn.normalizePositive=function(e){if(e<0){for(;e<0;)e+=Pn.PI_TIMES_2;e>=Pn.PI_TIMES_2&&(e=0)}else{for(;e>=Pn.PI_TIMES_2;)e-=Pn.PI_TIMES_2;e<0&&(e=0)}return e},Pn.angleBetween=function(e,t,n){var r=Pn.angle(t,e),i=Pn.angle(t,n);return Pn.diff(r,i)},Pn.diff=function(e,t){var n=null;return(n=e<t?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n},Pn.toRadians=function(e){return e*Math.PI/180},Pn.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?Pn.COUNTERCLOCKWISE:n<0?Pn.CLOCKWISE:Pn.NONE},Pn.angleBetweenOriented=function(e,t,n){var r=Pn.angle(t,e),i=Pn.angle(t,n)-r;return i<=-Math.PI?i+Pn.PI_TIMES_2:i>Math.PI?i-Pn.PI_TIMES_2:i},Rn.PI_TIMES_2.get=function(){return 2*Math.PI},Rn.PI_OVER_2.get=function(){return Math.PI/2},Rn.PI_OVER_4.get=function(){return Math.PI/4},Rn.COUNTERCLOCKWISE.get=function(){return ae.COUNTERCLOCKWISE},Rn.CLOCKWISE.get=function(){return ae.CLOCKWISE},Rn.NONE.get=function(){return ae.COLLINEAR},Object.defineProperties(Pn,Rn);var Ln=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new mn,this._seg1=new mn,this._offset0=new mn,this._offset1=new mn,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new ie,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Mn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Dn={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ln.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=ae.computeOrientation(this._s0,this._s1,this._s2),r=n===ae.CLOCKWISE&&this._side===Et.LEFT||n===ae.COUNTERCLOCKWISE&&this._side===Et.RIGHT;0===n?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)},Ln.prototype.addLineEndCap=function(e,t){var n=new mn(e,t),r=new mn;this.computeOffsetSegment(n,Et.LEFT,this._distance,r);var i=new mn;this.computeOffsetSegment(n,Et.RIGHT,this._distance,i);var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Mn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,ae.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Mn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Mn.CAP_SQUARE:var l=new M;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var c=new M(r.p1.x+l.x,r.p1.y+l.y),u=new M(i.p1.x+l.x,i.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}},Ln.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Ln.prototype.addMitreJoin=function(e,t,n,r){var i=!0,o=null;try{o=Z.intersection(t.p0,t.p1,n.p0,n.p1),(r<=0?1:o.distance(e)/Math.abs(r))>this._bufParams.getMitreLimit()&&(i=!1)}catch(e){if(!(e instanceof G))throw e;o=new M(0,0),i=!1}i?this._segList.addPt(o):this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())},Ln.prototype.addFilletCorner=function(e,t,n,r,i){var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o),l=n.x-e.x,c=n.y-e.y,u=Math.atan2(c,l);r===ae.CLOCKWISE?a<=u&&(a+=2*Math.PI):a>=u&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,u,r,i),this._segList.addPt(n)},Ln.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ln.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Mn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Mn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))},Ln.prototype.createSquare=function(e){this._segList.addPt(new M(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new M(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new M(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new M(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()},Ln.prototype.addSegments=function(e,t){this._segList.addPts(e,t)},Ln.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Ln.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Ln.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},Ln.prototype.addLimitedMitreJoin=function(e,t,n,r){var i=this._seg0.p1,o=Pn.angle(i,this._seg0.p0),s=Pn.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1)/2,a=Pn.normalize(o+s),l=Pn.normalize(a+Math.PI),c=r*n,u=n-c*Math.abs(Math.sin(s)),h=i.x+c*Math.cos(l),d=i.y+c*Math.sin(l),p=new M(h,d),f=new mn(i,p),m=f.pointAlongOffset(1,u),g=f.pointAlongOffset(1,-u);this._side===Et.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Ln.prototype.computeOffsetSegment=function(e,t,n,r){var i=t===Et.LEFT?1:-1,o=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,a=Math.sqrt(o*o+s*s),l=i*n*o/a,c=i*n*s/a;r.p0.x=e.p0.x-c,r.p0.y=e.p0.y+l,r.p1.x=e.p1.x-c,r.p1.y=e.p1.y+l},Ln.prototype.addFilletArc=function(e,t,n,r,i){var o=r===ae.CLOCKWISE?-1:1,s=Math.abs(t-n),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,c=0,u=new M;c<s;){var h=t+o*c;u.x=e.x+i*Math.cos(h),u.y=e.y+i*Math.sin(h),this._segList.addPt(u),c+=l}},Ln.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ln.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new M((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new M((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Ln.prototype.createCircle=function(e){var t=new M(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Ln.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)},Ln.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new An,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Ln.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Ln.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Mn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Mn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,ae.CLOCKWISE,this._distance))},Ln.prototype.closeRing=function(){this._segList.closeRing()},Ln.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Dn.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Dn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Dn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Dn.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Ln,Dn);var On=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};On.prototype.getOffsetCurve=function(e,t){if(this._distance=t,0===t)return null;var n=t<0,r=Math.abs(t),i=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],i):this.computeOffsetCurve(e,n,i);var o=i.getCoordinates();return n&&Te.reverse(o),o},On.prototype.computeSingleSidedBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var i=Tn.simplify(e,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Et.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{n.addSegments(e,!1);var a=Tn.simplify(e,r),l=a.length-1;n.initSideSegments(a[0],a[1],Et.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(a[c],!0)}n.addLastSegment(),n.closeRing()},On.prototype.computeRingBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);t===Et.RIGHT&&(r=-r);var i=Tn.simplify(e,r),o=i.length-1;n.initSideSegments(i[o-1],i[0],t);for(var s=1;s<=o;s++){var a=1!==s;n.addNextSegment(i[s],a)}n.closeRing()},On.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),r=Tn.simplify(e,n),i=r.length-1;t.initSideSegments(r[0],r[1],Et.LEFT);for(var o=2;o<=i;o++)t.addNextSegment(r[o],!0);t.addLastSegment(),t.addLineEndCap(r[i-1],r[i]);var s=Tn.simplify(e,-n),a=s.length-1;t.initSideSegments(s[a],s[a-1],Et.LEFT);for(var l=a-2;l>=0;l--)t.addNextSegment(s[l],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},On.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Mn.CAP_ROUND:t.createCircle(e);break;case Mn.CAP_SQUARE:t.createSquare(e)}},On.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided())return null;if(0===t)return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var i=t<0;this.computeSingleSidedBufferCurve(e,i,r)}else this.computeLineBufferCurve(e,r);return r.getCoordinates()},On.prototype.getBufferParameters=function(){return this._bufParams},On.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()},On.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(0===n)return On.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()},On.prototype.computeOffsetCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var i=Tn.simplify(e,-r),o=i.length-1;n.initSideSegments(i[o],i[o-1],Et.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(i[s],!0)}else{var a=Tn.simplify(e,r),l=a.length-1;n.initSideSegments(a[0],a[1],Et.LEFT),n.addFirstSegment();for(var c=2;c<=l;c++)n.addNextSegment(a[c],!0)}n.addLastSegment()},On.prototype.getSegGen=function(e){return new Ln(this._precisionModel,this._bufParams,e)},On.prototype.interfaces_=function(){return[]},On.prototype.getClass=function(){return On},On.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new M(e[n]);return t};var Nn=function(){this._subgraphs=null,this._seg=new mn,this._cga=new ae;var e=arguments[0];this._subgraphs=e},kn={DepthSegment:{configurable:!0}};Nn.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var e=arguments[0],t=new Se,n=this._subgraphs.iterator();n.hasNext();){var r=n.next(),i=r.getEnvelope();e.y<i.getMinY()||e.y>i.getMaxY()||this.findStabbedSegments(e,r.getDirectedEdges(),t)}return t}if(3===arguments.length)if(P(arguments[2],we)&&arguments[0]instanceof M&&arguments[1]instanceof Vt){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||ae.computeOrientation(this._seg.p0,this._seg.p1,o)===ae.RIGHT)){var u=s.getDepth(Et.LEFT);this._seg.p0.equals(l[c])||(u=s.getDepth(Et.RIGHT));var h=new Fn(this._seg,u);a.add(h)}}else if(P(arguments[2],we)&&arguments[0]instanceof M&&P(arguments[1],we))for(var d=arguments[0],p=arguments[2],f=arguments[1].iterator();f.hasNext();){var m=f.next();m.isForward()&&this.findStabbedSegments(d,m,p)}},Nn.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);return 0===t.size()?0:Qt.min(t)._leftDepth},Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},kn.DepthSegment.get=function(){return Fn},Object.defineProperties(Nn,kn);var Fn=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new mn(e),this._leftDepth=t};Fn.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==n||0!=(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(t._upwardSeg)},Fn.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return 0!==n?n:e.p1.compareTo(t.p1)},Fn.prototype.toString=function(){return this._upwardSeg.toString()},Fn.prototype.interfaces_=function(){return[b]},Fn.prototype.getClass=function(){return Fn};var zn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};zn.prototype.area=function(){return zn.area(this.p0,this.p1,this.p2)},zn.prototype.signedArea=function(){return zn.signedArea(this.p0,this.p1,this.p2)},zn.prototype.interpolateZ=function(e){if(null===e)throw new v("Supplied point is null.");return zn.interpolateZ(e,this.p0,this.p1,this.p2)},zn.prototype.longestSideLength=function(){return zn.longestSideLength(this.p0,this.p1,this.p2)},zn.prototype.isAcute=function(){return zn.isAcute(this.p0,this.p1,this.p2)},zn.prototype.circumcentre=function(){return zn.circumcentre(this.p0,this.p1,this.p2)},zn.prototype.area3D=function(){return zn.area3D(this.p0,this.p1,this.p2)},zn.prototype.centroid=function(){return zn.centroid(this.p0,this.p1,this.p2)},zn.prototype.inCentre=function(){return zn.inCentre(this.p0,this.p1,this.p2)},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)},zn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2},zn.det=function(e,t,n,r){return e*r-t*n},zn.interpolateZ=function(e,t,n,r){var i=t.x,o=t.y,s=n.x-i,a=r.x-i,l=n.y-o,c=r.y-o,u=s*c-a*l,h=e.x-i,d=e.y-o,p=(c*h-a*d)/u,f=(-l*h+s*d)/u;return t.z+p*(n.z-t.z)+f*(r.z-t.z)},zn.longestSideLength=function(e,t,n){var r=e.distance(t),i=t.distance(n),o=n.distance(e),s=r;return i>s&&(s=i),o>s&&(s=o),s},zn.isAcute=function(e,t,n){return!!Pn.isAcute(e,t,n)&&!!Pn.isAcute(t,n,e)&&!!Pn.isAcute(n,e,t)},zn.circumcentre=function(e,t,n){var r=n.x,i=n.y,o=e.x-r,s=e.y-i,a=t.x-r,l=t.y-i,c=2*zn.det(o,s,a,l),u=zn.det(s,o*o+s*s,l,a*a+l*l),h=zn.det(o,o*o+s*s,a,a*a+l*l);return new M(r-u/c,i+h/c)},zn.perpendicularBisector=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=new Z(e.x+n/2,e.y+r/2,1),o=new Z(e.x-r+n/2,e.y+n+r/2,1);return new Z(i,o)},zn.angleBisector=function(e,t,n){var r=t.distance(e),i=r/(r+t.distance(n)),o=n.x-e.x,s=n.y-e.y;return new M(e.x+i*o,e.y+i*s)},zn.area3D=function(e,t,n){var r=t.x-e.x,i=t.y-e.y,o=t.z-e.z,s=n.x-e.x,a=n.y-e.y,l=n.z-e.z,c=i*l-o*a,u=o*s-r*l,h=r*a-i*s,d=c*c+u*u+h*h;return Math.sqrt(d)/2},zn.centroid=function(e,t,n){var r=(e.x+t.x+n.x)/3,i=(e.y+t.y+n.y)/3;return new M(r,i)},zn.inCentre=function(e,t,n){var r=t.distance(n),i=e.distance(n),o=e.distance(t),s=r+i+o,a=(r*e.x+i*t.x+o*n.x)/s,l=(r*e.y+i*t.y+o*n.y)/s;return new M(a,l)};var Bn=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Se;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};Bn.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,A.EXTERIOR,A.INTERIOR)},Bn.prototype.addPolygon=function(e){var t=this._distance,n=Et.LEFT;this._distance<0&&(t=-this._distance,n=Et.RIGHT);var r=e.getExteriorRing(),i=Te.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&i.length<3)return null;this.addPolygonRing(i,t,n,A.EXTERIOR,A.INTERIOR);for(var o=0;o<e.getNumInteriorRing();o++){var s=e.getInteriorRingN(o),a=Te.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,t,Et.opposite(n),A.INTERIOR,A.EXTERIOR)}},Bn.prototype.isTriangleErodedCompletely=function(e,t){var n=new zn(e[0],e[1],e[2]),r=n.inCentre();return ae.distancePointLine(r,n.p0,n.p1)<Math.abs(t)},Bn.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=Te.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,A.EXTERIOR,A.INTERIOR)},Bn.prototype.addCurve=function(e,t,n){if(null===e||e.length<2)return null;var r=new fn(e,new Lt(0,A.BOUNDARY,t,n));this._curveList.add(r)},Bn.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Bn.prototype.addPolygonRing=function(e,t,n,r,i){if(0===t&&e.length<tt.MINIMUM_VALID_SIZE)return null;var o=r,s=i;e.length>=tt.MINIMUM_VALID_SIZE&&ae.isCCW(e)&&(o=i,s=r,n=Et.opposite(n));var a=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(a,o,s)},Bn.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Qe?this.addPolygon(e):e instanceof Xe?this.addLineString(e):e instanceof Ke?this.addPoint(e):(e instanceof et||e instanceof Ge||e instanceof nt||e instanceof Ve)&&this.addCollection(e)},Bn.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>i},Bn.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn};var Un=function(){};Un.prototype.locate=function(e){},Un.prototype.interfaces_=function(){return[]},Un.prototype.getClass=function(){return Un};var jn=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};jn.prototype.next=function(){if(this._atStart)return this._atStart=!1,jn.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new r;var e=this._parent.getGeometryN(this._index++);return e instanceof Ve?(this._subcollectionIterator=new jn(e),this._subcollectionIterator.next()):e},jn.prototype.remove=function(){throw new Error(this.getClass().getName())},jn.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},jn.prototype.interfaces_=function(){return[be]},jn.prototype.getClass=function(){return jn},jn.isAtomic=function(e){return!(e instanceof Ve)};var Vn=function(){this._geom=null;var e=arguments[0];this._geom=e};Vn.prototype.locate=function(e){return Vn.locate(e,this._geom)},Vn.prototype.interfaces_=function(){return[Un]},Vn.prototype.getClass=function(){return Vn},Vn.isPointInRing=function(e,t){return!!t.getEnvelopeInternal().intersects(e)&&ae.isPointInRing(e,t.getCoordinates())},Vn.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!Vn.isPointInRing(e,n))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var i=t.getInteriorRingN(r);if(Vn.isPointInRing(e,i))return!1}return!0},Vn.containsPoint=function(e,t){if(t instanceof Qe)return Vn.containsPointInPolygon(e,t);if(t instanceof Ve)for(var n=new jn(t);n.hasNext();){var r=n.next();if(r!==t&&Vn.containsPoint(e,r))return!0}return!1},Vn.locate=function(e,t){return t.isEmpty()?A.EXTERIOR:Vn.containsPoint(e,t)?A.INTERIOR:A.EXTERIOR};var Gn=function(){this._edgeMap=new h,this._edgeList=null,this._ptInAreaLocation=[A.NONE,A.NONE]};Gn.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return 0===t&&(n=this._edgeList.size()-1),this._edgeList.get(n)},Gn.prototype.propagateSideLabels=function(e){for(var t=A.NONE,n=this.iterator();n.hasNext();){var r=n.next().getLabel();r.isArea(e)&&r.getLocation(e,Et.LEFT)!==A.NONE&&(t=r.getLocation(e,Et.LEFT))}if(t===A.NONE)return null;for(var i=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(e,Et.ON)===A.NONE&&a.setLocation(e,Et.ON,i),a.isArea(e)){var l=a.getLocation(e,Et.LEFT),c=a.getLocation(e,Et.RIGHT);if(c!==A.NONE){if(c!==i)throw new At("side location conflict",s.getCoordinate());l===A.NONE&&te.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),i=l}else te.isTrue(a.getLocation(e,Et.LEFT)===A.NONE,"found single null side"),a.setLocation(e,Et.RIGHT,i),a.setLocation(e,Et.LEFT,i)}}},Gn.prototype.getCoordinate=function(){var e=this.iterator();return e.hasNext()?e.next().getCoordinate():null},Gn.prototype.print=function(e){H.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)},Gn.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Gn.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel().getLocation(e,Et.LEFT);te.isTrue(r!==A.NONE,"Found unlabelled area edge");for(var i=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();te.isTrue(s.isArea(e),"Found non-area edge");var a=s.getLocation(e,Et.LEFT),l=s.getLocation(e,Et.RIGHT);if(a===l)return!1;if(l!==i)return!1;i=a}return!0},Gn.prototype.findIndex=function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1},Gn.prototype.iterator=function(){return this.getEdges().iterator()},Gn.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Se(this._edgeMap.values())),this._edgeList},Gn.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===A.NONE&&(this._ptInAreaLocation[e]=Vn.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]},Gn.prototype.toString=function(){var e=new D;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append("\n")}return e.toString()},Gn.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)},Gn.prototype.computeLabelling=function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var r=n.next().getLabel(),i=0;i<2;i++)r.isLine(i)&&r.getLocation(i)===A.BOUNDARY&&(t[i]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var c=A.NONE;if(t[l])c=A.EXTERIOR;else{var u=s.getCoordinate();c=this.getLocation(l,u,e)}a.setAllLocationsIfNull(l,c)}},Gn.prototype.getDegree=function(){return this._edgeMap.size()},Gn.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null},Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn};var Hn=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var e=null,t=null,n=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var i=this._resultAreaEdgeList.get(r),o=i.getSym();if(i.getLabel().isArea())switch(null===e&&i.isInResult()&&(e=i),n){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;t=o,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!i.isInResult())continue;t.setNext(i),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===e)throw new At("no outgoing dirEdge found",this.getCoordinate());te.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}},t.prototype.insert=function(e){var t=e;this.insertEdgeEnd(t,t)},t.prototype.getRightmostEdge=function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var n=e.get(0);if(1===t)return n;var r=e.get(t-1),i=n.getQuadrant(),o=r.getQuadrant();return Bt.isNorthern(i)&&Bt.isNorthern(o)?n:Bt.isNorthern(i)||Bt.isNorthern(o)?0!==n.getDy()?n:0!==r.getDy()?r:(te.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},t.prototype.print=function(e){H.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();e.print("out "),n.print(e),e.println(),e.print("in "),n.getSym().print(e),e.println()}},t.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Se;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,e.getLocation(0)),n.setAllLocationsIfNull(1,e.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var e=null,t=null,n=this._edgeList.size()-1;n>=0;n--){var r=this._edgeList.get(n),i=r.getSym();null===t&&(t=i),null!==e&&i.setNext(e),e=r}t.setNext(e)},t.prototype.computeDepths=function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),n=e.getDepth(Et.LEFT),r=e.getDepth(Et.RIGHT),i=this.computeDepths(t+1,this._edgeList.size(),n);if(this.computeDepths(0,t,i)!==r)throw new At("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var l=this._edgeList.get(a);l.setEdgeDepths(Et.RIGHT,s),s=l.getDepth(Et.LEFT)}return s}},t.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(e){for(var t=null,n=null,r=this._SCANNING_FOR_INCOMING,i=this._resultAreaEdgeList.size()-1;i>=0;i--){var o=this._resultAreaEdgeList.get(i),s=o.getSym();switch(null===t&&o.getEdgeRing()===e&&(t=o),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==e)continue;n=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==e)continue;n.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(te.isTrue(null!==t,"found null for first outgoing dirEdge"),te.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),n.setNextMin(t))},t.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var n=arguments[0],r=0,i=this.iterator();i.hasNext();)i.next().getEdgeRing()===n&&r++;return r}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var e=A.NONE,t=this.iterator();t.hasNext();){var n=t.next(),r=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){e=A.INTERIOR;break}if(r.isInResult()){e=A.EXTERIOR;break}}}if(e===A.NONE)return null;for(var i=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(i===A.INTERIOR):(s.isInResult()&&(i=A.EXTERIOR),a.isInResult()&&(i=A.INTERIOR))}},t.prototype.computeLabelling=function(t){e.prototype.computeLabelling.call(this,t),this._label=new Lt(A.NONE);for(var n=this.iterator();n.hasNext();)for(var r=n.next().getEdge().getLabel(),i=0;i<2;i++){var o=r.getLocation(i);o!==A.INTERIOR&&o!==A.BOUNDARY||this._label.setLocation(i,A.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Gn),Zn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(e){return new Ft(e,new Hn)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Gt),Wn=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Wn.prototype.compareTo=function(e){var t=e;return Wn.compareOriented(this._pts,this._orientation,t._pts,t._orientation)},Wn.prototype.interfaces_=function(){return[b]},Wn.prototype.getClass=function(){return Wn},Wn.orientation=function(e){return 1===Te.increasingDirection(e)},Wn.compareOriented=function(e,t,n,r){for(var i=t?1:-1,o=r?1:-1,s=t?e.length:-1,a=r?n.length:-1,l=t?0:e.length-1,c=r?0:n.length-1;;){var u=e[l].compareTo(n[c]);if(0!==u)return u;var h=(l+=i)===s,d=(c+=o)===a;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}};var $n=function(){this._edges=new Se,this._ocaMap=new h};$n.prototype.print=function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var n=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var r=n.getCoordinates(),i=0;i<r.length;i++)i>0&&e.print(","),e.print(r[i].x+" "+r[i].y);e.println(")")}e.print(")  ")},$n.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())},$n.prototype.findEdgeIndex=function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1},$n.prototype.iterator=function(){return this._edges.iterator()},$n.prototype.getEdges=function(){return this._edges},$n.prototype.get=function(e){return this._edges.get(e)},$n.prototype.findEqualEdge=function(e){var t=new Wn(e.getCoordinates());return this._ocaMap.get(t)},$n.prototype.add=function(e){this._edges.add(e);var t=new Wn(e.getCoordinates());this._ocaMap.put(t,e)},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n};var qn=function(){};qn.prototype.processIntersections=function(e,t,n,r){},qn.prototype.isDone=function(){},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn};var Xn=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Xn.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&1===this._li.getIntersectionNum()){if(Xn.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var i=e.size()-1;if(0===t&&r===i||0===r&&t===i)return!0}}return!1},Xn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Xn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Xn.prototype.getLineIntersector=function(){return this._li},Xn.prototype.hasProperIntersection=function(){return this._hasProper},Xn.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Xn.prototype.hasIntersection=function(){return this._hasIntersection},Xn.prototype.isDone=function(){return!1},Xn.prototype.hasInteriorIntersection=function(){return this._hasInterior},Xn.prototype.interfaces_=function(){return[qn]},Xn.prototype.getClass=function(){return Xn},Xn.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)};var Yn=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new M(e),this.segmentIndex=t,this.dist=n};Yn.prototype.getSegmentIndex=function(){return this.segmentIndex},Yn.prototype.getCoordinate=function(){return this.coord},Yn.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},Yn.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)},Yn.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e},Yn.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Yn.prototype.getDistance=function(){return this.dist},Yn.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0},Yn.prototype.interfaces_=function(){return[b]},Yn.prototype.getClass=function(){return Yn};var Kn=function(){this._nodeMap=new h,this.edge=null;var e=arguments[0];this.edge=e};Kn.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},Kn.prototype.iterator=function(){return this._nodeMap.values().iterator()},Kn.prototype.addSplitEdges=function(e){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var r=t.next(),i=this.createSplitEdge(n,r);e.add(i),n=r}},Kn.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},Kn.prototype.createSplitEdge=function(e,t){var n=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],i=t.dist>0||!t.coord.equals2D(r);i||n--;var o=new Array(n).fill(null),s=0;o[s++]=new M(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this.edge.pts[a];return i&&(o[s]=t.coord),new nr(o,new Lt(this.edge._label))},Kn.prototype.add=function(e,t,n){var r=new Yn(e,t,n),i=this._nodeMap.get(r);return null!==i?i:(this._nodeMap.put(r,r),r)},Kn.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1},Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn};var Jn=function(){};Jn.prototype.getChainStartIndices=function(e){var t=0,n=new Se;n.add(new O(t));do{var r=this.findChainEnd(e,t);n.add(new O(r)),t=r}while(t<e.length-1);return Jn.toIntArray(n)},Jn.prototype.findChainEnd=function(e,t){for(var n=Bt.quadrant(e[t],e[t+1]),r=t+1;r<e.length&&Bt.quadrant(e[r-1],e[r])===n;)r++;return r-1},Jn.prototype.interfaces_=function(){return[]},Jn.prototype.getClass=function(){return Jn},Jn.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var Qn=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new W,this.env2=new W;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Jn;this.startIndex=t.getChainStartIndices(this.pts)};Qn.prototype.getCoordinates=function(){return this.pts},Qn.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n},Qn.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n},Qn.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r)}else if(6===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],c=arguments[5],u=this.pts[i],h=this.pts[o],d=s.pts[a],p=s.pts[l];if(o-i==1&&l-a==1)return c.addIntersections(this.e,i,s.e,a),null;if(this.env1.init(u,h),this.env2.init(d,p),!this.env1.intersects(this.env2))return null;var f=Math.trunc((i+o)/2),m=Math.trunc((a+l)/2);i<f&&(a<m&&this.computeIntersectsForChain(i,f,s,a,m,c),m<l&&this.computeIntersectsForChain(i,f,s,m,l,c)),f<o&&(a<m&&this.computeIntersectsForChain(f,o,s,a,m,c),m<l&&this.computeIntersectsForChain(f,o,s,m,l,c))}},Qn.prototype.getStartIndexes=function(){return this.startIndex},Qn.prototype.computeIntersects=function(e,t){for(var n=0;n<this.startIndex.length-1;n++)for(var r=0;r<e.startIndex.length-1;r++)this.computeIntersectsForChain(n,e,r,t)},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn};var er=function e(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var n=0;n<3;n++)this._depth[t][n]=e.NULL_VALUE},tr={NULL_VALUE:{configurable:!0}};er.prototype.getDepth=function(e,t){return this._depth[e][t]},er.prototype.setDepth=function(e,t,n){this._depth[e][t]=n},er.prototype.isNull=function(){if(0===arguments.length){for(var e=0;e<2;e++)for(var t=0;t<3;t++)if(this._depth[e][t]!==er.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===er.NULL_VALUE}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._depth[r][i]===er.NULL_VALUE}},er.prototype.normalize=function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var n=1;n<3;n++){var r=0;this._depth[e][n]>t&&(r=1),this._depth[e][n]=r}}},er.prototype.getDelta=function(e){return this._depth[e][Et.RIGHT]-this._depth[e][Et.LEFT]},er.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?A.EXTERIOR:A.INTERIOR},er.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},er.prototype.add=function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<2;t++)for(var n=1;n<3;n++){var r=e.getLocation(t,n);r!==A.EXTERIOR&&r!==A.INTERIOR||(this.isNull(t,n)?this._depth[t][n]=er.depthAtLocation(r):this._depth[t][n]+=er.depthAtLocation(r))}else if(3===arguments.length){var i=arguments[0],o=arguments[1];arguments[2]===A.INTERIOR&&this._depth[i][o]++}},er.prototype.interfaces_=function(){return[]},er.prototype.getClass=function(){return er},er.depthAtLocation=function(e){return e===A.EXTERIOR?0:e===A.INTERIOR?1:er.NULL_VALUE},tr.NULL_VALUE.get=function(){return-1},Object.defineProperties(er,tr);var nr=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new Kn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new er,this._depthDelta=0,1===arguments.length){var n=arguments[0];t.call(this,n,null)}else if(2===arguments.length){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);return e[0]=this.pts[0],e[1]=this.pts[1],new t(e,Lt.toLineLabel(this._label))},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(e){this._isIsolated=e},t.prototype.setName=function(e){this._name=e},t.prototype.equals=function(e){if(!(e instanceof t))return!1;var n=e;if(this.pts.length!==n.pts.length)return!1;for(var r=!0,i=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(r=!1),this.pts[s].equals2D(n.pts[--o])||(i=!1),!r&&!i)return!1;return!0},t.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}},t.prototype.print=function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(e){t.updateIM(this._label,e)},t.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")},t.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Qn(this)),this._mce},t.prototype.getEnvelope=function(){if(null===this._env){this._env=new W;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env},t.prototype.addIntersection=function(e,t,n,r){var i=new M(e.getIntersection(r)),o=t,s=e.getEdgeDistance(n,r),a=o+1;if(a<this.pts.length){var l=this.pts[a];i.equals2D(l)&&(o=a,s=0)}this.eiList.add(i,o,s)},t.prototype.toString=function(){var e=new D;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()},t.prototype.isPointwiseEqual=function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0},t.prototype.setDepthDelta=function(e){this._depthDelta=e},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,n,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(2!==arguments.length)return e.prototype.updateIM.apply(this,arguments);var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,Et.ON),t.getLocation(1,Et.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,Et.LEFT),t.getLocation(1,Et.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,Et.RIGHT),t.getLocation(1,Et.RIGHT),2))},t}(kt),rr=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new $n,this._bufParams=e||null};rr.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e},rr.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new Lt(e.getLabel())).flip(),n.merge(r);var i=rr.depthDelta(r),o=t.getDepthDelta()+i;t.setDepthDelta(o)}else this._edgeList.add(e),e.setDepthDelta(rr.depthDelta(e.getLabel()))},rr.prototype.buildSubgraphs=function(e,t){for(var n=new Se,r=e.iterator();r.hasNext();){var i=r.next(),o=i.getRightmostCoordinate(),s=new Nn(n).getDepth(o);i.computeDepth(s),i.findResultEdges(),n.add(i),t.add(i.getDirectedEdges(),i.getNodes())}},rr.prototype.createSubgraphs=function(e){for(var t=new Se,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Pt;i.create(r),t.add(i)}}return Qt.sort(t,Qt.reverseOrder()),t},rr.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},rr.prototype.getNoder=function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new wn,n=new ie;return n.setPrecisionModel(e),t.setSegmentIntersector(new Xn(n)),t},rr.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;null===n&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new On(n,this._bufParams),i=new Bn(e,t,r).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new Ht(new Zn),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new Zt(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},rr.prototype.computeNodedEdges=function(e,t){var n=this.getNoder(t);n.computeNodes(e);for(var r=n.getNodedSubstrings().iterator();r.hasNext();){var i=r.next(),o=i.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=i.getData(),a=new nr(i.getCoordinates(),new Lt(s));this.insertUniqueEdge(a)}}},rr.prototype.setNoder=function(e){this._workingNoder=e},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.depthDelta=function(e){var t=e.getLocation(0,Et.LEFT),n=e.getLocation(0,Et.RIGHT);return t===A.INTERIOR&&n===A.EXTERIOR?1:t===A.EXTERIOR&&n===A.INTERIOR?-1:0},rr.convertSegStrings=function(e){for(var t=new yt,n=new Se;e.hasNext();){var r=e.next(),i=t.createLineString(r.getCoordinates());n.add(i)}return t.buildGeometry(n)};var ir=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2],o=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};ir.prototype.rescale=function(){if(P(arguments[0],xe))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var n=arguments[0],r=0;r<n.length;r++)n[r].x=n[r].x/this._scaleFactor+this._offsetX,n[r].y=n[r].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&H.out.println(n)}},ir.prototype.scale=function(){if(P(arguments[0],xe)){for(var e=arguments[0],t=new Se,n=e.iterator();n.hasNext();){var r=n.next();t.add(new fn(this.scale(r.getCoordinates()),r.getData()))}return t}if(arguments[0]instanceof Array){for(var i=arguments[0],o=new Array(i.length).fill(null),s=0;s<i.length;s++)o[s]=new M(Math.round((i[s].x-this._offsetX)*this._scaleFactor),Math.round((i[s].y-this._offsetY)*this._scaleFactor),i[s].z);return Te.removeRepeatedPoints(o)}},ir.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},ir.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e},ir.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)},ir.prototype.interfaces_=function(){return[xn]},ir.prototype.getClass=function(){return ir};var or=function(){this._li=new ie,this._segStrings=null;var e=arguments[0];this._segStrings=e},sr={fact:{configurable:!0}};or.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var n=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var i=r.next().getCoordinates(),o=1;o<i.length-1;o++)if(i[o].equals(n))throw new Q("found endpt/interior pt intersection at index "+o+" :pt "+n)},or.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),n=this._segStrings.iterator();n.hasNext();){var r=n.next();this.checkInteriorIntersections(t,r)}else if(2===arguments.length)for(var i=arguments[0],o=arguments[1],s=i.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(i,l,o,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],d=arguments[2],p=arguments[3];if(u===d&&h===p)return null;var f=u.getCoordinates()[h],m=u.getCoordinates()[h+1],g=d.getCoordinates()[p],y=d.getCoordinates()[p+1];if(this._li.computeIntersection(f,m,g,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,m)||this.hasInteriorIntersection(this._li,g,y)))throw new Q("found non-noded intersection at "+f+"-"+m+" and "+g+"-"+y)}},or.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},or.prototype.checkCollapses=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),r=0;r<n.length-2;r++)this.checkCollapse(n[r],n[r+1],n[r+2])},or.prototype.hasInteriorIntersection=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var i=e.getIntersection(r);if(!i.equals(t)&&!i.equals(n))return!0}return!1},or.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new Q("found non-noded collapse at "+or.fact.createLineString([e,t,n]))},or.prototype.interfaces_=function(){return[]},or.prototype.getClass=function(){return or},sr.fact.get=function(){return new yt},Object.defineProperties(or,sr);var ar=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new v("Scale factor must be non-zero");1!==t&&(this._pt=new M(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new M,this._p1Scaled=new M),this.initCorners(this._pt)},lr={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ar.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),i=Math.min(e.y,t.y),o=Math.max(e.y,t.y),s=this._maxx<n||this._minx>r||this._maxy<i||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(e,t);return te.isTrue(!(s&&a),"Found bad envelope test"),a},ar.prototype.initCorners=function(e){this._minx=e.x-.5,this._maxx=e.x+.5,this._miny=e.y-.5,this._maxy=e.y+.5,this._corner[0]=new M(this._maxx,this._maxy),this._corner[1]=new M(this._minx,this._maxy),this._corner[2]=new M(this._minx,this._miny),this._corner[3]=new M(this._maxx,this._miny)},ar.prototype.intersects=function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},ar.prototype.scale=function(e){return Math.round(e*this._scaleFactor)},ar.prototype.getCoordinate=function(){return this._originalPt},ar.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)},ar.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var e=ar.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new W(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv},ar.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},ar.prototype.intersectsToleranceSquare=function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper()||n&&r||e.equals(this._pt)||t.equals(this._pt)))))},ar.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(n,r)&&(e.addIntersection(this.getCoordinate(),t),!0)},ar.prototype.interfaces_=function(){return[]},ar.prototype.getClass=function(){return ar},lr.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(ar,lr);var cr=function(){this.tempEnv1=new W,this.selectedSegment=new mn};cr.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[1];arguments[0].getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr};var ur=function(){this._index=null;var e=arguments[0];this._index=e},hr={HotPixelSnapAction:{configurable:!0}};ur.prototype.snap=function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],n=arguments[1],r=arguments[2],i=t.getSafeEnvelope(),o=new dr(t,n,r);return this._index.query(i,{interfaces_:function(){return[Xt]},visitItem:function(e){e.select(i,o)}}),o.isNodeAdded()}},ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur},hr.HotPixelSnapAction.get=function(){return dr},Object.defineProperties(ur,hr);var dr=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._hotPixel=t,this._parentEdge=n,this._hotPixelVertexIndex=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(2!==arguments.length)return e.prototype.select.apply(this,arguments);var t=arguments[1],n=arguments[0].getContext();if(null!==this._parentEdge&&n===this._parentEdge&&t===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(n,t)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cr),pr=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new Se};pr.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];if(this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}},pr.prototype.isDone=function(){return!1},pr.prototype.getInteriorIntersections=function(){return this._interiorIntersections},pr.prototype.interfaces_=function(){return[qn]},pr.prototype.getClass=function(){return pr};var fr=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new ie,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};fr.prototype.checkCorrectness=function(e){var t=fn.getNodedSubstrings(e),n=new or(t);try{n.checkValid()}catch(e){if(!(e instanceof V))throw e;e.printStackTrace()}},fr.prototype.getNodedSubstrings=function(){return fn.getNodedSubstrings(this._nodedSegStrings)},fr.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)},fr.prototype.findInteriorIntersections=function(e,t){var n=new pr(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()},fr.prototype.computeVertexSnaps=function(){if(P(arguments[0],xe))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof fn)for(var n=arguments[0],r=n.getCoordinates(),i=0;i<r.length;i++){var o=new ar(r[i],this._scaleFactor,this._li);this._pointSnapper.snap(o,n,i)&&n.addIntersection(r[i],i)}},fr.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new wn,this._pointSnapper=new ur(this._noder.getIndex()),this.snapRound(e,this._li)},fr.prototype.computeIntersectionSnaps=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),r=new ar(n,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},fr.prototype.interfaces_=function(){return[xn]},fr.prototype.getClass=function(){return fr};var mr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Mn,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},gr={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};mr.prototype.bufferFixedPrecision=function(e){var t=new ir(new fr(new pt(1)),e.getScale()),n=new rr(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)},mr.prototype.bufferReducedPrecision=function(){var e=this;if(0===arguments.length){for(var t=mr.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(t){if(!(t instanceof At))throw t;e._saveException=t}if(null!==e._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var n=arguments[0],r=mr.precisionScaleFactor(this._argGeom,this._distance,n),i=new pt(r);this.bufferFixedPrecision(i)}},mr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===pt.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},mr.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)},mr.prototype.bufferOriginalPrecision=function(){try{var e=new rr(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof Q))throw e;this._saveException=e}},mr.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry},mr.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr},mr.bufferOp=function(){if(2===arguments.length){var e=arguments[1];return new mr(arguments[0]).getResultGeometry(e)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ue&&"number"==typeof arguments[1]){var t=arguments[1],n=arguments[2],r=new mr(arguments[0]);return r.setQuadrantSegments(n),r.getResultGeometry(t)}if(arguments[2]instanceof Mn&&arguments[0]instanceof ue&&"number"==typeof arguments[1]){var i=arguments[1];return new mr(arguments[0],arguments[2]).getResultGeometry(i)}}else if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],l=new mr(arguments[0]);return l.setQuadrantSegments(s),l.setEndCapStyle(a),l.getResultGeometry(o)}},mr.precisionScaleFactor=function(e,t,n){var r=e.getEnvelopeInternal(),i=R.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(t>0?t:0),o=n-Math.trunc(Math.log(i)/Math.log(10)+1);return Math.pow(10,o)},gr.CAP_ROUND.get=function(){return Mn.CAP_ROUND},gr.CAP_BUTT.get=function(){return Mn.CAP_FLAT},gr.CAP_FLAT.get=function(){return Mn.CAP_FLAT},gr.CAP_SQUARE.get=function(){return Mn.CAP_SQUARE},gr.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(mr,gr);var yr=function(){this._pt=[new M,new M],this._distance=_.NaN,this._isNull=!0};yr.prototype.getCoordinates=function(){return this._pt},yr.prototype.getCoordinate=function(e){return this._pt[e]},yr.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}},yr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},yr.prototype.getDistance=function(){return this._distance},yr.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr};var vr=function(){};vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},vr.computeDistance=function(){if(arguments[2]instanceof yr&&arguments[0]instanceof Xe&&arguments[1]instanceof M)for(var e=arguments[1],t=arguments[2],n=arguments[0].getCoordinates(),r=new mn,i=0;i<n.length-1;i++){r.setCoordinates(n[i],n[i+1]);var o=r.closestPoint(e);t.setMinimum(o,e)}else if(arguments[2]instanceof yr&&arguments[0]instanceof Qe&&arguments[1]instanceof M){var s=arguments[0],a=arguments[1],l=arguments[2];vr.computeDistance(s.getExteriorRing(),a,l);for(var c=0;c<s.getNumInteriorRing();c++)vr.computeDistance(s.getInteriorRingN(c),a,l)}else if(arguments[2]instanceof yr&&arguments[0]instanceof ue&&arguments[1]instanceof M){var u=arguments[0],h=arguments[1],d=arguments[2];if(u instanceof Xe)vr.computeDistance(u,h,d);else if(u instanceof Qe)vr.computeDistance(u,h,d);else if(u instanceof Ve)for(var p=u,f=0;f<p.getNumGeometries();f++){var m=p.getGeometryN(f);vr.computeDistance(m,h,d)}else d.setMinimum(u.getCoordinate(),h)}else if(arguments[2]instanceof yr&&arguments[0]instanceof mn&&arguments[1]instanceof M){var g=arguments[1],y=arguments[2],v=arguments[0].closestPoint(g);y.setMinimum(v,g)}};var _r=function(e){this._maxPtDist=new yr,this._inputGeom=e||null},xr={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};_r.prototype.computeMaxMidpointDistance=function(e){var t=new wr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},_r.prototype.computeMaxVertexDistance=function(e){var t=new br(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},_r.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()},_r.prototype.getDistancePoints=function(){return this._maxPtDist},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},xr.MaxPointDistanceFilter.get=function(){return br},xr.MaxMidpointDistanceFilter.get=function(){return wr},Object.defineProperties(_r,xr);var br=function(e){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=e||null};br.prototype.filter=function(e){this._minPtDist.initialize(),vr.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},br.prototype.getMaxPointDistance=function(){return this._maxPtDist},br.prototype.interfaces_=function(){return[pe]},br.prototype.getClass=function(){return br};var wr=function(e){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=e||null};wr.prototype.filter=function(e,t){if(0===t)return null;var n=e.getCoordinate(t-1),r=e.getCoordinate(t),i=new M((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),vr.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wr.prototype.isDone=function(){return!1},wr.prototype.isGeometryChanged=function(){return!1},wr.prototype.getMaxPointDistance=function(){return this._maxPtDist},wr.prototype.interfaces_=function(){return[je]},wr.prototype.getClass=function(){return wr};var Sr=function(e){this._comps=e||null};Sr.prototype.filter=function(e){e instanceof Qe&&this._comps.add(e)},Sr.prototype.interfaces_=function(){return[Ue]},Sr.prototype.getClass=function(){return Sr},Sr.getPolygons=function(){if(1===arguments.length)return Sr.getPolygons(arguments[0],new Se);if(2===arguments.length){var e=arguments[0],t=arguments[1];return e instanceof Qe?t.add(e):e instanceof Ve&&e.apply(new Sr(t)),t}};var Mr=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var e=arguments[0];this._lines=e}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};Mr.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof tt){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof Xe&&this._lines.add(e)},Mr.prototype.setForceToLineString=function(e){this._isForcedToLineString=e},Mr.prototype.interfaces_=function(){return[ce]},Mr.prototype.getClass=function(){return Mr},Mr.getGeometry=function(){if(1===arguments.length){var e=arguments[0];return e.getFactory().buildGeometry(Mr.getLines(e))}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(Mr.getLines(t,n))}},Mr.getLines=function(){if(1===arguments.length)return Mr.getLines(arguments[0],!1);if(2===arguments.length){if(P(arguments[0],xe)&&P(arguments[1],xe)){for(var e=arguments[1],t=arguments[0].iterator();t.hasNext();){var n=t.next();Mr.getLines(n,e)}return e}if(arguments[0]instanceof ue&&"boolean"==typeof arguments[1]){var r=arguments[0],i=arguments[1],o=new Se;return r.apply(new Mr(o,i)),o}if(arguments[0]instanceof ue&&P(arguments[1],xe)){var s=arguments[0],a=arguments[1];return s instanceof Xe?a.add(s):s.apply(new Mr(a)),a}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&P(arguments[0],xe)&&P(arguments[1],xe)){for(var l=arguments[1],c=arguments[2],u=arguments[0].iterator();u.hasNext();){var h=u.next();Mr.getLines(h,l,c)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ue&&P(arguments[1],xe)){var d=arguments[1],p=arguments[2];return arguments[0].apply(new Mr(d,p)),d}}};var Er=function(){if(this._boundaryRule=fe.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(null===e)throw new v("Rule must be non-null");this._boundaryRule=e}};Er.prototype.locateInternal=function(){if(arguments[0]instanceof M&&arguments[1]instanceof Qe){var e=arguments[0],t=arguments[1];if(t.isEmpty())return A.EXTERIOR;var n=t.getExteriorRing(),r=this.locateInPolygonRing(e,n);if(r===A.EXTERIOR)return A.EXTERIOR;if(r===A.BOUNDARY)return A.BOUNDARY;for(var i=0;i<t.getNumInteriorRing();i++){var o=t.getInteriorRingN(i),s=this.locateInPolygonRing(e,o);if(s===A.INTERIOR)return A.EXTERIOR;if(s===A.BOUNDARY)return A.BOUNDARY}return A.INTERIOR}if(arguments[0]instanceof M&&arguments[1]instanceof Xe){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return A.EXTERIOR;var c=l.getCoordinates();return l.isClosed()||!a.equals(c[0])&&!a.equals(c[c.length-1])?ae.isOnLine(a,c)?A.INTERIOR:A.EXTERIOR:A.BOUNDARY}if(arguments[0]instanceof M&&arguments[1]instanceof Ke){var u=arguments[0];return arguments[1].getCoordinate().equals2D(u)?A.INTERIOR:A.EXTERIOR}},Er.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?ae.locatePointInRing(e,t.getCoordinates()):A.EXTERIOR},Er.prototype.intersects=function(e,t){return this.locate(e,t)!==A.EXTERIOR},Er.prototype.updateLocationInfo=function(e){e===A.INTERIOR&&(this._isIn=!0),e===A.BOUNDARY&&this._numBoundaries++},Er.prototype.computeLocation=function(e,t){if(t instanceof Ke&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof Xe)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Qe)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Ge)for(var n=t,r=0;r<n.getNumGeometries();r++){var i=n.getGeometryN(r);this.updateLocationInfo(this.locateInternal(e,i))}else if(t instanceof nt)for(var o=t,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(e,a))}else if(t instanceof Ve)for(var l=new jn(t);l.hasNext();){var c=l.next();c!==t&&this.computeLocation(e,c)}},Er.prototype.locate=function(e,t){return t.isEmpty()?A.EXTERIOR:t instanceof Xe||t instanceof Qe?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?A.BOUNDARY:this._numBoundaries>0||this._isIn?A.INTERIOR:A.EXTERIOR)},Er.prototype.interfaces_=function(){return[]},Er.prototype.getClass=function(){return Er};var Tr=function e(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)e.call(this,arguments[0],e.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var t=arguments[0],n=arguments[1],r=arguments[2];this._component=t,this._segIndex=n,this._pt=r}},Cr={INSIDE_AREA:{configurable:!0}};Tr.prototype.isInsideArea=function(){return this._segIndex===Tr.INSIDE_AREA},Tr.prototype.getCoordinate=function(){return this._pt},Tr.prototype.getGeometryComponent=function(){return this._component},Tr.prototype.getSegmentIndex=function(){return this._segIndex},Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Cr.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Tr,Cr);var Ar=function(e){this._pts=e||null};Ar.prototype.filter=function(e){e instanceof Ke&&this._pts.add(e)},Ar.prototype.interfaces_=function(){return[Ue]},Ar.prototype.getClass=function(){return Ar},Ar.getPoints=function(){if(1===arguments.length){var e=arguments[0];return e instanceof Ke?Qt.singletonList(e):Ar.getPoints(e,new Se)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof Ke?n.add(t):t instanceof Ve&&t.apply(new Ar(n)),n}};var Ir=function(){this._locations=null;var e=arguments[0];this._locations=e};Ir.prototype.filter=function(e){(e instanceof Ke||e instanceof Xe||e instanceof Qe)&&this._locations.add(new Tr(e,0,e.getCoordinate()))},Ir.prototype.interfaces_=function(){return[Ue]},Ir.prototype.getClass=function(){return Ir},Ir.getLocations=function(e){var t=new Se;return e.apply(new Ir(t)),t};var Pr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Er,this._minDistanceLocation=null,this._minDistance=_.MAX_VALUE,2===arguments.length){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Pr.prototype.computeContainmentDistance=function(){if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],r=1-t,i=Sr.getPolygons(this._geom[t]);if(i.size()>0){var o=Ir.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,i,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=n[0],this._minDistanceLocation[t]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&P(arguments[0],we)&&P(arguments[1],we)){for(var s=arguments[0],a=arguments[1],l=arguments[2],c=0;c<s.size();c++)for(var u=s.get(c),h=0;h<a.size();h++)if(this.computeContainmentDistance(u,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Tr&&arguments[1]instanceof Qe){var d=arguments[0],p=arguments[1],f=arguments[2],m=d.getCoordinate();if(A.EXTERIOR!==this._ptLocator.locate(m,p))return this._minDistance=0,f[0]=d,f[1]=new Tr(p,m),null}},Pr.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(i,s,n),this._minDistance<=this._terminateDistance)return null}},Pr.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=Mr.getLines(this._geom[0]),n=Mr.getLines(this._geom[1]),r=Ar.getPoints(this._geom[0]),i=Ar.getPoints(this._geom[1]);return this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(r,i,e),void this.updateMinDistance(e,!1))))},Pr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Pr.prototype.updateMinDistance=function(e,t){if(null===e[0])return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])},Pr.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Pr.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Xe&&arguments[1]instanceof Ke){var e=arguments[0],t=arguments[1],n=arguments[2];if(e.getEnvelopeInternal().distance(t.getEnvelopeInternal())>this._minDistance)return null;for(var r=e.getCoordinates(),i=t.getCoordinate(),o=0;o<r.length-1;o++){var s=ae.distancePointLine(i,r[o],r[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new mn(r[o],r[o+1]).closestPoint(i);n[0]=new Tr(e,o,a),n[1]=new Tr(t,0,i)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var l=arguments[0],c=arguments[1],u=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),d=c.getCoordinates(),p=0;p<h.length-1;p++)for(var f=0;f<d.length-1;f++){var m=ae.distanceLineLine(h[p],h[p+1],d[f],d[f+1]);if(m<this._minDistance){this._minDistance=m;var g=new mn(h[p],h[p+1]),y=new mn(d[f],d[f+1]),v=g.closestPoints(y);u[0]=new Tr(l,p,v[0]),u[1]=new Tr(c,f,v[1])}if(this._minDistance<=this._terminateDistance)return null}}},Pr.prototype.computeMinDistancePoints=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var s=t.get(o),a=i.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,n[0]=new Tr(i,0,i.getCoordinate()),n[1]=new Tr(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Pr.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new v("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Pr.prototype.computeMinDistanceLines=function(e,t,n){for(var r=0;r<e.size();r++)for(var i=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(i,s,n),this._minDistance<=this._terminateDistance)return null}},Pr.prototype.interfaces_=function(){return[]},Pr.prototype.getClass=function(){return Pr},Pr.distance=function(e,t){return new Pr(e,t).distance()},Pr.isWithinDistance=function(e,t,n){return new Pr(e,t,n).distance()<=n},Pr.nearestPoints=function(e,t){return new Pr(e,t).nearestPoints()};var Rr=function(){this._pt=[new M,new M],this._distance=_.NaN,this._isNull=!0};Rr.prototype.getCoordinates=function(){return this._pt},Rr.prototype.getCoordinate=function(e){return this._pt[e]},Rr.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}},Rr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}},Rr.prototype.toString=function(){return J.toLineString(this._pt[0],this._pt[1])},Rr.prototype.getDistance=function(){return this._distance},Rr.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr};var Lr=function(){};Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},Lr.computeDistance=function(){if(arguments[2]instanceof Rr&&arguments[0]instanceof Xe&&arguments[1]instanceof M)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=new mn,i=e.getCoordinates(),o=0;o<i.length-1;o++){r.setCoordinates(i[o],i[o+1]);var s=r.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof Qe&&arguments[1]instanceof M){var a=arguments[0],l=arguments[1],c=arguments[2];Lr.computeDistance(a.getExteriorRing(),l,c);for(var u=0;u<a.getNumInteriorRing();u++)Lr.computeDistance(a.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof ue&&arguments[1]instanceof M){var h=arguments[0],d=arguments[1],p=arguments[2];if(h instanceof Xe)Lr.computeDistance(h,d,p);else if(h instanceof Qe)Lr.computeDistance(h,d,p);else if(h instanceof Ve)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);Lr.computeDistance(g,d,p)}else p.setMinimum(h.getCoordinate(),d)}else if(arguments[2]instanceof Rr&&arguments[0]instanceof mn&&arguments[1]instanceof M){var y=arguments[1],v=arguments[2],_=arguments[0].closestPoint(y);v.setMinimum(_,y)}};var Dr=function(){this._g0=null,this._g1=null,this._ptDist=new Rr,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Or={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Dr.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Dr.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new v("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e},Dr.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)},Dr.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Dr.prototype.computeOrientedDistance=function(e,t,n){var r=new Nr(t);if(e.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new kr(t,this._densifyFrac);e.apply(i),n.setMaximum(i.getMaxPointDistance())}},Dr.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Dr.prototype.interfaces_=function(){return[]},Dr.prototype.getClass=function(){return Dr},Dr.distance=function(){if(2===arguments.length)return new Dr(arguments[0],arguments[1]).distance();if(3===arguments.length){var e=arguments[2],t=new Dr(arguments[0],arguments[1]);return t.setDensifyFraction(e),t.distance()}},Or.MaxPointDistanceFilter.get=function(){return Nr},Or.MaxDensifiedByFractionDistanceFilter.get=function(){return kr},Object.defineProperties(Dr,Or);var Nr=function(){this._maxPtDist=new Rr,this._minPtDist=new Rr,this._euclideanDist=new Lr,this._geom=null;var e=arguments[0];this._geom=e};Nr.prototype.filter=function(e){this._minPtDist.initialize(),Lr.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Nr.prototype.getMaxPointDistance=function(){return this._maxPtDist},Nr.prototype.interfaces_=function(){return[pe]},Nr.prototype.getClass=function(){return Nr};var kr=function(){this._maxPtDist=new Rr,this._minPtDist=new Rr,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};kr.prototype.filter=function(e,t){if(0===t)return null;for(var n=e.getCoordinate(t-1),r=e.getCoordinate(t),i=(r.x-n.x)/this._numSubSegs,o=(r.y-n.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=n.x+s*i,l=n.y+s*o,c=new M(a,l);this._minPtDist.initialize(),Lr.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},kr.prototype.isDone=function(){return!1},kr.prototype.isGeometryChanged=function(){return!1},kr.prototype.getMaxPointDistance=function(){return this._maxPtDist},kr.prototype.interfaces_=function(){return[je]},kr.prototype.getClass=function(){return kr};var Fr=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},zr={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fr.prototype.checkMaximumDistance=function(e,t,n){var r=new Dr(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=e.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+J.toLineString(i[0],i[1])+")"}},Fr.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Fr.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fr.VERBOSE&&H.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Fr.prototype.checkNegativeValid=function(){if(!(this._input instanceof Qe||this._input instanceof nt||this._input instanceof Ve))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)},Fr.prototype.getErrorIndicator=function(){return this._errorIndicator},Fr.prototype.checkMinimumDistance=function(e,t,n){var r=new Pr(e,t,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+J.toLineString(i[0],i[1])+" )"}},Fr.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)},Fr.prototype.getErrorLocation=function(){return this._errorLocation},Fr.prototype.getPolygonLines=function(e){for(var t=new Se,n=new Mr(t),r=Sr.getPolygons(e).iterator();r.hasNext();)r.next().apply(n);return e.getFactory().buildGeometry(t)},Fr.prototype.getErrorMessage=function(){return this._errMsg},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr},zr.VERBOSE.get=function(){return!1},zr.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fr,zr);var Br=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},Ur={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Br.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Br.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Br.MAX_ENV_DIFF_FRAC;0===e&&(e=.001);var t=new W(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new W(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")},Br.prototype.checkDistance=function(){var e=new Fr(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")},Br.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Br.prototype.checkPolygonal=function(){this._result instanceof Qe||this._result instanceof nt||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Br.prototype.getErrorIndicator=function(){return this._errorIndicator},Br.prototype.getErrorLocation=function(){return this._errorLocation},Br.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Br.prototype.report=function(e){if(!Br.VERBOSE)return null;H.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))},Br.prototype.getErrorMessage=function(){return this._errorMsg},Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br},Br.isValidMsg=function(e,t,n){var r=new Br(e,t,n);return r.isValid()?null:r.getErrorMessage()},Br.isValid=function(e,t,n){return!!new Br(e,t,n).isValid()},Ur.VERBOSE.get=function(){return!1},Ur.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Br,Ur);var jr=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};jr.prototype.getCoordinates=function(){return this._pts},jr.prototype.size=function(){return this._pts.length},jr.prototype.getCoordinate=function(e){return this._pts[e]},jr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},jr.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:hn.octant(this.getCoordinate(e),this.getCoordinate(e+1))},jr.prototype.setData=function(e){this._data=e},jr.prototype.getData=function(){return this._data},jr.prototype.toString=function(){return J.toLineString(new lt(this._pts))},jr.prototype.interfaces_=function(){return[dn]},jr.prototype.getClass=function(){return jr};var Vr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Se,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Vr.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Vr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e},Vr.prototype.getIntersectionSegments=function(){return this._intSegments},Vr.prototype.count=function(){return this._intersectionCount},Vr.prototype.getIntersections=function(){return this._intersections},Vr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},Vr.prototype.setKeepIntersections=function(e){this._keepIntersections=e},Vr.prototype.processIntersections=function(e,t,n,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(e===n&&t===r)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(e,t)&&!this.isEndSegment(n,r))return null;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=i,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Vr.prototype.isEndSegment=function(e,t){return 0===t||t>=e.size()-2},Vr.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Vr.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Vr.prototype.interfaces_=function(){return[qn]},Vr.prototype.getClass=function(){return Vr},Vr.createAllIntersectionsFinder=function(e){var t=new Vr(e);return t.setFindAllIntersections(!0),t},Vr.createAnyIntersectionFinder=function(e){return new Vr(e)},Vr.createIntersectionCounter=function(e){var t=new Vr(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Gr=function(){this._li=new ie,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Gr.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Gr.prototype.getIntersections=function(){return this._segInt.getIntersections()},Gr.prototype.isValid=function(){return this.execute(),this._isValid},Gr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},Gr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Vr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new wn;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Gr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new At(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Gr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+J.toLineString(e[0],e[1])+" and "+J.toLineString(e[2],e[3])},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr},Gr.computeIntersections=function(e){var t=new Gr(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Hr=function e(){this._nv=null;var t=arguments[0];this._nv=new Gr(e.toSegmentStrings(t))};Hr.prototype.checkValid=function(){this._nv.checkValid()},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr},Hr.toSegmentStrings=function(e){for(var t=new Se,n=e.iterator();n.hasNext();){var r=n.next();t.add(new jr(r.getCoordinates(),r))}return t},Hr.checkValid=function(e){new Hr(e).checkValid()};var Zr=function(e){this._mapOp=e};Zr.prototype.map=function(e){for(var t=new Se,n=0;n<e.getNumGeometries();n++){var r=this._mapOp.map(e.getGeometryN(n));r.isEmpty()||t.add(r)}return e.getFactory().createGeometryCollection(yt.toGeometryArray(t))},Zr.prototype.interfaces_=function(){return[]},Zr.prototype.getClass=function(){return Zr},Zr.map=function(e,t){return new Zr(t).map(e)};var Wr=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Se,this._resultLineList=new Se;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};Wr.prototype.collectLines=function(e){for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();this.collectLineEdge(n,e,this._lineEdgesList),this.collectBoundaryTouchEdge(n,e,this._lineEdgesList)}},Wr.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)},Wr.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList},Wr.prototype.collectLineEdge=function(e,t,n){var r=e.getLabel(),i=e.getEdge();e.isLineEdge()&&(e.isVisited()||!Ti.isResultOfOp(r,t)||i.isCovered()||(n.add(i),e.setVisitedEdge(!0)))},Wr.prototype.findCoveredLineEdges=function(){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();)e.next().getEdges().findCoveredLineEdges();for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next(),r=n.getEdge();if(n.isLineEdge()&&!r.isCoveredSet()){var i=this._op.isCoveredByA(n.getCoordinate());r.setCovered(i)}}},Wr.prototype.labelIsolatedLines=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next(),r=n.getLabel();n.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Wr.prototype.buildLines=function(e){for(var t=this._lineEdgesList.iterator();t.hasNext();){var n=t.next(),r=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(r),n.setInResult(!0)}},Wr.prototype.collectBoundaryTouchEdge=function(e,t,n){var r=e.getLabel();return e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult()?null:(te.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(Ti.isResultOfOp(r,t)&&t===Ti.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))))},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var $r=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Se;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};$r.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}},$r.prototype.extractNonCoveredResultNodes=function(e){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&e!==Ti.INTERSECTION)){var r=n.getLabel();Ti.isResultOfOp(r,e)&&this.filterCoveredNodeToPoint(n)}}},$r.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r};var qr=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};qr.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},qr.prototype.transformPolygon=function(e,t){var n=!0,r=this.transformLinearRing(e.getExteriorRing(),e);null!==r&&r instanceof tt&&!r.isEmpty()||(n=!1);for(var i=new Se,o=0;o<e.getNumInteriorRing();o++){var s=this.transformLinearRing(e.getInteriorRingN(o),e);null===s||s.isEmpty()||(s instanceof tt||(n=!1),i.add(s))}if(n)return this._factory.createPolygon(r,i.toArray([]));var a=new Se;return null!==r&&a.add(r),a.addAll(i),this._factory.buildGeometry(a)},qr.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)},qr.prototype.getInputGeometry=function(){return this._inputGeom},qr.prototype.transformMultiLineString=function(e,t){for(var n=new Se,r=0;r<e.getNumGeometries();r++){var i=this.transformLineString(e.getGeometryN(r),e);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},qr.prototype.transformCoordinates=function(e,t){return this.copy(e)},qr.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},qr.prototype.transformMultiPoint=function(e,t){for(var n=new Se,r=0;r<e.getNumGeometries();r++){var i=this.transformPoint(e.getGeometryN(r),e);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},qr.prototype.transformMultiPolygon=function(e,t){for(var n=new Se,r=0;r<e.getNumGeometries();r++){var i=this.transformPolygon(e.getGeometryN(r),e);null!==i&&(i.isEmpty()||n.add(i))}return this._factory.buildGeometry(n)},qr.prototype.copy=function(e){return e.copy()},qr.prototype.transformGeometryCollection=function(e,t){for(var n=new Se,r=0;r<e.getNumGeometries();r++){var i=this.transform(e.getGeometryN(r));null!==i&&(this._pruneEmptyGeometry&&i.isEmpty()||n.add(i))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(yt.toGeometryArray(n)):this._factory.buildGeometry(n)},qr.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Ke)return this.transformPoint(e,null);if(e instanceof et)return this.transformMultiPoint(e,null);if(e instanceof tt)return this.transformLinearRing(e,null);if(e instanceof Xe)return this.transformLineString(e,null);if(e instanceof Ge)return this.transformMultiLineString(e,null);if(e instanceof Qe)return this.transformPolygon(e,null);if(e instanceof nt)return this.transformMultiPolygon(e,null);if(e instanceof Ve)return this.transformGeometryCollection(e,null);throw new v("Unknown Geometry subtype: "+e.getClass().getName())},qr.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(null===n)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr};var Xr=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new mn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Xe&&"number"==typeof arguments[1]){var t=arguments[1];e.call(this,arguments[0].getCoordinates(),t)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],r=arguments[1];this._srcPts=n,this._isClosed=e.isClosed(n),this._snapTolerance=r}};Xr.prototype.snapVertices=function(e,t){for(var n=this._isClosed?e.size()-1:e.size(),r=0;r<n;r++){var i=e.get(r),o=this.findSnapForVertex(i,t);null!==o&&(e.set(r,new M(o)),0===r&&this._isClosed&&e.set(e.size()-1,new M(o)))}},Xr.prototype.findSnapForVertex=function(e,t){for(var n=0;n<t.length;n++){if(e.equals2D(t[n]))return null;if(e.distance(t[n])<this._snapTolerance)return t[n]}return null},Xr.prototype.snapTo=function(e){var t=new Ee(this._srcPts);return this.snapVertices(t,e),this.snapSegments(t,e),t.toCoordinateArray()},Xr.prototype.snapSegments=function(e,t){if(0===t.length)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var r=0;r<n;r++){var i=t[r],o=this.findSegmentIndexToSnap(i,e);o>=0&&e.add(o+1,new M(i),!1)}},Xr.prototype.findSegmentIndexToSnap=function(e,t){for(var n=_.MAX_VALUE,r=-1,i=0;i<t.size()-1;i++){if(this._seg.p0=t.get(i),this._seg.p1=t.get(i+1),this._seg.p0.equals2D(e)||this._seg.p1.equals2D(e)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(e);o<this._snapTolerance&&o<n&&(n=o,r=i)}return r},Xr.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr},Xr.isClosed=function(e){return!(e.length<=1)&&e[0].equals2D(e[e.length-1])};var Yr=function(e){this._srcGeom=e||null},Kr={SNAP_PRECISION_FACTOR:{configurable:!0}};Yr.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e);return new Jr(t,n).transform(this._srcGeom)},Yr.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),r=new Jr(e,n,!0).transform(this._srcGeom),i=r;return t&&P(i,Je)&&(i=r.buffer(0)),i},Yr.prototype.computeSnapTolerance=function(e){return this.computeMinimumSegmentLength(e)/10},Yr.prototype.extractTargetCoordinates=function(e){for(var t=new p,n=e.getCoordinates(),r=0;r<n.length;r++)t.add(n[r]);return t.toArray(new Array(0).fill(null))},Yr.prototype.computeMinimumSegmentLength=function(e){for(var t=_.MAX_VALUE,n=0;n<e.length-1;n++){var r=e[n].distance(e[n+1]);r<t&&(t=r)}return t},Yr.prototype.interfaces_=function(){return[]},Yr.prototype.getClass=function(){return Yr},Yr.snap=function(e,t,n){var r=new Array(2).fill(null),i=new Yr(e);r[0]=i.snapTo(t,n);var o=new Yr(t);return r[1]=o.snapTo(r[0],n),r},Yr.computeOverlaySnapTolerance=function(){if(1===arguments.length){var e=arguments[0],t=Yr.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===pt.FIXED){var r=1/n.getScale()*2/1.415;r>t&&(t=r)}return t}if(2===arguments.length){var i=arguments[0],o=arguments[1];return Math.min(Yr.computeOverlaySnapTolerance(i),Yr.computeOverlaySnapTolerance(o))}},Yr.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*Yr.SNAP_PRECISION_FACTOR},Yr.snapToSelf=function(e,t,n){return new Yr(e).snapToSelf(t,n)},Kr.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Yr,Kr);var Jr=function(e){function t(t,n,r){e.call(this),this._snapTolerance=t||null,this._snapPts=n||null,this._isSelfSnap=void 0!==r&&r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(e,t){var n=new Xr(e,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(t)},t.prototype.transformCoordinates=function(e,t){var n=e.toCoordinateArray(),r=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qr),Qr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Qr.prototype.getCommon=function(){return _.longBitsToDouble(this._commonBits)},Qr.prototype.add=function(e){var t=_.doubleToLongBits(e);return this._isFirst?(this._commonBits=t,this._commonSignExp=Qr.signExpBits(this._commonBits),this._isFirst=!1,null):Qr.signExpBits(t)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Qr.numCommonMostSigMantissaBits(this._commonBits,t),void(this._commonBits=Qr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Qr.prototype.toString=function(){if(1===arguments.length){var e=arguments[0],t=_.longBitsToDouble(e),n="0000000000000000000000000000000000000000000000000000000000000000"+_.toBinaryString(e),r=n.substring(n.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]"}},Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},Qr.getBit=function(e,t){return 0!=(e&1<<t)?1:0},Qr.signExpBits=function(e){return e>>52},Qr.zeroLowerBits=function(e,t){return e&~((1<<t)-1)},Qr.numCommonMostSigMantissaBits=function(e,t){for(var n=0,r=52;r>=0;r--){if(Qr.getBit(e,r)!==Qr.getBit(t,r))return n;n++}return 52};var ei=function(){this._commonCoord=null,this._ccFilter=new ni},ti={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};ei.prototype.addCommonBits=function(e){var t=new ri(this._commonCoord);e.apply(t),e.geometryChanged()},ei.prototype.removeCommonBits=function(e){if(0===this._commonCoord.x&&0===this._commonCoord.y)return e;var t=new M(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new ri(t);return e.apply(n),e.geometryChanged(),e},ei.prototype.getCommonCoordinate=function(){return this._commonCoord},ei.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},ei.prototype.interfaces_=function(){return[]},ei.prototype.getClass=function(){return ei},ti.CommonCoordinateFilter.get=function(){return ni},ti.Translater.get=function(){return ri},Object.defineProperties(ei,ti);var ni=function(){this._commonBitsX=new Qr,this._commonBitsY=new Qr};ni.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)},ni.prototype.getCommonCoordinate=function(){return new M(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ni.prototype.interfaces_=function(){return[pe]},ni.prototype.getClass=function(){return ni};var ri=function(){this.trans=null;var e=arguments[0];this.trans=e};ri.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,r)},ri.prototype.isDone=function(){return!1},ri.prototype.isGeometryChanged=function(){return!0},ri.prototype.interfaces_=function(){return[je]},ri.prototype.getClass=function(){return ri};var ii=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};ii.prototype.selfSnap=function(e){return new Yr(e).snapTo(e,this._snapTolerance)},ii.prototype.removeCommonBits=function(e){this._cbr=new ei,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t},ii.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e},ii.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=Ti.overlayOp(t[0],t[1],e);return this.prepareResult(n)},ii.prototype.checkValid=function(e){e.isValid()||H.out.println("Snapped geometry is invalid")},ii.prototype.computeSnapTolerance=function(){this._snapTolerance=Yr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ii.prototype.snap=function(e){var t=this.removeCommonBits(e);return Yr.snap(t[0],t[1],this._snapTolerance)},ii.prototype.interfaces_=function(){return[]},ii.prototype.getClass=function(){return ii},ii.overlayOp=function(e,t,n){return new ii(e,t).getResultGeometry(n)},ii.union=function(e,t){return ii.overlayOp(e,t,Ti.UNION)},ii.intersection=function(e,t){return ii.overlayOp(e,t,Ti.INTERSECTION)},ii.symDifference=function(e,t){return ii.overlayOp(e,t,Ti.SYMDIFFERENCE)},ii.difference=function(e,t){return ii.overlayOp(e,t,Ti.DIFFERENCE)};var oi=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};oi.prototype.getResultGeometry=function(e){var t=null,n=!1,r=null;try{t=Ti.overlayOp(this._geom[0],this._geom[1],e),n=!0}catch(e){if(!(e instanceof Q))throw e;r=e}if(!n)try{t=ii.overlayOp(this._geom[0],this._geom[1],e)}catch(e){throw e instanceof Q?r:e}return t},oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},oi.overlayOp=function(e,t,n){return new oi(e,t).getResultGeometry(n)},oi.union=function(e,t){return oi.overlayOp(e,t,Ti.UNION)},oi.intersection=function(e,t){return oi.overlayOp(e,t,Ti.INTERSECTION)},oi.symDifference=function(e,t){return oi.overlayOp(e,t,Ti.SYMDIFFERENCE)},oi.difference=function(e,t){return oi.overlayOp(e,t,Ti.DIFFERENCE)};var si=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};si.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)},si.prototype.interfaces_=function(){return[]},si.prototype.getClass=function(){return si};var ai=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=i,this._obj=o}},li={INSERT:{configurable:!0},DELETE:{configurable:!0}};ai.prototype.isDelete=function(){return this._eventType===ai.DELETE},ai.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e},ai.prototype.getObject=function(){return this._obj},ai.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0},ai.prototype.getInsertEvent=function(){return this._insertEvent},ai.prototype.isInsert=function(){return this._eventType===ai.INSERT},ai.prototype.isSameLabel=function(e){return null!==this._label&&this._label===e._label},ai.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ai.prototype.interfaces_=function(){return[b]},ai.prototype.getClass=function(){return ai},li.INSERT.get=function(){return 1},li.DELETE.get=function(){return 2},Object.defineProperties(ai,li);var ci=function(){};ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var ui=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};ui.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&1===this._li.getIntersectionNum()){if(ui.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var i=e.getNumPoints()-1;if(0===t&&r===i||0===r&&t===i)return!0}}return!1},ui.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ui.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e},ui.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ui.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next().getCoordinate();if(e.isIntersection(r))return!0}return!1},ui.prototype.hasProperIntersection=function(){return this._hasProper},ui.prototype.hasIntersection=function(){return this._hasIntersection},ui.prototype.isDone=function(){return this._isDone},ui.prototype.isBoundaryPoint=function(e,t){return!(null===t||!this.isBoundaryPointInternal(e,t[0])&&!this.isBoundaryPointInternal(e,t[1]))},ui.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t},ui.prototype.addIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var i=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=n.getCoordinates()[r],a=n.getCoordinates()[r+1];this._li.computeIntersection(i,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)};var hi=function(e){function t(){e.call(this),this.events=new Se,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){Qt.sort(this.events);for(var e=0;e<this.events.size();e++){var t=this.events.get(e);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(e)}},t.prototype.computeIntersections=function(){if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var t=0;t<this.events.size();t++){var n=this.events.get(t);if(n.isInsert()&&this.processOverlaps(t,n.getDeleteEventIndex(),n,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ui&&P(arguments[0],we)&&P(arguments[1],we)){var r=arguments[0],i=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(i,i),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&P(arguments[0],we)&&arguments[1]instanceof ui){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},t.prototype.addEdge=function(e,t){for(var n=e.getMonotoneChainEdge(),r=n.getStartIndexes(),i=0;i<r.length-1;i++){var o=new si(n,i),s=new ai(t,n.getMinX(i),o);this.events.add(s),this.events.add(new ai(n.getMaxX(i),s))}},t.prototype.processOverlaps=function(e,t,n,r){for(var i=n.getObject(),o=e;o<t;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();n.isSameLabel(s)||(i.computeIntersections(a,r),this.nOverlaps++)}}},t.prototype.addEdges=function(){if(1===arguments.length)for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.addEdge(t,t)}else if(2===arguments.length)for(var n=arguments[1],r=arguments[0].iterator();r.hasNext();){var i=r.next();this.addEdge(i,n)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ci),di=function(){this._min=_.POSITIVE_INFINITY,this._max=_.NEGATIVE_INFINITY},pi={NodeComparator:{configurable:!0}};di.prototype.getMin=function(){return this._min},di.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)},di.prototype.getMax=function(){return this._max},di.prototype.toString=function(){return J.toLineString(new M(this._min,0),new M(this._max,0))},di.prototype.interfaces_=function(){return[]},di.prototype.getClass=function(){return di},pi.NodeComparator.get=function(){return fi},Object.defineProperties(di,pi);var fi=function(){};fi.prototype.compare=function(e,t){var n=e,r=t,i=(n._min+n._max)/2,o=(r._min+r._max)/2;return i<o?-1:i>o?1:0},fi.prototype.interfaces_=function(){return[S]},fi.prototype.getClass=function(){return fi};var mi=function(e){function t(){e.call(this),this._item=null;var t=arguments[0],n=arguments[1],r=arguments[2];this._min=t,this._max=n,this._item=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(e,t,n){if(!this.intersects(e,t))return null;n.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(di),gi=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var t=arguments[0],n=arguments[1];this._node1=t,this._node2=n,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(e,t){this._min=Math.min(e._min,t._min),this._max=Math.max(e._max,t._max)},t.prototype.query=function(e,t,n){if(!this.intersects(e,t))return null;null!==this._node1&&this._node1.query(e,t,n),null!==this._node2&&this._node2.query(e,t,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(di),yi=function(){this._leaves=new Se,this._root=null,this._level=0};yi.prototype.buildTree=function(){Qt.sort(this._leaves,new di.NodeComparator);for(var e=this._leaves,t=null,n=new Se;;){if(this.buildLevel(e,n),1===n.size())return n.get(0);t=e,e=n,n=t}},yi.prototype.insert=function(e,t,n){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new mi(e,t,n))},yi.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)},yi.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},yi.prototype.printNode=function(e){H.out.println(J.toLineString(new M(e._min,this._level),new M(e._max,this._level)))},yi.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},yi.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var r=e.get(n);if(null===(n+1<e.size()?e.get(n):null))t.add(r);else{var i=new gi(e.get(n),e.get(n+1));t.add(i)}}},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi};var vi=function(){this._items=new Se};vi.prototype.visitItem=function(e){this._items.add(e)},vi.prototype.getItems=function(){return this._items},vi.prototype.interfaces_=function(){return[Xt]},vi.prototype.getClass=function(){return vi};var _i=function(){this._index=null;var e=arguments[0];if(!P(e,Je))throw new v("Argument must be Polygonal");this._index=new wi(e)},xi={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};_i.prototype.locate=function(e){var t=new se(e),n=new bi(t);return this._index.query(e.y,e.y,n),t.getLocation()},_i.prototype.interfaces_=function(){return[Un]},_i.prototype.getClass=function(){return _i},xi.SegmentVisitor.get=function(){return bi},xi.IntervalIndexedGeometry.get=function(){return wi},Object.defineProperties(_i,xi);var bi=function(){this._counter=null;var e=arguments[0];this._counter=e};bi.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))},bi.prototype.interfaces_=function(){return[Xt]},bi.prototype.getClass=function(){return bi};var wi=function(){this._index=new yi;var e=arguments[0];this.init(e)};wi.prototype.init=function(e){for(var t=Mr.getLines(e).iterator();t.hasNext();){var n=t.next().getCoordinates();this.addLine(n)}},wi.prototype.addLine=function(e){for(var t=1;t<e.length;t++){var n=new mn(e[t-1],e[t]),r=Math.min(n.p0.y,n.p1.y),i=Math.max(n.p0.y,n.p1.y);this._index.insert(r,i,n)}},wi.prototype.query=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=new vi;return this._index.query(e,t,n),n.getItems()}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2];this._index.query(r,i,o)}},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi};var Si=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new dt,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Er,2===arguments.length){var t=arguments[0],n=arguments[1],r=fe.OGC_SFS_BOUNDARY_RULE;this._argIndex=t,this._parentGeom=n,this._boundaryNodeRule=r,null!==n&&this.add(n)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=i,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(e,n){var r=this._nodes.addNode(n).getLabel(),i=1;r.getLocation(e,Et.ON)===A.BOUNDARY&&i++;var o=t.determineBoundary(this._boundaryNodeRule,i);r.setLocation(e,o)},t.prototype.computeSelfNodes=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.computeSelfNodes(e,t,!1)}if(3===arguments.length){var n=arguments[1],r=arguments[2],i=new ui(arguments[0],!0,!1);i.setIsDoneIfProperInt(r);var o=this.createEdgeSetIntersector(),s=this._parentGeom instanceof tt||this._parentGeom instanceof Qe||this._parentGeom instanceof nt,a=n||!s;return o.computeIntersections(this._edges,i,a),this.addSelfIntersectionNodes(this._argIndex),i}},t.prototype.computeSplitEdges=function(e){for(var t=this._edges.iterator();t.hasNext();)t.next().eiList.addSplitEdges(e)},t.prototype.computeEdgeIntersections=function(e,t,n){var r=new ui(t,n,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,e._edges,r),r},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof Ke){var e=arguments[0].getCoordinate();this.insertPoint(this._argIndex,e,A.INTERIOR)}else if(arguments[0]instanceof M){var t=arguments[0];this.insertPoint(this._argIndex,t,A.INTERIOR)}},t.prototype.addPolygon=function(e){this.addPolygonRing(e.getExteriorRing(),A.EXTERIOR,A.INTERIOR);for(var t=0;t<e.getNumInteriorRing();t++){var n=e.getInteriorRingN(t);this.addPolygonRing(n,A.INTERIOR,A.EXTERIOR)}},t.prototype.addEdge=function(e){this.insertEdge(e);var t=e.getCoordinates();this.insertPoint(this._argIndex,t[0],A.BOUNDARY),this.insertPoint(this._argIndex,t[t.length-1],A.BOUNDARY)},t.prototype.addLineString=function(e){var t=Te.removeRepeatedPoints(e.getCoordinates());if(t.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=t[0],null;var n=new nr(t,new Lt(this._argIndex,A.INTERIOR));this._lineEdgeMap.put(e,n),this.insertEdge(n),te.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,t[0]),this.insertBoundaryPoint(this._argIndex,t[t.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),t=new Array(e.size()).fill(null),n=0,r=e.iterator();r.hasNext();){var i=r.next();t[n++]=i.getCoordinate().copy()}return t},t.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(e,t,n){if(this.isBoundaryNode(e,t))return null;n===A.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(e,t):this.insertPoint(e,t,n)},t.prototype.addPolygonRing=function(e,t,n){if(e.isEmpty())return null;var r=Te.removeRepeatedPoints(e.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=t,o=n;ae.isCCW(r)&&(i=n,o=t);var s=new nr(r,new Lt(this._argIndex,A.BOUNDARY,i,o));this._lineEdgeMap.put(e,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],A.BOUNDARY)},t.prototype.insertPoint=function(e,t,n){var r=this._nodes.addNode(t),i=r.getLabel();null===i?r._label=new Lt(e,n):i.setLocation(e,n)},t.prototype.createEdgeSetIntersector=function(){return new hi},t.prototype.addSelfIntersectionNodes=function(e){for(var t=this._edges.iterator();t.hasNext();)for(var n=t.next(),r=n.getLabel().getLocation(e),i=n.eiList.iterator();i.hasNext();){var o=i.next();this.addSelfIntersectionNode(e,o.coord,r)}},t.prototype.add=function(){if(1!==arguments.length)return e.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof nt&&(this._useBoundaryDeterminationRule=!1),t instanceof Qe)this.addPolygon(t);else if(t instanceof Xe)this.addLineString(t);else if(t instanceof Ke)this.addPoint(t);else if(t instanceof et)this.addCollection(t);else if(t instanceof Ge)this.addCollection(t);else if(t instanceof nt)this.addCollection(t);else{if(!(t instanceof Ve))throw new Error(t.getClass().getName());this.addCollection(t)}},t.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var n=e.getGeometryN(t);this.add(n)}},t.prototype.locate=function(e){return P(this._parentGeom,Je)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new _i(this._parentGeom)),this._areaPtLocator.locate(e)):this._ptLocator.locate(e,this._parentGeom)},t.prototype.findEdge=function(){if(1===arguments.length){var t=arguments[0];return this._lineEdgeMap.get(t)}return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(e,t){return e.isInBoundary(t)?A.BOUNDARY:A.INTERIOR},t}(Ht),Mi=function(){if(this._li=new ie,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Si(0,e)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],r=fe.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Si(0,t,r),this._arg[1]=new Si(1,n,r)}else if(3===arguments.length){var i=arguments[0],o=arguments[1],s=arguments[2];i.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Si(0,i,s),this._arg[1]=new Si(1,o,s)}};Mi.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()},Mi.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi};var Ei=function(){};Ei.prototype.interfaces_=function(){return[]},Ei.prototype.getClass=function(){return Ei},Ei.map=function(){if(arguments[0]instanceof ue&&P(arguments[1],Ei.MapOp)){for(var e=arguments[0],t=arguments[1],n=new Se,r=0;r<e.getNumGeometries();r++){var i=t.map(e.getGeometryN(r));null!==i&&n.add(i)}return e.getFactory().buildGeometry(n)}if(P(arguments[0],xe)&&P(arguments[1],Ei.MapOp)){for(var o=arguments[0],s=arguments[1],a=new Se,l=o.iterator();l.hasNext();){var c=l.next(),u=s.map(c);null!==u&&a.add(u)}return a}},Ei.MapOp=function(){};var Ti=function(e){function t(){var t=arguments[0],n=arguments[1];e.call(this,t,n),this._ptLocator=new Er,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new $n,this._resultPolyList=new Se,this._resultLineList=new Se,this._resultPointList=new Se,this._graph=new Ht(new Zn),this._geomFact=t.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new Lt(e.getLabel())).flip();var i=t.getDepth();i.isNull()&&i.add(n),i.add(r),n.merge(r)}else this._edgeList.add(e)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var t=e.next(),n=t.getSym();t.isInResult()&&n.isInResult()&&(t.setInResult(!1),n.setInResult(!1))}},t.prototype.isCoveredByLA=function(e){return!!this.isCovered(e,this._resultLineList)||!!this.isCovered(e,this._resultPolyList)},t.prototype.computeGeometry=function(e,n,r,i){var o=new Se;return o.addAll(e),o.addAll(n),o.addAll(r),o.isEmpty()?t.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},t.prototype.mergeSymLabels=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().mergeSymLabels()},t.prototype.isCovered=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();if(this._ptLocator.locate(e,r)!==A.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var e=new Se,t=this._edgeList.iterator();t.hasNext();){var n=t.next();n.isCollapsed()&&(t.remove(),e.add(n.getCollapsedEdge()))}this._edgeList.addAll(e)},t.prototype.updateNodeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),n=t.getEdges().getLabel();t.getLabel().merge(n)}},t.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this._resultGeom},t.prototype.insertUniqueEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();this.insertUniqueEdge(n)}},t.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var t=new Se;this._arg[0].computeSplitEdges(t),this._arg[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Hr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var n=new Zt(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var r=new Wr(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(e);var i=new $r(this,this._geomFact,this._ptLocator);this._resultPointList=i.build(e),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,e)},t.prototype.labelIncompleteNode=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._arg[t].getGeometry());e.getLabel().setLocation(t,n)},t.prototype.copyPoints=function(e){for(var t=this._arg[e].getNodeIterator();t.hasNext();){var n=t.next();this._graph.addNode(n.getCoordinate()).setLabel(e,n.getLabel().getLocation(e))}},t.prototype.findResultAreaEdges=function(e){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea()&&!r.isInteriorAreaEdge()&&t.isResultOfOp(i.getLocation(0,Et.RIGHT),i.getLocation(1,Et.RIGHT),e)&&r.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var e=this._edgeList.iterator();e.hasNext();){var t=e.next(),n=t.getLabel(),r=t.getDepth();if(!r.isNull()){r.normalize();for(var i=0;i<2;i++)n.isNull(i)||!n.isArea()||r.isNull(i)||(0===r.getDelta(i)?n.toLine(i):(te.isTrue(!r.isNull(i,Et.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(i,Et.LEFT,r.getLocation(i,Et.LEFT)),te.isTrue(!r.isNull(i,Et.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(i,Et.RIGHT,r.getLocation(i,Et.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),n=t.getLabel();t.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(n)}},t.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Mi);Ti.overlayOp=function(e,t,n){return new Ti(e,t).getResultGeometry(n)},Ti.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return Ti.createEmptyResult(Ti.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return Zr.map(e,{interfaces_:function(){return[Ei.MapOp]},map:function(e){return e.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oi.overlayOp(e,t,Ti.INTERSECTION)},Ti.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ti.createEmptyResult(Ti.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oi.overlayOp(e,t,Ti.SYMDIFFERENCE)},Ti.resultDimension=function(e,t,n){var r=t.getDimension(),i=n.getDimension(),o=-1;switch(e){case Ti.INTERSECTION:o=Math.min(r,i);break;case Ti.UNION:o=Math.max(r,i);break;case Ti.DIFFERENCE:o=r;break;case Ti.SYMDIFFERENCE:o=Math.max(r,i)}return o},Ti.createEmptyResult=function(e,t,n,r){var i=null;switch(Ti.resultDimension(e,t,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon()}return i},Ti.difference=function(e,t){return e.isEmpty()?Ti.createEmptyResult(Ti.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oi.overlayOp(e,t,Ti.DIFFERENCE))},Ti.isResultOfOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return Ti.isResultOfOp(n,r,t)}if(3===arguments.length){var i=arguments[0],o=arguments[1];switch(i===A.BOUNDARY&&(i=A.INTERIOR),o===A.BOUNDARY&&(o=A.INTERIOR),arguments[2]){case Ti.INTERSECTION:return i===A.INTERIOR&&o===A.INTERIOR;case Ti.UNION:return i===A.INTERIOR||o===A.INTERIOR;case Ti.DIFFERENCE:return i===A.INTERIOR&&o!==A.INTERIOR;case Ti.SYMDIFFERENCE:return i===A.INTERIOR&&o!==A.INTERIOR||i!==A.INTERIOR&&o===A.INTERIOR}return!1}},Ti.INTERSECTION=1,Ti.UNION=2,Ti.DIFFERENCE=3,Ti.SYMDIFFERENCE=4;var Ci=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Er,this._seg=new mn;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};Ci.prototype.isWithinToleranceOfBoundary=function(e){for(var t=0;t<this._linework.getNumGeometries();t++)for(var n=this._linework.getGeometryN(t).getCoordinateSequence(),r=0;r<n.size()-1;r++)if(n.getCoordinate(r,this._seg.p0),n.getCoordinate(r+1,this._seg.p1),this._seg.distance(e)<=this._boundaryDistanceTolerance)return!0;return!1},Ci.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?A.BOUNDARY:this._ptLocator.locate(e,this._g)},Ci.prototype.extractLinework=function(e){var t=new Ai;e.apply(t);var n=t.getLinework(),r=yt.toLineStringArray(n);return e.getFactory().createMultiLineString(r)},Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci};var Ai=function(){this._linework=null,this._linework=new Se};Ai.prototype.getLinework=function(){return this._linework},Ai.prototype.filter=function(e){if(e instanceof Qe){var t=e;this._linework.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)this._linework.add(t.getInteriorRingN(n))}},Ai.prototype.interfaces_=function(){return[Ue]},Ai.prototype.getClass=function(){return Ai};var Ii=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};Ii.prototype.extractPoints=function(e,t,n){for(var r=e.getCoordinates(),i=0;i<r.length-1;i++)this.computeOffsetPoints(r[i],r[i+1],t,n)},Ii.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t},Ii.prototype.getPoints=function(e){for(var t=new Se,n=Mr.getLines(this._g).iterator();n.hasNext();){var r=n.next();this.extractPoints(r,e,t)}return t},Ii.prototype.computeOffsetPoints=function(e,t,n,r){var i=t.x-e.x,o=t.y-e.y,s=Math.sqrt(i*i+o*o),a=n*i/s,l=n*o/s,c=(t.x+e.x)/2,u=(t.y+e.y)/2;if(this._doLeft){var h=new M(c-l,u+a);r.add(h)}if(this._doRight){var d=new M(c+l,u-a);r.add(d)}},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii};var Pi=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new Se;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,r],this._locFinder=[new Ci(this._geom[0],this._boundaryDistanceTolerance),new Ci(this._geom[1],this._boundaryDistanceTolerance),new Ci(this._geom[2],this._boundaryDistanceTolerance)]},Ri={TOLERANCE:{configurable:!0}};Pi.prototype.reportResult=function(e,t,n){H.out.println("Overlay result invalid - A:"+A.toLocationSymbol(t[0])+" B:"+A.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+A.toLocationSymbol(t[2]))},Pi.prototype.isValid=function(e){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(e)},Pi.prototype.checkValid=function(){if(1===arguments.length){for(var e=arguments[0],t=0;t<this._testCoords.size();t++){var n=this._testCoords.get(t);if(!this.checkValid(e,n))return this._invalidLocation=n,!1}return!0}if(2===arguments.length){var r=arguments[0],i=arguments[1];return this._location[0]=this._locFinder[0].getLocation(i),this._location[1]=this._locFinder[1].getLocation(i),this._location[2]=this._locFinder[2].getLocation(i),!!Pi.hasLocation(this._location,A.BOUNDARY)||this.isValidResult(r,this._location)}},Pi.prototype.addTestPts=function(e){var t=new Ii(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))},Pi.prototype.isValidResult=function(e,t){var n=Ti.isResultOfOp(t[0],t[1],e),r=!(n^t[2]===A.INTERIOR);return r||this.reportResult(e,t,n),r},Pi.prototype.getInvalidLocation=function(){return this._invalidLocation},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},Pi.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1},Pi.computeBoundaryDistanceTolerance=function(e,t){return Math.min(Yr.computeSizeBasedSnapTolerance(e),Yr.computeSizeBasedSnapTolerance(t))},Pi.isValid=function(e,t,n,r){return new Pi(e,t,r).isValid(n)},Ri.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Pi,Ri);var Li=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Li.prototype.extractElements=function(e,t){if(null===e)return null;for(var n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);this._skipEmpty&&r.isEmpty()||t.add(r)}},Li.prototype.combine=function(){for(var e=new Se,t=this._inputGeoms.iterator();t.hasNext();){var n=t.next();this.extractElements(n,e)}return 0===e.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Li.combine=function(){return 1===arguments.length?new Li(arguments[0]).combine():2===arguments.length?new Li(Li.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Li(Li.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Li.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},Li.createList=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],n=new Se;return n.add(e),n.add(t),n}if(3===arguments.length){var r=arguments[0],i=arguments[1],o=arguments[2],s=new Se;return s.add(r),s.add(i),s.add(o),s}};var Di=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,null===this._inputPolys&&(this._inputPolys=new Se)},Oi={STRTREE_NODE_CAPACITY:{configurable:!0}};Di.prototype.reduceToGeometries=function(e){for(var t=new Se,n=e.iterator();n.hasNext();){var r=n.next(),i=null;P(r,we)?i=this.unionTree(r):r instanceof ue&&(i=r),t.add(i)}return t},Di.prototype.extractByEnvelope=function(e,t,n){for(var r=new Se,i=0;i<t.getNumGeometries();i++){var o=t.getGeometryN(i);o.getEnvelopeInternal().intersects(e)?r.add(o):n.add(o)}return this._geomFactory.buildGeometry(r)},Di.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!n.intersects(r))return Li.combine(e,t);if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var i=n.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,i)},Di.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new sn(Di.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=e.itemsTree();return this.unionTree(r)},Di.prototype.binaryUnion=function(){if(1===arguments.length){var e=arguments[0];return this.binaryUnion(e,0,e.size())}if(3===arguments.length){var t=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Di.getGeometry(t,n);return this.unionSafe(i,null)}if(r-n==2)return this.unionSafe(Di.getGeometry(t,n),Di.getGeometry(t,n+1));var o=Math.trunc((r+n)/2),s=this.binaryUnion(t,n,o),a=this.binaryUnion(t,o,r);return this.unionSafe(s,a)}},Di.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var r=n.next();t=null===t?r.copy():t.union(r)}return t},Di.prototype.unionSafe=function(e,t){return null===e&&null===t?null:null===e?t.copy():null===t?e.copy():this.unionOptimized(e,t)},Di.prototype.unionActual=function(e,t){return Di.restrictToPolygons(e.union(t))},Di.prototype.unionTree=function(e){var t=this.reduceToGeometries(e);return this.binaryUnion(t)},Di.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var r=new Se,i=this.extractByEnvelope(n,e,r),o=this.extractByEnvelope(n,t,r),s=this.unionActual(i,o);return r.add(s),Li.combine(r)},Di.prototype.bufferUnion=function(){if(1===arguments.length){var e=arguments[0];return e.get(0).getFactory().buildGeometry(e).buffer(0)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t.getFactory().createGeometryCollection([t,n]).buffer(0)}},Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Di.restrictToPolygons=function(e){if(P(e,Je))return e;var t=Sr.getPolygons(e);return 1===t.size()?t.get(0):e.getFactory().createMultiPolygon(yt.toPolygonArray(t))},Di.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)},Di.union=function(e){return new Di(e).union()},Oi.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Di,Oi);var Ni=function(){};Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni},Ni.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ti.createEmptyResult(Ti.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),oi.overlayOp(e,t,Ti.UNION)},e.GeoJSONReader=St,e.GeoJSONWriter=Mt,e.OverlayOp=Ti,e.UnionOp=Ni,e.BufferOp=mr,Object.defineProperty(e,"__esModule",{value:!0})}(t)},2152:(e,t,n)=>{"use strict";var r=n(7313),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useSyncExternalStore,s=r.useRef,a=r.useEffect,l=r.useMemo,c=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,u){var h=s(null);if(null===h.current){var d={hasValue:!1,value:null};h.current=d}else d=h.current;h=l((function(){function e(e){if(!a){if(a=!0,o=e,e=r(e),void 0!==u&&d.hasValue){var t=d.value;if(u(t,e))return s=t}return s=e}if(t=s,i(o,e))return t;var n=r(e);return void 0!==u&&u(t,n)?t:(o=e,s=n)}var o,s,a=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]}),[t,n,r,u]);var p=o(e,h[0],h[1]);return a((function(){d.hasValue=!0,d.value=p}),[p]),c(p),p}},6377:(e,t,n)=>{"use strict";e.exports=n(2152)},6158:function(e){e.exports=function(){"use strict";var e,t,n;function r(r,i){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),n=i(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=i;else e=i}return r(0,(function(e){var t="undefined"!=typeof self?self:{},n="3.0.1";let r;const i={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=null!={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX):e}catch(t){r=e}}return r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!i.API_URL)return null;try{const e=new URL(i.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},o={supported:!1,testSupport:function(e){!l&&a&&(c?u(e):s=e)}};let s,a,l=!1,c=!1;function u(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.isContextLost())return;o.supported=!0}catch(e){}e.deleteTexture(t),l=!0}t.document&&(a=t.document.createElement("img"),a.onload=function(){s&&u(s),s=null,c=!0},a.onerror=function(){l=!0,s=null},a.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const h="01";function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=f;function f(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}f.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var s=0,a=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var m=d(p),g=y;function y(e,t){this.x=e,this.y=t}y.prototype={clone:function(){return new y(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},y.convert=function(e){return e instanceof y?e:Array.isArray(e)?new y(e[0],e[1]):e};var v=d(g);function _(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!_(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!_(e[n],t[n]))return!1;return!0}return e===t}const x=Math.PI/180,b=180/Math.PI;function w(e){return e*x}function S(e){return e*b}const M=[[0,0],[1,0],[1,1],[0,1]];function E(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function T(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y);return{min:new v(t,n),max:new v(r,i)}}function C(e,t,n=0,r=!0){const i=new v(n,n),o=e.sub(i),s=t.add(i),a=[o,new v(s.x,o.y),s,new v(o.x,s.y)];return r&&a.push(o.clone()),a}function A(e,t,n,r){const i=new m(e,t,n,r);return function(e){return i.solve(e)}}const I=A(.25,.1,.25,1);function P(e,t,n){return Math.min(n,Math.max(t,e))}function R(e,t,n){return(n=P((n-e)/(t-e),0,1))*n*(3-2*n)}function L(e,t,n){const r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function D(e,t,n){if(!e.length)return n(null,[]);let r=e.length;const i=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),i[s]=t,0==--r&&n(o,i)}))}))}function O(e){const t=[];for(const n in e)t.push(e[n]);return t}function N(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}function k(e,t){const n={};for(let r=0;r<t.length;r++){const i=t[r];i in e&&(n[i]=e[i])}return n}let F=1;function z(){return F++}function B(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function U(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function j(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function V(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function G(e,t){return-1!==e.indexOf(t,e.length-t.length)}function H(e,t,n){const r={};for(const i in e)r[i]=t.call(n||this,e[i],i,e);return r}function Z(e,t,n){const r={};for(const i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function W(e){return Array.isArray(e)?e.map(W):"object"==typeof e&&e?H(e,W):e}const $={};function q(e){$[e]||("undefined"!=typeof console&&console.warn(e),$[e]=!0)}function X(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Y(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function K([e,t,n]){const r=w(t+90),i=w(n);return{x:e*Math.cos(r)*Math.sin(i),y:e*Math.sin(r)*Math.sin(i),z:e*Math.cos(i),azimuthal:t,polar:n}}function J(e,t,n){const r=Math.sqrt(e*e+t*t+n*n),i=r>0?Math.acos(n/r)*b:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*b+90:0;return o<0&&(o+=360),[r,o,i]}function Q(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ee(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,r,i)=>{const o=r||i;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let te=null;function ne(){return!!t.document.fullscreenElement||!!t.document.webkitFullscreenElement}function re(e){try{const n=t[e];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function ie(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function oe(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function se(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function ae(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const le="mapbox-tiles";let ce,ue,he=500,de=50;function pe(){try{return t.caches}catch(e){}}function fe(){pe()&&!ce&&(ce=t.caches.open(le))}function me(e){const t=e.indexOf("?");if(t<0)return e;const n=function(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),r=n.filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return r.length?`${e.slice(0,t)}?${r.join("&")}`:e.slice(0,t)}let ge=1/0;function ye(e){ge++,ge>de&&(e.getActor().send("enforceCacheSizeLimit",he),ge=0)}const ve={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(ve);class _e extends Error{constructor(e,t,n){401===t&&Le(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xe=Q()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,be=function(e,n){if(!(/^file:/.test(r=e.url)||/^file:/.test(xe())&&!/^\w+:/.test(r))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,n){const r=new t.AbortController,i=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:xe(),referrerPolicy:e.referrerPolicy,signal:r.signal});let o=!1,s=!1;const a=(l=i.url).indexOf("sku=")>0&&Le(l);var l;"json"===e.type&&i.headers.set("Accept","application/json");const c=(r,o,l)=>{if(s)return;if(r&&"SecurityError"!==r.message&&q(r.toString()),o&&l)return u(o);const c=Date.now();t.fetch(i).then((t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return n(new _e(t.statusText,t.status,e.url))})).catch((t=>{"AbortError"!==t.name&&n(new Error(`${t.message} ${e.url}`))}))},u=(r,a,l)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{s||(a&&l&&function(e,n,r){if(fe(),!ce)return;const i={status:n.status,statusText:n.statusText,headers:new t.Headers};n.headers.forEach(((e,t)=>i.headers.set(t,e)));const o=ee(n.headers.get("Cache-Control")||"");if(o["no-store"])return;o["max-age"]&&i.headers.set("Expires",new Date(r+1e3*o["max-age"]).toUTCString());const s=i.headers.get("Expires");s&&(new Date(s).getTime()-r<42e4||function(e,t){if(void 0===ue)try{new Response(new ReadableStream),ue=!0}catch(e){ue=!1}ue?t(e.body):e.blob().then(t)}(n,(n=>{const r=new t.Response(n,i);fe(),ce&&ce.then((t=>t.put(me(e.url),r))).catch((e=>q(e.message)))})))}(i,a,l),o=!0,n(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>{s||n(new Error(e.message))}))};return a?function(e,t){if(fe(),!ce)return t(null);const n=me(e.url);ce.then((e=>{e.match(n).then((r=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),n=ee(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}(i,c):c(null,null),{cancel:()=>{s=!0,o||r.abort()}}}(e,n);if(Q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,n,void 0,!0)}var r;return function(e,n){const r=new t.XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{n(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let t=r.response;if("json"===e.type)try{t=JSON.parse(r.response)}catch(e){return n(e)}n(null,t,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else n(new _e(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,n)},we=function(e,t){return be(N(e,{type:"json"}),t)},Se=function(e,t){return be(N(e,{type:"arrayBuffer"}),t)};function Me(e){const n=t.document.createElement("a");return n.href=e,n.protocol===t.document.location.protocol&&n.host===t.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Te,Ce;Te=[],Ce=0;const Ae=function(e,n){if(o.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ce>=i.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return Te.push(t),t}Ce++;let r=!1;const s=()=>{if(!r)for(r=!0,Ce--;Te.length&&Ce<i.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Te.shift(),{requestParameters:t,callback:n,cancelled:r}=e;r||(e.cancel=Ae(t,n).cancel)}},a=Se(e,((e,r,i,o)=>{s(),e?n(e):r&&(t.createImageBitmap?function(e,n){const r=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(r).then((e=>{n(null,e)})).catch((e=>{n(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((e,t)=>n(e,t,i,o))):function(e,n){const r=new t.Image,i=t.URL;r.onload=()=>{n(null,r),i.revokeObjectURL(r.src),r.onload=null,t.requestAnimationFrame((()=>{r.src=Ee}))},r.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?i.createObjectURL(o):Ee}(r,((e,t)=>n(e,t,i,o))))}));return{cancel:()=>{a.cancel(),s()}}},Ie="NO_ACCESS_TOKEN";class Pe{constructor(e,t,n){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",h,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Re(e))return e;const r=Fe(e);return r.params.push(`sdk=js-${n}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Re(e))return e;const n=Fe(e);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Re(e))return e;const n=Fe(e);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||t)}normalizeSourceURL(e,t,n,r){if(!Re(e))return e;const i=Fe(e);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),n&&i.params.push(`language=${n}`),r&&i.params.push(`worldview=${r}`),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSpriteURL(e,t,n,r){const i=Fe(e);return Re(e)?(i.path=`/styles/v1${i.path}/sprite${t}${n}`,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=`${t}${n}`,ze(i))}normalizeTileURL(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Re(e))return e;const r=Fe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||n&&"raster"!==r.authority&&512===n?"@2x":""}${o.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${i.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${i.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||i.ACCESS_TOKEN;return i.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(e,t){const n=Fe(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+=`raster/${n.path.replace(`/${i.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${n.path.replace(`/${i.TILE_URL_VERSION}/`,"")}`;let o=n.params;return t&&(o=o.filter((e=>!e.match(/^access_token=/)))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(e,t){const n=!!t&&Re(t),r=[];for(const t of e.tiles||[])Le(t)?r.push(this.canonicalizeTileURL(t,n)):r.push(t);return r}_makeAPIURL(e,t){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Fe(i.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=`${r.path}${e.path}`),!i.REQUIRE_ACCESS_TOKEN)return ze(e);if(t=t||i.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),ze(e)}}function Re(e){return 0===e.indexOf("mapbox:")}function Le(e){return i.API_URL_REGEX.test(e)}function De(e){return i.API_CDN_URL_REGEX.test(e)}function Oe(e){return i.API_STYLE_REGEX.test(e)&&!Ne(e)}function Ne(e){return i.API_SPRITE_REGEX.test(e)}const ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Fe(e){const t=e.match(ke);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ze(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const Be="mapbox.eventData";function Ue(e){if(!e)return null;const n=e.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(n[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class je{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Ue(i.ACCESS_TOKEN);let r="";return r=n&&n.u?t.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):i.ACCESS_TOKEN||"",e?`${Be}.${e}:${r}`:`${Be}:${r}`}fetchEventData(){const e=re("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(n);e&&(this.eventData=JSON.parse(e));const i=t.localStorage.getItem(r);i&&(this.anonId=i)}catch(e){q("Unable to read from LocalStorage")}}saveEventData(){const e=re("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(n,JSON.stringify(this.eventData))}catch(e){q("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,r){if(!i.EVENTS_URL)return;const o=Fe(i.EVENTS_URL);o.params.push(`access_token=${r||i.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(e).toISOString()},a=t?N(s,t):s,l={url:ze(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(e,t){return be(N(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ve=new class extends je{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){i.EVENTS_URL&&i.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>Re(e)||Le(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ue(i.ACCESS_TOKEN),r=t?t.u:i.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;j(this.anonId)||(this.anonId=B(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(s),n=(s-this.eventData.lastSuccess)/864e5;o=o||n>=1||n<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:h,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)}),e):this.processRequests()}},Ge=Ve.postTurnstileEvent.bind(Ve),He=new class extends je{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,r){this.skuToken=t,this.errorCb=r,i.EVENTS_URL&&(n||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ie)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),j(this.anonId)||(this.anonId=B()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:n,skuId:h,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},Ze=He.postMapLoadEvent.bind(He),We=new class extends je{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){i.EVENTS_URL&&(e||i.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:i}=this.queue.shift(),o=function(e){const r=t.performance.getEntriesByType("resource"),i=t.performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const r of e[n]){const e=`${n}ResolveRangeMin`,i=`${n}ResolveRangeMax`,o=`${n}RequestCount`,s=`${n}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,r.startTime),t[i]=Math.max(t[i]||-1/0,r.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return t}(function(e,t){const n={};if(e)for(const r of e){const e=t(r);void 0===n[e]&&(n[e]=[]),n[e].push(r)}return n}(r,et)),s=t.devicePixelRatio,a=t.navigator.connection||t.navigator.mozConnection||t.navigator.webkitConnection,l={counters:[],metadata:[],attributes:[]},c=(e,t,n)=>{null!=n&&e.push({name:t,value:n.toString()})};for(const e in o)c(l.counters,e,o[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(c(l.counters,"interactionRangeMin",e.interactionRange[0]),c(l.counters,"interactionRangeMax",e.interactionRange[1])),i)for(const e of Object.keys(Je)){const t=Je[e],n=i.find((e=>e.name===t));n&&c(l.counters,t,n.startTime)}return c(l.counters,"visibilityHidden",e.visibilityHidden),c(l.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(Oe(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(r)),c(l.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),c(l.attributes,"fogEnabled",e.fogEnabled?"true":"false"),c(l.attributes,"projection",e.projection),c(l.attributes,"zoom",e.zoom),c(l.metadata,"devicePixelRatio",s),c(l.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),c(l.metadata,"navigatorUserAgent",t.navigator.userAgent),c(l.metadata,"screenWidth",t.screen.width),c(l.metadata,"screenHeight",t.screen.height),c(l.metadata,"windowWidth",t.innerWidth),c(l.metadata,"windowHeight",t.innerHeight),c(l.metadata,"mapWidth",e.width/s),c(l.metadata,"mapHeight",e.height/s),c(l.metadata,"webglRenderer",e.renderer),c(l.metadata,"webglVendor",e.vendor),c(l.metadata,"sdkVersion",n),c(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(i);for(const e of o.metadata);for(const e of o.counters);for(const e of o.attributes);this.postEvent(r,o,(()=>{}),e)}},$e=We.postPerformanceEvent.bind(We),qe=new class extends je{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,r){if(!i.API_URL||!i.SESSION_PATH)return;const o=Fe(i.API_URL+i.SESSION_PATH);o.params.push(`sku=${t||""}`),o.params.push(`access_token=${r||i.ACCESS_TOKEN||""}`);const s={url:ze(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return be(N(e,{method:"GET"}),t)}(s,(e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(e,t,n,r){this.skuToken=t,this.errorCb=r,i.SESSION_PATH&&i.API_URL&&(n||i.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ie)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},Xe=qe.getSessionAPI.bind(qe),Ye=new Set;function Ke(e,t){t?Ye.add(e):Ye.delete(e)}const Je={create:"create",load:"load",fullLoad:"fullLoad"},Qe={mark(e){t.performance.mark(e)},measure(e,n,r){t.performance.measure(e,n,r)}};function et(e){const t=e.name.split("?")[0];return De(t)&&t.includes("mapbox-gl.js")?"javascript":De(t)&&t.includes("mapbox-gl.css")?"css":function(e){return i.API_FONTS_REGEX.test(e)}(t)?"fontRange":Ne(t)?"sprite":Oe(t)?"style":function(e){return i.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}const tt=t.performance;function nt(e){const t=e?e.url.toString():void 0;return tt.getEntriesByName(t)}var rt=it;function it(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===ot[t=e&&e.failIfMajorPerformanceCaveat]&&(ot[t]=function(e){var t,n=function(e){var t=document.createElement("canvas"),n=Object.create(it.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=e,t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}(e);if(!n)return!1;try{t=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!t||n.isContextLost())&&(n.shaderSource(t,"void main() {}"),n.compileShader(t),!0===n.getShaderParameter(t,n.COMPILE_STATUS))}(t)),ot[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var ot={};let st,at,lt,ct;it.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ut={now:()=>void 0!==lt?lt:t.performance.now(),setNow(e){lt=e},restoreNow(){lt=void 0},frame(e){const n=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(n)}},getImageData(e,n=0){const{width:r,height:i}=e;ct||(ct=t.document.createElement("canvas"));const o=ct.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(r>ct.width||i>ct.height)&&(ct.width=r,ct.height=i),o.clearRect(-n,-n,r+2*n,i+2*n),o.drawImage(e,0,0,r,i),o.getImageData(-n,-n,r+2*n,i+2*n)},resolveURL:e=>(st||(st=t.document.createElement("a")),st.href=e,st.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==at&&(at=t.matchMedia("(prefers-reduced-motion: reduce)")),at.matches)}};function ht(e,n,r){const i=t.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i}function dt(e,n,r){const i=t.document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(n))i.setAttributeNS(null,e,n[e]);return r&&r.appendChild(i),i}const pt=t.document&&t.document.documentElement.style,ft=pt&&void 0!==pt.userSelect?"userSelect":"WebkitUserSelect";let mt;function gt(){pt&&ft&&(mt=pt[ft],pt[ft]="none")}function yt(){pt&&ft&&(pt[ft]=mt)}function vt(e){e.preventDefault(),e.stopPropagation(),t.removeEventListener("click",vt,!0)}function _t(){t.addEventListener("click",vt,!0),t.setTimeout((()=>{t.removeEventListener("click",vt,!0)}),0)}function xt(e,t){const n=e.getBoundingClientRect();return St(e,n,t)}function bt(e,t){const n=e.getBoundingClientRect(),r=[];for(let i=0;i<t.length;i++)r.push(St(e,n,t[i]));return r}function wt(e){return void 0!==t.InstallTrigger&&2===e.button&&e.ctrlKey&&t.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function St(e,t,n){const r=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new v((n.clientX-t.left)*r,(n.clientY-t.top)*r)}function Mt(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Et(e,t,n){if(n&&n[e]){const r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}class Tt{constructor(e,t={}){N(this,t),this.type=e}}class Ct extends Tt{constructor(e,t={}){super("error",N({error:e},t))}}class At{on(e,t){return this._listeners=this._listeners||{},Mt(e,t,this._listeners),this}off(e,t){return Et(e,t,this._listeners),Et(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Mt(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Tt(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of r)Et(n,t,this._oneTimeListeners),t.call(this,e);const i=this._eventedParent;i&&(N(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(e))}else e instanceof Ct&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var It=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Pt{constructor(e,t,n,r){this.message=(e?`${e}: `:"")+n,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}class Rt extends Pt{}function Lt(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}function Dt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ot(e){if(Array.isArray(e))return e.map(Ot);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=Ot(e[n]);return t}return Dt(e)}class Nt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var kt=Nt;class Ft{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,n]of t)this.bindings[e]=n}concat(e){return new Ft(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var zt=Ft;const Bt={kind:"null"},Ut={kind:"number"},jt={kind:"string"},Vt={kind:"boolean"},Gt={kind:"color"},Ht={kind:"object"},Zt={kind:"value"},Wt={kind:"collator"},$t={kind:"formatted"},qt={kind:"resolvedImage"};function Xt(e,t){return{kind:"array",itemType:e,N:t}}function Yt(e){if("array"===e.kind){const t=Yt(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Kt=[Bt,Ut,jt,Vt,Gt,$t,Ht,Xt(Zt),qt];function Jt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Jt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Kt)if(!Jt(e,t))return null}return`Expected ${Yt(e)} but found ${Yt(t)} instead.`}function Qt(e,t){return t.some((t=>t.kind===e.kind))}function en(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var tn,nn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function rn(e){return(e=Math.round(e))<0?0:e>255?255:e}function on(e){return rn("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function sn(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function an(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{tn={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in nn)return nn[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=n.indexOf("("),i=n.indexOf(")");if(-1!==r&&i+1===n.length){var o=n.substr(0,r),s=n.substr(r+1,i-(r+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=sn(s.pop());case"rgb":return 3!==s.length?null:[on(s[0]),on(s[1]),on(s[2]),a];case"hsla":if(4!==s.length)return null;a=sn(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=sn(s[1]),u=sn(s[2]),h=u<=.5?u*(c+1):u+c-u*c,d=2*u-h;return[rn(255*an(d,h,l+1/3)),rn(255*an(d,h,l)),rn(255*an(d,h,l-1/3)),a];default:return null}}return null}}catch(e){}class ln{constructor(e,t,n,r=1){this.r=e,this.g=t,this.b=n,this.a=r}static parse(e){if(!e)return;if(e instanceof ln)return e;if("string"!=typeof e)return;const t=tn(e);return t?new ln(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${r})`}toArray(){const{r:e,g:t,b:n,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*n/r,r]}toArray01(){const{r:e,g:t,b:n,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,n/r,r]}toArray01Scaled(e){const{r:t,g:n,b:r,a:i}=this;return 0===i?[0,0,0]:[t/i*e,n/i*e,r/i*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:r}=this;return[e,t,n,r]}toArray01Linear(){const{r:e,g:t,b:n,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(t/r,2.2),Math.pow(n/r,2.2),r]}}ln.black=new ln(0,0,0,1),ln.white=new ln(1,1,1,1),ln.transparent=new ln(0,0,0,0),ln.red=new ln(1,0,0,1),ln.blue=new ln(0,0,1,1);var cn=ln;class un{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hn{constructor(e,t,n,r,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=r,this.textColor=i}}class dn{constructor(e){this.sections=e}static fromString(e){return new dn([new hn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof dn?e:dn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class pn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new pn({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function fn(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof cn)return!0;if(e instanceof un)return!0;if(e instanceof dn)return!0;if(e instanceof pn)return!0;if(Array.isArray(e)){for(const t of e)if(!mn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!mn(e[t]))return!1;return!0}return!1}function gn(e){if(null===e)return Bt;if("string"==typeof e)return jt;if("boolean"==typeof e)return Vt;if("number"==typeof e)return Ut;if(e instanceof cn)return Gt;if(e instanceof un)return Wt;if(e instanceof dn)return $t;if(e instanceof pn)return qt;if(Array.isArray(e)){const t=e.length;let n;for(const t of e){const e=gn(t);if(n){if(n===e)continue;n=Zt;break}n=e}return Xt(n||Zt,t)}return Ht}function yn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof cn||e instanceof dn||e instanceof pn?e.toString():JSON.stringify(e)}class vn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mn(e[1]))return t.error("invalid value");const n=e[1];let r=gn(n);const i=t.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new vn(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof cn?["rgba"].concat(this.value.toArray()):this.value instanceof dn?this.value.serialize():this.value}}var _n=vn,xn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const bn={string:jt,number:Ut,boolean:Vt,object:Ht};class wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,r=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in bn)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=bn[n],r++}else i=Zt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}n=Xt(i,o)}else n=bn[i];const o=[];for(;r<e.length;r++){const n=t.parse(e[r],r,Zt);if(!n)return null;o.push(n)}return new wn(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Jt(this.type,gn(n)))return n;if(t===this.args.length-1)throw new xn(`Expected value to be of type ${Yt(this.type)}, but found ${Yt(gn(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}var Sn=wn;class Mn{constructor(e){this.type=$t,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const r=[];let i=!1;for(let n=1;n<=e.length-1;++n){const o=e[n];if(i&&"object"==typeof o&&!Array.isArray(o)){i=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Ut),!e))return null;let n=null;if(o["text-font"]&&(n=t.parse(o["text-font"],1,Xt(jt)),!n))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Gt),!s))return null;const a=r[r.length-1];a.scale=e,a.font=n,a.textColor=s}else{const o=t.parse(e[n],1,Zt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Mn(r)}evaluate(e){return new dn(this.sections.map((t=>{const n=t.content.evaluate(e);return gn(n)===qt?new hn("",n,null,null,null):new hn(yn(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class En{constructor(e,t){this.type=qt,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const n=t.parse(e[1],1,jt);if(!n)return t.error("No image name provided.");if(2===e.length)return new En(n);const r=t.parse(e[2],1,jt);return r?new En(n,r):t.error("Secondary image variant is not a string.")}evaluate(e){const t=pn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Tn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Cn={"to-boolean":Vt,"to-color":Gt,"to-number":Ut,"to-string":jt};class An{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0],r=[];let i=Bt;if("to-array"===n){if(!Array.isArray(e[1]))return null;const n=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);i=Xt(t.expectedType.itemType,n)}else{if(!(n>0&&mn(e[1][0])))return null;i=Xt(gn(e[1][0]),n)}for(let o=0;o<n;o++){const n=e[1][o];let s;if("array"===Tn(n))s=t.parse(n,void 0,i.itemType);else{const e=Tn(n);if(e!==i.itemType.kind)return t.error(`Expected ${i.itemType.kind} but found ${e}.`);s=t.registry.literal.parse(["literal",void 0===n?null:n],t)}if(!s)return null;r.push(s)}}else{if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");i=Cn[n];for(let n=1;n<e.length;n++){const i=t.parse(e[n],n,Zt);if(!i)return null;r.push(i)}}return new An(i,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const r of this.args){if(t=r.evaluate(e),n=null,t instanceof cn)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:fn(t[0],t[1],t[2],t[3]),!n))return new cn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xn(n||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new xn(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?dn.fromString(yn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?pn.fromString(yn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):yn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Mn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new En(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var In=An;const Pn=["Unknown","Point","LineString","Polygon"];var Rn=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Pn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=cn.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Ln{constructor(e,t,n,r){this.name=e,this.type=t,this._evaluate=n,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const n=e[0],r=Ln.definitions[n];if(!r)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new Hr(t.registry,t.path,null,t.scope,void 0,t.options);const s=[];let l=!1;for(let t=1;t<e.length;t++){const n=e[t],i=Array.isArray(r)?r[t-1]:r.type,o=a.parse(n,1+s.length,i);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,n=s[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Ln(n,i,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Yt).join(", ")})`:`(${Yt(t.type)}...)`;var t})).join(" | "),r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],1+r.length);if(!i)return null;r.push(Yt(i.type))}t.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){Ln.definitions=t;for(const n in t)e[n]=Ln}}var Dn=Ln;class On{constructor(e,t,n){this.type=Wt,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Vt);if(!r)return null;const i=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Vt);if(!i)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,jt),!o)?null:new On(r,i,o)}evaluate(e){return new un(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Nn={exports:{}};Nn.exports=function(){function e(n,r,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,l=r-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var d=n[r],p=i,f=o;for(t(n,i,r),s(n[o],d)>0&&t(n,i,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[i],d)?t(n,i,f):t(n,++f,o),f<=r&&(i=f+1),r<=f&&(o=f-1)}}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}return function(t,r,i,o,s){e(t,r,i||0,o||t.length-1,s||n)}}();var kn=d(Nn.exports);function Fn(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function zn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Bn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Un(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return r*s-o*i==0&&r*o<=0&&i*s<=0}function jn(e,t,n=!1){let r=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(Un(e,a,u))return n;(o=a)[1]>(i=e)[1]!=(s=u)[1]>i[1]&&i[0]<(s[0]-o[0])*(i[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var i,o,s;return r}function Vn(e,t,n,r){const i=r[0]-n[0],o=r[1]-n[1],s=(e[0]-n[0])*o-i*(e[1]-n[1]),a=(t[0]-n[0])*o-i*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Gn(e,t,n,r){return 0!=(i=[r[0]-n[0],r[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*o[0]&&!(!Vn(e,t,n,r)||!Vn(n,r,e,t));var i,o}const Hn=8192;function Zn(e,t){const n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*Hn),Math.round(r*i*Hn)]}function Wn(e,t){for(let n=0;n<t.length;n++)if(jn(e,t[n]))return!0;return!1}function $n(e,t,n){for(const r of n)for(let n=0,i=r.length,o=i-1;n<i;o=n++)if(Gn(e,t,r[o],r[n]))return!0;return!1}function qn(e,t){for(let n=0;n<e.length;++n)if(!jn(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if($n(e[n],e[n+1],t))return!1;return!0}function Xn(e,t){for(let n=0;n<t.length;n++)if(qn(e,t[n]))return!0;return!1}function Yn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=[];for(let r=0;r<e[i].length;r++){const s=Zn(e[i][r],n);zn(t,s),o.push(s)}r.push(o)}return r}function Kn(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=Yn(e[i],t,n);r.push(o)}return r}function Jn(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){const t=.5*r;let i=e[0]-n[0]>t?-r:n[0]-e[0]>t?r:0;0===i&&(i=e[0]-n[2]>t?-r:n[2]-e[0]>t?r:0),e[0]+=i}zn(t,e)}function Qn(e,t,n,r){const i=Math.pow(2,r.z)*Hn,o=[r.x*Hn,r.y*Hn],s=[];if(!e)return s;for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];Jn(r,t,n,i),s.push(r)}return s}function er(e,t,n,r){const i=Math.pow(2,r.z)*Hn,o=[r.x*Hn,r.y*Hn],s=[];if(!e)return s;for(const n of e){const e=[];for(const r of n){const n=[r.x+o[0],r.y+o[1]];zn(t,n),e.push(n)}s.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)Jn(r,t,n,i)}var a;return s}class tr{constructor(e,t){this.type=Vt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const n=t.features[e].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new tr(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new tr(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new tr(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Yn(t.coordinates,r,i),s=Qn(e.geometry(),n,r,i);if(!Bn(n,r))return!1;for(const e of s)if(!jn(e,o))return!1}if("MultiPolygon"===t.type){const o=Kn(t.coordinates,r,i),s=Qn(e.geometry(),n,r,i);if(!Bn(n,r))return!1;for(const e of s)if(!Wn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Yn(t.coordinates,r,i),s=er(e.geometry(),n,r,i);if(!Bn(n,r))return!1;for(const e of s)if(!qn(e,o))return!1}if("MultiPolygon"===t.type){const o=Kn(t.coordinates,r,i),s=er(e.geometry(),n,r,i);if(!Bn(n,r))return!1;for(const e of s)if(!Xn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var nr=tr,rr={exports:{}};rr.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,n=t*(2-t),r=Math.PI/180,i=function(t,i){if(void 0===t)throw new Error("No latitude given.");if(i&&!e[i])throw new Error("Unknown unit "+i+". Use one of: "+Object.keys(e).join(", "));var o=6378.137*r*(i?e[i]:1),s=Math.cos(t*r),a=1/(1-n*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-n)},o={units:{configurable:!0}};function s(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,t,n){var r=l(t[0]-e[0]);return[e[0]+r*n,e[1]+(t[1]-e[1])*n]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return i.fromTile=function(e,t,n){var o=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/r;return new i(s,n)},o.units.get=function(){return e},i.prototype.distance=function(e,t){var n=l(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+r*r)},i.prototype.bearing=function(e,t){var n=l(t[0]-e[0])*this.kx;return Math.atan2(n,(t[1]-e[1])*this.ky)/r},i.prototype.destination=function(e,t,n){var i=n*r;return this.offset(e,Math.sin(i)*t,Math.cos(i)*t)},i.prototype.offset=function(e,t,n){return[e[0]+t/this.kx,e[1]+n/this.ky]},i.prototype.lineDistance=function(e){for(var t=0,n=0;n<e.length-1;n++)t+=this.distance(e[n],e[n+1]);return t},i.prototype.area=function(e){for(var t=0,n=0;n<e.length;n++)for(var r=e[n],i=0,o=r.length,s=o-1;i<o;s=i++)t+=l(r[i][0]-r[s][0])*(r[i][1]+r[s][1])*(n?-1:1);return Math.abs(t)/2*this.kx*this.ky},i.prototype.along=function(e,t){var n=0;if(t<=0)return e[0];for(var r=0;r<e.length-1;r++){var i=e[r],o=e[r+1],s=this.distance(i,o);if((n+=s)>t)return a(i,o,(t-(n-s))/s)}return e[e.length-1]},i.prototype.pointToSegmentDistance=function(e,t,n){var r=t[0],i=t[1],o=l(n[0]-r)*this.kx,s=(n[1]-i)*this.ky,a=0;return 0===o&&0===s||((a=(l(e[0]-r)*this.kx*o+(e[1]-i)*this.ky*s)/(o*o+s*s))>1?(r=n[0],i=n[1]):a>0&&(r+=o/this.kx*a,i+=s/this.ky*a)),o=l(e[0]-r)*this.kx,s=(e[1]-i)*this.ky,Math.sqrt(o*o+s*s)},i.prototype.pointOnLine=function(e,t){for(var n,r,i,o,s=1/0,a=0;a<e.length-1;a++){var c=e[a][0],u=e[a][1],h=l(e[a+1][0]-c)*this.kx,d=(e[a+1][1]-u)*this.ky,p=0;0===h&&0===d||((p=(l(t[0]-c)*this.kx*h+(t[1]-u)*this.ky*d)/(h*h+d*d))>1?(c=e[a+1][0],u=e[a+1][1]):p>0&&(c+=h/this.kx*p,u+=d/this.ky*p));var f=(h=l(t[0]-c)*this.kx)*h+(d=(t[1]-u)*this.ky)*d;f<s&&(s=f,n=c,r=u,i=a,o=p)}return{point:[n,r],index:i,t:Math.max(0,Math.min(1,o))}},i.prototype.lineSlice=function(e,t,n){var r=this.pointOnLine(n,e),i=this.pointOnLine(n,t);if(r.index>i.index||r.index===i.index&&r.t>i.t){var o=r;r=i,i=o}var a=[r.point],l=r.index+1,c=i.index;!s(n[l],a[0])&&l<=c&&a.push(n[l]);for(var u=l+1;u<=c;u++)a.push(n[u]);return s(n[c],i.point)||a.push(i.point),a},i.prototype.lineSliceAlong=function(e,t,n){for(var r=0,i=[],o=0;o<n.length-1;o++){var s=n[o],l=n[o+1],c=this.distance(s,l);if((r+=c)>e&&0===i.length&&i.push(a(s,l,(e-(r-c))/c)),r>=t)return i.push(a(s,l,(t-(r-c))/c)),i;r>e&&i.push(l)}return i},i.prototype.bufferPoint=function(e,t){var n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[0]+r,e[1]+n]},i.prototype.bufferBBox=function(e,t){var n=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-n,e[2]+r,e[3]+n]},i.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(i,o),i}();var ir=d(rr.exports),or={exports:{}};or.exports=function(){var e=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n=t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r},e.prototype._down=function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var o=1+(e<<1),s=t[o],a=o+1;if(a<this.length&&n(t[a],s)<0&&(o=a,s=t[a]),n(s,i)>=0)break;t[e]=s,e=o}t[e]=i},e}();var sr=d(or.exports),ar=8192;function lr(e,t){return t.dist-e.dist}const cr=100,ur=50;function hr(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function dr(e){return e[1]-e[0]+1}function pr(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function fr(e,t){if(e[0]>e[1])return[null,null];const n=dr(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===n)return[e,null];const t=Math.floor(n/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function mr(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!pr(t,e.length))return n;for(let r=t[0];r<=t[1];++r)zn(n,e[r]);return n}function gr(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)zn(t,e[n][r]);return t}function yr(e,t,n){if(hr(e)||hr(t))return NaN;let r=0,i=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),n.distance([0,0],[r,i])}function vr(e,t){const n=Math.pow(2,t.z);return[(i=(e.x/ar+t.x)/n,360*i-180),(r=(e.y/ar+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,i}function _r(e,t){const n=[];for(let r=0;r<e.length;++r)n.push(vr(e[r],t));return n}function xr(e,t,n){const r=n.pointOnLine(t,e).point;return n.distance(e,r)}function br(e,t,n,r,i){const o=n.slice(r[0],r[1]+1);let s=1/0;for(let n=t[0];n<=t[1];++n)if(0===(s=Math.min(s,xr(e[n],o,i))))return 0;return s}function wr(e,t,n,r,i){const o=Math.min(i.pointToSegmentDistance(e,n,r),i.pointToSegmentDistance(t,n,r)),s=Math.min(i.pointToSegmentDistance(n,e,t),i.pointToSegmentDistance(r,e,t));return Math.min(o,s)}function Sr(e,t,n,r,i){if(!pr(t,e.length)||!pr(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let t=r[0];t<r[1];++t){if(Gn(e[s],e[s+1],n[t],n[t+1]))return 0;o=Math.min(o,wr(e[s],e[s+1],n[t],n[t+1],i))}return o}function Mr(e,t,n,r,i){if(!pr(t,e.length)||!pr(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(0===(o=Math.min(o,i.distance(e[s],n[t]))))return o;return o}function Er(e,t,n){if(jn(e,t,!0))return 0;let r=1/0;for(const i of t){const t=i.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[t-1]&&0===(r=Math.min(r,n.pointToSegmentDistance(e,i[t-1],i[0]))))return r;if(0===(r=Math.min(r,xr(e,i,n))))return r}return r}function Tr(e,t,n,r){if(!pr(t,e.length))return NaN;for(let r=t[0];r<=t[1];++r)if(jn(e[r],n,!0))return 0;let i=1/0;for(let o=t[0];o<t[1];++o)for(const t of n)for(let n=0,s=t.length,a=s-1;n<s;a=n++){if(Gn(e[o],e[o+1],t[a],t[n]))return 0;i=Math.min(i,wr(e[o],e[o+1],t[a],t[n],r))}return i}function Cr(e,t){for(const n of e)for(let e=0;e<=n.length-1;++e)if(jn(n[e],t,!0))return!0;return!1}function Ar(e,t,n,r=1/0){const i=gr(e),o=gr(t);if(r!==1/0&&yr(i,o,n)>=r)return r;if(Bn(i,o)){if(Cr(e,t))return 0}else if(Cr(t,e))return 0;let s=r;for(const r of e)for(let e=0,i=r.length,o=i-1;e<i;o=e++)for(const i of t)for(let t=0,a=i.length,l=a-1;t<a;l=t++){if(Gn(r[o],r[e],i[l],i[t]))return 0;s=Math.min(s,wr(r[o],r[e],i[l],i[t],n))}return s}function Ir(e,t,n,r,i,o,s){if(null===o||null===s)return;const a=yr(mr(r,o),mr(i,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function Pr(e,t,n,r,i=1/0){let o=Math.min(r.distance(e[0],n[0][0]),i);if(0===o)return o;const s=new sr([{dist:0,range1:[0,e.length-1],range2:[0,0]}],lr),a=t?ur:cr,l=gr(n);for(;s.length;){const i=s.pop();if(i.dist>=o)continue;const c=i.range1;if(dr(c)<=a){if(!pr(c,e.length))return NaN;if(t){const t=Tr(e,c,n,r);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const i=Er(e[t],n,r);if(0===(o=Math.min(o,i)))return o}}else{const n=fr(c,t);if(null!==n[0]){const t=yr(mr(e,n[0]),l,r);t<o&&s.push({dist:t,range1:n[0],range2:[0,0]})}if(null!==n[1]){const t=yr(mr(e,n[1]),l,r);t<o&&s.push({dist:t,range1:n[1],range2:[0,0]})}}}return o}function Rr(e,t,n,r,i,o=1/0){let s=Math.min(o,i.distance(e[0],n[0]));if(0===s)return s;const a=new sr([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],lr),l=t?ur:cr,c=r?ur:cr;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(dr(u)<=l&&dr(h)<=c){if(!pr(u,e.length)||!pr(h,n.length))return NaN;if(t&&r?s=Math.min(s,Sr(e,u,n,h,i)):t||r?t&&!r?s=Math.min(s,br(n,h,e,u,i)):!t&&r&&(s=Math.min(s,br(e,u,n,h,i))):s=Math.min(s,Mr(e,u,n,h,i)),0===s)return s}else{const o=fr(u,t),l=fr(h,r);Ir(a,s,i,e,n,o[0],l[0]),Ir(a,s,i,e,n,o[0],l[1]),Ir(a,s,i,e,n,o[1],l[0]),Ir(a,s,i,e,n,o[1],l[1])}}return s}function Lr(e,t,n,r,i=1/0){let o=i;const s=mr(e,[0,e.length-1]);for(const i of n)if(!(o!==1/0&&yr(s,mr(i,[0,i.length-1]),r)>=o)&&(o=Math.min(o,Rr(e,t,i,!0,r,o)),0===o))return o;return o}function Dr(e,t,n,r,i=1/0){let o=i;const s=mr(e,[0,e.length-1]);for(const i of n){if(o!==1/0&&yr(s,gr(i),r)>=o)continue;const n=Pr(e,t,i,r,o);if(isNaN(n))return n;if(0===(o=Math.min(o,n)))return o}return o}function Or(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class Nr{constructor(e,t){this.type=Ut,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(mn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(Or(t.features[e].geometry.type))return new Nr(t,t.features[e].geometry)}else if("Feature"===t.type){if(Or(t.geometry.type))return new Nr(t,t.geometry)}else if(Or(t.type))return new Nr(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),n=e.canonicalID();if(null!=t&&null!=n){if("Point"===e.geometryType())return function(e,t,n){const r=[];for(const n of e)for(const e of n)r.push(vr(e,t));const i=new ir(r[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?Rr(r,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,i):"MultiLineString"===n.type?Lr(r,!1,n.coordinates,i):"Polygon"===n.type||"MultiPolygon"===n.type?Dr(r,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,i):null}(t,n,this.geometries);if("LineString"===e.geometryType())return function(e,t,n){const r=[];for(const n of e){const e=[];for(const r of n)e.push(vr(r,t));r.push(e)}const i=new ir(r[0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Lr("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r,i);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Lr(n.coordinates[t],!0,r,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===n.type||"MultiPolygon"===n.type){let e=1/0;for(let t=0;t<r.length;t++){const o=Dr(r[t],!0,"Polygon"===n.type?[n.coordinates]:n.coordinates,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,n,this.geometries);if("Polygon"===e.geometryType())return function(e,t,n){const r=[];for(const n of function(e,t){const n=e.length;if(n<=1)return[e];const r=[];let i,o;for(let t=0;t<n;t++){const n=Fn(e[t]);0!==n&&(e[t].area=Math.abs(n),void 0===o&&(o=n<0),o===n<0?(i&&r.push(i),i=[e[t]]):i.push(e[t]))}return i&&r.push(i),r}(e)){const e=[];for(let r=0;r<n.length;++r)e.push(_r(n[r],t));r.push(e)}const i=new ir(r[0][0][0][1],"meters");if("Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type)return Dr("Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,r,i);if("MultiLineString"===n.type){let e=1/0;for(let t=0;t<n.coordinates.length;t++){const o=Dr(n.coordinates[t],!0,r,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===n.type||"MultiPolygon"===n.type?function(e,t,n){let r=1/0;for(const i of e)for(const e of t){const t=Ar(i,e,n,r);if(isNaN(t))return t;if(0===(r=Math.min(r,t)))return r}return r}("Polygon"===n.type?[n.coordinates]:n.coordinates,r,i):null}(t,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var kr=Nr;function Fr(e){if(e instanceof Dn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof nr)return!1;if(e instanceof kr)return!1;let t=!0;return e.eachChild((e=>{t&&!Fr(e)&&(t=!1)})),t}function zr(e){if(e instanceof Dn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!zr(e)&&(t=!1)})),t}function Br(e){if(e instanceof Dn&&"config"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Br(e)&&(t=!1)})),t}function Ur(e,t){if(e instanceof Dn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!Ur(e,t)&&(n=!1)})),n}class jr{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new jr(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Vr=jr;class Gr{constructor(e,t=[],n,r=new zt,i=[],o){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=i,this.expectedType=n,this.options=o}parse(e,t,n,r,i={}){return t||n?this.concat(t,n,r)._parse(e,i):this._parse(e,i)}_parse(e,t){function n(e,t,n){return"assert"===n?new Sn(t,[e]):"coerce"===n?new In(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof e[0]?this.registry[e[0]]:void 0;if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof _n)&&"resolvedImage"!==i.type.kind&&Zr(i)){const t=new Rn(this.options);try{i=new _n(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return In.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const r="number"==typeof e?this.path.concat(e):this.path,i=n?this.scope.concat(n):this.scope;return new Gr(this.registry,r,t||null,i,this.errors,this.options)}error(e,...t){const n=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new kt(n,e))}checkSubtype(e,t){const n=Jt(e,t);return n&&this.error(n),n}}var Hr=Gr;function Zr(e){if(e instanceof Vr)return Zr(e.boundExpression);if(e instanceof Dn&&"error"===e.name)return!1;if(e instanceof Dn&&"config"===e.name)return!1;if(e instanceof On)return!1;if(e instanceof nr)return!1;if(e instanceof kr)return!1;const t=e instanceof In||e instanceof Sn;let n=!0;return e.eachChild((e=>{n=t?n&&Zr(e):n&&e instanceof _n})),!!n&&Fr(e)&&Ur(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Wr(e,t){const n=e.length-1;let r,i,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],i=e[a+1],r<=t){if(a===n||t<i)return a;o=a+1}else{if(!(r>t))throw new xn("Input is not a number.");s=a-1}return 0}class $r{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,Ut);if(!n)return null;const r=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let n=1;n<e.length;n+=2){const o=1===n?-1/0:e[n],s=e[n+1],a=n,l=n+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,i);if(!c)return null;i=i||c.type,r.push([o,c])}return new $r(i,n,r)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[Wr(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var qr=$r;function Xr(e,t,n){return e*(1-n)+t*n}function Yr(e,t,n){return e.map(((e,r)=>Xr(e,t[r],n)))}var Kr=Object.freeze({__proto__:null,array:Yr,color:function(e,t,n){return new cn(Xr(e.r,t.r,n),Xr(e.g,t.g,n),Xr(e.b,t.b,n),Xr(e.a,t.a,n))},number:Xr});const Jr=.95047,Qr=1.08883,ei=4/29,ti=6/29,ni=3*ti*ti,ri=ti*ti*ti,ii=Math.PI/180,oi=180/Math.PI;function si(e){return e>ri?Math.pow(e,1/3):e/ni+ei}function ai(e){return e>ti?e*e*e:ni*(e-ei)}function li(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ci(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ui(e){const t=ci(e.r),n=ci(e.g),r=ci(e.b),i=si((.4124564*t+.3575761*n+.1804375*r)/Jr),o=si((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-si((.0193339*t+.119192*n+.9503041*r)/Qr)),alpha:e.a}}function hi(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*ai(t),n=Jr*ai(n),r=Qr*ai(r),new cn(li(3.2404542*n-1.5371385*t-.4985314*r),li(-.969266*n+1.8760108*t+.041556*r),li(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function di(e,t,n){const r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const pi={forward:ui,reverse:hi,interpolate:function(e,t,n){return{l:Xr(e.l,t.l,n),a:Xr(e.a,t.a,n),b:Xr(e.b,t.b,n),alpha:Xr(e.alpha,t.alpha,n)}}},fi={forward:function(e){const{l:t,a:n,b:r}=ui(e),i=Math.atan2(r,n)*oi;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ii,n=e.c;return hi({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:di(e.h,t.h,n),c:Xr(e.c,t.c,n),l:Xr(e.l,t.l,n),alpha:Xr(e.alpha,t.alpha,n)}}};var mi=Object.freeze({__proto__:null,hcl:fi,lab:pi});class gi{constructor(e,t,n,r,i){this.type=e,this.operator=t,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,n,r){let i=0;if("exponential"===e.name)i=yi(t,e.base,n,r);else if("linear"===e.name)i=yi(t,1,n,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new m(o[0],o[1],o[2],o[3]).solve(yi(t,1,n,r))}return i}static parse(e,t){let[n,r,i,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,Ut),!i)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Gt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const n=o[e],r=o[e+1],i=e+3,l=e+4;if("number"!=typeof n)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(s.length&&s[s.length-1][0]>=n)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([n,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new gi(a,n,r,i,s):t.error(`Type ${Yt(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);const i=t.length;if(r>=t[i-1])return n[i-1].evaluate(e);const o=Wr(t,r),s=gi.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);return"interpolate"===this.operator?Kr[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?fi.reverse(fi.interpolate(fi.forward(a),fi.forward(l),s)):pi.reverse(pi.interpolate(pi.forward(a),pi.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function yi(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}var vi=gi;class _i{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const r=t.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const r of e.slice(1)){const e=t.parse(r,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,i.push(e)}const o=r&&i.some((e=>Jt(r,e.type)));return new _i(o?Zt:n,i)}evaluate(e){let t,n=null,r=0;for(const i of this.args){if(r++,n=i.evaluate(e),n&&n instanceof pn&&!n.available&&(t||(t=n),n=null,r===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var xi=_i;class bi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let r=1;r<e.length-1;r+=2){const i=e[r];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;n.push([i,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return r?new bi(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var wi=bi;class Si{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Ut),r=t.parse(e[2],2,Xt(t.expectedType||Zt));return n&&r?new Si(r.type.itemType,n,r):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new xn(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new xn(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new xn(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Mi=Si;class Ei{constructor(e,t){this.type=Vt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Zt),r=t.parse(e[2],2,Zt);return n&&r?Qt(n.type,[Vt,jt,Ut,Bt,Zt])?new Ei(n,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!en(t,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(gn(t))} instead.`);if(!en(n,["string","array"]))throw new xn(`Expected second argument to be of type array or string, but found ${Yt(gn(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ti=Ei;class Ci{constructor(e,t,n){this.type=Ut,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Zt),r=t.parse(e[2],2,Zt);if(!n||!r)return null;if(!Qt(n.type,[Vt,jt,Ut,Bt,Zt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ut);return i?new Ci(n,r,i):null}return new Ci(n,r)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!en(t,["boolean","string","number","null"]))throw new xn(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(gn(t))} instead.`);if(!en(n,["string","array"]))throw new xn(`Expected second argument to be of type array or string, but found ${Yt(gn(n))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ai=Ci;class Ii{constructor(e,t,n,r,i,o){this.inputType=e,this.type=t,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const i={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,gn(e)))return null}else n=gn(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,Zt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new Ii(n,r,s,i,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(gn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=n.length,n.push([this.cases[e],[e]])):n[t][1].push(e)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of n)e.push(1===r.length?i(r[0]):r.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var Pi=Ii;class Ri{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r=[];for(let i=1;i<e.length-1;i+=2){const o=t.parse(e[i],i,Vt);if(!o)return null;const s=t.parse(e[i+1],i+1,n);if(!s)return null;r.push([o,s]),n=n||s.type}const i=t.parse(e[e.length-1],e.length-1,n);return i?new Ri(n,r,i):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Li=Ri;class Di{constructor(e,t,n,r){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Zt),r=t.parse(e[2],2,Ut);if(!n||!r)return null;if(!Qt(n.type,[Xt(Zt),jt,Zt]))return t.error(`Expected first argument to be of type array or string, but found ${Yt(n.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,Ut);return i?new Di(n.type,n,r,i):null}return new Di(n.type,n,r)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!en(t,["string","array"]))throw new xn(`Expected first argument to be of type array or string, but found ${Yt(gn(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Oi=Di;function Ni(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ki(e,t,n,r){return 0===r.compare(t,n)}function Fi(e,t,n){const r="=="!==e&&"!="!==e;return class i{constructor(e,t,n){this.type=Vt,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,Zt);if(!o)return null;if(!Ni(n,o.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${Yt(o.type)}'.`);let s=t.parse(e[2],2,Zt);if(!s)return null;if(!Ni(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${Yt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Yt(o.type)}' and '${Yt(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Sn(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Sn(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Wt),!a)return null}return new i(o,s,a)}evaluate(i){const o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const t=gn(o),n=gn(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new xn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=gn(o),n=gn(s);if("string"!==e.kind||"string"!==n.kind)return t(i,o,s)}return this.collator?n(i,o,s,this.collator.evaluate(i)):t(i,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const zi=Fi("==",(function(e,t,n){return t===n}),ki),Bi=Fi("!=",(function(e,t,n){return t!==n}),(function(e,t,n,r){return!ki(0,t,n,r)})),Ui=Fi("<",(function(e,t,n){return t<n}),(function(e,t,n,r){return r.compare(t,n)<0})),ji=Fi(">",(function(e,t,n){return t>n}),(function(e,t,n,r){return r.compare(t,n)>0})),Vi=Fi("<=",(function(e,t,n){return t<=n}),(function(e,t,n,r){return r.compare(t,n)<=0})),Gi=Fi(">=",(function(e,t,n){return t>=n}),(function(e,t,n,r){return r.compare(t,n)>=0}));class Hi{constructor(e,t,n,r,i,o){this.type=jt,this.number=e,this.locale=t,this.currency=n,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,Ut);if(!n)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=t.parse(r.locale,1,jt),!i))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,jt),!o))return null;let s=null;if(r.unit&&(s=t.parse(r.unit,1,jt),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=t.parse(r["min-fraction-digits"],1,Ut),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=t.parse(r["max-fraction-digits"],1,Ut),!l)?null:new Hi(n,i,o,s,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Zi{constructor(e){this.type=Ut,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${Yt(n.type)} instead.`):new Zi(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new xn(`Expected value to be of type string or array, but found ${Yt(gn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function Wi(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const $i={"==":zi,"!=":Bi,">":ji,"<":Ui,">=":Gi,"<=":Vi,array:Sn,at:Mi,boolean:Sn,case:Li,coalesce:xi,collator:On,format:Mn,image:En,in:Ti,"index-of":Ai,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:Zi,let:wi,literal:_n,match:Pi,number:Sn,"number-format":Hi,object:Sn,slice:Oi,step:qr,string:Sn,"to-boolean":In,"to-color":In,"to-number":In,"to-string":In,var:Vr,within:nr,distance:kr};function qi(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);const o=i?i.evaluate(e):1,s=fn(t,n,r,o);if(s)throw new xn(s);return new cn(t/255*o,n/255*o,r/255*o,o)}function Xi(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);const o=i?i.evaluate(e):1,s=function(e,t,n,r){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof n&&n>=0&&n<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", ")}]: 'h' must be between 0 and 360.`}(t,n,r,o);if(s)throw new xn(s);const a=`hsla(${t}, ${n}%, ${r}%, ${o})`,l=cn.parse(a);if(!l)throw new xn(`Failed to parse HSLA color: ${a}`);return l}function Yi(e,t){return e in t}function Ki(e,t){const n=t[e];return void 0===n?null:n}function Ji(e,t,n){n.length&&(t+=`${n}`);const r=e.getConfig(t);return r?r.evaluate(e):null}function Qi(e){return{type:e}}Dn.register($i,{error:[{kind:"error"},[jt],(e,[t])=>{throw new xn(t.evaluate(e))}],typeof:[jt,[Zt],(e,[t])=>Yt(gn(t.evaluate(e)))],"to-rgba":[Xt(Ut,4),[Gt],(e,[t])=>t.evaluate(e).toArray()],rgb:[Gt,[Ut,Ut,Ut],qi],rgba:[Gt,[Ut,Ut,Ut,Ut],qi],hsl:[Gt,[Ut,Ut,Ut],Xi],hsla:[Gt,[Ut,Ut,Ut,Ut],Xi],has:{type:Vt,overloads:[[[jt],(e,[t])=>Yi(t.evaluate(e),e.properties())],[[jt,Ht],(e,[t,n])=>Yi(t.evaluate(e),n.evaluate(e))]]},get:{type:Zt,overloads:[[[jt],(e,[t])=>Ki(t.evaluate(e),e.properties())],[[jt,Ht],(e,[t,n])=>Ki(t.evaluate(e),n.evaluate(e))]]},config:{type:Zt,overloads:[[[jt],(e,[t])=>Ji(e,t.evaluate(e),"")],[[jt,jt],(e,[t,n])=>Ji(e,t.evaluate(e),n.evaluate(e))]]},"feature-state":[Zt,[jt],(e,[t])=>Ki(t.evaluate(e),e.featureState||{})],properties:[Ht,[],e=>e.properties()],"geometry-type":[jt,[],e=>e.geometryType()],id:[Zt,[],e=>e.id()],zoom:[Ut,[],e=>e.globals.zoom],pitch:[Ut,[],e=>e.globals.pitch||0],"distance-from-center":[Ut,[],e=>e.distanceFromCenter()],"measure-light":[Ut,[jt],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[Ut,[],e=>e.globals.heatmapDensity||0],"line-progress":[Ut,[],e=>e.globals.lineProgress||0],"raster-value":[Ut,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[Ut,[],e=>e.globals.skyRadialProgress||0],accumulated:[Zt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Ut,Qi(Ut),(e,t)=>{let n=0;for(const r of t)n+=r.evaluate(e);return n}],"*":[Ut,Qi(Ut),(e,t)=>{let n=1;for(const r of t)n*=r.evaluate(e);return n}],"-":{type:Ut,overloads:[[[Ut,Ut],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[Ut],(e,[t])=>-t.evaluate(e)]]},"/":[Ut,[Ut,Ut],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[Ut,[Ut,Ut],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[Ut,[Ut],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Ut,[Ut],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Ut,[Ut],(e,[t])=>Math.log(t.evaluate(e))],log2:[Ut,[Ut],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Ut,[Ut],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Ut,[Ut],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Ut,[Ut],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Ut,[Ut],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Ut,[Ut],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Ut,[Ut],(e,[t])=>Math.atan(t.evaluate(e))],min:[Ut,Qi(Ut),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Ut,Qi(Ut),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Ut,[Ut],(e,[t])=>Math.abs(t.evaluate(e))],round:[Ut,[Ut],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ut,[Ut],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Ut,[Ut],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Vt,[jt,Zt],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[Vt,[Zt],(e,[t])=>e.id()===t.value],"filter-type-==":[Vt,[jt],(e,[t])=>e.geometryType()===t.value],"filter-<":[Vt,[jt,Zt],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[Vt,[Zt],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<r}],"filter->":[Vt,[jt,Zt],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[Vt,[Zt],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>r}],"filter-<=":[Vt,[jt,Zt],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[Vt,[Zt],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<=r}],"filter->=":[Vt,[jt,Zt],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[Vt,[Zt],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>=r}],"filter-has":[Vt,[Zt],(e,[t])=>t.value in e.properties()],"filter-has-id":[Vt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Vt,[Xt(jt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Vt,[Xt(Zt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Vt,[jt,Xt(Zt)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Vt,[jt,Xt(Zt)],(e,[t,n])=>function(e,t,n,r){for(;n<=r;){const i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Qi(Vt),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Qi(Vt),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[Vt,[Vt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Vt,[jt],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[jt,[jt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[jt,[jt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[jt,Qi(Zt),(e,t)=>t.map((t=>yn(t.evaluate(e)))).join("")],"resolved-locale":[jt,[Wt],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[Ut,[Ut,Ut,Zt],(e,t)=>{const[n,r,i]=t.map((t=>t.evaluate(e)));if(n>r)return n;if(n===r)return n;let o;if("string"==typeof i)o=function(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(i);else{if("number"!=typeof i)throw new xn(`Invalid seed input: ${i}`);o=i}return n+Wi(o)()*(r-n)}]});var eo=$i;function to(e){return{result:"success",value:e}}function no(e){return{result:"error",value:e}}function ro(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function io(e){return"data-driven"===e["property-type"]}function oo(e){return ro(e.expression,"measure-light")}function so(e){return ro(e.expression,"zoom")}function ao(e){return!!e.expression&&e.expression.interpolated}function lo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function co(e){return e}function uo(e,t){const n="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],i=r||!(r||void 0!==e.property),o=e.type||(ao(t)?"exponential":"interval");if(n&&((e=Lt({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],cn.parse(e[1])]))),e.default=cn.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!mi[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=mo;else if("interval"===o)s=fo;else if("categorical"===o){s=po,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=go}if(r){const n={},r=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),n[o].stops.push([i[0].value,i[1]])}const i=[];for(const e of r)i.push([n[e].zoom,uo(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:vi.interpolationFactor.bind(void 0,o),zoomStops:i.map((e=>e[0])),evaluate:({zoom:n},r)=>mo({stops:i,base:e.base},t,n).evaluate(n,r)}}if(i){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:vi.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>s(e,t,n,a,l)}}return{kind:"source",evaluate(n,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?ho(e.default,t.default):s(e,t,i,a,l)}}}function ho(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function po(e,t,n,r,i){return ho(typeof n===i?r[n]:void 0,e.default,t.default)}function fo(e,t,n){if("number"!==Tn(n))return ho(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const i=Wr(e.stops.map((e=>e[0])),n);return e.stops[i][1]}function mo(e,t,n){const r=void 0!==e.base?e.base:1;if("number"!==Tn(n))return ho(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const o=Wr(e.stops.map((e=>e[0])),n),s=function(e,t,n,r){const i=r-n,o=e-n;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=Kr[t.type]||co;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=mi[e.colorSpace];c=(e,n)=>t.reverse(t.interpolate(t.forward(e),t.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),n=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==n)return c(t,n,s)}}:c(a,l,s)}function go(e,t,n){return"color"===t.type?n=cn.parse(n):"formatted"===t.type?n=dn.fromString(n.toString()):"resolvedImage"===t.type?n=pn.fromString(n.toString()):Tn(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),ho(n,e.default,t.default)}class yo{constructor(e,t,n){this.expression=e,this._warningHistory={},this._evaluator=new Rn(n),this._defaultValue=t?function(e){return"color"===e.type&&(lo(e.default)||Array.isArray(e.default))?new cn(0,0,0,0):"color"===e.type?cn.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,r,i,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,r,i,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new xn(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function vo(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in eo}function _o(e,t,n){const r=new Hr(eo,[],t?function(e){const t={color:Gt,string:jt,number:Ut,enum:jt,boolean:Vt,formatted:$t,resolvedImage:qt};return"array"===e.type?Xt(t[e.value]||Zt,e.length):t[e.type]}(t):void 0,void 0,void 0,n),i=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?to(new yo(i,t,n)):no(r.errors)}class xo{constructor(e,t,n){this.kind=e,this._styleExpression=t,this.isLightConstant=n,this.isStateDependent="constant"!==e&&!zr(t.expression),this.isConfigDependent=!Br(t.expression)}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)}}class bo{constructor(e,t,n,r,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!zr(t.expression),this.isLightConstant=i,this.isConfigDependent=!Br(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,o)}evaluate(e,t,n,r,i,o){return this._styleExpression.evaluate(e,t,n,r,i,o)}interpolationFactor(e,t,n){return this.interpolationType?vi.interpolationFactor(this.interpolationType,e,t,n):0}}function wo(e,t,n){if("error"===(e=_o(e,t,n)).result)return e;const r=e.value.expression,i=Fr(r);if(!i&&!io(t))return no([new kt("","data expressions not supported")]);const o=Ur(r,["zoom","pitch","distance-from-center"]);if(!o&&!so(t))return no([new kt("","zoom expressions not supported")]);const s=Ur(r,["measure-light"]);if(!s&&!oo(t))return no([new kt("","measure-light expression not supported")]);const a=t.expression&&t.expression.relaxZoomRestriction,l=Mo(r);return l||o||a?l instanceof kt?no([l]):l instanceof vi&&!ao(t)?no([new kt("",'"interpolate" expressions cannot be used with this property')]):to(l?new bo(i?"camera":"composite",e.value,l.labels,l instanceof vi?l.interpolation:void 0,s):new xo(i?"constant":"source",e.value,s)):no([new kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class So{constructor(e,t){this._parameters=e,this._specification=t,Lt(this,uo(this._parameters,this._specification))}static deserialize(e){return new So(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Mo(e){let t=null;if(e instanceof wi)t=Mo(e.result);else if(e instanceof xi){for(const n of e.args)if(t=Mo(n),t)break}else(e instanceof qr||e instanceof vi)&&e.input instanceof Dn&&"zoom"===e.input.name&&(t=e);return t instanceof kt||e.eachChild((e=>{const n=Mo(e);n instanceof kt?t=n:t&&n&&t!==n&&(t=new kt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Eo(e){const t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Tn(n);if("object"!==l)return[new Pt(t,n,`object expected, ${l} found`)];for(const e in n){const l=e.split(".")[0];let c;i[l]?c=i[l]:r[l]?c=as:i["*"]?c=i["*"]:r["*"]&&(c=as),c?a=a.concat(c({key:(t?`${t}.`:t)+e,value:n[e],valueSpec:r[l]||r["*"],style:o,styleSpec:s,object:n,objectKey:e},n)):a.push(new Rt(t,n[e],`unknown property "${e}"`))}for(const e in r)i[e]||r[e].required&&void 0===r[e].default&&void 0===n[e]&&a.push(new Pt(t,n,`missing required property "${e}"`));return a}function To(e){const t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,o=e.key,s=e.arrayElementValidator||as;if("array"!==Tn(t))return[new Pt(o,t,`array expected, ${Tn(t)} found`)];if(n.length&&t.length!==n.length)return[new Pt(o,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Pt(o,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};i.$version<7&&(a.function=n.function),"object"===Tn(n.value)&&(a=n.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:r,styleSpec:i,key:`${o}[${e}]`},!0));return l}function Co(e){const t=e.key,n=e.value,r=e.valueSpec;let i=Tn(n);if("number"===i&&n!=n&&(i="NaN"),"number"!==i)return[new Pt(t,n,`number expected, ${i} found`)];if("minimum"in r){let i=r.minimum;if("array"===Tn(r.minimum)&&(i=r.minimum[e.arrayIndex]),n<i)return[new Pt(t,n,`${n} is less than the minimum value ${i}`)]}if("maximum"in r){let i=r.maximum;if("array"===Tn(r.maximum)&&(i=r.maximum[e.arrayIndex]),n>i)return[new Pt(t,n,`${n} is greater than the maximum value ${i}`)]}return[]}function Ao(e){const t=e.valueSpec,n=Dt(e.value.type);let r,i,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===Tn(e.value.stops)&&"array"===Tn(e.value.stops[0])&&"object"===Tn(e.value.stops[0][0]),u=Eo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new Pt(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(To({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Tn(r)&&0===r.length&&t.push(new Pt(e.key,r,"array must have at least one stop")),t},default:function(e){return as({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new Pt(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new Pt(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!ao(e.valueSpec)&&u.push(new Pt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!io(e.valueSpec)?u.push(new Pt(e.key,e.value,"property functions not supported")):a&&!so(e.valueSpec)&&u.push(new Pt(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new Pt(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const r=e.value,a=e.key;if("array"!==Tn(r))return[new Pt(a,r,`array expected, ${Tn(r)} found`)];if(2!==r.length)return[new Pt(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Tn(r[0]))return[new Pt(a,r,`object expected, ${Tn(r[0])} found`)];if(void 0===r[0].zoom)return[new Pt(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Pt(a,r,"object stop key must have value")];const t=Dt(r[0].zoom);if("number"!=typeof t)return[new Pt(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Pt(a,r[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,i=void 0,s={}),n=n.concat(Eo({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Co,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return vo(Ot(r[1]))?n.concat([new Pt(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):n.concat(as({key:`${a}[1]`,value:r[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Tn(e.value),l=Dt(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new Pt(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Pt(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let r=`number expected, ${a} found`;return io(t)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(e.key,c,r)]}return"categorical"!==n||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&"number"==typeof l&&"number"==typeof i&&void 0!==i&&l<i?[new Pt(e.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===n&&l in s?[new Pt(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Pt(e.key,c,`integer expected, found ${String(l)}`)]}}function Io(e){const t=("property"===e.expressionContext?wo:_o)(Ot(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Pt(`${e.key}${t.key}`,e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Pt(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!zr(n))return[new Pt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Po(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Ur(n,["zoom","feature-state"]))return[new Pt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Fr(n))return[new Pt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Po(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];const r=[];return e instanceof Dn&&n.has(e.name)?[new Pt(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{r.push(...Po(e,t))})),r)}function Ro(e){const t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Dt(n))&&i.push(new Pt(t,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(Dt(n))&&i.push(new Pt(t,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),i}function Lo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Lo(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Do(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lo(e)||(e=Uo(e));const n=e;let r=!0;try{r=function(e){if(!ko(e))return e;let t=Ot(e);return No(t),t=Oo(t),t}(n)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const i=It[`filter_${t}`],o=_o(r,i);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,n)=>o.value.evaluate(e,t,{},n);let a=null,l=null;if(r!==n){const e=_o(n,i);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,n,r,i,o)=>e.value.evaluate(t,n,{},r,void 0,void 0,i,o),l=!Fr(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Bo(r),needFeature:!!l}}function Oo(e){if(!Array.isArray(e))return e;const t=function(e){if(Fo.has(e[0]))for(let t=1;t<e.length;t++)if(ko(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Oo(e)))}function No(e){let t=!1;const n=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||ko(e[r]),n.push(e[r+1]);n.push(e[e.length-1])}else if("match"===e[0]){t=t||ko(e[1]);for(let t=2;t<e.length-1;t+=2)n.push(e[t+1]);n.push(e[e.length-1])}else if("step"===e[0]){t=t||ko(e[1]);for(let t=1;t<e.length-1;t+=2)n.push(e[t+1])}t&&(e.length=0,e.push("any",...n));for(let t=1;t<e.length;t++)No(e[t])}function ko(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(ko(e[t]))return!0;return!1}const Fo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zo(e,t){return e<t?-1:e>t?1:0}function Bo(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Bo(e[t]))return!0;return!1}function Uo(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?jo(e[1],e[2],"=="):"!="===t?Ho(jo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?jo(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Uo))):"all"===t?["all"].concat(e.slice(1).map(Uo)):"none"===t?["all"].concat(e.slice(1).map(Uo).map(Ho)):"in"===t?Vo(e[1],e.slice(2)):"!in"===t?Ho(Vo(e[1],e.slice(2))):"has"===t?Go(e[1]):"!has"!==t||Ho(Go(e[1]));var n}function jo(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function Vo(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(zo)]]:["filter-in-small",e,["literal",t]]}}function Go(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ho(e){return["!",e]}function Zo(e){return Lo(Ot(e.value))?Io(Lt({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):Wo(e)}function Wo(e){const t=e.value,n=e.key;if("array"!==Tn(t))return[new Pt(n,t,`array expected, ${Tn(t)} found`)];const r=e.styleSpec;let i,o=[];if(t.length<1)return[new Pt(n,t,"filter array must have at least 1 element")];switch(o=o.concat(Ro({key:`${n}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Dt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Dt(t[1])&&o.push(new Pt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Pt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Tn(t[1]),"string"!==i&&o.push(new Pt(`${n}[1]`,t[1],`string expected, ${i} found`)));for(let s=2;s<t.length;s++)i=Tn(t[s]),"$type"===Dt(t[1])?o=o.concat(Ro({key:`${n}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new Pt(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(Wo({key:`${n}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Tn(t[1]),2!==t.length?o.push(new Pt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&o.push(new Pt(`${n}[1]`,t[1],`string expected, ${i} found`))}return o}function $o(e,t){const n=e.key,r=e.style,i=e.layer,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return as({key:n,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Rt(n,s,`unknown property "${a}"`)];let h;if("string"===Tn(s)&&io(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s))){const e=`\`{ "type": "identity", "property": ${h?JSON.stringify(h[1]):'"_"'} }\``;return[new Pt(n,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const d=[];if("symbol"===e.layerType)"text-field"!==a||!r||r.glyphs||r.imports||d.push(new Pt(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&lo(Ot(s))&&"identity"===Dt(s.type)&&d.push(new Pt(n,s,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===t&&i&&i.layout&&i.layout.hasOwnProperty("model-id")&&io(u)&&(oo(u)||so(u))){const e=wo(Ot(s),u),t=e.value.expression||e.value._styleExpression.expression;t&&!Ur(t,["measure-light"])&&d.push(new Pt(n,s,`${a} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`))}return d.concat(as({key:e.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function qo(e){return $o(e,"paint")}function Xo(e){return $o(e,"layout")}function Yo(e){let t=[];const n=e.value,r=e.key,i=e.style,o=e.styleSpec;n.type||n.ref||t.push(new Pt(r,n,'either "type" or "ref" is required'));let s=Dt(n.type);const a=Dt(n.ref);if(n.id){const o=Dt(n.id);for(let s=0;s<e.arrayIndex;s++){const e=i.layers[s];Dt(e.id)===o&&t.push(new Pt(r,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new Pt(r,n[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{Dt(t.id)===a&&(e=t)})),e?e.ref?t.push(new Pt(r,n.ref,"ref cannot reference another ref layer")):s=Dt(e.type):"string"==typeof a&&t.push(new Pt(r,n.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(n.source){const e=i.sources&&i.sources[n.source],o=e&&Dt(e.type);e?"vector"===o&&"raster"===s?t.push(new Pt(r,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new Pt(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Pt(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new Pt(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Pt(r,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Pt(r,n.source,`source "${n.source}" not found`))}else t.push(new Pt(r,n,'missing required property "source"'));return t=t.concat(Eo({key:r,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>as({key:`${r}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>Zo(Lt({layerType:s},e)),layout:e=>Eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Xo(Lt({layerType:s},e))}}),paint:e=>Eo({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>qo(Lt({layerType:s,layer:n},e))}})}})),t}function Ko(e){const t=e.value,n=e.key,r=Tn(t);return"string"!==r?[new Pt(n,t,`string expected, ${r} found`)]:[]}const Jo={promoteId:function({key:e,value:t}){if("string"===Tn(t))return Ko({key:e,value:t});{const n=[];for(const r in t)n.push(...Ko({key:`${e}.${r}`,value:t[r]}));return n}}};function Qo(e){const t=e.value,n=e.key,r=e.styleSpec,i=e.style;if(!t.type)return[new Pt(n,t,'"type" is required')];const o=Dt(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Eo({key:n,value:t,valueSpec:r[`source_${o.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Jo}),s;case"geojson":if(s=Eo({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:Jo}),t.cluster)for(const e in t.clusterProperties){const[r,i]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;s.push(...Io({key:`${n}.${e}.map`,value:i,expressionContext:"cluster-map"})),s.push(...Io({key:`${n}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Eo({key:n,value:t,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Eo({key:n,value:t,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Pt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ro({key:`${n}.type`,value:t.type,valueSpec:{values:es(r)},style:i,styleSpec:r})}}function es(e){return e.source.reduce(((t,n)=>{const r=e[n];return"enum"===r.type.type&&(t=t.concat(Object.keys(r.type.values))),t}),[])}function ts(e){const t=e.value;let n=[];if(!t)return n;const r=Tn(t);return"string"!==r?(n=n.concat([new Pt(e.key,t,`string expected, "${r}" found`)]),n):(function(e){const t=-1===e.indexOf("://");try{return new URL(e,t?"http://example.com":void 0),!0}catch(e){return!1}}(t)||(n=n.concat([new Pt(e.key,t,`invalid url "${t}"`)])),n)}function ns(e){const t=e.value,n=e.styleSpec,r=n.light,i=e.style;let o=[];const s=Tn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Pt("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?as({key:e,value:t[e],valueSpec:n.transition,style:i,styleSpec:n}):r[e]?as({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n}):[new Pt(e,t[e],`unknown property "${e}"`)])}return o}function rs(e){const t=e.value;let n=[];if(!t)return n;const r=Tn(t);if("object"!==r)return n=n.concat([new Pt("light-3d",t,`object expected, ${r} found`)]),n;const i=e.styleSpec,o=i["light-3d"],s=e.key,a=e.style,l=e.style.lights;for(const e of["type","id"])if(!(e in t))return n=n.concat([new Pt("light-3d",t,`missing property ${e} on light`)]),n;if(t.type&&l)for(let r=0;r<e.arrayIndex;r++){const e=Dt(t.type),i=l[r];Dt(i.type)===e&&n.push(new Pt(s,t.id,`duplicate light type "${t.type}", previously defined at line ${i.id.__line__}`))}const c=`properties_light_${t.type}`;if(!(c in i))return n=n.concat([new Pt("light-3d",t,`Invalid light type ${t.type}`)]),n;const u=i[c];for(const r in t)if("properties"===r){const o=t[r],s=Tn(o);if("object"!==s)return n=n.concat([new Pt("properties",o,`object expected, ${s} found`)]),n;for(const t in o)n=n.concat(u[t]?as({key:t,value:o[t],valueSpec:u[t],style:a,styleSpec:i}):[new Rt(e.key,o[t],`unknown property "${t}"`)])}else{const e=r.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?as({key:r,value:t[r],valueSpec:i.transition,style:a,styleSpec:i}):o[r]?as({key:r,value:t[r],valueSpec:o[r],style:a,styleSpec:i}):[new Rt(r,t[r],`unknown property "${r}"`)])}return n}function is(e){const t=e.value,n=e.key,r=e.style,i=e.styleSpec,o=i.terrain;let s=[];const a=Tn(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Pt("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const n=e.match(/^(.*)-transition$/);s=s.concat(n&&o[n[1]]&&o[n[1]].transition?as({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):o[e]?as({key:e,value:t[e],valueSpec:o[e],style:r,styleSpec:i}):[new Rt(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=r.sources&&r.sources[t.source],i=e&&Dt(e.type);e?"raster-dem"!==i&&s.push(new Pt(n,t.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):s.push(new Pt(n,t.source,`source "${t.source}" not found`))}else s.push(new Pt(n,t,'terrain is missing required property "source"'));return s}function os(e){const t=e.value,n=e.style,r=e.styleSpec,i=r.fog;let o=[];const s=Tn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Pt("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&i[s[1]]&&i[s[1]].transition?as({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r}):i[e]?as({key:e,value:t[e],valueSpec:i[e],style:n,styleSpec:r}):[new Rt(e,t[e],`unknown property "${e}"`)])}return o}const ss={"*":()=>[],array:To,boolean:function(e){const t=e.value,n=e.key,r=Tn(t);return"boolean"!==r?[new Pt(n,t,`boolean expected, ${r} found`)]:[]},number:Co,color:function(e){const t=e.key,n=e.value,r=Tn(n);return"string"!==r?[new Pt(t,n,`color expected, ${r} found`)]:null===tn(n)?[new Pt(t,n,`color expected, "${n}" found`)]:[]},enum:Ro,filter:Zo,function:Ao,layer:Yo,object:Eo,source:Qo,model:ts,light:ns,"light-3d":rs,terrain:is,fog:os,string:Ko,formatted:function(e){return 0===Ko(e).length?[]:Io(e)},resolvedImage:function(e){return 0===Ko(e).length?[]:Io(e)},projection:function(e){const t=e.value,n=e.styleSpec,r=n.projection,i=e.style;let o=[];const s=Tn(t);if("object"===s)for(const e in t)o=o.concat(as({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n}));else"string"!==s&&(o=o.concat([new Pt("projection",t,`object or string expected, ${s} found`)]));return o},import:function(e){const{value:t,styleSpec:n}=e,{data:r,...i}=t;Object.defineProperty(i,"__line__",{value:t.__line__,enumerable:!1});let o=Eo(Lt({},e,{value:i,valueSpec:n.import}));return""===Dt(i.id)&&o.push(new Pt(`${e.key}.id`,i,"import id can't be an empty string")),r&&(o=o.concat(cs(r,n,{key:`${e.key}.data`}))),o}};function as(e,t=!1){const n=e.value,r=e.valueSpec,i=e.styleSpec;if(r.expression&&lo(Dt(n)))return Ao(e);if(r.expression&&vo(Ot(n)))return Io(e);if(r.type&&ss[r.type]){const n=ss[r.type](e);return!0===t&&n.length>0&&"array"===Tn(e.value)?Io(e):n}return Eo(Lt({},e,{valueSpec:r.type?i[r.type]:r}))}function ls(e){const t=e.value,n=e.key,r=Ko(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Pt(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Pt(n,t,'"glyphs" url must include a "{range}" token'))),r}function cs(e,t=It,n={}){return as({key:n.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:ls,"*":()=>[]}})}function us(e,t=It){return bs(cs(e,t))}const hs=e=>bs(Qo(e)),ds=e=>bs(ns(e)),ps=e=>bs(rs(e)),fs=e=>bs(is(e)),ms=e=>bs(os(e)),gs=e=>bs(Yo(e)),ys=e=>bs(Zo(e)),vs=e=>bs(qo(e)),_s=e=>bs(Xo(e)),xs=e=>bs(ts(e));function bs(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function ws(e,t){let n=!1;if(t&&t.length)for(const r of t)r instanceof Rt?q(r.message):(e.fire(new Ct(new Error(r.message))),n=!0);return n}var Ss=Es,Ms=3;function Es(e,t,n){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var s=i[Ms+o],a=i[Ms+o+1];r.push(s===a?null:i.subarray(s,a))}var l=i[Ms+r.length+1];this.keys=i.subarray(i[Ms+r.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var u=n/t*e;this.min=-u,this.max=e+u}Es.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Es.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Es.prototype._insertCell=function(e,t,n,r,i,o){this.cells[i].push(o)},Es.prototype.query=function(e,t,n,r,i){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=r&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,r,this._queryCell,a,{},i),a},Es.prototype._queryCell=function(e,t,n,r,i,o,s,a){var l=this.cells[i];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&n>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},Es.prototype._forEachCell=function(e,t,n,r,i,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&i.call(this,e,t,n,r,f,o,s,a))return}},Es.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Es.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Es.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ms+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];i[Ms+s]=o,i.set(a,o),o+=a.length}return i[Ms+e.length]=o,i.set(this.keys,o),i[Ms+e.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Ts=d(Ss);const Cs={};function As(e,t,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Cs[t]={klass:e,omit:n.omit||[]}}As(Object,"Object"),Ts.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Ts.deserialize=function(e){return new Ts(e.buffer)},Object.defineProperty(Ts,"name",{value:"Grid"}),As(Ts,"Grid"),As(cn,"Color"),As(Error,"Error"),As(_e,"AJAXError"),As(pn,"ResolvedImage"),As(So,"StylePropertyFunction"),As(yo,"StyleExpression",{omit:["_evaluator"]}),As(bo,"ZoomDependentExpression"),As(xo,"ZoomConstantExpression"),As(Dn,"CompoundExpression",{omit:["_evaluate"]});for(const e in eo)Cs[eo[e]._classRegistryKey]||As(eo[e],`Expression${e}`);function Is(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ps(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Rs(e,n){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Is(e)||Ps(e))return n&&n.add(e),e;if(ArrayBuffer.isView(e)){const t=e;return n&&n.add(t.buffer),t}if(e instanceof t.ImageData)return n&&n.add(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const r of e)t.push(Rs(r,n));return t}if(e instanceof Map){const t={$name:"Map"};for(const[n,r]of e.entries())t[n]=Rs(r);return t}if("object"==typeof e){const t=e.constructor,r=t._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const i=t.serialize?t.serialize(e,n):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(Cs[r].omit.indexOf(t)>=0||(i[t]=Rs(e[t],n)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(i.$name=r),i}throw new Error("can't serialize object of type "+typeof e)}function Ls(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Is(e)||Ps(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Ls);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const n of Object.keys(e))"$name"!==n&&t.set(n,Ls(e[n]));return t}const{klass:n}=Cs[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const r=Object.create(n.prototype);for(const t of Object.keys(e))"$name"!==t&&(r[t]=Ls(e[t]));return r}throw new Error("can't deserialize object of type "+typeof e)}const Ds={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function Os(e){for(const t of e)if(Fs(t.charCodeAt(0)))return!0;return!1}function Ns(e){for(const t of e)if(!ks(t.charCodeAt(0)))return!1;return!0}function ks(e){return!(Ds.Arabic(e)||Ds["Arabic Supplement"](e)||Ds["Arabic Extended-A"](e)||Ds["Arabic Presentation Forms-A"](e)||Ds["Arabic Presentation Forms-B"](e))}function Fs(e){return!(746!==e&&747!==e&&(e<4352||!(Ds["Bopomofo Extended"](e)||Ds.Bopomofo(e)||Ds["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Ds["CJK Compatibility Ideographs"](e)||Ds["CJK Compatibility"](e)||Ds["CJK Radicals Supplement"](e)||Ds["CJK Strokes"](e)||!(!Ds["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Ds["CJK Unified Ideographs Extension A"](e)||Ds["CJK Unified Ideographs"](e)||Ds["Enclosed CJK Letters and Months"](e)||Ds["Hangul Compatibility Jamo"](e)||Ds["Hangul Jamo Extended-A"](e)||Ds["Hangul Jamo Extended-B"](e)||Ds["Hangul Jamo"](e)||Ds["Hangul Syllables"](e)||Ds.Hiragana(e)||Ds["Ideographic Description Characters"](e)||Ds.Kanbun(e)||Ds["Kangxi Radicals"](e)||Ds["Katakana Phonetic Extensions"](e)||Ds.Katakana(e)&&12540!==e||!(!Ds["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Ds["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Ds["Unified Canadian Aboriginal Syllabics"](e)||Ds["Unified Canadian Aboriginal Syllabics Extended"](e)||Ds["Vertical Forms"](e)||Ds["Yijing Hexagram Symbols"](e)||Ds["Yi Syllables"](e)||Ds["Yi Radicals"](e))))}function zs(e){return!(Fs(e)||function(e){return!!(Ds["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Ds["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Ds["Letterlike Symbols"](e)||Ds["Number Forms"](e)||Ds["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ds["Control Pictures"](e)&&9251!==e||Ds["Optical Character Recognition"](e)||Ds["Enclosed Alphanumerics"](e)||Ds["Geometric Shapes"](e)||Ds["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ds["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ds["CJK Symbols and Punctuation"](e)||Ds.Katakana(e)||Ds["Private Use Area"](e)||Ds["CJK Compatibility Forms"](e)||Ds["Small Form Variants"](e)||Ds["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Bs(e){return e>=1424&&e<=2303||Ds["Arabic Presentation Forms-A"](e)||Ds["Arabic Presentation Forms-B"](e)}function Us(e,t){return!(!t&&Bs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Ds.Khmer(e))}function js(e){for(const t of e)if(Bs(t.charCodeAt(0)))return!0;return!1}const Vs="deferred",Gs="loading",Hs="loaded";let Zs=null,Ws="unavailable",$s=null;const qs=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Ws="error"),Zs&&Zs(e)};function Xs(){Ys.fire(new Tt("pluginStateChange",{pluginStatus:Ws,pluginURL:$s}))}const Ys=new At,Ks=function(){return Ws},Js=function(){if(Ws!==Vs||!$s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ws=Gs,Xs(),$s&&Se({url:$s},(e=>{e?qs(e):(Ws=Hs,Xs())}))},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ws===Hs||null!=Qs.applyArabicShaping,isLoading:()=>Ws===Gs,setState(e){Ws=e.pluginStatus,$s=e.pluginURL},isParsed:()=>null!=Qs.applyArabicShaping&&null!=Qs.processBidirectionalText&&null!=Qs.processStyledBidirectionalText,getPluginURL:()=>$s};class ea{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const n of e)if(!Us(n.charCodeAt(0),t))return!1;return!0}(e,Qs.isLoaded())}}class ta{constructor(e,t,n){this.property=e,this.value=t,this.expression=function(e,t,n){if(lo(e))return new So(e,t);if(vo(e)||Array.isArray(e)&&e.length>0){const r=wo(e,t,n);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let n=e;return"string"==typeof e&&"color"===t.type&&(n=cn.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class na{constructor(e,t){this.property=e,this.value=new ta(e,void 0,t)}transitioned(e,t){return new ia(this.property,this.value,t,N({},e.transition,this.transition),e.now)}untransitioned(){return new ia(this.property,this.value,null,{},0)}}class ra{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return W(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new na(this._values[e].property,this._options)),this._values[e].value=new ta(this._values[e].property,null===t?void 0:W(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const n=this._properties.properties;if(e)for(const t in e){const r=e[t];if(G(t,"-transition")){const e=t.slice(0,-11);n[e]&&this.setTransition(e,r)}else n[t]&&this.setValue(t,r)}}getTransition(e){return W(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new na(this._values[e].property)),this._values[e].transition=W(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const n=new oa(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(e,t._values[r]);return n}untransitioned(){const e=new oa(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ia{constructor(e,t,n,r,i){const o=r.delay||0,s=r.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+o,this.end=this.begin+s,e.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),i,E(s))}}return i}}class oa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const r=new la(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sa{constructor(e,t){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=t,this.isConfigDependent=!1}getValue(e){return W(this._values[e].value)}setValue(e,t){this._values[e]=new ta(this._values[e].property,null===t?void 0:W(t),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const r=new la(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(e,t,n);return r}}class aa{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}class la{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ca{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const r=Kr[this.specification.type];return r?r(e,t,n):e}}class ua{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,r){return new aa(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new aa(this,{kind:"constant",value:void 0},e.parameters);const r=Kr[this.specification.type];return r?new aa(this,{kind:"constant",value:r(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,r,i,o){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,o)}}class ha{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}interpolate(){return!1}}class da{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new ea(0,{});for(const n in e){const r=e[n];r.specification.overridable&&this.overridableProperties.push(n);const i=this.defaultPropertyValues[n]=new ta(r,void 0),o=this.defaultTransitionablePropertyValues[n]=new na(r);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=i.possiblyEvaluate(t)}}}function pa(e,t){return t?`${e}${t}`:e}function fa(e){const t=e.indexOf("");return t>=0?e.slice(0,t):e}As(ua,"DataDrivenProperty"),As(ca,"DataConstantProperty"),As(ha,"ColorRampProperty");const ma="-transition";class ga extends At{constructor(e,t,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=n,e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new sa(t.layout,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new ra(t.paint,n);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(t.paint)}}setScope(e){this.scope=e,this.fqid=pa(this.id,e)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){if(null!=t&&this._validate(_s,`layers.${this.id}.layout.${e}`,e,t,n))return;if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return G(e,ma)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(vs,`layers.${this.id}.paint.${e}`,e,t,n))return!1;const r=this._transitionablePaint,i=r._properties.properties;if(G(e,ma)){const n=e.slice(0,-11);return i[n]&&r.setTransition(n,t||void 0),!1}if(!i[e])return!1;const o=r._values[e],s=o.value.isDataDriven(),a=o.value;r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const l=r._values[e].value,c=l.isDataDriven(),u=G(e,"pattern")||"line-dasharray"===e;return c||s||u||this._handleOverridablePaintPropertyUpdate(e,a,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return Z({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,r,i={}){return(!i||!1!==i.validate)&&ws(this,e.call(us,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:It,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof aa&&io(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Do(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}class ya{constructor(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps=new Set,this.changedImages=new Set}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id)}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this.updatedPaintProps.delete(e.fqid)}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}reset(){this.changed=!1,this._updatedLayers={},this._removedLayers={},this.updatedSourceCaches={},this.updatedPaintProps.clear(),this.changedImages.clear()}}const va={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _a{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xa{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ba(e,t=1){let n=0,r=0;return{members:e.map((e=>{const i=va[e.type].BYTES_PER_ELEMENT,o=n=wa(n,Math.max(t,i)),s=e.components||1;return r=Math.max(r,i),n+=i*s,{name:e.name,type:e.type,components:s,offset:o}})),size:wa(n,Math.max(r,t)),alignment:t}}function wa(e,t){return Math.ceil(e/t)*t}class Sa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}Sa.prototype.bytesPerElement=4,As(Sa,"StructArrayLayout2i4");class Ma extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}Ma.prototype.bytesPerElement=6,As(Ma,"StructArrayLayout3i6");class Ea extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,e}}Ea.prototype.bytesPerElement=8,As(Ea,"StructArrayLayout4i8");class Ta extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=5*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,e}}Ta.prototype.bytesPerElement=10,As(Ta,"StructArrayLayout5i10");class Ca extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[c+4]=r,this.uint8[c+5]=i,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}Ca.prototype.bytesPerElement=12,As(Ca,"StructArrayLayout2i4ub1f12");class Aa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,e}}Aa.prototype.bytesPerElement=16,As(Aa,"StructArrayLayout4f16");class Ia extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=6*e,a=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=r,this.uint16[s+3]=i,this.float32[a+2]=o,e}}Ia.prototype.bytesPerElement=12,As(Ia,"StructArrayLayout4ui1f12");class Pa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=r,this.uint16[o+3]=i,e}}Pa.prototype.bytesPerElement=8,As(Pa,"StructArrayLayout4ui8");class Ra extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,this.int16[a+4]=o,this.int16[a+5]=s,e}}Ra.prototype.bytesPerElement=12,As(Ra,"StructArrayLayout6i12");class La extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,r,i,o,s,a,l,c,u,h)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}La.prototype.bytesPerElement=24,As(La,"StructArrayLayout4i4ui4i24");class Da extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,o)}emplace(e,t,n,r,i,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=s,e}}Da.prototype.bytesPerElement=20,As(Da,"StructArrayLayout3i3f20");class Oa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Oa.prototype.bytesPerElement=4,As(Oa,"StructArrayLayout1ul4");class Na extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}Na.prototype.bytesPerElement=4,As(Na,"StructArrayLayout2ui4");class ka extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,n,r,i,o,s,a,l,c,u,h,d)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}ka.prototype.bytesPerElement=40,As(ka,"StructArrayLayout5i4f1i1ul2ui40");class Fa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=r,this.int16[l+4]=i,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}Fa.prototype.bytesPerElement=16,As(Fa,"StructArrayLayout3i2i2i16");class za extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=r,this.int16[a+6]=i,this.int16[a+7]=o,e}}za.prototype.bytesPerElement=16,As(za,"StructArrayLayout2f1f2i16");class Ba extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=n,this.float32[s+1]=r,this.float32[s+2]=i,e}}Ba.prototype.bytesPerElement=12,As(Ba,"StructArrayLayout2ub2f12");class Ua extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}Ua.prototype.bytesPerElement=12,As(Ua,"StructArrayLayout3f12");class ja extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}emplace(e,t,n,r){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}ja.prototype.bytesPerElement=6,As(ja,"StructArrayLayout3ui6");class Va extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b){const w=30*e,S=15*e,M=60*e;return this.int16[w+0]=t,this.int16[w+1]=n,this.int16[w+2]=r,this.float32[S+2]=i,this.float32[S+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[M+48]=g,this.uint8[M+49]=y,this.uint8[M+50]=v,this.uint32[S+13]=_,this.int16[w+28]=x,this.uint8[M+58]=b,e}}Va.prototype.bytesPerElement=60,As(Va,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ga extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,E,T,C,A,I,P,R){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,E,T,C,A,I,P,R)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,E,T,C,A,I,P,R,L){const D=20*e,O=40*e,N=80*e;return this.float32[D+0]=t,this.float32[D+1]=n,this.int16[O+4]=r,this.int16[O+5]=i,this.int16[O+6]=o,this.int16[O+7]=s,this.int16[O+8]=a,this.int16[O+9]=l,this.int16[O+10]=c,this.int16[O+11]=u,this.int16[O+12]=h,this.uint16[O+13]=d,this.uint16[O+14]=p,this.uint16[O+15]=f,this.uint16[O+16]=m,this.uint16[O+17]=g,this.uint16[O+18]=y,this.uint16[O+19]=v,this.uint16[O+20]=_,this.uint16[O+21]=x,this.uint16[O+22]=b,this.uint16[O+23]=w,this.uint16[O+24]=S,this.uint16[O+25]=M,this.uint16[O+26]=E,this.uint16[O+27]=T,this.uint32[D+14]=C,this.float32[D+15]=A,this.float32[D+16]=I,this.float32[D+17]=P,this.float32[D+18]=R,this.uint8[N+76]=L,e}}Ga.prototype.bytesPerElement=80,As(Ga,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ha extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Ha.prototype.bytesPerElement=4,As(Ha,"StructArrayLayout1f4");class Za extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i)}emplace(e,t,n,r,i,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=r,this.float32[s+3]=i,this.float32[s+4]=o,e}}Za.prototype.bytesPerElement=20,As(Za,"StructArrayLayout5f20");class Wa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=n,this.float32[l+2]=r,this.float32[l+3]=i,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}Wa.prototype.bytesPerElement=28,As(Wa,"StructArrayLayout7f28");class $a extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}emplace(e,t,n,r,i){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=n,this.uint16[o+3]=r,this.uint16[o+4]=i,e}}$a.prototype.bytesPerElement=12,As($a,"StructArrayLayout1ul3ui12");class qa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}qa.prototype.bytesPerElement=2,As(qa,"StructArrayLayout1ui2");class Xa extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}Xa.prototype.bytesPerElement=8,As(Xa,"StructArrayLayout2f8");class Ya extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m)}emplace(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g){const y=16*e;return this.float32[y+0]=t,this.float32[y+1]=n,this.float32[y+2]=r,this.float32[y+3]=i,this.float32[y+4]=o,this.float32[y+5]=s,this.float32[y+6]=a,this.float32[y+7]=l,this.float32[y+8]=c,this.float32[y+9]=u,this.float32[y+10]=h,this.float32[y+11]=d,this.float32[y+12]=p,this.float32[y+13]=f,this.float32[y+14]=m,this.float32[y+15]=g,e}}Ya.prototype.bytesPerElement=64,As(Ya,"StructArrayLayout16f64");class Ka extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i,o,s)}emplace(e,t,n,r,i,o,s,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=n,this.uint16[l+2]=r,this.uint16[l+3]=i,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,e}}Ka.prototype.bytesPerElement=20,As(Ka,"StructArrayLayout4ui3f20");class Ja extends xa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Ja.prototype.bytesPerElement=1,As(Ja,"StructArrayLayout1ub1");class Qa extends _a{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qa.prototype.size=40;class el extends ka{get(e){return new Qa(this,e)}}As(el,"CollisionBoxArray");class tl extends _a{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}tl.prototype.size=60;class nl extends Va{get(e){return new tl(this,e)}}As(nl,"PlacedSymbolArray");class rl extends _a{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}rl.prototype.size=80;class il extends Ga{get(e){return new rl(this,e)}}As(il,"SymbolInstanceArray");class ol extends Ha{getoffsetX(e){return this.float32[1*e+0]}}As(ol,"GlyphOffsetArray");class sl extends Sa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}As(sl,"SymbolLineVertexArray");class al extends _a{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}al.prototype.size=12;class ll extends $a{get(e){return new al(this,e)}}As(ll,"FeatureIndexArray");class cl extends Na{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}As(cl,"FillExtrusionCentroidArray");const ul=ba([{name:"a_pos",components:2,type:"Int16"}],4),hl=ba([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dl{constructor(e=[]){this.segments=e}_prepareSegment(e,t,n,r){let i=this.segments[this.segments.length-1];return e>dl.MAX_VERTEX_ARRAY_LENGTH&&q(`Max vertices per segment is ${dl.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!i||i.vertexLength+e>dl.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:t,primitiveOffset:n,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i}prepareSegment(e,t,n,r){return this._prepareSegment(e,t.length,n.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,r){return new dl([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function pl(e,t){return 256*(e=P(Math.floor(e),0,255))+P(Math.floor(t),0,255)}dl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,As(dl,"SegmentVector");const fl=ba([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ml=ba([{name:"a_dash",components:4,type:"Uint16"}]);var gl={exports:{}},yl={exports:{}};!function(e){e.exports=function(e,t){var n,r,i,o,s,a,l,c;for(r=e.length-(n=3&e.length),i=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}(yl);var vl=yl.exports,_l={exports:{}};!function(e){e.exports=function(e,t){for(var n,r=e.length,i=t^r,o=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}(_l);var xl=vl,bl=_l.exports;gl.exports=xl,gl.exports.murmur3=xl,gl.exports.murmur2=bl;var wl=d(gl.exports);class Sl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,n,r){this.ids.push(Ml(e)),this.positions.push(t,n,r)}eachPosition(e,t){const n=Ml(e);let r=0,i=this.ids.length-1;for(;r<i;){const e=r+i>>1;this.ids[e]>=n?i=e:r=e+1}for(;this.ids[r]===n;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){const n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return El(n,r,0,n.length-1),t&&(t.add(n.buffer),t.add(r.buffer)),{ids:n,positions:r}}static deserialize(e){const t=new Sl;let n;t.ids=e.ids,t.positions=e.positions;for(const e of t.ids)e!==n&&t.uniqueIds.push(e),n=e;return t.indexed=!0,t}}function Ml(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:wl(String(e))}function El(e,t,n,r){for(;n<r;){const i=e[n+r>>1];let o=n-1,s=r+1;for(;;){do{o++}while(e[o]<i);do{s--}while(e[s]>i);if(o>=s)break;Tl(e,o,s),Tl(t,3*o,3*s),Tl(t,3*o+1,3*s+1),Tl(t,3*o+2,3*s+2)}s-n<r-s?(El(e,t,n,s),n=s+1):(El(e,t,s+1,r),r=s)}}function Tl(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}As(Sl,"FeaturePositionMap");class Cl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Al extends Cl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Il extends Cl{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Pl extends Cl{constructor(e){super(e),this.current=[0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class Rl extends Cl{constructor(e){super(e),this.current=[0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class Ll extends Cl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Dl extends Cl{constructor(e){super(e),this.current=cn.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const Ol=new Float32Array(16);class Nl extends Cl{constructor(e){super(e),this.current=Ol}set(e,t,n){if(this.fetchUniformLocation(e,t)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const kl=new Float32Array(9);class Fl extends Cl{constructor(e){super(e),this.current=kl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}const zl=new Float32Array(4);class Bl extends Cl{constructor(e){super(e),this.current=zl}set(e,t,n){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}function Ul(e){return[pl(255*e.r,255*e.g),pl(255*e.b,255*e.a)]}class jl{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n,r,i){t.set(e,i,r.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Dl(e):new Il(e)}}class Vl{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,r,i){const o="u_pattern"===i||"u_dash"===i?this.pattern:"u_pixel_ratio"===i?this.pixelRatio:null;o&&t.set(e,i,o)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Ll(e):new Il(e)}}class Gl{constructor(e,t,n,r){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,n,r,i,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new ea(0,{brightness:o}),t,{},i,r,s);this.paintVertexArray.resize(e),this._setPaintValue(a,e,l)}updatePaintArray(e,t,n,r,i,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},n,r,void 0,i);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if("color"===this.type){const r=Ul(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hl{constructor(e,t,n,r,i,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,r,i,o,s){const a=this.expression.evaluate(new ea(this.zoom,{brightness:o}),t,{},i,r,s),l=this.expression.evaluate(new ea(this.zoom+1,{brightness:o}),t,{},i,r,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,a,l)}updatePaintArray(e,t,n,r,i,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},n,r,void 0,i),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},n,r,void 0,i);this._setPaintValue(e,t,a,l)}_setPaintValue(e,t,n,r){if("color"===this.type){const i=Ul(n),o=Ul(r);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1],o[0],o[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,r,i){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,s=P(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(e,i,s)}getBinding(e,t){return new Il(e)}}class Zl{constructor(e,t,n,r,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===n?ml:fl).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new r}populatePaintArray(e,t,n){const r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,r,i,o,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(e,t,n,r){if(!r||!n)return;const i=r[n];if(!i)return;const{tl:o,br:s,pixelRatio:a}=i;for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,o[0],o[1],s[0],s[1],a)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wl{constructor(e,t,n=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const i in e.paint._values){const o=e.paint.get(i);if(!n(i))continue;if(!(o instanceof aa&&io(o.property.specification)))continue;const s=Xl(i,e.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===i||i.endsWith("pattern"),h="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=Jl(i,l,"source");this.binders[i]=u?new Zl(a,s,l,t,e.id):new Gl(a,s,l,t),r.push(`/a_${i}`)}else{const e=Jl(i,l,"composite");this.binders[i]=new Hl(a,s,l,c,t,e),r.push(`/z_${i}`)}else this.binders[i]=u?new Vl(a.value,s):new jl(a.value,s,l),r.push(`/u_${i}`)}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Gl||t instanceof Hl?t.maxValue:0}populatePaintArrays(e,t,n,r,i,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Gl||l instanceof Hl||l instanceof Zl)&&l.populatePaintArray(e,t,n,r,i,o,s)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof Vl&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,r,i,o,s,a){let l=!1;const c=Object.keys(e),u=0!==c.length,h=u?c:t.uniqueIds;for(const c in this.binders){const d=this.binders[c];if((d instanceof Gl||d instanceof Hl||d instanceof Zl)&&(!0===d.expression.isStateDependent||!1===d.expression.isLightConstant)){const p=i.paint.get(c);d.expression=p.value;for(const n of h){const i=e[n.toString()];t.eachPosition(n,((e,t,n)=>{const l=r.feature(e);d.updatePaintArray(t,n,l,i,o,s,a)}))}if(!u)for(const t of n.uniqueIds){const i=e[t.toString()];n.eachPosition(t,((e,t,n)=>{const l=r.feature(e);d.updatePaintArray(t,n,l,i,o,s,a)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof jl||n instanceof Vl)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Gl||n instanceof Hl||n instanceof Zl)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof jl||n instanceof Vl||n instanceof Hl)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof jl||r instanceof Vl||r instanceof Hl)for(const i of r.uniformNames)t.push({name:i,property:n,binding:r.getBinding(e,i)})}return t}setUniforms(e,t,n,r,i){for(const{name:t,property:o,binding:s}of n)this.binders[o].setUniform(e,s,i,r.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Gl||t instanceof Hl||t instanceof Zl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Gl||n instanceof Hl||n instanceof Zl)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Gl||t instanceof Hl||t instanceof Zl)&&t.destroy()}}}class $l{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new Wl(r,t,n);this.needsUpload=!1,this._featureMap=new Sl,this._featureMapWithoutIds=new Sl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,n,r,i,o,s,a){for(const n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(e,t,r,i,o,s,a);void 0!==t.id?this._featureMap.add(t.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,r,i,o){for(const s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,s,r,i,o||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ql={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Xl(e,t){return ql[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Yl={"line-pattern":{source:Ia,composite:Ia},"fill-pattern":{source:Ia,composite:Ia},"fill-extrusion-pattern":{source:Ia,composite:Ia},"line-dasharray":{source:Pa,composite:Pa}},Kl={color:{source:Xa,composite:Aa},number:{source:Ha,composite:Xa}};function Jl(e,t,n){const r=Yl[e];return r&&r[n]||Kl[t][n]}As(jl,"ConstantBinder"),As(Vl,"PatternConstantBinder"),As(Gl,"SourceExpressionBinder"),As(Zl,"PatternCompositeBinder"),As(Hl,"CompositeExpressionBinder"),As(Wl,"ProgramConfiguration",{omit:["_buffers"]}),As($l,"ProgramConfigurationSet");class Ql{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Bd?new Bd(e.lng,e.lat):Bd.convert(e),this}setSouthWest(e){return this._sw=e instanceof Bd?new Bd(e.lng,e.lat):Bd.convert(e),this}extend(e){const t=this._sw,n=this._ne;let r,i;if(e instanceof Bd)r=e,i=e;else{if(!(e instanceof Ql))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ql.convert(e)):this.extend(Bd.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Bd.convert(e)):this;if(r=e._sw,i=e._ne,!r||!i)return this}return t||n?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new Bd(r.lng,r.lat),this._ne=new Bd(i.lng,i.lat)),this}getCenter(){return new Bd((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Bd(this.getWest(),this.getNorth())}getSouthEast(){return new Bd(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=Bd.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(e){return!e||e instanceof Ql?e:new Ql(e)}}var ec={},tc={};Object.defineProperty(tc,"__esModule",{value:!0}),tc.setMatrixArrayType=function(e){tc.ARRAY_TYPE=rc=e},tc.toRadian=function(e){return e*oc},tc.equals=function(e,t){return Math.abs(e-t)<=nc*Math.max(1,Math.abs(e),Math.abs(t))},tc.RANDOM=tc.ARRAY_TYPE=tc.EPSILON=void 0;var nc=1e-6;tc.EPSILON=nc;var rc="undefined"!=typeof Float32Array?Float32Array:Array;tc.ARRAY_TYPE=rc;var ic=Math.random;tc.RANDOM=ic;var oc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var sc={};function ac(e){return ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ac(e)}Object.defineProperty(sc,"__esModule",{value:!0}),sc.create=function(){var e=new lc.ARRAY_TYPE(4);return lc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},sc.clone=function(e){var t=new lc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},sc.fromValues=function(e,t,n,r){var i=new lc.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},sc.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},sc.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},sc.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*o-i*r;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-i*s,e[3]=n*s,e):null},sc.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},sc.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},sc.multiply=uc,sc.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*a,e[1]=i*l+s*a,e[2]=r*-a+o*l,e[3]=i*-a+s*l,e},sc.scale=function(e,t,n){var r=t[1],i=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=r*s,e[2]=i*a,e[3]=o*a,e},sc.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},sc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},sc.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},sc.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},sc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},sc.subtract=hc,sc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},sc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=lc.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=lc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-l)<=lc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=lc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},sc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},sc.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},sc.sub=sc.mul=void 0;var lc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==ac(e)&&"function"!=typeof e)return{default:e};var n=cc(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function cc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(cc=function(e){return e?n:t})(e)}function uc(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*a+o*l,e[1]=i*a+s*l,e[2]=r*c+o*u,e[3]=i*c+s*u,e}function hc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}sc.mul=uc,sc.sub=hc;var dc={};function pc(e){return pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pc(e)}Object.defineProperty(dc,"__esModule",{value:!0}),dc.create=function(){var e=new fc.ARRAY_TYPE(6);return fc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},dc.clone=function(e){var t=new fc.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},dc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},dc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},dc.fromValues=function(e,t,n,r,i,o){var s=new fc.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s[4]=i,s[5]=o,s},dc.set=function(e,t,n,r,i,o,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e},dc.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=n*o-r*i;return l?(e[0]=o*(l=1/l),e[1]=-r*l,e[2]=-i*l,e[3]=n*l,e[4]=(i*a-o*s)*l,e[5]=(r*s-n*a)*l,e):null},dc.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},dc.multiply=gc,dc.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*c,e[1]=i*u+s*c,e[2]=r*-c+o*u,e[3]=i*-c+s*u,e[4]=a,e[5]=l,e},dc.scale=function(e,t,n){var r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=n[0],c=n[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=i*c,e[3]=o*c,e[4]=s,e[5]=a,e},dc.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=r*c+o*u+a,e[5]=i*c+s*u+l,e},dc.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},dc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},dc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},dc.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},dc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},dc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},dc.subtract=yc,dc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},dc.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},dc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},dc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(n-l)<=fc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-c)<=fc.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-u)<=fc.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=fc.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-d)<=fc.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=fc.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},dc.sub=dc.mul=void 0;var fc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==pc(e)&&"function"!=typeof e)return{default:e};var n=mc(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function mc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(mc=function(e){return e?n:t})(e)}function gc(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=n[0],u=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=r*c+o*u,e[1]=i*c+s*u,e[2]=r*h+o*d,e[3]=i*h+s*d,e[4]=r*p+o*f+a,e[5]=i*p+s*f+l,e}function yc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}dc.mul=gc,dc.sub=yc;var vc={};function _c(e){return _c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_c(e)}Object.defineProperty(vc,"__esModule",{value:!0}),vc.create=function(){var e=new xc.ARRAY_TYPE(9);return xc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},vc.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},vc.clone=function(e){var t=new xc.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},vc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vc.fromValues=function(e,t,n,r,i,o,s,a,l){var c=new xc.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},vc.set=function(e,t,n,r,i,o,s,a,l,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e},vc.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},vc.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=u*s-a*c,d=-u*o+a*l,p=c*o-s*l,f=n*h+r*d+i*p;return f?(e[0]=h*(f=1/f),e[1]=(-u*r+i*c)*f,e[2]=(a*r-i*s)*f,e[3]=d*f,e[4]=(u*n-i*l)*f,e[5]=(-a*n+i*o)*f,e[6]=p*f,e[7]=(-c*n+r*l)*f,e[8]=(s*n-r*o)*f,e):null},vc.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=i*c-r*u,e[2]=r*a-i*s,e[3]=a*l-o*u,e[4]=n*u-i*l,e[5]=i*o-n*a,e[6]=o*c-s*l,e[7]=r*l-n*c,e[8]=n*s-r*o,e},vc.determinant=function(e){var t=e[3],n=e[4],r=e[5],i=e[6],o=e[7],s=e[8];return e[0]*(s*n-r*o)+e[1]*(-s*t+r*i)+e[2]*(o*t-n*i)},vc.multiply=wc,vc.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*r+p*s+c,e[7]=d*i+p*a+u,e[8]=d*o+p*l+h,e},vc.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*r+d*s,e[1]=p*i+d*a,e[2]=p*o+d*l,e[3]=p*s-d*r,e[4]=p*a-d*i,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h,e},vc.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},vc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},vc.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},vc.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},vc.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,h=r*a,d=i*s,p=i*a,f=i*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e},vc.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=n*a-r*s,_=n*l-i*s,x=n*c-o*s,b=r*l-i*a,w=r*c-o*a,S=i*c-o*l,M=u*m-h*f,E=u*g-d*f,T=u*y-p*f,C=h*g-d*m,A=h*y-p*m,I=d*y-p*g,P=v*I-_*A+x*C+b*T-w*E+S*M;return P?(e[0]=(a*I-l*A+c*C)*(P=1/P),e[1]=(l*T-s*I-c*E)*P,e[2]=(s*A-a*T+c*M)*P,e[3]=(i*A-r*I-o*C)*P,e[4]=(n*I-i*T+o*E)*P,e[5]=(r*T-n*A-o*M)*P,e[6]=(m*S-g*w+y*b)*P,e[7]=(g*x-f*S-y*_)*P,e[8]=(f*w-m*x+y*v)*P,e):null},vc.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},vc.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},vc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},vc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},vc.subtract=Sc,vc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},vc.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},vc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},vc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],y=t[6],v=t[7],_=t[8];return Math.abs(n-h)<=xc.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-d)<=xc.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=xc.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-f)<=xc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=xc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=xc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-y)<=xc.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-v)<=xc.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-_)<=xc.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))},vc.sub=vc.mul=void 0;var xc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==_c(e)&&"function"!=typeof e)return{default:e};var n=bc(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function bc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(bc=function(e){return e?n:t})(e)}function wc(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],y=n[5],v=n[6],_=n[7],x=n[8];return e[0]=d*r+p*s+f*c,e[1]=d*i+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*r+g*s+y*c,e[4]=m*i+g*a+y*u,e[5]=m*o+g*l+y*h,e[6]=v*r+_*s+x*c,e[7]=v*i+_*a+x*u,e[8]=v*o+_*l+x*h,e}function Sc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}vc.mul=wc,vc.sub=Sc;var Mc={};function Ec(e){return Ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ec(e)}Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.create=function(){var e=new Tc.ARRAY_TYPE(16);return Tc.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},Mc.clone=function(e){var t=new Tc.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.fromValues=function(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){var g=new Tc.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},Mc.set=function(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},Mc.identity=Ac,Mc.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},Mc.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=n*a-r*s,_=n*l-i*s,x=n*c-o*s,b=r*l-i*a,w=r*c-o*a,S=i*c-o*l,M=u*m-h*f,E=u*g-d*f,T=u*y-p*f,C=h*g-d*m,A=h*y-p*m,I=d*y-p*g,P=v*I-_*A+x*C+b*T-w*E+S*M;return P?(e[0]=(a*I-l*A+c*C)*(P=1/P),e[1]=(i*A-r*I-o*C)*P,e[2]=(m*S-g*w+y*b)*P,e[3]=(d*w-h*S-p*b)*P,e[4]=(l*T-s*I-c*E)*P,e[5]=(n*I-i*T+o*E)*P,e[6]=(g*x-f*S-y*_)*P,e[7]=(u*S-d*x+p*_)*P,e[8]=(s*A-a*T+c*M)*P,e[9]=(r*T-n*A-o*M)*P,e[10]=(f*w-m*x+y*v)*P,e[11]=(h*x-u*w-p*v)*P,e[12]=(a*E-s*C-l*M)*P,e[13]=(n*C-r*E+i*M)*P,e[14]=(m*_-f*b-g*v)*P,e[15]=(u*b-h*_+d*v)*P,e):null},Mc.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(r*(d*y-p*g)-h*(i*y-o*g)+m*(i*p-o*d)),e[2]=r*(l*y-c*g)-a*(i*y-o*g)+m*(i*c-o*l),e[3]=-(r*(l*p-c*d)-a*(i*p-o*d)+h*(i*c-o*l)),e[4]=-(s*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=n*(d*y-p*g)-u*(i*y-o*g)+f*(i*p-o*d),e[6]=-(n*(l*y-c*g)-s*(i*y-o*g)+f*(i*c-o*l)),e[7]=n*(l*p-c*d)-s*(i*p-o*d)+u*(i*c-o*l),e[8]=s*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(n*(h*y-p*m)-u*(r*y-o*m)+f*(r*p-o*h)),e[10]=n*(a*y-c*m)-s*(r*y-o*m)+f*(r*c-o*a),e[11]=-(n*(a*p-c*h)-s*(r*p-o*h)+u*(r*c-o*a)),e[12]=-(s*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=n*(h*g-d*m)-u*(r*g-i*m)+f*(r*d-i*h),e[14]=-(n*(a*g-l*m)-s*(r*g-i*m)+f*(r*l-i*a)),e[15]=n*(a*d-l*h)-s*(r*d-i*h)+u*(r*l-i*a),e},Mc.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*s-n*o)*(h*g-d*m)-(t*a-r*o)*(u*g-d*f)+(t*l-i*o)*(u*m-h*f)+(n*a-r*s)*(c*g-d*p)-(n*l-i*s)*(c*m-h*p)+(r*l-i*a)*(c*f-u*p)},Mc.multiply=Ic,Mc.translate=function(e,t,n){var r,i,o,s,a,l,c,u,h,d,p,f,m=n[0],g=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+a*g+h*y+t[12],e[13]=i*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e},Mc.scale=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.rotate=function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,E,T,C,A=r[0],I=r[1],P=r[2],R=Math.hypot(A,I,P);return R<Tc.EPSILON?null:(A*=R=1/R,I*=R,P*=R,i=Math.sin(n),o=Math.cos(n),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],g=t[9],y=t[10],v=t[11],w=A*I*(s=1-o)-P*i,S=I*I*s+o,M=P*I*s+A*i,E=A*P*s+I*i,T=I*P*s-A*i,C=P*P*s+o,e[0]=(a=t[0])*(_=A*A*s+o)+(h=t[4])*(x=I*A*s+P*i)+(m=t[8])*(b=P*A*s-I*i),e[1]=l*_+d*x+g*b,e[2]=c*_+p*x+y*b,e[3]=u*_+f*x+v*b,e[4]=a*w+h*S+m*M,e[5]=l*w+d*S+g*M,e[6]=c*w+p*S+y*M,e[7]=u*w+f*S+v*M,e[8]=a*E+h*T+m*C,e[9]=l*E+d*T+g*C,e[10]=c*E+p*T+y*C,e[11]=u*E+f*T+v*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},Mc.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*r,e[5]=s*i+u*r,e[6]=a*i+h*r,e[7]=l*i+d*r,e[8]=c*i-o*r,e[9]=u*i-s*r,e[10]=h*i-a*r,e[11]=d*i-l*r,e},Mc.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*r,e[1]=s*i-u*r,e[2]=a*i-h*r,e[3]=l*i-d*r,e[8]=o*r+c*i,e[9]=s*r+u*i,e[10]=a*r+h*i,e[11]=l*r+d*i,e},Mc.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*r,e[1]=s*i+u*r,e[2]=a*i+h*r,e[3]=l*i+d*r,e[4]=c*i-o*r,e[5]=u*i-s*r,e[6]=h*i-a*r,e[7]=d*i-l*r,e},Mc.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},Mc.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotation=function(e,t,n){var r,i,o,s=n[0],a=n[1],l=n[2],c=Math.hypot(s,a,l);return c<Tc.EPSILON?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(t),i=Math.cos(t),e[0]=s*s*(o=1-i)+i,e[1]=a*s*o+l*r,e[2]=l*s*o-a*r,e[3]=0,e[4]=s*a*o-l*r,e[5]=a*a*o+i,e[6]=l*a*o+s*r,e[7]=0,e[8]=s*l*o+a*r,e[9]=a*l*o-s*r,e[10]=l*l*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},Mc.fromXRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromYRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromZRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.fromRotationTranslation=Pc,Mc.fromQuat2=function(e,t){var n=new Tc.ARRAY_TYPE(3),r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=r*r+i*i+o*o+s*s;return h>0?(n[0]=2*(a*s+u*r+l*o-c*i)/h,n[1]=2*(l*s+u*i+c*r-a*o)/h,n[2]=2*(c*s+u*o+a*i-l*r)/h):(n[0]=2*(a*s+u*r+l*o-c*i),n[1]=2*(l*s+u*i+c*r-a*o),n[2]=2*(c*s+u*o+a*i-l*r)),Pc(e,t,n),e},Mc.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},Mc.getScaling=Rc,Mc.getRotation=function(e,t){var n=new Tc.ARRAY_TYPE(3);Rc(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],s=t[0]*r,a=t[1]*i,l=t[2]*o,c=t[4]*r,u=t[5]*i,h=t[6]*o,d=t[8]*r,p=t[9]*i,f=t[10]*o,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(d-l)/g,e[2]=(a-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(a+c)/g,e[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/g,e[0]=(a+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-u),e[3]=(a-c)/g,e[0]=(d+l)/g,e[1]=(h+p)/g,e[2]=.25*g),e},Mc.fromRotationTranslationScale=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3],l=i+i,c=o+o,u=s+s,h=i*l,d=i*c,p=i*u,f=o*c,m=o*u,g=s*u,y=a*l,v=a*c,_=a*u,x=r[0],b=r[1],w=r[2];return e[0]=(1-(f+g))*x,e[1]=(d+_)*x,e[2]=(p-v)*x,e[3]=0,e[4]=(d-_)*b,e[5]=(1-(h+g))*b,e[6]=(m+y)*b,e[7]=0,e[8]=(p+v)*w,e[9]=(m-y)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},Mc.fromRotationTranslationScaleOrigin=function(e,t,n,r,i){var o=t[0],s=t[1],a=t[2],l=t[3],c=o+o,u=s+s,h=a+a,d=o*c,p=o*u,f=o*h,m=s*u,g=s*h,y=a*h,v=l*c,_=l*u,x=l*h,b=r[0],w=r[1],S=r[2],M=i[0],E=i[1],T=i[2],C=(1-(m+y))*b,A=(p+x)*b,I=(f-_)*b,P=(p-x)*w,R=(1-(d+y))*w,L=(g+v)*w,D=(f+_)*S,O=(g-v)*S,N=(1-(d+m))*S;return e[0]=C,e[1]=A,e[2]=I,e[3]=0,e[4]=P,e[5]=R,e[6]=L,e[7]=0,e[8]=D,e[9]=O,e[10]=N,e[11]=0,e[12]=n[0]+M-(C*M+P*E+D*T),e[13]=n[1]+E-(A*M+R*E+O*T),e[14]=n[2]+T-(I*M+L*E+N*T),e[15]=1,e},Mc.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,c=n*s,u=r*s,h=r*a,d=i*s,p=i*a,f=i*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},Mc.frustum=function(e,t,n,r,i,o,s){var a=1/(n-t),l=1/(i-r),c=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(i+r)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0,e},Mc.perspectiveNO=Lc,Mc.perspectiveZO=function(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=i*(o=1/(r-i)),e[14]=i*r*o):(e[10]=-1,e[14]=-r),e},Mc.perspectiveFromFieldOfView=function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(i+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-a)*l*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},Mc.orthoNO=Dc,Mc.orthoZO=function(e,t,n,r,i,o,s){var a=1/(t-n),l=1/(r-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=o*c,e[15]=1,e},Mc.lookAt=function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f=t[0],m=t[1],g=t[2],y=r[0],v=r[1],_=r[2],x=n[0],b=n[1],w=n[2];return Math.abs(f-x)<Tc.EPSILON&&Math.abs(m-b)<Tc.EPSILON&&Math.abs(g-w)<Tc.EPSILON?Ac(e):(u=f-x,h=m-b,d=g-w,i=v*(d*=p=1/Math.hypot(u,h,d))-_*(h*=p),o=_*(u*=p)-y*d,s=y*h-v*u,(p=Math.hypot(i,o,s))?(i*=p=1/p,o*=p,s*=p):(i=0,o=0,s=0),a=h*s-d*o,l=d*i-u*s,c=u*o-h*i,(p=Math.hypot(a,l,c))?(a*=p=1/p,l*=p,c*=p):(a=0,l=0,c=0),e[0]=i,e[1]=a,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(i*f+o*m+s*g),e[13]=-(a*f+l*m+c*g),e[14]=-(u*f+h*m+d*g),e[15]=1,e)},Mc.targetTo=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=r[0],l=r[1],c=r[2],u=i-n[0],h=o-n[1],d=s-n[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e},Mc.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},Mc.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},Mc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},Mc.subtract=Oc,Mc.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},Mc.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},Mc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},Mc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=t[0],_=t[1],x=t[2],b=t[3],w=t[4],S=t[5],M=t[6],E=t[7],T=t[8],C=t[9],A=t[10],I=t[11],P=t[12],R=t[13],L=t[14],D=t[15];return Math.abs(n-v)<=Tc.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-_)<=Tc.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=Tc.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=Tc.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-w)<=Tc.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-S)<=Tc.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-M)<=Tc.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-E)<=Tc.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-T)<=Tc.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-C)<=Tc.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-A)<=Tc.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-I)<=Tc.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-P)<=Tc.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-R)<=Tc.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-L)<=Tc.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-D)<=Tc.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))},Mc.sub=Mc.mul=Mc.ortho=Mc.perspective=void 0;var Tc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ec(e)&&"function"!=typeof e)return{default:e};var n=Cc(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function Cc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Cc=function(e){return e?n:t})(e)}function Ac(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ic(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],_=n[0],x=n[1],b=n[2],w=n[3];return e[0]=_*r+x*a+b*h+w*m,e[1]=_*i+x*l+b*d+w*g,e[2]=_*o+x*c+b*p+w*y,e[3]=_*s+x*u+b*f+w*v,e[4]=(_=n[4])*r+(x=n[5])*a+(b=n[6])*h+(w=n[7])*m,e[5]=_*i+x*l+b*d+w*g,e[6]=_*o+x*c+b*p+w*y,e[7]=_*s+x*u+b*f+w*v,e[8]=(_=n[8])*r+(x=n[9])*a+(b=n[10])*h+(w=n[11])*m,e[9]=_*i+x*l+b*d+w*g,e[10]=_*o+x*c+b*p+w*y,e[11]=_*s+x*u+b*f+w*v,e[12]=(_=n[12])*r+(x=n[13])*a+(b=n[14])*h+(w=n[15])*m,e[13]=_*i+x*l+b*d+w*g,e[14]=_*o+x*c+b*p+w*y,e[15]=_*s+x*u+b*f+w*v,e}function Pc(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=r+r,l=i+i,c=o+o,u=r*a,h=r*l,d=r*c,p=i*l,f=i*c,m=o*c,g=s*a,y=s*l,v=s*c;return e[0]=1-(p+m),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Rc(e,t){var n=t[4],r=t[5],i=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,r,i),e[2]=Math.hypot(o,s,a),e}function Lc(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+r)*(o=1/(r-i)),e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}function Dc(e,t,n,r,i,o,s){var a=1/(t-n),l=1/(r-i),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=(s+o)*c,e[15]=1,e}function Oc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Mc.perspective=Lc,Mc.ortho=Dc,Mc.mul=Ic,Mc.sub=Oc;var Nc={},kc={};function Fc(e){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fc(e)}Object.defineProperty(kc,"__esModule",{value:!0}),kc.create=Uc,kc.clone=function(e){var t=new zc.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},kc.length=jc,kc.fromValues=function(e,t,n){var r=new zc.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=n,r},kc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},kc.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},kc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},kc.subtract=Vc,kc.multiply=Gc,kc.divide=Hc,kc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},kc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},kc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},kc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},kc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},kc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},kc.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},kc.distance=Zc,kc.squaredDistance=Wc,kc.squaredLength=$c,kc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},kc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},kc.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},kc.dot=qc,kc.cross=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=i*l-o*a,e[1]=o*s-r*l,e[2]=r*a-i*s,e},kc.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e},kc.hermite=function(e,t,n,r,i,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return e[0]=t[0]*a+n[0]*l+r[0]*c+i[0]*u,e[1]=t[1]*a+n[1]*l+r[1]*c+i[1]*u,e[2]=t[2]*a+n[2]*l+r[2]*c+i[2]*u,e},kc.bezier=function(e,t,n,r,i,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,d=l*o;return e[0]=t[0]*c+n[0]*u+r[0]*h+i[0]*d,e[1]=t[1]*c+n[1]*u+r[1]*h+i[1]*d,e[2]=t[2]*c+n[2]*u+r[2]*h+i[2]*d,e},kc.random=function(e,t){t=t||1;var n=2*zc.RANDOM()*Math.PI,r=2*zc.RANDOM()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},kc.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,e},kc.transformMat3=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},kc.transformQuat=function(e,t,n){var r=n[0],i=n[1],o=n[2],s=t[0],a=t[1],l=t[2],c=i*l-o*a,u=o*s-r*l,h=r*a-i*s,d=i*h-o*u,p=o*c-r*h,f=r*u-i*c,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e},kc.rotateX=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},kc.rotateY=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},kc.rotateZ=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},kc.angle=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+s*s+a*a),c=l&&qc(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},kc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},kc.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},kc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},kc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(n-o)<=zc.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=zc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=zc.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))},kc.forEach=kc.sqrLen=kc.len=kc.sqrDist=kc.dist=kc.div=kc.mul=kc.sub=void 0;var zc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Fc(e)&&"function"!=typeof e)return{default:e};var n=Bc(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function Bc(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Bc=function(e){return e?n:t})(e)}function Uc(){var e=new zc.ARRAY_TYPE(3);return zc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function jc(e){return Math.hypot(e[0],e[1],e[2])}function Vc(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Gc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Hc(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Zc(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function Wc(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function $c(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function qc(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}kc.sub=Vc,kc.mul=Gc,kc.div=Hc,kc.dist=Zc,kc.sqrDist=Wc,kc.len=jc,kc.sqrLen=$c;var Xc,Yc=(Xc=Uc(),function(e,t,n,r,i,o){var s,a;for(t||(t=3),n||(n=0),a=r?Math.min(r*t+n,e.length):e.length,s=n;s<a;s+=t)Xc[0]=e[s],Xc[1]=e[s+1],Xc[2]=e[s+2],i(Xc,Xc,o),e[s]=Xc[0],e[s+1]=Xc[1],e[s+2]=Xc[2];return e});kc.forEach=Yc;var Kc={};function Jc(e){return Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jc(e)}Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.create=tu,Kc.clone=function(e){var t=new Qc.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Kc.fromValues=function(e,t,n,r){var i=new Qc.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},Kc.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Kc.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},Kc.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Kc.subtract=nu,Kc.multiply=ru,Kc.divide=iu,Kc.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Kc.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Kc.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},Kc.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},Kc.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Kc.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Kc.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},Kc.distance=ou,Kc.squaredDistance=su,Kc.length=au,Kc.squaredLength=lu,Kc.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Kc.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Kc.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=o*s,e},Kc.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Kc.cross=function(e,t,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],s=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],u=t[0],h=t[1],d=t[2],p=t[3];return e[0]=h*c-d*l+p*a,e[1]=-u*c+d*s-p*o,e[2]=u*l-h*s+p*i,e[3]=-u*a+h*o-d*i,e},Kc.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e[3]=a+r*(n[3]-a),e},Kc.random=function(e,t){var n,r,i,o,s,a;t=t||1;do{s=(n=2*Qc.RANDOM()-1)*n+(r=2*Qc.RANDOM()-1)*r}while(s>=1);do{a=(i=2*Qc.RANDOM()-1)*i+(o=2*Qc.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return e[0]=t*n,e[1]=t*r,e[2]=t*i*l,e[3]=t*o*l,e},Kc.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e},Kc.transformQuat=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2],c=n[3],u=c*r+a*o-l*i,h=c*i+l*r-s*o,d=c*o+s*i-a*r,p=-s*r-a*i-l*o;return e[0]=u*c+p*-s+h*-l-d*-a,e[1]=h*c+p*-a+d*-s-u*-l,e[2]=d*c+p*-l+u*-a-h*-s,e[3]=t[3],e},Kc.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Kc.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Kc.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Kc.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=Qc.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=Qc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-l)<=Qc.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=Qc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},Kc.forEach=Kc.sqrLen=Kc.len=Kc.sqrDist=Kc.dist=Kc.div=Kc.mul=Kc.sub=void 0;var Qc=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Jc(e)&&"function"!=typeof e)return{default:e};var n=eu(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function eu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(eu=function(e){return e?n:t})(e)}function tu(){var e=new Qc.ARRAY_TYPE(4);return Qc.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function nu(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function ru(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function iu(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function ou(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function su(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function au(e){return Math.hypot(e[0],e[1],e[2],e[3])}function lu(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}Kc.sub=nu,Kc.mul=ru,Kc.div=iu,Kc.dist=ou,Kc.sqrDist=su,Kc.len=au,Kc.sqrLen=lu;var cu=function(){var e=tu();return function(t,n,r,i,o,s){var a,l;for(n||(n=4),r||(r=0),l=i?Math.min(i*n+r,t.length):t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function uu(e){return uu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uu(e)}Kc.forEach=cu,Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.create=yu,Nc.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Nc.setAxisAngle=vu,Nc.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>hu.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},Nc.getAngle=function(e,t){var n=Eu(e,t);return Math.acos(2*n*n-1)},Nc.multiply=_u,Nc.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+s*a,e[1]=i*l+o*a,e[2]=o*l-i*a,e[3]=s*l-r*a,e},Nc.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l-o*a,e[1]=i*l+s*a,e[2]=o*l+r*a,e[3]=s*l-i*a,e},Nc.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*a,e[1]=i*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},Nc.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},Nc.exp=xu,Nc.ln=bu,Nc.pow=function(e,t,n){return bu(e,t),Mu(e,e,n),xu(e,e),e},Nc.slerp=wu,Nc.random=function(e){var t=hu.RANDOM(),n=hu.RANDOM(),r=hu.RANDOM(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e},Nc.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=o*a,e},Nc.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Nc.fromMat3=Su,Nc.fromEuler=function(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),l=Math.cos(n),c=Math.sin(r),u=Math.cos(r);return e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c,e},Nc.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Nc.setAxes=Nc.sqlerp=Nc.rotationTo=Nc.equals=Nc.exactEquals=Nc.normalize=Nc.sqrLen=Nc.squaredLength=Nc.len=Nc.length=Nc.lerp=Nc.dot=Nc.scale=Nc.mul=Nc.add=Nc.set=Nc.copy=Nc.fromValues=Nc.clone=void 0;var hu=gu(tc),du=gu(vc),pu=gu(kc),fu=gu(Kc);function mu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(mu=function(e){return e?n:t})(e)}function gu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==uu(e)&&"function"!=typeof e)return{default:e};var n=mu(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function yu(){var e=new hu.ARRAY_TYPE(4);return hu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function vu(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function _u(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+s*a+i*c-o*l,e[1]=i*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-i*a,e[3]=s*u-r*a-i*l-o*c,e}function xu(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=Math.sqrt(n*n+r*r+i*i),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return e[0]=n*l,e[1]=r*l,e[2]=i*l,e[3]=a*Math.cos(s),e}function bu(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=Math.sqrt(n*n+r*r+i*i),a=s>0?Math.atan2(s,o)/s:0;return e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=.5*Math.log(n*n+r*r+i*i+o*o),e}function wu(e,t,n,r){var i,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],g=n[3];return(o=c*p+u*f+h*m+d*g)<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>hu.EPSILON?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-r)*i)/s,l=Math.sin(r*i)/s):(a=1-r,l=r),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*m,e[3]=a*d+l*g,e}function Su(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*s+s]+1),e[i]=.5*n,e[3]=(t[3*o+s]-t[3*s+o])*(n=.5/n),e[o]=(t[3*o+i]+t[3*i+o])*n,e[s]=(t[3*s+i]+t[3*i+s])*n}return e}Nc.clone=fu.clone,Nc.fromValues=fu.fromValues,Nc.copy=fu.copy,Nc.set=fu.set,Nc.add=fu.add,Nc.mul=_u;var Mu=fu.scale;Nc.scale=Mu;var Eu=fu.dot;Nc.dot=Eu,Nc.lerp=fu.lerp;var Tu=fu.length;Nc.length=Tu,Nc.len=Tu;var Cu=fu.squaredLength;Nc.squaredLength=Cu,Nc.sqrLen=Cu;var Au=fu.normalize;Nc.normalize=Au,Nc.exactEquals=fu.exactEquals,Nc.equals=fu.equals;var Iu,Pu,Ru,Lu=(Iu=pu.create(),Pu=pu.fromValues(1,0,0),Ru=pu.fromValues(0,1,0),function(e,t,n){var r=pu.dot(t,n);return r<-.999999?(pu.cross(Iu,Pu,t),pu.len(Iu)<1e-6&&pu.cross(Iu,Ru,t),pu.normalize(Iu,Iu),vu(e,Iu,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(pu.cross(Iu,t,n),e[0]=Iu[0],e[1]=Iu[1],e[2]=Iu[2],e[3]=1+r,Au(e,e))});Nc.rotationTo=Lu;var Du,Ou,Nu=(Du=yu(),Ou=yu(),function(e,t,n,r,i,o){return wu(Du,t,i,o),wu(Ou,n,r,o),wu(e,Du,Ou,2*o*(1-o)),e});Nc.sqlerp=Nu;var ku,Fu=(ku=du.create(),function(e,t,n,r){return ku[0]=n[0],ku[3]=n[1],ku[6]=n[2],ku[1]=r[0],ku[4]=r[1],ku[7]=r[2],ku[2]=-t[0],ku[5]=-t[1],ku[8]=-t[2],Au(e,Su(e,ku))});Nc.setAxes=Fu;var zu={};function Bu(e){return Bu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bu(e)}Object.defineProperty(zu,"__esModule",{value:!0}),zu.create=function(){var e=new Uu.ARRAY_TYPE(8);return Uu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},zu.clone=function(e){var t=new Uu.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},zu.fromValues=function(e,t,n,r,i,o,s,a){var l=new Uu.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=i,l[5]=o,l[6]=s,l[7]=a,l},zu.fromRotationTranslationValues=function(e,t,n,r,i,o,s){var a=new Uu.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=n,a[3]=r;var l=.5*i,c=.5*o,u=.5*s;return a[4]=l*r+c*n-u*t,a[5]=c*r+u*e-l*n,a[6]=u*r+l*t-c*e,a[7]=-l*e-c*t-u*n,a},zu.fromRotationTranslation=Zu,zu.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},zu.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},zu.fromMat4=function(e,t){var n=ju.create();Vu.getRotation(n,t);var r=new Uu.ARRAY_TYPE(3);return Vu.getTranslation(r,t),Zu(e,n,r),e},zu.copy=Wu,zu.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},zu.set=function(e,t,n,r,i,o,s,a,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=l,e},zu.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},zu.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},zu.getTranslation=function(e,t){var n=t[4],r=t[5],i=t[6],o=t[7],s=-t[0],a=-t[1],l=-t[2],c=t[3];return e[0]=2*(n*c+o*s+r*l-i*a),e[1]=2*(r*c+o*a+i*s-n*l),e[2]=2*(i*c+o*l+n*a-r*s),e},zu.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=.5*n[0],l=.5*n[1],c=.5*n[2],u=t[4],h=t[5],d=t[6],p=t[7];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=s*a+i*c-o*l+u,e[5]=s*l+o*a-r*c+h,e[6]=s*c+r*l-i*a+d,e[7]=-r*a-i*l-o*c+p,e},zu.rotateX=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*r+l*o-c*i,d=l*s+u*i+c*r-a*o,p=c*s+u*o+a*i-l*r,f=u*s-a*r-l*i-c*o;return ju.rotateX(e,t,n),e[4]=h*(s=e[3])+f*(r=e[0])+d*(o=e[2])-p*(i=e[1]),e[5]=d*s+f*i+p*r-h*o,e[6]=p*s+f*o+h*i-d*r,e[7]=f*s-h*r-d*i-p*o,e},zu.rotateY=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*r+l*o-c*i,d=l*s+u*i+c*r-a*o,p=c*s+u*o+a*i-l*r,f=u*s-a*r-l*i-c*o;return ju.rotateY(e,t,n),e[4]=h*(s=e[3])+f*(r=e[0])+d*(o=e[2])-p*(i=e[1]),e[5]=d*s+f*i+p*r-h*o,e[6]=p*s+f*o+h*i-d*r,e[7]=f*s-h*r-d*i-p*o,e},zu.rotateZ=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=a*s+u*r+l*o-c*i,d=l*s+u*i+c*r-a*o,p=c*s+u*o+a*i-l*r,f=u*s-a*r-l*i-c*o;return ju.rotateZ(e,t,n),e[4]=h*(s=e[3])+f*(r=e[0])+d*(o=e[2])-p*(i=e[1]),e[5]=d*s+f*i+p*r-h*o,e[6]=p*s+f*o+h*i-d*r,e[7]=f*s-h*r-d*i-p*o,e},zu.rotateByQuatAppend=function(e,t,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2],u=t[3];return e[0]=a*s+u*r+l*o-c*i,e[1]=l*s+u*i+c*r-a*o,e[2]=c*s+u*o+a*i-l*r,e[3]=u*s-a*r-l*i-c*o,e[4]=(a=t[4])*s+(u=t[7])*r+(l=t[5])*o-(c=t[6])*i,e[5]=l*s+u*i+c*r-a*o,e[6]=c*s+u*o+a*i-l*r,e[7]=u*s-a*r-l*i-c*o,e},zu.rotateByQuatPrepend=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],c=n[2],u=n[3];return e[0]=r*u+s*a+i*c-o*l,e[1]=i*u+s*l+o*a-r*c,e[2]=o*u+s*c+r*l-i*a,e[3]=s*u-r*a-i*l-o*c,e[4]=r*(u=n[7])+s*(a=n[4])+i*(c=n[6])-o*(l=n[5]),e[5]=i*u+s*l+o*a-r*c,e[6]=o*u+s*c+r*l-i*a,e[7]=s*u-r*a-i*l-o*c,e},zu.rotateAroundAxis=function(e,t,n,r){if(Math.abs(r)<Uu.EPSILON)return Wu(e,t);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),s=o*n[0]/i,a=o*n[1]/i,l=o*n[2]/i,c=Math.cos(r),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*s+h*l-d*a,e[1]=h*c+p*a+d*s-u*l,e[2]=d*c+p*l+u*a-h*s,e[3]=p*c-u*s-h*a-d*l;var f=t[4],m=t[5],g=t[6],y=t[7];return e[4]=f*c+y*s+m*l-g*a,e[5]=m*c+y*a+g*s-f*l,e[6]=g*c+y*l+f*a-m*s,e[7]=y*c-f*s-m*a-g*l,e},zu.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},zu.multiply=$u,zu.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},zu.lerp=function(e,t,n,r){var i=1-r;return qu(t,n)<0&&(r=-r),e[0]=t[0]*i+n[0]*r,e[1]=t[1]*i+n[1]*r,e[2]=t[2]*i+n[2]*r,e[3]=t[3]*i+n[3]*r,e[4]=t[4]*i+n[4]*r,e[5]=t[5]*i+n[5]*r,e[6]=t[6]*i+n[6]*r,e[7]=t[7]*i+n[7]*r,e},zu.invert=function(e,t){var n=Yu(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},zu.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},zu.normalize=function(e,t){var n=Yu(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,i=t[1]/n,o=t[2]/n,s=t[3]/n,a=t[4],l=t[5],c=t[6],u=t[7],h=r*a+i*l+o*c+s*u;e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=(a-r*h)/n,e[5]=(l-i*h)/n,e[6]=(c-o*h)/n,e[7]=(u-s*h)/n}return e},zu.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},zu.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},zu.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],y=t[7];return Math.abs(n-u)<=Uu.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=Uu.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=Uu.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=Uu.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-f)<=Uu.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=Uu.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=Uu.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-y)<=Uu.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},zu.sqrLen=zu.squaredLength=zu.len=zu.length=zu.dot=zu.mul=zu.setReal=zu.getReal=void 0;var Uu=Hu(tc),ju=Hu(Nc),Vu=Hu(Mc);function Gu(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Gu=function(e){return e?n:t})(e)}function Hu(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==Bu(e)&&"function"!=typeof e)return{default:e};var n=Gu(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function Zu(e,t,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],s=t[0],a=t[1],l=t[2],c=t[3];return e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=r*c+i*l-o*a,e[5]=i*c+o*s-r*l,e[6]=o*c+r*a-i*s,e[7]=-r*s-i*a-o*l,e}function Wu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function $u(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[4],l=n[5],c=n[6],u=n[7],h=t[4],d=t[5],p=t[6],f=t[7],m=n[0],g=n[1],y=n[2],v=n[3];return e[0]=r*v+s*m+i*y-o*g,e[1]=i*v+s*g+o*m-r*y,e[2]=o*v+s*y+r*g-i*m,e[3]=s*v-r*m-i*g-o*y,e[4]=r*u+s*a+i*c-o*l+h*v+f*m+d*y-p*g,e[5]=i*u+s*l+o*a-r*c+d*v+f*g+p*m-h*y,e[6]=o*u+s*c+r*l-i*a+p*v+f*y+h*g-d*m,e[7]=s*u-r*a-i*l-o*c+f*v-h*m-d*g-p*y,e}zu.getReal=ju.copy,zu.setReal=ju.copy,zu.mul=$u;var qu=ju.dot;zu.dot=qu;var Xu=ju.length;zu.length=Xu,zu.len=Xu;var Yu=ju.squaredLength;zu.squaredLength=Yu,zu.sqrLen=Yu;var Ku={};function Ju(e){return Ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ju(e)}Object.defineProperty(Ku,"__esModule",{value:!0}),Ku.create=th,Ku.clone=function(e){var t=new Qu.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Ku.fromValues=function(e,t){var n=new Qu.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},Ku.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Ku.set=function(e,t,n){return e[0]=t,e[1]=n,e},Ku.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},Ku.subtract=nh,Ku.multiply=rh,Ku.divide=ih,Ku.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Ku.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Ku.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},Ku.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},Ku.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Ku.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},Ku.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},Ku.distance=oh,Ku.squaredDistance=sh,Ku.length=ah,Ku.squaredLength=lh,Ku.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Ku.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Ku.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},Ku.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Ku.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},Ku.lerp=function(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e},Ku.random=function(e,t){t=t||1;var n=2*Qu.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},Ku.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},Ku.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},Ku.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},Ku.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},Ku.rotate=function(e,t,n,r){var i=t[0]-n[0],o=t[1]-n[1],s=Math.sin(r),a=Math.cos(r);return e[0]=i*a-o*s+n[0],e[1]=i*s+o*a+n[1],e},Ku.angle=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o);return Math.acos(Math.min(Math.max(s&&(n*i+r*o)/s,-1),1))},Ku.zero=function(e){return e[0]=0,e[1]=0,e},Ku.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Ku.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ku.equals=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.abs(n-i)<=Qu.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=Qu.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))},Ku.forEach=Ku.sqrLen=Ku.sqrDist=Ku.dist=Ku.div=Ku.mul=Ku.sub=Ku.len=void 0;var Qu=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Ju(e)&&"function"!=typeof e)return{default:e};var n=eh(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(tc);function eh(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(eh=function(e){return e?n:t})(e)}function th(){var e=new Qu.ARRAY_TYPE(2);return Qu.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function nh(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function rh(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function ih(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function oh(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function sh(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function ah(e){return Math.hypot(e[0],e[1])}function lh(e){var t=e[0],n=e[1];return t*t+n*n}Ku.len=ah,Ku.sub=nh,Ku.mul=rh,Ku.div=ih,Ku.dist=oh,Ku.sqrDist=sh,Ku.sqrLen=lh;var ch=function(){var e=th();return function(t,n,r,i,o,s){var a,l;for(n||(n=2),r||(r=0),l=i?Math.min(i*n+r,t.length):t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function uh(e){return uh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uh(e)}Ku.forEach=ch,Object.defineProperty(ec,"__esModule",{value:!0});var hh=ec.vec4=Eh=ec.vec3=ec.vec2=ec.quat2=bh=ec.quat=_h=ec.mat4=yh=ec.mat3=ec.mat2d=fh=ec.mat2=ec.glMatrix=void 0,dh=Ah(tc);ec.glMatrix=dh;var ph=Ah(sc),fh=ec.mat2=ph,mh=Ah(dc);ec.mat2d=mh;var gh=Ah(vc),yh=ec.mat3=gh,vh=Ah(Mc),_h=ec.mat4=vh,xh=Ah(Nc),bh=ec.quat=xh,wh=Ah(zu);ec.quat2=wh;var Sh=Ah(Ku);ec.vec2=Sh;var Mh=Ah(kc),Eh=ec.vec3=Mh,Th=Ah(Kc);function Ch(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ch=function(e){return e?n:t})(e)}function Ah(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==uh(e)&&"function"!=typeof e)return{default:e};var n=Ch(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}hh=ec.vec4=Th;const Ih=ba([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ph}=Ih,Rh=ba([{name:"a_pos_3",components:3,type:"Int16"}]);var Lh=ba([{name:"a_pos",type:"Int16",components:2}]),Dh={};!function(e,t){!function(e){function t(e,t,r){var i=n(256*e,256*(t=Math.pow(2,r)-t-1),r),o=n(256*(e+1),256*(t+1),r);return i[0]+","+i[1]+","+o[0]+","+o[1]}function n(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=function(e,n,r,i,o,s){return s=s||{},e+"?"+["bbox="+t(r,i,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+n].join("&")},e.getTileBBox=t,e.getMercCoords=n,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,Dh);var Oh=Dh;class Nh{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=zh(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=Oh.getTileBBox(this.x,this.y,this.z),r=function(e,t,n){let r,i="";for(let o=e;o>0;o--)r=1<<o-1,i+=(t&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=zh(e,t.z,t.z,t.x,t.y)}}class Fh{constructor(e,t,n,r,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Nh(n,+r,+i),this.key=0===t&&e===n?this.canonical.key:zh(t,e,n,r,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Fh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return zh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return zh(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Fh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Fh(t,this.wrap,t,n,r),new Fh(t,this.wrap,t,n+1,r),new Fh(t,this.wrap,t,n,r+1),new Fh(t,this.wrap,t,n+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zh(e,t,n,r,i){const o=1<<Math.min(n,22);let s=o*(i%o)+r%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const Bh=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new Fh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new Fh(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new Fh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Fh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];As(Nh,"CanonicalTileID"),As(Fh,"OverscaledTileID",{omit:["projMatrix"]});class Uh{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const r=Eh.dot(t,this.dir);if(Math.abs(r)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/r;return n[0]=this.pos[0]+this.dir[0]*i,n[1]=this.pos[1]+this.dir[1]*i,n[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,t,n){if(Eh.equals(this.pos,e)||0===t)return n[0]=n[1]=n[2]=0,!1;const[r,i,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=r*r+i*i+o*o,u=2*(s*r+a*i+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+r*e,h=a+i*e,d=l+o*e,p=Math.hypot(c,h,d);return n[0]=c*t/p,n[1]=h*t/p,n[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return n[0]=s*t/e,n[1]=a*t/e,n[2]=l*t/e,!1}return n[0]=s+r*e,n[1]=a+i*e,n[2]=l+o*e,!0}}}class jh{constructor(e,t,n,r,i){this.TL=e,this.TR=t,this.BR=n,this.BL=r,this.horizon=i}static fromInvProjectionMatrix(e,t,n){const r=[-1,1,1],i=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Eh.transformMat4(r,r,e),l=Eh.transformMat4(i,i,e),c=Eh.transformMat4(o,o,e),u=Eh.transformMat4(s,s,e);return new jh(a,l,c,u,t/n)}}function Vh(e,t,n){let r=1/0,i=-1/0;const o=[];for(const s of e){Eh.sub(o,s,t);const e=Eh.dot(o,n);r=Math.min(r,e),i=Math.max(i,e)}return[r,i]}function Gh(e,t){let n=!0;for(let r=0;r<e.planes.length;r++){const i=e.planes[r];let o=0;for(let e=0;e<t.length;e++)o+=Eh.dot(i,t[e])+i[3]>=0;if(0===o)return 0;o!==t.length&&(n=!1)}return n?2:1}function Hh(e,t){for(const n of e.projections){const r=Vh(t,e.points[0],n.axis);if(n.projection[1]<r[0]||n.projection[0]>r[1])return 0}return 1}function Zh(e,t){let n=0;const r=[0,0,0,0];for(let i=0;i<e.length;i++)r[0]=e[i][0],r[1]=e[i][1],r[2]=e[i][2],r[3]=1,hh.dot(r,t)>=0&&n++;return n}class Wh{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=$h.fromPoints(this.points),this.projections=[],this.frustumEdges=[Eh.sub([],this.points[2],this.points[3]),Eh.sub([],this.points[0],this.points[3]),Eh.sub([],this.points[4],this.points[0]),Eh.sub([],this.points[5],this.points[1]),Eh.sub([],this.points[6],this.points[2]),Eh.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],n=[e[2],0,-e[0]];this.projections.push({axis:t,projection:Vh(this.points,this.points[0],t)}),this.projections.push({axis:n,projection:Vh(this.points,this.points[0],n)})}}static fromInvProjectionMatrix(e,t,n,r){const i=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=hh.transformMat4([],n,e),s=1/o[3]/t*i;return hh.mul(o,o,[s,s,r?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Eh.sub([],o[e[0]],o[e[1]]),n=Eh.sub([],o[e[2]],o[e[1]]),r=Eh.normalize([],Eh.cross([],t,n)),i=-Eh.dot(r,o[e[1]]);return r.concat(i)})),a=[];for(let e=0;e<o.length;e++)a.push([o[e][0],o[e][1],o[e][2]]);return new Wh(a,s)}intersectsPrecise(e,t,n){for(let n=0;n<t.length;n++)if(!Zh(e,t[n]))return 0;for(let t=0;t<this.planes.length;t++)if(!Zh(e,this.planes[t]))return 0;for(const t of n)for(const n of this.frustumEdges){const r=Eh.cross([],t,n),i=Eh.length(r);if(0===i)continue;Eh.scale(r,r,1/i);const o=Vh(this.points,this.points[0],r),s=Vh(e,this.points[0],r);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}}class $h{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const r of e)Eh.min(t,t,r),Eh.max(n,n,r);return new $h(t,n)}static fromTileIdAndHeight(e,t,n){const r=1<<e.canonical.z,i=e.canonical.x,o=e.canonical.y;return new $h([i/r,o/r,t],[(i+1)/r,(o+1)/r,n])}static applyTransform(e,t){const n=e.getCorners();for(let e=0;e<n.length;++e)Eh.transformMat4(n[e],n[e],t);return $h.fromPoints(n)}static projectAabbCorners(e,t){const n=e.getCorners();for(let e=0;e<n.length;++e)Eh.transformMat4(n[e],n[e],t);return n}constructor(e,t){this.min=e,this.max=t,this.center=Eh.scale([],Eh.add([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=Eh.clone(this.min),r=Eh.clone(this.max);for(let e=0;e<t.length;e++)n[e]=t[e]?this.min[e]:this.center[e],r[e]=t[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new $h(n,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Gh(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Gh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Hh(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Hh(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}As($h,"Aabb");const qh=5,Xh=6,Yh=ar/Math.PI/2,Kh=16383,Jh=64,Qh=[Jh,32,16],ed=-Yh,td=Yh,nd=[new $h([ed,ed,ed],[td,td,td]),new $h([ed,ed,ed],[0,0,td]),new $h([0,ed,ed],[td,0,td]),new $h([ed,0,ed],[0,td,td]),new $h([0,0,ed],[td,td,td])];function rd(e){return e*Yh/kd}function id(e,t,n,r=!0){const i=Eh.scale([],e._camera.position,e.worldSize),o=[t,n,1,1];hh.transformMat4(o,o,e.pixelMatrixInverse),hh.scale(o,o,1/o[3]);const s=Eh.sub([],o,i),a=Eh.normalize([],s),l=e.globeMatrix,c=[l[12],l[13],l[14]],u=Eh.sub([],c,i),h=Eh.length(u),d=Eh.normalize([],u),p=e.worldSize/(2*Math.PI),f=Eh.dot(d,a),m=Math.asin(p/h);if(m<Math.acos(f)){if(!r)return null;const e=[],t=[];Eh.scale(e,a,h/f),Eh.normalize(t,Eh.sub(t,e,u)),Eh.normalize(a,Eh.add(a,u,Eh.scale(a,t,Math.tan(m)*h)))}const g=[];new Uh(i,a).closestPointOnSphere(c,p,g);const y=Eh.normalize([],ie(l,0)),v=Eh.normalize([],ie(l,1)),_=Eh.normalize([],ie(l,2)),x=Eh.dot(y,g),b=Eh.dot(v,g),w=Eh.dot(_,g),M=S(Math.asin(-b/p));let E=S(Math.atan2(x,w));E=e.center.lng+function(e,t){const n=(t-e+180)%360-180;return n<-180?n+360:n}(e.center.lng,E);const T=Gd(E),C=P(Hd(M),0,1);return new ep(T,C)}class od{constructor(e,t,n){this.a=Eh.sub([],e,n),this.b=Eh.sub([],t,n),this.center=n;const r=Eh.normalize([],this.a),i=Eh.normalize([],this.b);this.angle=Math.acos(Eh.dot(r,i))}}function sd(e,t){if(0===e.angle)return null;let n;return n=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(e,t,n,r){const i=Math.sin(n);return e*(Math.sin((1-r)*n)/i)+t*(Math.sin(r*n)/i)}(e.a[t],e.b[t],e.angle,P(n,0,1))+e.center[t]}function ad(e){if(e.z<=1)return nd[e.z+2*e.y+e.x];const t=pd(dd(e));return $h.fromPoints(t)}function ld(e,t,n){return Eh.scale(e,e,1-n),Eh.scaleAndAdd(e,e,t,n)}function cd(e,t){const n=Md(t.zoom);if(0===n)return ad(e);const r=dd(e),i=pd(r),o=Gd(r.getWest())*t.worldSize,s=Gd(r.getEast())*t.worldSize,a=Hd(r.getNorth())*t.worldSize,l=Hd(r.getSouth())*t.worldSize,c=[o,a,0],u=[s,a,0],h=[o,l,0],d=[s,l,0],p=_h.invert([],t.globeMatrix);return Eh.transformMat4(c,c,p),Eh.transformMat4(u,u,p),Eh.transformMat4(h,h,p),Eh.transformMat4(d,d,p),i[0]=ld(i[0],h,n),i[1]=ld(i[1],d,n),i[2]=ld(i[2],u,n),i[3]=ld(i[3],c,n),$h.fromPoints(i)}function ud(e,t,n){for(const r of e)Eh.transformMat4(r,r,t),Eh.scale(r,r,n)}function hd(e,t,n,r){const i=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const e=ad(n).getCorners();return ud(e,o,i),$h.fromPoints(e)}const s=dd(n,r),a=pd(s);ud(a,o,i);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(s.contains(e.center)){for(const e of a)Eh.min(u,u,e),Eh.max(c,c,e);c[2]=0;const t=e.point,n=[t.x*i,t.y*i,0];return Eh.min(u,u,n),Eh.max(c,c,n),new $h(u,c)}const h=[o[12]*i,o[13]*i,o[14]*i],d=s.getCenter(),p=P(e.center.lat,-Xd,Xd),f=P(d.lat,-Xd,Xd),m=Gd(e.center.lng),g=Hd(p);let y=m-Gd(d.lng);const v=g-Hd(f);y>.5?y-=1:y<-.5&&(y+=1);let _=0;if(Math.abs(y)>Math.abs(v))_=y>=0?1:3;else{_=v>=0?0:2;const e=[o[4]*i,o[5]*i,o[6]*i],t=-Math.sin(w(v>=0?s.getSouth():s.getNorth()))*Yh;Eh.scaleAndAdd(h,h,e,t)}const x=a[_],b=a[(_+1)%4],S=new od(x,b,h),M=[sd(S,0)||x[0],sd(S,1)||x[1],sd(S,2)||x[2]],E=Md(e.zoom);if(E>0){const r=function({x:e,y:t,z:n},r,i,o,s){const a=1/(1<<n);let l=e*a,c=l+a,u=t*a,h=u+a,d=0;const p=(l+c)/2-o;return p>.5?d=-1:p<-.5&&(d=1),l=((l+d)*r-(o*=r))*i+o,c=((c+d)*r-o)*i+o,u=(u*r-(s*=r))*i+s,h=(h*r-s)*i+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(n,t,e._pixelsPerMercatorPixel,m,g);for(let e=0;e<a.length;e++)ld(a[e],r[e],E);const i=Eh.add([],r[_],r[(_+1)%4]);Eh.scale(i,i,.5),ld(M,i,E)}for(const e of a)Eh.min(u,u,e),Eh.max(c,c,e);return u[2]=Math.min(x[2],b[2]),Eh.min(u,u,M),Eh.max(c,c,M),new $h(u,c)}function dd({x:e,y:t,z:n},r=!1){const i=1/(1<<n),o=new Bd(Wd(e*i),t===(1<<n)-1&&r?-90:$d((t+1)*i)),s=new Bd(Wd((e+1)*i),0===t&&r?90:$d(t*i));return new Ql(o,s)}function pd(e){const t=w(e.getNorth()),n=w(e.getSouth()),r=Math.cos(t),i=Math.cos(n),o=Math.sin(t),s=Math.sin(n),a=e.getWest(),l=e.getEast();return[fd(i,s,a),fd(i,s,l),fd(r,o,l),fd(r,o,a)]}function fd(e,t,n,r=Yh){return n=w(n),[e*Math.sin(n)*r,-t*r,e*Math.cos(n)*r]}function md(e,t,n){return fd(Math.cos(w(e)),Math.sin(w(e)),t,n)}function gd(e,t,n,r){const i=1<<n.z,o=(e/ar+n.x)/i;return md($d((t/ar+n.y)/i),Wd(o),r)}function yd({min:e,max:t}){return Kh/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const vd=new Float64Array(16);function _d(e){const t=yd(e),n=_h.fromScaling(vd,[t,t,t]);return _h.translate(n,n,Eh.negate([],e.min))}function xd(e){const t=_h.fromTranslation(vd,e.min),n=1/yd(e);return _h.scale(t,t,[n,n,n])}function bd(e){const t=ar/(2*Math.PI);return e/(2*Math.PI)/t}function wd(e,t){return ar/(512*Math.pow(2,e))*yd(ad(t))}function Sd(e,t,n,r,i){const o=bd(n),s=[e,t,-n/(2*Math.PI)],a=_h.identity(new Float64Array(16));return _h.translate(a,a,s),_h.scale(a,a,[o,o,o]),_h.rotateX(a,a,w(-i)),_h.rotateY(a,a,w(-r)),a}function Md(e){return R(qh,Xh,e)}function Ed(e,t,n){const r=_h.identity(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return _h.rotateY(r,n.globeMatrix,i),Float32Array.from(r)}function Td(e,t,n){const r=Md(n.zoom),i=e.style.map._antialias,o=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!i&&!o}function Cd(e,t,n,r){const i=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),l=1<<e.z,c=a-s,u=i-o,h=c/Jh,d=-u/Qh[n],p=[0,h,0,d,0,0,i,s,0];if(e.z>0){const e=180/r;yh.multiply(p,p,[e/c+1,0,0,0,e/u+1,0,-.5*e/h,.5*e/d,1])}return p[2]=l,p[5]=e.x,p[8]=e.y,p}function Ad(e){const t=Xd-5;e=P(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(w(e))),3);return Math.round(n*(Qh.length-1))}function Id(e){const t=[0,0,0],n=_h.identity(new Float64Array(16));return _h.multiply(n,e.pixelMatrix,e.globeMatrix),Eh.transformMat4(t,t,n),new v(t[0],t[1])}function Pd(e,t){const n=md(t.lat,t.lng),r=function(e){const t=md(e._center.lat,e._center.lng),n=Eh.fromValues(0,1,0);let r=Eh.cross([],n,t);const i=_h.fromRotation([],-e.angle,t);r=Eh.transformMat4(r,r,i),_h.fromRotation(i,-e._pitch,r);const o=Eh.normalize([],t);return Eh.scale(o,o,rd(e.cameraToCenterDistance/e.pixelsPerMeter)),Eh.transformMat4(o,o,i),Eh.add([],t,o)}(e),i=Eh.subtract([],r,n);return Eh.angle(i,n)}function Rd(e,t){return Pd(e,t)>Math.PI/2*1.01}const Ld=w(85),Dd=Math.cos(Ld),Od=Math.sin(Ld);class Nd{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const n=new Sa,r=new ja,i=[],o=e+1+2,s=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,n)=>{let r=e===o-1?e-2:0===e?e:e-1;return r+=n?24575:0,[r,t]};for(let e=0;e<o;++e)n.emplaceBack(...l(e,0,!0));for(let e=0;e<s;++e)for(let t=0;t<o;++t)n.emplaceBack(...l(t,e,(0===t||t===o-1)&&!0));for(let e=0;e<t.length;++e){const r=t[e];for(let e=0;e<o;++e)n.emplaceBack(...l(e,r,!0))}for(let e=0;e<t.length;++e){const s=r.length,l=t[e]+1+2,c=new ja;for(let n=0;n<l-1;n++){const i=n===l-2,s=i?o*(a-t.length+e-n):o;for(let e=0;e<o-1;e++){const t=n*o+e;0===n||i||0===e||e===o-2?(c.emplaceBack(t+1,t,t+s),c.emplaceBack(t+s,t+s+1,t+1)):(r.emplaceBack(t+1,t,t+s),r.emplaceBack(t+s,t+s+1,t+1))}}const u=dl.simpleSegment(0,s,n.length,r.length-s);for(let e=0;e<c.uint16.length;e+=3)r.emplaceBack(c.uint16[e],c.uint16[e+1],c.uint16[e+2]);const h=dl.simpleSegment(0,s,n.length,r.length-s);i.push({withoutSkirts:u,withSkirts:h})}return{vertices:n,indices:r,segments:i}}_createGrid(e){const t=this._fillGridMeshWithLods(Jh,Qh);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Lh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new ja;for(let e=0;e<=Jh;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const n=new Za,r=new Za,i=new Za,o=new Za;this._poleSegments=[];for(let e=0,t=0;e<qh;e++){const s=360/(1<<e);n.emplaceBack(0,-Yh,0,.5,0),r.emplaceBack(0,-Yh,0,.5,1),i.emplaceBack(0,-Yh,0,.5,.5),o.emplaceBack(0,-Yh,0,.5,.5);for(let e=0;e<=Jh;e++){let t=e/Jh,a=0;const l=Xr(0,s,t),[c,u,h]=fd(Dd,Od,l,Yh);n.emplaceBack(c,u,h,t,a),r.emplaceBack(c,u,h,t,1-a);const d=w(l);t=.5+.5*Math.sin(d),a=.5+.5*Math.cos(d),i.emplaceBack(c,u,h,t,a),o.emplaceBack(c,u,h,t,1-a)}this._poleSegments.push(dl.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,Ph,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,Ph,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(i,Ph,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,Ph,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}const kd=6371008.8,Fd=2*Math.PI*kd;class zd{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zd(L(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return kd*Math.acos(Math.min(i,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new Ql(new zd(this.lng-n,this.lat-t),new zd(this.lng+n,this.lat+t))}toEcef(e){const t=rd(e);return md(this.lat,this.lng,Yh+t)}static convert(e){if(e instanceof zd)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new zd(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new zd(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Bd=zd;const Ud=0,jd=25.5;function Vd(e){return Fd*Math.cos(e*Math.PI/180)}function Gd(e){return(180+e)/360}function Hd(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Zd(e,t){return e/Vd(t)}function Wd(e){return 360*e-180}function $d(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function qd(e,t){return e*Vd($d(t))}const Xd=85.051129;function Yd(e){return Math.cos(w(P(e,-Xd,Xd)))}function Kd(e,t){const n=P(t,Ud,jd),r=Math.pow(2,n);return Yd(e)*Fd/(512*r)}function Jd(e){return 1/Math.cos(e*Math.PI/180)}function Qd(e,t=0){const n=Math.exp(Math.PI*(1-(e.y+t/ar)/(1<<e.z)*2));return 80150034*n/(n*n+1)/ar/(1<<e.z)}class ep{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Bd.convert(e);return new ep(Gd(n.lng),Hd(n.lat),Zd(t,n.lat))}toLngLat(){return new Bd(Wd(this.x),$d(this.y))}toAltitude(){return qd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fd*Jd($d(this.y))}}function tp(e,t,n,r,i,o,s,a,l){const c=(t+r)/2,u=(n+i)/2,h=new v(c,u);a(h),function(e,t,n,r,i,o){const s=n-i,a=r-o;return Math.abs((r-t)*s-(n-e)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(tp(e,t,n,c,u,o,h,a,l),tp(e,c,u,r,i,h,s,a,l)):e.push(s)}function np(e,t,n){let r=e[0],i=r.x,o=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),tp(s,i,o,c,u,r,l,t,n),i=c,o=u,r=l}return s}function rp(e,t,n,r){if(r(t,n)){const i=t.add(n)._mult(.5);rp(e,t,i,r),rp(e,i,n,r)}else e.push(n)}function ip(e,t){let n=e[0];const r=[n];for(let i=1;i<e.length;i++){const o=e[i];rp(r,n,o,t),n=o}return r}const op=Math.pow(2,14)-1,sp=-op-1;function ap(e,t){const n=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=P(n,sp,op),e.y=P(r,sp,op),(n<e.x||n>e.x+1||r<e.y||r>e.y+1)&&q("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function lp(e,t,n){const r=e.loadGeometry(),i=e.extent,o=ar/i;if(t&&n&&n.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=n,u=e=>{const n=Wd((t.x+e.x/i)/o),r=$d((t.y+e.y/i)/o),u=c.project(n,r);e.x=(u.x*s-a)*i,e.y=(u.y*s-l)*i};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=np(r[t],u,1);else{const e=[];for(const n of r[t])n.x<0||n.x>=i||n.y<0||n.y>=i||(u(n),e.push(n));r[t]=e}}for(const e of r)for(const t of e)ap(t,o);return r}function cp(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?lp(e):[]}}function up(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}function hp(e,t,n){const r=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*r,n[1]*r,n[2]*r)}class dp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Sa,this.indexArray=new ja,this.segments=new dl,this.programConfigurations=new $l(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,r){const i=this.layers[0],o=[];let s=null;"circle"===i.type&&(s=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=cp(t,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),c,n))continue;const u=s?s.evaluate(c,{},n):void 0,h={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:lp(t,n,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new Ra,a=r.projection);for(const r of o){const{geometry:i,index:o,sourceLayerIndex:s}=r,l=e[o].feature;this.addFeature(r,i,o,t.availableImages,n,a,t.brightness),t.featureIndex.insert(l,i,o,s,this.index)}}update(e,t,n,r,i){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ul.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,r,i,o,s){for(const n of t)for(const t of n){const n=t.x,r=t.y;if(n<0||n>=ar||r<0||r>=ar)continue;if(o){const e=o.projectTilePoint(n,r,i),t=o.upVector(i,n,r),s=this.globeExtVertexArray;hp(s,e,t),hp(s,e,t),hp(s,e,t),hp(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;up(this.layoutVertexArray,n,r,-1,-1),up(this.layoutVertexArray,n,r,1,-1),up(this.layoutVertexArray,n,r,1,1),up(this.layoutVertexArray,n,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r,i,s)}}function pp(e,t){for(let n=0;n<e.length;n++)if(wp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(wp(e,t[n]))return!0;return!!yp(e,t)}function fp(e,t,n){return!!wp(e,t)||!!_p(t,e,n)}function mp(e,t){if(1===e.length)return bp(t,e[0]);for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++)if(wp(e,r[t]))return!0}for(let n=0;n<e.length;n++)if(bp(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(yp(e,t[n]))return!0;return!1}function gp(e,t,n){if(e.length>1){if(yp(e,t))return!0;for(let r=0;r<t.length;r++)if(_p(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(_p(e[r],t,n))return!0;return!1}function yp(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let e=0;e<t.length-1;e++)if(vp(r,i,t[e],t[e+1]))return!0}return!1}function vp(e,t,n,r){return X(e,n,r)!==X(t,n,r)&&X(e,t,n)!==X(e,t,r)}function _p(e,t,n){const r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(let n=1;n<t.length;n++)if(xp(e,t[n-1],t[n])<r)return!0;return!1}function xp(e,t,n){const r=t.distSqr(n);if(0===r)return e.distSqr(t);const i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function bp(e,t){let n,r,i,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)r=n[e],i=n[s],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function wp(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const o=e[r],s=e[i];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function Sp(e,t,n,r,i){for(const o of e)if(t<=o.x&&n<=o.y&&r>=o.x&&i>=o.y)return!0;const o=[new v(t,n),new v(t,i),new v(r,i),new v(r,n)];if(e.length>2)for(const t of o)if(wp(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Mp(e[t],e[t+1],o))return!0;return!1}function Mp(e,t,n){const r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;const o=X(e,t,n[0]);return o!==X(e,t,n[1])||o!==X(e,t,n[2])||o!==X(e,t,n[3])}function Ep(e,t,n,r,i,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const e=s*s+a*a;if(0===e)return!0;const t=Math.sqrt(e);s/=t,a/=t}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0)}function Tp(e,t,n,r,i,o,s){return!(Ep(e,t,r,i,o,s)||Ep(t,n,r,i,o,s)||Ep(n,e,r,i,o,s)||Ep(r,i,e,t,n,s)||Ep(i,o,e,t,n,s)||Ep(o,r,e,t,n,s))}function Cp(e,t,n){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Ap(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ip(e,t,n,r,i){if(!t[0]&&!t[1])return e;const o=v.convert(t)._mult(i);"viewport"===n&&o._rotate(-r);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}function Pp(e,t,n,r){const i=v.convert(e)._mult(r);return"viewport"===t&&i._rotate(-n),i}As(dp,"CircleBucket",{omit:["layers"]});const Rp=new da({"circle-sort-key":new ua(It.layout_circle["circle-sort-key"]),visibility:new ca(It.layout_circle.visibility)});var Lp={paint:new da({"circle-radius":new ua(It.paint_circle["circle-radius"]),"circle-color":new ua(It.paint_circle["circle-color"]),"circle-blur":new ua(It.paint_circle["circle-blur"]),"circle-opacity":new ua(It.paint_circle["circle-opacity"]),"circle-translate":new ca(It.paint_circle["circle-translate"]),"circle-translate-anchor":new ca(It.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ca(It.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ca(It.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ua(It.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ua(It.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ua(It.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ca(It.paint_circle["circle-emissive-strength"])}),layout:Rp};const Dp=_h.create(),Op=(e,t,n,r,i,o)=>{const s=e.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const e=wd(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=s.calculatePixelsToTileUnitsMatrix(n);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ut.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Dp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=i,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Md(s.zoom);const e=i[0]*ar,n=i[1]*ar;c.u_up_dir=s.projection.upVector(new Nh(0,0,0),e,n)}return c},Np=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function kp(e,t,n,r,i,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=n.projection.upVectorScale(c,n.center.lat,n.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=i&&n.elevation?n.elevation.exaggeration()*i.getElevationAt(h.x,h.y,!0):0,p=n.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=n.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Fp(p.x,p.y,p.z,r),m=o?e.tilespaceRays.map((e=>Up(e,d))):e.queryGeometry.screenGeometry,g=hh.transformMat4([],[p.x,p.y,p.z,1],r);if(!s&&o?l*=g[3]/n.cameraToCenterDistance:s&&!o&&(l*=n.cameraToCenterDistance/g[3]),o){const e=$d((t.y/ar+c.y)/(1<<c.z));l/=n.projection.pixelsPerMeter(e,1)/Zd(1,e)}if(fp(m,f,l))return!0}return!1}function Fp(e,t,n,r){const i=hh.transformMat4([],[e,t,n,1],r);return new v(i[0]/i[3],i[1]/i[3])}const zp=Eh.fromValues(0,0,0),Bp=Eh.fromValues(0,0,1);function Up(e,t){const n=Eh.create();return zp[2]=t,e.intersectsPlane(zp,Bp,n),new v(n[0],n[1])}class jp extends dp{}function Vp(e,{width:t,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*n*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*n*r);return e.width=t,e.height=n,e.data=i,e}function Gp(e,t,n){const{width:r,height:i}=t;r===e.width&&i===e.height||(Hp(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=t.data)}function Hp(e,t,n,r,i,o){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<i.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((r.y+l)*t.width+r.x)*o;for(let e=0;e<i.width*o;e++)a[u+e]=s[c+e]}return t}As(jp,"HeatmapBucket",{omit:["layers"]});class Zp{constructor(e,t){Vp(this,e,1,t)}resize(e){Gp(this,new Zp(e),1)}clone(){return new Zp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){Hp(e,t,n,r,i,1)}}class Wp{constructor(e,t){Vp(this,e,4,t)}resize(e){Gp(this,new Wp(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Wp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,r,i){Hp(e,t,n,r,i,4)}}class $p{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}As(Zp,"AlphaImage"),As(Wp,"RGBAImage");const qp=new da({visibility:new ca(It.layout_heatmap.visibility)});var Xp={paint:new da({"heatmap-radius":new ua(It.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ua(It.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ca(It.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ha(It.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ca(It.paint_heatmap["heatmap-opacity"])}),layout:qp};function Yp(e){const t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new Wp({width:n,height:r}),o=(n,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);s&&(i.data[n+r+0]=Math.floor(255*s.r/s.a),i.data[n+r+1]=Math.floor(255*s.g/s.a),i.data[n+r+2]=Math.floor(255*s.b/s.a),i.data[n+r+3]=Math.floor(255*s.a))};if(e.clips)for(let t=0,i=0;t<r;++t,i+=4*n)for(let r=0,s=0;r<n;r++,s+=4){const a=r/(n-1),{start:l,end:c}=e.clips[t];o(i,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<n;e++,t+=4)o(0,t,e/(n-1));return i}const Kp=new da({visibility:new ca(It.layout_hillshade.visibility)});var Jp={paint:new da({"hillshade-illumination-direction":new ca(It.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ca(It.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ca(It.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ca(It.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ca(It.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ca(It.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ca(It.paint_hillshade["hillshade-emissive-strength"])}),layout:Kp};const Qp=ba([{name:"a_pos",components:2,type:"Int16"}],4),{members:ef}=Qp;var tf={exports:{}};function nf(e,t,n){n=n||2;var r,i,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=rf(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,r){var i,o,s,a=[];for(i=0,o=t.length;i<o;i++)(s=rf(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(mf(s));for(a.sort(hf),i=0;i<a.length;i++)n=df(a[i],n);return n}(e,t,d,n)),e.length>80*n){r=o=e[0],i=s=e[1];for(var f=n;f<h;f+=n)(a=e[f])<r&&(r=a),(l=e[f+1])<i&&(i=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-i))?32767/c:0}return sf(d,p,n,r,i,c,0),p}function rf(e,t,n,r,i){var o,s;if(i===Af(e,t,n,r)>0)for(o=t;o<n;o+=r)s=Ef(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=Ef(o,e[o],e[o+1],s);return s&&_f(s,s.next)&&(Tf(s),s=s.next),s}function of(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!_f(r,r.next)&&0!==vf(r.prev,r,r.next))r=r.next;else{if(Tf(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function sf(e,t,n,r,i,o,s){if(e){!s&&o&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=ff(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?lf(e,r,i,o):af(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Tf(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?sf(e=cf(of(e),t,n),t,n,r,i,o,2):2===s&&uf(e,t,n,r,i,o):sf(of(e),t,n,r,i,o,1);break}}}function af(e){var t=e.prev,n=e,r=e.next;if(vf(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,s=r.x,a=t.y,l=n.y,c=r.y,u=i<o?i<s?i:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=i>o?i>s?i:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&gf(i,a,o,l,s,c,f.x,f.y)&&vf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function lf(e,t,n,r){var i=e.prev,o=e,s=e.next;if(vf(i,o,s)>=0)return!1;for(var a=i.x,l=o.x,c=s.x,u=i.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,y=ff(p,f,t,n,r),v=ff(m,g,t,n,r),_=e.prevZ,x=e.nextZ;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&gf(a,u,l,h,c,d,_.x,_.y)&&vf(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&gf(a,u,l,h,c,d,x.x,x.y)&&vf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&gf(a,u,l,h,c,d,_.x,_.y)&&vf(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&gf(a,u,l,h,c,d,x.x,x.y)&&vf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cf(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!_f(i,o)&&xf(i,r,r.next,o)&&Sf(i,o)&&Sf(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),Tf(r),Tf(r.next),r=e=o),r=r.next}while(r!==e);return of(r)}function uf(e,t,n,r,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&yf(s,a)){var l=Mf(s,a);return s=of(s,s.next),l=of(l,l.next),sf(s,t,n,r,i,o,0),void sf(l,t,n,r,i,o,0)}a=a.next}s=s.next}while(s!==e)}function hf(e,t){return e.x-t.x}function df(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,c=n,u=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&gf(o<h?i:s,o,u,h,o<h?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),Sf(r,e)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&pf(n,r)))&&(n=r,d=l)),r=r.next}while(r!==c);return n}(e,t);if(!n)return t;var r=Mf(n,e);return of(r,r.next),of(n,n.next)}function pf(e,t){return vf(e.prev,e,t.prev)<0&&vf(t.next,e,e.next)<0}function ff(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mf(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function gf(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function yf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&xf(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Sf(e,t)&&Sf(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(vf(e.prev,e,t.prev)||vf(e,t.prev,t))||_f(e,t)&&vf(e.prev,e,e.next)>0&&vf(t.prev,t,t.next)>0)}function vf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _f(e,t){return e.x===t.x&&e.y===t.y}function xf(e,t,n,r){var i=wf(vf(e,t,n)),o=wf(vf(e,t,r)),s=wf(vf(n,r,e)),a=wf(vf(n,r,t));return i!==o&&s!==a||!(0!==i||!bf(e,n,t))||!(0!==o||!bf(e,r,t))||!(0!==s||!bf(n,e,r))||!(0!==a||!bf(n,t,r))}function bf(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function wf(e){return e>0?1:e<0?-1:0}function Sf(e,t){return vf(e.prev,e,e.next)<0?vf(e,t,e.next)>=0&&vf(e,e.prev,t)>=0:vf(e,t,e.prev)<0||vf(e,e.next,t)<0}function Mf(e,t){var n=new Cf(e.i,e.x,e.y),r=new Cf(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ef(e,t,n,r){var i=new Cf(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Tf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Cf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Af(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}tf.exports=nf,tf.exports.default=nf,nf.deviation=function(e,t,n,r){var i=t&&t.length,o=Math.abs(Af(e,0,i?t[0]*n:e.length,n));if(i)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Af(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*n,u=r[s+1]*n,h=r[s+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},nf.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&n.holes.push(r+=e[i-1].length)}return n};var If=d(tf.exports);function Pf(e,t){const n=e.length;if(n<=1)return[e];const r=[];let i,o;for(let t=0;t<n;t++){const n=Y(e[t]);0!==n&&(e[t].area=Math.abs(n),void 0===o&&(o=n<0),o===n<0?(i&&r.push(i),i=[e[t]]):i.push(e[t]))}if(i&&r.push(i),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(kn(r[e],t,1,r[e].length-1,Rf),r[e]=r[e].slice(0,t));return r}function Rf(e,t){return t.area-e.area}function Lf(e,t,n){const r=n.patternDependencies;let i=!1;for(const n of t){const t=n.paint.get(`${e}-pattern`);t.isConstant()||(i=!0);const o=t.constantOr(null);o&&(i=!0,r[o]=!0)}return i}function Df(e,t,n,r,i){const o=i.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r},n,{},i.availableImages);e=e&&e.name?e.name:e,o[e]=!0,n.patterns[s.id]=e}}return n}class Of{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Sa,this.indexArray=new ja,this.indexArray2=new Na,this.programConfigurations=new $l(e.layers,e.zoom),this.segments=new dl,this.segments2=new dl,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,n,r){this.hasPattern=Lf("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=cp(s,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),u,n))continue;const h=i?i.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:lp(s,n,r),patterns:{},sortKey:h};o.push(d)}i&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:i,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=Df("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,i,o,n,{},t.availableImages,t.brightness);t.featureIndex.insert(e[o].feature,i,o,s,this.index)}}update(e,t,n,r,i){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,r,i)}addFeatures(e,t,n,r,i,o){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,r,i,o=[],s){for(const e of Pf(t,500)){let t=0;for(const n of e)t+=n.length;const n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=n.vertexLength,i=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(i.length/2);const n=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),r=n.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(r+t.length-1,r),i.push(t[0].x),i.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(r+e-1,r+e),i.push(t[e].x),i.push(t[e].y);n.vertexLength+=t.length,n.primitiveLength+=t.length}const s=If(i,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(r+s[e],r+s[e+1],r+s[e+2]);n.vertexLength+=t,n.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,o,r,s)}}As(Of,"FillBucket",{omit:["layers","patternFeatures"]});const Nf=new da({"fill-sort-key":new ua(It.layout_fill["fill-sort-key"]),visibility:new ca(It.layout_fill.visibility)});var kf={paint:new da({"fill-antialias":new ca(It.paint_fill["fill-antialias"]),"fill-opacity":new ua(It.paint_fill["fill-opacity"]),"fill-color":new ua(It.paint_fill["fill-color"]),"fill-outline-color":new ua(It.paint_fill["fill-outline-color"]),"fill-translate":new ca(It.paint_fill["fill-translate"]),"fill-translate-anchor":new ca(It.paint_fill["fill-translate-anchor"]),"fill-pattern":new ua(It.paint_fill["fill-pattern"]),"fill-emissive-strength":new ca(It.paint_fill["fill-emissive-strength"])}),layout:Nf};const Ff=ba([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zf=ba([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Bf=ba([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Uf=ba([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jf=ba([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Vf}=Ff;var Gf={},Hf=g,Zf=Wf;function Wf(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields($f,this,t)}function $f(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function qf(e){for(var t,n,r=0,i=0,o=e.length,s=o-1;i<o;s=i++)r+=((n=e[s]).x-(t=e[i]).x)*(t.y+n.y);return r}Wf.types=["Unknown","Point","LineString","Polygon"],Wf.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,i=0,o=0,s=0,a=[];e.pos<n;){if(i<=0){var l=e.readVarint();r=7&l,i=l>>3}if(i--,1===r||2===r)o+=e.readSVarint(),s+=e.readSVarint(),1===r&&(t&&a.push(t),t=[]),t.push(new Hf(o,s));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&a.push(t),a},Wf.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();n=7&u,r=u>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},Wf.prototype.toGeoJSON=function(e,t,n){var r,i,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=Wf.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var s=qf(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(l),r=0;r<l.length;r++)for(i=0;i<l[r].length;i++)u(l[r][i])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Xf=Zf,Yf=Kf;function Kf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Jf,this,t),this.length=this._features.length}function Jf(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}Kf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Xf(this._pbf,t,this.extent,this._keys,this._values)};var Qf=Yf;function em(e,t,n){if(3===e){var r=new Qf(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}var tm=Gf.VectorTile=function(e,t){this.layers=e.readFields(em,{},t)},nm=Gf.VectorTileFeature=Zf;function rm(e,t,n,r){const i=[],o=0===r?(e,t,n,r,i,o)=>{e.push(new v(o,n+(o-t)/(r-t)*(i-n)))}:(e,t,n,r,i,o)=>{e.push(new v(t+(o-n)/(i-n)*(r-t),o))};for(const s of e){const e=[];for(const i of s){if(i.length<=2)continue;const s=[];for(let e=0;e<i.length-1;e++){const a=i[e].x,l=i[e].y,c=i[e+1].x,u=i[e+1].y,h=0===r?a:l,d=0===r?c:u;h<t?d>t&&o(s,a,l,c,u,t):h>n?d<n&&o(s,a,l,c,u,n):s.push(i[e]),d<t&&h>=t&&o(s,a,l,c,u,t),d>n&&h<=n&&o(s,a,l,c,u,n)}let a=i[i.length-1];const l=0===r?a.x:a.y;l>=t&&l<=n&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),e.push(s))}e.length&&i.push(e)}return i}Gf.VectorTileLayer=Yf;class im{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var om={read:function(e,t,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},write:function(e,t,n,r,i,o){var s,a,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},sm=lm,am=om;function lm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}lm.Varint=0,lm.Fixed64=1,lm.Bytes=2,lm.Fixed32=5;var cm=4294967296,um=1/cm,hm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function dm(e){return e.type===lm.Bytes?e.readVarint()+e.pos:e.pos+1}function pm(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function fm(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function mm(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function gm(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function ym(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function vm(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function _m(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function xm(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function bm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function wm(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function Sm(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function Mm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Em(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function Tm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}lm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Mm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Tm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Mm(this.buf,this.pos)+Mm(this.buf,this.pos+4)*cm;return this.pos+=8,e},readSFixed64:function(){var e=Mm(this.buf,this.pos)+Tm(this.buf,this.pos+4)*cm;return this.pos+=8,e},readFloat:function(){var e=am.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=am.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return pm(e,r,t);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return pm(e,r,t);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return pm(e,r,t);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return pm(e,r,t);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return pm(e,r,t);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return pm(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&hm?function(e,t,n){return hm.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r="",i=t;i<n;){var o,s,a,l=e[i],c=null,u=l>239?4:l>223?3:l>191?2:1;if(i+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[i+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[i+2],128==(192&(o=e[i+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[i+2],a=e[i+3],128==(192&(o=e[i+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==lm.Bytes)return e.push(this.readVarint(t));var n=dm(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==lm.Bytes)return e.push(this.readSVarint());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==lm.Bytes)return e.push(this.readBoolean());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==lm.Bytes)return e.push(this.readFloat());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==lm.Bytes)return e.push(this.readDouble());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==lm.Bytes)return e.push(this.readFixed32());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==lm.Bytes)return e.push(this.readSFixed32());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==lm.Bytes)return e.push(this.readFixed64());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==lm.Bytes)return e.push(this.readSFixed64());var t=dm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===lm.Varint)for(;this.buf[this.pos++]>127;);else if(t===lm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===lm.Fixed32)this.pos+=4;else{if(t!==lm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Em(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Em(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Em(this.buf,-1&e,this.pos),Em(this.buf,Math.floor(e*um),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Em(this.buf,-1&e,this.pos),Em(this.buf,Math.floor(e*um),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&fm(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),am.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),am.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&fm(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,lm.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,mm,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,gm,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,_m,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ym,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,vm,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,xm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,bm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,wm,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Sm,t)},writeBytesField:function(e,t){this.writeTag(e,lm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,lm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,lm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,lm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,lm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,lm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,lm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,lm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,lm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,lm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Cm=d(sm);const Am=["tile","layer","source","sourceLayer","state"];class Im{constructor(e,t,n,r,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=r,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Am)void 0!==this[t]&&(e[t]=this[t]);return e}}class Pm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},N(this.stateChanges[e][r],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])n[t]||(this.deletedStates[e][r][t]=null)}else for(const t in n)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),r=N({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const n=this.deletedStates[e][t];if(null===n)return{};for(const e in n)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const n in this.stateChanges[e])this.state[e][n]||(this.state[e][n]={}),N(this.state[e][n],this.stateChanges[e][n]),t[n]=this.state[e][n];n[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const n in this.state[e])t[n]={},this.state[e][n]={};else for(const n in this.deletedStates[e]){if(null===this.deletedStates[e][n])this.state[e][n]={};else if(this.state[e][n])for(const t of Object.keys(this.deletedStates[e][n]))delete this.state[e][n][t];t[n]=this.state[e][n]}n[e]=n[e]||{},N(n[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const r in e)e[r].setFeatureState(n,t)}}class Rm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Lm(e,t,n,r){let i=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/r[s];let l=(e[s]-n[s])*a,c=(t[s]-n[s])*a;if(l>c){const e=l;l=c,c=e}if(l>i&&(i=l),c<o&&(o=c),i>o)return null}return i}function Dm(e,t,n,r,i,o,s,a,l,c,u){const h=r-e,d=i-t,p=o-n,f=s-e,m=a-t,g=l-n,y=u[1]*g-u[2]*m,v=u[2]*f-u[0]*g,_=u[0]*m-u[1]*f,x=h*y+d*v+p*_;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,M=c[2]-n,E=(w*y+S*v+M*_)*b;if(E<0||E>1)return null;const T=S*p-M*d,C=M*h-w*p,A=w*d-S*h,I=(u[0]*T+u[1]*C+u[2]*A)*b;return I<0||E+I>1?null:(f*T+m*C+g*A)*b}function Om(e,t,n){return(e-t)/(n-t)}function Nm(e,t,n,r,i,o,s,a,l){const c=1<<n,u=o-r,h=s-i,d=(e+1)/c*u+r,p=(t+0)/c*h+i,f=(t+1)/c*h+i;a[0]=(e+0)/c*u+r,a[1]=p,l[0]=d,l[1]=f}class km{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),n=[];let r=Math.ceil(Math.pow(2,t));const i=1/r,o=(e,t,n,r,i)=>{const o=r?1:0,s=(e+1)*n-o,a=t*n,l=(t+1)*n-o;i[0]=e*n,i[1]=a,i[2]=s,i[3]=l};let s=new Rm(r);const a=[];for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),i,!1,a);const n=zm(a[0],a[1],e),l=zm(a[2],a[1],e),c=zm(a[2],a[3],e),u=zm(a[0],a[3],e);s.minimums.push(Math.min(n,l,c,u)),s.maximums.push(Math.max(n,l,c,u)),s.leaves.push(1)}for(n.push(s),r/=2;r>=1;r/=2){const e=n[n.length-1];s=new Rm(r);for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),2,!0,a);const n=e.getElevation(a[0],a[1]),i=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(n.min,i.min,l.min,c.min),m=Math.max(n.max,i.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=t.length-1,r=t[n];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,r,i,o,s=1){return Lm([e,t,-100],[n,r,this.maximums[0]*s],i,o)}raycast(e,t,n,r,i,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,n,r,i,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){Nm(f,m,g,e,t,n,r,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,y=(m+1)/a,v=zm(l,d,this.dem)*s,_=zm(c,d,this.dem)*s,x=zm(c,y,this.dem)*s,b=zm(l,y,this.dem)*s,w=Dm(u[0],u[1],v,h[0],u[1],_,h[0],h[1],x,i,o),S=Dm(h[0],h[1],x,u[0],h[1],b,u[0],u[1],v,i,o),M=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(M!==Number.MAX_VALUE)return M;{const e=Eh.scaleAndAdd([],i,o,p);if(Fm(v,_,b,x,Om(e[0],u[0],h[0]),Om(e[1],u[1],h[1]))>=e[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){Nm((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,n,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=Lm(u,h,i,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let n=0;n<y&&!t;n++)e>=l[c[n]]&&(c.splice(n,0,d),t=!0);t||(c[y]=d),y++}}for(let e=0;e<y;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,r,i){if(1===e[r].isLeaf(t,n))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=r-1,s=e[o];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const r=2*t+this._siblingOffset[e][0],i=2*n+this._siblingOffset[e][1],o=s.getElevation(r,i),c=s.isLeaf(r,i),u=this._addNode(o.min,o.max,c);c&&(a|=1<<e),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(e,2*t+this._siblingOffset[r][0],2*n+this._siblingOffset[r][1],o,l+r)}}function Fm(e,t,n,r,i,o){return Xr(Xr(e,n,o),Xr(t,r,o),i)}function zm(e,t,n){const r=n.dim,i=P(e*r-.5,0,r-1),o=P(t*r-.5,0,r-1),s=Math.floor(i),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return Fm(n.get(s,a),n.get(l,a),n.get(s,c),n.get(l,c),i-s,o-a)}const Bm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768],float:[1,1,1,1]};function Um(e,t,n){return(256*e*256+256*t+n)/10-1e4}function jm(e,t,n){return 256*e+t+n/256-32768}class Vm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,r,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return q(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,this._modifiedForSources={},!i){for(let e=0;e<o;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(o,e)]=s[this._idx(o-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,o)]=s[this._idx(e,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)]}if(r){const e=new Float32Array(t.data.buffer),n="terrarium"===this.encoding?jm:Um;for(let t=0;t<s.length;++t){const r=4*t;e[t]=n(this.pixels[r],this.pixels[r+1],this.pixels[r+2])}this.encoding="float"}this._timestamp=ut.now()}_buildQuadTree(){this._tree=new km(this)}get(e,t,n=!1){n&&(e=P(e,-1,this.dim),t=P(t,-1,this.dim));const r=this._idx(e,t);if("float"===this.encoding)return this.floatView||(this.floatView=new Float32Array(this.pixels.buffer)),this.floatView[r];const i=4*r;return("terrarium"===this.encoding?jm:Um)(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}set(e,t,n){const r=this._idx(e,t);if("float"===this.encoding){this.floatView||(this.floatView=new Float32Array(this.pixels.buffer));const e=this.floatView[r];return this.floatView[r]=n,n-e}const i=4*r,o=("terrarium"===this.encoding?jm:Um)(this.pixels[i],this.pixels[i+1],this.pixels[i+2]),s=Vm.pack(n,"terrarium"===this.encoding?"terrarium":"mapbox");return this.pixels[i]=s[0],this.pixels[i+1]=s[1],this.pixels[i+2]=s[2],n-o}static getUnpackVector(e){return Bm[e]}get unpackVector(){return Bm[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],r=Vm.getUnpackVector(t);let i=Math.floor((e+r[3])/r[2]);return n[2]=i%256,i=Math.floor(i/256),n[1]=i%256,i=Math.floor(i/256),n[0]=i,n}getPixels(){return"float"===this.encoding?new $p({width:this.stride,height:this.stride},this.pixels):new Wp({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,i=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let t=o;t<s;t++)for(let n=r;n<i;n++){const r=4*this._idx(n,t),i=4*this._idx(n+a,t+l);this.pixels[r+0]=e.pixels[i+0],this.pixels[r+1]=e.pixels[i+1],this.pixels[r+2]=e.pixels[i+2],this.pixels[r+3]=e.pixels[i+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}As(Vm,"DEMData"),As(km,"DemMinMaxQuadTree",{omit:["dem"]});class Gm{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const n=t.getSource().maxzoom,r=1<<n,i=Math.floor(e.x),o=Math.floor((e.x-i)*r),s=Math.floor(e.y*r),a=this.findDEMTileFor(new Fh(n,i,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,n=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const i=r.getSource().maxzoom,o=1<<i,s=Math.floor(e.x),a=e.x-s,l=new Fh(i,s,i,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*Xr(Xr(u.get(f,m),u.get(f,m+1),p-m),Xr(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,n){const r=1<<e.canonical.z;return this.getAtPointOrZero(new ep(e.wrap+(e.canonical.x+t/ar)/r,(e.canonical.y+n/ar)/r))}getAtTileOffsetFunc(e,t,n,r){return i=>{const o=this.getAtTileOffset(e,i.x,i.y),s=r.upVector(e.canonical,i.x,i.y),a=r.upVectorScale(e.canonical,t,n).metersToTile;return Eh.scale(s,s,o*a),s}}getForTilePoints(e,t,n,r){if(this.isUsingMockSource())return!1;const i=Hm.create(this,e,r);return!!i&&(t.forEach((e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],n)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const n=t.dem.tree,r=t.tileID,i=1<<e.canonical.z-r.canonical.z;let o=e.canonical.x/i-r.canonical.x,s=e.canonical.y/i-r.canonical.y,a=0;for(let t=0;t<e.canonical.z-r.canonical.z&&!n.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}}class Hm{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const r=n||e.findDEMTileFor(t);if(!r||!r.dem)return;const i=r.dem,o=r.tileID,s=1<<t.canonical.z-o.canonical.z;return new Hm(r,i.dim/ar/s,[(t.canonical.x/s-o.canonical.x)*i.dim,(t.canonical.y/s-o.canonical.y)*i.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),i=Math.floor(n);return new v(r,i)}getElevationAt(e,t,n,r){const i=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(i),a=Math.floor(o),l=this._dem;return r=!!r,n?Xr(Xr(l.get(s,a,r),l.get(s,a+1,r),o-a),Xr(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),i-s):l.get(s,a,r)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Zd(1,e)*this._dem.stride}}class Zm{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ts(ar,16,0),this.featureIndexArray=new ll,this.promoteId=t}insert(e,t,n,r,i,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i,o);const a=this.grid;for(let e=0;e<t.length;e++){const n=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<n.length;e++){const t=n[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<ar&&r[1]<ar&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tm(new Cm(this.rawTileData)).layers,this.sourceLayerCoder=new im(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,r){this.loadVTLayers();const i=e.params||{},o=Do(i.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,n,r)=>Sp(s.bufferedTilespaceGeometry,e,t,n,r)));c.sort($m);let u=null;a.elevation&&c.length>0&&(u=Hm.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,i.layers,i.availableImages,t,n,r,((t,n,r,i=0)=>(f||(f=lp(t,this.tileID.canonical,e.tileTransform)),n.queryIntersectsFeature(s,t,r,f,this.z,e.transform,e.pixelPosMatrix,u,i))))}return h}loadMatchingFeature(e,t,n,r,i,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(r&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(n.needGeometry){const e=cp(m,!0);if(!n.filter(new ea(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new ea(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const n=p[t];if(r&&r.indexOf(n)<0)continue;const u=o[n];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=N({},s[n]);f.paint=Wm(f.paint,u.paint,m,h,i),f.layout=Wm(f.layout,u.layout,m,h,i);const y=!l||l(m,u,h,d);if(!y)continue;const v=new Im(m,this.z,this.x,this.y,g);v.layer=f;let _=e[n];void 0===_&&(_=e[n]=[]),_.push({featureIndex:c,feature:v,intersectionZ:y})}}lookupSymbolFeatures(e,t,n,r,i,o,s,a){const l={};this.loadVTLayers();const c=Do(i);for(const i of e)this.loadMatchingFeature(l,{bucketIndex:n,sourceLayerIndex:r,featureIndex:i,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(n),i=this.vtFeatures[r];if(i[t])return i[t];const o=this.vtLayers[r].feature(t);return i[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=r&&(n=e.properties[r]),"boolean"==typeof n&&(n=Number(n))}return n}}function Wm(e,t,n,r,i){return H(e,((e,o)=>{const s=t instanceof la?t.get(o):null;return s&&s.evaluate?s.evaluate(n,r,i):s}))}function $m(e,t){return t-e}As(Zm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const qm=ba([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xm=ba([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ym=ba([{name:"a_projected_pos",components:4,type:"Float32"}],4);ba([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Km=ba([{name:"a_z_offset",components:1,type:"Float32"}],4),Jm=ba([{name:"a_texb",components:2,type:"Uint16"}]),Qm=ba([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),eg=ba([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ba([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tg=ba([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ng=ba([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ba([{name:"triangle",components:3,type:"Uint16"}]),ba([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ba([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ba([{type:"Float32",name:"offsetX"}]),ba([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rg=24;const ig=128;function og(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ea(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=n;let i=0;for(;i<t.length&&t[i]<=e;)i++;i=Math.max(0,i-1);let o=i;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[i],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new ea(s)),maxSize:n.evaluate(new ea(a)),interpolationType:r}}}function sg(e,{uSize:t,uSizeT:n},{lowerSize:r,upperSize:i}){return"source"===e.kind?r/ig:"composite"===e.kind?Xr(r/ig,i/ig,n):t}function ag(e,t){let n=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:i,minZoom:o,maxZoom:s}=e,a=i?P(vi.interpolationFactor(i,t,o,s),0,1):0;"camera"===e.kind?r=Xr(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:r}}var lg=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ig,evaluateSizeForFeature:sg,evaluateSizeForZoom:ag,getSizeData:og});function cg(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Qs.applyArabicShaping&&(e=Qs.applyArabicShaping(e)),e}(e.text,t,n)})),e}const ug={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function hg(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}function dg(e){return""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e||""===e}const pg=3;function fg(e,t,n){t.glyphs=[],1===e&&n.readMessage(mg,t)}function mg(e,t,n){if(3===e){const{id:e,bitmap:r,width:i,height:o,left:s,top:a,advance:l}=n.readMessage(gg,{});t.glyphs.push({id:e,bitmap:new Zp({width:i+2*pg,height:o+2*pg},r),metrics:{width:i,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=n.readSVarint():5===e&&(t.descender=n.readSVarint())}function gg(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const yg=pg;function vg(e){let t=0,n=0;for(const r of e)t+=r.w*r.h,n=Math.max(n,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let i=0,o=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const n=r[e];if(!(t.w>n.w||t.h>n.h)){if(t.x=n.x,t.y=n.y,o=Math.max(o,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===n.w&&t.h===n.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===n.h?(n.x+=t.w,n.w-=t.w):t.w===n.w?(n.y+=t.h,n.h-=t.h):(r.push({x:n.x+t.w,y:n.y,w:n.w-t.w,h:t.h}),n.y+=t.h,n.h-=t.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}const _g=1;class xg{constructor(e,{pixelRatio:t,version:n,stretchX:r,stretchY:i,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=i,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+_g,this.paddedRect.y+_g]}get br(){return[this.paddedRect.x+this.paddedRect.w-_g,this.paddedRect.y+this.paddedRect.h-_g]}get displaySize(){return[(this.paddedRect.w-2*_g)/this.pixelRatio,(this.paddedRect.h-2*_g)/this.pixelRatio]}}class bg{constructor(e,t){const n={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(e,n,i),this.addImages(t,r,i);const{w:o,h:s}=vg(i),a=new Wp({width:o||1,height:s||1});for(const t in e){const r=e[t],i=n[t].paddedRect;Wp.copy(r.data,a,{x:0,y:0},{x:i.x+_g,y:i.y+_g},r.data)}for(const e in t){const n=t[e],i=r[e].paddedRect,o=i.x+_g,s=i.y+_g,l=n.data.width,c=n.data.height;Wp.copy(n.data,a,{x:0,y:0},{x:o,y:s},n.data),Wp.copy(n.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),Wp.copy(n.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),Wp.copy(n.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),Wp.copy(n.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=r}addImages(e,t,n){for(const r in e){const i=e[r],o={x:0,y:0,w:i.data.width+2*_g,h:i.data.height+2*_g};n.push(o),t[r]=new xg(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,n))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const r in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[r],e.getImage(r,n),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r,n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,i]=e.tl;n.update(t.data,void 0,{x:r,y:i})}}As(xg,"ImagePosition"),As(bg,"ImageAtlas");const wg={horizontal:1,vertical:2,horizontalOnly:3},Sg=-17;class Mg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Mg;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Mg;return t.imageName=e,t}}class Eg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Eg;for(let r=0;r<e.sections.length;r++){const i=e.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let n="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r+1)||null,o=e.charCodeAt(r-1)||null;n+=!t&&(i&&zs(i)&&!ug[e[r+1]]||o&&zs(o)&&!ug[e[r-1]])||!ug[e[r]]?e[r]:ug[e[r]]}return n}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Cg[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Cg[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Eg;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Mg.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void q("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Mg.forImage(t)),this.sectionIndex.push(this.sections.length-1)):q("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tg(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f){const m=Eg.fromFeature(e,i);h===wg.vertical&&m.verticalizePunctuation(d);let g=[];const y=function(e,t,n,r,i,o){if(!e)return[];const s=[],a=function(e,t,n,r,i,o){let s=0;for(let n=0;n<e.length();n++){const a=e.getSection(n);s+=Ig(e.getCodePoint(n),a,r,i,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,r,i,o),l=e.text.indexOf("")>=0;let c=0;for(let n=0;n<e.length();n++){const h=e.getSection(n),d=e.getCodePoint(n);if(Cg[d]||(c+=Ig(d,h,r,i,t,o)),n<e.length()-1){const t=!((u=d)<11904||!(Ds["Bopomofo Extended"](u)||Ds.Bopomofo(u)||Ds["CJK Compatibility Forms"](u)||Ds["CJK Compatibility Ideographs"](u)||Ds["CJK Compatibility"](u)||Ds["CJK Radicals Supplement"](u)||Ds["CJK Strokes"](u)||Ds["CJK Symbols and Punctuation"](u)||Ds["CJK Unified Ideographs Extension A"](u)||Ds["CJK Unified Ideographs"](u)||Ds["Enclosed CJK Letters and Months"](u)||Ds["Halfwidth and Fullwidth Forms"](u)||Ds.Hiragana(u)||Ds["Ideographic Description Characters"](u)||Ds["Kangxi Radicals"](u)||Ds["Katakana Phonetic Extensions"](u)||Ds.Katakana(u)||Ds["Vertical Forms"](u)||Ds["Yi Radicals"](u)||Ds["Yi Syllables"](u)));(Ag[d]||t||h.imageName)&&s.push(Lg(n+1,c,a,s,Rg(d,e.getCodePoint(n+1),t&&l),!1))}}var u;return Dg(Lg(e.length(),c,a,s,0,!0))}(m,c,o,t,r,p),{processBidirectionalText:v,processStyledBidirectionalText:_}=Qs;if(v&&1===m.sections.length){const e=v(m.toString(),y);for(const t of e){const e=new Eg;e.text=t,e.sections=m.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);g.push(e)}}else if(_){const e=_(m.text,m.sectionIndex,y);for(const t of e){const e=new Eg;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const n=[],r=e.text;let i=0;for(const r of t)n.push(e.substring(i,r)),i=r;return i<r.length&&n.push(e.substring(i,r.length)),n}(m,y);const x=[],b={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,n,r,i,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of i){const n=e.getSections();for(const e of n){if(e.imageName)continue;const n=t[e.fontStack];if(n&&(g=void 0!==n.ascender&&void 0!==n.descender,!g))break}if(!g)break}let y=0;for(const s of i){s.trim();const i=s.getMaxScale(),a=(i-1)*rg,_={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=_;const x=_.positionedGlyphs;let b=0;if(!s.length()){p+=o,++y;continue}let w=0,S=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCodePoint(o);let y=a.scale,_=null,M=null,E=null,T=rg,C=0;const A=!(l===wg.horizontal||!u&&!Fs(m)||u&&(Cg[m]||(v=m,Ds.Arabic(v)||Ds["Arabic Supplement"](v)||Ds["Arabic Extended-A"](v)||Ds["Arabic Presentation Forms-A"](v)||Ds["Arabic Presentation Forms-B"](v))));if(a.imageName){const t=r[a.imageName];if(!t)continue;E=a.imageName,e.iconsInText=e.iconsInText||!0,M=t.paddedRect;const n=t.displaySize;y=y*rg/h,_={width:n[0],height:n[1],left:_g,top:-yg,advance:A?n[1]:n[0],localGlyph:!1},C=g?-_.height*y:Sg+i*rg-n[1]*y,T=_.advance;const o=(A?n[0]:n[1])*y-rg*i;o>0&&o>b&&(b=o)}else{const e=n[a.fontStack];if(!e)continue;e[m]&&(M=e[m]);const r=t[a.fontStack];if(!r)continue;const o=r.glyphs[m];if(!o)continue;if(_=o.metrics,T=8203!==m?rg:0,g){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,n=(e+t)*y;w<n&&(w=n,S=(e-t)/2*y),C=-e*y}else C=Sg+(i-y)*rg}A?(e.verticalizable=!0,x.push({glyph:m,imageName:E,x:d,y:p+C,vertical:A,scale:y,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:_,rect:M}),d+=T*y+c):(x.push({glyph:m,imageName:E,x:d,y:p+C,vertical:A,scale:y,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:_,rect:M}),d+=_.advance*y+c)}0!==x.length&&(f=Math.max(d-c,f),g?Ng(x,m,b,S,o*i/2):Ng(x,m,b,0,o/2)),d=0;const M=o*i+b;_.lineOffset=Math.max(b,a),p+=M,++y}var v;const _=p,{horizontalAlign:x,verticalAlign:b}=Og(s);(function(e,t,n,r,i,o){const s=(t-n)*i,a=-o*r;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,f,_),e.top+=-b*_,e.bottom=e.top+_,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,n,r,g,s,a,l,h,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Cg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ag={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ig(e,t,n,r,i,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*rg/o+i:0}{const r=n[t.fontStack],o=r&&r.glyphs[e];return o?o.metrics.advance*t.scale+i:0}}function Pg(e,t,n,r){const i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function Rg(e,t,n){let r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Lg(e,t,n,r,i,o){let s=null,a=Pg(t,n,i,o);for(const e of r){const r=Pg(t-e.x,n,i,o)+e.badness;r<=a&&(s=e,a=r)}return{index:e,x:t,priorBreak:s,badness:a}}function Dg(e){return e?Dg(e.priorBreak).concat(e.index):[]}function Og(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Ng(e,t,n,r,i){if(!(t||n||r||i))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=n+r+i}function kg(e,t,n,r){const{horizontalAlign:i,verticalAlign:o}=Og(r),s=n[0]-e.displaySize[0]*i,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function Fg(e,t,n,r,i,o){const s=e.imagePrimary;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=i[0]+l-r[3],h=i[0]+c+r[1]):(p=i[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=i[1]+f-r[0],d=i[1]+m+r[2]):(u=i[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class zg extends v{constructor(e,t,n,r,i){super(e,t),this.angle=r,this.z=n,void 0!==i&&(this.segment=i)}clone(){return new zg(this.x,this.y,this.z,this.angle,this.segment)}}function Bg(e,t,n,r,i){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>i)return!1;s++,a+=t.dist(n)}return!0}function Ug(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function jg(e,t,n){return e?.6*t*n:0}function Vg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Gg(e,t,n,r,i,o){const s=jg(n,i,o),a=Vg(n,r)*o;let l=0;const c=Ug(e)/2;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1],o=r.dist(i);if(l+o>c){const u=(c-l)/o,h=Xr(r.x,i.x,u),d=Xr(r.y,i.y,u),p=new zg(h,d,0,i.angleTo(r),n);return!s||Bg(e,p,a,s,t)?p:void 0}l+=o}}function Hg(e,t,n,r,i,o,s,a,l){const c=jg(r,o,s),u=Vg(r,i),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Zg(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function Zg(e,t,n,r,i,o,s,a,l){const c=o/2,u=Ug(e);let h=0,d=t-n,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+n<h+f;){d+=n;const g=(d-h)/f,y=Xr(s.x,a.x,g),v=Xr(s.y,a.y,g);if(y>=0&&y<l&&v>=0&&v<l&&d-c>=0&&d+c<=u){const n=new zg(y,v,0,m,t);r&&!Bg(e,n,o,r,i)||p.push(n)}}h+=f}return a||p.length||s||(p=Zg(e,h/2,n,r,i,o,s,!0,l)),p}function Wg(e,t,n,r,i){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let l;for(let e=0;e<a.length-1;e++){let s=a[e],c=a[e+1];s.x<t&&c.x<t||(s.x<t?s=new v(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<t&&(c=new v(t,s.y+(t-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<n&&c.y<n||(s.y<n?s=new v(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y<n&&(c=new v(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),s.x>=r&&c.x>=r||(s.x>=r?s=new v(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=r&&(c=new v(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=i&&c.y>=i||(s.y>=i?s=new v(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y>=i&&(c=new v(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}As(zg,"Anchor");const $g=1e20;function qg(e,t,n,r,i,o,s,a,l){for(let c=t;c<t+r;c++)Xg(e,n*o+c,o,i,s,a,l);for(let c=n;c<n+i;c++)Xg(e,c*o+t,1,r,s,a,l)}function Xg(e,t,n,r,i,o,s){o[0]=0,s[0]=-$g,s[1]=$g,i[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){i[a]=e[t+a*n];const r=a*a;do{const e=o[l];c=(i[a]-i[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=$g}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*n]=i[r]+c*c}}const Yg=2;class Kg{constructor(e,t,n){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,n){const r=[],o=this.urls[t]||i.GLYPHS_URL;for(const t in e)for(const n of e[t])r.push({stack:t,id:n});D(r,(({stack:e,id:t},n)=>{let r=this.entries[e];r||(r=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let i=r.glyphs[t];if(void 0!==i)return void n(null,{stack:e,id:t,glyph:i});if(i=this._tinySDF(r,e,t),i)return r.glyphs[t]=i,void n(null,{stack:e,id:t,glyph:i});const s=Math.floor(t/256);if(256*s>65535)return void n(new Error("glyphs > 65535 not supported"));if(r.ranges[s])return void n(null,{stack:e,id:t,glyph:i});let a=r.requests[s];a||(a=r.requests[s]=[],Kg.loadGlyphRange(e,s,o,this.requestManager,((e,t)=>{if(t){r.ascender=t.ascender,r.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t.glyphs[+e]);r.ranges[s]=!0}for(const n of a)n(e,t);delete r.requests[s]}))),a.push(((r,i)=>{r?n(r):i&&n(null,{stack:e,id:t,glyph:i.glyphs[t]||null})}))}),((e,t)=>{if(e)n(e);else if(t){const e={};for(const{stack:n,id:r,glyph:i}of t)void 0===e[n]&&(e[n]={}),void 0===e[n].glyphs&&(e[n].glyphs={}),e[n].glyphs[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[n].ascender=this.entries[n].ascender,e[n].descender=this.entries[n].descender;n(null,e)}}))}_doesCharSupportLocalGlyph(e){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localFontFamily:!!this.localFontFamily&&(Ds["CJK Unified Ideographs"](e)||Ds["Hangul Syllables"](e)||Ds.Hiragana(e)||Ds.Katakana(e)||Ds["CJK Symbols and Punctuation"](e)||Ds["CJK Unified Ideographs Extension A"](e)||Ds["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,n){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(n))return;let i=e.tinySDF;if(!i){let n="400";/bold/i.test(t)?n="900":/medium/i.test(t)?n="500":/light/i.test(t)&&(n="200"),i=e.tinySDF=new Kg.TinySDF({fontFamily:r,fontWeight:n,fontSize:24*Yg,buffer:3*Yg,radius:8*Yg}),i.fontWeight=n}if(this.localGlyphs[i.fontWeight][n])return this.localGlyphs[i.fontWeight][n];const o=String.fromCodePoint(n),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=i.draw(o);return this.localGlyphs[i.fontWeight][n]={id:n,bitmap:new Zp({width:a,height:l},s),metrics:{width:c/Yg,height:u/Yg,left:h/Yg,top:d/Yg-27,advance:p/Yg,localGlyph:!0}}}}Kg.loadGlyphRange=function(e,t,n,r,i){const o=256*t,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),ve.Glyphs);Se(a,((e,t)=>{if(e)i(e);else if(t){const e={},n=function(e){return new Cm(e).readFields(fg,{})}(t);for(const t of n.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:n.ascender,descender:n.descender})}}))},Kg.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${i}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const v=f.getImageData(m,m,a,l);y.fill($g,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=v.data[4*(e*a+t)+3]/255;if(0===n)continue;const r=(e+m)*c+t+m;if(1===n)y[r]=0,g[r]=$g;else{const e=.5-n;y[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}qg(y,0,0,c,u,c,this.f,this.v,this.z),qg(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(y[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};const Jg=_g;function Qg(e,t,n,r){const i=[],o=e.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*Jg,l=o.paddedRect.h-2*Jg,c=e.right-e.left,u=e.bottom-e.top,h=o.stretchX||[[0,a]],d=o.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=l-m;let _=0,x=f,b=0,w=m,S=0,M=g,E=0,T=y;if(o.content&&r){const e=o.content;_=ey(h,0,e[0]),b=ey(d,0,e[1]),x=ey(h,e[0],e[2]),w=ey(d,e[1],e[3]),S=e[0]-_,E=e[1]-b,M=e[2]-e[0]-x,T=e[3]-e[1]-w}const C=(r,i,a,l)=>{const h=ny(r.stretch-_,x,c,e.left),d=ry(r.fixed-S,M,r.stretch,f),p=ny(i.stretch-b,w,u,e.top),g=ry(i.fixed-E,T,i.stretch,m),y=ny(a.stretch-_,x,c,e.left),C=ry(a.fixed-S,M,a.stretch,f),A=ny(l.stretch-b,w,u,e.top),I=ry(l.fixed-E,T,l.stretch,m),P=new v(h,p),R=new v(y,p),L=new v(y,A),D=new v(h,A),O=new v(d/s,g/s),N=new v(C/s,I/s),k=t*Math.PI/180;if(k){const e=Math.sin(k),t=Math.cos(k),n=[t,-e,e,t];P._matMult(n),R._matMult(n),D._matMult(n),L._matMult(n)}const F=r.stretch+r.fixed,z=a.stretch+a.fixed,B=i.stretch+i.fixed,U=l.stretch+l.fixed,j=e.imageSecondary;return{tl:P,tr:R,bl:D,br:L,texPrimary:{x:o.paddedRect.x+Jg+F,y:o.paddedRect.y+Jg+B,w:z-F,h:U-B},texSecondary:j?{x:j.paddedRect.x+Jg+F,y:j.paddedRect.y+Jg+B,w:z-F,h:U-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:N,minFontScaleX:M/s/c,minFontScaleY:T/s/u,isSDF:n}};if(r&&(o.stretchX||o.stretchY)){const e=ty(h,g,f),t=ty(d,y,m);for(let n=0;n<e.length-1;n++){const r=e[n],o=e[n+1];for(let e=0;e<t.length-1;e++)i.push(C(r,t[e],o,t[e+1]))}}else i.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return i}function ey(e,t,n){let r=0;for(const i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function ty(e,t,n){const r=[{fixed:-Jg,stretch:0}];for(const[t,n]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(n-t)})}return r.push({fixed:t+Jg,stretch:n}),r}function ny(e,t,n,r){return e/t*n+r}function ry(e,t,n,r){return e-t*n/r}function iy(e,t,n,r){const i=t+e.positionedLines[r].lineOffset;return 0===r?n+i/2:n+(i+(t+e.positionedLines[r-1].lineOffset))/2}function oy(e,t=1,n=!1){let r=1/0,i=1/0,o=-1/0,s=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<i)&&(i=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const l=Math.min(o-r,s-i);let c=l/2;const u=new sr([],sy);if(0===l)return new v(r,i);for(let t=r;t<o;t+=l)for(let n=i;n<s;n+=l)u.push(new ay(t+c,n+c,c,e));let h=function(e){let t=0,n=0,r=0;const i=e[0];for(let e=0,o=i.length,s=o-1;e<o;s=e++){const o=i[e],a=i[s],l=o.x*a.y-a.x*o.y;n+=(o.x+a.x)*l,r+=(o.y+a.y)*l,t+=3*l}return new ay(n/t,r/t,0,e)}(e),d=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,n&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-h.d<=t||(c=r.h/2,u.push(new ay(r.p.x-c,r.p.y-c,c,e)),u.push(new ay(r.p.x+c,r.p.y-c,c,e)),u.push(new ay(r.p.x-c,r.p.y+c,c,e)),u.push(new ay(r.p.x+c,r.p.y+c,c,e)),d+=4)}return n&&(console.log(`num probes: ${d}`),console.log(`best distance: ${h.d}`)),h.p}function sy(e,t){return t.max-e.max}class ay{constructor(e,t,n,r){this.p=new v(e,t),this.h=n,this.d=function(e,t){let n=!1,r=1/0;for(let i=0;i<t.length;i++){const o=t[i];for(let t=0,i=o.length,s=i-1;t<i;s=t++){const i=o[t],a=o[s];i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(n=!n),r=Math.min(r,xp(e,i,a))}}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const ly=7,cy=Number.POSITIVE_INFINITY,uy=Math.sqrt(2);function hy(e,[t,n]){let r=0,i=0;if(n===cy){t<0&&(t=0);const n=t/uy;switch(e){case"top-right":case"top-left":i=n-ly;break;case"bottom-right":case"bottom-left":i=-n+ly;break;case"bottom":i=-t+ly;break;case"top":i=t-ly}switch(e){case"top-right":case"bottom-right":r=-n;break;case"top-left":case"bottom-left":r=n;break;case"left":r=t;break;case"right":r=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-ly;break;case"bottom-right":case"bottom-left":case"bottom":i=-n+ly}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}}return[r,i]}function dy(e,t,n,r,i,o,s,a,l,c,u){e.createArrays(),e.tilePixelRatio=ar/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const h=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:n}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new ea(t),a),d["text-size"].possiblyEvaluate(new ea(n),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:n}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new ea(t),a),d["icon-size"].possiblyEvaluate(new ea(n),a)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new ea(l+1),a),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new ea(l+1),a),p.textMaxSize=d["text-size"].possiblyEvaluate(new ea(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const t of e.features)if(t.icon&&t.icon.nameSecondary){g=!0;break}for(const o of e.features){const l=h.get("text-font").evaluate(o,{},a).join(","),d=m.evaluate(o,{},a),y=p.layoutTextSize.evaluate(o,{},a),v=(p.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),_=o.text;let x,b=[0,0];if(_){const r=_.toString(),s=h.get("text-letter-spacing").evaluate(o,{},a)*rg,c=h.get("text-line-height").evaluate(o,{},a)*rg,u=Ns(r)?s:0,p=h.get("text-anchor").evaluate(o,{},a),m=h.get("text-variable-anchor");if(!m){const e=h.get("text-radial-offset").evaluate(o,{},a);b=e?hy(p,[e*rg,cy]):h.get("text-offset").evaluate(o,{},a).map((e=>e*rg))}let g=f?"center":h.get("text-justify").evaluate(o,{},a);const x="point"===h.get("symbol-placement"),w=x?h.get("text-max-width").evaluate(o,{},a)*rg:1/0,S=o=>{e.allowVerticalPlacement&&Os(r)&&(v.vertical=Tg(_,t,n,i,l,w,c,p,o,u,b,wg.vertical,!0,y,d))};if(!f&&m){const e="auto"===g?m.map((e=>py(e))):[g];let r=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!v.horizontal[s])if(r)v.horizontal[s]=v.horizontal[0];else{const e=Tg(_,t,n,i,l,w,c,"center",s,u,b,wg.horizontal,!1,y,d);e&&(v.horizontal[s]=e,r=1===e.positionedLines.length)}}S("left")}else{if("auto"===g&&(g=py(p)),x||h.get("text-writing-mode").indexOf("horizontal")>=0||!Os(r)){const e=Tg(_,t,n,i,l,w,c,p,g,u,b,wg.horizontal,!1,y,d);e&&(v.horizontal[g]=e)}S(x?"left":g)}}let w=!1;if(o.icon&&o.icon.namePrimary){const t=r[o.icon.namePrimary];t&&(x=kg(i[o.icon.namePrimary],o.icon.nameSecondary?i[o.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(o,{},a),h.get("icon-anchor").evaluate(o,{},a)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&q("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const S=vy(v.horizontal)||v.vertical;e.iconsInText||(e.iconsInText=!!S&&S.iconsInText),(S||x)&&fy(e,o,v,x,r,p,y,0,b,w,s,a,c,u,g)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function py(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fy(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f){let m=o.textMaxSize.evaluate(t,{},h);void 0===m&&(m=s);const g=e.layers[0].layout,y=g.get("icon-offset").evaluate(t,{},h),v=vy(n.horizontal)||n.vertical,_="globe"===d.name,x=rg,b=s/x,S=e.tilePixelRatio*m/x,M=(L=e.overscaling,e.zoom>18&&L>2&&(L>>=1),Math.max(ar/(512*L),1)*g.get("symbol-spacing")),E=g.get("text-padding")*e.tilePixelRatio,T=g.get("icon-padding")*e.tilePixelRatio,C=w(g.get("text-max-angle")),A="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),I="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),P=g.get("symbol-placement"),R=M/2;var L;const D=g.get("icon-text-fit").evaluate(t,{},h),O=g.get("icon-text-fit-padding").evaluate(t,{},h),N="none"!==D;let k;!1===e.hasAnyIconTextFit&&N&&(e.hasAnyIconTextFit=!0),r&&N&&(e.allowVerticalPlacement&&n.vertical&&(k=Fg(r,n.vertical,D,O,y,b)),v&&(r=Fg(r,v,D,O,y,b)));const F=(s,a,m)=>{if(a.x<0||a.x>=ar||a.y<0||a.y>=ar)return;let g=null;if(_){const{x:e,y:t,z:n}=d.projectTilePoint(a.x,a.y,m);g={anchor:new zg(e,t,n,0,void 0),up:d.upVector(m,a.x,a.y)}}!function(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b,w,S,M,E,T){const C=e.addToLineVertexArray(t,r);let A,I,P,R,L,D,O,N=0,k=0,F=0,z=0,B=-1,U=-1;const j={};let V=wl("");const G=n?n.anchor:t,H="none"!==l.layout.get("icon-text-fit").evaluate(x,{},M);let Z=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[Z,W]=l.layout.get("text-offset").evaluate(x,{},M).map((e=>e*rg)):(Z=l.layout.get("text-radial-offset").evaluate(x,{},M)*rg,W=cy),e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(f)D=xy(e),a&&(O=xy(a));else{const n=l.layout.get("text-rotate").evaluate(x,{},M)+90;P=_y(c,G,t,u,h,d,e,p,n,m),a&&(R=_y(c,G,t,u,h,d,a,y,n))}}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{},M),i=Qg(o,r,w,H),s=a?Qg(a,r,w,H):void 0;I=_y(c,G,t,u,h,d,o,y,r),N=4*i.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[ig*l.layout.get("icon-size").evaluate(x,{},M)],f[0]>gy&&q(`${e.layerIds[0]}: Value for "icon-size" is >= ${my}. Reduce your "icon-size".`)):"composite"===p.kind&&(f=[ig*b.compositeIconSizes[0].evaluate(x,{},M),ig*b.compositeIconSizes[1].evaluate(x,{},M)],(f[0]>gy||f[1]>gy)&&q(`${e.layerIds[0]}: Value for "icon-size" is >= ${my}. Reduce your "icon-size".`)),e.addSymbols(e.icon,i,f,_,v,x,!1,n,t,C.lineStartIndex,C.lineLength,-1,S,M,E,T),B=e.icon.placedSymbolArray.length-1,s&&(k=4*s.length,e.addSymbols(e.icon,s,f,_,v,x,wg.vertical,n,t,C.lineStartIndex,C.lineLength,-1,S,M,E,T),U=e.icon.placedSymbolArray.length-1)}for(const r in i.horizontal){const o=i.horizontal[r];A||(V=wl(o.text),f?L=xy(o):A=_y(c,G,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(x,{},M),m));const a=1===o.positionedLines.length;if(F+=yy(e,n,t,o,s,l,f,x,m,C,i.vertical?wg.horizontal:wg.horizontalOnly,a?Object.keys(i.horizontal):[r],j,B,b,S,M,E),a)break}i.vertical&&(z+=yy(e,n,t,i.vertical,s,l,f,x,m,C,wg.vertical,["vertical"],j,U,b,S,M,E));let $=-1;const X=(e,t)=>e?Math.max(e,t):t;$=X(L,$),$=X(D,$),$=X(O,$);const Y=$>-1?1:0;e.glyphOffsetArray.length>=cv.MAX_GLYPHS&&q("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,B,U,V,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,R||e.collisionBoxArray.length,R?R+1:e.collisionBoxArray.length,u,F,z,N,k,Y,0,Z,W,$,0,H?1:0)}(e,a,g,s,n,r,i,k,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,E,A,l,0,T,I,y,t,o,c,u,h,p,f)};if("line"===P)for(const i of Wg(t.geometry,0,0,ar,ar)){const t=Hg(i,M,C,n.vertical||v,r,x,S,e.overscaling,ar);for(const n of t)v&&by(e,v.text,R,n)||F(i,n,h)}else if("line-center"===P){for(const e of t.geometry)if(e.length>1){const t=Gg(e,C,n.vertical||v,r,x,S);t&&F(e,t,h)}}else if("Polygon"===t.type)for(const e of Pf(t.geometry,0)){const t=oy(e,16);F(e[0],new zg(t.x,t.y,0,0,void 0),h)}else if("LineString"===t.type)for(const e of t.geometry)F(e,new zg(e[0].x,e[0].y,0,0,void 0),h);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)F([t],new zg(t.x,t.y,0,0,void 0),h)}const my=255,gy=my*ig;function yy(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=function(e,t,n,r,i,o,s,a){const l=[];if(0===t.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],n=e[1],r=t*n;return r>0?[t,-n]:r<0?[-t,n]:0===t?[n,t]:[n,-t]}(n);let h=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)h-=e.lineOffset;const d=t.positionedLines.length,p=h/d;let f=t.top-n[1];for(let e=0;e<d;++e){const r=t.positionedLines[e];f=iy(t,p,f,e);for(const e of r.positionedGlyphs){if(!e.rect)continue;const r=e.rect||{};let o=yg+1,h=!0,d=1,p=0;if(e.imageName){const t=s[e.imageName];if(!t)continue;if(t.sdf){q("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,d=t.pixelRatio,o=_g/d}const m=(i||a)&&e.vertical,g=e.metrics.advance*e.scale/2,y=e.metrics,_=e.rect;if(null===_)continue;a&&t.verticalizable&&(p=e.imageName?g-e.metrics.width*e.scale/2:0);const x=i?[e.x+g,e.y]:[0,0];let b=[0,0],w=[0,0],S=!1;i||(m?(w=[e.x+g+u[0],e.y+u[1]-p],S=!0):b=[e.x+g+n[0],e.y+n[1]-p]);const M=_.w*e.scale/(d*(e.localGlyph?Yg:1)),E=_.h*e.scale/(d*(e.localGlyph?Yg:1));let T,C,A,I;if(m){const t=e.y-f,n=new v(-g,g-t),r=-Math.PI/2,i=new v(...w);T=new v(-g+b[0],b[1]),T._rotateAround(r,n)._add(i),T.x+=-t+g,T.y-=(y.left-o)*e.scale;const s=e.imageName?y.advance*e.scale:rg*e.scale,a=String.fromCodePoint(e.glyph);hg(a)?T.x+=(1-o)*e.scale:dg(a)?T.x+=s-y.height*e.scale+(-o-1)*e.scale:T.x+=e.imageName||y.width+2*o===_.w&&y.height+2*o===_.h?(s-E)/2:(s-(y.height+2*o)*e.scale)/2,C=new v(T.x,T.y-M),A=new v(T.x+E,T.y),I=new v(T.x+E,T.y-M)}else{const t=(y.left-o)*e.scale-g+b[0],n=(-y.top-o)*e.scale+b[1],r=t+M,i=n+E;T=new v(t,n),C=new v(r,n),A=new v(t,i),I=new v(r,i)}if(c){let e;e=i?new v(0,0):S?new v(u[0],u[1]):new v(n[0],n[1]),T._rotateAround(c,e),C._rotateAround(c,e),A._rotateAround(c,e),I._rotateAround(c,e)}const P=new v(0,0),R=new v(0,0);l.push({tl:T,tr:C,bl:A,br:I,texPrimary:r,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:x,sectionIndex:e.sectionIndex,isSDF:h,pixelOffsetTL:P,pixelOffsetBR:R,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,i,e.allowVerticalPlacement),x=e.textSizeData;let b=null;"source"===x.kind?(b=[ig*o.layout.get("text-size").evaluate(a,{},g)],b[0]>gy&&q(`${e.layerIds[0]}: Value for "text-size" is >= ${my}. Reduce your "text-size".`)):"composite"===x.kind&&(b=[ig*f.compositeTextSizes[0].evaluate(a,{},g),ig*f.compositeTextSizes[1].evaluate(a,{},g)],(b[0]>gy||b[1]>gy)&&q(`${e.layerIds[0]}: Value for "text-size" is >= ${my}. Reduce your "text-size".`)),e.addSymbols(e.text,_,b,l,s,a,u,t,n,c.lineStartIndex,c.lineLength,p,m,g,y,!1);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function vy(e){for(const t in e)return e[t];return null}function _y(e,t,n,r,i,o,s,a,l,c){let u=s.top,h=s.bottom,d=s.left,p=s.right;const f=s.collisionPadding;if(f&&(d-=f[0],u-=f[1],p+=f[2],h+=f[3]),l){const e=new v(d,u),t=new v(p,u),n=new v(d,h),r=new v(p,h),i=w(l);let o=new v(0,0);c&&(o=new v(c[0],c[1])),e._rotateAround(i,o),t._rotateAround(i,o),n._rotateAround(i,o),r._rotateAround(i,o),d=Math.min(e.x,t.x,n.x,r.x),p=Math.max(e.x,t.x,n.x,r.x),u=Math.min(e.y,t.y,n.y,r.y),h=Math.max(e.y,t.y,n.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,d,u,p,h,a,r,i,o),e.length-1}function xy(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function by(e,t,n,r){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<n)return!0}else i[t]=[];return i[t].push(r),!1}function wy(e,t){const n=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),o=Math.sin(n)*i/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),s=Math.sin(e._pitch)*o+i;return Math.min(1.01*s,i*(1/e._horizonShift))}function Sy(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),r=e.x*n,i=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=Wd(r),l=Wd(i),c=$d(o),u=$d(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),y=Math.max(h.x,d.x,p.x,f.x),v=Math.max(h.y,d.y,p.y,f.y);const _=n/16;function x(e,n,r,i,o,s){const a=(r+o)/2,l=(i+s)/2,c=t.project(Wd(a),$d(l)),u=Math.max(0,m-c.x,g-c.y,c.x-y,c.y-v);m=Math.min(m,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),v=Math.max(v,c.y),u>_&&(x(e,c,r,i,a,l),x(c,n,a,l,o,s))}x(h,d,r,o,i,o),x(d,p,i,o,i,s),x(p,f,i,s,r,s),x(f,h,r,s,r,o),m-=_,g-=_,y+=_,v+=_;const b=1/Math.max(y-m,v-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:v*b,projection:t}}function My(e,t,n,r,i,o,s,a,l){if("globe"===l.name)return hd(e,t,new Nh(n,r,i),!1);const c=Sy({z:n,x:r,y:i},l);return new $h([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])}function Ey(e,{x:t,y:n},r=0){return new v(((t-r)*e.scale-e.x)*ar,(n*e.scale-e.y)*ar)}function Ty(e,t,n=0){return Eh.fromValues(((t.x-n)*e.scale-e.x)*ar,(t.y*e.scale-e.y)*ar,qd(t.z,t.y))}const Cy=_h.identity(new Float32Array(16));class Ay{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Bd(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return Zd(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return wy(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,r){const i=e.horizonLineFromTop(!1),o=new v(t,Math.max(i,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,r))}pointCoordinate3D(e,t,n){const r=new v(t,n);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return Cy}createTileMatrix(e,t,n){let r,i,o;const s=n.canonical,a=_h.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Sy(s,this);r=1,i=l.x+n.wrap*l.scale,o=l.y,_h.scale(a,a,[r/l.scale,r/l.scale,e.pixelsPerMeter/t])}else r=t/e.zoomScale(s.z),i=(s.x+Math.pow(2,s.z)*n.wrap)*r,o=s.y*r;return _h.translate(a,a,[i,o,0]),_h.scale(a,a,[r/ar,r/ar,1]),a}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Iy extends Ay{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(w(t));this.n=(r+Math.sin(w(n)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:r,r0:i}=this,o=w(e-this.center[0]),s=w(t),a=Math.sqrt(r-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-i,z:0}}unproject(e,t){const{n,c:r,r0:i}=this,o=i+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=w(this.center[0])*n;s=L(s,-Math.PI-a,Math.PI-a);const l=P(S(s/n)+this.center[0],-180,180),c=Math.asin(P((r-(e*e+o*o)*n*n)/(2*n),-1,1)),u=P(S(c),-Xd,Xd);return new Bd(l,u)}}const Py=1.340264,Ry=-.081106,Ly=893e-6,Dy=.003796,Oy=Math.sqrt(3)/2;class Ny extends Ay{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Oy*Math.sin(t)),r=n*n,i=r*r*r;return{x:.5*(e*Math.cos(n)/(Oy*(Py+3*Ry*r+i*(7*Ly+9*Dy*r)))/Math.PI+.5),y:1-.5*(n*(Py+Ry*r+i*(Ly+Dy*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,r=n*n,i=r*r*r;for(let e,o,s,a=0;a<12&&(o=n*(Py+Ry*r+i*(Ly+Dy*r))-t,s=Py+3*Ry*r+i*(7*Ly+9*Dy*r),e=o/s,n=P(n-e,-Math.PI/3,Math.PI/3),r=n*n,i=r*r*r,!(Math.abs(e)<1e-12));++a);const o=Oy*e*(Py+3*Ry*r+i*(7*Ly+9*Dy*r))/Math.cos(n),s=Math.asin(Math.sin(n)/Oy),a=P(180*o/Math.PI,-180,180),l=P(180*s/Math.PI,-Xd,Xd);return new Bd(a,l)}}class ky extends Ay{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),r=P(360*(.5-t),-Xd,Xd);return new Bd(n,r)}}const Fy=Math.PI/2;function zy(e){return Math.tan((Fy+e)/2)}class By extends Ay{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let r=w(t),i=w(n);this.southernCenter=r+i<0,this.southernCenter&&(r=-r,i=-i);const o=Math.cos(r),s=zy(r);this.n=r===i?Math.sin(r):Math.log(o/Math.cos(i))/Math.log(zy(i)/s),this.f=o*Math.pow(zy(r),this.n)/this.n}project(e,t){t=w(t),this.southernCenter&&(t=-t),e=w(e-this.center[0]);const n=1e-6,{n:r,f:i}=this;i>0?t<-Fy+n&&(t=-Fy+n):t>Fy-n&&(t=Fy-n);const o=i/Math.pow(zy(t),r);let s=o*Math.sin(r*e),a=i-o*Math.cos(r*e);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n,f:r}=this,i=r-t,o=Math.sign(i),s=Math.sign(n)*Math.sqrt(e*e+i*i);let a=Math.atan2(e,Math.abs(i))*o;i*n<0&&(a-=Math.PI*Math.sign(e)*o);const l=P(S(a/n)+this.center[0],-180,180),c=P(S(2*Math.atan(Math.pow(r/s,1/n))-Fy),-Xd,Xd);return new Bd(l,this.southernCenter?-c:c)}}class Uy extends Ay{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Gd(e),y:Hd(t),z:0}}unproject(e,t){const n=Wd(e),r=$d(t);return new Bd(n,r)}}const jy=w(Xd);class Vy extends Ay{project(e,t){const n=(t=w(t))*t,r=n*n;return{x:.5*((e=w(e))*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,r=25,i=0,o=n*n;do{o=n*n;const e=o*o;i=(n*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),n=P(n-i,-jy,jy)}while(Math.abs(i)>1e-6&&--r>0);o=n*n;const s=P(S(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=S(n);return new Bd(s,a)}}const Gy=w(Xd);class Hy extends Ay{project(e,t){t=w(t),e=w(e);const n=Math.cos(t),r=2/Math.PI,i=Math.acos(n*Math.cos(e/2)),o=Math.sin(i)/i,s=.5*(e*r+2*n*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,i=25;const o=1e-6;let s=0,a=0;do{const i=Math.cos(r),o=Math.sin(r),l=2*o*i,c=o*o,u=i*i,h=Math.cos(n/2),d=Math.sin(n/2),p=2*h*d,f=d*d,m=1-u*h*h,g=m?1/m:0,y=m?Math.acos(i*h)*Math.sqrt(1/m):0,v=.5*(2*y*i*d+2*n/Math.PI)-e,_=.5*(y*o+r)-t,x=.5*g*(u*f+y*i*h*c)+1/Math.PI,b=g*(p*l/4-y*o*d),w=.125*g*(l*d-y*o*u*p),S=.5*g*(c*h+y*f*i)+.5,M=b*w-S*x;s=(_*b-v*S)/M,a=(v*w-_*x)/M,n=P(n-s,-Math.PI,Math.PI),r=P(r-a,-Gy,Gy)}while((Math.abs(s)>o||Math.abs(a)>o)&&--i>0);return new Bd(S(n),S(r))}}class Zy extends Ay{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(w(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:r}=this;return{x:w(e)*r*n+.5,y:-Math.sin(w(t))/r*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:r}=this,i=-(t-.5)/n,o=P(S((e-.5)/n)/r,-180,180),s=Math.asin(P(i*r,-1,1)),a=P(S(s),-Xd,Xd);return new Bd(o,a)}}class Wy extends Uy{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const r=gd(e,t,n),i=_d(ad(n));return Eh.transformMat4(r,r,i),{x:r[0],y:r[1],z:r[2]}}locationPoint(e,t){const n=md(t.lat,t.lng),r=Eh.normalize([],n),i=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,o=Zd(1,0)*ar*i;Eh.scaleAndAdd(n,n,r,o);const s=_h.identity(new Float64Array(16));return _h.multiply(s,e.pixelMatrix,e.globeMatrix),Eh.transformMat4(n,n,s),new v(n[0],n[1])}pixelsPerMeter(e,t){return Zd(1,0)*t}pixelSpaceConversion(e,t,n){const r=Zd(1,e)*t,i=Xr(Zd(1,45)*t,r,n);return this.pixelsPerMeter(e,t)/i}createTileMatrix(e,t,n){const r=xd(ad(n.canonical));return _h.multiply(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,t){const{center:n}=e,r=_d(ad(t));return _h.rotateY(r,r,w(n.lng)),_h.rotateX(r,r,w(n.lat)),_h.scale(r,r,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,t,n,r){return id(e,t,n,!0)||new ep(0,0)}pointCoordinate3D(e,t,n){const r=this.pointCoordinate(e,t,n,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!id(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const n=e.cameraToCenterDistance,r=e._centerAltitude*t,i=e._camera,o=e._camera.forward(),s=Eh.add([],Eh.scale([],o,-n),[0,0,r]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Eh.scale([],i.up(),u),d=Eh.scale([],i.right(),u*c),p=Eh.normalize([],Eh.add([],Eh.add([],o,h),d)),f=[];let m;if(new Uh(s,p).closestPointOnSphere(l,a,f)){const t=Eh.add([],f,l),n=Eh.sub([],t,s);m=Math.cos(e.fovAboveCenter)*Eh.length(n)}else{const e=Eh.sub([],s,l),t=Eh.sub([],l,s);Eh.normalize(t,t);const n=Eh.length(e)-a;m=Math.sqrt(n*(n+2*a));const r=Math.acos(m/(a+n))-Math.acos(Eh.dot(o,t));m*=Math.cos(r)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Md(e.zoom);if(n>0){const r=wy(e,Zd(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Xr(t,r+i*(1-Math.cos(o)),Math.pow(n,10))}return t}upVector(e,t,n){return gd(t,n,e,1)}upVectorScale(e){return{metersToTile:rd(yd(ad(e)))}}}function $y(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Uy(e);case"equirectangular":return new ky(e);case"naturalEarth":return new Vy(e);case"equalEarth":return new Ny(e);case"winkelTripel":return new Hy(e);case"albers":return n?new Zy(e):new Iy(e);case"lambertConformalConic":return n?new Zy(e):new By(e);case"globe":return new Wy(e)}throw new Error(`Invalid projection name: ${e.name}`)}const qy=new da({"symbol-placement":new ca(It.layout_symbol["symbol-placement"]),"symbol-spacing":new ca(It.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ca(It.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ua(It.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ca(It.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ca(It.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ca(It.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ca(It.layout_symbol["icon-ignore-placement"]),"icon-optional":new ca(It.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ca(It.layout_symbol["icon-rotation-alignment"]),"icon-size":new ua(It.layout_symbol["icon-size"]),"icon-text-fit":new ua(It.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ua(It.layout_symbol["icon-text-fit-padding"]),"icon-image":new ua(It.layout_symbol["icon-image"]),"icon-rotate":new ua(It.layout_symbol["icon-rotate"]),"icon-padding":new ca(It.layout_symbol["icon-padding"]),"icon-keep-upright":new ca(It.layout_symbol["icon-keep-upright"]),"icon-offset":new ua(It.layout_symbol["icon-offset"]),"icon-anchor":new ua(It.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ca(It.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ca(It.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ca(It.layout_symbol["text-rotation-alignment"]),"text-field":new ua(It.layout_symbol["text-field"]),"text-font":new ua(It.layout_symbol["text-font"]),"text-size":new ua(It.layout_symbol["text-size"]),"text-max-width":new ua(It.layout_symbol["text-max-width"]),"text-line-height":new ua(It.layout_symbol["text-line-height"]),"text-letter-spacing":new ua(It.layout_symbol["text-letter-spacing"]),"text-justify":new ua(It.layout_symbol["text-justify"]),"text-radial-offset":new ua(It.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ca(It.layout_symbol["text-variable-anchor"]),"text-anchor":new ua(It.layout_symbol["text-anchor"]),"text-max-angle":new ca(It.layout_symbol["text-max-angle"]),"text-writing-mode":new ca(It.layout_symbol["text-writing-mode"]),"text-rotate":new ua(It.layout_symbol["text-rotate"]),"text-padding":new ca(It.layout_symbol["text-padding"]),"text-keep-upright":new ca(It.layout_symbol["text-keep-upright"]),"text-transform":new ua(It.layout_symbol["text-transform"]),"text-offset":new ua(It.layout_symbol["text-offset"]),"text-allow-overlap":new ca(It.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ca(It.layout_symbol["text-ignore-placement"]),"text-optional":new ca(It.layout_symbol["text-optional"]),visibility:new ca(It.layout_symbol.visibility)});var Xy={paint:new da({"icon-opacity":new ua(It.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ua(It.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ua(It.paint_symbol["text-emissive-strength"]),"icon-color":new ua(It.paint_symbol["icon-color"]),"icon-halo-color":new ua(It.paint_symbol["icon-halo-color"]),"icon-halo-width":new ua(It.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ua(It.paint_symbol["icon-halo-blur"]),"icon-translate":new ca(It.paint_symbol["icon-translate"]),"icon-translate-anchor":new ca(It.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ua(It.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ua(It.paint_symbol["text-opacity"]),"text-color":new ua(It.paint_symbol["text-color"],{runtimeType:Gt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new ua(It.paint_symbol["text-halo-color"]),"text-halo-width":new ua(It.paint_symbol["text-halo-width"]),"text-halo-blur":new ua(It.paint_symbol["text-halo-blur"]),"text-translate":new ca(It.paint_symbol["text-translate"]),"text-translate-anchor":new ca(It.paint_symbol["text-translate-anchor"])}),layout:qy};class Yy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Bt,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}As(Yy,"FormatSectionOverride",{omit:["defaultValue"]});class Ky extends ga{constructor(e,t){super(e,Xy,t)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const e=[];for(const t of n)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,r){const i=this.layout.get(e).evaluate(t,{},n,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||vo(o.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>n in e?String(e[n]):""))}(t.properties,i)}createBucket(e){return new cv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Xy.paint.overridableProperties){if(!Ky.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Yy(t),r=new yo(n,t.property.specification);let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new xo("source",r):new bo("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new aa(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&Ky.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),r=Xy.paint.properties[t];let i=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof dn)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{i||(t instanceof _n&&gn(t.value)===$t?o(t.value.sections):t instanceof Mn?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),n=[];return e&&n.push("symbolIcon"),t&&n.push("symbolSDF"),n}getDefaultProgramParams(e,t){return{config:new Wl(this,t),overrideFog:!1}}}const Jy=nm.types,Qy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ev(e,t,n,r,i,o,s,a,l,c,u,h,d){const p=a?Math.min(gy,Math.round(a[0])):0,f=a?Math.min(gy,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function tv(e,t,n){e.emplaceBack(t,n)}function nv(e,t,n,r,i,o,s){e.emplaceBack(t,n,r,i,o,s)}function rv(e,t,n,r,i){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=r,e.float32[o+2]=i}function iv(e,t,n,r,i){e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i)}function ov(e){for(const t of e.sections)if(js(t.text))return!0;return!1}class sv{constructor(e){this.layoutVertexArray=new La,this.indexArray=new ja,this.programConfigurations=e,this.segments=new dl,this.dynamicLayoutVertexArray=new Aa,this.opacityVertexArray=new Oa,this.placedSymbolArray=new nl,this.iconTransitioningVertexArray=new Na,this.globeExtVertexArray=new Da,this.zOffsetVertexArray=new Ha}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,n,r,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ym.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Qy,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Jm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Xm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Km.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}As(sv,"SymbolBuffers");class av{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new dl,this.collisionVertexArray=new Ba,this.collisionVertexArrayExt=new Ua}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,eg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}As(av,"CollisionBuffers");class lv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_h.identity([]),this.placementViewportMatrix=_h.identity([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=og(this.zoom,t["text-size"]),this.iconSizeData=og(this.zoom,t["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((e=>wg[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new sv(new $l(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new sv(new $l(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ol,this.lineVertexArray=new sl,this.symbolInstances=new il}calculateGlyphDependencies(e,t,n,r,i){for(let n=0;n<e.length;n++){const o=e.codePointAt(n);if(void 0===o)break;if(t[o]=!0,r&&i&&o<=65535){const r=ug[e.charAt(n)];r&&(t[r.charCodeAt(0)]=!0)}}}populate(e,t,n,r){const i=this.layers[0],o=i.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof dn&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new ea(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:y}of e){const e=i._featureFilter.needGeometry,v=cp(t,e);if(!i._featureFilter.filter(g,v,n))continue;if(e||(v.geometry=lp(t,n,r)),s&&1!==t.type&&n.z<=5){const e=v.geometry,t=.98078528056,r=(e,r)=>{const i=gd(e.x,e.y,n,1),o=gd(r.x,r.y,n,1);return Eh.dot(i,o)<t};for(let t=0;t<e.length;t++)e[t]=ip(e[t],r)}let _,x;if(u){const e=i.getValueAndResolveTokens("text-field",v,n,m),t=dn.factory(e);ov(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ks()||this.hasRTLText&&Qs.isParsed())&&(_=cg(t,i,v))}if(h){const e=i.getValueAndResolveTokens("icon-image",v,n,m);x=e instanceof pn?e:pn.fromString(e)}if(!_&&!x)continue;const b=this.sortFeaturesByKey?d.evaluate(v,{},n):void 0;if(this.features.push({id:l,text:_,icon:x,index:c,sourceLayerIndex:y,geometry:v.geometry,properties:t.properties,type:Jy[t.type],sortKey:b}),x&&(p[x.namePrimary]=!0,x.nameSecondary&&(p[x.nameSecondary]=!0)),_){const e=a.evaluate(v,{},n).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wg.vertical)>=0;for(const n of _.sections)if(n.image)p[n.image.namePrimary]=!0;else{const r=Os(_.toString()),i=n.fontStack||e,o=f[i]=f[i]||{};this.calculateGlyphDependencies(n.text,o,t,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},r=[];let i=0;function o(t){r.push(e[t]),i++}function s(e,t,i){const o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function a(e,n,i){const o=t[n];return delete t[n],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function l(e,t,n){const r=n?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=a(p,f,h),i=s(p,f,r[e].geometry);delete t[p],delete n[f],n[l(d,r[i].geometry,!0)]=i,r[e].geometry=null}else p in n?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=i-1,n[f]=i-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n,r,i){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,s,n,r,i),this.icon.programConfigurations.updatePaintArrays(e,t,s,n,r,i)}updateZOffset(){const e=(e,t,r)=>{n+=t,n>e.length&&e.resize(n);for(let i=-t;i<0;i++)e.emplace(i+n,r)},t=(e,t,n)=>{r+=t,r>e.length&&e.resize(r);for(let i=-t;i<0;i++)e.emplace(i+r,n)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,r=0;for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:o,numIconVertices:s}=r,a=r.zOffset,l=s>0;if((i>0||o>0)&&(e(this.text.zOffsetVertexArray,i,a),e(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:n}=r;e>=0&&t(this.icon.zOffsetVertexArray,s,a),n>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$y(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:n}of t)this.lineVertexArray.emplaceBack(e,n);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=e.indexArray,y=e.layoutVertexArray,v=e.globeExtVertexArray,_=e.segments.prepareSegment(4*t.length,y,g,this.canOverlap?o.sortKey:void 0),x=this.glyphOffsetArray.length,b=_.vertexLength,w=this.allowVerticalPlacement&&s===wg.vertical?Math.PI/2:0,S=o.text&&o.text.sections;for(let r=0;r<t.length;r++){const{tl:i,tr:s,bl:c,br:u,texPrimary:h,texSecondary:x,pixelOffsetTL:b,pixelOffsetBR:M,minFontScaleX:E,minFontScaleY:T,glyphOffset:C,isSDF:A,sectionIndex:I}=t[r],P=_.vertexLength,R=C[1];if(ev(y,l.x,l.y,i.x,R+i.y,h.x,h.y,n,A,b.x,b.y,E,T),ev(y,l.x,l.y,s.x,R+s.y,h.x+h.w,h.y,n,A,M.x,b.y,E,T),ev(y,l.x,l.y,c.x,R+c.y,h.x,h.y+h.h,n,A,b.x,M.y,E,T),ev(y,l.x,l.y,u.x,R+u.y,h.x+h.w,h.y+h.h,n,A,M.x,M.y,E,T),a){const{x:t,y:n,z:r}=a.anchor,[i,o,s]=a.up;nv(v,t,n,r,i,o,s),nv(v,t,n,r,i,o,s),nv(v,t,n,r,i,o,s),nv(v,t,n,r,i,o,s),iv(e.dynamicLayoutVertexArray,t,n,r,w)}else iv(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=x||h;tv(e.iconTransitioningVertexArray,t.x,t.y),tv(e.iconTransitioningVertexArray,t.x+t.w,t.y),tv(e.iconTransitioningVertexArray,t.x,t.y+t.h),tv(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(P,P+1,P+2),g.emplaceBack(P+1,P+2,P+3),_.vertexLength+=4,_.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(C[0]),r!==t.length-1&&I===t[r+1].sectionIndex||e.programConfigurations.populatePaintArrays(y.length,o,o.index,{},d,p,f,S&&S[I])}const M=a?a.anchor:l;e.placedSymbolArray.emplaceBack(M.x,M.y,M.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,r,i,o,s){e.emplaceBack(t,n,r,i,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,n,r,i,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let e=0;e<4;e++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new v(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new v(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new v(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,r,i,o,c,u,new v(e.x1,e.y2)),a.vertexLength+=4;const h=n.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(r,i,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,i,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new av(Fa,tg.members,Na),this.iconCollisionBox=new av(Fa,tg.members,Na);const n=ag(this.iconSizeData,e),r=ag(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(r,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,n,r){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),o=sg(this.textSizeData,e,i)/rg;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,n){const r=this.icon.placedSymbolArray.get(n),i=sg(this.iconSizeData,e,r);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,r.padding)}}_updateIconDebugCollisionBoxes(e,t,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,r.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=ag(this.iconSizeData,e),r=ag(this.textSizeData,e);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(r,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,r,i,o,s,a,l){const c={};if(t<n){const{x1:n,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:n,y1:r,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.textFeatureIndex=p}if(r<i){const{x1:t,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(r);c.verticalTextBox={x1:t,y1:n,x2:i,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(o<s){const{x1:t,y1:n,x2:r,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(o);c.iconBox={x1:t,y1:n,x2:r,y2:i,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:n,x2:r,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:n,x2:r,y2:i,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs;for(let t=n.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),r=[],i=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);r.push(0|Math.round(t*s.tileAnchorX+n*s.tileAnchorY)),i.push(s.featureIndex)}return o.sort(((e,t)=>r[e]-r[t]||i[t]-i[e])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=t;n>=0&&this.addIndicesForPlacedSymbol(this.text,n),r>=0&&r!==n&&this.addIndicesForPlacedSymbol(this.text,r),i>=0&&i!==r&&i!==n&&this.addIndicesForPlacedSymbol(this.text,i),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}As(lv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lv.MAX_GLYPHS=65535,lv.addDynamicAttributes=iv;var cv=lv;const uv=ba([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:hv}=uv,dv=ba([{name:"a_packed",components:4,type:"Float32"}]),{members:pv}=dv,fv=nm.types,mv=Math.cos(Math.PI/180*37.5);class gv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ca,this.layoutVertexArray2=new Aa,this.indexArray=new ja,this.programConfigurations=new $l(e.layers,e.zoom),this.segments=new dl,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n,r){this.hasPattern=Lf("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=cp(t,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),c,n))continue;const u=i?i.evaluate(c,{},n):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:lp(t,n,r),patterns:{},sortKey:u};o.push(h)}i&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const r of o){const{geometry:i,index:o,sourceLayerIndex:c}=r;if(l&&this.addFeatureDashes(r,s),this.hasPattern){const e=Df("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,i,o,n,s.positions,t.availableImages,t.brightness);a.insert(e[o].feature,i,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,i=n.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==i.kind)t=!0;else{const t=i.value,n=r.value;if(!n)continue;e.addDash(n,t)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let s,a;if("constant"===i.kind){if(s=i.value,!s)continue}else s=i.evaluate({zoom:n},e);a="constant"===o.kind?o.value:o.evaluate({zoom:n},e),t.addDash(s,a),e.patterns[r.id]=t.getKey(s,a)}}update(e,t,n,r,i){const o=0!==Object.keys(e).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,o?this.stateDependentLayers:this.layers,n,r,i)}addFeatures(e,t,n,r,i,o){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,pv)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,r,i,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(e,{}),c=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const n of t)this.addLine(n,e,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,o,r,s)}addLine(e,t,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===fv[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(i=1.05);const c=this.overscaling<=16?15*ar/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?s?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,v=g.x*m.x+g.y*m.y,_=0!==v?1/v:1/0,x=2*Math.sqrt(2-2*v),b=v<mv&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const S=d&&p;let M=S?n:s?"butt":r;if(S&&"round"===M&&(_<o?M="miter":_<=2&&(M="fakeround")),"miter"===M&&_>i&&(M="bevel"),"bevel"===M&&(_>2&&(M="flipbevel"),_<i&&(M="miter")),d&&this.updateDistance(d,h),"miter"===M)g._mult(_),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===M){if(_>100)g=m.mult(-1);else{const e=_*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===M||"fakeround"===M){const e=-Math.sqrt(_*_-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===M){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const r=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,r.x,r.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===M)this.addCurrentVertex(h,g,0,0,u);else if("square"===M){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===M&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,r,i,o=!1){const s=t.y*r-t.x,a=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,i),this.addHalfVertex(e,s,a,o,!0,-r,i)}addHalfVertex({x:e,y:t},n,r,i,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}As(gv,"LineBucket",{omit:["layers","patternFeatures"]});class yv{constructor(e,t,n,r){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,n,r){const{width:i,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!n||!1!==n.premultiply)),r||this.size&&this.size[0]===i&&this.size[1]===o){const{x:t,y:n}=r||{x:0,y:0};if(e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d)a.texSubImage2D(a.TEXTURE_2D,0,t,n,a.RGBA,a.UNSIGNED_BYTE,e);else{let r=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(r=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,t,n,i,o,r,s,e.data)}}else if(this.size=[i,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d){let t=this.format;this.format===a.R8&&(t=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,t,a.UNSIGNED_BYTE,e)}else{let t=this.format,n=this.format,r=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(t=a.DEPTH_COMPONENT16,r=a.UNSIGNED_SHORT),this.format===a.R32F&&(r=a.FLOAT,n=a.RED),a.texImage2D(a.TEXTURE_2D,0,t,i,o,0,n,r,e.data)}this.useMipmap=Boolean(n&&n.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,n,r){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,n),this.wrapS=n),r!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class vv{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}}const _v=32,xv=33,bv=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,r=0,i=0,o=0,s=0,a=0;for(1&t?i=o=s=_v:n=r=a=_v;(t>>=1)>1;){const e=n+i>>1,l=r+o>>1;1&t?(i=n,o=r,n=s,r=a):(n=i,r=o,i=s,o=a),s=e,a=l}const l=4*e;bv[l+0]=n,bv[l+1]=r,bv[l+2]=i,bv[l+3]=o}const wv=new Uint16Array(2178),Sv=new Uint8Array(1089),Mv=new Uint16Array(1089);function Ev(e){return 0===e?-.03125:32===e?.03125:0}var Tv=ba([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Cv={type:2,extent:ar,loadGeometry:()=>[[new v(0,0),new v(ar+1,0),new v(ar+1,ar+1),new v(0,ar+1),new v(0,0)]]};class Av{constructor(e,t,n,r,i){this.tileID=e,this.uid=z(),this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<ut.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Sy(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.fqid]=r}}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof cv){if(this.hasSymbolBuckets=!0,!n)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof cv&&t.hasRTLText){this.hasRTLText=!0,Qs.isLoading()||Qs.isLoaded()||"deferred"!==Ks()||Js();break}}this.queryPadding=0;for(const e in this.buckets){const n=this.buckets[e],r=t.style.getOwnLayer(e);if(!r)continue;const i=r.queryRadius(n);this.queryPadding=Math.max(this.queryPadding,i)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new el}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yv(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yv(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new yv(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,t,n){if(this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,n),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=t.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,n,r,i,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:i,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),i=t?t.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(!o)return;const s=Do(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let t=0;t<o.length;t++){const r=o.feature(t);if(s.needGeometry){const e=cp(r,!0);if(!s.filter(new ea(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new ea(this.tileID.overscaledZ),r))continue;const h=n.getId(r,i),d=new Im(r,a,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=ee(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let n=!1;if(this.expirationTime>e)n=!1;else if(t)if(this.expirationTime<t)n=!0;else{const r=this.expirationTime-t;r?this.expirationTime=e+Math.max(r,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(e,t){if(!this.latestFeatureIndex)return;const n=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages(),i=t.style.getBrightness();for(const o in this.buckets){if(!t.style.hasLayer(o))continue;const s=this.buckets[o],a=s.layers[0].sourceLayer||"_geojsonTileLayer",l=n[a];let c={};if(e&&(c=e[a],!l||!c||0===Object.keys(c).length))continue;if(s.update(c,l,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},i),s instanceof gv||s instanceof Of){const e=t.style.getOwnSourceCache(s.layers[0].source);t._terrain&&t._terrain.enabled&&e&&s.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=t&&t.style&&t.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ut.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ut.now()+e}setTexture(e,t){const n=t.context,r=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new yv(n,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const e of t)n[e]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const n=lp(Cv,this.tileID.canonical,this.tileTransform)[0],r=new Sa,i=new qa;for(let e=0;e<n.length;e++){const{x:t,y:o}=n[e];r.emplaceBack(t,o),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(r,Lh.members),this._tileDebugSegments=dl.simpleSegment(0,0,r.length,i.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const n=lp(Cv,this.tileID.canonical,this.tileTransform)[0];let r,i;if(this.isRaster){const e=function(e,t){const n=Sy(e,t),r=Math.pow(2,e.z);for(let i=0;i<xv;i++)for(let o=0;o<xv;o++){const s=Wd((e.x+(o+Ev(o))/_v)/r),a=$d((e.y+(i+Ev(i))/_v)/r),l=t.project(s,a),c=i*xv+o;wv[2*c+0]=Math.round((l.x*n.scale-n.x)*ar),wv[2*c+1]=Math.round((l.y*n.scale-n.y)*ar)}Sv.fill(0),Mv.fill(0);for(let e=2045;e>=0;e--){const t=4*e,n=bv[t+0],r=bv[t+1],i=bv[t+2],o=bv[t+3],s=n+i>>1,a=r+o>>1,l=s+a-r,c=a+n-s,u=r*xv+n,h=o*xv+i,d=a*xv+s,p=Math.hypot((wv[2*u+0]+wv[2*h+0])/2-wv[2*d+0],(wv[2*u+1]+wv[2*h+1])/2-wv[2*d+1])>=16;Sv[d]=Sv[d]||(p?1:0),e<1022&&(Sv[d]=Sv[d]||Sv[(r+c>>1)*xv+(n+l>>1)]||Sv[(o+c>>1)*xv+(i+l>>1)])}const i=new Ea,o=new ja;let s=0;function a(e,t){const n=t*xv+e;return 0===Mv[n]&&(i.emplaceBack(wv[2*n+0],wv[2*n+1],e*ar/_v,t*ar/_v),Mv[n]=++s),Mv[n]-1}function l(e,t,n,r,i,s){const c=e+n>>1,u=t+r>>1;if(Math.abs(e-i)+Math.abs(t-s)>1&&Sv[u*xv+c])l(i,s,e,t,c,u),l(n,r,i,s,c,u);else{const l=a(e,t),c=a(n,r),u=a(i,s);o.emplaceBack(l,c,u)}}return l(0,0,_v,_v,_v,0),l(_v,_v,0,0,0,_v),{vertices:i,indices:o}}(this.tileID.canonical,t);r=e.vertices,i=e.indices}else{r=new Ea,i=new ja;for(const{x:e,y:t}of n)r.emplaceBack(e,t,0,0);const e=If(r.int16,void 0,4);for(let t=0;t<e.length;t+=3)i.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,Tv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(i),this._tileBoundsSegments=dl.simpleSegment(0,0,r.length,i.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||"globe"!==n.name||t.freezeTileCoverage)return;const r=this.tileID.canonical,i=_d(cd(r,t)),o=Md(t.zoom);let s;o>0&&(s=_h.invert(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,r,t,i,s,o),this._makeGlobeTileDebugTextBuffer(e,r,t,i,s,o)}_globePoint(e,t,n,r,i,o,s){let a=gd(e,t,n);if(o){const i=1<<n.z,l=Gd(r.center.lng),c=Hd(r.center.lat),u=(n.x+.5)/i-l;let h=0;u>.5?h=-1:u<-.5&&(h=1);let d=(e/ar+n.x)/i+h,p=(t/ar+n.y)/i;d=(d-l)*r._pixelsPerMercatorPixel+l,p=(p-c)*r._pixelsPerMercatorPixel+c;const f=[d*r.worldSize,p*r.worldSize,0];Eh.transformMat4(f,f,o),a=ld(a,f,s)}return Eh.transformMat4(a,a,i)}_makeGlobeTileDebugBorderBuffer(e,t,n,r,i,o){const s=new Sa,a=new qa,l=new Ma,c=(e,c,u,h,d)=>{const p=(u-e)/(d-1),f=(h-c)/(d-1),m=s.length;for(let u=0;u<d;u++){const h=e+u*p,d=c+u*f;s.emplaceBack(h,d);const g=this._globePoint(h,d,t,n,r,i,o);l.emplaceBack(g[0],g[1],g[2]),a.emplaceBack(m+u)}},u=ar;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(a),this._tileDebugBuffer=e.createVertexBuffer(s,Lh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Rh.members),this._tileDebugSegments=dl.simpleSegment(0,0,s.length,a.length)}_makeGlobeTileDebugTextBuffer(e,t,n,r,i,o){const s=ar/4,a=new Sa,l=new ja,c=new Ma,u=25;l.reserve(32),a.reserve(u),c.reserve(u);const h=(e,t)=>u*e+t;for(let e=0;e<u;e++){const l=e*s;for(let e=0;e<u;e++){const u=e*s;a.emplaceBack(u,l);const h=this._globePoint(u,l,t,n,r,i,o);c.emplaceBack(h[0],h[1],h[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const n=h(e,t),r=h(e,t+1),i=h(e+1,t),o=h(e+1,t+1);l.emplaceBack(n,r,i),l.emplaceBack(i,r,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(a,Lh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(c,Rh.members),this._tileDebugTextSegments=dl.simpleSegment(0,0,u,32)}}class Iv{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:t,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout((()=>{this.remove(e,i)}),n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const r of this.data[n])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class Pv{constructor(e,t,n,r){this.id=Pv.uniqueIdxCounter,Pv.uniqueIdxCounter++,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Pv.uniqueIdxCounter,Pv.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Pv.uniqueIdxCounter=0;const Rv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lv{constructor(e,t,n,r,i,o){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o,this.context=e;const s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],o=t.attributes[i.name];void 0!==o&&e.vertexAttribPointer(o,i.components,e[Rv[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(e,t,n){for(let r=0;r<this.attributes.length;r++){const i=t.attributes[this.attributes[r].name];void 0!==i&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(i,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dv{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ov extends Dv{getDefault(){return cn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Nv extends Dv{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class kv extends Dv{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Fv extends Dv{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zv extends Dv{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Bv extends Dv{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Uv extends Dv{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class jv extends Dv{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Vv extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Gv extends Dv{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Hv extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Zv extends Dv{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Wv extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class $v extends Dv{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class qv extends Dv{getDefault(){return cn.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Xv extends Dv{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Yv extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Kv extends Dv{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Jv extends Dv{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Qv=class extends Dv{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class e_ extends Dv{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class t_ extends Dv{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class n_ extends Dv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class r_ extends Dv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class i_ extends Dv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class o_ extends Dv{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class s_ extends Dv{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class a_ extends Dv{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class l_ extends Dv{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class c_ extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class u_ extends Dv{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class h_ extends Dv{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class d_ extends h_{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class p_ extends h_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class f_ extends h_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class m_ extends p_{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class g_{constructor(e,t,n,r,i){this.context=e,this.width=t,this.height=n;const o=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new d_(e,o)),i&&(this.depthAttachmentType=i,this.depthAttachment="renderbuffer"===i?new p_(e,o):new f_(e,o))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class y_{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}y_.ReadOnly=!1,y_.ReadWrite=!0,y_.disabled=new y_(519,y_.ReadOnly,[0,1]);const v_=7680;class __{constructor(e,t,n,r,i,o){this.test=e,this.ref=t,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o}}__.disabled=new __({func:519,mask:0},0,0,v_,v_,v_);const x_=771;class b_{constructor(e,t,n,r){this.blendFunction=e,this.blendColor=t,this.mask=n,this.blendEquation=r}}b_.Replace=[1,0,1,0],b_.disabled=new b_(b_.Replace,cn.transparent,[!1,!1,!1,!1]),b_.unblended=new b_(b_.Replace,cn.transparent,[!0,!0,!0,!0]),b_.alphaBlended=new b_([1,x_,1,x_],cn.transparent,[!0,!0,!0,!0]),b_.multiply=new b_([774,0,774,0],cn.transparent,[!0,!0,!0,!0]);const w_=1029,S_=2305;class M_{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}M_.disabled=new M_(!1,w_,S_),M_.backCCW=new M_(!0,w_,S_),M_.backCW=new M_(!0,w_,2304),M_.frontCW=new M_(!0,1028,2304),M_.frontCCW=new M_(!0,1028,S_);class E_{constructor(e){this.gl=e,this.clearColor=new Ov(this),this.clearDepth=new Nv(this),this.clearStencil=new kv(this),this.colorMask=new Fv(this),this.depthMask=new zv(this),this.stencilMask=new Bv(this),this.stencilFunc=new Uv(this),this.stencilOp=new jv(this),this.stencilTest=new Vv(this),this.depthRange=new Gv(this),this.depthTest=new Hv(this),this.depthFunc=new Zv(this),this.blend=new Wv(this),this.blendFunc=new $v(this),this.blendColor=new qv(this),this.blendEquation=new Xv(this),this.cullFace=new Yv(this),this.cullFaceSide=new Kv(this),this.frontFace=new Jv(this),this.program=new Qv(this),this.activeTexture=new e_(this),this.viewport=new t_(this),this.bindFramebuffer=new n_(this),this.bindRenderbuffer=new r_(this),this.bindTexture=new i_(this),this.bindVertexBuffer=new o_(this),this.bindElementBuffer=new s_(this),this.bindVertexArrayOES=new a_(this),this.pixelStoreUnpack=new l_(this),this.pixelStoreUnpackPremultiplyAlpha=new c_(this),this.pixelStoreUnpackFlipY=new u_(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,n){return new Pv(this,e,t,n)}createVertexBuffer(e,t,n,r,i){return new Lv(this,e,t,n,r,i)}createRenderbuffer(e,t,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,n,r){return new g_(this,e,t,n,r)}clear({color:e,depth:t,stencil:n,colorMask:r}){const i=this.gl;let o=0;e&&(o|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==t&&(o|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(o|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){_(e.blendFunction,b_.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class T_ extends At{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Iv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return O(this._tiles).map((e=>e.tileID)).sort(C_).map((e=>e.key))}getRenderableIds(e,t){const n=[];for(const r in this._tiles)this._isIdRenderable(+r,e,t)&&n.push(this._tiles[r]);return e?n.sort(((e,t)=>{const n=e.tileID,r=t.tileID,i=new v(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new v(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-r.overscaledZ||o.y-i.y||o.x-i.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(C_).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(n||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,r){if(r)if(e.state="errored",404!==r.status)this._source.fire(new Ct(r,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ut.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Tt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const i=t[r];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);n(e,t),n(t,e)}}function n(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,r){for(const i in this._tiles){let o=this._tiles[i];if(r[i]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,i=Math.floor(n*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,n,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let i;if(this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Fh(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[],i.length>0&&this.castsShadows&&r&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!A_(this._source.type)){const o=e.coveringZoomLevel({tileSize:t||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),s=Math.min(o,this._source.maxzoom),a=e.extendTileCoverForShadows(i,r,s);for(const e of a)this._shadowCasterTiles[e.key]=!0,i.push(e)}const o=this._updateRetainedTiles(i);if(A_(this._source.type)&&0!==i.length){const e={},t={},n=Object.keys(o);for(const r of n){const n=o[r],i=this._tiles[r];if(!i||i.fadeEndTime&&i.fadeEndTime<=ut.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-T_.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[r]=n}const r=i[i.length-1].overscaledZ;for(const e in this._tiles){const n=this._tiles[e];if(o[e]||!n.hasData())continue;let i=n.tileID;for(;i.overscaledZ>r;){i=i.scaledTo(i.overscaledZ-1);const r=this._tiles[i.key];if(r&&r.hasData()&&t[i.key]){o[e]=n.tileID;break}}}for(const t in e)o[t]||(this._coveredTiles[t]=!0,o[t]=e[t])}for(const e in o)this._tiles[e].clearFadeHold();const s=function(e,t){const n=[];for(const r in e)r in t||n.push(r);return n}(this._tiles,o);for(const e of s){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),i=e[0].overscaledZ,o=Math.max(i-T_.maxOverzooming,this._source.minzoom),s=Math.max(i+T_.maxUnderzooming,this._source.minzoom),a={};for(const n of e){const e=this._addTile(n);t[n.key]=n,e.hasData()||r<this._source.maxzoom&&(a[n.key]=n)}this._retainLoadedChildren(a,r,s,t);for(const r of e){let e=this._tiles[r.key];if(e.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const e=r.children(this._source.maxzoom)[0],n=this.getTile(e);if(n&&n.hasData()){t[e.key]=e;continue}}else{const e=r.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let i=e.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&i&&(e=this._addTile(o)),e&&(t[o.key]=o,i=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;r=e}for(const e of t)this._loadedParentTiles[e]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return!0!==t.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const n=this.map?this.map.painter:null;t=new Av(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Tt("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const r=[],i=this.transform;if(!i)return r;const o="globe"===i.projection.name,s=Gd(i.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(n&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(P(s,...I_(e,-1))-s),Math.abs(P(s,...I_(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(P(s,...I_(e,-1))-s),Math.abs(P(s,...I_(e,0))-s),Math.abs(P(s,...I_(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const n of c){const o=e.containsTile(l,i,t,n);o&&r.push(o)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const n=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID));for(const e of n)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return n}sortCoordinatesByDistance(e){const t=e.slice(),n=this.transform._camera.position,r=this.transform._camera.forward(),i={};for(const e of t){const t=1/(1<<e.canonical.z);i[e.key]=((e.canonical.x+.5)*t+e.wrap-n[0])*r[0]+((e.canonical.y+.5)*t-n[1])*r[1]-n[2]*r[2]}return t.sort(((e,t)=>i[e.key]-i[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(A_(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=ut.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const r=this._tiles[e];r&&r.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}_preloadTiles(e,t){if(!this._sourceLoaded){const n=()=>{this._sourceLoaded&&(this._source.off("data",n),this._preloadTiles(e,t))};return void this._source.on("data",n)}const n=new Map,r=Array.isArray(e)?e:[e],i=this.map.painter.terrain,o=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)n.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}D(Array.from(n.values()),((e,t)=>{const n=new Av(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(n,(e=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),t(e,n)}))}),t)}}function C_(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function A_(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function I_(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}T_.maxOverzooming=10,T_.maxUnderzooming=3;const P_=ba([{name:"a_pos_3f",components:3,type:"Float32"}]),R_=ba([{name:"a_color_3f",components:3,type:"Float32"}]),L_=ba([{name:"a_color_4f",components:4,type:"Float32"}]),D_=ba([{name:"a_uv_2f",components:2,type:"Float32"}]),O_=ba([{name:"a_normal_3f",components:3,type:"Float32"}]),N_=ba([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),k_=ba([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class F_{constructor(e=0,t=0,n=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=r}interpolate(e,t,n){return null!=t.top&&null!=e.top&&(this.top=Xr(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=Xr(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=Xr(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=Xr(e.right,t.right,n)),this}getCenter(e,t){const n=P((this.left+e-this.right)/2,0,e),r=P((this.top+t-this.bottom)/2,0,t);return new v(n,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new F_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function z_(e,t){const n=ie(e,3);_h.fromQuat(e,t),oe(e,3,n)}function B_(e,t){const n=bh.identity([]);return bh.rotateZ(n,n,-t),bh.rotateX(n,n,-e),n}function U_(e,t){const n=[e[0],e[1],0],r=[t[0],t[1],0];if(Eh.length(n)>=1e-15){const e=Eh.normalize([],n);Eh.scale(r,e,Eh.dot(r,e)),t[0]=r[0],t[1]=r[1]}const i=Eh.cross([],t,e);if(Eh.len(i)<1e-15)return null;const o=Math.atan2(-i[1],i[0]);return B_(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class j_{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){if(e){const t=e instanceof ep?e:new ep(e[0],e[1],e[2]);this._renderWorldCopies&&(t.x=L(t.x,0,1)),this._position=t}else this._position=null}lookAtPoint(e,t){if(this.orientation=null,!this.position)return;const n=this.position,r=this._elevation?this._elevation.getAtPointOrZero(ep.fromLngLat(e)):0,i=ep.fromLngLat(e,r),o=[i.x-n.x,i.y-n.y,i.z-n.z];t||(t=[0,0,1]),t[2]=Math.abs(t[2]),this.orientation=U_(o,t)}setPitchBearing(e,t){this.orientation=B_(w(e),w(-t))}}class V_{constructor(e,t){this._transform=_h.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){const e=this.position;return new ep(e[0],e[1],e[2])}get position(){const e=ie(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var t;e&&oe(this._transform,3,[(t=e)[0],t[1],t[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||bh.identity([]),e&&z_(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=B_(e,t),z_(this._transform,this._orientation)}forward(){const e=ie(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=ie(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=ie(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){const n=new Float64Array(16);return _h.invert(n,this.getWorldToCamera(e,t)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,t,n){const r=this.position;Eh.scale(r,r,-e);const i=new Float64Array(16);return _h.fromScaling(i,[n,n,n]),_h.translate(i,i,r),i[10]*=t,i}getWorldToCamera(e,t){const n=new Float64Array(16),r=new Float64Array(4),i=this.position;return bh.conjugate(r,this._orientation),Eh.scale(i,i,-e),_h.fromQuat(n,r),_h.translate(n,n,i),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=t,n[9]*=t,n[10]*=t,n[11]*=t,n}getCameraToClipPerspective(e,t,n,r){const i=new Float64Array(16);return _h.perspective(i,e,t,n,r),i}getCameraToClipOrthographic(e,t,n,r,i,o){const s=new Float64Array(16);return _h.ortho(s,e,t,n,r,i,o),s}getDistanceToElevation(e,t=!1){const n=0===e?0:Zd(e,t?$d(this.position[1]):this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new V_([...this.position],[...this.orientation])}}function G_(e,t){const n=Z_(e.projection,e.zoom,e.width,e.height),r=function(e,t,n,r,i){const o=new Bd(n.lng-180*W_,n.lat),s=new Bd(n.lng+180*W_,n.lat),a=e.project(o.lng,o.lat),l=e.project(s.lng,s.lat),c=-Math.atan2(l.y-a.y,l.x-a.x),u=ep.fromLngLat(n);u.y=P(u.y,-1+W_,1-W_);const h=u.toLngLat(),d=e.project(h.lng,h.lat),p=ep.fromLngLat(h);p.x+=W_;const f=p.toLngLat(),m=e.project(f.lng,f.lat),g=q_(m.x-d.x,m.y-d.y,c),y=ep.fromLngLat(h);y.y+=W_;const v=y.toLngLat(),_=e.project(v.lng,v.lat),x=q_(_.x-d.x,_.y-d.y,c),b=Math.abs(g.x)/Math.abs(x.y),w=_h.identity([]);_h.rotateZ(w,w,-c*(1-(i?0:r)));const S=_h.identity([]);return _h.scale(S,S,[1,1-(1-b)*r,1]),S[4]=-x.x/x.y*r,_h.rotateZ(S,S,c),_h.multiply(S,w,S),S}(e.projection,0,e.center,n,t),i=H_(e);return _h.scale(r,r,[i,i,1]),r}function H_(e){const t=e.projection,n=Z_(e.projection,e.zoom,e.width,e.height),r=$_(t,e.center),i=$_(t,Bd.convert(t.center));return Math.pow(2,r*n+(1-n)*i)}function Z_(e,t,n,r,i=1/0){const o=e.range;if(!o)return 0;const s=Math.min(i,Math.max(n,r)),a=Math.log(s/1024)/Math.LN2;return R(o[0]+a,o[1]+a,t)}const W_=1/4e4;function $_(e,t){const n=P(t.lat,-Xd,Xd),r=new Bd(t.lng-180*W_,n),i=new Bd(t.lng+180*W_,n),o=e.project(r.lng,n),s=e.project(i.lng,n),a=ep.fromLngLat(r),l=ep.fromLngLat(i),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,d=l.y-a.y,p=Math.sqrt((h*h+d*d)/(c*c+u*u));return Math.log(p)/Math.LN2}function q_(e,t,n){const r=Math.cos(n),i=Math.sin(n);return{x:e*r-t*i,y:e*i+t*r}}function X_(e,t,n){return t*(ar/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const Y_={unknown:0,flipRequired:1,flipNotRequired:2},K_=Math.tan(85*Math.PI/180);function J_(e,t,n,r,i,o,s){const a=_h.create();if(n)if("globe"===o.name){const e=function(e,t){const{x:n,y:r}=e.point,i=Sd(n,r,e.worldSize/e._pixelsPerMercatorPixel,0,0);return _h.multiply(i,i,xd(ad(t)))}(i,t);_h.multiply(a,a,e)}else{const e=fh.invert([],s);a[0]=e[0],a[1]=e[1],a[4]=e[2],a[5]=e[3],r||_h.rotateZ(a,a,i.angle)}else _h.multiply(a,i.labelPlaneMatrix,e);return a}function Q_(e,t,n,r,i,o,s){const a=J_(e,t,n,r,i,o,s);return"globe"===o.name&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function ex(e,t,n,r,i,o,s){if(n){if("globe"===o.name){const a=J_(e,t,n,r,i,o,s);return _h.invert(a,a),_h.multiply(a,e,a),a}{const t=_h.clone(e),n=_h.identity([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],_h.multiply(t,t,n),r||_h.rotateZ(t,t,-i.angle),t}}return i.glCoordMatrix}function tx(e,t,n,r){const i=[e,t,n,1];n?hh.transformMat4(i,i,r):dx(i,i,r);const o=i[3];return i[0]/=o,i[1]/=o,i[2]/=o,i}function nx(e,t){return Math.min(.5+e/t*.5,1.5)}function rx(e,t){const n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function ix(e,t,n,r,i,o,s,a,l,c){const u=n.transform,h=r?e.textSizeData:e.iconSizeData,d=ag(h,n.transform.zoom),p="globe"===u.projection.name,f=[256/n.width*2+1,256/n.height*2+1],m=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();let g=null;p&&(g=r?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const y=e.lineVertexArray,_=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b,w=!1;for(let r=0;r<_.length;r++){const p=_.get(r),{numGlyphs:S,writingMode:M}=p;if(M!==wg.vertical||w||b===wg.horizontal||(w=!0),b=M,(p.hidden||M===wg.vertical)&&!w){hx(S,m);continue}w=!1;const E=new v(p.tileAnchorX,p.tileAnchorY);let{x:T,y:C,z:A}=u.projection.projectTilePoint(E.x,E.y,c.canonical);if(l){const[e,t,n]=l(E);T+=e,C+=t,A+=n}const I=[T,C,A,1];if(hh.transformMat4(I,I,t),!rx(I,f)){hx(S,m);continue}const P=I[3],R=nx(n.transform.getCameraToCenterDistance(u.projection),P),L=sg(h,d,p),D=s?L/R:L*R,O=tx(T,C,A,i);if(O[3]<=0){hx(S,m);continue}let N={};const k=s?null:l,F=ax(p,D,!1,a,t,i,o,e.glyphOffsetArray,y,m,g,O,E,N,x,k,u.projection,c,s);w=F.useVertical,k&&F.needsFlipping&&(N={}),(F.notEnoughRoom||w||F.needsFlipping&&ax(p,D,!0,a,t,i,o,e.glyphOffsetArray,y,m,g,O,E,N,x,k,u.projection,c,s).notEnoughRoom)&&hx(S,m)}r?(e.text.dynamicLayoutVertexBuffer.updateData(m),g&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(g)):(e.icon.dynamicLayoutVertexBuffer.updateData(m),g&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(g))}function ox(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:y,segment:v}=a,_=y+a.numGlyphs,x=g+a.lineLength,b=t.getoffsetX(y),w=t.getoffsetX(_-1),S=ux(e*b,n,r,i,o,s,v,g,x,l,c,u,h,d,!0,p,f,m);if(!S)return null;const M=ux(e*w,n,r,i,o,s,v,g,x,l,c,u,h,d,!0,p,f,m);return M?{first:S,last:M}:null}function sx(e,t,n,r){return e===wg.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:e===wg.vertical?r>0?{needsFlipping:!0}:null:t!==Y_.unknown&&function(e,t){return 0===e||Math.abs(t/e)>K_}(n,r)?t===Y_.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ax(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const x=t/24,b=e.lineOffsetX*x,w=e.lineOffsetY*x,{lineStartIndex:S,glyphStartIndex:M,numGlyphs:E,segment:T,writingMode:C,flipState:A}=e,I=S+e.lineLength,P=e=>{if(u){const[t,n,r]=e.up,i=c.length;rv(u,i+0,t,n,r),rv(u,i+1,t,n,r),rv(u,i+2,t,n,r),rv(u,i+3,t,n,r)}const[t,n,r]=e.point;iv(c,t,n,r,e.angle)};if(E>1){const t=ox(x,a,b,w,n,h,d,e,l,o,p,m,!1,g,y,_);if(!t)return{notEnoughRoom:!0};if(r&&!n){let[n,r,i]=t.first.point,[o,a,l]=t.last.point;[n,r]=tx(n,r,i,s),[o,a]=tx(o,a,l,s);const c=sx(C,A,(o-n)*f,a-r);if(e.flipState=c&&c.needsFlipping?Y_.flipRequired:Y_.flipNotRequired,c)return c}P(t.first);for(let e=M+1;e<M+E-1;e++){const t=ux(x*a.getoffsetX(e),b,w,n,h,d,T,S,I,l,o,p,m,!1,!1,g,y,_);if(!t)return c.length-=4*(e-M),{notEnoughRoom:!0};P(t)}P(t.last)}else{if(r&&!n){const t=tx(d.x,d.y,0,i),n=S+T+1,r=new v(l.getx(n),l.gety(n)),o=tx(r.x,r.y,0,i),s=o[3]>0?o:cx(d,r,t,1,i,void 0,g,y.canonical),a=sx(C,A,(s[0]-t[0])*f,s[1]-t[1]);if(e.flipState=a&&a.needsFlipping?Y_.flipRequired:Y_.flipNotRequired,a)return a}const t=ux(x*a.getoffsetX(M),b,w,n,h,d,T,S,I,l,o,p,m,!1,!1,g,y,_);if(!t)return{notEnoughRoom:!0};P(t)}return{}}function lx(e,t,n,r,i){const{x:o,y:s,z:a}=r.projectTilePoint(e.x,e.y,t);if(!i)return tx(o,s,a,n);const[l,c,u]=i(e);return tx(o+l,s+c,a+u,n)}function cx(e,t,n,r,i,o,s,a){const l=lx(e.sub(t)._unit()._add(e),a,i,s,o);return Eh.sub(l,n,l),Eh.normalize(l,l),Eh.scaleAndAdd(l,n,l,r)}function ux(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=r?e-t:e+t;let x=_>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=a+s+(x>0?0:1)|0,S=i,M=i,E=0,T=0;const C=Math.abs(_),A=[],I=[];let P=o,R=P;const L=()=>cx(R,P,M,C-E+1,u,d,m,g.canonical);for(;E+T<=C;){if(w+=x,w<a||w>=l)return null;if(M=S,R=P,A.push(M),p&&I.push(R),P=new v(c.getx(w),c.gety(w)),S=h[w],!S){const e=lx(P,g.canonical,u,m,d);S=e[3]>0?h[w]=e:L()}E+=T,T=Eh.distance(M,S)}f&&d&&(h[w]&&(S=L(),T=Eh.distance(M,S)),h[w]=S);const D=(C-E)/T,O=P.sub(R)._mult(D)._add(R),N=Eh.sub([],S,M),k=Eh.scaleAndAdd([],M,N,D);let F=[0,0,1],z=N[0],B=N[1];if(y&&(F=m.upVector(g.canonical,O.x,O.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],t=Eh.cross([],F,e);Eh.normalize(e,e),Eh.normalize(t,t),z=Eh.dot(N,e),B=Eh.dot(N,t)}if(n){const e=Eh.cross([],F,N);Eh.normalize(e,e),Eh.scaleAndAdd(k,k,e,n*x)}const U=b+Math.atan2(B,z);return A.push(k),p&&I.push(O),{point:k,angle:U,path:A,tilePath:I,up:F}}function hx(e,t){const n=t.length,r=n+4*e;t.resize(r),t.float32.fill(-1/0,4*n,4*r)}function dx(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}const px=(e,t,n)=>(1-n)*e+n*t,fx=e=>e*e*e*e*e;class mx{constructor(e,t,n,r,i,o,s){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new Bd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new F_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new V_,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new mx(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||n)&&this._updateCameraOnTerrain(),(e||n)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return k(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const t=this.projection?this.getProjection():void 0;this.projection=$y(this.projectionOptions);const n=!_(t,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=$y({name:"mercator"});const t=e!==this.projection.name;return t&&this._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Zd(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new v(this.width,this.height)}get bearing(){return L(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const t=-e*Math.PI/180;this.angle!==t&&(this._unmodified=!1,this.angle=t,this._calcMatrices(),this.rotationMatrix=fh.create(),fh.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const t=P(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=w(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,t=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,i=0;for(let o=0;o<t.length;o++){const s=new v(t[o][0]*this.width,n+t[o][1]*(this.height-n)),a=e.pointCoordinate(s);if(!a)continue;const l=1/Math.hypot(a[0]-this._camera.position[0],a[1]-this._camera.position[1]);r+=a[3]*l,i+=l}return 0===i?NaN:r/i}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),i=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-n,i);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){const t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z];const r=Eh.length(Eh.sub([],this._camera.position,n));return P(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let t=!1;if(e.orientation&&!bh.exactEquals(e.orientation,this._camera.orientation)&&(t=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];Eh.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),t=!0)}t&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,t=new j_;return t.position=new ep(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!bh.length(e))return!1;bh.normalize(e,e);const t=Eh.transformQuat([],[0,0,-1],e),n=Eh.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const r=U_(t,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){const t=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=P(e[2],r/n,r/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const t=[new kh(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new v(0,0)),r=this.pointCoordinate(new v(this.width,0)),i=this.pointCoordinate(new v(this.width,this.height)),o=this.pointCoordinate(new v(0,this.height)),s=Math.floor(Math.min(n.x,r.x,i.x,o.x)),a=Math.floor(Math.max(n.x,r.x,i.x,o.x)),l=1;for(let n=s-l;n<=a+l;n++)0!==n&&t.push(new kh(n,e))}return t}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,t,n){let r=[];if(0===t[0]&&0===t[1])return r;for(const n of e){const e=n.canonical,i=n.overscaledZ,o=n.wrap,s=1<<e.z,a=e.x+1<s,l=e.x>0,c=e.y+1<s,u=e.y>0,h=n.wrap-(l?0:1),d=n.wrap+(a?0:1),p=l?e.x-1:s-1,f=a?e.x+1:0;t[0]<0?(r.push(new Fh(i,d,e.z,f,e.y)),t[1]<0&&c&&(r.push(new Fh(i,o,e.z,e.x,e.y+1)),r.push(new Fh(i,d,e.z,f,e.y+1))),t[1]>0&&u&&(r.push(new Fh(i,o,e.z,e.x,e.y-1)),r.push(new Fh(i,d,e.z,f,e.y-1)))):t[0]>0?(r.push(new Fh(i,h,e.z,p,e.y)),t[1]<0&&c&&(r.push(new Fh(i,o,e.z,e.x,e.y+1)),r.push(new Fh(i,h,e.z,p,e.y+1))),t[1]>0&&u&&(r.push(new Fh(i,o,e.z,e.x,e.y-1)),r.push(new Fh(i,h,e.z,p,e.y-1)))):t[1]<0&&c?r.push(new Fh(i,o,e.z,e.x,e.y+1)):u&&r.push(new Fh(i,o,e.z,e.x,e.y-1))}if(r.length>1){r.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<r.length;)r[t].equals(r[e])?++t:r[++e]=r[t++];r.length=e+1}const i=[];for(const e of r)r.some((t=>e.isChildOf(t)))||i.push(e);return r=i.filter((t=>!e.some((e=>!!(t.overscaledZ<n&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),r}coveringTiles(e){let t=this.coveringZoomLevel(e);const n=t,r=this.elevation&&this.elevation.exaggeration(),i=r&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&t<e.minzoom)return[];void 0!==e.maxzoom&&t>e.maxzoom&&(t=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<t,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*Zd(1,this.center.lat),m=this._camera.position[2]/Zd(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],y=u||r,v=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),_=this.isLODDisabled(!0)?t:0,x=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,b=e.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?H_(this):1,S=e=>{const t=1/4e4,n=new ep(e.x+t,e.y,e.z),r=new ep(e.x,e.y+t,e.z),i=e.toLngLat(),o=n.toLngLat(),s=r.toLngLat(),a=this.locationCoordinate(i),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=Math.hypot(l.x-a.x,l.y-a.y),h=Math.hypot(c.x-a.x,c.y-a.y);return Math.sqrt(u*h)*w/t},E=e=>{const t=x,n=b;return{aabb:My(this,l,0,0,0,e,n,t,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:t,wrap:e,fullyVisible:!1}},T=[];let C=[];const A=t,I=e.reparseOverscaled?n:t,P=e=>e*e,R=P((m-this._centerAltitude)*f),L=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),n=e.aabb;t?(n.min[2]=t.min,n.max[2]=t.max,n.center[2]=(n.min[2]+n.max[2])/2):(e.shouldSplit=D(e),e.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},D=e=>{if(e.zoom<_)return!0;if(e.zoom===A)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(g),r=e.aabb.distanceY(g);let o=R,s=1;if(u){o=P(e.aabb.distanceZ(g));const t=Math.pow(2,e.zoom),n=$d((e.y+1)/t),r=$d(e.y/t),i=Math.min(Math.max(a,n),r),l=Vd(i)/Vd(a);if(s=i===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,l/this._mercatorScaleRatio),this.zoom<=qh&&e.zoom===A-1&&l>=.9)return!0}else if(i&&(o=P(e.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const t=Math.pow(2,e.zoom),n=S(new ep((e.x+.5)/t,(e.y+.5)/t));s=n>.85?1:n}const l=t*t+r*r+o,c=P((1<<A-e.zoom)*v*s*((e,t)=>{if(t*P(.707)<e)return 1;const n=Math.sqrt(t/e);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,R),l));return l<c};if(this.renderWorldCopies)for(let e=1;e<=3;e++)T.push(E(-e)),T.push(E(e));for(T.push(E(0));T.length>0;){const n=T.pop(),r=n.x,s=n.y;let a=n.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!a){let e=y?n.aabb.intersects(d):n.aabb.intersectsFlat(d);if(0===e&&h()){const t=new Nh(n.zoom,r,s);e=hd(this,l,t,!0).intersects(d)}if(0===e)continue;a=2===e}if(n.zoom!==A&&D(n))for(let e=0;e<4;e++){const t=(r<<1)+e%2,c=(s<<1)+(e>>1),h={aabb:o?n.aabb.quadrant(e):My(this,l,n.zoom+1,t,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:t,y:c,wrap:n.wrap,fullyVisible:a,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};i&&!u&&(h.tileID=new Fh(n.zoom+1===A?I:n.zoom+1,n.wrap,n.zoom+1,t,c),L(h)),T.push(h)}else{const i=n.zoom===A?I:n.zoom;if(e.minzoom&&e.minzoom>i)continue;if(!a){let e=y?n.aabb.intersectsPrecise(d):n.aabb.intersectsPreciseFlat(d);if(0===e&&h()){const t=new Nh(n.zoom,r,s);e=hd(this,l,t,!0).intersectsPrecise(d)}if(0===e)continue}const o=c[0]-(.5+r+(n.wrap<<n.zoom))*(1<<t-n.zoom),u=c[1]-.5-s,p=n.tileID?n.tileID:new Fh(i,n.wrap,n.zoom,r,s);C.push({tileID:p,distanceSq:o*o+u*u})}}if(this.fogCullDistSq){const t=this.fogCullDistSq,n=this.horizonLineFromTop();C=C.filter((r=>{const i=[0,0,0,1],o=[ar,ar,0,1],s=this.calculateFogTileMatrix(r.tileID.toUnwrapped());hh.transformMat4(i,i,s),hh.transformMat4(o,o,s);const a=function(e,t,n){let r=0;for(let n=0;n<2;++n){const i=0;e[n]>i&&(r+=(e[n]-i)*(e[n]-i)),t[n]<i&&(r+=(i-t[n])*(i-t[n]))}return r}(hh.min([],i,o),hh.max([],i,o));if(0===a)return!0;let l=!1;const c=this._elevation;if(c&&a>t&&0!==n){const t=this.calculateProjMatrix(r.tileID.toUnwrapped());let i;e.isTerrainDEM||(i=c.getMinMaxForTile(r.tileID)),i||(i={min:b,max:x});const o=function(e){const t=Math.round((e+45+360)%360/90)%4;return M[t]}(this.rotation),s=[o[0]*ar,o[1]*ar,i.max];Eh.transformMat4(s,s,t),l=(1-s[1])*this.height*.5<n}return a<t||l}))}return C.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const t=P(e.lat,-Xd,Xd),n=this.projection.project(e.lng,t);return new v(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Zd(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let n,r;const i=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(t.x-i.x)/e,r=(t.y-i.y)/e}else{const e=this.pointCoordinate(t),o=this.pointCoordinate(i);n=e.x-o.x,r=e.y-o.y}const o=this.locationCoordinate(e);this.setLocation(new ep(o.x-n,o.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){const n=t?Zd(t,e.lat):void 0,r=this.projection.project(e.lng,e.lat);return new ep(r.x,r.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){const n=null!=t?t:this._centerAltitude,r=[e.x,e.y,0,1],i=[e.x,e.y,1,1];hh.transformMat4(r,r,this.pixelMatrixInverse),hh.transformMat4(i,i,this.pixelMatrixInverse);const o=i[3];hh.scale(r,r,1/r[3]),hh.scale(i,i,1/o);const s=r[2],a=i[2];return{p0:r,p1:i,t:s===a?0:(n-s)/(a-s)}}screenPointToMercatorRay(e){const t=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return hh.transformMat4(t,t,this.pixelMatrixInverse),hh.transformMat4(n,n,this.pixelMatrixInverse),hh.scale(t,t,1/t[3]),hh.scale(n,n,1/n[3]),t[2]=Zd(t[2],this._center.lat)*this.worldSize,n[2]=Zd(n[2],this._center.lat)*this.worldSize,hh.scale(t,t,1/this.worldSize),hh.scale(n,n,1/this.worldSize),new Uh([t[0],t[1],t[2]],Eh.normalize([],Eh.sub([],n,t)))}rayIntersectionCoordinate(e){const{p0:t,p1:n,t:r}=e,i=Zd(t[2],this._center.lat),o=Zd(n[2],this._center.lat);return new ep(Xr(t[0],n[0],r)/this.worldSize,Xr(t[1],n[1],r)/this.worldSize,Xr(i,o,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let t=this.projection.pointCoordinate3D(this,e.x,e.y);if(t)return new ep(t[0],t[1],t[2]);let n=0,r=this.horizonLineFromTop();if(e.y>r)return this.pointCoordinate(e);const i=.02*r,o=e.clone();for(let e=0;e<10&&r-n>i;e++){o.y=Xr(n,r,.66);const e=this.projection.pointCoordinate3D(this,o.x,o.y);e?(r=o.y,t=e):n=o.y}return t?new ep(t[0],t[1],t[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Xh)return!this.isPointAboveHorizon(e);const t=this.pointCoordinate(e);return t.y>=0&&t.y<=1}_coordinatePoint(e,t){const n=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return hh.transformMat4(r,r,this.pixelMatrix),r[3]>0?new v(r[0]/r[3],r[1]/r[3]):new v(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,i=this.pointLocation3D(new v(t,e)),o=this.pointLocation3D(new v(r,e)),s=this.pointLocation3D(new v(r,n)),a=this.pointLocation3D(new v(t,n));let l=Math.min(i.lng,o.lng,s.lng,a.lng),c=Math.max(i.lng,o.lng,s.lng,a.lng),u=Math.min(i.lat,o.lat,s.lat,a.lat),h=Math.max(i.lat,o.lat,s.lat,a.lat);const d=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,f=(e,t,n,r,i)=>{const o=(e+n)/2,s=(t+r)/2,a=new v(o,s),{lng:m,lat:g}=this.pointLocation3D(a),y=Math.max(0,l-m,u-g,m-c,g-h);l=Math.min(l,m),c=Math.max(c,m),u=Math.min(u,g),h=Math.max(h,g),(i<p||y>d)&&(f(e,t,o,s,i+1),f(o,s,n,r,i+1))};if(f(t,e,r,e,1),f(r,e,r,n,1),f(r,n,t,n,1),f(t,n,t,e,1),"globe"===this.projection.name){const[e,t]=function(e){const t=_h.identity(new Float64Array(16));_h.multiply(t,e.pixelMatrix,e.globeMatrix);const n=[0,ed,0],r=[0,td,0];return Eh.transformMat4(n,n,t),Eh.transformMat4(r,r,t),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!Rd(e,new Bd(e.center.lat,90)),r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!Rd(e,new Bd(e.center.lat,-90))]}(this);e?(h=90,c=180,l=-180):t&&(u=-90,c=180,l=-180)}return new Ql(new Bd(l,u),new Bd(c,h))}_getBoundsRectangular(e,t){const{top:n,left:r}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new v(r,n),a=new v(o,n),l=new v(o,i),c=new v(r,i);let u=this.pointCoordinate(s,e),h=this.pointCoordinate(a,e);const d=this.pointCoordinate(l,t),p=this.pointCoordinate(c,t),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&h.y>=0?u=new ep((1-p.y)/f(p,u)+p.x,1):u.y<0&&h.y<=1&&(u=new ep(-p.y/f(p,u)+p.x,0)),h.y>1&&u.y>=0?h=new ep((1-d.y)/f(d,h)+d.x,1):h.y<0&&u.y<=1&&(h=new ep(-d.y/f(d,h)+d.x,0)),(new Ql).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-Xd,this.maxLat=Xd,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Gd(this.minLng)*this.tileSize,this.worldMaxX=Gd(this.maxLng)*this.tileSize,this.worldMinY=Hd(this.maxLat)*this.tileSize,this.worldMaxY=Hd(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){const t=e.key,n=this._distanceTileDataCache;if(n[t])return n[t];const r=e.canonical,i=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(r.z),a=(r.x+Math.pow(2,r.z)*e.wrap)*s,l=r.y*s,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;const u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return n[t]={bearing:[h,d],center:[(c.x-a)*i,(c.y-l)*i],scale:s/ar*i},n[t]}calculateFogTileMatrix(e){const t=e.key,n=this._fogTileMatrixCache;if(n[t])return n[t];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return _h.multiply(r,this.worldToFogMatrix,r),n[t]=new Float32Array(r),n[t]}calculateProjMatrix(e,t=!1){const n=e.key,r=t?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const i=this.calculatePosMatrix(e,this.worldSize);return _h.multiply(i,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:t?this.alignedProjMatrix:this.projMatrix,i),r[n]=new Float32Array(i),r[n]}calculatePixelsToTileUnitsMatrix(e){const t=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[t])return n[t];const r=function(e,t){const{scale:n}=e.tileTransform,r=n*ar/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return fh.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[r,r])}(e,this);return n[t]=r,n[t]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,t=_h.fromScaling([],[e,e,e]);return _h.multiply(t,t,this.globeMatrix),t}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const t=Zd(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(t),r=this._camera.forward(),i=Zd(1,this._center.lat);n[2]/=i,r[2]/=i,Eh.normalize(r,r);const o=e.raycast(n,r,e.exaggeration());if(o){const e=Eh.scaleAndAdd([],n,r,o),t=new ep(e[0],e[1],Zd(e[2],$d(e[1]))),s=(t.z+Eh.length([t.x-n[0],t.y-n[1],t.z-n[2]*i]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=t.toAltitude(),this._center=this.coordinateLocation(t),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const t=this._elevation,n=Zd(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),i=t.getAtPointOrZero(new ep(...r)),o=this.pixelsPerMeter/this.worldSize*i,s=this._minimumHeightOverTerrain(),a=r[2]-o;if(a<=s)if(a<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[r[0],r[1],e.z-r[2]],n=Eh.length(t);t[2]-=(s-a)/this._pixelsPerMercatorPixel;const i=Eh.length(t);if(0===i)return;Eh.scale(t,t,n/i*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const t=this.center;return t.lat=P(t.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(t.lng=P(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:n,y:r}=this.point;let i=0,o=n,s=r;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(r-l<c&&(s=c+l),r+l>u&&(s=u-l),u-c<this.height&&(i=Math.max(i,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;o=(n+r+this.worldSize)%this.worldSize-r,o-a<e&&(o=e+a),o+a>t&&(o=t-a),t-e<this.width&&(i=Math.max(i,this.width/(t-e)),o=(t+e)/2)}o===n&&s===r||(this.center=this.unproject(new v(o,s))),i&&(this.zoom+=this.scaleZoom(i)),this._constrainCamera(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,t="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=Zd(1,this.center.lat)/Zd(1,45));const r=Z_(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const i="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,i);let s;const a=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(a[8]=2*-e.x/this.width,a[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=t*this.aspect,r=-n,i=-t;n-=e.x,r-=e.x,t+=e.y,i+=e.y,s=this._camera.getCameraToClipOrthographic(r,n,i,t,this._nearZ,this._farZ),((e,t,n,r)=>{for(let i=0;i<16;i++)e[i]=px(t[i],n[i],r)})(s,s,a,fx(this.pitch>=15?1:this.pitch/15))}else s=a;const l=_h.mul([],a,o);let c=_h.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),t=_h.identity([]);_h.translate(t,t,[e.x*this.worldSize,e.y*this.worldSize,0]),_h.multiply(t,t,G_(this)),_h.translate(t,t,[-e.x*this.worldSize,-e.y*this.worldSize,0]),_h.multiply(c,c,t),_h.multiply(l,l,t),this.inverseAdjustmentMatrix=function(e){const t=G_(e,!0);return fh.invert([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=_h.scale([],c,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=c,this.invProjMatrix=_h.invert(new Float64Array(16),this.projMatrix);const u=_h.invert([],s);this.frustumCorners=jh.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!t);const h=new Float32Array(16);_h.identity(h),_h.scale(h,h,[1,-1,1]),_h.rotateX(h,h,this._pitch),_h.rotateZ(h,h,this.angle);const d=_h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=_h.clone(d);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-e.x/this.width,d[9]=2*(e.y+p)/this.height,this.skyboxMatrix=_h.multiply(h,d,h);const f=this.point,m=f.x,g=f.y,y=this.width%2/2,v=this.height%2/2,_=Math.cos(this.angle),x=Math.sin(this.angle),b=m-Math.round(m)+_*y+x*v,w=g-Math.round(g)+_*v+x*y,S=new Float64Array(c);if(_h.translate(S,S,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=S,c=_h.create(),_h.scale(c,c,[this.width/2,-this.height/2,1]),_h.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=_h.create(),_h.scale(c,c,[1,-1,1]),_h.translate(c,c,[-1,-1,0]),_h.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=_h.multiply(new Float64Array(16),this.labelPlaneMatrix,l),this._calcFogMatrices(),this._distanceTileDataCache={},c=_h.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=function(e){const{x:t,y:n}=e.point,{lng:r,lat:i}=e._center;return Sd(t,n,e.worldSize,r,i)}(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=Eh.transformMat4(e,e,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,i=[e,e,t];Eh.scale(i,i,r),Eh.scale(n,n,-1),Eh.multiply(n,n,i);const o=_h.create();_h.translate(o,o,n),_h.scale(o,o,i),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),r=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-n[0]*i,r.y/this.worldSize-n[1]*i,e/this.worldSize*this._centerAltitude-n[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],r=e[2];let i=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(i=Math.min((t-n)/r,1)),this._camera.position=Eh.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,t=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),i=Zd(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(w(this._maxPitch)),s=Math.max((e[2]-i)/Math.cos(n),o),a=this._zoomFromMercatorZ(s);Eh.scaleAndAdd(e,e,t,s),this._pitch=P(n,w(this.minPitch),w(this.maxPitch)),this.angle=L(r,-Math.PI,Math.PI),this._setZoom(P(a,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new ep(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,n=Xh,r=0,i=1/0;for(;n-t>1e-6&&n>t;){const o=t+.5*(n-t),s=this.tileSize*Math.pow(2,o),a=this.getCameraToCenterDistance(this.projection,o,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(o-l);c<i&&(i=c,r=o),o<l?t=o:n=o}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(q("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){const n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),i=Math.min(e.y,t.y),o=Math.max(e.y,t.y);if(i<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new v(n,i),new v(r,o),new v(n,o),new v(r,i)],a=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const n=this.rayIntersectionCoordinate(t);if(n.x<a||n.y<0||n.x>l||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+S(this.fovAboveCenter)>88||this.anyCornerOffEdge(new v(0,0),new v(this.width,this.height))}zoomDeltaToMovement(e,t){const n=Eh.length(Eh.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(n)+t;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,t,n],r){const i=[e,t,n,1];hh.transformMat4(i,i,r);const o=i[3]=Math.max(i[3],1e-6);return i[0]/=o,i[1]/=o,i[2]/=o,i}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new v(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v(0,e))}}getCameraToCenterDistance(e,t=this.zoom,n=this.worldSize){const r=Z_(e,t,this.width,this.height,1024),i=e.pixelSpaceConversion(this.center.lat,n,r);let o=.5/Math.tan(.5*this._fov)*this.height*i;return this.isOrthographic&&(o=px(1,o,fx(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&_h.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Wh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}function gx(e,t,n){_h.identity(e),_h.rotateZ(e,e,w(t[2])),_h.rotateX(e,e,w(t[0])),_h.rotateY(e,e,w(t[1])),_h.scale(e,e,n),_h.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function yx(e,t,n,r,i,o,s,a){const l=[n[0]-t[0],n[1]-t[1],0],c=[r[0]-t[0],r[1]-t[1],0];if(Eh.length(l)<1e-12||Eh.length(c)<1e-12)return bh.identity(e);const u=Eh.cross([],l,c);Eh.normalize(u,u),Eh.subtract(c,r,t),l[2]=(o-i)*a,c[2]=(s-i)*a;const h=l;return Eh.cross(h,l,c),Eh.normalize(h,h),bh.rotationTo(e,u,h)}function vx(e,t,n=!1){const r=Md(t.zoom),i=function(e,t,n){const r=t.worldSize,i=[e[12],e[13],e[14]],o=$d(i[1]/r),s=Wd(i[0]/r),a=_h.identity([]),l=Zd(1,o)*r,c=Zd(1,0)*r*Kd(o,t.zoom),u=1/bd(r);let h=c*u;if(n){const e=Z_(t.projection,t.zoom,t.width,t.height,1024);h=u*t.projection.pixelSpaceConversion(t.center.lat,r,e)}const d=md(o,s);Eh.add(d,d,Eh.scale([],Eh.normalize([],d),l*h*i[2]));const p=function(e){const t=[e[0],e[1],e[2]];let n=[0,1,0];const r=Eh.cross([],n,t);return Eh.cross(n,t,r),0===Eh.squaredLength(n)&&(n=[0,1,0],Eh.cross(r,t,n)),Eh.normalize(r,r),Eh.normalize(n,n),Eh.normalize(t,t),[r[0],r[1],r[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(d);_h.scale(a,a,[h,h,h*l]),_h.translate(a,a,[-i[0],-i[1],-i[2]]);const f=_h.multiply([],t.globeMatrix,p);return _h.multiply(f,f,a),_h.multiply(f,f,e),f}(e,t,n);if(r>0){const n=function(e,t){const n=t.worldSize,r=Zd(1,0)*n*Kd(t.center.lat,t.zoom)/bd(n),i=Zd(1,t.center.lat)*n,o=_h.identity([]);return _h.rotateY(o,o,w(t.center.lng)),_h.rotateX(o,o,w(t.center.lat)),_h.translate(o,o,[0,0,Yh]),_h.scale(o,o,[r,r,r*i]),_h.translate(o,o,[t.point.x-.5*n,t.point.y-.5*n,0]),_h.multiply(o,o,e),_h.multiply(o,t.globeMatrix,o)}(e,t);return function(e,t,n){const r=(e,t,n)=>{const r=Eh.length(e),i=Eh.length(t),o=ld(e,t,n);return Eh.scale(o,o,1/Eh.length(o)*Xr(r,i,n))},i=r([e[0],e[1],e[2]],[t[0],t[1],t[2]],n),o=r([e[4],e[5],e[6]],[t[4],t[5],t[6]],n),s=r([e[8],e[9],e[10]],[t[8],t[9],t[10]],n),a=ld([e[12],e[13],e[14]],[t[12],t[13],t[14]],n);return[i[0],i[1],i[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],1]}(i,n,r)}return i}const _x=64,xx=[1,1,1];class bx{constructor(e,t,n,r){this.id=e,this.position=null!=t?new Bd(t[0],t[1]):new Bd(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new $h([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(_h.multiply(e.matrix,t,e.matrix),e.meshes)for(const t of e.meshes){const n=$h.applyTransform(t.aabb,e.matrix);this.aabb.encapsulate(n)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=_h.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}_positionModelOnTerrain(e,t){const n=e.elevation;if(!n)return 0;const r=$h.projectAabbCorners(this.aabb,this.matrix),i=Zd(1,this.position.lat)*e.worldSize,o=function(e,t){const n=[0,0,1],r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of r){const r=e[i.corners[0]],o=e[i.corners[1]],s=e[i.corners[2]],a=[o[0]-r[0],o[1]-r[1],t*(o[2]-r[2])],l=Eh.cross(a,a,[s[0]-r[0],s[1]-r[1],t*(s[2]-r[2])]);Eh.normalize(l,l),i.dotProductWithUp=Eh.dot(l,n)}return r.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),r[0].corners}(r,i),s=r[o[0]],a=r[o[1]],l=r[o[2]],c=r[o[3]],u=n.getAtPointOrZero(new ep(s[0]/e.worldSize,s[1]/e.worldSize),0),h=n.getAtPointOrZero(new ep(a[0]/e.worldSize,a[1]/e.worldSize),0),d=n.getAtPointOrZero(new ep(l[0]/e.worldSize,l[1]/e.worldSize),0),p=n.getAtPointOrZero(new ep(c[0]/e.worldSize,c[1]/e.worldSize),0),f=(u+p)/2,m=(h+d)/2;return f>m?h<d?yx(t,a,c,s,h,p,u,i):yx(t,l,s,c,d,u,p,i):u<p?yx(t,s,a,l,u,h,d,i):yx(t,c,l,a,p,d,h,i),Math.max(f,m)}computeModelMatrix(e,t,n,r,i,o,s=!1){const a=e.transform,l=a.zoom,c=a.project(this.position),u=Kd(this.position.lat,l),h=1/u;_h.identity(this.matrix),_h.translate(this.matrix,this.matrix,[c.x+r[0]*h,c.y+r[1]*h,r[2]]);let d=1,p=1;const f=a.worldSize;if(s){if("mercator"===a.projection.name){let e=0;a.elevation&&(e=a.elevation.getAtPointOrZero(new ep(c.x/f,c.y/f),0));const t=hh.transformMat4([],[c.x,c.y,e,1],a.projMatrix)[3]/a.cameraToCenterDistance;d=t,p=t*Kd(a.center.lat,l)}else if("globe"===a.projection.name){const e=vx(this.matrix,a),t=_h.multiply([],a.projMatrix,e),n=[0,0,0,1];hh.transformMat4(n,n,t);const r=n[3]/a.cameraToCenterDistance,i=Md(l),o=a.projection.pixelsPerMeter(this.position.lat,f)*Kd(this.position.lat,l),s=a.projection.pixelsPerMeter(a.center.lat,f)*Kd(a.center.lat,l);d=r/Xr(o,Yd(a.center.lat),i),p=r*u/o,d*=s,p*=s}}else d=h;_h.scale(this.matrix,this.matrix,[d,d,p]);const m=[...this.matrix],g=this.orientation,y=[];if(gx(y,[g[0]+t[0],g[1]+t[1],g[2]+t[2]],n),_h.multiply(this.matrix,m,y),i&&a.elevation){let e=0;const t=[];if(o&&a.elevation){e=this._positionModelOnTerrain(a,t);const n=_h.fromQuat([],t),r=_h.multiply([],n,y);_h.multiply(this.matrix,m,r)}else e=a.elevation.getAtPointOrZero(new ep(c.x/f,c.y/f),0);0!==e&&(this.matrix[14]+=e)}}upload(e){if(!this.uploaded){for(const t of this.nodes)Mx(t,e);for(const e of this.nodes)Ex(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)Tx(e)}}function wx(e,t,n=!1){e.uploaded||(e.gfxTexture=new yv(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function Sx(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,P_.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,O_.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,D_.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?R_:L_).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,k_.members,!0)),e.segments=dl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&wx(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&wx(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&wx(r.normalTexture,t),r.occlusionTexture&&wx(r.occlusionTexture,t,n),r.emissionTexture&&wx(r.emissionTexture,t)}function Mx(e,t,n){if(e.meshes)for(const r of e.meshes)Sx(r,t,n);if(e.children)for(const r of e.children)Mx(r,t,n)}function Ex(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)Ex(t)}function Tx(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const t of e.children)Tx(t)}class Cx{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Ax{constructor(){this.instancedDataArray=new Ya,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Ix{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,t,n,r){this.tileToMeter=Qd(n);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of e){const e=cp(o,i);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),e,n))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:i?e.geometry:lp(o,n,r),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,e);u&&t.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length)}this.lookup=null}update(e,t,n,r){for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t in e)n.idToFeaturesIndex.hasOwnProperty(t)&&this.evaluate(n.features[n.idToFeaturesIndex[t]],e[t],n,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];for(const t of n.features){const r=this.layers[0],i=t.feature,o=this.canonical,s=r.paint.get("model-rotation").evaluate(i,{},o),a=r.paint.get("model-scale").evaluate(i,{},o),l=r.paint.get("model-translation").evaluate(i,{},o);Eh.exactEquals(t.rotation,s)&&Eh.exactEquals(t.scale,a)&&Eh.exactEquals(t.translation,l)||(this.evaluate(t,t.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length<0||0===n.instancedDataArray.length||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,N_.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const t=this.instancesPerModel[e];0!==t.instancedDataArray.length&&t.instancedDataBuffer&&t.instancedDataBuffer.destroy()}}addFeature(e,t,n){const r=this.layers[0],i=r.layout.get("model-id").evaluate(n,{},this.canonical);if(!i)return q(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),i;this.instancesPerModel[i]||(this.instancesPerModel[i]=new Ax);const o=this.instancesPerModel[i],s=o.instancedDataArray,a=new Cx(n,s.length);for(const e of t)for(const t of e){if(t.x<0||t.x>=ar||t.y<0||t.y>=ar)continue;const e=(this.lookupDim-1)/ar,n=this.lookupDim*(t.y*e|0)+t.x*e|0;if(this.lookup){if(0!==this.lookup[n])continue;this.lookup[n]=1}this.instanceCount++;const r=s.length;s.resize(r+1),o.instancesEvaluatedElevation.push(0),s.float32[16*r]=t.x,s.float32[16*r+1]=t.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),i}evaluate(e,t,n,r){const i=this.layers[0],o=e.feature,s=this.canonical,a=e.rotation=i.paint.get("model-rotation").evaluate(o,t,s),l=e.scale=i.paint.get("model-scale").evaluate(o,t,s),c=e.translation=i.paint.get("model-translation").evaluate(o,t,s),u=i.paint.get("model-color").evaluate(o,t,s);u.a=i.paint.get("model-color-mix-intensity").evaluate(o,t,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),gx(h,a,l);const d=Math.round(100*u.a)+u.b/1.05;for(let t=0;t<e.instancedDataCount;++t){const i=e.instancedDataOffset+t,o=16*i,a=n.instancedDataArray.float32;let l=0;r&&(l=a[o+6]-n.instancesEvaluatedElevation[i]);const p=0|a[o+1];a[o]=(0|a[o])+u.r/1.05,a[o+1]=p+u.g/1.05,a[o+2]=d,a[o+3]=1/(s.z>10?this.tileToMeter:Qd(s,p)),a[o+4]=c[0],a[o+5]=c[1],a[o+6]=c[2]+l,a[o+7]=h[0],a[o+8]=h[1],a[o+9]=h[2],a[o+10]=h[4],a[o+11]=h[5],a[o+12]=h[6],a[o+13]=h[8],a[o+14]=h[9],a[o+15]=h[10],n.instancesEvaluatedElevation[i]=c[2]}}}As(Ix,"ModelBucket",{omit:["layers"]}),As(Ax,"PerModelAttributes"),As(Cx,"ModelFeature");const Px=new da({visibility:new ca(It.layout_model.visibility),"model-id":new ua(It.layout_model["model-id"])});var Rx={paint:new da({"model-opacity":new ca(It.paint_model["model-opacity"]),"model-rotation":new ua(It.paint_model["model-rotation"]),"model-scale":new ua(It.paint_model["model-scale"]),"model-translation":new ua(It.paint_model["model-translation"]),"model-color":new ua(It.paint_model["model-color"]),"model-color-mix-intensity":new ua(It.paint_model["model-color-mix-intensity"]),"model-type":new ca(It.paint_model["model-type"]),"model-cast-shadows":new ca(It.paint_model["model-cast-shadows"]),"model-receive-shadows":new ca(It.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ca(It.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ua(It.paint_model["model-emissive-strength"]),"model-roughness":new ua(It.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ua(It.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ca(It.paint_model["model-cutoff-fade-range"])}),layout:Px};const Lx=new Float32Array(262144),Dx=new Uint8Array(262144);function Ox(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,Ox(n));return t}const Nx=["","wall","door","roof","window","lamp","logo"];class kx{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Ox(e)}}}}class Fx{constructor(e,t,n,r){this.nodes=e,this.id=t,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const n of t){const t=n.node;this.uploaded?this.updatePbrBuffer(t):Mx(t,e,!0)}for(const e of t)Ex(e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),t=!0);return t}needsReEvaluation(e,t,n){const r=e.transform.projectionOptions,i=e.style.getBrightness(),o=this.brightness!==i;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||zx(n.paint.get("model-color").value,o)||zx(n.paint.get("model-color-mix-intensity").value,o)||zx(n.paint.get("model-roughness").value,o)||zx(n.paint.get("model-emissive-strength").value,o)||zx(n.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=r,this.brightness=i,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),r=this.id.canonical;for(const e of n){const n=e.feature;e.evaluatedScale=t.paint.get("model-scale").evaluate(n,{},r)}}evaluate(e){const t=this.getNodesInfo();for(const n of t){if(!n.node.meshes)continue;const t=n.feature,r=n.node.meshes&&n.node.meshes[0].featureData,i=n.evaluatedColor[2],o=n.evaluatedRMEA[2],s=this.id.canonical;if(n.hasTranslucentParts=!1,r){for(let r=0;r<Nx.length;r++){const i=Nx[r];i.length&&(t.properties.part=i);const o=e.paint.get("model-color").evaluate(t,{},s),a=e.paint.get("model-color-mix-intensity").evaluate(t,{},s);n.evaluatedColor[r]=[o.r,o.g,o.b,a],n.evaluatedRMEA[r][0]=e.paint.get("model-roughness").evaluate(t,{},s),n.evaluatedRMEA[r][2]=e.paint.get("model-emissive-strength").evaluate(t,{},s),n.evaluatedRMEA[r][3]=o.a,n.emissionHeightBasedParams[r]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},s),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0)}delete t.properties.part,Ux(n,i!==n.evaluatedColor[2]||o!==n.evaluatedRMEA[2])}n.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},s),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,n,r){const i=e.findDEMTileFor(n);if(i&&(i.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const t=Hm.create(e,n,i);if(!t)return;4&this.modelTraits&&this.updateDEM(e,t,n,r);for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.vertices||!n.footprint.vertices.length)continue;const r=n.footprint.vertices;let i=t.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)i=Math.min(i,t.getElevationAt(r[e].x,r[e].y,!0,!0));n.elevation=i}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,n,r){let i=t._dem._modifiedForSources[r];if(void 0===i&&(t._dem._modifiedForSources[r]=[],i=t._dem._modifiedForSources[r]),i.includes(n.canonical))return;const o=t._dem.dim;i.push(n.canonical);let s=!1;for(const e of this.getNodesInfo()){const n=e.node;if(!n.footprint||!n.footprint.grid)continue;const r=n.footprint.grid,i=t.tileCoordToPixel(r.min.x,r.min.y),a=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-a.y,i.x),Math.min(i.y,o-a.x));if(l<0)continue;const c=P(l,2,5);let u=Math.max(0,i.x-c),h=Math.max(0,i.y-c),d=Math.min(a.x+c,o-1),p=Math.min(a.y+c,o-1);for(let e=h;e<=p;++e)for(let t=u;t<=d;++t)Dx[e*o+t]=255;let f=0,m=0;for(let e=0;e<r.cellsY;++e)for(let n=0;n<r.cellsX;++n){if(!r.cells[e*r.cellsX+n])continue;const i=t.tileCoordToPixel(r.min.x+n/r.xScale,r.min.y+e/r.yScale),s=t.tileCoordToPixel(r.min.x+(n+1)/r.xScale,r.min.y+(e+1)/r.yScale);for(let e=i.y;e<=Math.min(s.y+1,o-1);++e)for(let n=i.x;n<=Math.min(s.x+1,o-1);++n)255===Dx[e*o+n]&&(Dx[e*o+n]=0,f+=t.getElevationAtPixel(n,e),m++)}const g=f/m;u=Math.max(1,i.x-c),h=Math.max(1,i.y-c),d=Math.min(a.x+c,o-2),p=Math.min(a.y+c,o-2),s=!0;for(let e=h;e<=p;++e)for(let n=u;n<=d;++n)0===Dx[e*o+n]&&(Lx[e*o+n]=t._dem.set(n,e,g));for(let e=1;e<c;++e){u=Math.max(1,i.x-e),h=Math.max(1,i.y-e),d=Math.min(a.x+e,o-2),p=Math.min(a.y+e,o-2);for(let n=h;n<=p;++n)for(let r=u;r<=d;++r){const i=n*o+r;if(255===Dx[i]){let s=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let i=-1;i<=1;++i){const c=(n+t)*o+r+i;if(Dx[c]>=e)continue;const h=Lx[c],d=Math.abs(h);d>a&&(s=h,a=d,l=i,u=t)}if(a>.1){const o=1-(e+.5*Math.abs(l*u))/c;let a=t._dem.get(r,n)+s*o;const h=t._dem.get(r+l,n+u),d=t._dem.get(r-l,n-u,!0);(a-h)*(a-d)>0&&(a=(h+d)/2),Lx[i]=t._dem.set(r,n,a),Dx[i]=e}}}}}s&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ut.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new kx(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)Tx(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const t of e)Ex(t.node),Tx(t.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){const t=r[e].node;r[e].hiddenByReplacement=!!t.footprint&&!n.find((e=>e.footprint===t.footprint))}}getHeightAtTileCoord(e,t){const n=this.getNodesInfo(),r=[];for(let i=0;i<this.nodesInfo.length;i++){const o=n[i],s=o.node.meshes[0];if(e<s.aabb.min[0]||t<s.aabb.min[1]||e>s.aabb.max[0]||t>s.aabb.max[1])continue;const a=(e-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*_x|0,l=Math.min(63,(t-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*_x|0)*_x+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new v(e,t),new v(e,t),r),r.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function zx(e,t){return!e.isLightConstant&&t}function Bx(e,t,n,r,i,o,s,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;n[3]>0&&(l=Xr(l,255*n[0],n[3]),c=Xr(c,255*n[1],n[3]),u=Xr(u,255*n[2],n[3]));const h=l<<8|c,d=u<<8|Math.floor(255*r[3]),p=function(e){const t=P(e,0,2);return Math.min(Math.round(.5*t*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=P(i[0],0,1),m=P(i[1],0,1),g=P(i[2],0,1),y=P(i[3],0,1);let v,_,x,b;if(f!==m&&s!==o&&m!==f){const e=s-o;_=1/(e*(m-f)),x=-(o+e*f)/(e*(m-f));const t=P(i[4],-1,1);b=Math.pow(10,t),v=255*g<<8|255*y}else v=65535,_=0,x=1,b=1;if(e.emplaceBack(h,d,p,v,_,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(h,d,p,v,_,x,b)}}function Ux(e,t){const n=e.node;let r=0;for(const i of n.meshes){if(n.lights&&n.lightMeshIndex===r)continue;if(!i.featureData)continue;i.featureArray=new Ka,i.featureArray.reserve(i.featureData.length);let o=t;for(const t of i.featureData){let r;const s=65535&t,a=(15&s)<8?15&s:0,l=t>>16&65535,c=e.evaluatedRMEA[a],u=e.evaluatedColor[a],h=e.emissionHeightBasedParams[a];if(o&&2===a&&n.lights&&(r=new Ka,r.resize(10*n.lights.length)),Bx(i.featureArray,l,u,c,h,i.aabb.min[2],i.aabb.max[2],r),r&&o){o=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=r,e.featureArray._trim()}}i.featureArray._trim(),r++}}As(Fx,"Tiled3dModelBucket",{omit:["layers"]}),As(kx,"Tiled3dModelFeature");class jx{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=Zx(new v(0,0),new v(ar,ar),e),n=[];for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!Hx(t,r))continue;const i=Wx(r.min,r.max,e);n.push({min:i.min,max:i.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return n}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const n of e.cache.getVisibleCoordinates()){const r=e.cache.getTile(n).buckets[e.layer];if(r)for(const e of r.getNodesInfo()){const r=e.node;r.footprint&&t.push({footprint:r.footprint,id:n.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=Zx(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||Vx(e.min,t.min)||Vx(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,n=0;for(;!e&&t!==this._activeRegions.length;){const r=this._activeRegions[t],i=this._prevRegions[n];e=r.priority!==i.priority||!Gx(r,i),++t,++n}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const n=t[e].priority;for(;e<t.length&&t[e].priority===n;)++e;return e};if(this._sourceIds.length>1){let t=0,n=e(t);for(;t!==n;){let r=t;const i=t;for(;r!==n;){const e=this._activeRegions[r];e.hiddenByOverlap=!1;for(let t=0;t<i;t++){const n=this._activeRegions[t];if(!n.hiddenByOverlap&&Hx(e,n)&&(e.hiddenByOverlap=qx(e.footprint,e.tileId,n.footprint,n.tileId),e.hiddenByOverlap))break}++r}t=n,n=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}}function Vx(e,t){return e.x-t.x||e.y-t.y}function Gx(e,t){return 0===Vx(e.min,t.min)&&0===Vx(e.max,t.max)}function Hx(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Zx(e,t,n){const r=1/ar,i=1/(1<<n.canonical.z),o=(t.x*r+n.canonical.x)*i+n.wrap,s=(t.y*r+n.canonical.y)*i;return{min:new v((e.x*r+n.canonical.x)*i+n.wrap,(e.y*r+n.canonical.y)*i),max:new v(o,s)}}function Wx(e,t,n){const r=1<<n.canonical.z,i=((t.x-n.wrap)*r-n.canonical.x)*ar,o=(t.y*r-n.canonical.y)*ar;return{min:new v(((e.x-n.wrap)*r-n.canonical.x)*ar,(e.y*r-n.canonical.y)*ar),max:new v(i,o)}}function $x(e,t,n,r,i,o,s){const a=e.indices,l=e.vertices,c=[];for(let u=r;u<r+i;u+=3){const r=t[n[u+0]+o],i=t[n[u+1]+o],h=t[n[u+2]+o],d=Math.min(r.x,i.x,h.x),p=Math.max(r.x,i.x,h.x),f=Math.min(r.y,i.y,h.y),m=Math.max(r.y,i.y,h.y);c.length=0,e.grid.query(new v(d,f),new v(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(Tp(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],r,i,h,s))return!0}}return!1}function qx(e,t,n,r){if(!e||!n)return!1;let i=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(n.vertices.length<e.vertices.length)return qx(n,r,e,t);const o=t.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);i=e.vertices.map((e=>new v(e.x*o.x*ar*a-s.x*ar,e.y*o.y*ar*a-s.y*ar)))}return $x(n,i,e.indices,0,e.indices.length,0,0)}const Xx=nm.types,Yx=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Kx=["fill-extrusion-flood-light-ground-radius"],Jx=Math.pow(2,13),Qx=Math.pow(2,15)-1,eb=new v(0,1),tb=2147483648;function nb(e,t,n,r,i,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(r*Jx)<<1)+i,Math.round(a))}function rb(e,t,n,r,i,o){e.emplaceBack(t.x,t.y,(n.x<<1)+r,(n.y<<1)+i,o)}function ib(e,t,n){const r=16384;e.emplaceBack(t.x,t.y,t.z,n[0]*r,n[1]*r,n[2]*r)}class ob{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sb{constructor(){this.centroidXY=new v(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.min=new v(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new v(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new v(this.max.x-this.min.x,this.max.y-this.min.y)}}class ab{constructor(){this.acc=new v(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,n){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===ar)&&t.x===n.x)!=((0===t.y||t.y===ar)&&t.y===n.y)&&this.processBorderOverlap(t,n),r&&this.checkBorderIntersection(t,n)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Xr(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ar!=e.x>ar&&this.addBorderIntersection(1,Xr(t.y,e.y,(ar-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Xr(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ar!=e.y>ar&&this.addBorderIntersection(3,Xr(t.x,e.x,(ar-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){return 0===this.accCount?new v(0,0):new v(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function lb(e,t){const n=e.add(t)._unit(),r=P(e.x*n.x+e.y*n.y,-1,1);var i,o,s;return i=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(i)))/4*Qx*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const cb=[e=>e.x<0,e=>e.x>ar,e=>e.y<0,e=>e.y>ar];function ub(e,t,n,r){const i=[4];if(0===r)return i;n._mult(r);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let e=0;e<4;e++)for(const t of a)if(cb[e](t)){i.push(e);break}return i}class hb{constructor(e){this.vertexArray=new Ta,this.indexArray=new ja,this.programConfigurations=new $l(e.layers,e.zoom,(e=>Kx.includes(e))),this._segments=new dl,this.hiddenByLandmarkVertexArray=new Ja,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,n,r=!1){const i=e.length;if(i>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],n=e[1];a=lb(t.sub(e[i-1])._perp()._unit(),n.sub(t)._perp()._unit())}for(let l=0;l<i;l++){const c=l===i-1?0:l+1,u=e[l],h=e[c],d=e[c===i-1?0:c+1],p=h.sub(u)._perp()._unit(),f=lb(p,d.sub(h)._perp()._unit()),m=a,g=f;if(gb(u,h,t)||r&&yb(u,t)&&yb(h,t)){a=f;continue}const y=s.vertexLength;rb(this.vertexArray,u,h,1,1,m),rb(this.vertexArray,u,h,1,0,m),rb(this.vertexArray,u,h,0,1,g),rb(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const v=ub(u,h,p,n);for(const e of v)this._segmentToGroundQuads[o].push({id:y,region:e}),this._segmentToRegionTriCounts[o][e]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let e=0;e<t;e++)this._segmentToGroundQuads[e].sort(((e,t)=>e.region-t.region));for(let n=0;n<t;n++){const t=this._segmentToGroundQuads[n],r=e[n],i=this._segmentToRegionTriCounts[n];i.reduce(((e,t)=>e+t),0);let o=0;for(let e=0;e<=4;e++){const t=i[e];if(0!==t){let n=this.regionSegments[e];n||(n=this.regionSegments[e]=new dl);const i={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+o,vertexLength:r.vertexLength,primitiveLength:t};n.get().push(i)}o+=t}for(let e=0;e<t.length;e++){const n=t[e].id;this.indexArray.emplaceBack(n,n+1,n+3),this.indexArray.emplaceBack(n,n+3,n+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,n,r,i,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,n,r,i,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,zf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,n,r,i,o){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,n,r,i,o)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const n=e.flags&tb?1:0;for(let r=e.groundVertexArrayOffset;r<t;++r)this.hiddenByLandmarkVertexArray.emplace(r,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Uf.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class db{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ja,this.footprintVertices=new Sa,this.footprintSegments=[],this.layoutVertexArray=new Ea,this.centroidVertexArray=new cl,this.indexArray=new ja,this.programConfigurations=new $l(e.layers,e.zoom,(e=>Yx.includes(e))),this.segments=new dl,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new hb(e),this.maxHeight=0,this.partLookup={}}populate(e,t,n,r){this.features=[],this.hasPattern=Lf("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Qd(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:i,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=cp(i,e);if(!this.layers[0]._featureFilter.filter(new ea(this.zoom),l,n))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:lp(i,n,r),properties:i.properties,type:i.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Df("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,n,{},t.availableImages,r,t.brightness),t.featureIndex.insert(i,c.geometry,s,a,this.index,u)}this.sortBorders(),this.groundEffect.prepareBorderSegments()}addFeatures(e,t,n,r,i,o){for(const e of this.features){const{geometry:s}=e;this.addFeature(e,s,e.index,t,n,r,i,o)}this.sortBorders()}update(e,t,n,r,i){const o=0!==Object.keys(e).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,s,n,r,i),this.groundEffect.update(e,t,s,n,r,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,jf.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Bf.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,r,i,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new v(0,0),new v(ar,ar)],u=s.projection,h="globe"===u.name,d="Polygon"===Xx[e.type],p=new ab;p.centroidDataIndex=this.centroidData.length;const f=new sb,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},r)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},r);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ra);const y=Pf(t,500);for(let e=y.length-1;e>=0;e--){const t=y[e];(0===t.length||(_=t[0]).every((e=>e.x<=0))||_.every((e=>e.x>=ar))||_.every((e=>e.y<=0))||_.every((e=>e.y>=ar)))&&y.splice(e,1)}var _;let x;if(h)x=bb(y,c,r);else{x=[];for(const e of y)x.push({polygon:e,bounds:c})}const b=d?this.edgeRadius:0,w=b>0&&this.zoom<17,S=(e,t)=>{if(0===e.length)return!1;const n=e[e.length-1];return t.x===n.x&&t.y===n.y};for(const{polygon:e,bounds:t}of x){let n=0,i=0;for(const t of e)d&&!t[0].equals(t[t.length-1])&&t.push(t[0]),i+=d?t.length-1:t.length;const o=this.segments.prepareSegment((d?5:4)*i,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length);const s=new ob;if(s.vertexOffset=this.footprintVertices.length,s.indexOffset=3*this.footprintIndices.length,s.ringIndices=[],d){const i=[],a=[];n=o.vertexLength;for(let n=0;n<e.length;n++){const c=e[n];c.length&&0!==n&&a.push(i.length/2);const d=[];let p,f;p=c[1].sub(c[0])._perp()._unit(),s.ringIndices.push(c.length-1);for(let e=1;e<c.length;e++){const t=c[e],n=c[e===c.length-1?1:e+1],s=t.clone();if(b){f=n.sub(t)._perp()._unit();const e=p.add(f)._unit(),r=b*Math.min(4,1/(p.x*e.x+p.y*e.y));s.x+=r*e.x,s.y+=r*e.y,s.x=Math.round(s.x),s.y=Math.round(s.y),p=f}!m||0!==b&&!w||S(d,s)||d.push(s),nb(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),o.vertexLength++,this.footprintVertices.emplaceBack(t.x,t.y),i.push(t.x,t.y),h&&ib(this.layoutVertexExtArray,u.projectTilePoint(s.x,s.y,r),u.upVector(r,s.x,s.y))}m&&(0===b||w)&&(0!==d.length&&S(d,d[0])&&d.pop(),this.groundEffect.addData(d,t,l))}const c=If(i,a);for(let e=0;e<c.length;e+=3)this.footprintIndices.emplaceBack(s.vertexOffset+c[e+0],s.vertexOffset+c[e+1],s.vertexOffset+c[e+2]),this.indexArray.emplaceBack(n+c[e],n+c[e+2],n+c[e+1]),o.primitiveLength++;s.indexCount+=c.length,s.vertexCount+=this.footprintVertices.length-s.vertexOffset}for(let i=0;i<e.length;i++){const s=e[i];p.startRing(f,s[0]);let a=s.length>4&&vb(s[s.length-2],s[0],s[1]),c=b?fb(s[s.length-2],s[0],s[1],b):0;const g=[];let y,v,_;v=s[1].sub(s[0])._perp()._unit();let x=!0;for(let e=1,i=0;e<s.length;e++){let l=s[e-1],d=s[e];const w=s[e===s.length-1?1:e+1];if(p.appendEdge(f,d,l),gb(d,l,t)){b&&(v=w.sub(d)._perp()._unit(),x=!x);continue}const M=d.sub(l)._perp(),E=M.x/(Math.abs(M.x)+Math.abs(M.y)),T=M.y>0?1:0,C=l.dist(d);if(i+C>32768&&(i=0),b){_=w.sub(d)._perp()._unit();let e=mb(l,d,w,pb(v,_),b);isNaN(e)&&(e=0);const t=d.sub(l)._unit();l=l.add(t.mult(c))._round(),d=d.add(t.mult(-e))._round(),c=e,v=_,m&&this.zoom>=17&&(S(g,l)||g.push(l),S(g,d)||g.push(d))}const A=o.vertexLength,I=s.length>4&&vb(l,d,w);let P=_b(i,a,x);if(nb(this.layoutVertexArray,l.x,l.y,E,T,0,0,P),nb(this.layoutVertexArray,l.x,l.y,E,T,0,1,P),i+=C,P=_b(i,I,!x),a=I,nb(this.layoutVertexArray,d.x,d.y,E,T,0,0,P),nb(this.layoutVertexArray,d.x,d.y,E,T,0,1,P),o.vertexLength+=4,this.indexArray.emplaceBack(A+0,A+1,A+2),this.indexArray.emplaceBack(A+1,A+3,A+2),o.primitiveLength+=2,b){const r=n+(1===e?s.length-2:e-2),i=1===e?n:r+1;if(this.indexArray.emplaceBack(A+1,r,A+3),this.indexArray.emplaceBack(r,i,A+3),o.primitiveLength+=2,void 0===y&&(y=A),!gb(w,s[e],t)){const t=e===s.length-1?y:o.vertexLength;this.indexArray.emplaceBack(A+2,A+3,t),this.indexArray.emplaceBack(A+3,t+1,t),this.indexArray.emplaceBack(A+3,i,t+1),o.primitiveLength+=3}x=!x}if(h){const e=this.layoutVertexExtArray,t=u.projectTilePoint(l.x,l.y,r),n=u.projectTilePoint(d.x,d.y,r),i=u.upVector(r,l.x,l.y),o=u.upVector(r,d.x,d.y);ib(e,t,i),ib(e,t,i),ib(e,n,o),ib(e,n,o)}}d&&(n+=s.length-1),m&&b&&this.zoom>=17&&(0!==g.length&&S(g,g[0])&&g.pop(),this.groundEffect.addData(g,t,l,b>0))}this.footprintSegments.push(s),++f.footprintSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?eb:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,o,r,a),this.groundEffect.addPaintPropertiesData(e,n,i,o,r,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0]))}encodeCentroid(e,t){const n=e.centroid(),r=t.span(),i=Math.min(7,Math.round(r.x*this.tileToMeter/10)),o=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new v(P(n.x,1,ar-1)<<3|i,P(n.y,1,ar-1)<<3|o)}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=tb,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,r=e.flags&tb?eb:e.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||i!==r.x){for(let e=t;e<n;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].sourceId!==t[n].sourceId||!Gx(e[n],t[n]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const e of this.centroidData)e.flags&=2147483647;const r=[];for(const t of this.activeReplacements){const n=Math.pow(2,t.footprintTileId.canonical.z-e.canonical.z);for(const i of this.centroidData)if(!(i.flags&tb||t.min.x>i.max.x||i.min.x>t.max.x||t.min.y>i.max.y||i.min.y>t.max.y))for(let o=0;o<i.footprintSegLen;o++){const s=this.footprintSegments[i.footprintSegIdx+o];if(r.length=0,wb(this.footprintVertices,s.vertexOffset,s.vertexCount,t.footprintTileId.canonical,e.canonical,r),$x(t.footprint,r,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-n)){i.flags|=tb;break}}}for(const e of this.centroidData)this.writeCentroidToBuffer(e);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,n){let r=!1;for(let i=0;i<n.footprintSegLen;i++){const o=this.footprintSegments[n.footprintSegIdx+i];let s=0;for(const n of o.ringIndices){for(let i=s,a=n+s-1;i<n+s;a=i++){const n=this.footprintVertices.int16[2*(i+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(i+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>t!=l>t&&e<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-n)*(t-s)/(l-s)+n&&(r=!r)}s=n}}return r}getHeightAtTileCoord(e,t){let n=Number.NEGATIVE_INFINITY,r=!0;const i=4*(e+ar)*ar+(t+ar);if(this.partLookup.hasOwnProperty(i)){const e=this.partLookup[i];return e?{height:e.height,hidden:!!(e.flags&tb)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||this.footprintContainsPoint(e,t,o)&&o&&o.height>n&&(n=o.height,this.partLookup[i]=o,r=!!(o.flags&tb));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:r};this.partLookup[i]=void 0}}function pb(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function fb(e,t,n,r){const i=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return mb(e,t,n,pb(i,o),r)}function mb(e,t,n,r,i){const o=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(n)/3,i*o/r)}function gb(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function yb(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function vb(e,t,n){if(e.x<0||e.x>=ar||t.x<0||t.x>=ar||n.x<0||n.x>=ar)return!1;const r=n.sub(t),i=r.perp(),o=e.sub(t);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&i.x*o.x+i.y*o.y<0}function _b(e,t,n){const r=t?2|e:-3&e;return n?1|r:-2&r}function xb(){const e=Math.PI/32,t=Math.tan(e),n=kd;return n*Math.sqrt(1+2*t*t)-n}function bb(e,t,n){const r=1<<n.z,i=Wd(n.x/r),o=Wd((n.x+1)/r),s=$d(n.y/r),a=$d((n.y+1)/r);return function(e,t,n,r,i=0,o){const s=[];if(!e.length||!n||!r)return s;const a=(e,t)=>{for(const n of e)s.push({polygon:n,bounds:t})},l=Math.ceil(Math.log2(n)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let e=0;e<Math.abs(u);e++)h.push(u>0?0:1);for(let e=0;e<Math.min(l,c);e++)h.push(0),h.push(1);let d=e;if(d=rm(d,t[0].y-i,t[1].y+i,1),d=rm(d,t[0].x-i,t[1].x+i,0),!d.length)return s;const p=[];for(h.length?p.push({polygons:d,bounds:t,depth:0}):a(d,t);p.length;){const e=p.pop(),t=e.depth,n=h[t],r=e.bounds[0],s=e.bounds[1],l=0===n?r.x:r.y,c=0===n?s.x:s.y,u=o?o(n,l,c):.5*(l+c),d=rm(e.polygons,l-i,u+i,n),f=rm(e.polygons,u-i,c+i,n);if(d.length){const e=[r,new v(0===n?u:s.x,1===n?u:s.y)];h.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):a(d,e)}if(f.length){const e=[new v(0===n?u:r.x,1===n?u:r.y),s];h.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):a(f,e)}}return s}(e,t,Math.ceil((o-i)/11.25),Math.ceil((s-a)/11.25),1,((e,t,i)=>{if(0===e)return.5*(t+i);{const e=$d((n.y+t/ar)/r);return(Hd(.5*($d((n.y+i/ar)/r)+e))*r-n.y)*ar}}))}function wb(e,t,n,r,i,o){const s=Math.pow(2,r.z-i.z);for(let a=0;a<n;a++){let n=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];n=(n+i.x*ar)*s-r.x*ar,l=(l+i.y*ar)*s-r.y*ar,o.push(new v(n,l))}}As(db,"FillExtrusionBucket",{omit:["layers","features"]}),As(sb,"PartData"),As(ob,"FootprintSegment"),As(ab,"BorderCentroidData"),As(hb,"GroundEffect");const Sb=new da({visibility:new ca(It["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ca(It["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Mb={paint:new da({"fill-extrusion-opacity":new ca(It["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ua(It["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ca(It["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ca(It["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ua(It["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ua(It["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ua(It["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ca(It["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ca(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ca(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ca(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ca(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ca(It["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ca(It["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ca(It["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ua(It["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ua(It["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ca(It["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ca(It["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ca(It["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ca(It["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"])}),layout:Sb};class Eb extends v{constructor(e,t,n){super(e,t),this.z=n}}function Tb(e,t){return e.x*t.x+e.y*t.y}function Cb(e,t){if(1===e.length){let n=0;const r=t[n++];let i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=i.sub(r),l=o.sub(r),c=s.sub(r),u=Tb(a,a),h=Tb(a,l),d=Tb(l,l),p=Tb(c,a),f=Tb(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,v=r.z*(1-g-y)+i.z*g+o.z*y;if(isFinite(v))return v}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}function Ab(e,t,n,r,i,o,s,a){const l=s*i.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,n){const r=Math.floor(t[0]/8),i=Math.floor(t[1]/8),o=10*(t[0]-8*r),s=10*(t[1]-8*i),a=e.getElevationAt(r,i,!0,!0),l=e.getMeterToDEM(n),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(r,i),d=2*c+1,p=2*u+1,f=function(e,t,n,r,i){return[e.getElevationAtPixel(t,n,!0),e.getElevationAtPixel(t+i,n,!0),e.getElevationAtPixel(t,n+i,!0),e.getElevationAtPixel(t+r,n+i,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),v=Math.min(.25,.5*l*(m+g)/d),_=Math.min(.25,.5*l*y/p);return a+Math.max(v*o,_*s)}(i,o,a):l;return{base:l+(0===n)?-1:n,top:c?Math.max(u+r,l+n+2):l+r}}const Ib=new da({"line-cap":new ua(It.layout_line["line-cap"]),"line-join":new ua(It.layout_line["line-join"]),"line-miter-limit":new ca(It.layout_line["line-miter-limit"]),"line-round-limit":new ca(It.layout_line["line-round-limit"]),"line-sort-key":new ua(It.layout_line["line-sort-key"]),visibility:new ca(It.layout_line.visibility)});var Pb={paint:new da({"line-opacity":new ua(It.paint_line["line-opacity"]),"line-color":new ua(It.paint_line["line-color"]),"line-translate":new ca(It.paint_line["line-translate"]),"line-translate-anchor":new ca(It.paint_line["line-translate-anchor"]),"line-width":new ua(It.paint_line["line-width"]),"line-gap-width":new ua(It.paint_line["line-gap-width"]),"line-offset":new ua(It.paint_line["line-offset"]),"line-blur":new ua(It.paint_line["line-blur"]),"line-dasharray":new ua(It.paint_line["line-dasharray"]),"line-pattern":new ua(It.paint_line["line-pattern"]),"line-gradient":new ha(It.paint_line["line-gradient"]),"line-trim-offset":new ca(It.paint_line["line-trim-offset"]),"line-emissive-strength":new ca(It.paint_line["line-emissive-strength"]),"line-border-width":new ua(It.paint_line["line-border-width"]),"line-border-color":new ua(It.paint_line["line-border-color"])}),layout:Ib};const Rb=(e,t,n,r,i,o,s)=>{const a=e.transform,l=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Ob(e,t,n,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:kb(n)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Db(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:n.paint.get("line-emissive-strength")}},Lb=(e,t,n,r,i)=>{const o=e.transform;return{u_matrix:Ob(e,t,n,r),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_image:0,u_tile_units_to_pixels:Db(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Db(e,t){return 1/X_(e,1,t.tileZoom)}function Ob(e,t,n,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Nb=e=>{const t=[];kb(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return 0===n[0]&&0===n[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER"),t};function kb(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Fb=new class extends ua{possiblyEvaluate(e,t){return t=new ea(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=N({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}(Pb.paint.properties["line-width"].specification);function zb(e,t){return t>0?t+2*e:e}Fb.useIntegerZoom=!0;const Bb=new da({visibility:new ca(It.layout_background.visibility)});var Ub={paint:new da({"background-color":new ca(It.paint_background["background-color"]),"background-pattern":new ca(It.paint_background["background-pattern"]),"background-opacity":new ca(It.paint_background["background-opacity"]),"background-emissive-strength":new ca(It.paint_background["background-emissive-strength"])}),layout:Bb};const jb=new da({visibility:new ca(It.layout_raster.visibility)});var Vb={paint:new da({"raster-opacity":new ca(It.paint_raster["raster-opacity"]),"raster-color":new ha(It.paint_raster["raster-color"]),"raster-color-mix":new ca(It.paint_raster["raster-color-mix"]),"raster-color-range":new ca(It.paint_raster["raster-color-range"]),"raster-hue-rotate":new ca(It.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ca(It.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ca(It.paint_raster["raster-brightness-max"]),"raster-saturation":new ca(It.paint_raster["raster-saturation"]),"raster-contrast":new ca(It.paint_raster["raster-contrast"]),"raster-resampling":new ca(It.paint_raster["raster-resampling"]),"raster-fade-duration":new ca(It.paint_raster["raster-fade-duration"])}),layout:jb};function Gb(e,t,n,r,i,o,s,a){const l=[e,n,i,t,r,o,1,1,1],c=[s,a,1],u=yh.adjoint([],l),[h,d,p]=Eh.transformMat3(c,c,yh.transpose(u,u));return yh.multiply(l,[h,0,0,0,d,0,0,0,p],l)}class Hb extends At{constructor(e,t,n,r){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Tt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ae(this.map._requestManager.transformRequest(this.url,ve.Image),((n,r)=>{if(this._imageRequest=null,this._loaded=!0,n)this.fire(new Ct(n));else if(r){const{HTMLImageElement:n}=t;this.image=r instanceof n?ut.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new vv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof vv||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],n=e[0][1];for(const r of e)r[1]>n&&(n=r[1]),r[1]<t&&(t=r[1]);const r=(n+t)/2;if(r>Xd?this.onNorthPole=!0:r<-Xd&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(ep.fromLngLat);this.tileID=function(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y);const o=Math.max(r-t,i-n),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);return new Nh(s,Math.floor((t+r)/2*a),Math.floor((n+i)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const t=Sy(this.tileID,this.map.transform.projection),[n,r,i,o]=this.coordinates.map((e=>{const n=t.projection.project(e[0],e[1]);return Ey(t,n)._round()}));this.perspectiveTransform=function(e,t,n,r,i,o,s,a,l,c){const u=Gb(0,0,e,0,0,t,e,t),h=Gb(n,r,i,o,s,a,l,c);return yh.multiply(h,yh.adjoint(u,u),h),[h[6]/h[8]*e/ar,h[7]/h[8]*t/ar]}(this.width,this.height,n.x,n.y,r.x,r.y,o.x,o.y,i.x,i.y);const s=this._boundsArray=new Ea;s.emplaceBack(n.x,n.y,0,0),s.emplaceBack(r.x,r.y,ar,0),s.emplaceBack(o.x,o.y,0,ar),s.emplaceBack(i.x,i.y,ar,ar),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(s,Tv.members),this.boundsSegments=dl.simpleSegment(0,0,4,2)}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,n=t.gl;!this._dirty||this.texture instanceof vv||(this.texture?this.texture.update(this.image):(this.texture=new yv(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zb extends ga{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const Wb=new da({visibility:new ca(It.layout_sky.visibility)});var $b={paint:new da({"sky-type":new ca(It.paint_sky["sky-type"]),"sky-atmosphere-sun":new ca(It.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ca(It.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ca(It.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ca(It.paint_sky["sky-gradient-radius"]),"sky-gradient":new ha(It.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ca(It.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ca(It.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ca(It.paint_sky["sky-opacity"])}),layout:Wb};function qb(e,t,n){const r=[0,0,1],i=bh.identity([]);return bh.rotateY(i,i,n?-w(e)+Math.PI:w(e)),bh.rotateX(i,i,-w(t)),Eh.transformQuat(r,r,i),Eh.normalize(r,r)}var Xb={paint:new da({})};const Yb={circle:class extends ga{constructor(e,t){super(e,Lp,t)}createBucket(e){return new dp(e)}queryRadius(e){const t=e;return Cp("circle-radius",this,t)+Cp("circle-stroke-width",this,t)+Ap(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,r,i,o,s,a){const l=Pp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return kp(e,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=Np(this);return{config:new Wl(this,t),defines:n,overrideFog:!1}}},heatmap:class extends ga{createBucket(e){return new jp(e)}constructor(e,t){super(e,Xp,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Cp("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,r,i,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(t,n);return kp(e,r,o,s,a,!0,!0,new v(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Wl(this,t),overrideFog:!1}:{}}},hillshade:class extends ga{constructor(e,t){super(e,Jp,t)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends ga{constructor(e,t){super(e,kf,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new Wl(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Of(e)}queryRadius(){return Ap(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,r,i,o){return!e.queryGeometry.isAboveHorizon&&mp(Ip(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends ga{constructor(e,t){super(e,Mb,t)}createBucket(e){return new db(e)}queryRadius(){return Ap(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,r,i,o,s,a,l){const c=Pp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=[0,0],p=a&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,m=e.tile.getBucket(this);if(p&&m instanceof db){const e=m.centroidVertexArray,t=l+1;t<e.length&&(d[0]=e.geta_centroid_pos0(t),d[1]=e.geta_centroid_pos1(t))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(r=bb([r],[new v(0,0),new v(ar,ar)],e.tileID.canonical).map((e=>e.polygon)).flat());const g=p?a:null,[y,_]=function(e,t,n,r,i,o,s,a,l,c,u){return"globe"===e.projection.name?function(e,t,n,r,i,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,n,r)=>{e[0]=t,e[1]=n,e[2]=r,e[3]=1},y=xb();n>0&&(n+=y),r+=y;for(const y of t){const t=[],v=[];for(const h of y){const d=h.x+i.x,y=h.y+i.y,_=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=n,w=r;if(s){const e=Ab(d,y,n,r,s,a,l,c);b+=e.base,w+=e.top}0!==n?g(f,_.x+x[0]*p*b,_.y+x[1]*p*b,_.z+x[2]*p*b):g(f,_.x,_.y,_.z),g(m,_.x+x[0]*p*w,_.y+x[1]*p*w,_.z+x[2]*p*w),Eh.transformMat4(f,f,o),Eh.transformMat4(m,m,o),t.push(new Eb(f[0],f[1],f[2])),v.push(new Eb(m[0],m[1],m[2]))}h.push(t),d.push(v)}return[h,d]}(e,t,n,r,i,o,s,a,l,c,u):s?function(e,t,n,r,i,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,f=Ab(u,d,t,n,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,hh.transformMat4(h,h,i),h[3]=Math.max(h[3],1e-5);const m=new Eb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,hh.transformMat4(h,h,i),h[3]=Math.max(h[3],1e-5);const g=new Eb(h[0]/h[3],h[1]/h[3],h[2]/h[3]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,n,r,i,o,s,a,l,c):function(e,t,n,r,i){const o=[],s=[],a=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,h=i[8]*n,d=i[9]*n,p=i[10]*n,f=i[11]*n;for(const t of e){const e=[],n=[];for(const o of t){const t=o.x+r.x,s=o.y+r.y,m=i[0]*t+i[4]*s+i[12],g=i[1]*t+i[5]*s+i[13],y=i[2]*t+i[6]*s+i[14],v=i[3]*t+i[7]*s+i[15],_=m+a,x=g+l,b=y+c,w=Math.max(v+u,1e-5),S=m+h,M=g+d,E=y+p,T=Math.max(v+f,1e-5);e.push(new Eb(_/w,x/w,b/w)),n.push(new Eb(S/T,M/T,E/T))}o.push(e),s.push(n)}return[o,s]}(t,n,r,i,o)}(o,r,h,u,c,s,g,d,f,o.center.lat,e.tileID.canonical),x=e.queryGeometry;return function(e,t,n){let r=1/0;mp(n,t)&&(r=Cb(n,t[0]));for(let i=0;i<t.length;i++){const o=t[i],s=e[i];for(let e=0;e<o.length-1;e++){const t=o[e],i=[t,o[e+1],s[e+1],s[e],t];pp(n,i)&&(r=Math.min(r,Cb(n,i)))}}return r!==1/0&&r}(y,_,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends ga{constructor(e,t){super(e,Pb,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof qr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Fb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new gv(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=Nb(this);return{config:new Wl(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=zb(Cp("line-width",this,t),Cp("line-gap-width",this,t)),r=Cp("line-offset",this,t);return n/2+Math.abs(r)+Ap(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,r,i,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=Ip(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*zb(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),l=this.paint.get("line-offset").evaluate(t,n);return l&&(r=function(e,t){const n=[],r=new v(0,0);for(let i=0;i<e.length;i++){const o=e[i],s=[];for(let e=0;e<o.length;e++){const n=o[e],i=o[e+1],a=0===e?r:n.sub(o[e-1])._unit()._perp(),l=e===o.length-1?r:i.sub(n)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(t)._add(n))}n.push(s)}return n}(r,l*e.pixelToTileUnitsFactor)),function(e,t,n){for(let r=0;r<t.length;r++){const i=t[r];if(e.length>=3)for(let t=0;t<i.length;t++)if(wp(e,i[t]))return!0;if(gp(e,i,n))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:Ky,background:class extends ga{constructor(e,t){super(e,Ub,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends ga{constructor(e,t){super(e,Vb,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof Hb&&(e._source.onNorthPole||e._source.onSouthPole))}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Yp({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends ga{constructor(e,t){super(e,$b,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),r=!n,i=e.style.light,o=i.properties.get("position");return r&&"viewport"===i.properties.get("anchor")&&q("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?qb(o.azimuthal,90-o.polar,t):qb(n[0],90-n[1],t)}const n=this.paint.get("sky-gradient-center");return qb(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends ga{constructor(e,t){super(e,Xb)}},model:class extends ga{constructor(e,t){super(e,Rx,t)}createBucket(e){return new Ix(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof bo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function Kb(e,t){return"custom"===e.type?new Zb(e):new Yb[e.type](e,t)}function Jb(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Qb extends At{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new Wp({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:n}of this.requestors)this._notify(e,t,n);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,n){this._validate(e,n)&&(this.images[t][e]=n)}_validate(e,t){let n=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new Ct(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new Ct(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(t.content,t)||(this.fire(new Ct(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let n=0;for(const r of e){if(r[0]<n||r[1]<r[0]||t<r[1])return!1;n=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,n){n.version=this.images[t][e].version+1,this.images[t][e]=n,this.updatedImages[t][e]=!0}removeImage(e,t){const n=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,n){let r=!0;const i=!!this.loaded[t];if(!i)for(const n of e)this.images[t][n]||(r=!1);i||r?this._notify(e,t,n):this.requestors.push({ids:e,scope:t,callback:n})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,t,n){const r={};for(const n of e){this.images[t][n]||this.fire(new Tt("styleimagemissing",{id:n}));const e=this.images[t][n];e?r[n]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:q(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(e){const{width:t,height:n}=this.atlasImage[e];return{width:t,height:n}}getPattern(e,t){const n=this.patterns[t][e],r=this.getImage(e,t);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new xg(n,r);this.patterns[t][e]={bin:n,position:i}}return this._updatePatternAtlas(t),this.patterns[t][e].position}bind(e,t){const n=e.gl;let r=this.atlasTexture[t];r?this.dirty&&(r.update(this.atlasImage[t]),this.dirty=!1):(r=new yv(e,this.atlasImage[t],n.RGBA),this.atlasTexture[t]=r),r.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const t=[];for(const n in this.patterns[e])t.push(this.patterns[e][n].bin);const{w:n,h:r}=vg(t),i=this.atlasImage[e];i.resize({width:n||1,height:r||1});for(const t in this.patterns[e]){const{bin:n}=this.patterns[e][t],r=n.x+1,o=n.y+1,s=this.images[e][t].data,a=s.width,l=s.height;Wp.copy(s,i,{x:0,y:0},{x:r,y:o},{width:a,height:l}),Wp.copy(s,i,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),Wp.copy(s,i,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),Wp.copy(s,i,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),Wp.copy(s,i,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const n of e){if(this.callbackDispatchedThisFrame[t][n])continue;this.callbackDispatchedThisFrame[t][n]=!0;const e=this.images[t][n];Jb(e)&&this.updateImage(n,t,e)}}}const ew=new da({anchor:new ca(It.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return K(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Xr(e.x,t.x,n),y:Xr(e.y,t.y,n),z:Xr(e.z,t.z,n),azimuthal:Xr(e.azimuthal,t.azimuthal,n),polar:Xr(e.polar,t.polar,n)}}}(It.light.position),color:new ca(It.light.color),intensity:new ca(It.light.intensity)});class tw extends At{constructor(e,t="flat"){super(),this._transitionable=new ra(ew),this.setLight(e,t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t,n={}){this._validate(ds,e,n)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&ws(this,e.call(us,N({value:t,style:{glyphs:!0,sprite:!0},styleSpec:It})))}}const nw=new da({source:new ca(It.terrain.source),exaggeration:new ca(It.terrain.exaggeration)});let rw=class extends At{constructor(e,t){super(),this._transitionable=new ra(nw),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}setScope(e){this.scope=e}get(){return this._transitionable.serialize()}set(e){this._transitionable.setTransitionOrValue(e)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new ea(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof bo}};const iw=45,ow=65,sw=.05;function aw(e,t,n,r){const i=R(iw,ow,n),[o,s]=lw(e,r);let a=1-Math.min(1,Math.exp((t-o)/(s-o)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*i*e.alpha}function lw(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function cw(e,t,n,r,i){const o=Eh.transformMat4([],[t,n,r],i.mercatorFogMatrix);return aw(e,Eh.length(o),i.pitch,i._fov)}function uw(e,t,n,r,i,o,s){const a=[[n,r,0],[i,r,0],[i,o,0],[n,o,0]];let l=Number.MAX_VALUE,c=-Number.MAX_VALUE;for(const e of a){const n=Eh.transformMat4([],e,t),r=Eh.length(n);l=Math.min(l,r),c=Math.max(c,r)}return[aw(e,l,s.pitch,s._fov),aw(e,c,s.pitch,s._fov)]}const hw=new da({range:new ca(It.fog.range),color:new ca(It.fog.color),"high-color":new ca(It.fog["high-color"]),"space-color":new ca(It.fog["space-color"]),"horizon-blend":new ca(It.fog["horizon-blend"]),"star-intensity":new ca(It.fog["star-intensity"]),"vertical-range":new ca(It.fog["vertical-range"])});class dw extends At{constructor(e,t){super(),this._transitionable=new ra(hw),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}get state(){const e=this._transform,t="globe"===e.projection.name,n=Md(e.zoom),r=this.properties.get("range"),i=[.5,3];return{range:t?[Xr(i[0],r[0],n),Xr(i[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t={}){if(this._validate(ms,e,t))return;const n=N({},e);for(const e of Object.keys(It.fog))void 0===n[e]&&(n[e]=It.fog[e].default);this._transitionable.setTransitionOrValue(n)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const t=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:R(iw,ow,e))*t.a}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?function(e,t,n){const r=ep.fromLngLat(t),i=n.elevation?n.elevation.getAtPointOrZero(r):0;return cw(e,r.x,r.y,i,n)}(this.state,e,t):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const t=this._transform.calculateFogTileMatrix(e.toUnwrapped());return uw(this.state,t,0,0,ar,ar,this._transform)}getOpacityForBounds(e,t,n,r,i){return this._transform.projection.supportsFog?uw(this.state,e,t,n,r,i,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?lw(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const t=[4,5,6,7];for(const n of t){const t=e.points[n];let r;if(t[2]>=0)r=t;else{const i=e.points[n-4];r=Yr(i,t,i[2]/(i[2]-t[2]))}if(cw(this.state,r[0],r[1],0,this._transform)>=sw)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,n){return(!n||!1!==n.validate)&&ws(this,e.call(us,N({value:t,style:{glyphs:!0,sprite:!0},styleSpec:It})))}}class pw{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fw{constructor(){this.tasks={},this.taskQueue=[],V(["process"],this),this.invoker=new pw(this.process),this.nextId=0}add(e,t){const n=this.nextId++,r=function({type:e,isSymbolTile:t,zoom:n}){return n=n||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-n:"maybePrepare"===e&&t?400-n:500:200-n:100-n}(t);if(0===r){Q();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:r,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Q();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let n=0;n<this.taskQueue.length;n++){const r=this.tasks[this.taskQueue[n]];r.priority<t&&(t=r.priority,e=n)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class mw{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},V(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fw}send(e,t,n,r,i=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Rs(t,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[n];delete this.cancelCallbacks[n],e&&e.cancel()}else if(t.mustQueue||Q()){const e=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add((()=>this.processTask(n,t)),e&&e.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Ls(t.error)):n(null,Ls(t.data)))}else{const n=new Set,r=t.hasCallback?(t,r)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Rs(t):null,data:Rs(r,n)},n)}:e=>{},i=Ls(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],i.source,i.scope)[e[1]](i,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class gw{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=z();const n=this.workerPool.acquire(this.id);for(let e=0;e<n.length;e++){const r=new gw.Actor(n[e],t,this.id);r.name=`Worker ${e}`,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,n){D(this.actors,((n,r)=>{n.send(e,t,r)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}gw.Actor=mw;class yw extends At{constructor(e,t,n,r){super(),this.scope=n,this._options=e,this.properties=new la(t),this._transitionable=new ra(t,new Map(r)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const vw=new da({color:new ca(It.properties_light_ambient.color),intensity:new ca(It.properties_light_ambient.intensity)}),_w=new da({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([e,t]){const n=K([1,e,t]);return{x:n.x,y:n.y,z:n.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Xr(e.x,t.x,n),y:Xr(e.y,t.y,n),z:Xr(e.z,t.z,n)}}}(It.properties_light_directional.direction),color:new ca(It.properties_light_directional.color),intensity:new ca(It.properties_light_directional.intensity),"cast-shadows":new ca(It.properties_light_directional["cast-shadows"]),"shadow-intensity":new ca(It.properties_light_directional["shadow-intensity"])});class xw{constructor(e,t,n,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(e,t){let n,r;if(e instanceof v||"number"==typeof e[0]){const i=v.convert(e);n=[i],r=t.isPointAboveHorizon(i)}else{const i=v.convert(e[0]),o=v.convert(e[1]);n=[i,o],r=C(i,o).every((e=>t.isPointAboveHorizon(e)))}return new xw(n,t.getCameraPoint(),r,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return C(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new v(1,1)):this.screenBounds[1],r=C(t,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(r[3]=this.cameraPoint)),function(e,t){const n=[];for(let r=0;r<e.length;r++){const i=L(r-1,-1,e.length-1),o=L(r+1,-1,e.length-1),s=e[r],a=e[o],l=e[i].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));n.push(s.add(h))}return n}(r,e)}bufferedCameraGeometryGlobe(e){const t=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new v(1,1)):this.screenBounds[1],r=C(t,n,e),i=this.cameraPoint.clone();switch(3*((i.y>t.y)+(i.y>n.y))+((i.x>t.x)+(i.x>n.x))){case 0:r[0]=i,r[4]=i.clone();break;case 1:r.splice(1,0,i);break;case 2:r[1]=i;break;case 3:r.splice(4,0,i);break;case 5:r.splice(2,0,i);break;case 6:r[3]=i;break;case 7:r.splice(3,0,i);break;case 8:r[2]=i}return r}containsTile(e,t,n,r=0){const i=e.queryPadding/t._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(i,t):this._bufferedScreenMercator(i,t);let s=e.tileID.wrap+(o.unwrapped?r:0);const a=o.polygon.map((t=>Ey(e.tileTransform,t,s)));if(!Sp(a,0,0,ar,ar))return;s=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const l=this.screenGeometryMercator.polygon.map((t=>Ty(e.tileTransform,t,s))),c=l.map((e=>new v(e[0],e[1]))),u=t.getFreeCameraOptions().position||new ep(0,0,0),h=Ty(e.tileTransform,u,s),d=l.map((e=>{const t=Eh.sub(e,e,h);return Eh.normalize(t,t),new Uh(h,t)})),p=X_(e,1,t.zoom)*t._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:d,bufferedTilespaceGeometry:a,bufferedTilespaceBounds:(f=T(a),f.min.x=P(f.min.x,0,ar),f.min.y=P(f.min.y,0,ar),f.max.x=P(f.max.x,0,ar),f.max.y=P(f.max.y,0,ar),f),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var f}_bufferedScreenMercator(e,t){const n=Sw(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[n]=r,r}}_bufferedCameraMercator(e,t){const n=Sw(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[n]=r,r}}_projectAndResample(e,t){const n=function(e,t){const n=_h.multiply([],t.pixelMatrix,t.globeMatrix),r=[0,-Yh,0,1],i=[0,Yh,0,1],o=[0,0,0,1];hh.transformMat4(r,r,n),hh.transformMat4(i,i,n),hh.transformMat4(o,o,n);const s=new v(r[0]/r[3],r[1]/r[3]),a=new v(i[0]/i[3],i[1]/i[3]),l=wp(e,s)&&r[3]<o[3],c=wp(e,a)&&i[3]<o[3];if(!l&&!c)return null;const u=function(e,t,n){for(let r=1;r<e.length;r++){const i=ww(t.pointCoordinate3D(e[r-1]).x),o=ww(t.pointCoordinate3D(e[r]).x);if(n<0){if(i<o)return{idx:r,t:-i/(o-1-i)}}else if(o<i)return{idx:r,t:(1-i)/(o+1-i)}}return null}(e,t,l?-1:1);if(!u)return null;const{idx:h,t:d}=u;let p=h>1?bw(e.slice(0,h),t):[],f=h<e.length?bw(e.slice(h),t):[];p=p.map((e=>new v(ww(e.x),e.y))),f=f.map((e=>new v(ww(e.x),e.y)));const m=[...p];0===m.length&&m.push(f[f.length-1]);const g=Xr(m[m.length-1].y,(0===f.length?p[0]:f[0]).y,d);let y;return y=l?[new v(0,g),new v(0,0),new v(1,0),new v(1,g)]:[new v(1,g),new v(1,1),new v(0,1),new v(0,g)],m.push(...y),0===f.length?m.push(p[0]):m.push(...f),{polygon:m.map((e=>new ep(e.x,e.y))),unwrapped:!1}}(e,t);if(n)return n;const r=function(e,t){let n=!1,r=-1/0,i=0;for(let t=0;t<e.length-1;t++)e[t].x>r&&(r=e[t].x,i=t);for(let t=0;t<e.length-1;t++){const r=(i+t)%(e.length-1),o=e[r],s=e[r+1];Math.abs(o.x-s.x)>.5&&(o.x<s.x?(o.x+=1,0===r&&(e[e.length-1].x+=1)):(s.x+=1,r+1===e.length-1&&(e[0].x+=1)),n=!0)}const o=Gd(t.center.lng);return n&&o<Math.abs(o-1)&&e.forEach((e=>{e.x-=1})),{polygon:e,unwrapped:n}}(bw(e,t).map((e=>new v(ww(e.x),e.y))),t);return{polygon:r.polygon.map((e=>new ep(e.x,e.y))),unwrapped:r.unwrapped}}}function bw(e,t){return np(e,(e=>{const n=t.pointCoordinate3D(e);e.x=n.x,e.y=n.y}),1/256)}function ww(e){return e<0?1+e%1:e%1}function Sw(e){return 100*e|0}function Mw(e,t,n,r,i){const o=function(n,r){if(n)return i(n);if(r){e.url&&r.tiles&&e.tiles&&delete e.tiles;const n=k(N(r,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),n.tiles=t.canonicalizeTileset(n,e.url),i(null,n)}};return e.url?we(t.transformRequest(t.normalizeSourceURL(e.url,null,n,r),ve.Source),o):ut.frame((()=>o(null,e)))}class Ew{constructor(e,t,n){this.bounds=Ql.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=Math.pow(2,e.z),n=Math.floor(Gd(this.bounds.getWest())*t),r=Math.floor(Hd(this.bounds.getNorth())*t),i=Math.ceil(Gd(this.bounds.getEast())*t),o=Math.ceil(Hd(this.bounds.getSouth())*t);return e.x>=n&&e.x<i&&e.y>=r&&e.y<o}}class Tw{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Zp({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=U(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const r=[];let i=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;r.push({left:i,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];i=a*n,a+=l,o=a*n,r.push({left:i,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(e,t,n){const r=t/2;for(let t=-n;t<=n;t++){const i=this.width*(this.nextRow+n+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/n*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.image.data[i+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const n=e[t],r=e[t+1];n.zeroLength?e.splice(t,1):r&&r.isDash===n.isDash&&(r.left=n.left,e.splice(t,1))}const n=e[0],r=e[e.length-1];n.isDash===r.isDash&&(n.left=r.left-this.width,r.right=n.right+this.width);const i=this.width*this.nextRow;let o=0,s=e[o];for(let n=0;n<this.width;n++){n/s.right>1&&(s=e[++o]);const r=Math.abs(n-s.left),a=Math.abs(n-s.right),l=Math.min(r,a);this.image.data[i+n]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const r="round"===t,i=r?7:0,o=2*i+1;if(this.nextRow+o>this.height)return q("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(q("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const n=this.width/s,o=this.getDashRanges(e,this.width,n);r?this.addRoundDash(o,n,i):this.addRegularDash(o,"square"===t?.5*n:0)}const a=this.nextRow+i;this.nextRow+=o;const l={tl:[a,i],br:[s,0]};return this.positions[n]=l,l}}As(Tw,"LineAtlas");const Cw=1*Yg;class Aw{constructor(e){const t={},n=[];for(const r in e){const i=e[r],o=t[r]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?Cw:1,s={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};n.push(s),o[e]=s}}const{w:r,h:i}=vg(n),o=new Zp({width:r||1,height:i||1});for(const n in e){const r=e[n];for(const e in r.glyphs){const i=r.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const s=t[n][e],a=i.metrics.localGlyph?Cw:1;Zp.copy(i.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},i.bitmap)}}this.image=o,this.positions=t}}As(Aw,"GlyphAtlas");class Iw{constructor(e){this.tileID=new Fh(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Sy(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,t,n,r,i){this.status="parsing",this.data=e,this.collisionBoxArray=new el;const o=new im(Object.keys(e.layers).sort()),s=new Zm(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Tw(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n,brightness:this.brightness},u=t.familiesBySource[this.source];for(const t in u){const r=e.layers[t];if(!r)continue;let i=!1,l=!1,h=!1;for(const e of u[t])"symbol"===e[0].type?i=!0:l=!0,e[0].is3D()&&"model"!==e[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!i)continue;if(!1===this.isSymbolTile&&!l)continue;1===r.version&&q(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const d=o.encode(t),p=[];for(let e=0;e<r.length;e++){const n=r.feature(e),i=s.getId(n,t);p.push({feature:n,id:i,index:e,sourceLayerIndex:d})}for(const e of u[t]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Pw(e,this.zoom,c.brightness,n),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:d,sourceID:this.source,projection:this.projection.spec})).populate(p,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map((e=>e.id)))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(h)return i(h);if(this.extraShadowCaster)this.status="done",i(null,{buckets:O(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(d&&p&&f){const e=new Aw(d),t=new bg(p,f);for(const r in a){const i=a[r];i instanceof cv?(Pw(i.layers,this.zoom,c.brightness,n),dy(i,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):i.hasPattern&&(i instanceof gv||i instanceof Of||i instanceof db)&&(Pw(i.layers,this.zoom,c.brightness,n),i.addFeatures(c,this.tileID.canonical,t.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",i(null,{buckets:O(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,brightness:c.brightness})}};if(!this.extraShadowCaster){const e=H(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(e).length?r.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((e,t)=>{h||(h=e,d=t,g())}),void 0,!1,m):d={};const t=Object.keys(c.iconDependencies);t.length?r.send("getImages",{icons:t,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,g())}),void 0,!1,m):p={};const n=Object.keys(c.patternDependencies);n.length?r.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,g())}),void 0,!1,m):f={}}g()}}function Pw(e,t,n,r){const i=new ea(t,{brightness:n});for(const t of e)t.recalculate(i,r)}class Rw{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,r){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,n]=i.result;return this.scheduler?this.scheduler.add((()=>{r(e,n)}),t):r(e,n),()=>{}}return i.callbacks.push(r),i.cancel||(i.cancel=n(((n,r)=>{i.result=[n,r];for(const e of i.callbacks)this.scheduler?this.scheduler.add((()=>{e(n,r)}),t):e(n,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{i.result||(i.callbacks=i.callbacks.filter((e=>e!==r)),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}}function Lw(e,t,n){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=Se(e.request,((e,r,i,o)=>{e?t(e):r&&t(null,{vectorTile:n?void 0:new tm(new Cm(r)),rawData:r,cacheControl:i,expires:o})}));return()=>{r.cancel(),t()}}),t)}class Dw extends At{constructor(e,t,n,r){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,N(this,k(t,["url","scheme","tileSize","promoteId"])),this._options=N({type:"vector"},t),this._collectResourceTiming=!!t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new Rw}load(e){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Mw(this._options,this.map._requestManager,t,n,((r,i)=>{this._tileJSONRequest=null,this._loaded=!0,r?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new Ct(r))):i&&(N(this,i),i.bounds&&(this.tileBounds=new Ew(i.bounds,this.minzoom,this.maxzoom)),Ge(i.tiles,this.map._requestManager._customAccessToken),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=pa(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return N({},this._options)}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,ve.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ut.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=t:e.request=e.actor.send("reloadTile",r,i.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,i.bind(this),void 0,!0);else{const t=Lw.call({deduped:this._deduped},r,((t,n)=>{t||!n?i.call(this,t):(r.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,i.bind(this),void 0,!0))}),!0);e.request={cancel:t}}function i(n,r){return delete e.request,e.aborted?t(null):n&&404!==n.status?t(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),ye(this.dispatcher),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ow extends At{constructor(e,t,n,r){super(),this.id=e,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=N({type:"raster"},t),N(this,k(t,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"})),this._tileJSONRequest=Mw(this._options,this.map._requestManager,null,null,((t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new Ct(t)):n&&(N(this,n),n.bounds&&(this.tileBounds=new Ew(n.bounds,this.minzoom,this.maxzoom)),Ge(n.tiles),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(t)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const e=pa(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return N({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const n=ut.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=Ae(this.map._requestManager.transformRequest(r,ve.Tile),((n,r,i,o)=>(delete e.request,e.aborted?(e.state="unloaded",t(null)):n?(e.state="errored",t(n)):r?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:i,expires:o}),e.setTexture(r,this.map.painter),e.state="loaded",ye(this.dispatcher),void t(null)):t(null))))}static loadTileData(e,t,n){e.setTexture(t,n)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Nw;function kw(){return null!=cA.workerClass?new cA.workerClass:new t.Worker(cA.workerUrl)}const Fw="mapboxgl_preloaded_worker_pool";class zw{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<zw.workerCount;)this.workers.push(new kw);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Fw]}numActive(){return Object.keys(this.active).length}}let Bw;function Uw(){return Bw||(Bw=new zw),Bw}zw.workerCount=2;let jw,Vw,Gw,Hw=null;function Zw(){return Q()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Vw||i.DRACO_URL}const Ww=5123,$w=5126,qw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Ww]:Uint16Array,5125:Uint32Array,[$w]:Float32Array},Xw={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Ww]:"DT_UINT16",5125:"DT_UINT32",[$w]:"DT_FLOAT32"},Yw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Kw(e,t,n){const r=n.json.bufferViews.length,i=n.buffers.length;t.bufferView=r,n.json.bufferViews[r]={buffer:i,byteLength:e.byteLength},n.buffers[i]=e}const Jw="KHR_draco_mesh_compression";function Qw(e,t){const n=e.extensions&&e.extensions[Jw];if(!n)return;const r=new Gw.Decoder,i=iS(t,n.bufferView),o=new Gw.Mesh;if(!r.DecodeArrayToMesh(i,i.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=qw[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=Gw._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(o,l,c):r.GetTrianglesUInt32Array(o,l,c),Kw(Gw.memory.buffer.slice(c,c+l),s,t),Gw._free(c);for(const i of Object.keys(n.attributes)){const s=r.GetAttributeByUniqueId(o,n.attributes[i]),a=t.json.accessors[e.attributes[i]],l=Xw[a.componentType],c=a.count*Yw[a.type]*qw[a.componentType].BYTES_PER_ELEMENT,u=Gw._malloc(c);r.GetAttributeDataArrayForAllPoints(o,s,Gw[l],c,u),Kw(Gw.memory.buffer.slice(u,u+c),a,t),Gw._free(u)}r.destroy(),o.destroy(),delete e.extensions[Jw]}const eS=1179937895,tS=new TextDecoder("utf8");function nS(e,t){return new URL(e,t).href}function rS(e,t,n,r){return fetch(nS(e.uri,r)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[n]=e}))}function iS(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function oS(e,n,r,i){if(e.uri){const o=nS(e.uri,i);return fetch(o).then((e=>e.blob())).then((e=>t.createImageBitmap(e))).then((e=>{n.images[r]=e}))}if(void 0!==e.bufferView){const i=iS(n,e.bufferView),o=new t.Blob([i],{type:e.mimeType});return t.createImageBitmap(o).then((e=>{n.images[r]=e}))}}function sS(e,t=0,n){const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===eS){const n=new Uint32Array(e,t);let i=2;const o=(n[i++]>>2)-3,s=n[i++]>>2;if(i++,r.json=JSON.parse(tS.decode(n.subarray(i,i+s))),i+=s,i<o){const o=n[i++];i++;const s=t+(i<<2);r.buffers[0]=e.slice(s,s+o)}}else r.json=JSON.parse(tS.decode(new Uint8Array(e,t)));const{buffers:i,images:o,meshes:s,extensionsUsed:a}=r.json;let l=Promise.resolve();if(i){const e=[];for(let t=0;t<i.length;t++){const o=i[t];o.uri?e.push(rS(o,r,t,n)):r.buffers[t]||(r.buffers[t]=null)}l=Promise.all(e)}return l.then((()=>{const e=[],t=a&&a.includes(Jw);if(t&&e.push(function(){if(!Gw)return jw||(jw=function(e){let t,n=null;function r(){t=new Uint8Array(n.buffer)}function i(){throw new Error("Unexpected Draco error.")}const o={a:{a:i,d:function(e,n,r){return t.copyWithin(e,n,n+r)},c:function(e){const i=t.length,o=Math.max(e>>>0,Math.ceil(1.2*i)),s=Math.ceil((o-i)/65536);try{return n.grow(s),r(),!0}catch(e){return!1}},b:i}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,o)))).then((e=>{const{Rb:i,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:d,Wa:p,eb:f,jb:m,f:g,e:y,yb:v,zb:_,Ab:x,Bb:b,Db:w,Gb:S}=e.instance.exports;n=y;const M=(()=>{let e=0,n=0,r=0,s=0;return a=>{r&&(i(s),i(e),n+=r,r=e=0),e||(n+=128,e=o(n));const l=a.length+7&-8;let c=e;l>=n&&(r=l,c=s=o(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return r(),g(),{memory:y,_free:i,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,n){const r=M(e),i=u(this.ptr,r,t,n.ptr);return!!l(i)}GetAttributeByUniqueId(e,t){return{ptr:h(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,n){d(this.ptr,e.ptr,t,n)}GetTrianglesUInt32Array(e,t,n){p(this.ptr,e.ptr,t,n)}GetAttributeDataArrayForAllPoints(e,t,n,r,i){f(this.ptr,e.ptr,t.ptr,n,r,i)}},DT_INT8:v(),DT_UINT8:_(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}}))}(fetch(Zw())),jw.then((e=>{Gw=e,jw=void 0})))}()),o)for(let t=0;t<o.length;t++)e.push(oS(o[t],r,t,n));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&s)for(const{primitives:e}of s)for(const t of e)Qw(t,r);return r}))}))}function aS(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>sS(t,0,e)))}class lS{constructor(e,t,n){if(this.triangleCount=t.length/3,this.min=new v(0,0),this.max=new v(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length||0===n)return;const r=e.map((e=>e.x)),i=e.map((e=>e.y));this.min=new v(Math.min(...r),Math.min(...i)),this.max=new v(Math.max(...r),Math.max(...i));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/n;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let n=0;n<this.triangleCount;n++){const r=e[t[3*n+0]].sub(this.min),i=e[t[3*n+1]].sub(this.min),o=e[t[3*n+2]].sub(this.min),l=cS(Math.floor(Math.min(r.x,i.x,o.x)),this.xScale,this.cellsX),c=cS(Math.floor(Math.max(r.x,i.x,o.x)),this.xScale,this.cellsX),u=cS(Math.floor(Math.min(r.y,i.y,o.y)),this.yScale,this.cellsY),h=cS(Math.floor(Math.max(r.y,i.y,o.y)),this.yScale,this.cellsY),d=new v(0,0),p=new v(0,0),f=new v(0,0),m=new v(0,0);for(let e=u;e<=h;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=l;t<=c;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(Tp(r,i,o,d,p,m)||Tp(r,i,o,d,m,f))&&a.push({cellIdx:e*this.cellsX+t,triIdx:n})}}if(0===a.length)return;a.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let l=0;for(;l<a.length;){const e=a[l].cellIdx,t={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===e;)++t.len,this.payload.push(a[l++].triIdx);this.cells[e]=t}}query(e,t,n){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let e=0;e<this.lookup.length;e++)this.lookup[e]=0;const r=cS(e.x-this.min.x,this.xScale,this.cellsX),i=cS(t.x-this.min.x,this.xScale,this.cellsX),o=cS(e.y-this.min.y,this.yScale,this.cellsY),s=cS(t.y-this.min.y,this.yScale,this.cellsY);for(let e=o;e<=s;e++)for(let t=r;t<=i;t++){const r=this.cells[e*this.cellsX+t];if(r)for(let e=0;e<r.len;e++){const t=this.payload[r.start+e],i=Math.floor(t/8),o=1<<t%8;if(!(this.lookup[i]&o)&&(this.lookup[i]|=o,n.push(t),n.length===this.triangleCount))return}}}}function cS(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function uS(e,t){const n=e.json.bufferViews[t.bufferView];return new(0,qw[t.componentType])(e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*Yw[t.type])}function hS(e,t,n){const r=e.indices,i=e.attributes,o={};o.indexArray=new ja;const s=t.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const l=uS(t,s);for(let e=0;e<a;e++)o.indexArray.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);o.indexArray._trim(),o.vertexArray=new Ua;const c=t.json.accessors[i.POSITION];o.vertexArray.reserve(c.count);const u=uS(t,c);for(let e=0;e<c.count;e++)o.vertexArray.emplaceBack(u[3*e],u[3*e+1],u[3*e+2]);if(o.vertexArray._trim(),o.aabb=new $h(c.min,c.max),o.centroid=function(e,t){const n=[0,0,0],r=e.length;if(r>0){for(let i=0;i<r;i++){const r=3*e[i];n[0]+=t[r],n[1]+=t[r+1],n[2]+=t[r+2]}n[0]/=r,n[1]/=r,n[2]/=r}return n}(l,u),void 0!==i.COLOR_0){const e=t.json.accessors[i.COLOR_0],n=Yw[e.type];if(e.componentType===$w){o.colorArray=3===n?new Ua:new Aa,o.colorArray.reserve(e.count);const r=uS(t,e);if(3===n)for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(r[3*t],r[3*t+1],r[3*t+2]);else for(let t=0;t<e.count;t++)o.colorArray.emplaceBack(r[4*t],r[4*t+1],r[4*t+2],r[4*t+3]);o.colorArray._trim()}else if(e.componentType===Ww&&4===n){o.colorArray=new Aa,o.colorArray.resize(e.count);const n=uS(t,e),r=1/65535,i=o.colorArray.float32;for(let e=0;e<4*n.length;++e)i[e]=n[e]*r}else q(`glTF color buffer parsing for accessor ${JSON.stringify(e)} is not supported`)}if(void 0!==i.NORMAL){o.normalArray=new Ua;const e=t.json.accessors[i.NORMAL];o.normalArray.reserve(e.count);const n=uS(t,e);for(let t=0;t<e.count;t++)o.normalArray.emplaceBack(n[3*t],n[3*t+1],n[3*t+2]);o.normalArray._trim()}if(void 0!==i.TEXCOORD_0&&n.length>0){o.texcoordArray=new Xa;const e=t.json.accessors[i.TEXCOORD_0];o.texcoordArray.reserve(e.count);const n=uS(t,e);for(let t=0;t<e.count;t++)o.texcoordArray.emplaceBack(n[2*t],n[2*t+1]);o.texcoordArray._trim()}const h=e.material;return o.material=function(e,t){const{emissiveFactor:n=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:i=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new cn(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:n,alphaMode:r,alphaCutoff:i,normalTexture:o?t[o.index]:void 0,occlusionTexture:s?t[s.index]:void 0,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==h?t.json.materials[h]:{defined:!1},n),void 0!==i._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(uS(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer)),o}function dS(e,t,n){const{matrix:r,rotation:i,translation:o,scale:s,mesh:a,extras:l,children:c}=e,u={};if(u.matrix=r||_h.fromRotationTranslationScale([],i||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==a){u.meshes=n[a];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:n,max:r}=t.aabb;e[0]+=n[0]+r[0],e[1]+=n[1]+r[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(l&&(l.id&&(u.id=l.id),l.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.codePointAt(e);return n}(e),n=[],r=t.length/24,i=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let e=0;e<r;e++){const t=i[2*e*6]/30,r=i[2*e*6+1]/30,s=i[2*e*6+10]/100,a=o[6*e+1],l=o[6*e+2],c=o[6*e+3],u=o[6*e+4],h=c-a,d=u-l,p=Math.hypot(h,d);n.push({pos:[a+.5*h,l+.5*d,r],normal:[d/p,-h/p,0],width:p,height:t,depth:s,points:[a,l,c,u]})}return n}(l.lights))),c){const e=[];for(const r of c)e.push(dS(t.json.nodes[r],t,n));u.children=e}return u}function pS(e){if(0===e.vertices.length||0===e.indices.length)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let r=1;r<e.vertices.length;++r){const i=e.vertices[r];t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),n.x=Math.max(n.x,i.x),n.y=Math.max(n.y,i.y)}const r=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),i=Math.max(8,r),o=new lS(e.vertices,e.indices,i);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:n}}function fS(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const n=t[0];if(!n||!Array.isArray(n)||0===n.length)return null;const r=[];for(const e of n){if(!Array.isArray(e)||2!==e.length)continue;const t=e[0],n=e[1];"number"==typeof t&&"number"==typeof n&&r.push(new v(t,n))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let i=0;for(let e=0;e<r.length;e++){const t=r[e],n=r[(e+1)%r.length],o=r[(e+2)%r.length];i+=(t.x-n.x)*(o.y-n.y)-(o.x-n.x)*(t.y-n.y)}i>0&&r.reverse();const o=If(r.flatMap((e=>[e.x,e.y])),[]);return 0===o.length?null:{vertices:r,indices:o}}function mS(e){const t=[],n=[];let r=0;for(const i of e){r=t.length;const e=i.vertexArray.float32,o=i.indexArray.uint16;for(let n=0;n<i.vertexArray.length;n++)t.push(new v(e[3*n+0],e[3*n+1]));for(let e=0;e<3*i.indexArray.length;e++)n.push(o[e]+r)}if(n.length%3!=0)return null;for(let e=0;e<n.length;e+=3){const r=t[n[e+0]],i=t[n[e+1]],o=t[n[e+2]];(r.x-i.x)*(o.y-i.y)-(o.x-i.x)*(r.y-i.y)>0&&([n[e+1],n[e+2]]=[n[e+2],n[e+1]])}return{vertices:t,indices:n}}function gS(e){const n=function(e,n){const r=[],i=t.WebGL2RenderingContext;if(e.json.textures)for(const t of e.json.textures){const o={magFilter:i.LINEAR,minFilter:i.NEAREST,wrapS:i.REPEAT,wrapT:i.REPEAT};void 0!==t.sampler&&Object.assign(o,e.json.samplers[t.sampler]),r.push({image:n[t.source],sampler:o,uploaded:!1})}return r}(e,e.images),r=function(e,t){const n=[];for(const r of e.json.meshes){const i=[];for(const n of r.primitives)i.push(hS(n,e,t));n.push(i)}return n}(e,n),{scenes:i,scene:o,nodes:s}=e.json,a=i?i[o||0].nodes:s,l=[];for(const t of a)l.push(dS(s[t],e,r));return function(e,t,n){const r={},i=new Set;for(let o=0;o<e.length;o++){const e=n[t[o]];if(!e.extras)continue;const s=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(s||a)&&i.add(o),"1.0.0"===s&&a&&(r[a]=o)}for(let o=0;o<e.length;o++){if(i.has(o))continue;const s=e[o],a=n[t[o]];if(!a.extras)continue;let l=null;s.id in r&&(l=mS(e[r[s.id]].meshes)),l||(l=fS(a)),l&&(s.footprint=pS(l))}if(i.size>0){const t=Array.from(i.values()).sort(((e,t)=>e-t));for(let n=t.length-1;n>=0;n--)e.splice(t[n],1)}}(l,a,e.json.nodes),l}function yS(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,r=e.aabb.min[1]-1,i=_x/(e.aabb.max[0]-n+2),o=_x/(e.aabb.max[1]-r+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],l=(t[s+0]-n)*i|0,c=(t[s+1]-r)*o|0;a>e.heightmap[c*_x+l]&&(e.heightmap[c*_x+l]=a)}}function vS(e,t){const n={};n.indexArray=new ja,n.indexArray.reserve(4*e.length),n.vertexArray=new Ua,n.vertexArray.reserve(10*e.length),n.colorArray=new Aa,n.vertexArray.reserve(10*e.length);let r=0;for(const i of e){const e=Math.min(10,Math.max(4,1.3*i.height))*t,o=[-i.normal[1],i.normal[0],0],s=Math.min(.29,.1*i.width/i.depth),a=i.width-2*i.depth*t*(s+.01),l=Eh.scaleAndAdd([],i.pos,o,a/2),c=Eh.scaleAndAdd([],i.pos,o,-a/2),u=[l[0],l[1],l[2]+i.height],h=[c[0],c[1],c[2]+i.height],d=Eh.scaleAndAdd([],i.normal,o,s);Eh.scale(d,d,e);const p=Eh.scaleAndAdd([],i.normal,o,-s);Eh.scale(p,p,e),Eh.add(d,l,d),Eh.add(p,c,p),l[2]+=.1,c[2]+=.1,n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(h[0],h[1],h[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]);const f=a/e/2;n.colorArray.emplaceBack(-f-s,-1,f,.8),n.colorArray.emplaceBack(f+s,-1,f,.8),n.colorArray.emplaceBack(-f,0,f,1.3),n.colorArray.emplaceBack(f,0,f,1.3),n.colorArray.emplaceBack(f+s,-.8,f,.7),n.colorArray.emplaceBack(f+s,-.8,f,.7),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(0,0,f,1.3),n.colorArray.emplaceBack(f+s,-1.2,f,.8),n.colorArray.emplaceBack(f+s,-1.2,f,.8),n.indexArray.emplaceBack(6+r,4+r,8+r),n.indexArray.emplaceBack(7+r,9+r,5+r),n.indexArray.emplaceBack(0+r,1+r,2+r),n.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const i={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=cn.white,i.pbrMetallicRoughness=o,n.material=i,n.aabb=new $h([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}As(lS,"TriangleGridIndex");const _S={vector:Dw,raster:Ow,"raster-dem":class extends Ow{constructor(e,t,n,r){super(e,t,n,r),this.type="raster-dem",this.maxzoom=22,this._options=N({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,n){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);e.request=Ae(this.map._requestManager.transformRequest(r,ve.Tile),function(r,s,a,l){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(s){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:a,expires:l});const n=t.ImageBitmap&&s instanceof t.ImageBitmap&&(null==Nw&&(Nw=t.OffscreenCanvas&&new t.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.createImageBitmap),Nw),r=1-(s.width-((c=s.width)<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))))/2;r<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const u=n?s:ut.getImageData(s,r),h={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:u,encoding:this.encoding,padding:r,convertToFloat:i};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",h,o.bind(this),void 0,!0))}var c}.bind(this));const i=this.map?.painter?.terrainUseFloatDEM();function o(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),r=(t.x-1+n)%n,i=0===t.x?e.wrap-1:e.wrap,o=(t.x+1+n)%n,s=t.x+1===n?e.wrap+1:e.wrap,a={};return a[new Fh(e.overscaledZ,i,t.z,r,t.y).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y).key]={backfilled:!1},t.y>0&&(a[new Fh(e.overscaledZ,i,t.z,r,t.y-1).key]={backfilled:!1},a[new Fh(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<n&&(a[new Fh(e.overscaledZ,i,t.z,r,t.y+1).key]={backfilled:!1},a[new Fh(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},a[new Fh(e.overscaledZ,s,t.z,o,t.y+1).key]={backfilled:!1}),a}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.hillshadeFBO&&(e.hillshadeFBO.destroy(),delete e.hillshadeFBO),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends At{constructor(e,t,n,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=t.data,this._options=N({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const i=ar/this.tileSize;this.workerOptions=N({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*i,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*i,extent:ar,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:ar,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*i,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Tt("dataloading",{dataType:"source"})),this._loaded=!1;const e=N({},this.workerOptions);e.scope=this.scope;const t=this._data;"string"==typeof t?(e.request=this.map._requestManager.transformRequest(ut.resolveURL(t),ve.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new Ct(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new Tt("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const r={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ut.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,r,((r,i)=>(delete e.request,e.unloadVectorData(),e.aborted?t(null):r?t(r):(e.loadVectorData(i,this.map.painter,"reloadTile"===n),t(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return N({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Hb{constructor(e,t,n,r){super(e,t,n,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,ve.Source).url);!function(e,n){const r=t.document.createElement("video");r.muted=!0,r.onloadstart=function(){n(null,r)};for(let n=0;n<e.length;n++){const i=t.document.createElement("source");Me(e[n])||(r.crossOrigin="Anonymous"),i.src=e[n],r.appendChild(i)}}(this.urls,((e,t)=>{this._loaded=!0,e?this.fire(new Ct(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Ct(new Pt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new yv(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Hb,model:class extends At{constructor(e,t,n,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],r=aS(this.map._requestManager.transformRequest(n.uri,ve.Model).url).then((e=>{if(!e)return;const r=gS(e),i=new bx(t,n.position,n.orientation,r);i.computeBoundsAndApplyParent(),this.models.push(i)})).catch((e=>{this.fire(new Ct(new Error(`Could not load model ${t} from ${n.uri}: ${e.message}`)))}));e.push(r)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new Ct(new Error(`Could not load models: ${e.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends At{constructor(e,t,n,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=Mw(this._options,this.map._requestManager,t,n,((r,i)=>{this._tileJSONRequest=null,this._loaded=!0,r?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new Ct(r))):i&&(N(this,i),i.bounds&&(this.tileBounds=new Ew(i.bounds,this.minzoom,this.maxzoom)),Ge(i.tiles,this.map._requestManager._customAccessToken),this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,ve.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=t;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",r,i.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,i.bind(this),void 0,!0);function i(n,r){return e.aborted?t(null):n&&404!==n.status?t(n):(r&&(r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(r),e.buckets={...e.buckets,...r.buckets}),e.state="loaded",void t(null))}}serialize(){return N({},this._options)}},canvas:class extends Hb{constructor(e,n,r,i){super(e,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new Ct(new Pt(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Ct(new Pt(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new Ct(new Pt(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.HTMLCanvasElement||this.fire(new Ct(new Pt(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Ct(new Pt(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.HTMLCanvasElement?this.options.canvas:t.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Ct(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof vv||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new yv(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends At{constructor(e,t,n,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Ct(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Ct(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ew(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),N(this,k(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return k(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Tt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Tt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){const{x:r,y:i,z:o}=e.tileID.canonical,s=new t.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:i,z:o},{signal:s.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",n(null)):void 0===r?(e.state="errored",n(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",n(null)):function(e){return e instanceof t.ImageData||e instanceof t.HTMLCanvasElement||e instanceof t.ImageBitmap||e instanceof t.HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void n(null)):(e.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((t=>{20!==t.code&&(e.state="errored",n(t))})),e.request.cancel=()=>s.abort()}loadTileData(e,t){Ow.loadTileData(e,t,this._map.painter)}unloadTileData(e){Ow.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:n,z:r}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:n,z:r})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const e=pa(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Tt("data",{dataType:"source",sourceDataType:"content"}))}}},xS=function(e,t,n,r){const i=new _S[t.type](e,t,n,r);if(i.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${i.id}`);return V(["load","abort","unload","serialize","prepare"],i),i};function bS(e,t){const n=_h.identity([]);return _h.scale(n,n,[.5*e.width,.5*-e.height,1]),_h.translate(n,n,[1,-1,0]),_h.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function wS(e,t,n,r,i,o,s,a=!1){const l=e.tilesIn(r,s,a);l.sort(MS);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,n,e._state,r,i,o,bS(e.transform,r.tile.tileID),a)});const u=function(e){const t={},n={};for(const r of e){const e=r.queryResults,i=r.wrappedTileID,o=n[i]=n[i]||{};for(const n in e){const r=e[n],i=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of r)i[e.featureIndex]||(i[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const n=t.feature,r=n.layer;r&&"background"!==r.type&&"sky"!==r.type&&"slot"!==r.type&&(n.source=r.source,r["source-layer"]&&(n.sourceLayer=r["source-layer"]),n.state=void 0!==n.id?e.getFeatureState(r["source-layer"],n.id):{})}));return u}function SS(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],i={};for(let e=0;e<n.length;e++){const o=n[e],s=o.tileID.canonical.key;i[s]||(i[s]=!0,o.querySourceFeatures(r,t))}return r}function MS(e,t){const n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}class ES{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(const e in this.style._mergedLayers){const t=this.style._mergedLayers[e];if("fill-extrusion"===t.type)this.layers.push(t);else if("model"===t.type){const e=this.style.getLayerSource(t);e&&"batched-model"===e.type&&this.layers.push(t)}}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(let e=0;e<this.layers.length;++e){const n=this.layers[e],r=this.style.getLayerSourceCache(n);let i=1;"fill-extrusion"===n.type&&(i=n.paint.get("fill-extrusion-opacity")>0?n.paint.get("fill-extrusion-vertical-scale"):0);let o=r?r.getTile(t):null;if(!o&&r&&t.canonical.z>r.getSource().minzoom){let e=t.scaledTo(Math.min(r.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=r.getSource().minzoom&&(o=r.getTile(e),!o&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(n):null,tileID:o?o.tileID:t,verticalScale:i})}e.hasAnyZOffset=!1;let n=!1;for(let r=0;r<e.symbolInstances.length;r++){const i=e.symbolInstances.get(r),o=i.zOffset,s=this._getHeightAtTileOffset(t,i.tileAnchorX,i.tileAnchorY);i.zOffset=-1!==s?s:o,n||o===i.zOffset||(n=!0),e.hasAnyZOffset||0===i.zOffset||(e.hasAnyZOffset=!0)}n&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,t,n,r){let i=t,o=n;if(e.canonical.z!==r.canonical.z){const s=r.canonical,a=1/(1<<e.canonical.z-s.z);i=(t+e.canonical.x*ar)*a-s.x*ar|0,o=(n+e.canonical.y*ar)*a-s.y*ar|0}return{tileX:i,tileY:o}}_getHeightAtTileOffset(e,t,n){let r;for(let i=0;i<this.layers.length;++i){if("fill-extrusion"!==this.layers[i].type)continue;const{bucket:o,tileID:s,verticalScale:a}=this.currentBuildingBuckets[i];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,n,s),u=o.getHeightAtTileCoord(l,c);if(u&&void 0!==u.height){if(!u.hidden)return u.height*a;r=u.height}}for(let i=0;i<this.layers.length;++i){if("model"!==this.layers[i].type)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[i];if(!o)continue;const{tileX:a,tileY:l}=this._mapCoordToOverlappingTile(e,t,n,s),c=o.getHeightAtTileCoord(a,l);if(c&&!c.hidden)return void 0===c.height&&void 0!==r?Math.min(c.maxHeight,r)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}var TS=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function CS(e,t){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return TS.forEach((e=>{e in t&&(n[e]=t[e])})),n}function AS(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=CS(e[n],t[e[n].ref]));return e}const IS={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function PS(e,t,n){n.push({command:IS.addSource,args:[e,t[e]]})}function RS(e,t,n){t.push({command:IS.removeSource,args:[e]}),n[e]=!0}function LS(e,t,n,r){RS(e,n,r),PS(e,t,n)}function DS(e,t,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!_(e[n][r],t[n][r]))return!1;for(r in t[n])if(t[n].hasOwnProperty(r)&&"data"!==r&&!_(e[n][r],t[n][r]))return!1;return!0}function OS(e,t,n,r,i,o){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(_(e[s],t[s])||n.push({command:o,args:[r,s,t[s],i]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(_(e[s],t[s])||n.push({command:o,args:[r,s,t[s],i]}))}function NS(e){return e.id}function kS(e,t){return e[t.id]=t,e}class FS{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=P(e,0,1);let t=1,n=this._distances[t];const r=e*this.paddedLength+this.padding;for(;n<r&&t<this._distances.length;)n=this._distances[++t];const i=t-1,o=this._distances[i],s=n-o,a=s>0?(r-o)/s:0;return this.points[i].mult(1-a).add(this.points[t].mult(a))}}class zS{constructor(e,t,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}_insertBoxCell(e,t,n,r,i,o){this.boxCells[i].push(o)}_insertCircleCell(e,t,n,r,i,o){this.circleCells[i].push(o)}_query(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];const s=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:n-r,x2:t+r,y2:n+r})}return o?s.filter(o):s}return this._forEachCell(e,t,n,r,this._queryCell,s,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?s.length>0:s}_queryCircle(e,t,n,r,i){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),r?c.length>0:c}query(e,t,n,r,i){return this._query(e,t,n,r,!1,i)}hitTest(e,t,n,r,i){return this._query(e,t,n,r,!0,i)}hitTestCircle(e,t,n,r){return this._queryCircle(e,t,n,!0,r)}_queryCell(e,t,n,r,i,o,s,a){const l=s.seenUids,c=this.boxCells[i];if(null!==c){const i=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=i[c+2]&&t<=i[c+3]&&n>=i[c+0]&&r>=i[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:i[c],y1:i[c+1],x2:i[c+2],y2:i[c+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],e,t,n,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=i[u],t=i[u+1],n=i[u+2];o.push({key:this.circleKeys[c],x1:e-n,y1:t-n,x2:e+n,y2:t+n})}}}}}_queryCellCircle(e,t,n,r,i,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[i];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const n=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[i];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const n=3*t;if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,n,r,i,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(i.call(this,e,t,n,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,r,i,o){const s=r-e,a=i-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,r,i,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+n)return!1;const c=(s-i)/2,u=Math.abs(t-(i+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}const BS=100;class US{constructor(e,t,n=new zS(e.width+200,e.height+200,25),r=new zS(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+BS,this.screenBottomBoundary=e.height+BS,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,n,r,i,o,s,a){let l=n.projectedAnchorX,c=n.projectedAnchorY,u=n.projectedAnchorZ;const h=n.elevation,d=n.tileID,p=e.getProjection();if(h&&d){const[e,t,r]=p.upVector(d.canonical,n.tileAnchorX,n.tileAnchorY),i=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*i,c+=t*h*i,u+=r*h*i}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,n.tileID,"globe"===p.name||!!h||this.transform.pitch>0,p),m=o*f.perspectiveRatio,g=(n.x1*t+r.x-n.padding)*m+f.point.x,y=(n.y1*t+r.y-n.padding)*m+f.point.y,v=(n.x2*t+r.x+n.padding)*m+f.point.x,_=(n.y2*t+r.y+n.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,y,v,_)||!i&&this.grid.hitTest(g,y,v,_,a)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,y,v,_],offscreen:this.isOffscreen(g,y,v,_),occluded:!1}}placeCollisionCircles(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f){const m=[],g=this.transform.elevation,y=e.getProjection(),_=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,y):null,x=new v(n.tileAnchorX,n.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(x.x,x.y,f.canonical);if(_){const[e,t,n]=_(x);b+=e,w+=t,S+=n}const M="globe"===y.name,E=this.projectAndGetPerspectiveRatio(s,b,w,S,f,M||!!g||this.transform.pitch>0,y),{perspectiveRatio:T}=E,C=(u?o/T:o*T)/rg,A=tx(b,w,S,a),I=E.signedDistanceFromCamera>0?ox(C,i,n.lineOffsetX*C,n.lineOffsetY*C,!1,A,x,n,r,a,{},g&&!u?_:null,u&&!!g,y,f,u):null;let P=!1,R=!1,L=!0;if(I&&!E.occluded){const e=.5*d*T+p,n=new v(-100,-100),r=new v(this.screenRightBoundary,this.screenBottomBoundary),i=new FS,{first:o,last:s}=I,a=o.path.length;let u=[];for(let e=a-1;e>=1;e--)u.push(o.path[e]);for(let e=1;e<s.path.length;e++)u.push(s.path[e]);const f=2.5*e;l&&(u=u.map((([e,t,n],r)=>(_&&!M&&(n=_(r<a-1?o.tilePath[a-1-r]:s.tilePath[r-a+2])[2]),tx(e,t,n,l)))),u.some((e=>e[3]<=0))&&(u=[]));let g=[];if(u.length>0){let e=1/0,t=-1/0,i=1/0,o=-1/0;for(const n of u)e=Math.min(e,n[0]),i=Math.min(i,n[1]),t=Math.max(t,n[0]),o=Math.max(o,n[1]);t>=n.x&&e<=r.x&&o>=n.y&&i<=r.y&&(g=[u.map((e=>new v(e[0],e[1])))],(e<n.x||t>r.x||i<n.y||o>r.y)&&(g=Wg(g,n.x,n.y,r.x,r.y)))}for(const n of g){i.reset(n,.25*e);let r=0;r=i.length<=.5*e?1:Math.ceil(i.paddedLength/f)+1;for(let n=0;n<r;n++){const o=n/Math.max(r-1,1),s=i.lerp(o),a=s.x+BS,l=s.y+BS;m.push(a,l,e,0);const u=a-e,d=l-e,p=a+e,f=l+e;if(L=L&&this.isOffscreen(u,d,p,f),R=R||this.isInsideGrid(u,d,p,f),!t&&this.grid.hitTestCircle(a,l,e,h)&&(P=!0,!c))return{circles:[],offscreen:!1,collisionDetected:P,occluded:!1}}}}return{circles:!c&&P||!R?[]:m,offscreen:L,collisionDetected:P,occluded:E.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const t=[];let n=1/0,r=1/0,i=-1/0,o=-1/0;for(const s of e){const e=new v(s.x+BS,s.y+BS);n=Math.min(n,e.x),r=Math.min(r,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y),t.push(e)}const s=this.grid.query(n,r,i,o).concat(this.ignoredGrid.query(n,r,i,o)),a={},l={};for(const e of s){const n=e.key;void 0===a[n.bucketInstanceId]&&(a[n.bucketInstanceId]={}),a[n.bucketInstanceId][n.featureIndex]||pp(t,[new v(e.x1,e.y1),new v(e.x2,e.y1),new v(e.x2,e.y2),new v(e.x1,e.y2)])&&(a[n.bucketInstanceId][n.featureIndex]=!0,void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]=[]),l[n.bucketInstanceId].push(n.featureIndex))}return l}insertCollisionBox(e,t,n,r,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,r,i){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:r,collisionGroupID:i};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,t,n,r,i,o,s){const a=[t,n,r,1];let l=!1;if(r||this.transform.pitch>0){if(hh.transformMat4(a,a,e),this.fogState&&i&&"globe"!==s.name){const e=function(e,t,n,r,i,o){const s=o.calculateFogTileMatrix(i),a=[t,n,r];return Eh.transformMat4(a,a,s),aw(e,Eh.length(a),o.pitch,o._fov)}(this.fogState,t,n,r,i.toUnwrapped(),this.transform);l=e>.9}}else dx(a,a,e);const c=a[3];return{point:new v((a[0]/c+1)/2*this.transform.width+BS,(-a[1]/c+1)/2*this.transform.height+BS),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/c*.5,1.5),signedDistanceFromCamera:c,occluded:o&&a[2]>c||l}}isOffscreen(e,t,n,r){return n<BS||e>=this.screenRightBoundary||r<BS||t>this.screenBottomBoundary}isInsideGrid(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=_h.identity([]);return _h.translate(e,e,[-100,-100,0]),e}}function jS(e,t,n){const r=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return _h.multiply(new Float32Array(16),e.projMatrix,r)}function VS(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const r=n.clone();return r.setProjection(t.projection),jS(r,t.getProjection(),e)}function GS(e,t,n){return t.name===n.projection.name?e.projMatrix:jS(n,t,e)}class HS{constructor(e,t,n,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class ZS{constructor(e,t,n,r,i,o=!1){this.text=new HS(e?e.text:null,t,n,i),this.icon=new HS(e?e.icon:null,t,r,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class WS{constructor(e,t,n,r=!1){this.text=e,this.icon=t,this.skipFade=n,this.clipped=r}}class $S{constructor(){this.invProjMatrix=_h.create(),this.viewportMatrix=_h.create(),this.circles=[]}}class qS{constructor(e,t,n,r,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class XS{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function YS(e,t,n,r,i){const{horizontalAlign:o,verticalAlign:s}=Og(e),a=-(o-.5)*t,l=-(s-.5)*n,c=hy(e,r);return new v(a+c[0]*i,l+c[1]*i)}function KS(e,t,n,r,i){const o=new v(e,t);return n&&o._rotate(r?i:-i),o}class JS{constructor(e,t,n,r,i,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new US(this.transform,i),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new XS(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,t,n,r){const i=n.getBucket(t),o=n.latestFeatureIndex;if(!i||!o||t.fqid!==i.layerIds[0])return;const s=i.layers[0].layout,a=n.collisionBoxArray,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/ar,u=n.tileID.toUnwrapped();this.transform.setProjection(i.projection);const h=(d=n.tileID,p=i.getProjection(),f=this.transform,p.name===this.projection?f.calculateProjMatrix(d.toUnwrapped()):jS(f,p,d));var d,p,f;const m="map"===s.get("text-pitch-alignment"),g="map"===s.get("text-rotation-alignment");t.compileFilter();const y=t.dynamicFilter(),v=t.dynamicFilterNeedsFeature(),_=this.transform.calculatePixelsToTileUnitsMatrix(n),x=Q_(h,n.tileID.canonical,m,g,this.transform,i.getProjection(),_);let b=null;if(m){const e=ex(h,n.tileID.canonical,m,g,this.transform,i.getProjection(),_);b=_h.multiply([],this.transform.labelPlaneMatrix,e)}let w=null;y&&n.latestFeatureIndex&&(w={unwrappedTileID:u,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[i.bucketInstanceId]=new qS(i.bucketInstanceId,o,i.sourceLayerIndex,i.index,n.tileID);const S={bucket:i,layout:s,posMatrix:h,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:l,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:ag(i.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:ag(i.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(i.sourceID)};if(r)for(const t of i.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=t;e.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:S})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:i.symbolInstances.length,parameters:S})}attemptAnchorPlacement(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y){const{textOffset0:v,textOffset1:_,crossTileID:x}=h,b=[v,_],w=YS(e,n,r,b,i),S=this.collisionIndex.placeCollisionBox(p,i,t,KS(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(y,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,KS(w.x,w.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:n,height:r,anchor:e,textScale:i,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(e,t,n,r){const{bucket:i,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,clippingData:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:f,collisionGroup:m}=e.parameters,g=o.get("text-optional"),y=o.get("icon-optional"),_=o.get("text-allow-overlap"),x=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="viewport-y"===o.get("symbol-z-order"),M=o.get("symbol-z-elevate");this.transform.setProjection(i.projection);let E=_&&(x||!i.hasIconData()||y),T=x&&(_||!i.hasTextData()||g);!i.collisionArrays&&d&&i.deserializeCollisionBoxes(d),n&&r&&i.updateCollisionDebugBuffers(this.transform.zoom,d);const C=(e,r,d)=>{const{crossTileID:S,numVerticalGlyphVertices:M}=e;if(c){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(c.dynamicFilterNeedsFeature){const t=this.retainedQueryData[i.bucketInstanceId];r=c.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(n,r,this.retainedQueryData[i.bucketInstanceId].tileID.canonical,new v(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[S]=new WS(!1,!1,!1,!0),void t.add(S)}if(t.has(S))return;if(h)return void(this.placements[S]=new WS(!1,!1,!1));let C=!1,A=!1,I=!0,P=!1,R=!1,L=null,D={box:null,offscreen:null,occluded:null},O={box:null,offscreen:null,occluded:null},N=null,k=null,F=null,z=0,B=0,U=0;d.textFeatureIndex?z=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(z=e.featureIndex),d.verticalTextFeatureIndex&&(B=d.verticalTextFeatureIndex);const j=t=>{t.tileID=this.retainedQueryData[i.bucketInstanceId].tileID;const n=this.transform.elevation;t.elevation=e.zOffset+(n?n.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},V=d.textBox;if(V){j(V);const t=t=>{let n=wg.horizontal;if(i.allowVerticalPlacement&&!t&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[S];t&&(this.placedOrientations[S]=t,n=t,this.markUsedOrientation(i,n,e))}return n},n=(e,t)=>{if(i.allowVerticalPlacement&&M>0&&d.verticalTextBox){for(const n of i.writingModes)if(n===wg.vertical?(D=t(),O=D):D=e(),D&&D.box&&D.box.length)break}else D=e()};if(o.get("text-variable-anchor")){let a=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S]){const e=this.prevPlacement.variableOffsets[S];a.indexOf(e.anchor)>0&&(a=a.filter((t=>t!==e.anchor)),a.unshift(e.anchor))}const l=(t,n,o)=>{const l=i.getSymbolInstanceTextSize(p,e,this.transform.zoom,r),c=(t.x2-t.x1)*l+2*t.padding,h=(t.y2-t.y1)*l+2*t.padding,d=e.hasIconTextFit&&!x?n:null;d&&j(d);let g={box:[],offscreen:!1,occluded:!1};const y=_?2*a.length:a.length;for(let n=0;n<y;++n){const y=this.attemptAnchorPlacement(a[n%a.length],t,c,h,l,b,w,u,s,m,n>=a.length,e,r,i,o,d,p,f);if(y&&(g=y.placedGlyphBoxes,g&&g.box&&g.box.length)){C=!0,L=y.shift;break}}return g};n((()=>l(V,d.iconBox,wg.horizontal)),(()=>{const e=d.verticalTextBox;return e&&j(e),i.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&M>0&&e?l(e,d.verticalIconBox,wg.vertical):{box:null,offscreen:null,occluded:null}})),D&&(C=D.box,I=D.offscreen,P=D.occluded);const c=t(!(!D||!D.box));if(!C&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[S];t&&(this.variableOffsets[S]=t,this.markUsedJustification(i,t.anchor,e,c))}}else{const o=(t,n)=>{const o=i.getSymbolInstanceTextSize(p,e,this.transform.zoom,r),a=this.collisionIndex.placeCollisionBox(i,o,t,new v(0,0),_,u,s,m.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(i,n,e),this.placedOrientations[S]=n),a};n((()=>o(V,wg.horizontal)),(()=>{const e=d.verticalTextBox;return i.allowVerticalPlacement&&M>0&&e?(j(e),o(e,wg.vertical)):{box:null,offscreen:null,occluded:null}})),t(!!(D&&D.box&&D.box.length))}}if(N=D,C=N&&N.box&&N.box.length>0,I=N&&N.offscreen,P=N&&N.occluded,e.useRuntimeCollisionCircles){const t=i.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),r=sg(i.textSizeData,p,t),c=o.get("text-padding");k=this.collisionIndex.placeCollisionCircles(i,_,t,i.lineVertexArray,i.glyphOffsetArray,r,s,a,l,n,w,m.predicate,e.collisionCircleDiameter*r/rg,c,this.retainedQueryData[i.bucketInstanceId].tileID),C=_||k.circles.length>0&&!k.collisionDetected,I=I&&k.offscreen,P=k.occluded}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const t=t=>{j(t);const n=e.hasIconTextFit&&L?KS(L.x,L.y,b,w,this.transform.angle):new v(0,0),r=i.getSymbolInstanceIconSize(f,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(i,r,t,n,x,u,s,m.predicate)};O&&O.box&&O.box.length&&d.verticalIconBox?(F=t(d.verticalIconBox),A=F.box.length>0):(F=t(d.iconBox),A=F.box.length>0),I=I&&F.offscreen,R=F.occluded}const G=g||0===e.numHorizontalGlyphVertices&&0===M,H=y||0===e.numIconVertices;if(G||H?H?G||(A=A&&C):C=A&&C:A=C=A&&C,C&&N&&N.box&&this.collisionIndex.insertCollisionBox(N.box,o.get("text-ignore-placement"),i.bucketInstanceId,O&&O.box&&B?B:z,m.ID),A&&F&&this.collisionIndex.insertCollisionBox(F.box,o.get("icon-ignore-placement"),i.bucketInstanceId,U,m.ID),k&&(C&&this.collisionIndex.insertCollisionCircles(k.circles,o.get("text-ignore-placement"),i.bucketInstanceId,z,m.ID),n)){const e=i.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new $S);for(let e=0;e<k.circles.length;e+=4)t.circles.push(k.circles[e+0]),t.circles.push(k.circles[e+1]),t.circles.push(k.circles[e+2]),t.circles.push(k.collisionDetected?1:0)}const Z="globe"!==i.projection.name;E=E&&(Z||!P),T=T&&(Z||!R),this.placements[S]=new WS(C||E,A||T,I||i.justReloaded),t.add(S)};if(M&&this.buildingIndex&&(this.buildingIndex.updateZOffset(i,this.retainedQueryData[i.bucketInstanceId].tileID),i.updateZOffset()),S){const e=i.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const n=e[t];C(i.symbolInstances.get(n),n,i.collisionArrays[n])}i.hasAnyZOffset&&q(`${i.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(i.hasAnyZOffset){const e=i.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const n=e[t];C(i.symbolInstances.get(n),n,i.collisionArrays[n])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)C(i.symbolInstances.get(t),t,i.collisionArrays[t]);if(n&&i.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[i.bucketInstanceId];_h.invert(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}i.justReloaded=!1}markUsedJustification(e,t,n,r){const{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,crossTileID:l}=n,c=py(t),u=r===wg.vertical?a:"left"===c?i:"center"===c?o:"right"===c?s:-1;i>=0&&(e.text.placedSymbolArray.get(i).crossTileID=u>=0&&i!==u?0:l),o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:l),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:l),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:l)}markUsedOrientation(e,t,n){const r=t===wg.horizontal||t===wg.horizontalOnly?t:0,i=t===wg.vertical?t:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l}=n,c=e.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=r),s>=0&&(c.get(s).placedOrientation=r),a>=0&&(c.get(a).placedOrientation=r),l>=0&&(c.get(l).placedOrientation=i)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=i[e];o?(this.opacities[e]=new ZS(o,r,t.text,t.icon,null,t.clipped),n=n||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new ZS(null,r,t.text,t.icon,t.skipFade,t.clipped),n=n||t.text||t.icon)}for(const e in i){const t=i[e];if(!this.opacities[e]){const i=new ZS(t,r,!1,!1);i.isHidden()||(this.opacities[e]=i,n=n||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n=new Set;for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,n,r.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,r.tileID),t.updateZOffset()))}}updateBucketOpacities(e,t,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,i=!!e.layers[0].dynamicFilter(),o=new ZS(null,0,!1,!1,!0),s=r.get("text-allow-overlap"),a=r.get("icon-allow-overlap"),l=r.get("text-variable-anchor"),c="map"===r.get("text-rotation-alignment"),u="map"===r.get("text-pitch-alignment"),h=new ZS(null,0,s&&(a||!e.hasIconData()||r.get("icon-optional")),a&&(s||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const d=(e,t,n)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n)};let p=0;for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:a,crossTileID:f,numIconVertices:m}=r,g=t.has(f);let y=this.opacities[f];g?y=o:y||(y=h,this.opacities[f]=y),t.add(f);const _=s>0||a>0,x=m>0,b=this.placedOrientations[f],w=b===wg.vertical,S=b===wg.horizontal||b===wg.horizontalOnly;if(!_&&!x||y.isHidden()||p++,_){const t=aM(y.text);d(e.text,s,w?lM:t),d(e.text,a,S?lM:t);const n=y.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=e.text.placedSymbolArray,h=n||w?1:0;i>=0&&(u.get(i).hidden=h),o>=0&&(u.get(o).hidden=h),l>=0&&(u.get(l).hidden=h),c>=0&&(u.get(c).hidden=n||S?1:0);const p=this.variableOffsets[f];p&&this.markUsedJustification(e,p.anchor,r,b);const m=this.placedOrientations[f];m&&(this.markUsedJustification(e,"left",r,m),this.markUsedOrientation(e,m,r))}if(x){const t=aM(y.icon),{placedIconSymbolIndex:n,verticalPlacedIconSymbolIndex:i}=r,o=e.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;n>=0&&(d(e.icon,m,w?lM:t),o.get(n).hidden=s),i>=0&&(d(e.icon,r.numVerticalIconVertices,S?lM:t),o.get(i).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const t=e.collisionArrays[n];if(t){let n=new v(0,0),o=!0;if(t.textBox||t.verticalTextBox){if(l){const e=this.variableOffsets[f];e?(n=YS(e.anchor,e.width,e.height,e.textOffset,e.textScale),c&&n._rotate(u?this.transform.angle:-this.transform.angle)):o=!1}i&&(o=!y.clipped),t.textBox&&QS(e.textCollisionBox.collisionVertexArray,y.text.placed,!o||w,n.x,n.y),t.verticalTextBox&&QS(e.textCollisionBox.collisionVertexArray,y.text.placed,!o||S,n.x,n.y)}const s=o&&Boolean(!S&&t.verticalIconBox);t.iconBox&&QS(e.iconCollisionBox.collisionVertexArray,y.icon.placed,s,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0),t.verticalIconBox&&QS(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0)}}}if(e.fullyClipped=0===p,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function QS(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}const eM=Math.pow(2,25),tM=Math.pow(2,24),nM=Math.pow(2,17),rM=Math.pow(2,16),iM=Math.pow(2,9),oM=Math.pow(2,8),sM=Math.pow(2,1);function aM(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*eM+t*tM+n*nM+t*rM+n*iM+t*oM+n*sM+t}const lM=0;class cM{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,n,r,i){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,n,0===e.symbolInstanceStart),this._currentPartIndex++,i())return!0}return!1}}class uM{constructor(e,t,n,r,i,o,s,a,l){this.placement=new JS(e,i,o,s,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n,r){const i=ut.now(),o=()=>{const e=ut.now()-i;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const i=t[e[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=s)&&(!i.maxzoom||i.maxzoom>s)){const e=i,t=e.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new cM(e),a=pa(i.source,i.scope);if(s.continuePlacement(t?r[a]:n[a],this.placement,this._showCollisionBoxes,i,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const hM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dM{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=n>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const i=hM[15&n];if(!i)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new dM(s,o,i,e)}constructor(e,t=64,n=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=hM.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${n}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return pM(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:s}=this,a=[0,i.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=r&&l.push(i[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=r&&l.push(i[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)yM(i[2*n],i[2*n+1],e,t)<=l&&a.push(r[n]);continue}const d=h+u>>1,p=i[2*d],f=i[2*d+1];yM(p,f,e,t)<=l&&a.push(r[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function pM(e,t,n,r,i,o){if(i-r<=n)return;const s=r+i>>1;fM(e,t,s,r,i,o),pM(e,t,n,r,s-1,1-o),pM(e,t,n,s+1,i,1-o)}function fM(e,t,n,r,i,o){for(;i>r;){if(i-r>600){const s=i-r+1,a=n-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);fM(e,t,n,Math.max(r,Math.floor(n-a*c/s+u)),Math.min(i,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=r,l=i;for(mM(e,t,r,n),t[2*i+o]>s&&mM(e,t,r,i);a<l;){for(mM(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?mM(e,t,r,l):(l++,mM(e,t,l,i)),l<=n&&(r=l+1),n<=l&&(i=l-1)}}function mM(e,t,n,r){gM(e,n,r),gM(t,2*n,2*r),gM(t,2*n+1,2*r+1)}function gM(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function yM(e,t,n,r){const i=e-n,o=t-r;return i*i+o*o}const vM=512/ar/2;class _M{constructor(e,t,n){this.tileID=e,this.bucketInstanceId=n,this.index=new dM(t.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=e.canonical.x*ar,i=e.canonical.y*ar;for(let e=0;e<t.length;e++){const{key:n,crossTileID:o,tileAnchorX:s,tileAnchorY:a}=t.get(e),l=Math.floor((r+s)*vM),c=Math.floor((i+a)*vM);this.index.add(l,c),this.keys.push(n),this.crossTileIDs.push(o)}this.index.finish()}findMatches(e,t,n){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),i=vM/Math.pow(2,t.canonical.z-this.tileID.canonical.z),o=t.canonical.x*ar,s=t.canonical.y*ar;for(let t=0;t<e.length;t++){const a=e.get(t);if(a.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=a,h=Math.floor((o+c)*i),d=Math.floor((s+u)*i),p=this.index.range(h-r,d-r,h+r,d+r);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(t)){n.add(t),a.crossTileID=t;break}}}}}class xM{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bM{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const n=this.indexes[e],r={};for(const e in n){const i=n[e];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}this.indexes[e]=r}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const r=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const i=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in i){const o=i[n];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=i[e.scaledTo(Number(n)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const i=t.symbolInstances.get(e);i.crossTileID||(i.crossTileID=n.generate(),r.add(i.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new _M(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.crossTileIDs)this.usedCrossTileIDs[e].delete(n)}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class wM{constructor(){this.layerIndexes={},this.crossTileIDs=new xM,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n,r){let i=this.layerIndexes[e.fqid];void 0===i&&(i=this.layerIndexes[e.fqid]=new bM);let o=!1;const s={};"globe"!==r.name&&i.handleWrapJump(n);for(const n of t){const t=n.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}var SM="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nvec3 linearTosRGB(vec3 color)\n{return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn)\n{return pow(srgbIn,vec3(2.2));}vec3 linearProduct(vec3 srgbIn,vec3 k)\n{return srgbIn*pow(k,vec3(1./2.2));}\n#if __VERSION__ >=300\n#define _HANDLE_WIREFRAME_DEPTH gl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define _HANDLE_WIREFRAME_DEPTH\n#endif\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\ngl_FragColor=vec4(0.7,0.0,0.0,0.7); \\\n_HANDLE_WIREFRAME_DEPTH;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",MM="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",EM="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",TM="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",CM="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",AM="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",IM="#ifdef RENDER_SHADOWS\n#if defined(NATIVE) && __VERSION__ >=300\n#define TEXTURE_GATHER\n#endif\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture2D(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture2D(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const PM=[];kM(SM,PM);const RM={"_prelude_fog.vertex.glsl":TM,"_prelude_terrain.vertex.glsl":EM,"_prelude_shadow.vertex.glsl":AM,"_prelude_fog.fragment.glsl":CM,"_prelude_shadow.fragment.glsl":IM,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE"},LM={};FM("",EM),FM(CM,TM),FM(IM,AM);const DM=FM("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;varying float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),OM=SM;var NM={background:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;varying vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:FM("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:FM('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:FM("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:FM("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:FM("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:FM("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nattribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nattribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#if __VERSION__ >=300\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nvarying float v_flood_radius;varying float v_has_floodlight;\n#endif\nvarying float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:FM("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nvarying highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:FM('#include "_prelude_shadow.fragment.glsl"\n#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec3 u_ground_shadow_factor;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\ngl_FragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;attribute vec2 a_pos;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:FM("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture2D(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\ngl_FragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\ngl_FragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\ngl_FragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nattribute highp vec4 a_pos_end;attribute highp float a_angular_offset_factor;attribute highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nvarying highp vec2 v_pos;varying highp vec4 v_line_segment;varying highp float v_flood_light_radius_tile;varying highp vec2 v_ao;\n#ifdef FOG\nvarying highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:FM("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture(u_image,coord).r/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting_with_emission_ground(gl_FragColor,u_emissive_strength);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec2 u_colorization_scale;uniform highp vec4 u_colorization_mix;highp vec4 colormap (highp float value) {highp float scaled_value=value*u_colorization_scale.y+u_colorization_scale.x;highp vec2 coords=vec2(scaled_value,0.5);return texture2D(u_color_ramp,coords);}\n#endif\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);vec4 color;\n#ifdef RASTER_COLOR\nhighp vec4 fadedColor=mix(color0,color1,u_fade_t);color=colormap(dot(vec4(fadedColor.rgb,1),u_colorization_mix));color.a*=fadedColor.a;if (color.a > 0.0) {color.rgb/=color.a;}\n#else\nif (color0.a > 0.0) {color0.rgb/=color0.a;}if (color1.a > 0.0) {color1.rgb/=color1.a;}color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_ground(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;attribute vec2 a_texture_pos;\n#endif\nvarying vec2 v_pos0;varying vec2 v_pos1;void main() {vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*u_globe_matrix*vec4(a_globe_pos,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),symbolIcon:FM('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nvarying float v_fade_opacity;varying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture2D(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture2D(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture2D(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nattribute vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nvarying vec2 v_tex_b;\n#endif\nvarying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:FM('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:FM('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo;\n#if __VERSION__ >=300\ndraw_halo=v_draw_halo > 0.0;\n#else\ndraw_halo=u_is_halo;\n#endif\nif (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nattribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef Z_OFFSET\nattribute float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\n#if __VERSION__ >=300\nflat varying float v_draw_halo;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;\n#if __VERSION__ >=300\nv_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture2D(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:FM("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:FM('#include "_prelude_fog.fragment.glsl"\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',MM),skyboxGradient:FM('#include "_prelude_fog.fragment.glsl"\nvarying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}',MM),skyboxCapture:FM("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture2D(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:FM('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\ngl_FragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\ngl_FragColor=vec4(1,1,1,1);\n#else\ngl_FragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);gl_FragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\ngl_FragColor=vec4(c*t,t);\n#endif\n}',"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:FM('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;varying highp vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture2D(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\nconst float M_PI=3.141592653589793;\n#define saturate(_x) clamp(_x,0.,1.)\nfloat calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture2D(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture2D( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture2D(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(M_PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/M_PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/M_PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nfloat ao=(texture2D(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture2D(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\ncolor=mix(color,mat.baseColor.rgb,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\ngl_FragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nattribute vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth_shadows;\n#endif\nvarying vec4 v_position_height;varying lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nvarying highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nvarying lowp vec4 v_roughness_metallic_emissive_alpha;varying mediump vec4 v_height_based_emission_params;\n#endif\nvoid main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:FM("varying highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\ngl_FragColor=pack_depth(v_depth);\n#endif\n}","attribute vec3 a_pos_3f;uniform mat4 u_matrix;varying highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_normal_matrix0;attribute vec4 a_normal_matrix1;attribute vec4 a_normal_matrix2;attribute vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:FM("varying highp vec2 v_uv;varying mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;gl_FragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nattribute vec3 a_pos_3f;attribute vec2 a_uv;attribute float a_size_scale;attribute float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;varying highp vec2 v_uv;varying mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function kM(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of n)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const n=e.split(" ");for(const e of n)t.includes(e)||t.push(e)}}function FM(e,t){const n=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let i=t.match(/attribute(\S*) (highp |mediump |lowp )?([\w]+) ([\w]+)/g);i&&(i=i.filter(((e,t)=>i.indexOf(e)===t)));const o={},s=[],a=[];e=e.replace(n,((e,t)=>(a.push(t),""))),t=t.replace(n,((e,t)=>(s.push(t),"")));let l=[...PM];kM(e,l),kM(t,l);for(const e of[...s,...a])RM[e]||console.error(`Undefined include: ${e}`),LM[e]||(LM[e]=[],kM(RM[e],LM[e])),l=[...l,...LM[e]];return{fragmentSource:e=e.replace(r,((e,t,n,r,i)=>(o[i]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    varying ${n} ${r} ${i};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(r,((e,t,n,r,i)=>{const s="float"===r?"vec2":r,a=i.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\nattribute ${n} ${r} a_${i};\n#endif\n`:o[i]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${s} a_${i};\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    attribute ${n} ${r} a_${i};\n    varying ${n} ${r} ${i};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${i} = a_${i};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${s} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nattribute vec4 a_${i}0;\nattribute vec4 a_${i}1;\nattribute vec4 a_${i}2;\nattribute vec4 a_${i}3;\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nattribute ${n} ${s} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${i}\n    ${n} ${r} ${i} = a_${i};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`})),staticAttributes:i,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class zM{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,n,r,i,o,s,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!l&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let e=0;!c&&e<s.length;e++)this.boundDynamicVertexBuffers[e]!==s[e]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||l||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==o)this.freshBind(t,n,r,i,o,s,a);else{e.bindVertexArrayOES.set(this.vao);for(const n of s)n&&(n.bind(),a&&n.instanceCount&&n.setVertexAttribDivisor(e.gl,t,a));i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,n,r,i,o,s){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=o,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i);for(const t of n)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i);for(const t of o)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i),s&&t.instanceCount&&t.setVertexAttribDivisor(c,e,s));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function BM(e,t){const n=Math.pow(2,t.canonical.z),r=t.canonical.y;return[new ep(0,r/n).toLngLat().lat,new ep(0,(r+1)/n).toLngLat().lat]}function UM(e,t,n,r,i,o,s){const a=e.context,l=a.gl,c=n.hillshadeFBO;if(!c)return;e.prepareDrawTile();const u=e.isTileAffectedByFog(t),h=e.getOrCreateProgram("hillshade",{overrideFog:u});a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get());const d=((e,t,n,r)=>{const i=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color"),a=n.paint.get("hillshade-emissive-strength");let l=w(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))l-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const t=e.style.directionalLight.properties.get("direction");l=w(J(t.x,t.y,t.z)[1])}const c=!e.options.moving;return{u_matrix:r||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),c),u_image:0,u_latrange:BM(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),l],u_shadow:i,u_highlight:o,u_emissive_strength:a,u_accent:s}})(e,n,r,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(a,h,t.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(n);h.draw(e,l.TRIANGLES,i,o,s,M_.disabled,d,r.id,p,f,m)}function jM(e,t,n){if(!t.needsDEMTextureUpload)return;const r=e.context,i=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();t.demTexture?t.demTexture.update(o,{premultiply:!1}):t.demTexture=new yv(r,o,e.terrainUseFloatDEM()?i.R32F:i.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function VM(e,t,n){const r=e.context,i=r.gl;if(!t.dem)return;const o=t.dem;if(r.activeTexture.set(i.TEXTURE1),jM(e,t,o),!t.demTexture)return;t.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE);const s=o.dim;r.activeTexture.set(i.TEXTURE0);let a=t.hillshadeFBO;if(!a){const e=new yv(r,{width:s,height:s,data:null},i.RGBA);e.bind(i.LINEAR,i.CLAMP_TO_EDGE),a=t.hillshadeFBO=r.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(e.texture)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,s,s]);const{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=e.getMercatorTileBoundsBuffers(),h=[];e.terrainUseFloatDEM()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(e,i.TRIANGLES,y_.disabled,__.disabled,b_.unblended,M_.disabled,((e,t)=>{const n=t.stride,r=_h.create();return _h.ortho(r,0,ar,-ar,0,0,1),_h.translate(r,r,[0,-ar,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:t.unpackVector}})(t.tileID,o),n.id,l,c,u),t.needsHillshadePrepare=!1}const GM=e=>({u_matrix:new Nl(e),u_image0:new Al(e),u_skirt_height:new Il(e),u_ground_shadow_factor:new Rl(e)}),HM=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),ZM=(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:n,u_zoom_transition:i,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:p}),WM=(e,t)=>{if(t>0&&e.terrain&&q("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,r=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),i=n.isLODDisabled(!1)?R(60,45,n.pitch):R(30,15,n.pitch),o=n._farZ-n._nearZ,s=t*n.height,a=((1-(l=i))*(.75*n.cameraToCenterDistance)+l*(n._farZ+s))*r;var l;return{shouldRenderCutoff:i<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(a-n._nearZ)/o,(a-s-n._nearZ)/o]}}};function $M(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const qM=new class{constructor(){this.operations={}}newMorphing(e,t,n,r,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==n.tileID.key&&(t.queued=n)}else this.operations[e]={startTime:r,phase:0,duration:i,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},XM={0:null,1:"TERRAIN_VERTEX_MORPHING"};function YM(e,t,n){if(0===t)return 0;const r=t<1&&514===n?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function KM(e,t){const n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}const JM=e=>({u_matrix:e});function QM(e,t,n,r,i){if(i>0){const o=ut.now(),s=(o-e.timeAdded)/i,a=t?(o-t.timeAdded)/i:-1,l=n.getSource(),c=r.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),u=!t||Math.abs(t.tileID.overscaledZ-c)>Math.abs(e.tileID.overscaledZ-c),h=u&&e.refreshedUponExpiration?1:P(u?s:1-a,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class eE extends T_{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new gw(Uw(),null),r=xS("mock-dem",t,n,e.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class tE extends T_{constructor(e){const t=xS("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new gw(Uw(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,n){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,n)=>{if(t[n.key]="",!this._tiles[n.key]){const t=new Av(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[n.key]=t}return t}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const n=Object.values(t);this.renderCachePool.push(...n),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class nE extends Fh{constructor(e,t,n){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=n}}class rE extends Gm{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,i]=function(e){const t=new Sa,n=new ja,r=131;t.reserve(17161),n.reserve(33800);const i=ar/128,o=ar+i/2,s=o+i;for(let e=-i;e<s;e+=i)for(let n=-i;n<s;n+=i){const r=n<0||n>o||e<0||e>o?24575:0,i=P(Math.round(n),0,ar),s=P(Math.round(e),0,ar);t.emplaceBack(i+r,s)}const a=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)a(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)})),[t,n,32768]}(),o=e.context;this.gridBuffer=o.createVertexBuffer(n,Lh.members),this.gridIndexBuffer=o.createIndexBuffer(r),this.gridSegments=dl.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=dl.simpleSegment(0,0,n.length,i),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tE(t.map),this.orthoMatrix=_h.create(),_h.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,ar,0,ar,0,1);const s=o.gl;this._overlapStencilMode=new __({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new eE(t.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,t,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const r=e.terrain.properties,i=0===e.terrain.drapeRenderMode,o=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ut.now();const s=e.terrain&&e.terrain.scope,a=r.get("source"),l=i?this._mockSourceCache:e.getSourceCache(a,s);if(!l)return void q(`Couldn't find terrain source "${a}".`);if(this.sourceCache=l,this._exaggeration=o?this.calculateExaggeration(t):r.get("exaggeration"),!t.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const c=()=>{this.sourceCache.used&&q(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),t.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0,this._previousZoom=t.zoom}else this._disable()}calculateExaggeration(e){const t=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const r=null!=t?n-t:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const i=e.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(i);let s=i-this._previousZoom;const a=this._previousUpdateTimestamp;let l=i;null!=this._evaluationZoom&&(l=this._evaluationZoom,Math.abs(i-l)>.5&&(s=.5*(i-l+s)),s*r<0&&(l+=s)),this._evaluationZoom=l;const c=o.getExaggeration(l),u=c===o.getExaggeration(Math.max(0,l-.1));if(u&&Math.abs(c-this._exaggeration)<.01)return c;let h=Math.min(.1,.00375*(this._updateTimestamp-a));return(u||c<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),Xr(this._exaggeration,c,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const t=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(ep.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=t.getIds().map((e=>{const r=t.getTileByID(e).tileID;return r.projMatrix=n.calculateProjMatrix(r.toUnwrapped()),r}));!function(e,t){const n=t.transform.pointCoordinate(t.transform.getCameraPoint()),r=new v(n.x,n.y);e.sort(((e,t)=>{if(t.overscaledZ-e.overscaledZ)return t.overscaledZ-e.overscaledZ;const n=new v(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),i=new v(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=r.mult(1<<e.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(i)}))}(r,this.painter);const i=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const t in o){const n=o[t];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,e[t],i),n.usedForTerrain)continue;const r=e[t];n.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[t.id]=r.map((e=>new nE(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(i),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const n=t.tileID.key;n in s||(this._visibleDemTiles.push(t),s[n]=n)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const n in this.terrainTileForTile){const r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),jM(this.painter,r,i))}}_prepareDemTileUniforms(e,t,n,r){if(!t||null==t.demTexture)return!1;const i=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-i.z),s=r||"";return n[`u_dem_tl${s}`]=[i.x*o%1,i.y*o%1],n[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,t=e.gl;if(!this._emptyDepthBufferTexture){const n=new Wp({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new yv(e,n,t.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,n)=>{if(!n.dem)return t;const r=n.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const e=this.painter.context,t=e.gl;e.activeTexture.set(t.TEXTURE2);const n=this._getLoadedAreaMinimum(),[r,i]=(()=>{if(this.painter.terrainUseFloatDEM()){const e=new $p({width:1,height:1},new Float32Array([n]));return[t.R32F,e]}{const e=new Wp({width:1,height:1},new Uint8Array(Vm.pack(n,this.sourceCache.getSource().encoding)));return[t.RGBA,e]}})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new yv(e,i,r,{premultiply:!1}),o}setupElevationDraw(e,t,n){const r=this.painter.context,i=r.gl,o=(s=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:Vm.getUnpackVector(s),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var s;o.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,r=n.morphing.dstDemTile;c=n.morphing.phase,t&&r&&(this._prepareDemTileUniforms(e,t,o,"_prev")&&(l=t),this._prepareDemTileUniforms(e,r,o)&&(a=r))}const u=e=>e&&e.demTexture&&this.painter.terrainUseFloatDEM()?i.LINEAR:i.NEAREST,h=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&a)r.activeTexture.set(i.TEXTURE2),a.demTexture.bind(u(a),i.CLAMP_TO_EDGE),r.activeTexture.set(i.TEXTURE4),l.demTexture.bind(u(l),i.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),o.u_dem_lerp=c;else{a=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(i.TEXTURE2);const t=this._prepareDemTileUniforms(e,a,o)?a.demTexture:this.emptyDEMTexture;t.bind(u(a),i.CLAMP_TO_EDGE),h(t)}if(r.activeTexture.set(i.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*Zd(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),t.setTerrainUniformValues(r,o),"globe"===this.painter.transform.projection.name){const i=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);t.setGlobeUniformValues(r,i)}}globeUniformValues(e,t,n){const r=e.projection;return{u_tile_tl_up:r.upVector(t,0,0),u_tile_tr_up:r.upVector(t,ar,0),u_tile_br_up:r.upVector(t,ar,ar),u_tile_bl_up:r.upVector(t,0,ar),u_tile_up_scale:n?rd(1):r.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const t=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,t,n,r,i){if("globe"===e.transform.projection.name)!function(e,t,n,r,i){const o=e.context,s=o.gl;let a,l;const c=e.transform,u=Td(e,o,c),h=(t,n)=>{if(l===n)return;const r=[XM[n],"PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING");const i=e.isTileAffectedByFog(t);a=e.getOrCreateProgram("globeRaster",{defines:r,overrideFog:i}),l=n},d=e.colorModeForRenderPass(),p=new y_(s.LEQUAL,y_.ReadWrite,e.depthRangeFor3D);qM.update(i);const f=function(e){const t=e.pixelsPerMeter,n=t/Zd(1,e.center.lat),r=_h.identity(new Float64Array(16));return _h.translate(r,r,[e.point.x,e.point.y,0]),_h.scale(r,r,[n,n,t]),Float32Array.from(r)}(c),m=[Gd(c.center.lng),Hd(c.center.lat)],g=e.globeSharedBuffers,y=[c.width*ut.devicePixelRatio,c.height*ut.devicePixelRatio],v=Float32Array.from(c.globeMatrix),_={useDenormalizedUpVectorScale:!0};{const c=e.transform,u=YM(c.zoom,t.exaggeration(),t.sourceCache._source.tileSize);l=-1;const x=s.TRIANGLES;for(const l of r){const r=n.getTile(l),b=__.disabled,w=t.prevTerrainTileForTile[l.key],S=t.terrainTileForTile[l.key];$M(w,S)&&qM.newMorphing(l.key,w,S,i,250),o.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const M=qM.getMorphValuesForProxy(l.key),T=M?1:0;M&&Lt(_,{morphing:{srcDemTile:M.from,dstDemTile:M.to,phase:E(M.phase)}});const C=dd(l.canonical),A=Ad(C.getCenter().lat),I=Cd(l.canonical,C,A,c.worldSize/c._pixelsPerMercatorPixel),P=_d(ad(l.canonical)),R=ZM(c.projMatrix,v,f,P,Md(c.zoom),m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,y,u,I);if(h(l,T),a&&(t.setupElevationDraw(r,a,_),e.uploadCommonUniforms(o,a,l.toUnwrapped()),g)){const[t,n,r]=g.getGridBuffers(A,0!==u);a.draw(e,x,p,b,d,M_.backCCW,R,"globe_raster",t,n,r)}}}if(g&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const i=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&i.push("CUSTOM_ANTIALIASING"),a=e.getOrCreateProgram("globeRaster",{defines:i});for(const i of r){const{x:r,y:l,z:u}=i.canonical,h=0===l,f=l===(1<<u)-1,[v,x,b,w]=g.getPoleBuffers(u,!1);if(w&&(h||f)){const l=n.getTile(i);o.activeTexture.set(s.TEXTURE0),l.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=Ed(u,r,c);const S=_d(ad(i.canonical)),M=(t,n)=>t.draw(e,s.TRIANGLES,p,__.disabled,d,M_.disabled,ZM(c.projMatrix,g,g,S,0,m,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,y,0),"globe_pole_raster",n,b,w);t.setupElevationDraw(l,a,_),e.uploadCommonUniforms(o,a,i.toUnwrapped()),h&&e.renderDefaultNorthPole&&M(a,v),f&&e.renderDefaultSouthPole&&(g=_h.scale(_h.create(),g,[1,-1,1]),M(a,x))}}}}(e,t,n,r,i);else{const o=e.context,s=o.gl;let a,l;const c=e.shadowRenderer,u=WM(e,e.longestCutoffRange),h=t=>{if(l===t)return;const n=[];n.push(XM[t]),u.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),a=e.getOrCreateProgram("terrainRaster",{defines:n}),l=t},d=e.colorModeForRenderPass(),p=new y_(s.LEQUAL,y_.ReadWrite,e.depthRangeFor3D);qM.update(i);const f=e.transform,m=YM(f.zoom,t.exaggeration(),t.sourceCache._source.tileSize);let g=[0,0,0];if(c){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(g=FT(t,n))}{l=-1;const y=s.TRIANGLES,[v,_]=[t.gridIndexBuffer,t.gridSegments];for(const l of r){const r=n.getTile(l),x=__.disabled,b=t.prevTerrainTileForTile[l.key],w=t.terrainTileForTile[l.key];$M(b,w)&&qM.newMorphing(l.key,b,w,i,250),o.activeTexture.set(s.TEXTURE0),r.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);const S=qM.getMorphValuesForProxy(l.key),M=S?1:0;let T;S&&(T={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:E(S.phase)}});const C=HM(l.projMatrix,KM(l.canonical,f.renderWorldCopies)?m/10:m,g);if(h(M),!a)continue;t.setupElevationDraw(r,a,T);const A=l.toUnwrapped();c&&c.setupShadows(A,a),e.uploadCommonUniforms(o,a,A,null,u),a.draw(e,y,p,x,d,M_.backCCW,C,"terrain_raster",t.gridBuffer,v,_)}}}}(t,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const t=this.painter,n=this.painter.context,r=this.proxySourceCache,i=this.proxiedCoords[r.id],o=this._drapedRenderBatches.shift(),s=t.style.order,a=[];let l=0;for(const c of i){const i=r.getTileByID(c.proxyTileKey),u=r.proxyCachedFBO[c.key]?r.proxyCachedFBO[c.key][e]:void 0,h=void 0!==u?r.renderCache[u]:this.pool[l++],d=void 0!==u;if(i.texture=h.tex,d&&!h.dirty){a.push(i.tileID);continue}let p;n.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(n.clear({color:cn.transparent,stencil:0}),h.dirty=!1);for(let e=o.start;e<=o.end;++e){const r=t.style._mergedLayers[s[e]];if(r.isHidden(t.transform.zoom))continue;const i=t.style.getLayerSourceCache(r),o=i?this.proxyToSource[c.key][i.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(h,o,r,i),p=i?i.id:null),t.renderLayer(t,i,r,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const r=t.style._mergedLayers[s[e]];if(r.isHidden(t.transform.zoom))continue;const i=t.style.getLayerSourceCache(r),o=i?this.proxyToSource[c.key][i.id]:[c];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(h,o,r,i),p=i?i.id:null),t.renderLayer(t,i,r,a)}this.renderedToTile?(h.dirty=!0,a.push(i.tileID)):d||--l,5===l&&(l=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let n=-1,r=t;for(let i=0;i<t;++i)this._style.isLayerDraped(e._mergedLayers[e.order[i]])?n=Math.max(n,i):r=Math.min(r,i);return r>n}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,n){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const i=r.tileID,o=1<<i.overscaledZ,{x:s,y:a}=i.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,e,t,n),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const i of r){if(null==i.t)return null;const r=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,e,t,n);if(null!=r)return r}return null}_createFBO(){const e=this.painter.context,t=e.gl,n=this.drapeBufferSize;e.activeTexture.set(t.TEXTURE0);const r=new yv(e,{width:n[0],height:n[1],data:null},t.RGBA);r.bind(t.LINEAR,t.CLAMP_TO_EDGE);const i=e.createFramebuffer(n[0],n[1],!0,null);return i.colorAttachment.set(r.texture),i.depthAttachment=new m_(e,i.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,i.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):i.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:i,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],n=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!n&&t.shouldRedrape():!n&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof Dw){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const n=this._style._mergedLayers[this._style.order[e]],r=this._style.getLayerSourceCache(n);if(r&&!t[r.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof bo){t[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t]._source instanceof Ow){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const n=this._style._mergedLayers[this._style.order[e]],r=this._style.getLayerSourceCache(n);if(!r||t[r.id])continue;if(n.isHidden(this.painter.transform.zoom)||"raster"!==n.type)continue;const i=n.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=QM(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,i);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const n=[];this._pendingGroundEffectLayers=[];let r,i=0,o=this._style._mergedLayers[e[i]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++i<t;)o=this._style._mergedLayers[e[i]];for(;i<t;++i){const t=this._style._mergedLayers[e[i]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===r&&(r=i):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(i),void 0!==r&&(n.push({start:r,end:i-1}),r=void 0)))}if(void 0!==r&&n.push({start:r,end:i-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||q("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let n=0;n<e.length;++n){const r=Object.values(e[n]);t.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const n=this.proxyCoords,r=this._tilesDirty;for(let i=n.length-1;i>=0;i--){const o=n[i];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const n=e[o.key],i=this.proxyToSource[o.key];let s=0;for(const e in i){const t=i[e],o=n[e];if(!o||o.length!==t.length||t.some(((t,n)=>t!==o[n]||r[e]&&r[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(n).length}}const i=[...this._drapedRenderBatches];i.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of i)for(const r of n){if(t.proxyCachedFBO[r.key])continue;let n=t.renderCachePool.pop();void 0===n&&t.renderCache.length<50&&(n=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==n&&(t.proxyCachedFBO[r.key]={},t.proxyCachedFBO[r.key][e.start]=n,t.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,n,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):__.disabled}_renderTileClippingMasks(e,t){const n=this.painter,r=this.painter.context,i=r.gl;n._tileClippingMaskIDs={},r.setColorMode(b_.disabled),r.setDepthMode(y_.disabled);const o=n.getOrCreateProgram("clippingMask");for(const r of e){const e=n._tileClippingMaskIDs[r.key]=--t;o.draw(n,i.TRIANGLES,y_.disabled,new __({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),b_.disabled,M_.disabled,JM(r.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const t=this.painter.transform;if(e.x<0||e.x>t.width||e.y<0||e.y>t.height)return null;const n=[e.x,e.y,1,1];hh.transformMat4(n,n,t.pixelMatrixInverse),hh.scale(n,n,1/n[3]),n[0]/=t.worldSize,n[1]/=t.worldSize;const r=t._camera.position,i=Zd(1,t.center.lat),o=[r[0],r[1],r[2]/i,0],s=Eh.subtract([],n.slice(0,3),o);Eh.normalize(s,s);const a=this.raycast(o,s,this._exaggeration);return null!==a&&a?(Eh.scaleAndAdd(o,o,s,a),o[3]=o[2],o[2]*=i,o):null}drawDepth(){const e=this.painter,t=e.context,n=this.proxySourceCache,r=Math.ceil(e.width),i=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===i||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,n=t.createFramebuffer(r,i,!0,"renderbuffer");t.activeTexture.set(e.TEXTURE0);const o=new yv(t,{width:r,height:i,data:null},e.RGBA);o.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(o.texture);const s=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,r,i);n.depthAttachment.set(s),this._depthFBO=n,this._depthTexture=o}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,r,i]),function(e,t,n,r){if("globe"===e.transform.projection.name)return;const i=e.context,o=i.gl;i.clear({depth:1});const s=e.getOrCreateProgram("terrainDepth"),a=new y_(o.LESS,y_.ReadWrite,e.depthRangeFor3D);for(const i of r){const r=n.getTile(i),l=HM(i.projMatrix,0,[0,0,0]);t.setupElevationDraw(r,s),s.draw(e,o.TRIANGLES,a,__.disabled,b_.unblended,M_.backCCW,l,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,n){if(e.getSource()instanceof Hb)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],i=this.proxyCoords;for(let t=0;t<i.length;t++){const o=i[t],s=this._findTileCoveringTileID(o,e);if(s){const t=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]);r.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let i=0;i<t.length;i++){const s=e.getTile(t[i]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],i=this._createProxiedId(a.tileID,s,n[a.tileID.key]&&n[a.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[a.tileID.key][e.id]=[i],r.push(i),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(e,t,n){if(!e.getSource().loaded())return;const r=this.proxiedCoords[e.id]=[],i=this.proxyCoords,o=e.getSource(),s=o.tileID;if(!s)return;const a=new v(s.x,s.y)._div(1<<s.z),l=o.coordinates.map(ep.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new v(Number.MAX_VALUE,Number.MAX_VALUE),max:new v(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,t)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),r=e.canonical.y/(1<<e.canonical.z),i=ar/(1<<e.canonical.z),o=t.wrap+t.canonical.x/(1<<t.canonical.z),s=t.canonical.y/(1<<t.canonical.z);return n+i<o+l.min.x||n>o+l.max.x||r+i<s+l.min.y||r>s+l.max.y};for(let o=0;o<i.length;o++){const s=i[o];for(let i=0;i<t.length;i++){const o=e.getTile(t[i]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],r.push(a)}}}_createProxiedId(e,t,n){let r=this.orthoMatrix;if(n){const e=n.find((e=>e.key===t.tileID.key));if(e)return e}if(t.tileID.key!==e.key){const n=e.canonical.z-t.tileID.canonical.z;let i,o,s;r=_h.create();const a=t.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(i=ar>>n,o=i*((t.tileID.canonical.x<<n)-e.canonical.x+a),s=i*((t.tileID.canonical.y<<n)-e.canonical.y)):(i=ar<<-n,o=ar*(t.tileID.canonical.x-(e.canonical.x+a<<-n)),s=ar*(t.tileID.canonical.y-(e.canonical.y<<-n))),_h.ortho(r,0,i,0,i,0,1),_h.translate(r,r,[o,s,0])}return new nE(t.tileID,e.key,r)}_findTileCoveringTileID(e,t){let n=t.getTile(e);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[t.id],i=r[e.key];if(n=i?t.getTileByID(i):null,n&&n.hasData()||null===i)return n;let o=n?n.tileID:e,s=o.overscaledZ;const a=t.getSource().minzoom,l=[];if(!i){const r=t.getSource().maxzoom;if(e.canonical.z>=r){const n=e.canonical.z-r;t.getSource().reparseOverscaled?(s=Math.max(e.canonical.z+2,t.transform.tileZoom),o=new Fh(s,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(s=r,o=new Fh(s,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n))}o.key!==e.key&&(l.push(o.key),n=t.getTile(o))}const c=e=>{l.forEach((t=>{r[t]=e})),l.length=0};for(s-=1;s>=a&&(!n||!n.hasData());s--){n&&c(n.tileID.key);const e=o.calculateScaledKey(s);if(n=t.getTileByID(e),n&&n.hasData())break;const i=r[e];if(null===i)break;void 0===i?l.push(e):n=t.getTileByID(i)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}}function iE(e,t,n){const r=function(e,t,n){const r=Eh.dot(t,e),i=Eh.dot(n,[.2126,.7152,.0722]),o=(e,t,n)=>(1-n)*e+n*t,s=o(1-.3*Math.min(i,1),1,Math.min(r+1,1));return o(.92,1,Math.asin(P(t[2],-1,1))/Math.PI+.5)*s}(e,[0,0,1],t),i=[0,0,0];Eh.scale(i,n.slice(0,3),r);const o=[0,0,0];Eh.scale(o,t.slice(0,3),e[2]);const s=[0,0,0];return Eh.add(s,i,o),ae(s)}const oE=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],sE=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class aE{static cacheKey(e,t,n,r){let i=`${t}${r?r.cacheKey:""}`;for(const t of n)e.usedDefines.includes(t)&&(i+=`/${t}`);return i}constructor(e,t,n,r,i,o){const s=e.gl;this.program=s.createProgram(),this.configuration=r,this.name=t,this.fixedDefines=[...o];const a=function(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const r=e[n].split(" ");t.push(r.pop())}return t}(n.staticAttributes),l=r?r.getBinderAttributes():[],c=a.concat(l);let u=r?r.defines():[];u=u.concat(o.map((e=>`#define ${e}`)));const h="#version 300 es\n";let d=h+u.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",OM,DM.fragmentSource).join("\n");for(const e of n.fragmentIncludes)d+=`\n${RM[e]}`;d+=`\n${n.fragmentSource}`;let p=h+u.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",OM,DM.vertexSource).join("\n");for(const e of n.vertexIncludes)p+=`\n${RM[e]}`;p+=`\n${n.vertexSource}`;const f=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f);const m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(f),this.fixedUniforms=i(e),this.binderUniforms=r?r.getUniforms(e):[],o.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new Al(e),u_dem_prev:new Al(e),u_dem_unpack:new Ll(e),u_dem_tl:new Pl(e),u_dem_scale:new Il(e),u_dem_tl_prev:new Pl(e),u_dem_scale_prev:new Il(e),u_dem_size:new Il(e),u_dem_lerp:new Il(e),u_exaggeration:new Il(e),u_depth:new Al(e),u_depth_size_inv:new Pl(e),u_meter_to_dem:new Il(e),u_label_plane_matrix_inv:new Nl(e)}))(e)),o.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new Rl(e),u_tile_tr_up:new Rl(e),u_tile_br_up:new Rl(e),u_tile_bl_up:new Rl(e),u_tile_up_scale:new Il(e)}))(e)),o.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new Nl(e),u_fog_range:new Pl(e),u_fog_color:new Ll(e),u_fog_horizon_blend:new Il(e),u_fog_vertical_limit:new Pl(e),u_fog_temporal_offset:new Il(e),u_frustum_tl:new Rl(e),u_frustum_tr:new Rl(e),u_frustum_br:new Rl(e),u_frustum_bl:new Rl(e),u_globe_pos:new Rl(e),u_globe_radius:new Il(e),u_globe_transition:new Il(e),u_is_globe:new Al(e),u_viewport:new Pl(e)}))(e)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new Ll(e)}))(e)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new Rl(e),u_lighting_directional_dir:new Rl(e),u_lighting_directional_color:new Rl(e),u_ground_radiance:new Rl(e)}))(e)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new Nl(e),u_light_matrix_1:new Nl(e),u_fade_range:new Pl(e),u_shadow_normal_offset:new Rl(e),u_shadow_intensity:new Il(e),u_shadow_texel_size:new Il(e),u_shadow_map_resolution:new Il(e),u_shadow_direction:new Rl(e),u_shadow_bias:new Rl(e),u_shadowmap_0:new Al(e),u_shadowmap_1:new Al(e)}))(e))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const n=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e]&&n[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const n=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const n=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const n=this.shadowUniforms;e.program.set(this.program);for(const e in t)n[e].set(this.program,e,t[e])}_drawDebugWireframe(e,t,n,r,i,o,s,a,l,c){const u=e.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const h=e.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||e._terrain&&e._terrain.renderingToTexture||!oE.includes(this.name))||!(!u.layers3D||!sE.includes(this.name)))())return;const d=h.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,i,h);if(!p)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=e.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(m.program);const g=(e,t,n)=>{if(t[e]&&n[e])for(const r in t[e])n[e][r]&&n[e][r].set(n.program,r,t[e][r].current)};l&&l.setUniforms(m.program,h,m.binderUniforms,s,{zoom:a}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),p.bind(),h.setColorMode(new b_([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],cn.transparent,[!0,!0,!0,!1])),h.setDepthMode(new y_(t.func===d.LESS?d.LEQUAL:t.func,y_.ReadOnly,t.range)),h.setStencilMode(__.disabled);const y=3*o.primitiveLength*2,v=3*o.primitiveOffset*2*2;c&&c>1?d.drawElementsInstanced(d.LINES,y,d.UNSIGNED_SHORT,v,c):d.drawElements(d.LINES,y,d.UNSIGNED_SHORT,v),i.bind(),h.program.set(this.program),h.setDepthMode(t),h.setStencilMode(n),h.setColorMode(r)}draw(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=e.context,y=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(r),g.setColorMode(i),g.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,s[e]);p&&p.setUniforms(this.program,g,this.binderUniforms,h,{zoom:d});const v={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t],_=m&&m>0?1:void 0;for(const o of u.get()){const s=o.vaos||(o.vaos={});(s[a]||(s[a]=new zM)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],_),m&&m>1?y.drawElementsInstanced(t,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2,m):y.drawElements(t,o.primitiveLength*v,y.UNSIGNED_SHORT,o.primitiveOffset*v*2),t===y.TRIANGLES&&this._drawDebugWireframe(e,n,r,i,c,o,h,d,p,m)}}}function lE(e,t){const n=Math.pow(2,t.tileID.overscaledZ),r=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,i=r*(t.tileID.canonical.x+t.tileID.wrap*n),o=r*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/X_(t,1,e.transform.tileZoom),u_pixel_coord_upper:[i>>16,o>>16],u_pixel_coord_lower:[65535&i,65535&o]}}const cE=_h.create(),uE=(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f)=>{const m=t.style.light,g=m.properties.get("position"),y=[g.x,g.y,g.z],v=yh.create();"viewport"===m.properties.get("anchor")&&(yh.fromRotation(v,-t.transform.angle),Eh.transformMat3(y,y,v));const _=m.properties.get("color"),x=t.transform,b={u_matrix:e,u_lightpos:y,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cE,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:i,u_edge_radius:o,u_flood_light_color:h,u_vertical_scale:d,u_flood_light_intensity:p,u_ground_shadow_factor:f};return"globe"===x.projection.name&&(b.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],b.u_zoom_transition=l,b.u_inv_rot_matrix=u,b.u_merc_center=c,b.u_up_dir=x.projection.upVector(new Nh(0,0,0),c[0]*ar,c[1]*ar),b.u_height_lift=a),b},hE=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),dE=(e,t,n,r,i,o,s,a,l,c,u,h,d,p)=>{const f=uE(e,t,n,r,i,o,s,l,c,u,h,d,p,1,[0,0,0]),m={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return N(f,lE(t,a),m)},pE=(e,t)=>({u_matrix:e,u_emissive_strength:t}),fE=(e,t,n,r)=>N(pE(e,t),lE(n,r)),mE=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),gE=(e,t,n,r,i)=>N(fE(e,t,n,r),{u_world:i}),yE=(e,t,n,r)=>{const i=ar/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(r),u_extrude_scale:[t.pixelsToGLUnits[0]/i,t.pixelsToGLUnits[1]/i]}},vE=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),_E=_h.create(),xE=(e,t,n,r,i,o,s)=>{const a=e.transform,l="globe"===a.projection.name,c=l?wd(a.zoom,t.canonical)*a._pixelsPerMercatorPixel:X_(n,1,o),u={u_matrix:t.projMatrix,u_extrude_scale:c,u_intensity:s,u_inv_rot_matrix:_E,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=i,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=Md(a.zoom);const e=i[0]*ar,n=i[1]*ar;u.u_up_dir=a.projection.upVector(new Nh(0,0,0),e,n)}return u},bE=(e,t,n,r,i,o,s,a,l,c,u)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_tl_parent:r,u_scale_parent:i,u_fade_t:o.mix,u_opacity:o.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(d=s.paint.get("raster-saturation"),d>0?1-1/(1.001-d):-d),u_contrast_factor:(h=s.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:wE(s.paint.get("raster-hue-rotate")),u_perspective_transform:a,u_colorization_mix:c,u_colorization_scale:SE(u),u_color_ramp:l};var h,d};function wE(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function SE([e,t]){if(e===t)return[e,t];const n=(t+e)/2,r=(t-e)/2*256/255;return[-(e=n-r)/((t=n+r)-e),1/(t-e)]}const ME=_h.create(),EE=(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g)=>{const y=i.transform,v={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:y.getCameraToCenterDistance(m),u_rotate_symbol:+n,u_aspect_ratio:y.width/y.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ME,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ME,u_up_vector:[0,-1,0],u_icon_transition:g||0};return"globe"===m.name&&(v.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],v.u_zoom_transition=h,v.u_inv_rot_matrix=p,v.u_merc_center=d,v.u_camera_forward=y._camera.forward(),v.u_ecef_origin=function(e,t){const n=[0,0,0],r=_d(ad(t.canonical));return Eh.transformMat4(n,n,r),Eh.transformMat4(n,n,e),n}(y.globeMatrix,u.toUnwrapped()),v.u_tile_matrix=Float32Array.from(y.globeMatrix),v.u_up_vector=f),v},TE=(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g)=>N(EE(e,t,n,r,i,o,s,a,l,c,h,d,p,f,m,g),{u_gamma_scale:r?i.transform.getCameraToCenterDistance(g)*Math.cos(i.terrain?0:i.transform._pitch):1,u_device_pixel_ratio:ut.devicePixelRatio,u_is_halo:+u,undefined:void 0}),CE=(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m)=>N(TE(e,t,n,r,i,o,s,a,!0,l,!0,u,h,d,p,f,m),{u_texsize_icon:c,u_texture_icon:1}),AE=(e,t,n,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:r}),IE=(e,t,n,r,i,o,s)=>N(function(e,t,n,r){const i=n.imageManager.getPattern(e.toString(),t),{width:o,height:s}=n.imageManager.getPixelSize(t),a=Math.pow(2,r.tileID.overscaledZ),l=r.tileSize*Math.pow(2,n.transform.tileZoom)/a,c=l*(r.tileID.canonical.x+r.tileID.wrap*a),u=l*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[o,s],u_pattern_size:i.displaySize,u_tile_units_to_pixels:1/X_(r,1,n.transform.tileZoom),u_pixel_coord_upper:[c>>16,u>>16],u_pixel_coord_lower:[65535&c,65535&u]}}(i,o,r,s),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),PE={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},RE=(e,t,n,r,i,o,s,a,l,c,u,h=[0,0,0])=>{const d=r.style.light,p=d.properties.get("position"),f=[-p.x,-p.y,p.z],m=yh.create();"viewport"===d.properties.get("anchor")&&(yh.fromRotation(m,-r.transform.angle),Eh.transformMat3(f,f,m));const g="MASK"===c.alphaMode,y=d.properties.get("color"),v=u.paint.get("model-ambient-occlusion-intensity"),_=u.paint.get("model-color").constantOr(cn.white),x=u.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:f,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_camera_pos:h,u_opacity:i,u_baseTextureIsAlpha:0,u_alphaMask:+g,u_alphaCutoff:c.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:l,u_baseColorTexture:PE.BaseColor,u_metallicRoughnessTexture:PE.MetallicRoughness,u_normalTexture:PE.Normal,u_occlusionTexture:PE.Occlusion,u_emissionTexture:PE.Emission,u_color_mix:[_.r,_.g,_.b,x],u_aoIntensity:v}},LE=new Float32Array(16),DE=(e,t=LE,n=LE)=>({u_matrix:e,u_instance:t,u_node_matrix:n}),OE={fillExtrusion:e=>({u_matrix:new Nl(e),u_lightpos:new Rl(e),u_lightintensity:new Il(e),u_lightcolor:new Rl(e),u_vertical_gradient:new Il(e),u_opacity:new Il(e),u_edge_radius:new Il(e),u_ao:new Pl(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_up_dir:new Rl(e),u_height_lift:new Il(e),u_flood_light_color:new Rl(e),u_vertical_scale:new Il(e),u_flood_light_intensity:new Il(e),u_ground_shadow_factor:new Rl(e)}),fillExtrusionDepth:e=>({u_matrix:new Nl(e),u_edge_radius:new Il(e),u_vertical_scale:new Il(e)}),fillExtrusionPattern:e=>({u_matrix:new Nl(e),u_lightpos:new Rl(e),u_lightintensity:new Il(e),u_lightcolor:new Rl(e),u_vertical_gradient:new Il(e),u_height_factor:new Il(e),u_edge_radius:new Il(e),u_ao:new Pl(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_up_dir:new Rl(e),u_height_lift:new Il(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Il(e),u_opacity:new Il(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Nl(e),u_opacity:new Il(e),u_ao_pass:new Il(e),u_meter_to_tile:new Il(e),u_ao:new Pl(e),u_flood_light_intensity:new Il(e),u_flood_light_color:new Rl(e),u_attenuation:new Il(e),u_edge_radius:new Il(e),u_fb:new Al(e),u_fb_size:new Il(e)}),fill:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e)}),fillPattern:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Il(e)}),fillOutline:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e),u_world:new Pl(e)}),fillOutlinePattern:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e),u_world:new Pl(e),u_image:new Al(e),u_texsize:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Il(e)}),circle:e=>({u_camera_to_center_distance:new Il(e),u_extrude_scale:new Bl(e),u_device_pixel_ratio:new Il(e),u_matrix:new Nl(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_up_dir:new Rl(e),u_emissive_strength:new Il(e)}),collisionBox:e=>({u_matrix:new Nl(e),u_camera_to_center_distance:new Il(e),u_extrude_scale:new Pl(e)}),collisionCircle:e=>({u_matrix:new Nl(e),u_inv_matrix:new Nl(e),u_camera_to_center_distance:new Il(e),u_viewport_size:new Pl(e)}),debug:e=>({u_color:new Dl(e),u_matrix:new Nl(e),u_overlay:new Al(e),u_overlay_scale:new Il(e)}),clippingMask:e=>({u_matrix:new Nl(e)}),heatmap:e=>({u_extrude_scale:new Il(e),u_intensity:new Il(e),u_matrix:new Nl(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_up_dir:new Rl(e)}),heatmapTexture:e=>({u_image:new Al(e),u_color_ramp:new Al(e),u_opacity:new Il(e)}),hillshade:e=>({u_matrix:new Nl(e),u_image:new Al(e),u_latrange:new Pl(e),u_light:new Pl(e),u_shadow:new Dl(e),u_highlight:new Dl(e),u_emissive_strength:new Il(e),u_accent:new Dl(e)}),hillshadePrepare:e=>({u_matrix:new Nl(e),u_image:new Al(e),u_dimension:new Pl(e),u_zoom:new Il(e),u_unpack:new Ll(e)}),line:e=>({u_matrix:new Nl(e),u_pixels_to_tile_units:new Bl(e),u_device_pixel_ratio:new Il(e),u_units_to_pixels:new Pl(e),u_dash_image:new Al(e),u_gradient_image:new Al(e),u_image_height:new Il(e),u_texsize:new Pl(e),u_tile_units_to_pixels:new Il(e),u_alpha_discard_threshold:new Il(e),u_trim_offset:new Pl(e),u_emissive_strength:new Il(e)}),linePattern:e=>({u_matrix:new Nl(e),u_texsize:new Pl(e),u_pixels_to_tile_units:new Bl(e),u_device_pixel_ratio:new Il(e),u_image:new Al(e),u_units_to_pixels:new Pl(e),u_tile_units_to_pixels:new Il(e),u_alpha_discard_threshold:new Il(e)}),raster:e=>({u_matrix:new Nl(e),u_normalize_matrix:new Nl(e),u_globe_matrix:new Nl(e),u_tl_parent:new Pl(e),u_scale_parent:new Il(e),u_fade_t:new Il(e),u_opacity:new Il(e),u_image0:new Al(e),u_image1:new Al(e),u_brightness_low:new Il(e),u_brightness_high:new Il(e),u_saturation_factor:new Il(e),u_contrast_factor:new Il(e),u_spin_weights:new Rl(e),u_perspective_transform:new Pl(e),u_colorization_mix:new Ll(e),u_colorization_scale:new Pl(e),u_color_ramp:new Al(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Il(e),u_size:new Il(e),u_camera_to_center_distance:new Il(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Il(e),u_fade_change:new Il(e),u_matrix:new Nl(e),u_label_plane_matrix:new Nl(e),u_coord_matrix:new Nl(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_camera_forward:new Rl(e),u_tile_matrix:new Nl(e),u_up_vector:new Rl(e),u_ecef_origin:new Rl(e),u_texture:new Al(e),u_icon_transition:new Il(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Il(e),u_size:new Il(e),u_camera_to_center_distance:new Il(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Il(e),u_fade_change:new Il(e),u_matrix:new Nl(e),u_label_plane_matrix:new Nl(e),u_coord_matrix:new Nl(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_texture:new Al(e),u_gamma_scale:new Il(e),u_device_pixel_ratio:new Il(e),u_tile_id:new Rl(e),u_zoom_transition:new Il(e),u_inv_rot_matrix:new Nl(e),u_merc_center:new Pl(e),u_camera_forward:new Rl(e),u_tile_matrix:new Nl(e),u_up_vector:new Rl(e),u_ecef_origin:new Rl(e),u_is_halo:new Al(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Al(e),u_is_size_feature_constant:new Al(e),u_size_t:new Il(e),u_size:new Il(e),u_camera_to_center_distance:new Il(e),u_rotate_symbol:new Al(e),u_aspect_ratio:new Il(e),u_fade_change:new Il(e),u_matrix:new Nl(e),u_label_plane_matrix:new Nl(e),u_coord_matrix:new Nl(e),u_is_text:new Al(e),u_pitch_with_map:new Al(e),u_texsize:new Pl(e),u_texsize_icon:new Pl(e),u_texture:new Al(e),u_texture_icon:new Al(e),u_gamma_scale:new Il(e),u_device_pixel_ratio:new Il(e),u_is_halo:new Al(e)}),background:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e),u_opacity:new Il(e),u_color:new Dl(e)}),backgroundPattern:e=>({u_matrix:new Nl(e),u_emissive_strength:new Il(e),u_opacity:new Il(e),u_image:new Al(e),u_pattern_tl:new Pl(e),u_pattern_br:new Pl(e),u_texsize:new Pl(e),u_pattern_size:new Pl(e),u_pixel_coord_upper:new Pl(e),u_pixel_coord_lower:new Pl(e),u_tile_units_to_pixels:new Il(e)}),terrainRaster:GM,terrainDepth:GM,skybox:e=>({u_matrix:new Nl(e),u_sun_direction:new Rl(e),u_cubemap:new Al(e),u_opacity:new Il(e),u_temporal_offset:new Il(e)}),skyboxGradient:e=>({u_matrix:new Nl(e),u_color_ramp:new Al(e),u_center_direction:new Rl(e),u_radius:new Il(e),u_opacity:new Il(e),u_temporal_offset:new Il(e)}),skyboxCapture:e=>({u_matrix_3f:new Fl(e),u_sun_direction:new Rl(e),u_sun_intensity:new Il(e),u_color_tint_r:new Ll(e),u_color_tint_m:new Ll(e),u_luminance:new Il(e)}),globeRaster:e=>({u_proj_matrix:new Nl(e),u_globe_matrix:new Nl(e),u_normalize_matrix:new Nl(e),u_merc_matrix:new Nl(e),u_zoom_transition:new Il(e),u_merc_center:new Pl(e),u_image0:new Al(e),u_grid_matrix:new Fl(e),u_skirt_height:new Il(e),u_frustum_tl:new Rl(e),u_frustum_tr:new Rl(e),u_frustum_br:new Rl(e),u_frustum_bl:new Rl(e),u_globe_pos:new Rl(e),u_globe_radius:new Il(e),u_viewport:new Pl(e)}),globeAtmosphere:e=>({u_frustum_tl:new Rl(e),u_frustum_tr:new Rl(e),u_frustum_br:new Rl(e),u_frustum_bl:new Rl(e),u_horizon:new Il(e),u_transition:new Il(e),u_fadeout_range:new Il(e),u_color:new Ll(e),u_high_color:new Ll(e),u_space_color:new Ll(e),u_temporal_offset:new Il(e),u_horizon_angle:new Il(e)}),model:e=>({u_matrix:new Nl(e),u_lighting_matrix:new Nl(e),u_normal_matrix:new Nl(e),u_lightpos:new Rl(e),u_lightintensity:new Il(e),u_lightcolor:new Rl(e),u_camera_pos:new Rl(e),u_opacity:new Il(e),u_baseColorFactor:new Ll(e),u_emissiveFactor:new Ll(e),u_metallicFactor:new Il(e),u_roughnessFactor:new Il(e),u_baseTextureIsAlpha:new Al(e),u_alphaMask:new Al(e),u_alphaCutoff:new Il(e),u_baseColorTexture:new Al(e),u_metallicRoughnessTexture:new Al(e),u_normalTexture:new Al(e),u_occlusionTexture:new Al(e),u_emissionTexture:new Al(e),u_color_mix:new Ll(e),u_aoIntensity:new Il(e)}),modelDepth:e=>({u_matrix:new Nl(e),u_instance:new Nl(e),u_node_matrix:new Nl(e)}),groundShadow:e=>({u_matrix:new Nl(e),u_ground_shadow_factor:new Rl(e)}),stars:e=>({u_matrix:new Nl(e),u_up:new Rl(e),u_right:new Rl(e),u_intensity_multiplier:new Il(e)})};let NE;function kE(e,t,n,r,i,o,s){const a=e.context,l=a.gl,c=e.transform,u=e.getOrCreateProgram("collisionBox"),h=[];let d=0,p=0;for(let a=0;a<r.length;a++){const f=r[a],m=t.getTile(f),g=m.getBucket(n);if(!g)continue;const y=VS(f,g,c);let v=y;0===i[0]&&0===i[1]||(v=e.translatePosMatrix(y,m,i,o));const _=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const e=_h.create(),t=v;_h.mul(e,g.placementInvProjMatrix,c.glCoordMatrix),_h.mul(e,e,g.placementViewportMatrix),h.push({circleArray:x,circleOffset:p,transform:t,invTransform:e,projection:g.getProjection()}),d+=x.length/4,p=d}_&&(e.terrain&&e.terrain.setupElevationDraw(m,u),u.draw(e,l.LINES,y_.disabled,__.disabled,e.colorModeForRenderPass(),M_.disabled,yE(v,c,m,g.getProjection()),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,c.zoom,null,[_.collisionVertexBuffer,_.collisionVertexBufferExt]))}if(!s||!h.length)return;const f=e.getOrCreateProgram("collisionCircle"),m=new za;m.resize(4*d),m._trim();let g=0;for(const e of h)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,r=e.circleArray[n+0],i=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];m.emplace(g++,r,i,o,s,0),m.emplace(g++,r,i,o,s,1),m.emplace(g++,r,i,o,s,2),m.emplace(g++,r,i,o,s,3)}(!NE||NE.length<2*d)&&(NE=function(e){const t=2*e,n=new ja;n.resize(t),n._trim();for(let e=0;e<t;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(d));const y=a.createIndexBuffer(NE,!0),v=a.createVertexBuffer(m,ng.members,!0);for(const t of h){const r={u_matrix:t.transform,u_inv_matrix:t.invTransform,u_camera_to_center_distance:(_=c).getCameraToCenterDistance(t.projection),u_viewport_size:[_.width,_.height]};f.draw(e,l.TRIANGLES,y_.disabled,__.disabled,e.colorModeForRenderPass(),M_.disabled,r,n.id,v,y,dl.simpleSegment(0,2*t.circleOffset,t.circleArray.length,t.circleArray.length/2),null,c.zoom)}var _;v.destroy(),y.destroy()}const FE=_h.create();function zE({width:e,height:t,anchor:n,textOffset:r,textScale:i},o){const{horizontalAlign:s,verticalAlign:a}=Og(n),l=-(s-.5)*e,c=-(a-.5)*t,u=hy(n,r);return new v((l/i+u[0])*o,(c/i+u[1])*o)}function BE(e,t,n,r,i,o,s,a,l,c,u){const h=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,f={},m=e.getProjection(),g=GS(a,m,o),y=o.elevation,v=m.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let p=0;p<h.length;p++){const _=h.get(p),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=_,S=_.hidden||!_.crossTileID||e.allowVerticalPlacement&&!_.placedOrientation?null:r[_.crossTileID];if(S){let r=0,h=0,p=0;if(y){const e=y?y.getAtTileOffset(a,x,b):0,[t,n,i]=m.upVector(a.canonical,x,b);r=e*t*v,h=e*n*v,p=e*i*v}let[M,E,T,C]=tx(_.projectedAnchorX+r,_.projectedAnchorY+h,_.projectedAnchorZ+p,n?g:s);const A=nx(o.getCameraToCenterDistance(m),C);let I=i.evaluateSizeForFeature(e.textSizeData,c,_)*A/rg;n&&(I*=e.tilePixelRatio/l);const P=zE(S,I);n?(({x:M,y:E,z:T}=m.projectTilePoint(x+P.x,b+P.y,a.canonical)),[M,E,T]=tx(M+r,E+h,T+p,s)):(t&&P._rotate(-o.angle),M+=P.x,E+=P.y,T=0);const R=e.allowVerticalPlacement&&_.placedOrientation===wg.vertical?Math.PI/2:0;for(let e=0;e<w;e++)iv(d,M,E,T,R);u&&_.associatedIconIndex>=0&&(f[_.associatedIconIndex]={x:M,y:E,z:T,angle:R})}else hx(w,d)}if(u){p.clear();const t=e.icon.placedSymbolArray;for(let e=0;e<t.length;e++){const n=t.get(e),{numGlyphs:r}=n,i=f[e];if(n.hidden||!i)hx(r,p);else{const{x:e,y:t,z:n,angle:o}=i;for(let i=0;i<r;i++)iv(p,e,t,n,o)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function UE(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function jE(e,t,n,r,i,o,s,a,l,c,u,h){const d=e.context,p=d.gl,f=e.transform,m="map"===a,g="map"===l,y=m&&"point"!==n.layout.get("symbol-placement"),v=m&&!g&&!y,_=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let x=!1;const b=e.depthModeForSublayer(0,y_.ReadOnly),w=[Gd(f.center.lng),Hd(f.center.lat)],S=n.layout.get("text-variable-anchor"),M="globe"===f.projection.name,E=[],T=[0,-1,0];let C=T;!M&&!f.mercatorFromTransition||m||(C=function(e){const t=e._camera.getWorldToCamera(e.worldSize,1),n=_h.multiply([],t,e.globeMatrix);_h.invert(n,n);const r=[0,0,0],i=[0,1,0,0];return hh.transformMat4(i,i,n),r[0]=i[0],r[1]=i[1],r[2]=i[2],Eh.normalize(r,r),r}(f));for(const a of r){const r=t.getTile(a),l=r.getBucket(n);if(!l)continue;if("mercator"===l.projection.name&&M)continue;const u=i?l.text:l.icon;if(!u||l.fullyClipped||!u.segments.get().length)continue;const h=u.programConfigurations.get(n.id),d=i||l.sdfIcons,b=i?l.textSizeData:l.iconSizeData,A=g||0!==f.pitch,I=ag(b,f.zoom);let P,R,L,D,O=[0,0],N=null;if(i)R=r.glyphAtlasTexture,L=p.LINEAR,P=r.glyphAtlasTexture.size,l.iconsInText&&(O=r.imageAtlasTexture.size,N=r.imageAtlasTexture,D=A||e.options.rotating||e.options.zooming||"composite"===b.kind||"camera"===b.kind?p.LINEAR:p.NEAREST);else{const t=1!==n.layout.get("icon-size").constantOr(0)||l.iconsNeedLinear;R=r.imageAtlasTexture,L=d||e.options.rotating||e.options.zooming||t||A?p.LINEAR:p.NEAREST,P=r.imageAtlasTexture.size}const k="globe"===l.projection.name,F=k?C:T,z=k?Md(f.zoom):0,B=GS(a,l.getProjection(),f),U=f.calculatePixelsToTileUnitsMatrix(r),j=J_(B,r.tileID.canonical,g,m,f,l.getProjection(),U),V=e.terrain&&g&&y?_h.invert(_h.create(),j):FE,G=ex(B,r.tileID.canonical,g,m,f,l.getProjection(),U),H=S&&l.hasTextData(),Z=l.hasIconTextFit()&&H&&l.hasIconData();if(y){const t=f.elevation,n=t?t.getAtTileOffsetFunc(a,f.center.lat,f.worldSize,l.getProjection()):null,o=Q_(B,r.tileID.canonical,g,m,f,l.getProjection(),U);ix(l,B,e,i,o,G,g,c,n,a)}const W=y||i&&S||Z,$=e.translatePosMatrix(B,r,o,s),q=W?FE:j,X=e.translatePosMatrix(G,r,o,s,!0),Y=l.getProjection().createInversionMatrix(f,a.canonical),K=n.paint.get("icon-image-cross-fade").constantOr(0),J=[];e.terrainRenderModeElevated()&&g&&J.push("PITCH_WITH_MAP_TERRAIN"),k&&(J.push("PROJECTION_GLOBE_VIEW"),W&&J.push("PROJECTED_POS_ON_VIEWPORT")),K>0&&J.push("ICON_TRANSITION"),u.zOffsetVertexBuffer&&J.push("Z_OFFSET");const Q=d&&0!==n.paint.get(i?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=d?l.iconsInText?CE(b.kind,I,v,g,e,$,q,X,P,O,a,z,w,Y,F,l.getProjection()):TE(b.kind,I,v,g,e,$,q,X,i,P,!0,a,z,w,Y,F,l.getProjection()):EE(b.kind,I,v,g,e,$,q,X,i,P,a,z,w,Y,F,l.getProjection(),K);const te={program:e.getOrCreateProgram(UE(d,i,l),{config:h,defines:J}),buffers:u,uniformValues:ee,atlasTexture:R,atlasTextureIcon:N,atlasInterpolation:L,atlasInterpolationIcon:D,isSDF:d,hasHalo:Q,tile:r,labelPlaneMatrixInv:V};if(_&&l.canOverlap){x=!0;const e=u.segments.get();for(const t of e)E.push({segments:new dl([t]),sortKey:t.sortKey,state:te})}else E.push({segments:u.segments,sortKey:0,state:te})}x&&E.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of E){const r=t.state;if(e.terrain&&e.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:f.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),d.activeTexture.set(p.TEXTURE0),r.atlasTexture.bind(r.atlasInterpolation,p.CLAMP_TO_EDGE),r.atlasTextureIcon&&(d.activeTexture.set(p.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,p.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,r.program),r.hasHalo){const i=r.uniformValues;i.u_is_halo=1,VE(r.buffers,t.segments,n,e,r.program,b,u,h,i,2),i.u_is_halo=0}else{if(r.isSDF){const i=r.uniformValues;r.hasHalo&&(i.u_is_halo=1,VE(r.buffers,t.segments,n,e,r.program,b,u,h,i,1)),i.u_is_halo=0}VE(r.buffers,t.segments,n,e,r.program,b,u,h,r.uniformValues,1)}}}function VE(e,t,n,r,i,o,s,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];i.draw(r,r.context.gl.TRIANGLES,o,s,a,M_.disabled,l,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),u,c)}function GE(e,t,n,r,i,o,s){const a=e.context.gl,l=n.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,d,p,f;s?(h=c&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of r){const r=t.getTile(m);if(c&&!r.patternsLoaded())continue;const g=r.getBucket(n);if(!g)continue;e.prepareDrawTile();const y=g.programConfigurations.get(n.id),v=e.isTileAffectedByFog(m),_=e.getOrCreateProgram(h,{config:y,overrideFog:v});c&&(e.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y.updatePaintBuffers());const x=l.constantOr(null);if(x&&r.imageAtlas){const e=r.imageAtlas.patternPositions[x.toString()];e&&y.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),w=n.paint.get("fill-emissive-strength");if(s){p=g.indexBuffer2,f=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];d="fillOutlinePattern"===h&&c?gE(b,w,e,r,t):mE(b,w,t)}else p=g.indexBuffer,f=g.segments,d=c?fE(b,w,e,r):pE(b,w);e.uploadCommonUniforms(e.context,_,m.toUnwrapped()),_.draw(e,u,i,e.stencilModeForClipping(m),o,M_.disabled,d,n.id,g.layoutVertexBuffer,p,f,n.paint,e.transform.zoom,y,void 0)}}function HE(e,t,n,r,i,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),f=e.style.enable3dLights(),m=n.paint.get(f&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),g=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),m],y=n.layout.get("fill-extrusion-edge-radius"),v=y>0&&!n.paint.get("fill-extrusion-rounded-roof"),_=v?0:y,x="globe"===u.projection.name?xb():0,b="globe"===u.projection.name,w=b?Md(u.zoom):0,S=[Gd(u.center.lng),Hd(u.center.lat)],M=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=n.paint.get("fill-extrusion-flood-light-intensity"),T=n.paint.get("fill-extrusion-vertical-scale"),C=WM(e,n.paint.get("fill-extrusion-cutoff-fade-range")),A=[];let I;b&&A.push("PROJECTION_GLOBE_VIEW"),g[0]>0&&A.push("FAUX_AO"),v&&A.push("ZERO_ROOF_RADIUS"),a&&A.push("HAS_CENTROID"),E>0&&A.push("FLOOD_LIGHT"),C.shouldRenderCutoff&&A.push("RENDER_CUTOFF");const P="shadow"===e.renderPass,R=e.shadowRenderer,L=P&&!!R;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let D=[0,0,0];if(R){const t=e.style.directionalLight,n=e.style.ambientLight;t&&n&&(D=FT(t,n)),I=A.concat(["SHADOWS_SINGLE_CASCADE"])}const O=L?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion";for(const f of r){const r=t.getTile(f),m=r.getBucket(n);if(!m||m.projection.name!==u.projection.name)continue;let y=!1;R&&(y=0===R.getMaxCascadeForTile(f.toUnwrapped()));const v=e.isTileAffectedByFog(f),L=m.programConfigurations.get(n.id),N=e.getOrCreateProgram(O,{config:L,defines:y?I:A,overrideFog:v});if(e.terrain){const t=e.terrain;e.style.terrainSetForDrapingOnly(),t.setupElevationDraw(r,N,{useMeterToDem:!0})}if(!m.centroidVertexBuffer){const e=N.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}!P&&R&&R.setupShadows(r.tileID.toUnwrapped(),N,"vector-tile",r.tileID.overscaledZ),d&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),L.updatePaintBuffers());const k=h.constantOr(null);if(k&&r.imageAtlas){const e=r.imageAtlas.patternPositions[k.toString()];e&&L.setConstantPatternPositions(e)}const F=n.paint.get("fill-extrusion-vertical-gradient");let z;if(P&&R){if(YE(r.tileID,m,e))continue;const t=R.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());z=hE(t,_,T)}else{const t=e.translatePosMatrix(f.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=u.projection.createInversionMatrix(u,f.canonical);z=d?dE(t,e,F,p,g,_,f,r,x,w,S,i,M,T):uE(t,e,F,p,g,_,f,x,w,S,i,M,T,E,D)}e.uploadCommonUniforms(l,N,f.toUnwrapped(),null,C);const B=[];(e.terrain||a)&&B.push(m.centroidVertexBuffer),b&&B.push(m.layoutVertexExtBuffer),N.draw(e,l.gl.TRIANGLES,i,o,s,M_.backCCW,z,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,L,B)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function ZE(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v){const _=e.context,x=_.gl,b=e.transform,w=e.transform.zoom,S=[],M=WM(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(S.push("CLEAR_SUBPASS"),v&&(S.push("CLEAR_FROM_TEXTURE"),_.activeTexture.set(x.TEXTURE0),v.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===c&&S.push("SDF_SUBPASS"),g&&S.push("HAS_CENTROID"),M.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const E=n.layout.get("fill-extrusion-edge-radius"),T=(t,r,c,y,x)=>{const b=r.programConfigurations.get(n.id),T=e.isTileAffectedByFog(t),C=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:S,overrideFog:T}),A=((e,t,n,r,i,o,s,a,l,c,u)=>({u_matrix:t,u_opacity:n,u_ao_pass:r?1:0,u_meter_to_tile:i,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,y,u,l,x,[h,d*x],p,f,m,w>=17?0:E*x,v?v.size[0]:0),I=[];g&&I.push(r.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(_,C,t.toUnwrapped(),null,M),C.draw(e,_.gl.TRIANGLES,i,o,s,a,A,n.id,r.vertexBuffer,r.indexBuffer,c,n.paint,w,b,I)};for(const i of r){const r=t.getTile(i),o=r.getBucket(n);if(!o||o.projection.name!==b.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const s=o.groundEffect,a=1/o.tileToMeter;{const t=e.translatePosMatrix(i.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),o=s.getDefaultSegment();T(i,s,o,t,a)}if(y)for(let o=0;o<4;o++){const s=Bh[o](i),l=t.getTile(s);if(!l)continue;const c=l.getBucket(n);if(!c||c.projection.name!==b.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let h,d;0===o?(h=[-ar,0,0],d=1):1===o?(h=[ar,0,0],d=0):2===o?(h=[0,-ar,0],d=3):(h=[0,ar,0],d=2);const p=u.regionSegments[d];if(!p)continue;const f=new Float32Array(16);_h.translate(f,i.projMatrix,h),T(i,u,p,e.translatePosMatrix(f,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),a)}}}function WE(e,t,n,r,i,o,s){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const a=o?o.findDEMTileFor(n):null;if(!(a&&a.dem||s))return;const l=e=>{const n=t.getSource().minzoom,r=e=>{const n=t.getTileByID(e);if(n&&n.hasData())return n.getBucket(i)},o=[0,-1,1];for(const t of o){if(e.overscaledZ+t<n)continue;const i=r(e.calculateScaledKey(e.overscaledZ+t));if(i)return i}},c=[0,0,0],u=(e,t)=>(c[0]=Math.min(e.min.y,t.min.y),c[1]=Math.max(e.max.y,t.max.y),c[2]=ar-t.min.x>e.max.x?t.min.x-ar:e.max.x,c),h=(e,t)=>(c[0]=Math.min(e.min.x,t.min.x),c[1]=Math.max(e.max.x,t.max.x),c[2]=ar-t.min.y>e.max.y?t.min.y-ar:e.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=(e,t,r,i,s,l,c)=>{if(!o)return 0;const u=[[l?r:e,l?e:r,0],[l?r:t,l?t:r,0]],h=c<0?ar+c:c,d=[l?h:(e+t)/2,l?(e+t)/2:h,0];return 0===r&&c<0||0!==r&&c>0?o.getForTilePoints(s,[d],!0,i):u.push(d),o.getForTilePoints(n,u,!0,a),Math.max(u[0][2],u[1][2],d[2])/o.exaggeration()};for(let e=0;e<4;e++){const t=r.borderFeatureIndices[e];if(0===t.length)continue;const i=Bh[e](n),a=l(i);if(!(a&&a instanceof db))continue;if(r.borderDoneWithNeighborZ[e]===a.canonical.z)continue;0===a.centroidVertexArray.length&&a.createCentroidsBuffer();const c=o?o.findDEMTileFor(i):null;if(!(c&&c.dem||s))continue;const u=(e<2?1:5)-e,h=a.borderDoneWithNeighborZ[u]!==r.canonical.z,y=a.borderFeatureIndices[u];let _=0;if(r.canonical.z!==a.canonical.z){for(const e of t)r.showCentroid(r.featuresOnBorder[e]);if(h)for(const e of y)a.showCentroid(a.featuresOnBorder[e]);r.borderDoneWithNeighborZ[e]=a.canonical.z,a.borderDoneWithNeighborZ[u]=r.canonical.z}for(const n of t){const t=r.featuresOnBorder[n],o=r.centroidData[t.centroidDataIndex],l=t.borders[e];let h;for(;_<y.length;){h=a.featuresOnBorder[y[_]];const e=h.borders[u];if(e[1]>l[0]+3||e[0]>l[0]-3)break;a.showCentroid(h),_++}if(h&&_<y.length){const n=_;let x=0;for(;!(h.borders[u][0]>l[1]-3)&&(x++,++_!==y.length);)h=a.featuresOnBorder[y[_]];if(h=a.featuresOnBorder[y[n]],x>1){const e=h.borders[u];Math.abs(l[0]-e[0])<3&&Math.abs(l[1]-e[1])<3&&(x=1,_=n+1)}else if(0===x){r.showCentroid(t);continue}const b=a.centroidData[h.centroidDataIndex];s&&1===x&&(((m=o).flags|(g=b).flags)&tb?(m.flags|=tb,g.flags|=tb):(m.flags&=2147483647,g.flags&=2147483647));let w=new v(0,0);if(x>1)_=n;else if(c&&c.dem&&!(t.intersectsCount()>1||h.intersectsCount()>1)){const t=d[e](o,b),n=e%2?ar-1:0;f=p(t[0],Math.min(ar-1,t[1]),n,c,i,e<2,t[2]),w=new v(Math.ceil(7*(f+450)),0)}o.centroidXY=b.centroidXY=w,r.writeCentroidToBuffer(o),a.writeCentroidToBuffer(b)}else r.showCentroid(t)}r.borderDoneWithNeighborZ[e]=a.canonical.z,a.borderDoneWithNeighborZ[u]=r.canonical.z}var f,m,g;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(e)}const $E=[1,0,0],qE=[0,1,0],XE=[0,0,1];function YE(e,t,n){const r=n.transform,i=n.shadowRenderer;if(!i)return!0;const o=e.toUnwrapped(),s=r.tileSize*i._cascades[n.currentShadowCascade].scale;let a=t.maxHeight;if(r.elevation){const t=r.elevation.getMinMaxForTile(e);t&&(a+=t.max)}const l=[...i.shadowDirection];l[2]=-l[2];const c=i.computeSimplifiedTileShadowVolume(o,a,s,l);if(!c)return!1;const u=[$E,qE,XE,l,[l[0],0,l[2]],[0,l[1],l[2]]],h="globe"===r.projection.name,d=r.scaleZoom(s),p=Wh.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,d,!h),f=i.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(c.vertices,c.planes,u)||0===f.intersectsPrecise(c.vertices,c.planes,u)}const KE=new cn(1,0,0,1),JE=new cn(0,1,0,1),QE=new cn(0,0,1,1),eT=new cn(1,0,1,1),tT=new cn(0,1,1,1);function nT(e,t,n){const r=e.context,i=e.transform,o=r.gl,s="globe"===i.projection.name,a=s?["PROJECTION_GLOBE_VIEW"]:[];let l=n.projMatrix;if(s&&Md(i.zoom)>0){const e=xd(cd(n.canonical,i));l=_h.multiply(new Float32Array(16),i.globeMatrix,e),_h.multiply(l,i.projMatrix,l)}const c=e.getOrCreateProgram("debug",{defines:a}),u=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(u,c);const h=y_.disabled,d=__.disabled,p=e.colorModeForRenderPass(),f="$debug";r.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?u._makeGlobeTileDebugBuffers(e.context,i):u._makeDebugTileBoundsBuffers(e.context,i.projection);const m=u._tileDebugBuffer||e.debugBuffer,g=u._tileDebugIndexBuffer||e.debugIndexBuffer,y=u._tileDebugSegments||e.debugSegments;c.draw(e,o.LINE_STRIP,h,d,p,M_.disabled,vE(l,cn.red),f,m,g,y,null,null,null,[u._globeTileDebugBorderBuffer]);const v=u.latestRawTileData,_=Math.floor((v&&v.byteLength||0)/1024),x=t.getTile(n).tileSize,b=512/Math.min(x,512)*(n.overscaledZ/i.zoom)*.5;let w=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(w+=` => ${n.overscaledZ}`),w+=` ${_}kb`,function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,w);const S=u._tileDebugTextBuffer||e.debugBuffer,M=u._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,E=u._tileDebugTextSegments||e.debugSegments;c.draw(e,o.TRIANGLES,h,d,b_.alphaBlended,M_.disabled,vE(l,cn.transparent,b),f,S,M,E,null,null,null,[u._globeTileDebugTextBuffer])}function rT(e,t,n,r){oT(e,0,t+n/2,e.transform.width,n,r)}function iT(e,t,n,r){oT(e,t-n/2,0,n,e.transform.height,r)}function oT(e,t,n,r,i,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*ut.devicePixelRatio,n*ut.devicePixelRatio,r*ut.devicePixelRatio,i*ut.devicePixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}const sT=ba([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:aT}=sT;function lT(e,t,n,r){e.emplaceBack(t,n,r)}class cT{constructor(e){this.vertexArray=new Ua,this.indices=new ja,lT(this.vertexArray,-1,-1,1),lT(this.vertexArray,1,-1,1),lT(this.vertexArray,-1,1,1),lT(this.vertexArray,1,1,1),lT(this.vertexArray,-1,-1,-1),lT(this.vertexArray,1,-1,-1),lT(this.vertexArray,-1,1,-1),lT(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,aT),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=dl.simpleSegment(0,0,36,12)}}function uT(e,t,n,r,i,o){const s=e.context.gl,a=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),c=t.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,n,r,i)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(yh.fromMat4(yh.create(),r),i,c,a,l);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),n.draw(e,s.TRIANGLES,y_.disabled,__.disabled,b_.unblended,M_.frontCW,u,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const hT=ba([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dT{constructor(e){const t=new Za;t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1);const n=new ja;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,hT.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=dl.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const pT=ba([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class fT{constructor(){this.colorModeAlphaBlendedWriteRGB=new b_([1,x_,1,x_],cn.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new b_([1,0,1,0],cn.transparent,[!1,!1,!1,!0])}update(e){const t=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new dT(t);const e=100,n=200,r=function(e){const t=Wi(30),n=[];for(let e=0;e<16e3;++e){const e=2*Math.PI*t(),r=Math.acos(1-2*t())-.5*Math.PI;n.push(Eh.fromValues(Math.cos(r)*Math.cos(e),Math.cos(r)*Math.sin(e),Math.sin(r)))}return n}(),i=Wi(300),o=new Wa,s=new ja;let a=0;for(let t=0;t<r.length;++t){const l=Eh.scale([],r[t],200),c=Math.max(0,1+.01*e*(1*i()-.5)),u=Math.max(0,1+.01*n*(1*i()-.5));o.emplaceBack(l[0],l[1],l[2],-1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,-1,c,u),o.emplaceBack(l[0],l[1],l[2],1,1,c,u),o.emplaceBack(l[0],l[1],l[2],-1,1,c,u),s.emplaceBack(a+0,a+1,a+2),s.emplaceBack(a+0,a+2,a+3),a+=4}this.starsVx=t.createVertexBuffer(o,pT.members),this.starsIdx=t.createIndexBuffer(s),this.starsSegments=dl.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,t){const n=e.context,r=n.gl,i=e.transform,o=new y_(r.LEQUAL,y_.ReadOnly,[0,1]),s=Md(i.zoom),a=t.properties.get("color").toArray01(),l=t.properties.get("high-color").toArray01(),c=t.properties.get("space-color").toArray01PremultipliedAlpha(),u=5e-4,h=P((t.properties.get("horizon-blend")-0)/1*.2495+u,5e-4,.25),d=Td(e,n,i)&&h===u?i.worldSize/(2*Math.PI*1.025)-1:i.globeRadius,p=e.frameCounter/1e3%1,f=Eh.length(i.globeCenterInViewSpace),m=Math.sqrt(Math.pow(f,2)-Math.pow(d,2)),g=Math.acos(m/f),y=t=>{const u="globe"===i.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&u.push("ALPHA_PASS");const d=e.getOrCreateProgram("globeAtmosphere",{defines:u}),f=((e,t,n,r,i,o,s,a,l,c,u,h)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:n,u_frustum_bl:r,u_horizon:i,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(i.frustumCorners.TL,i.frustumCorners.TR,i.frustumCorners.BR,i.frustumCorners.BL,i.frustumCorners.horizon,s,h,a,l,c,p,g);e.uploadCommonUniforms(n,d);const m=this.atmosphereBuffer;m&&d.draw(e,r.TRIANGLES,o,__.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,M_.backCW,f,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(e,t){const n=P(t.properties.get("star-intensity"),0,1);if(0===n)return;const r=e.context,i=r.gl,o=e.transform,s=e.getOrCreateProgram("stars"),a=bh.identity([]);bh.rotateX(a,a,-o._pitch),bh.rotateZ(a,a,-o.angle),bh.rotateX(a,a,w(o._center.lat)),bh.rotateY(a,a,-w(o._center.lng));const l=_h.fromQuat(new Float32Array(16),a),c=_h.multiply([],o.starsProjMatrix,l),u=yh.fromMat4([],l),h=yh.invert([],u),d=[0,1,0];Eh.transformMat3(d,d,h),Eh.scale(d,d,.15);const p=[1,0,0];Eh.transformMat3(p,p,h),Eh.scale(p,p,.15);const f=((e,t,n,r)=>({u_matrix:Float32Array.from(e),u_up:t,u_right:n,u_intensity_multiplier:r}))(c,d,p,n);e.uploadCommonUniforms(r,s),this.starsVx&&this.starsIdx&&s.draw(e,i.TRIANGLES,y_.disabled,__.disabled,this.colorModeAlphaBlendedWriteRGB,M_.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function mT(e,t){const n=[...e],r=t.cameraWorldSizeForFog/t.worldSize,i=_h.identity([]);return _h.scale(i,i,[r,r,1]),_h.multiply(n,i,n),_h.multiply(n,t.worldToFogMatrix,n),n}function gT(e,t,n,r){const i=n.material,o=r.context,{baseColorTexture:s,metallicRoughnessTexture:a}=i.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=i;function h(t,n,r){if(t&&(e.push(n),o.activeTexture.set(o.gl.TEXTURE0+r),t.gfxTexture)){const{minFilter:e,magFilter:n,wrapS:r,wrapT:i}=t.sampler;t.gfxTexture.bindExtraParam(e,n,r,i)}}h(s,"HAS_TEXTURE_u_baseColorTexture",PE.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",PE.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",PE.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",PE.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",PE.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),"OPAQUE"!==i.alphaMode&&"MASK"!==i.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),i.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function yT(e,t,n,r,i,o){const s=n.paint.get("model-opacity"),a=t.context,l=new y_(t.context.gl.LEQUAL,y_.ReadWrite,t.depthRangeFor3D),c=t.transform,u=e.mesh,h=u.material,d=h.pbrMetallicRoughness,p=t.style.fog;let f;f="pixels"===t.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:_h.multiply([],r.zScaleMatrix,e.nodeModelMatrix),_h.multiply(f,r.negCameraPosMatrix,f);const m=_h.invert([],f);_h.transpose(m,m);const g=RE(new Float32Array(e.worldViewProjection),new Float32Array(f),new Float32Array(m),t,s,d.baseColorFactor,h.emissiveFactor,d.metallicFactor,d.roughnessFactor,h,n),y={defines:[]},v=[];gT(y.defines,v,u,t);const _=t.shadowRenderer;_&&(_.useNormalOffset=!1);let x=null;if(p){const n=mT(e.nodeModelMatrix,t.transform);if(x=new Float32Array(n),"globe"!==c.projection.name){const e=u.aabb.min,t=u.aabb.max,[r,i]=p.getOpacityForBounds(n,e[0],e[1],t[0],t[1]);y.overrideFog=r>=sw||i>=sw}}const b=WM(t,n.paint.get("model-cutoff-fade-range"));b.shouldRenderCutoff&&y.defines.push("RENDER_CUTOFF");const w=t.getOrCreateProgram("model",y);t.uploadCommonUniforms(a,w,null,x,b),"shadow"!==t.renderPass&&_&&_.setupShadowsFromMatrix(e.nodeModelMatrix,w),w.draw(t,a.gl.TRIANGLES,l,i,o,u.material.doubleSided?M_.disabled:M_.backCCW,g,n.id,u.vertexBuffer,u.indexBuffer,u.segments,n.paint,t.transform.zoom,void 0,v)}function vT(e,t,n,r,i,o,s){let a;a="globe"===e.projection.name?vx(n,e):[...n],_h.multiply(a,a,t.matrix);const l=_h.multiply([],r,a);if(t.meshes)for(const e of t.meshes){if("BLEND"!==e.material.alphaMode){s.push({mesh:e,depth:0,modelIndex:i,worldViewProjection:l,nodeModelMatrix:a});continue}const t=Eh.transformMat4([],e.centroid,l);t[2]>0&&o.push({mesh:e,depth:t[2],modelIndex:i,worldViewProjection:l,nodeModelMatrix:a})}if(t.children)for(const a of t.children)vT(e,a,n,r,i,o,s)}function _T(e,t,n,r){const i=n.shadowRenderer;if(!i)return;const o=i.getShadowPassDepthMode(),s=i.getShadowPassColorMode(),a=i.calculateShadowPassMatrixFromMatrix(t),l=DE(a);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,__.disabled,s,M_.backCCW,l,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,n.transform.zoom,void 0,void 0)}function xT(e,t,n){const r=t.updateZoomBasedPaintProperties(),i=function(e,t,n){let r,i,o,s=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&s>0){const t=e.terrain,i=t.findDEMTileFor(n);i&&i.dem?r=Hm.create(t,n,i):s=0}if(0===s&&(t.terrainElevationMin=0,t.terrainElevationMax=0),s===t.validForExaggeration&&(0===s||r&&r._demTile&&r._demTile.tileID===t.validForDEMTile.id&&r._dem._timestamp===t.validForDEMTile.timestamp))return!1;for(const e in t.instancesPerModel){const n=t.instancesPerModel[e];for(let e=0;e<n.instancedDataArray.length;++e){const a=(r?s*r.getElevationAt(0|n.instancedDataArray.float32[16*e],0|n.instancedDataArray.float32[16*e+1],!0,!0):0)+n.instancesEvaluatedElevation[e];n.instancedDataArray.float32[16*e+6]=a,i=i?Math.min(t.terrainElevationMin,a):a,o=o?Math.max(t.terrainElevationMax,a):a}}return t.terrainElevationMin=i||0,t.terrainElevationMax=o||0,t.validForExaggeration=s,t.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(r||i)&&(t.uploaded=!1,t.upload(e.context))}const bT={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $h([0,0,0],[ar,ar,0])};function wT(e,t){const n=1<<e.canonical.z,r=t.getFreeCameraOptions().position,i=t.elevation,o=e.canonical.x/n,s=(e.canonical.x+1)/n,a=e.canonical.y/n,l=(e.canonical.y+1)/n;let c=t._centerAltitude;if(i){const t=i.getMinMaxForTile(e);t&&t.max>c&&(c=t.max)}const u=P(r.x,o,s)-r.x,h=P(r.y,a,l)-r.y,d=Zd(c,t.center.lat)-r.z;return t._zoomFromMercatorZ(Math.sqrt(u*u+h*h+d*d))}function ST(e,t,n,r,i,o,s){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new y_(a.gl.LEQUAL,y_.ReadWrite,e.depthRangeFor3D),h=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,y;r.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const v=WM(e,t.paint.get("model-cutoff-fade-range"));if(v.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),g=DE(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),y=c.getShadowPassColorMode();else{gT(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:h});const r=d.material,l=r.pbrMetallicRoughness,u=t.paint.get("model-opacity");g=RE(o.projMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,u,l.baseColorFactor,r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,t,i),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),y=v.shouldRenderCutoff||u<1||"OPAQUE"!==r.alphaMode?b_.alphaBlended:b_.unblended}e.uploadCommonUniforms(a,m,o.toUnwrapped(),null,v);const _=d.material.doubleSided?M_.disabled:M_.backCCW;if(r.instancedDataArray.length>20)f.push(r.instancedDataBuffer),m.draw(e,a.gl.TRIANGLES,u,__.disabled,y,_,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,r.instancedDataArray.length);else{const n=l?"u_instance":"u_normal_matrix";for(let i=0;i<r.instancedDataArray.length;++i)g[n]=new Float32Array(r.instancedDataArray.arrayBuffer,64*i,16),m.draw(e,a.gl.TRIANGLES,u,__.disabled,y,_,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(n.children)for(const a of n.children)ST(e,t,a,r,i,o,s)}const MT=[1,-1,1];function ET(e,t,n,r){if(!n.modelManager)return!0;const i=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,s=t.aabb;let a=!0,l=e.maxHeight;if(0===l){let t=0;for(const n in e.instancesPerModel){const e=i.getModel(n,r);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):a=!1}l=e.maxScale*t*1.41+e.maxVerticalOffset,a&&(e.maxHeight=l)}s.max[2]=l,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,Eh.transformMat4(s.min,s.min,t.tileMatrix),Eh.transformMat4(s.max,s.max,t.tileMatrix);const c=s.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===c),0===c}class TT{}class CT{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,t,n){{const n=this._storage.get(t.id);if(n)return n.lastUsedFrameIdx=e,n.buf}const r=n.gl,i=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),o=new ArrayBuffer(i),s=new Int16Array(o);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const a=new Na;for(let e=0;e<i/2;e+=3){const t=s[e],n=s[e+1],r=s[e+2];a.emplaceBack(t,n),a.emplaceBack(n,r),a.emplaceBack(r,t)}const l=n.bindVertexArrayOES.current,c=new TT;return c.buf=new Pv(n,a),c.lastUsedFrameIdx=e,this._storage.set(t.id,c),n.bindVertexArrayOES.set(l),c.buf}update(e){for(const[t,n]of this._storage)e-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const AT={symbol:function(e,t,n,r,i){if("translucent"!==e.renderPass)return;const o=__.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,t,n,r,i,o,s){const a=t.transform,l="map"===i,c="map"===o;for(const t of e){const e=r.getTile(t),i=e.getBucket(n);if(!i||!i.text||!i.text.segments.get().length)continue;const o=ag(i.textSizeData,a.zoom),u=GS(t,i.getProjection(),a),h=a.calculatePixelsToTileUnitsMatrix(e),d=J_(u,e.tileID.canonical,c,l,a,i.getProjection(),h),p=i.hasIconTextFit()&&i.hasIconData();if(o){const n=Math.pow(2,a.zoom-e.tileID.overscaledZ);BE(i,l,c,s,lg,a,d,t,n,o,p)}}}(r,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),i),0!==n.paint.get("icon-opacity").constantOr(1)&&jE(e,t,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,s),0!==n.paint.get("text-opacity").constantOr(1)&&jE(e,t,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,s),t.map.showCollisionBoxes&&(kE(e,t,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),kE(e,t,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,r){if("translucent"!==e.renderPass)return;const i=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),a=void 0!==n.layout.get("circle-sort-key").constantOr(1),l=n.paint.get("circle-emissive-strength");if(0===i.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const c=e.context,u=c.gl,h=e.transform,d=e.depthModeForSublayer(0,y_.ReadOnly),p=__.disabled,f=e.colorModeForDrapableLayerRenderPass(l),m="globe"===h.projection.name,g=[Gd(h.center.lng),Hd(h.center.lat)],y=[];for(let i=0;i<r.length;i++){const o=r[i],s=t.getTile(o),l=s.getBucket(n);if(!l||l.projection.name!==h.projection.name)continue;const c=l.programConfigurations.get(n.id),u=Np(n),d=e.isTileAffectedByFog(o);m&&u.push("PROJECTION_GLOBE_VIEW");const p=e.getOrCreateProgram("circle",{config:c,defines:u,overrideFog:d}),f=l.layoutVertexBuffer,v=l.globeExtVertexBuffer,_=l.indexBuffer,x=h.projection.createInversionMatrix(h,o.canonical),b={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:v,indexBuffer:_,uniformValues:Op(e,o,s,x,g,n),tile:s};if(a){const e=l.segments.get();for(const t of e)y.push({segments:new dl([t]),sortKey:t.sortKey,state:b})}else y.push({segments:l.segments,sortKey:0,state:b})}a&&y.sort(((e,t)=>e.sortKey-t.sortKey));const v={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const t of y){const{programConfiguration:r,program:i,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:m}=t.state,g=t.segments;e.terrain&&e.terrain.setupElevationDraw(m,i,v),e.uploadCommonUniforms(c,i,m.tileID.toUnwrapped()),i.draw(e,u.TRIANGLES,d,p,f,M_.disabled,l,n.id,o,a,g,n.paint,h.zoom,r,[s])}},heatmap:function(e,t,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const i=e.context,o=i.gl,s=__.disabled,a=new b_([o.ONE,o.ONE,o.ONE,o.ONE],cn.transparent,[!0,!0,!0,!0]);!function(e,t,n,r){const i=e.gl,o=t.width*r,s=t.height*r;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,o,s]);let a=n.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),a=n.heatmapFbo=e.createFramebuffer(o,s,!0,null),function(e,t,n,r,i,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,i,o,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(e,0,t,a,o,s)}else i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(i,e,n,"globe"===e.transform.projection.name?.5:.25),i.clear({color:cn.transparent});const l=e.transform,c="globe"===l.projection.name,u=c?["PROJECTION_GLOBE_VIEW"]:[],h=c?M_.frontCCW:M_.disabled,d=[Gd(l.center.lng),Hd(l.center.lat)];for(let p=0;p<r.length;p++){const f=r[p];if(t.hasRenderableParent(f))continue;const m=t.getTile(f),g=m.getBucket(n);if(!g||g.projection.name!==l.projection.name)continue;const y=e.isTileAffectedByFog(f),v=g.programConfigurations.get(n.id),_=e.getOrCreateProgram("heatmap",{config:v,defines:u,overrideFog:y}),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,_),e.uploadCommonUniforms(i,_,f.toUnwrapped());const b=l.projection.createInversionMatrix(l,f.canonical);_.draw(e,o.TRIANGLES,y_.disabled,s,a,h,xE(e,f,m,b,d,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,e.transform.zoom,v,c?[g.globeExtVertexBuffer]:null)}i.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,t){const n=e.context,r=n.gl,i=t.heatmapFbo;if(!i)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let o=t.colorRampTexture;o||(o=t.colorRampTexture=new yv(n,t.colorRamp,r.RGBA)),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,r.TRIANGLES,y_.disabled,__.disabled,e.colorModeForRenderPass(),M_.disabled,((e,t,n,r)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,t),t.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,t.paint,e.transform.zoom)}(e,n))},line:function(e,t,n,r){if("translucent"!==e.renderPass)return;const i=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===i.constantOr(1)||0===o.constantOr(1))return;const s=n.paint.get("line-emissive-strength"),a=e.depthModeForSublayer(0,y_.ReadOnly),l=e.colorModeForDrapableLayerRenderPass(s),c=e.terrain&&e.terrain.renderingToTexture?1:ut.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-pattern").constantOr(1),g=1!==n.paint.get("line-opacity").constantOr(1);let y=!m&&g;const v=n.paint.get("line-gradient"),_=f?"linePattern":"line",x=e.context,b=x.gl,w=Nb(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const i of r){const r=t.getTile(i);if(f&&!r.patternsLoaded())continue;const o=r.getBucket(n);if(!o)continue;e.prepareDrawTile();const s=o.programConfigurations.get(n.id),m=e.isTileAffectedByFog(i),g=e.getOrCreateProgram(_,{config:s,defines:w,overrideFog:m}),S=p.constantOr(null);if(S&&r.imageAtlas){const e=r.imageAtlas.patternPositions[S.toString()];e&&s.setConstantPatternPositions(e)}const M=u.constantOr(null),E=d.constantOr(null);if(!f&&M&&E&&r.lineAtlas){const e=r.lineAtlas.getDash(M,E);e&&s.setConstantPatternPositions(e)}let[T,C]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;T!==C&&(0===T&&(T-=e),1===C&&(C+=e))}const A=e.terrain?i.projMatrix:null,I=f?Lb(e,r,n,A,c):Rb(e,r,n,A,o.lineClipsArray.length,c,[T,C]);if(v){const r=o.gradients[n.id];let s=r.texture;if(n.gradientVersion!==r.version){let a=256;if(n.stepInterpolant){const n=t.getSource().maxzoom,r=i.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-i.canonical.z):1;a=P(U(o.maxLineLength/ar*1024*r),256,x.maxTextureSize)}r.gradient=Yp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:r.gradient||void 0,clips:o.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new yv(x,r.gradient,b.RGBA),r.version=n.gradientVersion,s=r.texture}x.activeTexture.set(b.TEXTURE1),s.bind(n.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}h&&(x.activeTexture.set(b.TEXTURE0),r.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),s.updatePaintBuffers()),f&&(x.activeTexture.set(b.TEXTURE0),r.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),s.updatePaintBuffers()),e.uploadCommonUniforms(x,g,i.toUnwrapped());const R=t=>{g.draw(e,b.TRIANGLES,a,t,l,M_.disabled,I,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,n.paint,e.transform.zoom,s,[o.layoutVertexBuffer2])};if(y){const t=e.stencilModeForClipping(i).ref;0===t&&e.terrain&&x.clear({stencil:0});const n={func:b.EQUAL,mask:255};I.u_alpha_discard_threshold=.8,R(new __(n,t,255,b.KEEP,b.KEEP,b.INVERT)),I.u_alpha_discard_threshold=0,R(new __(n,t,255,b.KEEP,b.KEEP,b.KEEP))}else R(e.stencilModeForClipping(i))}y&&(e.resetStencilClippingMasks(),e.terrain&&x.clear({stencil:0}))},fill:function(e,t,n,r){const i=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=n.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(s),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===i.constantOr(cn.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const i=e.depthModeForSublayer(1,"opaque"===e.renderPass?y_.ReadWrite:y_.ReadOnly);GE(e,t,n,r,i,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const i=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,y_.ReadOnly);GE(e,t,n,r,i,a,!0)}},"fill-extrusion":function(e,t,n,r){const i=n.paint.get("fill-extrusion-opacity"),o=e.context,s=o.gl,a=e.terrain,l=a&&a.renderingToTexture,c=n.paint.get("fill-extrusion-cutoff-fade-range");if(0===i)return;const u=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(u&&function(e,t,n,r){for(const i of r){const r=t.getTile(i).getBucket(n);r&&(r.updateReplacement(i,e.replacementSource),r.uploadCentroid(e.context))}}(e,t,n,r),a||u)for(const i of r){const r=t.getTile(i).getBucket(n);r&&WE(e.context,t,i,r,n,a,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const o=e.shadowRenderer;if(a&&i<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof bo)return;const s=o.getShadowPassDepthMode(),l=o.getShadowPassColorMode();HE(e,t,n,r,s,__.disabled,l,u)}else if("translucent"===e.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!l){const o=new y_(e.context.gl.LEQUAL,y_.ReadWrite,e.depthRangeFor3D);0===c&&1===i&&h?HE(e,t,n,r,o,__.disabled,b_.unblended,u):(HE(e,t,n,r,o,__.disabled,b_.disabled,u),HE(e,t,n,r,o,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!a&&"globe"!==e.transform.projection.name||l)){const i=n.paint.get("fill-extrusion-opacity"),c=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=n.paint.get("fill-extrusion-flood-light-intensity"),p=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),f=c>0&&h>0,m=d>0,g=(e,t,n)=>(1-n)*e+n*t,y=o=>{const a=e.depthModeForSublayer(1,y_.ReadOnly,s.LEQUAL,!0),l=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),f=g(.1,3,l),m=e._showOverdrawInspector;if(!m){const l=new __({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new b_([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0],s.MIN);ZE(e,t,n,r,a,l,m,M_.disabled,o,"sdf",i,c,h,d,p,f,u,!1)}{const l=m?__.disabled:new __({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=m?e.colorModeForRenderPass():new b_([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],cn.transparent,[!0,!0,!0,!0]);ZE(e,t,n,r,a,l,g,M_.disabled,o,"color",i,c,h,d,p,f,u,!1)}};if(l){const l=(o,a,l)=>{const f=e.depthModeForSublayer(1,y_.ReadOnly,s.LEQUAL,!1),m=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=g(.1,3,m);{const l=new b_([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0]);ZE(e,t,n,r,f,__.disabled,l,M_.disabled,o,"clear",i,c,h,d,p,y,u,a)}{const l=new __({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),m=new b_([s.ONE,s.ONE,s.ONE,s.ONE],cn.transparent,[!1,!1,!1,!0],s.MIN);ZE(e,t,n,r,f,l,m,M_.disabled,o,"sdf",i,c,h,d,p,y,u,a)}{const l=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,m=new __({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=new b_([l,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],cn.transparent,[!0,!0,!0,!0]);ZE(e,t,n,r,f,m,g,M_.disabled,o,"color",i,c,h,d,p,y,u,a)}{const m=new b_([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],cn.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);ZE(e,t,n,r,f,__.disabled,m,M_.disabled,o,"clear",i,c,h,d,p,y,u,a,l)}};if(f||m){let t;if(e.prepareDrawTile(),a){const e=a.drapeBufferSize[0],n=a.drapeBufferSize[1];t=a.framebufferCopyTexture,t&&(!t||t.size[0]===e&&t.size[1]===n)||(t&&t.destroy(),t=a.framebufferCopyTexture=new yv(o,new Wp({width:e,height:n}),s.RGBA)),t.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,e,n,0)}f&&l(!0,!1,t),m&&l(!1,!0,t)}}else f&&y(!0),m&&y(!1)}}},hillshade:function(e,t,n,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const i=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]="translucent"!==e.renderPass||o?[{},r]:e.stencilConfigForOverlap(r);for(const r of a){const i=t.getTile(r);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)VM(e,i,n);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,y_.ReadOnly),a=n.paint.get("hillshade-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(r):s[r.overscaledZ];UM(e,r,i,n,t,c,l)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,r,i,o){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const s=e.context,a=s.gl,l=t.getSource(),c=function(e,t,n){const r=[];let i,o;if(e.paint.get("raster-color")){r.push("RASTER_COLOR"),i=e.paint.get("raster-color-mix"),o=e.paint.get("raster-color-range"),t.activeTexture.set(n.TEXTURE2);let s=e.colorRampTexture;s||(s=e.colorRampTexture=new yv(t,e.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:i,range:o,defines:r}}(n,s,a),u=c.defines;let h=!1;if(l instanceof Hb&&!r.length){if("globe"!==e.transform.projection.name)return;if(l.onNorthPole)h=!0,u.push("PROJECTION_GLOBE_VIEW");else{if(!l.onSouthPole)return;h=!0,u.push("PROJECTION_GLOBE_VIEW")}}const d=e.colorModeForDrapableLayerRenderPass(),p=e.terrain&&e.terrain.renderingToTexture,f=!e.options.moving,m="nearest"===n.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;if(h){const r=t.getSource();if(!(r instanceof Hb))return;const i=r.texture;if(!i)return;const o=e.globeSharedBuffers;if(!o)return;const l=new y_(a.LEQUAL,y_.ReadWrite,e.depthRangeFor3D),u=Float32Array.from(e.transform.projMatrix);let h=Ed(0,0,e.transform);const p=Float32Array.from(_d(ad(new Nh(0,0,0)))),f={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),i.bind(m,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),i.bind(m,a.CLAMP_TO_EDGE),i.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[g,y,v,_]=o.getPoleBuffers(0,!0);let x;r.onNorthPole?(x=g,e.renderDefaultNorthPole=!1):(h=_h.scale(_h.create(),h,[1,-1,1]),x=y,e.renderDefaultSouthPole=!1);const b=bE(u,p,h,[0,0],1,f,n,r.perspectiveTransform||[0,0],2,c.mix||[0,0,0,0],c.range||[0,0]),w=e.getOrCreateProgram("raster",{defines:c.defines});return e.uploadCommonUniforms(s,w,null),void w.draw(e,a.TRIANGLES,l,__.disabled,d,M_.disabled,b,n.id,x,v,_)}if(!r.length)return;const[g,y]=l instanceof Hb||p?[{},r]:e.stencilConfigForOverlap(r),v=y[y.length-1].overscaledZ;for(const r of y){const i=p?y_.disabled:e.depthModeForSublayer(r.overscaledZ-v,1===n.paint.get("raster-opacity")?y_.ReadWrite:y_.ReadOnly,a.LESS),u=r.toUnwrapped(),h=t.getTile(r);if(p&&(!h||!h.hasData()))continue;if(!h.texture)continue;const y=p?r.projMatrix:e.transform.calculateProjMatrix(u,f),_=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(r):g[r.overscaledZ],x=o?0:n.paint.get("raster-fade-duration");h.registerFadeDuration(x);const b=t.findLoadedParent(r,0),w=QM(h,b,t,e.transform,x);let S,M;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),h.texture.bind(m,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),b?(b.texture.bind(m,a.CLAMP_TO_EDGE),S=Math.pow(2,b.tileID.overscaledZ-h.tileID.overscaledZ),M=[h.tileID.canonical.x*S%1,h.tileID.canonical.y*S%1]):h.texture.bind(m,a.CLAMP_TO_EDGE),h.texture.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const E=l instanceof Hb?l.perspectiveTransform:[0,0],T=new Float32Array(16),C=bE(y,T,T,M||[0,0],S||1,w,n,E,2,c.mix||[0,0,0,0],c.range||[0,0]),A=e.isTileAffectedByFog(r),I=e.getOrCreateProgram("raster",{defines:c.defines,overrideFog:A});if(e.uploadCommonUniforms(s,I,u),l instanceof Hb)l.boundsBuffer&&l.boundsSegments&&I.draw(e,a.TRIANGLES,i,__.disabled,d,M_.disabled,C,n.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:r,tileBoundsSegments:o}=e.getTileBoundsBuffers(h);I.draw(e,a.TRIANGLES,i,_,d,M_.disabled,C,n.id,t,r,o)}}e.resetStencilClippingMasks()},background:function(e,t,n,r){const i=n.paint.get("background-color"),o=n.paint.get("background-opacity"),s=n.paint.get("background-emissive-strength");if(0===o)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h,n.scope))return;const d=!h&&1===i.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=__.disabled,f=e.depthModeForSublayer(0,"opaque"===d?y_.ReadWrite:y_.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(s),g=h?"backgroundPattern":"background";let y,v=r;v||(y=e.getBackgroundTiles(),v=Object.values(y).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const d of v){const v=e.isTileAffectedByFog(d),_=e.getOrCreateProgram(g,{overrideFog:v}),x=d.toUnwrapped(),b=r?d.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const w=t?t.getTile(d):y?y[d.key]:new Av(d,u,c.zoom,e),S=h?IE(b,s,o,e,h,n.scope,{tileID:d,tileSize:u}):AE(b,s,o,i);e.uploadCommonUniforms(a,_,x);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:E,tileBoundsSegments:T}=e.getTileBoundsBuffers(w);_.draw(e,l.TRIANGLES,f,p,m,M_.disabled,S,n.id,M,E,T)}},sky:function(e,t,n){const r=e._atmosphere?Md(e.transform.zoom):1,i=n.paint.get("sky-opacity")*r;if(0===i)return;const o=e.context,s=n.paint.get("sky-type"),a=new y_(o.gl.LEQUAL,y_.ReadOnly,[0,1]),l=e.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,t,n,r){const i=e.context,o=i.gl;let s=t.skyboxFbo;if(!s){s=t.skyboxFbo=i.createFramebuffer(32,32,!0,null),t.skyboxGeometry=new cT(i),t.skyboxTexture=i.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}i.bindFramebuffer.set(s.framebuffer),i.viewport.set([0,0,32,32]);const a=t.getCenter(e,!0),l=e.getOrCreateProgram("skyboxCapture"),c=new Float64Array(16);_h.identity(c),_h.rotateY(c,c,.5*-Math.PI),uT(e,t,l,c,a,0),_h.identity(c),_h.rotateY(c,c,.5*Math.PI),uT(e,t,l,c,a,1),_h.identity(c),_h.rotateX(c,c,.5*-Math.PI),uT(e,t,l,c,a,2),_h.identity(c),_h.rotateX(c,c,.5*Math.PI),uT(e,t,l,c,a,3),_h.identity(c),uT(e,t,l,c,a,4),_h.identity(c),_h.rotateY(c,c,Math.PI),uT(e,t,l,c,a,5),i.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,t,n,r,i){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,n,r,i)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:i}))(a.skyboxMatrix,t.getCenter(e,!1),0,r,i);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,__.disabled,e.colorModeForRenderPass(),M_.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,i,l):"gradient"===s&&"sky"===e.renderPass&&function(e,t,n,r,i){const o=e.context,s=o.gl,a=e.transform,l=e.getOrCreateProgram("skyboxGradient");t.skyboxGeometry||(t.skyboxGeometry=new cT(o)),o.activeTexture.set(s.TEXTURE0);let c=t.colorRampTexture;c||(c=t.colorRampTexture=new yv(o,t.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((e,t,n,r,i)=>({u_matrix:e,u_color_ramp:0,u_center_direction:t,u_radius:w(n),u_opacity:r,u_temporal_offset:i}))(a.skyboxMatrix,t.getCenter(e,!1),t.paint.get("sky-gradient-radius"),r,i);e.uploadCommonUniforms(o,l),l.draw(e,s.TRIANGLES,n,__.disabled,e.colorModeForRenderPass(),M_.backCW,u,"skyboxGradient",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(e,n,a,i,l)},debug:function(e,t,n){for(let r=0;r<n.length;r++)nT(e,t,n[r])},custom:function(e,t,n,r){const i=e.context,o=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isLayerDraped(t)){if("offscreen"===e.renderPass){const t=o.prerender;if(t){if(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;t.call(o,i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Md(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else t.call(o,i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const t=o.renderToTile;if(t){const n=r[0].canonical,s=new ep(n.x+r[0].wrap*(1<<n.z),n.y,n.z);i.setDepthMode(y_.disabled),i.setStencilMode(__.disabled),i.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(o,i.gl,s),i.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(__.disabled);const t="3d"===o.renderingMode?new y_(e.context.gl.LEQUAL,y_.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,y_.ReadOnly);if(i.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;o.render(i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Md(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else o.render(i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}else q("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,r){if("opaque"===e.renderPass)return;const i=n.paint.get("model-opacity");if(0===i)return;const o=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!o)return;if(e.terrain&&i<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof bo)return}const s=e.shadowRenderer,a=n.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,a||(s.enabled=!1));const l=()=>{s&&(s.useNormalOffset=!0,a||(s.enabled=!0))},c=t.getSource();if("light-beam"===e.renderPass&&"batched-model"!==c.type)return;if("vector"===c.type||"geojson"===c.type)return function(e,t,n,r){const i=e.transform;if("mercator"!==i.projection.name)return void q(`Drawing 3D models for ${i.projection.name} projection is not yet implemented`);const o=i.getFreeCameraOptions().position;if(!e.modelManager)return;const s=e.modelManager,a=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const l=n._unevaluatedLayout._values["model-id"],c={...n.layout.get("model-id").parameters};for(const u of r){const r=t.getTile(u).getBucket(n);if(!r||r.projection.name!==i.projection.name)continue;const h=wT(u,i);c.zoom=h;const d=l.possiblyEvaluate(c);if(xT(e,r,u),bT.shadowUniformsInitialized=!1,bT.useSingleShadowCascade=!!a&&0===a.getMaxCascadeForTile(u.toUnwrapped()),"shadow"===e.renderPass&&a){if(1===e.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const t=i.calculatePosMatrix(u.toUnwrapped(),i.worldSize);if(bT.tileMatrix.set(t),bT.shadowTileMatrix=Float32Array.from(a.calculateShadowPassMatrixFromMatrix(t)),bT.aabb.min.fill(0),bT.aabb.max[0]=bT.aabb.max[1]=ar,bT.aabb.max[2]=0,ET(r,bT,e,n.scope))continue}const p=1<<u.canonical.z,f=[((o.x-u.wrap)*p-u.canonical.x)*ar,(o.y*p-u.canonical.y)*ar,o.z*p*ar];for(let t in r.instancesPerModel){const i=r.instancesPerModel[t];i.features.length>0&&(t=d.evaluate(i.features[0].feature,{}));const o=s.getModel(t,n.scope);if(o&&o.uploaded)for(const t of o.nodes)ST(e,n,t,i,f,u,bT)}}}(e,t,n,r),void l();if(!c.loaded())return;if("batched-model"===c.type)return function(e,t,n,r){const i=e.context,o=e.transform,s=e.style.fog,a=e.shadowRenderer;if("mercator"!==o.projection.name)return void q(`Drawing 3D landmark models for ${o.projection.name} projection is not yet implemented`);const l=e.transform.getFreeCameraOptions().position,c=Eh.scale([],[l.x,l.y,l.z],e.transform.worldSize);Eh.negate(c,c);const u=_h.identity([]),h=Kd(o.center.lat,o.zoom),d=_h.fromScaling([],[1,1,1/h]);_h.translate(u,u,c);const p=n.paint.get("model-opacity"),f=new y_(i.gl.LEQUAL,y_.ReadWrite,e.depthRangeFor3D),m=new y_(i.gl.LEQUAL,y_.ReadOnly,e.depthRangeFor3D),g=function(l,c){for(const h of r){const r=t.getTile(h).getBucket(n);if(!r||!r.uploaded)continue;let g=!1;a&&(g=0===a.getMaxCascadeForTile(h.toUnwrapped()));const y=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize),v=r.modelTraits;for(const t of r.getNodesInfo()){if(t.hiddenByReplacement)continue;if(!t.node.meshes)continue;const r=t.node,_="light-beam"===e.renderPass,x=[...y],b=t.evaluatedScale;let w=0;e.terrain&&r.elevation&&(w=r.elevation*e.terrain.exaggeration()),_h.translate(x,x,[(r.anchor?r.anchor[0]:0)*(b[0]-1),(r.anchor?r.anchor[1]:0)*(b[1]-1),w]),b!==xx&&_h.scale(x,x,b),_h.multiply(x,x,r.matrix);const S=_h.multiply([],d,x);_h.multiply(S,u,S);const M=_h.invert([],S);_h.transpose(M,M),_h.scale(M,M,MT);const E=_h.multiply([],o.projMatrix,x);for(let u=0;u<r.meshes.length;++u){const d=r.meshes[u],y=u===r.lightMeshIndex;if(y){if(!_&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(_)continue;const b={defines:[]},w=[];gT(b.defines,w,d,e),4&v||b.defines.push("DIFFUSE_SHADED"),g&&b.defines.push("SHADOWS_SINGLE_CASCADE");const T="shadow"===e.renderPass;if(T){_T(d,x,e,n);continue}let C=null;if(s){const t=mT(x,e.transform);if(C=new Float32Array(t),"globe"!==o.projection.name){const e=d.aabb.min,n=d.aabb.max,[r,i]=s.getOpacityForBounds(t,e[0],e[1],n[0],n[1]);b.overrideFog=r>=sw||i>=sw}}const A=e.getOrCreateProgram("model",b);!T&&a&&(a.useNormalOffset=!!d.normalBuffer,a.setupShadowsFromMatrix(x,A,a.useNormalOffset)),e.uploadCommonUniforms(i,A,h.toUnwrapped(),C);const I=d.material,P=I.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;const R=RE(new Float32Array(E),new Float32Array(S),new Float32Array(M),e,p,P.baseColorFactor,I.emissiveFactor,P.metallicFactor,P.roughnessFactor,I,n);A.draw(e,i.gl.TRIANGLES,c&&!y?f:m,__.disabled,l?y||p<1||t.hasTranslucentParts?b_.alphaBlended:b_.unblended:b_.disabled,M_.backCCW,R,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,w)}}}};(function(e,t,n,r){const i=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const s of r){const r=t.getTile(s).getBucket(n);r&&(e.conflationActive&&r.updateReplacement(s,e.replacementSource),r.evaluateScale(e,n),e.terrain&&i>0&&r.elevationUpdate(e.terrain,i,s,n.source),r.needsReEvaluation(e,o,n)&&r.evaluate(n))}})(e,t,n,r),1===p?g(!0,!0):(g(!1,!0),g(!0,!1))}(e,t,n,r),void l();const u=c.getModels(),h=[],d=e.transform.getFreeCameraOptions().position,p=Eh.scale([],[d.x,d.y,d.z],e.transform.worldSize);Eh.negate(p,p);const f=[],m=[];let g=0;for(const t of u){const r=n.paint.get("model-rotation").constantOr(null),i=n.paint.get("model-scale").constantOr(null),o=n.paint.get("model-translation").constantOr(null);t.computeModelMatrix(e,r,i,o,!0,!0,!1);const s=_h.identity([]),a=Kd(t.position.lat,e.transform.zoom),l=_h.fromScaling([],[1,1,1/a]);_h.translate(s,s,p),h.push({zScaleMatrix:l,negCameraPosMatrix:s});for(const n of t.nodes)vT(e.transform,n,t.matrix,e.transform.projMatrix,g,f,m);g++}if(f.sort(((e,t)=>t.depth-e.depth)),"shadow"!==e.renderPass){if(1===i)for(const t of m)yT(t,e,n,h[t.modelIndex],__.disabled,e.colorModeForRenderPass());else{for(const t of m)yT(t,e,n,h[t.modelIndex],__.disabled,b_.disabled);for(const t of m)yT(t,e,n,h[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of f)yT(t,e,n,h[t.modelIndex],__.disabled,e.colorModeForRenderPass());l()}else{for(const t of m)_T(t.mesh,t.nodeModelMatrix,e,n);for(const t of f)_T(t.mesh,t.nodeModelMatrix,e,n);l()}}},IT={modelUpload:function(e,t,n){const r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(e.modelManager&&e.modelManager.upload(e,n));if("batched-model"===r.type)return;const i=r.getModels();for(const t of i)t.upload(e.context)}};class PT{constructor(e,t){this.context=new E_(e),this.transform=t,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=T_.maxUnderzooming+T_.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new jx,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new OT(this),this._wireframeDebugCache=new CT,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rE(this,e));const r=this._terrain;this.transform.elevation=n?r:null,r.update(e,this.transform,t),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,r]=t.getFovAdjustedRange(this.transform._fov);if(n>r)return void(this.transform.fogCullDistSq=null);const i=n+.78*(r-n);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,t){if(this.width=e*ut.devicePixelRatio,this.height=t*ut.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const e=this.context,n=new Sa;n.emplaceBack(0,0),n.emplaceBack(ar,0),n.emplaceBack(0,ar),n.emplaceBack(ar,ar),this.tileExtentBuffer=e.createVertexBuffer(n,Lh.members),this.tileExtentSegments=dl.simpleSegment(0,0,4,2);const r=new Sa;r.emplaceBack(0,0),r.emplaceBack(ar,0),r.emplaceBack(0,ar),r.emplaceBack(ar,ar),this.debugBuffer=e.createVertexBuffer(r,Lh.members),this.debugSegments=dl.simpleSegment(0,0,4,5);const i=new Sa;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(i,Lh.members),this.viewportSegments=dl.simpleSegment(0,0,4,2);const o=new Ea;o.emplaceBack(0,0,0,0),o.emplaceBack(ar,0,ar,0),o.emplaceBack(0,ar,0,ar),o.emplaceBack(ar,ar,ar,ar),this.mercatorBoundsBuffer=e.createVertexBuffer(o,Tv.members),this.mercatorBoundsSegments=dl.simpleSegment(0,0,4,2);const s=new ja;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new qa;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new yv(e,new Wp({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=_h.create();const l=this.context.gl;this.stencilClearMode=new __({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,y_.disabled,this.stencilClearMode,b_.disabled,M_.disabled,JM(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,n){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const r=this.context,i=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(b_.disabled),r.setDepthMode(y_.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of n){const n=t.getTile(e),r=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(n);o.draw(this,i.TRIANGLES,y_.disabled,new __({func:i.ALWAYS,mask:0},r,255,i.KEEP,i.KEEP,i.REPLACE),b_.disabled,M_.disabled,JM(e.projMatrix),"$clipping",s,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new __({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new __({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=n[n.length-1].overscaledZ,i=n[0].overscaledZ-r+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let n=0;n<i;n++)e[n+r]=new __({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,n]}return[{[r]:__.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const t=1/8;return new b_([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new cn(t,t,t,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?b_.unblended:b_.alphaBlended}colorModeForDrapableLayerRenderPass(e){const t=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new b_([t.ONE,t.ONE_MINUS_SRC_ALPHA,t.CONSTANT_ALPHA,t.ONE_MINUS_SRC_ALPHA],new cn(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,n,r=!1){if(!this.opaquePassEnabledForLayer()&&!r)return y_.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new y_(n||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;const r=this.style._mergedLayers,i=this.style.order,o=i.map((e=>r[e])),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(ut.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const e in s){const t=s[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++a)}const c={},u={},h={},d={},p={};for(const e in s){const t=s[e];c[e]=t.getVisibleCoordinates(),u[e]=c[e].slice().reverse(),h[e]=t.getVisibleCoordinates(!0).reverse(),d[e]=t.getShadowCasterCoordinates(),p[e]=t.sortCoordinatesByDistance(c[e])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(a){const e=[];for(const t of o)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const n of e){const e=this.style.getLayerSourceCache(n);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:n.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of o){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=f(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(o[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in s)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new Nd(this.context));for(const t of o){if(t.isHidden(this.transform.zoom))continue;const n=e.getLayerSourceCache(t);this.uploadLayer(this,t,n)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fT),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ye.has(this.context.gl))return;this.renderPass="offscreen";for(const t of o){const n=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const r=n?u[n.id]:void 0;("custom"===t.type||"raster"===t.type||t.isSky()||r&&r.length)&&this.renderLayer(this,n,t,r)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const y=this.terrain;y&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&y.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const v="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),_=(()=>{if(n.showOverdrawInspector)return cn.black;if(this.style.fog&&this.transform.projection.supportsFog&&!v){const e=this.style.fog.properties.get("color").toArray01();return new cn(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&v){const e=this.style.fog.properties.get("space-color").toArray01();return new cn(...e)}return cn.transparent})();if(this.context.clear({color:_,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&v&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky())continue;const r=n?(t.is3D()?p:u)[n.id]:void 0;this._renderTileClippingMasks(t,n,r),this.renderLayer(this,n,t,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&v&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Md(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(g&&(x=g.getShadowCastingLayerCount());this.currentLayer<i.length;){const t=o[this.currentLayer],n=e.getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(y&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=y.renderBatch(this.currentLayer);continue}let r;if(n&&(r=("symbol"===t.type?h:t.is3D()?p:u)[n.id]),this._renderTileClippingMasks(t,n,n?c[n.id]:void 0),this.renderLayer(this,n,t,r),!y&&g&&x>0&&t.hasShadowPass()&&0==--x&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=o[this.currentLayer];if(!t.hasLightBeamPass())continue;const n=e.getLayerSourceCache(t);this.renderLayer(this,n,t,n?u[n.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let t=null;o.forEach((n=>{const r=e.getLayerSourceCache(n);r&&!n.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!t||t.getSource().maxzoom<r.getSource().maxzoom)&&(t=r)})),t&&this.options.showTileBoundaries&&AT.debug(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;rT(e,e.transform.height-(t.top||0),3,KE),rT(e,t.bottom||0,3,JE),iT(e,t.left||0,3,QE),iT(e,e.transform.width-(t.right||0),3,eT);const n=e.transform.centerPoint;!function(e,t,n,r){oT(e,t-1,n-10,2,20,r),oT(e,t-10,n-1,20,2,r)}(e,n.x,e.transform.height-n.y,tT)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}uploadLayer(e,t,n){this.gpuTimingStart(t),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(t.type)||e.terrain&&"custom"===t.type)&&IT[`${t.type}Upload`]&&IT[`${t.type}Upload`](e,n,t.scope),this.gpuTimingEnd()}renderLayer(e,t,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||"model"===n.type||"raster"===n.type||r&&r.length)&&(this.id=n.id,this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&"custom"===n.type)&&AT[n.type](e,t,n,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,n=this.context.gl;let r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:n.createQuery()}),r.calls++,n.beginQuery(t.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,n=t.createQuery();this.deferredRenderGpuTimeQueries.push(n),t.beginQuery(e.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const n in e){const r=e[n],i=this.context.extTimerQuery,o=i.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;i.deleteQueryEXT(r.query),t[n]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,n=this.context.gl;let r=0;for(const i of e)r+=t.getQueryParameter(i,n.QUERY_RESULT)/1e6,t.deleteQueryEXT(i);return r}translatePosMatrix(e,t,n,r,i){if(!n[0]&&!n[1])return e;const o=i?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const s=[i?n[0]:X_(t,n[0],this.transform.zoom),i?n[1]:X_(t,n[1],this.transform.zoom),0],a=new Float32Array(16);return _h.translate(a,e,s),a}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}terrainUseFloatDEM(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,n){const r=void 0===n?this.terrain&&this.terrain.renderingToTexture:n,i=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.terrainUseFloatDEM()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),i&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||r||void 0!==t&&!t||o.push("FOG","FOG_DITHERING"),r&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,t){this.cache=this.cache||{};const n=t&&t.defines||[],r=t&&t.config,i=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(n),o=aE.cacheKey(NM[e],e,i,r);return this.cache[o]||(this.cache[o]=new aE(this.context,e,NM[e],r,OE[e],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new yv(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,t){if(this.style.enable3dLights()){const n=this.style.directionalLight,r=this.style.ambientLight;if(n&&r){const i=((e,t)=>{const n=e.properties.get("direction"),r=e.properties.get("color").toArray01(),i=e.properties.get("intensity"),o=t.properties.get("color").toArray01(),s=t.properties.get("intensity"),a=[n.x,n.y,n.z],l=se(o,s),c=se(r,i);return{u_lighting_ambient_color:l,u_lighting_directional_dir:a,u_lighting_directional_color:c,u_ground_radiance:iE(a,c,l)}})(n,r);t.setLightsUniformValues(e,i)}}}uploadCommonUniforms(e,t,n,r,i){if(this.uploadCommonLightUniforms(e,t),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const i=o.getOpacity(this.transform.pitch),s=((e,t,n,r,i,o,s,a,l,c,u,h)=>{const d=e.transform,p=t.properties.get("color").toArray01();p[3]=r;const f=e.frameCounter/1e3%1,[m,g]=t.properties.get("vertical-range");return{u_fog_matrix:n?d.calculateFogTileMatrix(n):h||e.identityMat,u_fog_range:t.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:t.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(m,g),g],u_fog_temporal_offset:f,u_frustum_tl:i,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:a,u_globe_pos:l,u_globe_radius:c,u_viewport:u,u_globe_transition:Md(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,n,i,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ut.devicePixelRatio,this.transform.height*ut.devicePixelRatio],r);t.setFogUniformValues(e,s)}i&&t.setCutoffUniformValues(e,i.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)t[r.key]=e[r.key]||new Av(r,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=sw||t[1]>=sw}}const RT=2048;class LT{constructor(e,t){this.aabb=e,this.lastCascade=t}}class DT{add(e,t){const n=this.receivers[e.key];void 0!==n?(n.aabb.min[0]=Math.min(n.aabb.min[0],t.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],t.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],t.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],t.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],t.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],t.max[2])):this.receivers[e.key]=new LT(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,t,n){const r=$h.fromPoints(e.points);let i=0;for(const e in this.receivers){const o=this.receivers[e];if(!o)continue;if(!r.intersectsAabb(o.aabb))continue;o.aabb.min=r.closestPoint(o.aabb.min),o.aabb.max=r.closestPoint(o.aabb.max);const s=o.aabb.getCorners();for(let e=0;e<n.length;e++){let r=!0;for(const i of s){const o=[i[0]*t,i[1]*t,i[2]];if(Eh.transformMat4(o,o,n[e].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){r=!1;break}}if(o.lastCascade=e,i=Math.max(i,e),r)break}}return i+1}}class OT{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new DT,this._depthMode=new y_(e.context.gl.LEQUAL,y_.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,t){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!t||!t.properties)return;const r=t.properties.get("shadow-intensity");if(!t.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((t,r)=>{const i=n.style._mergedLayers[r];return t+(i.hasShadowPass()&&!i.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const i=n.context,o=RT,s=RT;if(0===this._cascades.length)for(let e=0;e<2;++e){const e=n._shadowMapDebug,t=i.gl,r=i.createFramebuffer(o,s,e,"texture"),a=new yv(i,{width:o,height:s,data:null},t.DEPTH_COMPONENT);if(r.depthAttachment.set(a.texture),e){const e=new yv(i,{width:o,height:s,data:null},t.RGBA);r.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:r,texture:a,matrix:[],far:0,boundingSphereRadius:0,frustum:new Wh,scale:0})}this.shadowDirection=kT(t);let a=0;if(e.elevation){const t=e.elevation,n=[1e4,-1e4];t.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;n[0]=Math.min(n[0],t.minimums[0]),n[1]=Math.max(n[1],t.maximums[0])})),1e4!==n[0]&&(a=(n[1]-n[0])*t.exaggeration())}const l=1.5*e.cameraToCenterDistance,c=3*l,u=new Float64Array(16);for(let t=0;t<2;++t){const n=this._cascades[t];let r=e.height/50,i=1;0===t?i=l:(r=l,i=c);const[o,s]=zT(e,this.shadowDirection,r,i,RT,a);n.scale=e.scale,n.matrix=o,n.boundingSphereRadius=s,_h.invert(u,n.matrix),n.frustum=Wh.fromInvProjectionMatrix(u,1,0,!0),n.far=i}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=RT,this._uniformValues.u_shadowmap_0=PE.ShadowMap0,this._uniformValues.u_shadowmap_1=PE.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const h=n.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(h){const n=h.getMinMaxForTile(e);n&&(t=n)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,t){if(!this._enabled)return;const n=this.painter,r=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),r.viewport.set([0,0,RT,RT]);for(let i=0;i<this._numCascadesToRender;++i){n.currentShadowCascade=i,r.bindFramebuffer.set(this._cascades[i].framebuffer.framebuffer),r.clear({color:cn.white,depth:1});for(const r of e.order){const i=e._mergedLayers[r];if(!i.hasShadowPass()||i.isHidden(n.transform.zoom))continue;const o=e.getLayerSourceCache(i),s=o?t[o.id]:void 0;("model"===i.type||s&&s.length)&&n.renderLayer(n,o,i,s)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const e=this.painter,t=e.style,n=e.context,r=t.directionalLight,i=t.ambientLight;if(!r||!i)return;const o=[],s=WM(e,e.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=FT(r,i),l=new y_(n.gl.LEQUAL,y_.ReadOnly,e.depthRangeFor3D);for(const t of this._groundShadowTiles){const r=t.toUnwrapped(),i=e.isTileAffectedByFog(t),c=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:i});this.setupShadows(r,c),e.uploadCommonUniforms(n,c,r,null,s);const u={u_matrix:e.transform.calculateProjMatrix(r),u_ground_shadow_factor:a};c.draw(e,n.gl.TRIANGLES,l,__.disabled,b_.multiply,M_.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?b_.unblended:b_.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const t=this.painter.transform,n=t.calculatePosMatrix(e,t.worldSize);return _h.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return _h.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,t,n,r=0){if(!this._enabled)return;const i=this.painter.transform,o=this.painter.context,s=o.gl,a=this._uniformValues,l=new Float64Array(16),c=i.calculatePosMatrix(e,i.worldSize);for(let e=0;e<2;e++)_h.multiply(l,this._cascades[e].matrix,c),a[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(s.TEXTURE0+PE.ShadowMap0+e),this._cascades[e].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const t=Qd(e.canonical),o=2/i.tileSize*ar/RT,s=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[1].boundingSphereRadius,c=("vector-tile"===n?1:3)/Math.pow(2,r-e.canonical.z-(1-i.zoom+Math.floor(i.zoom)));a.u_shadow_normal_offset=[t,s*c,l*c],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(o,a)}setupShadowsFromMatrix(e,t,n=!1){if(!this._enabled)return;const r=this.painter.context,i=r.gl,o=this._uniformValues,s=new Float64Array(16);for(let t=0;t<2;t++)_h.multiply(s,this._cascades[t].matrix,e),o[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),r.activeTexture.set(i.TEXTURE0+PE.ShadowMap0+t),this._cascades[t].texture.bind(i.NEAREST,i.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const e=5;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];t.setShadowUniformValues(r,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,t,n,r){if(r[2]>=0)return{};const i=function(e,t,n){const r=n/(1<<e.canonical.z);return new $h([e.canonical.x*r+e.wrap*n,e.canonical.y*r+e.wrap*n,0],[(e.canonical.x+1)*r+e.wrap*n,(e.canonical.y+1)*r+e.wrap*n,t])}(e,t,n).getCorners(),o=t/-r[2];r[0]<0?(Eh.add(i[0],i[0],[r[0]*o,0,0]),Eh.add(i[3],i[3],[r[0]*o,0,0])):r[0]>0&&(Eh.add(i[1],i[1],[r[0]*o,0,0]),Eh.add(i[2],i[2],[r[0]*o,0,0])),r[1]<0?(Eh.add(i[0],i[0],[0,r[1]*o,0]),Eh.add(i[1],i[1],[0,r[1]*o,0])):r[1]>0&&(Eh.add(i[2],i[2],[0,r[1]*o,0]),Eh.add(i[3],i[3],[0,r[1]*o,0]));const s={};return s.vertices=i,s.planes=[NT(i[1],i[0],i[4]),NT(i[2],i[1],i[5]),NT(i[3],i[2],i[6]),NT(i[0],i[3],i[7])],s}addShadowReceiver(e,t,n){this._receivers.add(e,$h.fromTileIdAndHeight(e,t,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function NT(e,t,n){const r=Eh.sub([],n,t),i=Eh.sub([],e,t),o=Eh.cross([],r,i),s=Eh.length(o);return 0===s?[0,0,1,0]:(Eh.scale(o,o,1/s),[o[0],o[1],o[2],-Eh.dot(o,t)])}function kT(e){const t=e.properties.get("direction"),n=J(t.x,t.y,t.z);n[2]=P(n[2],0,75);const r=K([n[0],n[1],n[2]]);return Eh.fromValues(r.x,r.y,r.z)}function FT(e,t){const n=e.properties.get("color"),r=e.properties.get("intensity"),i=e.properties.get("direction"),o=[i.x,i.y,i.z],s=t.properties.get("color"),a=t.properties.get("intensity"),l=Math.max(Eh.dot([0,0,1],o),0),c=[0,0,0];Eh.scale(c,s.toArray01Linear().slice(0,3),a);const u=[0,0,0];return Eh.scale(u,n.toArray01Linear().slice(0,3),l*r),ae([c[0]>0?c[0]/(c[0]+u[0]):0,c[1]>0?c[1]/(c[1]+u[1]):0,c[2]>0?c[2]/(c[2]+u[2]):0])}function zT(e,t,n,r,i,o){const s=e.zoom,a=e.scale,l=e.worldSize,c=1/l,u=e.aspect,h=Math.sqrt(1+u*u)*Math.tan(.5*e.fovX),d=h*h,p=r-n,f=r+n;let m,g;d>p/f?(m=r,g=r*h):(m=.5*f*(1+d),g=.5*Math.sqrt(p*p+2*(r*r+n*n)*d+f*f*d*d));const y=e.projection.pixelsPerMeter(e.center.lat,l),v=e._camera.getCameraToWorldMercator(),_=[0,0,-m*c];Eh.transformMat4(_,_,v);let x=g*c;const b=e._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const t=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?y:1),i=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,r);i[8]=2*-e.centerOffset.x/e.width,i[9]=2*e.centerOffset.y/e.height;const o=new Float64Array(16);_h.mul(o,i,t);const c=new Float64Array(16);_h.invert(c,o);const u=Wh.fromInvProjectionMatrix(c,l,s,!0);for(const t of u.points){const n=((w=t)[0]/=a,w[1]/=a,w[2]=Zd(w[2],e._center.lat),w);x=Math.max(x,Eh.len(Eh.subtract([],_,n)))}}var w;x*=i/(i-1);const S=Math.acos(t[2]),M=Math.atan2(-t[0],-t[1]),E=new V_;E.position=_,E.setPitchBearing(S,M);const T=E.getWorldToCamera(l,y),C=x*l,A=Math.min(e._mercatorZfromZoom(17)*l*-2,-2*C),I=E.getCameraToClipOrthographic(-C,C,-C,C,A,(C+o*y)/t[2]),P=new Float64Array(16);_h.multiply(P,I,T);const R=Eh.fromValues(Math.floor(1e6*_[0])/1e6*l,Math.floor(1e6*_[1])/1e6*l,0),L=.5*i,D=[0,0,0];Eh.transformMat4(D,R,P),Eh.scale(D,D,L);const O=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],N=[0,0,0];Eh.sub(N,D,O),Eh.scale(N,N,-1/L);const k=new Float64Array(16);return _h.identity(k),_h.translate(k,k,N),_h.multiply(P,k,P),[P,C]}class BT extends At{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,t){return aS(this.requestManager.transformRequest(t,ve.Model).url).then((t=>{if(!t)return;const n=gS(t),r=new bx(e,void 0,void 0,n);return r.computeBoundsAndApplyParent(),r})).catch((n=>{this.fire(new Ct(new Error(`Could not load model ${e} from ${t}: ${n.message}`)))}))}load(e,t){this.models[t]||(this.models[t]={});const n=Object.keys(e);this.numModelsLoading[t]=(this.numModelsLoading[t]||0)+n.length;const r=[];for(const t of n)r.push(this.loadModel(t,e[t]));Promise.allSettled(r).then((e=>{for(let r=0;r<e.length;r++){const{status:i,value:o}=e[r];"fulfilled"===i&&o&&(this.models[t][n[r]]=o)}this.numModelsLoading[t]-=n.length,this.fire(new Tt("data",{dataType:"style"}))})).catch((e=>{this.fire(new Ct(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]}addModel(e,t,n){this.models[n]||(this.models[n]={}),this.hasModel(e,n)&&this.removeModel(e,n),this.load({[e]:this.requestManager.normalizeModelURL(t)},n)}addModels(e,t){const n={};for(const t in e)n[t]=this.requestManager.normalizeModelURL(e[t]);this.load(n,t)}removeModel(e,t){this.models[t]||(this.models[t]={});const n=this.models[t][e];delete this.models[t][e],n.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const n in this.models[t])this.models[t][n].upload(e.context)}}const UT=(e,t)=>ws(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),jT=k(IS,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),VT=k(IS,["setCenter","setZoom","setBearing","setPitch"]),GT={version:8,layers:[],sources:{}},HT={duration:300,delay:0},ZT=new Set(["fill","line","background","hillshade","raster"]);class WT extends At{constructor(e,t={}){super(),this.map=e,this.scope=t.scope||"",this.fragments=[],this.importDepth=t.importDepth||0,this.importsCache=t.importsCache||new Map,this.resolvedImports=t.resolvedImports||new Set,this.transition=N({},HT),this._buildingIndex=new ES(this),this.crossTileSymbolIndex=new wM,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=t.styleChanges||new ya,this.dispatcher=t.dispatcher?t.dispatcher:new gw(Uw(),this),t.imageManager?this.imageManager=t.imageManager:(this.imageManager=new Qb,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=t.glyphManager?t.glyphManager:new Kg(e._requestManager,t.localFontFamily?2:t.localIdeographFontFamily?1:0,t.localFontFamily||t.localIdeographFontFamily),t.modelManager?this.modelManager=t.modelManager:(this.modelManager=new BT(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this.dispatcher.broadcast("setReferrer",xe());const n=this;this._rtlTextPluginCallback=WT.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,t)=>{if(qs(e),t&&t.every((e=>e)))for(const e in n._sourceCaches){const t=n._sourceCaches[e],r=t.getSource().type;"vector"!==r&&"geojson"!==r||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const n=this._layers[e];n.source===t.id&&this._validateLayer(n)}}))}loadURL(e,t={}){this.fire(new Tt("dataloading",{dataType:"style"}));const n="boolean"==typeof t.validate?t.validate:!Re(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken),this.resolvedImports.add(e);const r=this.importsCache.get(e);if(r)return this._load(r,n);const i=this.map._requestManager.transformRequest(e,ve.Style);this._request=we(i,((t,r)=>{if(this._request=null,t)this.fire(new Ct(t));else if(r)return this.importsCache.set(e,r),this._load(r,n)}))}loadJSON(e,t={}){this.fire(new Tt("dataloading",{dataType:"style"})),this._request=ut.frame((()=>{this._request=null,this._load(e,!1!==t.validate)}))}loadEmpty(){this.fire(new Tt("dataloading",{dataType:"style"})),this._load(GT,!1)}_loadImports(e,t){if(this.importDepth>=4)return q("Style doesn't support nesting deeper than 5"),this._reloadImports();const n=[];for(const r of e){const e=this._createFragmentStyle(r),i=new Promise((t=>e.on("style.import.load",t)));if(n.push(i),this.resolvedImports.has(r.url)){e.loadEmpty();continue}const o=r.data||this.importsCache.get(r.url);o?e.loadJSON(o,{validate:t}):r.url?e.loadURL(r.url,{validate:t}):e.loadEmpty(),this.fragments.push({style:e,id:r.id,config:r.config})}Promise.all(n).then((()=>this._reloadImports()))}_createFragmentStyle(e){const t=this.scope?pa(e.id,this.scope):e.id,n=new WT(this.map,{scope:t,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager});return n.setEventedParent(this.map,{style:n}),n.setConfig(e.config),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Tt("data",{dataType:"style"})),this.fire(new Tt(e?"style.load":"style.import.load"))}_load(e,t){const n=e.schema;if(this.isRootStyle()&&(e.fragment||n&&!1!==e.fragment)){const n=N({},GT,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,t)}if(this.updateSchema(n),t&&UT(this,us(e)))return;this._loaded=!0,this.stylesheet=W(e);for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changes.changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const r=AS(this.stylesheet.layers);if(this._order=r.map((e=>e.id)),this.stylesheet.light&&q("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new tw(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tw(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of r){const t=Kb(e,this.options);t.setScope(this.scope),t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const n=this.getOwnLayerSourceCache(t),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&t.canCastShadows()&&r&&(n.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const i=this.stylesheet.terrain;if(i&&!this.terrainSetForDrapingOnly()&&this._createTerrain(i,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.fire(new Tt("data",{dataType:"style"})),e.imports)this._loadImports(e.imports,t);else{this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Tt(e?"style.load":"style.import.load"))}}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,t,n,r,i,o,s,a;this.forEachFragmentStyle((l=>{if(l.stylesheet){if(null!=l.light&&(e=l.light),l.stylesheet.lights)for(const e of l.stylesheet.lights)"ambient"===e.type&&null!=l.ambientLight&&(t=l.ambientLight),"directional"===e.type&&null!=l.directionalLight&&(n=l.directionalLight);(l.stylesheet.terrain||l.stylesheet.projection&&"globe"===l.stylesheet.projection.name)&&null!=l.terrain&&(!r||r&&0===r.drapeRenderMode||1===l.terrain.drapeRenderMode)&&(r=l.terrain),l.stylesheet.fog&&null!=l.fog&&(i=l.fog),null!=l.stylesheet.camera&&(a=l.stylesheet.camera),null!=l.stylesheet.projection&&(o=l.stylesheet.projection),null!=l.stylesheet.transition&&(s=l.stylesheet.transition)}})),this.light=e,this.ambientLight=t,this.directionalLight=n,this.terrain=r,this.fog=i,this.camera=a||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=N({},HT,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=n=>{for(const e of n.fragments)t(e.style);e(n)};t(this)}mergeTerrain(){let e;this.forEachFragmentStyle((t=>{null!=t.terrain&&(!e||e&&0===e.drapeRenderMode||1===t.terrain.drapeRenderMode)&&(e=t.terrain)})),this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const e={},t={},n={};this.forEachFragmentStyle((r=>{for(const t in r._sourceCaches){const n=pa(t,r.scope);e[n]=r._sourceCaches[t]}for(const e in r._otherSourceCaches){const n=pa(e,r.scope);t[n]=r._otherSourceCaches[e]}for(const e in r._symbolSourceCaches){const t=pa(e,r.scope);n[t]=r._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=t,this._mergedSymbolSourceCaches=n}mergeLayers(){const e={},t=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((n=>{for(const r of n._order){const i=n._layers[r];if("slot"===i.type){const t=fa(r);if(e[t])continue;e[t]=[]}i.slot&&e[i.slot]?e[i.slot].push(i):t.push(i)}})),this._mergedOrder=[];const r=(t=[])=>{for(const i of t)if("slot"===i.type){const t=fa(i.id);e[t]&&r(e[t])}else{const e=pa(i.id,i.scope);this._mergedOrder.push(e),n[e]=i,i.is3D()&&(this._has3DLayers=!0),"circle"===i.type&&(this._hasCircleLayers=!0),"symbol"===i.type&&(this._hasSymbolLayers=!0)}};r(t),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=N({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,t,n){let r,i,o;const s=ut.devicePixelRatio>1?"@2x":"";let a=we(t.transformRequest(t.normalizeSpriteURL(e,s,".json"),ve.SpriteJSON),((e,t)=>{a=null,o||(o=e,r=t,c())})),l=Ae(t.transformRequest(t.normalizeSpriteURL(e,s,".png"),ve.SpriteImage),((e,t)=>{l=null,o||(o=e,i=t,c())}));function c(){if(o)n(o);else if(r&&i){const e=ut.getImageData(i),t={};for(const n in r){const{width:i,height:o,x:s,y:a,sdf:l,pixelRatio:c,stretchX:u,stretchY:h,content:d}=r[n],p=new Wp({width:i,height:o});Wp.copy(e,p,{x:s,y:a},{x:0,y:0},{width:i,height:o}),t[n]={data:p,pixelRatio:c,sdf:l,stretchX:u,stretchY:h,content:d}}n(null,t)}}return{cancel(){a&&(a.cancel(),a=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,((e,t)=>{if(this._spriteRequest=null,e)this.fire(new Ct(e));else if(t)for(const e in t)this.imageManager.addImage(e,this.scope,t[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Tt("data",{dataType:"style"}))}))}_validateLayer(e){const t=this.getOwnSource(e.source);if(!t)return;const n=e.sourceLayer;n&&("geojson"===t.type||t.vectorLayerIds&&-1===t.vectorLayerIds.indexOf(n))&&this.fire(new Ct(new Error(`Source layer "${n}" does not exist on source "${t.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.updatedSourceCaches).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const n=this.fragments[t];return n&&n.style&&(e.data=n.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return e}_serializeLayers(e){const t=[];for(const n of e){const e=this._layers[n];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped(this.getLayerSourceCache(e)):ZT.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const t=this.getOwnLayer(e);if(t)return t;this.fire(new Ct(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const t=this.getOwnSource(e);if(t)return t;this.fire(new Ct(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const t=this.calculateLightsBrightness();e.brightness=t||0,t!==this._brightness&&(this._brightness=t,this.dispatcher.broadcast("setBrightness",t));const n=this._changes.changed;if(this._changes.changed){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:n,removedIds:r}=t[e];(n||r)&&this._updateWorkerLayers(e,n,r)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const r={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];r[e]=t.used,t.used=!1}for(const t of this._mergedOrder){const n=this._mergedLayers[t];if(n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)){const e=this.getOwnLayerSourceCache(n);e&&(e.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let t=n.minzoom||0;t<(n.maxzoom||25.5);t++){const t=this.map.painter;if(t){const r=n.getProgramIds();if(!r)continue;for(const i of r){const r=n.getDefaultProgramParams(i,e.zoom);r&&(t.style=this,this.fog&&(t._fogVisible=!0,r.overrideFog=!0,t.getOrCreateProgram(i,r)),t._fogVisible=!1,r.overrideFog=!1,t.getOrCreateProgram(i,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,t.getOrCreateProgram(i,r)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const e in r){const t=this._mergedSourceCaches[e];r[e]!==t.used&&t.getSource().fire(new Tt("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new Tt("data",{dataType:"style"}));for(const{style:t}of this.fragments)t.update(e)}_updateTilesForChangedImages(){const e=Array.from(this._changes.changedImages.keys());if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.changedImages.clear()}}_updateWorkerLayers(e,t,n){const r=this.getFragmentStyle(e);this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:n||[],options:r.options})}setState(e){if(this._checkLoaded(),UT(this,us(e)))return!1;(e=W(e)).layers=AS(e.layers);const t=function(e,t){if(!e)return[{command:IS.setStyle,args:[t]}];let n=[];try{if(!_(e.version,t.version))return[{command:IS.setStyle,args:[t]}];_(e.center,t.center)||n.push({command:IS.setCenter,args:[t.center]}),_(e.zoom,t.zoom)||n.push({command:IS.setZoom,args:[t.zoom]}),_(e.bearing,t.bearing)||n.push({command:IS.setBearing,args:[t.bearing]}),_(e.pitch,t.pitch)||n.push({command:IS.setPitch,args:[t.pitch]}),_(e.sprite,t.sprite)||n.push({command:IS.setSprite,args:[t.sprite]}),_(e.glyphs,t.glyphs)||n.push({command:IS.setGlyphs,args:[t.glyphs]}),_(e.transition,t.transition)||n.push({command:IS.setTransition,args:[t.transition]}),_(e.light,t.light)||n.push({command:IS.setLight,args:[t.light]}),_(e.fog,t.fog)||n.push({command:IS.setFog,args:[t.fog]}),_(e.projection,t.projection)||n.push({command:IS.setProjection,args:[t.projection]}),_(e.lights,t.lights)||n.push({command:IS.setLights,args:[t.lights]}),_(e.camera,t.camera)||n.push({command:IS.setCamera,args:[t.camera]});const r={},i=[];!function(e,t,n,r){let i;for(i in t=t||{},e=e||{})e.hasOwnProperty(i)&&(t.hasOwnProperty(i)||RS(i,n,r));for(i in t){if(!t.hasOwnProperty(i))continue;const o=t[i];e.hasOwnProperty(i)?_(e[i],o)||("geojson"===e[i].type&&"geojson"===o.type&&DS(e,t,i)?n.push({command:IS.setGeoJSONSourceData,args:[i,o.data]}):LS(i,t,n,r)):PS(i,t,n)}}(e.sources,t.sources,i,r);const o=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?n.push({command:IS.removeLayer,args:[e.id]}):o.push(e)}));let s=e.terrain;s&&r[s.source]&&(n.push({command:IS.setTerrain,args:[void 0]}),s=void 0),n=n.concat(i),_(s,t.terrain)||n.push({command:IS.setTerrain,args:[t.terrain]}),function(e,t,n){t=t||[];const r=(e=e||[]).map(NS),i=t.map(NS),o=e.reduce(kS,{}),s=t.reduce(kS,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p,f,m;for(c=0,u=0;c<r.length;c++)h=r[c],s.hasOwnProperty(h)?u++:(n.push({command:IS.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<i.length;c++)h=i[i.length-1-c],a[a.length-1-c]!==h&&(o.hasOwnProperty(h)?(n.push({command:IS.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],n.push({command:IS.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<i.length;c++)if(h=i[c],d=o[h],p=s[h],!l[h]&&!_(d,p))if(_(d.source,p.source)&&_(d["source-layer"],p["source-layer"])&&_(d.type,p.type)){for(m in OS(d.layout,p.layout,n,h,null,IS.setLayoutProperty),OS(d.paint,p.paint,n,h,null,IS.setPaintProperty),_(d.slot,p.slot)||n.push({command:IS.setSlot,args:[h,p.slot]}),_(d.filter,p.filter)||n.push({command:IS.setFilter,args:[h,p.filter]}),_(d.minzoom,p.minzoom)&&_(d.maxzoom,p.maxzoom)||n.push({command:IS.setLayerZoomRange,args:[h,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?OS(d[m],p[m],n,h,m.slice(6),IS.setPaintProperty):_(d[m],p[m])||n.push({command:IS.setLayerProperty,args:[h,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!d.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?OS(d[m],p[m],n,h,m.slice(6),IS.setPaintProperty):_(d[m],p[m])||n.push({command:IS.setLayerProperty,args:[h,m,p[m]]}))}else n.push({command:IS.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],n.push({command:IS.addLayer,args:[p,f]})}(o,t.layers,n),function(e=[],t=[],n){t=t||[];const r=(e=e||[]).map(NS),i=t.map(NS),o=e.reduce(kS,{}),s=t.reduce(kS,{}),a=r.slice();let l,c,u,h;for(l=0,c=0;l<r.length;l++)u=r[l],s.hasOwnProperty(u)?c++:(n.push({command:IS.removeImport,args:[u]}),a.splice(a.indexOf(u,c),1));for(l=0,c=0;l<i.length;l++)u=i[i.length-1-l],a[a.length-1-l]!==u&&(o.hasOwnProperty(u)?(n.push({command:IS.removeImport,args:[u]}),a.splice(a.lastIndexOf(u,a.length-c),1)):c++,h=a[a.length-l],n.push({command:IS.addImport,args:[s[u],h]}),a.splice(a.length-l,0,u));for(const e of t){const t=o[e.id];if(!t||_(t,e))continue;_(t.config,e.config)||n.push({command:IS.setImportConfig,args:[e.id,e.config]}),_(t.url,e.url)||n.push({command:IS.setImportUrl,args:[e.id,e.url]});const r=e.data;_(t&&t.data,r)||n.push({command:IS.setImportData,args:[e.id,r]})}}(e.imports,t.imports,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:IS.setStyle,args:[t]}]}return n}(this.serialize(),e).filter((e=>!(e.command in VT)));if(0===t.length)return!1;const n=t.filter((e=>!(e.command in jT)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return t.forEach((e=>{this[e.command].apply(this,e.args)})),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,t){return this.getImage(e)?this.fire(new Ct(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new Ct(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.changedImages.add(e),this._changes.changed=!0,this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Tt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t,n={}){return this._checkLoaded(),this._validate(xs,`models.${e}`,t,null,n)||(this.modelManager.addModel(e,t,this.scope),this._changes.changed=!0),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new Ct(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,t,n={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!t.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(t).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(t.type)>=0&&this._validate(hs,`sources.${e}`,t,null,n))return;this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const r=xS(e,t,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id})));const i=e=>{const t=(e?"symbol:":"other:")+r.id,n=pa(t,this.scope),i=this._sourceCaches[t]=new T_(n,r,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=i,i.onAdd(this.map)};i(!1),"vector"!==t.type&&"geojson"!==t.type||i(!0),r.onAdd&&r.onAdd(this.map),this.mergeSources(),this._changes.changed=!0}removeSource(e){this._checkLoaded();const t=this.getOwnSource(e);if(!t)throw new Error("There is no source with this ID");for(const t in this._layers)if(this._layers[t].source===e)return this.fire(new Ct(new Error(`Source "${e}" cannot be removed while layer "${t}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new Ct(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this.getOwnSourceCaches(e);for(const e of n){const t=fa(e.id);delete this._sourceCaches[t],delete this._changes.updatedSourceCaches[e.id],e.fire(new Tt("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changes.changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.changed=!0}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const n=this.getOwnSourceCache(t);n&&e.push(n.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const t=this._getTransitionParameters();for(const n of e){if(this._validate(ps,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(n),e.updateTransitions(t)}else this.ambientLight=new yw(n,vw,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(n),e.updateTransitions(t)}else this.directionalLight=new yw(n,_w,this.scope,this.options)}}const n=new ea(this.z||0,t);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,t=this.ambientLight;if(!e||!t)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=e.properties.get("color").toArray01(),i=e.properties.get("intensity"),o=e.properties.get("direction"),s=1-J(o.x,o.y,o.z)[2]/90,a=n(r)*i*s,l=t.properties.get("color").toArray01(),c=t.properties.get("intensity");return(a+n(l)*c)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}setConfigProperty(e,t,n){const r=_o(n);if("success"!==r.result)return void UT(this,r.value);const i=r.value.expression,o=this.getFragmentStyle(e);o.options.set(t,i),o.updateConfigDependencies()}setConfig(e,t){if(this.options.clear(),e){for(const t in e){const n=_o(e[t]);"success"===n.result&&this.options.set(t,n.value.expression)}this.updateSchema(t)}}updateSchema(e){if(e)for(const t in e){if(this.options.has(t))continue;const n=_o(e[t].default);"success"===n.result&&this.options.set(t,n.value.expression)}}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.changed=!0}addLayer(e,t,n={}){this._checkLoaded();const r=e.id;if(this._layers[r])return void this.fire(new Ct(new Error(`Layer with id "${r}" already exists on this map`)));let i;if("custom"===e.type){if(UT(this,function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t}(e)))return;i=Kb(e,this.options)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=N(e=W(e),{source:r})),this._validate(gs,`layers.${r}`,e,{arrayIndex:-1},n))return;i=Kb(e,this.options),this._validateLayer(i),i.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[i.id]=i.serialize()}i.isConfigDependent&&this._configDependentLayers.add(i.fqid),i.setScope(this.scope);const o=t?this._order.indexOf(t):this._order.length;if(t&&-1===o)return void this.fire(new Ct(new Error(`Layer with id "${t}" does not exist on this map.`)));this._order.splice(o,0,r),this._layerOrderChanged=!0,this._layers[r]=i;const s=this.getOwnLayerSourceCache(i),a=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&i.canCastShadows()&&a&&(s.castsShadows=!0);const l=this._changes.getRemovedLayer(i);if(l&&i.source&&s&&"custom"!==i.type){this._changes.discardLayerRemoval(i);const e=pa(i.source,i.scope);l.type!==i.type?this._changes.updatedSourceCaches[e]="clear":(this._changes.updatedSourceCaches[e]="reload",s.pause())}this._updateLayer(i),i.onAdd&&i.onAdd(this.map),i.scope=this.scope,this.mergeLayers()}moveLayer(e,t){if(this._checkLoaded(),this._changes.changed=!0,!this._checkLayer(e))return;if(e===t)return;const n=this._order.indexOf(e);this._order.splice(n,1);const r=t?this._order.indexOf(t):this._order.length;t&&-1===r?this.fire(new Ct(new Error(`Layer with id "${t}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this.mergeLayers())}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.changed=!0,this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const r=this.getOwnLayerSourceCache(t);if(r&&r.castsShadows){let e=!1;for(const n in this._layers)if(this._layers[n].source===t.source&&this._layers[n].canCastShadows()){e=!0;break}r.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,n){this._checkLoaded();const r=this._checkLayer(e);r&&(r.minzoom===t&&r.maxzoom===n||(null!=t&&(r.minzoom=t),null!=n&&(r.maxzoom=n),this._updateLayer(r)))}setSlot(e,t){this._checkLoaded();const n=this._checkLayer(e);n&&n.slot!==t&&(n.slot=t,this._updateLayer(n))}setFilter(e,t,n={}){this._checkLoaded();const r=this._checkLayer(e);if(r&&!_(r.filter,t))return null==t?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(ys,`layers.${r.id}.filter`,t,{layerType:r.type},n)||(r.filter=W(t),this._updateLayer(r)))}getFilter(e){const t=this._checkLayer(e);if(t)return W(t.filter)}setLayoutProperty(e,t,n,r={}){this._checkLoaded();const i=this._checkLayer(e);i&&(_(i.getLayoutProperty(t),n)||(i.setLayoutProperty(t,n,r),i.isConfigDependent&&this._configDependentLayers.add(i.fqid),this._updateLayer(i)))}getLayoutProperty(e,t){const n=this._checkLayer(e);if(n)return n.getLayoutProperty(t)}setPaintProperty(e,t,n,r={}){this._checkLoaded();const i=this._checkLayer(e);if(!i)return;if(_(i.getPaintProperty(t),n))return;const o=i.setPaintProperty(t,n,r);i.isConfigDependent&&this._configDependentLayers.add(i.fqid),o&&this._updateLayer(i),this._changes.changed=!0,this._changes.updatedPaintProps.add(i.fqid)}getPaintProperty(e,t){const n=this._checkLayer(e);if(n)return n.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();const n=e.source,r=e.sourceLayer,i=this._checkSource(n);if(!i)return;const o=i.type;if("geojson"===o&&r)return void this.fire(new Ct(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!r)return void this.fire(new Ct(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new Ct(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(n);for(const n of s)n.setFeatureState(r,e.id,t)}removeFeatureState(e,t){this._checkLoaded();const n=e.source,r=this._checkSource(n);if(!r)return;const i=r.type,o="vector"===i?e.sourceLayer:void 0;if("vector"===i&&!o)return void this.fire(new Ct(new Error("The sourceLayer parameter must be provided for vector source types.")));if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new Ct(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(n);for(const n of s)n.removeFeatureState(o,e.id,t)}getFeatureState(e){this._checkLoaded();const t=e.source,n=e.sourceLayer,r=this._checkSource(t);if(r){if("vector"!==r.type||n)return void 0===e.id&&this.fire(new Ct(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(t)[0].getFeatureState(n,e.id);this.fire(new Ct(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=N({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return N({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),t=e&&this.terrain&&this.terrain.scope===this.scope?e:void 0;return Z({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:t,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._changes.updateLayer(e);const t=this.getLayerSourceCache(e),n=pa(e.source,e.scope);e.source&&!this._changes.updatedSourceCaches[n]&&t&&"raster"!==t.getSource().type&&(this._changes.updatedSourceCaches[n]="reload",t.pause()),this._changes.changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type,n=this.order,r={},i=[];for(let o=n.length-1;o>=0;o--){const s=n[o];if(t(s)){r[s]=o;for(const t of e){const e=t[s];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const o=[];for(let s=n.length-1;s>=0;s--){const a=n[s];if(t(a))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(r[t.layer.id]<s)break;o.push(t),i.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)o.push(t.feature)}}return o}queryRenderedFeatures(e,t,n){t&&t.filter&&this._validate(ys,"queryRenderedFeatures.filter",t.filter,null,t),t.scope=this.scope,t.availableImages=this._availableImages,t.serializedLayers=this._serializedLayers;const r={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new Ct(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._mergedLayers[e];if(!t)return this.fire(new Ct(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[t.source]=!0}}const i=[],o=t.serializedLayers||{},s=t&&t.layers?t.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=xw.createFromScreenPoints(e,n);for(const e in this._mergedSourceCaches){const l=this._mergedSourceCaches[e].getSource();if(!l||l.scope!==t.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;t.layers&&!r[c]||i.push(wS(this._mergedSourceCaches[e],this._mergedLayers,o,a,t,n,s,!!this.map._showQueryGeometry))}return this.placement&&i.push(function(e,t,n,r,i,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(MS);for(const n of c){const r=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(const e in r){const t=a[e]=a[e]||[],i=r[e];i.sort(((e,t)=>{const r=n.featureSortOrder;if(r){const n=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(const e of i)t.push(e)}}for(const t in a)a[t].forEach((r=>{const i=r.feature,o=n(e[t]);if(!o)return;const s=o.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=s}));return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),a.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(i)}querySourceFeatures(e,t){t&&t.filter&&this._validate(ys,"querySourceFeatures.filter",t.filter,null,t);const n=this.getOwnSourceCaches(e);let r=[];for(const e of n)r=r.concat(SS(e,t));return r}addSourceType(e,t,n){return WT.getSourceType(e)?n(new Error(`A source type called "${e}" already exists.`)):(WT.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,t,n={}){this._checkLoaded();const r=this.light.getLight();let i=!1;for(const t in e)if(!_(e[t],r[t])){i=!0;break}if(!i)return;const o=this._getTransitionParameters();this.light.setLight(e,t,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,t=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=e;if(1===t){if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=W(n),n=N(n,{source:e})}if(this._validate(fs,"terrain",n))return}if(!this.terrain||this.terrain&&t!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,t),this.fire(new Tt("data",{dataType:"style"}))}else{const t=this.terrain,r=t.get();for(const e of Object.keys(It.terrain))!n.hasOwnProperty(e)&&It.terrain[e].default&&(n[e]=It.terrain[e].default);for(const n in e)if(!_(e[n],r[n])){t.set(e),this.stylesheet.terrain=e;const n=this._getTransitionParameters({duration:0});t.updateTransitions(n),this.fire(new Tt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new dw(e,this.map.transform);this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const t=this.fog;if(!_(t.get(),e)){t.set(e),this.stylesheet.fog=t.get();const n=this._getTransitionParameters({duration:0});t.updateTransitions(n)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:ut.now(),transition:N(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const n in this._mergedLayers)this.isLayerDraped(this._mergedLayers[n])?e.push(n):t.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const n=this.terrain=new rw(e,t);n.setScope(this.scope),this.stylesheet.terrain=e,this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});n.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(e,t,n,r,i={}){if(i&&!1===i.validate)return!1;const o=N({},this.serialize());return UT(this,e.call(us,N({key:t,style:o,value:n,styleSpec:It},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),Ys.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const e of t)e.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload()}updateSources(e){let t;this.directionalLight&&(t=kT(this.directionalLight));for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(e,t,n,r,i=!1){let o=!1,s=!1;const a={},l={};for(const t of this._mergedOrder){const n=this._mergedLayers[t];if("symbol"!==n.type)continue;const r=pa(n.source,n.scope);let i=a[r];if(!i){const e=this.getLayerSourceCache(n);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));l[r]=t.slice(),i=a[r]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const s=this.crossTileSymbolIndex.addLayer(n,i,e.center.lng,e.projection);o=o||s}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),i=i||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new Tt("neworder")),(i||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ut.now(),e.zoom))&&(this.pauseablePlacement=new uM(e,this._mergedOrder,i,t,n,r,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,a,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ut.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(const e of this._mergedOrder){const t=this._mergedLayers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,a[pa(t.source,t.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ut.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();const t=this.stylesheet.imports=this.stylesheet.imports||[];return-1!==t.findIndex((({id:t})=>t===e.id))?this.fire(new Ct(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(t.push(e),this._loadImports([e],!0),this)}setImportUrl(e,t){this._checkLoaded();const n=this.stylesheet.imports||[],r=this.getImportIndex(e);if(-1===r)return this;n[r].url=t;const i=this.fragments[r];i.style=this._createFragmentStyle({id:e,url:t});const o=new Promise((e=>i.style.on("style.import.load",e)));return i.style.loadURL(t),o.then((()=>this._reloadImports())),this}setImportData(e,t){this._checkLoaded();const n=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===n?this:t?(this.fragments[n].style.setState(t),this._reloadImports(),this):(delete r[n].data,this.setImportUrl(e,r[n].url))}setImportConfig(e,t){this._checkLoaded();const n=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===n)return this;t?r[n].config=t:delete r[n].config;const i=this.fragments[n],o=i.style.stylesheet&&i.style.stylesheet.schema;return i.config=t,i.style.setConfig(t,o),i.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n||(t.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports()),this}getImportIndex(e){const t=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===t&&this.fire(new Ct(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),t}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const n=this._mergedOtherSourceCaches[t];n&&e.push(n.getSource())}return e}getSource(e,t){const n=this.getSourceCache(e,t);return n&&n.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(e,t){const n=pa(e,t);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const t=pa(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[t]:this._mergedOtherSourceCaches[t]}getSourceCaches(e){const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){for(const e in this._changes.updatedSourceCaches){const t=this._changes.updatedSourceCaches[e];"reload"===t?this.reloadSource(e):"clear"===t&&this.clearSource(e)}}updateLayers(e){for(const t of this._changes.updatedPaintProps){const n=this.getLayer(t);n&&n.updateTransitions(e)}}getImages(e,t,n){this.imageManager.getImages(t.icons,t.scope,n),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,n){this.glyphManager.getGlyphs(t.stacks,t.scope,n)}getResource(e,t,n){return be(t,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){const t=this.getOwnSourceCaches(e);return 0===t.length?(this.fire(new Ct(new Error(`There is no source with ID '${e}'`))),!1):t.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function $T(e,t){let n=!1,r=null;const i=()=>{r=null,n&&(e(),r=setTimeout(i,t),n=!1)};return()=>(n=!0,r||i(),r)}WT.getSourceType=function(e){return _S[e]},WT.setSourceType=function(e,t){_S[e]=t},WT.registerForPluginStateChange=function(e){return e({pluginStatus:Ws,pluginURL:$s}),Ys.on("pluginStateChange",e),e};class qT{constructor(e){this._hashName=e&&encodeURIComponent(e),V(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=$T(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const n=XT(e);if(this._hashName){const e=this._hashName;let r=!1;const i=t.location.hash.slice(1).split("&").map((t=>{const i=t.split("=")[0];return i===e?(r=!0,`${i}=${n}`):t})).filter((e=>e));return r||i.push(`${e}=${n}`),`#${i.join("&")}`}return`#${n}`}_getCurrentHash(){const e=t.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const n=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.location.href.replace(/(#.+)?$/,this.getHashString());t.history.replaceState(t.history.state,null,e)}}function XT(e,t){const n=e.getCenter(),r=Math.round(100*e.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const YT={linearity:.3,easing:A(0,0,.3,1)},KT=N({deceleration:2500,maxSpeed:1400},YT),JT=N({deceleration:20,maxSpeed:1400},YT),QT=N({deceleration:1e3,maxSpeed:360},YT),eC=N({deceleration:1e3,maxSpeed:90},YT);class tC{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ut.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=ut.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const t={zoom:0,bearing:0,pitch:0,pan:new v(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)t.zoom+=e.zoomDelta||0,t.bearing+=e.bearingDelta||0,t.pitch+=e.pitchDelta||0,e.panDelta&&t.pan._add(e.panDelta),e.around&&(t.around=e.around),e.pinchAround&&(t.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(t.pan.mag()){const i=rC(t.pan.mag(),n,N({},KT,e||{}));r.offset=t.pan.mult(i.amount/t.pan.mag()),r.center=this._map.transform.center,nC(r,i)}if(t.zoom){const e=rC(t.zoom,n,JT);r.zoom=this._map.transform.zoom+e.amount,nC(r,e)}if(t.bearing){const e=rC(t.bearing,n,QT);r.bearing=this._map.transform.bearing+P(e.amount,-179,179),nC(r,e)}if(t.pitch){const e=rC(t.pitch,n,eC);r.pitch=this._map.transform.pitch+e.amount,nC(r,e)}if(r.zoom||r.bearing){const e=void 0===t.pinchAround?t.around:t.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function nC(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function rC(e,t,n){const{maxSpeed:r,linearity:i,deceleration:o}=n,s=P(e*i/(t/1e3),-r,r),a=Math.abs(s)/(o*i);return{easing:n.easing,duration:1e3*a,amount:s*(a/2)}}class iC extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n,r={}){const i=xt(t.getCanvasContainer(),n);super(e,N({point:i,lngLat:t.unproject(i),originalEvent:n},r)),this._defaultPrevented=!1,this.target=t}}class oC extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){const r="touchend"===e?n.changedTouches:n.touches,i=bt(t.getCanvasContainer(),r),o=i.map((e=>t.unproject(e))),s=i.reduce(((e,t,n,r)=>e.add(t.div(r.length))),new v(0,0));super(e,{points:i,point:s,lngLats:o,lngLat:t.unproject(s),originalEvent:n}),this._defaultPrevented=!1}}class sC extends Tt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class aC{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new sC(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new iC(e.type,this._map,e))}mouseup(e){this._map.fire(new iC(e.type,this._map,e))}preclick(e){const t=N({},e);t.type="preclick",this._map.fire(new iC(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new iC(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new iC(e.type,this._map,e))}mouseover(e){this._map.fire(new iC(e.type,this._map,e))}mouseout(e){this._map.fire(new iC(e.type,this._map,e))}touchstart(e){return this._firePreventable(new oC(e.type,this._map,e))}touchmove(e){this._map.fire(new oC(e.type,this._map,e))}touchend(e){this._map.fire(new oC(e.type,this._map,e))}touchcancel(e){this._map.fire(new oC(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lC{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new iC(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new iC("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new iC(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cC{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(gt(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t,r=this._startPos,i=this._lastPos;if(!r||!i||i.equals(n)||!this._box&&n.dist(r)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=ht("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(r.x,n.x),s=Math.max(r.x,n.x),a=Math.min(r.y,n.y),l=Math.max(r.y,n.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${o}px,${a}px)`,this._box.style.width=s-o+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(e,t){if(!this._active)return;const n=this._startPos,r=t;if(n&&0===e.button){if(this.reset(),_t(),n.x!==r.x||n.y!==r.y)return this._map.fire(new Tt("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),yt(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new Tt(e,{originalEvent:t}))}}function uC(e,t){const n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class hC{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const t=new v(0,0);for(const n of e)t._add(n);return t.div(e.length)}(t),this.touches=uC(n,t)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const r=uC(n,t);for(const e in this.touches){const t=r[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class dC{constructor(e){this.singleTap=new hC(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const r=this.singleTap.touchend(e,t,n);if(r){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class pC{constructor(){this._zoomIn=new dC({numTouches:1,numTaps:2}),this._zoomOut=new dC({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const r=this._zoomIn.touchend(e,t,n),i=this._zoomOut.touchend(e,t,n);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fC={0:1,2:2};class mC{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const n=wt(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}mousemoveWindow(e,t){const n=this._lastPoint;if(n)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const n=fC[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}mouseupWindow(e){this._lastPoint&&wt(e)===this._eventButton&&(this._moved&&_t(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gC extends mC{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class yC extends mC{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(e){e.preventDefault()}}class vC extends mC{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(e){e.preventDefault()}}class _C{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),V(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new v(0,0)}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!ne())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,n)}}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,n){n.length>0&&(this._active=!0);const r=uC(n,t),i=new v(0,0),o=new v(0,0);let s=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(i._add(t),o._add(t.sub(n)),s++,r[e]=t)}if(this._touches=r,s<this._minTouches||!o.mag())return;const a=o.div(s);return this._sum._add(a),this._sum.mag()<this._clickTolerance?void 0:{around:i.div(s),panDelta:a}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ht("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")}),500)}}class xC{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,n){return{}}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[i,o]=r,s=bC(n,t,i),a=bC(n,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[r,i]=this._firstTwoTouches,o=bC(n,t,r),s=bC(n,t,i);o&&s||(this._active&&_t(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bC(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function wC(e,t){return Math.log(e/t)/Math.LN2}class SC extends xC{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(wC(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wC(this._distance,n),pinchAround:t}}}function MC(e,t){return 180*e.angleWith(t)/Math.PI}class EC extends xC{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const n=this._vector;if(this._vector=e[0].sub(e[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:MC(this._vector,n),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;const r=MC(e,n);return Math.abs(r)<t}}function TC(e){return Math.abs(e.y)>Math.abs(e.x)}class CC extends xC{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,TC(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){const r=this._lastPoints;if(!r)return;const i=e[0].sub(r[0]),o=e[1].sub(r[1]);return this._map._cooperativeGestures&&!ne()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(i,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,i=t.mag()>=2;if(!r&&!i)return;if(!r||!i)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return TC(e)&&TC(t)&&o}}const AC={panStep:100,bearingStep:15,pitchStep:10};class IC{constructor(){const e=AC;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,r=0,i=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:PC,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function PC(e){return e*(2-e)}const RC=4.000244140625;class LC{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,V(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||ne()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===t.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=ut.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%RC==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=xt(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const t=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const n="wheel"===this._type&&Math.abs(this._delta)>RC?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==r&&(r=1/r);const i=t(),o=Math.pow(2,i),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=i,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:t(),r=this._startZoom,i=this._easing;let o,s=!1;if("wheel"===this._type&&r&&i){const e=Math.min((ut.now()-this._lastWheelEventTime)/200,1);o=Xr(r,n,i(e)),e<1?this._frameId||(this._frameId=!0):s=!0}else o=n,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let a=o-t();return a*this._lastDelta<0&&(a=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:a,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let t=I;if(this._prevEase){const e=this._prevEase,n=(ut.now()-e.start)/e.duration,r=e.easing(n+.01)-e.easing(n),i=.27/Math.sqrt(r*r+1e-4)*.01;t=A(i,Math.sqrt(.0729-i*i),.25,1)}return this._prevEase={start:ut.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ht("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")}),200)}}class DC{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class OC{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class NC{constructor(){this._tap=new dC({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kC{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class FC{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zC{constructor(e,t,n,r){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const BC=e=>e.zoom||e.drag||e.pitch||e.rotate;class UC extends Tt{}class jC{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){const n=Eh.sub([],t,e);this.radius=Eh.length(n[2]<0?Eh.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){Eh.div(e,e,this.constants),Eh.normalize(e,e),Eh.mul(e,e,this.constants);const t=Eh.scale([],e,this.radius);if(t[2]>0){const e=Eh.scale([],[0,0,1],Eh.dot(t,[0,0,1])),n=Eh.scale([],Eh.normalize([],[t[0],t[1],0]),this.radius),r=Eh.add([],t,Eh.scale([],Eh.sub([],Eh.add([],n,e),t),2));t[0]=r[0],t[1]=r[1]}return t}}function VC(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class GC{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tC(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jC,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),V(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.document,"mousemove",{capture:!0}],[t.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t,"blur",void 0]];for(const[e,n,r]of this._listeners)e.addEventListener(n,e===t.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[e,n,r]of this._listeners)e.removeEventListener(n,e===t.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new aC(t,e));const r=t.boxZoom=new cC(t,e);this._add("boxZoom",r);const i=new pC,o=new OC;t.doubleClickZoom=new DC(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const s=new NC;this._add("tapDragZoom",s);const a=t.touchPitch=new CC(t);this._add("touchPitch",a);const l=new yC(e),c=new vC(e);t.dragRotate=new FC(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new gC(e),h=new _C(t,e);t.dragPan=new kC(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new EC,p=new SC;t.touchZoomRotate=new zC(n,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lC(t));const f=t.scrollZoom=new LC(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new IC;this._add("keyboard",m);for(const n of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[n]&&t[n].enable(e[n])}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!BC(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,n){for(const r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}handleEvent(e,t){this._updatingCamera=!0;const n="renderFrame"===e.type,r=n?void 0:e,i={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?bt(this._el,a):n?void 0:xt(this._el,e);for(const{handlerName:n,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,n)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(i,o,h,n,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[n]=c)}const c={};for(const e in this._previousActiveHandlers)s[e]||(c[e]=r);this._previousActiveHandlers=s,(Object.keys(c).length||VC(i))&&(this._changes.push([i,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||VC(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=i;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,n,r,i){if(!n)return;N(e,n);const o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}_applyChanges(){const e={},t={},n={};for(const[r,i,o]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new v(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.aroundCoord&&(e.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),N(t,i),N(n,o);this._updateMapTransform(e,t,n),this._changes=[]}_updateMapTransform(e,t,n){const r=this._map,i=r.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!VC(e)){const e=i.zoom;i.cameraElevationReference="sea",null!=this._originalZoom&&i._orthographicProjectionAtLowPitch&&"globe"!==i.projection.name&&0===i.pitch?(i.cameraElevationReference="ground",i.zoom=this._originalZoom):(i.recenterOnTerrain(),i.cameraElevationReference="ground"),e!==i.zoom&&this._map._update(!0)}if(i._isCameraConstrained&&r._stop(!0),!VC(e))return void this._fireEvents(t,n,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,aroundCoord:h,pinchAround:d}=e;i._isCameraConstrained&&(a>0&&(a=0),i._isCameraConstrained=!1),void 0!==d&&(u=d),(a||(e=>t[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=o(i.pointCoordinate3D(u)),this._originalZoom=i.zoom,this._trackingEllipsoid.setup(i._camera.position,this._dragOrigin)),i.cameraElevationReference="sea",r._stop(!0),u=u||r.transform.centerPoint,l&&(i.bearing+=l),c&&(i.pitch+=c),i._updateCameraState();const p=[0,0,0];if(s)if("mercator"===i.projection.name){const e=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(u.sub(s)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1]}else{const e=i.pointCoordinate(u);if("globe"===i.projection.name){s=s.rotate(-i.angle);const t=i._pixelsPerMercatorPixel/i.worldSize;p[0]=-s.x*Jd($d(e.y))*t,p[1]=-s.y*Jd(i.center.lat)*t}else{const t=i.pointCoordinate(u.sub(s));e&&t&&(p[0]=t.x-e.x,p[1]=t.y-e.y)}}const f=i.zoom,m=[0,0,0];if(a){const e=o(h||i.pointCoordinate3D(u)),t={dir:Eh.normalize([],Eh.sub([],e,i._camera.position))};if(t.dir[2]<0){const n=i.zoomDeltaToMovement(e,a);Eh.scale(m,t.dir,n)}}const g=Eh.add(p,p,m);i._translateCameraConstrained(g),a&&Math.abs(i.zoom-f)>1e-4&&i.recenterOnTerrain(),i.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,t,n){const r=BC(this._eventsInProgress),i=BC(e),o={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(o[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&i&&this._fireEvent("movestart",i.originalEvent);for(const e in o)this._fireEvent(e,o[e]);i&&this._fireEvent("move",i.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const s={};let a;for(const e in this._eventsInProgress){const{handlerName:n,originalEvent:r}=this._eventsInProgress[e];this._handlersById[n].isActive()||(delete this._eventsInProgress[e],a=t[n]||r,s[`${e}end`]=a)}for(const e in s)this._fireEvent(e,s[e]);const l=BC(this._eventsInProgress);if(n&&(r||i)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:a})):(this._map.fire(new Tt("moveend",{originalEvent:a})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new Tt(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new UC("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const HC="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ZC extends At{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this._respectPrefersReducedMotion=!1!==t.respectPrefersReducedMotion,V(["_renderFrameCallback"],this)}getCenter(){return new Bd(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,n){return e=v.convert(e).mult(-1),this.panTo(this.transform.center,N({offset:e},t),n)}panTo(e,t,n){return this.easeTo(N({center:e},t),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,n){return this.easeTo(N({zoom:e},t),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,n){return this.easeTo(N({bearing:e},t),n)}resetNorth(e,t){return this.rotateTo(0,N({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(N({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=Ql.convert(e);const n=t&&t.bearing||0,r=t&&t.pitch||0,i=e.getNorthWest(),o=e.getSouthEast();return this._cameraForBounds(this.transform,i,o,n,r,t)}_extendCameraOptions(e){const t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=N({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=N(t,e.padding),e}_minimumAABBFrustumDistance(e,t){const n=t.max[0]-t.min[0],r=t.max[1]-t.min[1];return n/r>e.aspect?n/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,n,r,i,o){const s=e.clone(),a=this._extendCameraOptions(o);s.bearing=r,s.pitch=i;const l=Bd.convert(t),c=Bd.convert(n),u=.5*(l.lat+c.lat),h=.5*(l.lng+c.lng),d=md(u,h),p=Eh.normalize([],d),f=Eh.normalize([],Eh.cross([],p,[0,1,0])),m=Eh.cross([],f,p),g=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,p[0],p[1],p[2],0,0,0,0,1],y=[d,md(l.lat,l.lng),md(c.lat,l.lng),md(c.lat,c.lng),md(l.lat,c.lng),md(u,l.lng),md(u,c.lng),md(l.lat,h),md(c.lat,h)];let v=$h.fromPoints(y.map((e=>[Eh.dot(f,e),Eh.dot(m,e),Eh.dot(p,e)])));const _=Eh.transformMat4([],v.center,g);0===Eh.squaredLength(_)&&Eh.set(_,0,0,1),Eh.normalize(_,_),Eh.scale(_,_,Yh),s.center=function([e,t,n]){const r=Math.hypot(e,t,n),i=Math.atan2(e,n),o=.5*Math.PI-Math.acos(-t/r);return new Bd(S(i),S(o))}(_);const x=s.getWorldToCameraMatrix(),b=_h.invert(new Float64Array(16),x);v=$h.applyTransform(v,_h.multiply([],x,g)),Eh.transformMat4(_,_,x);const w=.5*(v.max[2]-v.min[2]),M=this._minimumAABBFrustumDistance(s,v),E=Eh.scale([],[0,0,1],w),T=Eh.add(E,_,E),C=M+(0===s.pitch?0:Eh.distance(_,T)),A=s.globeCenterInViewSpace,I=Eh.sub([],_,[A[0],A[1],A[2]]);Eh.normalize(I,I),Eh.scale(I,I,C);const P=Eh.add([],_,I);Eh.transformMat4(P,P,b);const R=kd/Yh,L=Eh.length(P),D=Zd(Math.max(L*R-kd,Number.EPSILON),0),O=Math.min(s.zoomFromMercatorZAdjusted(D),a.maxZoom);return O>.5*(qh+Xh)?(s.setProjection({name:"mercator"}),s.zoom=O,this._cameraForBounds(s,t,n,r,i,o)):{center:s.center,zoom:O,bearing:r,pitch:i}}queryTerrainElevation(e,t){const n=this.transform.elevation;return n?(t=N({},{exaggerated:!0},t),n.getAtPoint(ep.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,n,r,i,o){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,t,n,r,i,o);const s=e.clone(),a=this._extendCameraOptions(o),l=s.padding;s.bearing=r,s.pitch=i;const c=Bd.convert(t),u=Bd.convert(n),h=new Bd(c.lng,u.lat),d=new Bd(u.lng,c.lat),p=s.project(c),f=s.project(u),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),y=this.queryTerrainElevation(h),_=this.queryTerrainElevation(d),x=[[p.x,p.y,Math.min(m||0,g||0,y||0,_||0)],[f.x,f.y,Math.max(m||0,g||0,y||0,_||0)]];let b=$h.fromPoints(x);const S=s.getWorldToCameraMatrix(),M=_h.invert(new Float64Array(16),S);b=$h.applyTransform(b,S);const E=Eh.sub([],b.max,b.min),T=l.left||0,C=l.right||0,A=l.bottom||0,I=l.top||0,{left:P,right:R,top:L,bottom:D}=a.padding,O=.5*(T+C),N=.5*(I+A),k=Math.min(s.scaleZoom(s.scale*Math.min((s.width-(T+C+P+R))/E[0],(s.height-(A+I+D+L))/E[1])),a.maxZoom),F=s.scale/s.zoomScale(k);b=new $h([b.min[0]-(P+O)*F,b.min[1]-(D+N)*F,b.min[2]],[b.max[0]+(R+O)*F,b.max[1]+(L+N)*F,b.max[2]]);const z=.5*E[2],B=this._minimumAABBFrustumDistance(s,b),U=[0,0,1,0];hh.transformMat4(U,U,S),hh.normalize(U,U);const j=Eh.scale([],U,B+z),V=Eh.add([],b.center,j),G=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new v(a.offset.x,a.offset.y):v.convert(a.offset)).rotate(-w(r));b.center[0]-=G.x*F,b.center[1]+=G.y*F,Eh.transformMat4(b.center,b.center,M),Eh.transformMat4(V,V,M);const H=[b.center[0],b.center[1],V[2]*s.pixelsPerMeter];Eh.scale(H,H,1/s.worldSize);const Z=Wd(H[0]),W=$d(H[1]),$=Math.min(s._zoomFromMercatorZ(H[2]),a.maxZoom),q=new Bd(Z,W);return s.mercatorFromTransition&&$<.5*(qh+Xh)?(s.setProjection({name:"globe"}),s.zoom=$,this._cameraForBounds(s,t,n,r,i,o)):{center:q,zoom:$,bearing:r,pitch:i}}fitBounds(e,t,n){const r=this.cameraForBounds(e,t);return this._fitInternal(r,t,n)}fitScreenCoordinates(e,t,n,r,i){const o=v.convert(e),s=v.convert(t),a=new v(Math.min(o.x,s.x),Math.min(o.y,s.y)),l=new v(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const c=this.transform.pointLocation3D(a),u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(new v(a.x,l.y)),d=this.transform.pointLocation3D(new v(l.x,a.y)),p=[Math.min(c.lng,u.lng,h.lng,d.lng),Math.min(c.lat,u.lat,h.lat,d.lat)],f=[Math.max(c.lng,u.lng,h.lng,d.lng),Math.max(c.lat,u.lat,h.lat,d.lat)],m=r&&r.pitch?r.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,p,f,n,m,r);return this._fitInternal(g,r,i)}_fitInternal(e,t,n){return e?(delete(t=N(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}jumpTo(e,t){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let r=!1,i=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=Bd.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new Tt("movestart",t)).fire(new Tt("move",t)),r&&this.fire(new Tt("zoomstart",t)).fire(new Tt("zoom",t)).fire(new Tt("zoomend",t)),i&&this.fire(new Tt("rotatestart",t)).fire(new Tt("rotate",t)).fire(new Tt("rotateend",t)),o&&this.fire(new Tt("pitchstart",t)).fire(new Tt("pitch",t)).fire(new Tt("pitchend",t)),this.fire(new Tt("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||q(HC),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){const n=this.transform;if(!n.projection.supportsFreeCamera)return q(HC),this;this.stop();const r=n.zoom,i=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);const s=r!==n.zoom,a=i!==n.pitch,l=o!==n.bearing;return this.fire(new Tt("movestart",t)).fire(new Tt("move",t)),s&&this.fire(new Tt("zoomstart",t)).fire(new Tt("zoom",t)).fire(new Tt("zoomend",t)),l&&this.fire(new Tt("rotatestart",t)).fire(new Tt("rotate",t)).fire(new Tt("rotateend",t)),a&&this.fire(new Tt("pitchstart",t)).fire(new Tt("pitch",t)).fire(new Tt("pitchend",t)),this.fire(new Tt("moveend",t)),this}easeTo(e,t){this._stop(!1,e.easeId),(!1===(e=N({offset:[0,0],duration:500,easing:I},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,r=this.getZoom(),i=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?+e.zoom:r,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=v.convert(e.offset);let d,p,f;if("globe"===n.projection.name){const t=ep.fromLngLat(n.center),r=h.rotate(-n.angle);t.x+=r.x/n.worldSize,t.y+=r.y/n.worldSize;const i=t.toLngLat(),o=Bd.convert(e.center||i);this._normalizeCenter(o),d=n.centerPoint.add(r),p=new v(t.x,t.y).mult(n.worldSize),f=new v(Gd(o.lng),Hd(o.lat)).mult(n.worldSize).sub(p)}else{d=n.centerPoint.add(h);const t=n.pointLocation(d),r=Bd.convert(e.center||t);this._normalizeCenter(r),p=n.project(t),f=n.project(r).sub(p)}const m=n.zoomScale(a-r);let g,y;e.around&&(g=Bd.convert(e.around),y=n.locationPoint(g));const _=this._zooming||a!==r,x=this._rotating||i!==l,b=this._pitching||c!==o,w=!n.isPaddingEqual(u),S=n=>v=>{if(_&&(n.zoom=Xr(r,a,v)),x&&(n.bearing=Xr(i,l,v)),b&&(n.pitch=Xr(o,c,v)),w&&(n.interpolatePadding(s,u,v),d=n.centerPoint.add(h)),g)n.setLocationAtPoint(g,y);else{const e=n.zoomScale(n.zoom-r),t=a>r?Math.min(2,m):Math.max(.5,m),i=Math.pow(t,1-v),o=n.unproject(p.add(f.mult(v*i)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,d)}return e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(S,e.duration,n);return this._preloadTiles(t),this}const M={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,M),this._ease(S(n),(e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(t,e)}),e),this}_prepareEase(e,t,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),t||n.moving||this.fire(new Tt("movestart",e)),this._zooming&&!n.zooming&&this.fire(new Tt("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new Tt("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new Tt("pitchstart",e))}_fireMoveEvents(e){this.fire(new Tt("move",e)),this._zooming&&this.fire(new Tt("zoom",e)),this._rotating&&this.fire(new Tt("rotate",e)),this._pitching&&this.fire(new Tt("pitch",e))}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new Tt("zoomend",e)),r&&this.fire(new Tt("rotateend",e)),i&&this.fire(new Tt("pitchend",e)),this.fire(new Tt("moveend",e))}flyTo(e,t){if(this._prefersReducedMotion(e)){const n=k(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,t)}this.stop(),e=N({offset:[0,0],speed:1.2,curve:1.42,easing:I},e);const n=this.transform,r=this.getZoom(),i=this.getBearing(),o=this.getPitch(),s=this.getPadding(),a="zoom"in e?P(+e.zoom,n.minZoom,n.maxZoom):r,l="bearing"in e?this._normalizeBearing(e.bearing,i):i,c="pitch"in e?+e.pitch:o,u="padding"in e?e.padding:n.padding,h=n.zoomScale(a-r),d=v.convert(e.offset);let p=n.centerPoint.add(d);const f=n.pointLocation(p),m=Bd.convert(e.center||f);this._normalizeCenter(m);const g=n.project(f),y=n.project(m).sub(g);let _=e.curve;const x=Math.max(n.width,n.height),b=x/h,w=y.mag();if("minZoom"in e){const t=P(Math.min(e.minZoom,r,a),n.minZoom,n.maxZoom),i=x/n.zoomScale(t-r);_=Math.sqrt(i/w*2)}const S=_*_;function M(e){const t=(b*b-x*x+(e?-1:1)*S*S*w*w)/(2*(e?b:x)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function T(e){return(Math.exp(e)+Math.exp(-e))/2}const C=M(0);let A=function(e){return T(C)/T(C+_*e)},R=function(e){return x*((T(C)*(E(t=C+_*e)/T(t))-E(C))/S)/w;var t},L=(M(1)-C)/_;if(Math.abs(w)<1e-6||!isFinite(L)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,t);const n=b<x?-1:1;L=Math.abs(Math.log(b/x))/_,R=function(){return 0},A=function(e){return Math.exp(n*_*e)}}e.duration="duration"in e?+e.duration:1e3*L/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const D=i!==l,O=c!==o,F=!n.isPaddingEqual(u),z=n=>h=>{const f=h*L,v=1/A(f);n.zoom=1===h?a:r+n.scaleZoom(v),D&&(n.bearing=Xr(i,l,h)),O&&(n.pitch=Xr(o,c,h)),F&&(n.interpolatePadding(s,u,h),p=n.centerPoint.add(d));const _=1===h?m:n.unproject(g.add(y.mult(R(f))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?_.wrap():_,p),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(t),n};if(e.preloadOnly){const t=this._emulate(z,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=D,this._pitching=O,this._padding=F,this._prepareEase(t,!1),this._ease(z(n),(()=>this._afterEase(t)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=ut.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((ut.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=L(e,-180,180);const n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&ut.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,t,n){const r=Math.ceil(15*t/1e3),i=[],o=e(n.clone());for(let e=0;e<=r;e++){const t=o(e/r);i.push(t.clone())}return i}}class WC{constructor(e={}){this.options=e,V(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ht("button","mapboxgl-ctrl-attrib-button",this._container),ht("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ht("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",n),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.ACCESS_TOKEN}];if(e){const n=t.reduce(((e,n,r)=>(n.value&&(e+=`${n.key}=${n.value}${r<t.length-1?"&":""}`),e)),"?");e.href=`${i.FEEDBACK_URL}/${n}#${XT(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const n in t){const r=t[n];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $C{constructor(){V(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=ht("div","mapboxgl-ctrl");const t=ht("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class qC{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const t of n)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function XC(e,t,n){if(e=new Bd(e.lng,e.lat),t){const r=new Bd(e.lng-360,e.lat),i=new Bd(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),s=n.locationPoint(e).distSqr(t),a=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(r).distSqr(t)<s&&(a||Math.abs(r.lng-n.center.lng)<o)?e=r:n.locationPoint(i).distSqr(t)<s&&(a||Math.abs(i.lng-n.center.lng)<o)&&(e=i)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const YC={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class KC extends At{constructor(e,n){if(super(),(e instanceof t.HTMLElement||n)&&(e=N({element:e},n)),V(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=v.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ht("div");const t=41,n=27,r=dt("svg",{display:"block",height:t*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${t}`},this._element),i=dt("radialGradient",{id:"shadowGradient"},dt("defs",{},r));dt("stop",{offset:"10%","stop-opacity":.4},i),dt("stop",{offset:"100%","stop-opacity":.05},i),dt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),dt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),dt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),dt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=v.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const r=this._element.classList;for(const e in YC)r.remove(`mapboxgl-marker-anchor-${e}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const i=e&&e.className?e.className.trim().split(/\s+/):[];r.add(...i),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=Bd.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,r=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const n=e.unproject(t),r=e.getFreeCameraOptions();if(!r.position)return!1;const i=r.position.toLngLat();return i.distanceTo(n)<.9*i.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const t=this._pos;if(!t||t.x<0||t.x>e.transform.width||t.y<0||t.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(t);let r;e._showingGlobe()&&Rd(e.transform,this._lngLat)?r=0:(r=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${YC[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const e=this._pos,t=this._map,n=this.getPitchAlignment();if(!t||!e||"map"!==n)return"";if(!t._showingGlobe()){const e=t.getPitch();return e?`rotateX(${e}deg)`:""}const r=S(Pd(t.transform,this._lngLat)),i=e.sub(Id(t.transform)),o=Math.abs(i.x)+Math.abs(i.y);if(0===o)return"";const s=r/o;return`rotateX(${-i.y*s}deg) rotateY(${i.x*s}deg)`}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let n=0;const r=this.getRotationAlignment();if("map"===r)if(t._showingGlobe()){const e=t.project(new Bd(this._lngLat.lng,this._lngLat.lat+.001)),r=t.project(new Bd(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=S(Math.atan2(r.y,r.x))-90}else n=-t.getBearing();else if("horizon"===r){const r=R(4,6,t.getZoom()),i=Id(t.transform);i.y+=r*t.transform.height;const o=e.sub(i),s=S(Math.atan2(o.y,o.x));n=(s>90?s-270:s+90)*(1-r)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(e){t.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=XC(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=t.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),n._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=v.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){const t=this._map;if(!t)return;const n=this._pointerdownPos,r=this._positionDelta;if(n&&r){if(!this._isDragging){const r=this._clickTolerance||t._clickTolerance;if(e.point.dist(n)<r)return;this._isDragging=!0}this._pos=e.point.sub(r),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new Tt("dragstart"))),this.fire(new Tt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new Tt("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,n=this._pos;t&&n&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(n),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const JC={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},QC=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eA(e=new v(0,0),t="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new v(0,e);case"top-left":return new v(n,n);case"top-right":return new v(-n,n);case"bottom":return new v(0,-e);case"bottom-left":return new v(n,-n);case"bottom-right":return new v(-n,-n);case"left":return new v(e,0);case"right":return new v(-e,0)}return new v(0,0)}return e instanceof v||Array.isArray(e)?v.convert(e):v.convert(e[t]||[0,0])}class tA{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const t=E((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-t)+this._end*t}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,n){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+n}}const nA={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},iA={showCompass:!0,showZoom:!0,visualizePitch:!1};class oA{constructor(e,t,n=!1){this._clickTolerance=10,this.element=t,this.mouseRotate=new yC({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new vC({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),V(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),gt()}move(e,t){const n=this.map,r=this.mouseRotate.mousemoveWindow(e,t),i=r&&r.bearingDelta;if(i&&n.setBearing(n.getBearing()+i),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),i=r&&r.pitchDelta;i&&n.setPitch(n.getPitch()+i)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){yt(),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(N({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),xt(this.element,e)),t.addEventListener("mousemove",this.mousemove),t.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,xt(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=bt(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=bt(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const sA={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},aA={maxWidth:100,unit:"metric"},lA={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},cA={version:n,supported:rt,setRTLTextPlugin:function(e,t,n=!1){if(Ws===Vs||Ws===Gs||Ws===Hs)throw new Error("setRTLTextPlugin cannot be called multiple times.");$s=ut.resolveURL(e),Ws=Vs,Zs=t,Xs(),n||Js()},getRTLTextPluginStatus:Ks,Map:class extends ZC{constructor(e){if(Qe.mark(Je.create),null!=(e=N({},rA,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==te){const t=e.navigator?e.navigator.userAgent:null;te=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return te}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(t)&&(e.antialias=!1,q("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mx(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new qC,this._domRenderTaskQueue=new qC,this._controls=[],this._markers=[],this._popups=[],this._mapId=z(),this._locale=N({},nA,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new Pe(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof t.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&q("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),V(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==t&&(this._fullscreenchangeEvent="onfullscreenchange"in t.document?"fullscreenchange":"webkitfullscreenchange",t.addEventListener("online",this._onWindowOnline,!1),t.addEventListener("resize",this._onWindowResize,!1),t.addEventListener("orientationchange",this._onWindowResize,!1),t.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new GC(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||i.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new qT("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const t=e.bounds;t&&(this.resize(),this.fitBounds(t,N({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new WC({customAttribution:e.customAttribution})),this._logoControl=new $C,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new Tt(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new Tt(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,t){if(void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Ct(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[t];return-1!==t.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Ct(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Tt("movestart",e)).fire(new Tt("move",e)),this.fire(new Tt("resize",e)),t&&this.fire(new Tt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Ql.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Tt("zoomstart")).fire(new Tt("zoom")).fire(new Tt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Tt("zoomstart")).fire(new Tt("zoom")).fire(new Tt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Tt("pitchstart")).fire(new Tt("pitch")).fire(new Tt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Tt("pitchstart")).fire(new Tt("pitch")).fire(new Tt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?t.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?t.navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.clearSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.clearSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,t=e.projection.name;let n;"globe"===t&&e.zoom>=Xh?(e.setMercatorFromTransition(),n=!0):"mercator"===t&&e.zoom<Xh&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t="globe"===e.name&&this.transform.zoom>=Xh?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Bd.convert(e))}unproject(e){return this.transform.pointLocation3D(v.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let r=!1;const i=i=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(i.point,{layers:o}):[];s.length?r||(r=!0,n.call(this,new iC(e,this,i.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:i,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const i=i=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(i.point,{layers:o}):[]).length?r=!0:r&&(r=!1,n.call(this,new iC(e,this,i.originalEvent)))},o=t=>{r&&(r=!1,n.call(this,new iC(e,this,t.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:i,mouseout:o}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),i=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layers:new Set(t),listener:n,delegates:{[e]:r}}}}on(e,t,n){if(void 0===n)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const r=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const e of t)if(!this._isValidId(e))return this;const r=this._createDelegatedListener(e,t,n);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,n){if(void 0===n)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const e of t)if(!this._isValidId(e))return this;const r=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0},i=this._delegatedListeners?this._delegatedListeners[e]:void 0;return i&&(e=>{for(let i=0;i<e.length;i++){const o=e[i];if(o.listener===n&&r(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(i,1),this}}})(i),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(void 0!==t||void 0===e||e instanceof v||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers))for(const e of t.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&q(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(v.convert(e))}setStyle(e,t){return!1!==(t=N({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new WT(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new WT(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(n,ve.Style);we(r,((e,n)=>{e?this.fire(new Ct(e)):n&&this._updateDiff(n,t)}))}else"object"==typeof e&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){q(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(q("There is no style added to the map."),!1)}_isValidId(e){return!function(e){return e.indexOf("")>=0}(e)||(this.fire(new Ct(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,n,{pixelRatio:r=1,sdf:i=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap){const{width:t,height:l,data:c}=ut.getImageData(n);this.style.addImage(e,{data:new Wp({width:t,height:l},c),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new Ct(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:t,height:l}=n,c=n;this.style.addImage(e,{data:new Wp({width:t,height:l},new Uint8Array(c.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}}updateImage(e,n){this._lazyInitEmptyStyle();const r=this.style.getImage(e);if(!r)return void this.fire(new Ct(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap?ut.getImageData(n):n,{width:o,height:s}=i;void 0!==o&&void 0!==s?o===r.data.width&&s===r.data.height?(r.data.replace(i.data,!(n instanceof t.HTMLImageElement||t.ImageBitmap&&n instanceof t.ImageBitmap)),this.style.updateImage(e,r)):this.fire(new Ct(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new Ct(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Ct(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,n){Ae(this._requestManager.transformRequest(e,ve.Image),((e,r)=>{n(e,r instanceof t.HTMLImageElement?ut.getImageData(r):r)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Ct(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t,n={}){return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n,r={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n,r={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Bd.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let r,i,o,s=this._container;for(;s&&(!i||!o);){const e=t.getComputedStyle(s).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(i=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),s=s.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=o?Math.abs(n/o):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&q("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=ht("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ht("div","mapboxgl-canvas-container",e);this._canvas=ht("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=ht("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=ht("div",`mapboxgl-ctrl-${e}`,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=ut.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const e=N({},rt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(Ke(t,!0),this.painter=new PT(t,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),o.testSupport(t)):this.fire(new Ct(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Tt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Tt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let n;this.fire(new Tt("renderstart"));const r=this.painter.context.extTimerQuery,i=ut.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=o.createQuery(),o.beginQuery(r.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],t.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],t.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,t=this.transform.pitch,n=ut.now(),r=new ea(e,{now:n,fadeDuration:s,pitch:t,transition:this.style.transition});this.style.update(r)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Tt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Tt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const e=ut.now()-i;o.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const r=o.getQueryParameter(n,o.QUERY_RESULT)/1e6;o.deleteQuery(n),this.fire(new Tt("gpu-timing-frame",{cpuTime:e,gpuTime:r})),t.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:r}})}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const t=this.painter.queryGpuTimers(e);this.fire(new Tt("gpu-timing-layer",{layerTimes:t}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const t=this.painter.queryGpuTimeDeferredRender(e);this.fire(new Tt("gpu-timing-deferred-render",{gpuTime:t}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(i,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new Tt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new Tt("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,Qe.mark(Je.fullLoad),this._performanceMetricsCollection&&$e(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const n=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-i);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(i),n(i);this._averageElevation.easeTo(i,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(i),n(i)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){Xe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===Ie||401===e.status)){const e=this.painter.context.gl;Ke(e,!1),this._logoControl instanceof $C&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Ct(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Ze(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,r=n.createFramebuffer();function i(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);const t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,n){let r=n[1]-n[0];const i=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);r+=(n[o+2]-n[o+1])*(1-a/i)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t&&(t.removeEventListener("resize",this._onWindowResize,!1),t.removeEventListener("orientationchange",this._onWindowResize,!1),t.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),t.removeEventListener("online",this._onWindowOnline,!1),t.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ye.delete(this.painter.context.gl),this._removed=!0,this.fire(new Tt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ut.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(e){return D(this.style?Object.values(this.style._sourceCaches):[],((t,n)=>t._preloadTiles(e,n)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===t.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){!function(e,t){he=e,de=t}(e,t)}get version(){return n}},NavigationControl:class{constructor(e){this.options=N({},iA,e),this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(V(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),ht("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),ht("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(V(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=ht("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new oA(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=ht("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends At{constructor(e){super(),this.options=N({geolocation:t.navigator.geolocation},sA,e),V(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=$T(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const n=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.navigator.permissions?t.navigator.permissions.query({name:"geolocation"}).then((e=>n("denied"!==e.state))).catch((()=>n())):n()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Tt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Tt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new Bd(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=N({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),r,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new Bd(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=Zd(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Tt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ht("button","mapboxgl-ctrl-geolocate",this._container),ht("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){q("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ht("div","mapboxgl-user-location"),this._dotElement.appendChild(ht("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ht("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new KC({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ht("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new KC({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Tt("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return q("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Tt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Tt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Tt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.addEventListener("ondeviceorientationabsolute"in t?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.DeviceMotionEvent&&"function"==typeof t.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.removeEventListener("deviceorientation",this._onDeviceOrientation),t.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:WC,ScaleControl:class{constructor(e){this.options=N({},aA,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),V(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,r=t._containerWidth/2-e/2,i=t.unproject([r,n]),o=t.unproject([r+e,n]),s=i.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*s;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask((()=>{const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(t),i=r/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==n?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(r):`${r}&nbsp;${lA[n]}`,this._container.style.width=e*i+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=ht("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.HTMLElement?this._container=e.container:q("Full screen control 'container' must be a DOM element.")),V(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=ht("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",q("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.document.fullscreenEnabled&&!t.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=ht("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ht("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.document.fullscreenElement||t.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.document.exitFullscreen?t.document.exitFullscreen():t.document.webkitCancelFullScreen&&t.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends At{constructor(e){super(),this.options=N(Object.create(JC),e),V(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Tt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Tt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Bd.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.document.createTextNode(e))}setHTML(e){const n=t.document.createDocumentFragment(),r=t.document.createElement("body");let i;for(r.innerHTML=e;i=r.firstChild,i;)n.appendChild(i);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ht("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=ht("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,r=this._pos;if(!t||!n||!r)return"bottom";const i=n.offsetWidth,o=n.offsetHeight,s=r.x<i/2,a=r.x>t.transform.width-i/2;if(r.y+e<o)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=ht("div","mapboxgl-popup",t.getContainer()),this._tip=ht("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=XC(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const n=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),r=eA(this.options.offset),i=this._anchor=this._getAnchor(r.y),o=eA(this.options.offset,i),s=n.add(o).round();t._requestDomTask((()=>{this._container&&i&&(this._container.style.transform=`${YC[i]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const e=Rd(t.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(QC);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:KC,Style:WT,LngLat:Bd,LngLatBounds:Ql,Point:v,MercatorCoordinate:ep,FreeCameraOptions:j_,Evented:At,config:i,prewarm:function(){Uw().acquire(Fw)},clearPrewarmedResources:function(){const e=Bw;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Fw),Bw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return i.ACCESS_TOKEN},set accessToken(e){i.ACCESS_TOKEN=e},get baseApiUrl(){return i.API_URL},set baseApiUrl(e){i.API_URL=e},get workerCount(){return zw.workerCount},set workerCount(e){zw.workerCount=e},get maxParallelImageRequests(){return i.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){i.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){!function(e){if(!pe())return;const n=t.caches.delete(le);e&&n.catch(e).then((()=>e()))}(e)},workerUrl:"",workerClass:null,get dracoUrl(){return Zw()},set dracoUrl(e){!function(e){Vw=ut.resolveURL(e),Hw||(Hw=new gw(Uw(),new At)),Hw.broadcast("setDracoUrl",Vw)}(e)},setNow:ut.setNow,restoreNow:ut.restoreNow};e.A=mw,e.D=Vm,e.E=ar,e.F=Zm,e.K=dM,e.O=Fh,e.P=v,e.T=Fx,e.V=nm,e.a=Gf,e.b=sm,e.c=Kb,e.d=class extends At{constructor(e,t,n,r,i,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=i||Lw,this.loading={},this.loaded={},this.deduped=new Rw(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler,this.brightness=o}loadTile(e,t){const n=e.uid,r=e&&e.request,i=r&&r.collectResourceTiming,o=this.loading[n]=new Iw(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[n];if(delete this.loading[n],l||s||!a)return o.status="done",l||(this.loaded[n]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new tm(new Cm(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,n)=>{if(e||!n)return t(e);const o={};if(i){const e=nt(r);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,N({rawTileData:c.slice(0)},n,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[n]=o}))}reloadTile(e,t){const n=this.loaded,r=e.uid,i=this;if(n&&n[r]){const o=n[r];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=Sy(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;const s=(e,n)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,r)),t(e,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const n=e.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}},e.e=_o,e.f=nt,e.g=d,e.h=we,e.i=Se,e.j=function(e,t){const n=gS(e);for(const e of n){for(const t of e.meshes)yS(t);e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(vS(e.lights,t)))}return n},e.k=ea,e.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==eS){const n=new Uint32Array(e,0,7),[,,r,i,o,s]=n;t=n.byteLength+i+o+s+o,(r!==e.byteLength||t>=e.byteLength)&&q("Invalid b3dm header information.")}return sS(e,t)},e.m=$y,e.n=Qs,e.o=Tt,e.p=g,e.q=function(e){fe(),ce&&ce.then((t=>{t.keys().then((n=>{for(let r=0;r<n.length-e;r++)t.delete(n[r])}))}))},e.r=TS,e.s=cA,e.t=Qd,e.v=O,e.w=t})),r(0,(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let n="[";for(const r of e)n+=`${t(r)},`;return`${n}]`}let n="{";for(const r of Object.keys(e).sort())n+=`${r}:${t(e[r])},`;return`${n}}`}function n(n){let r="";for(const i of e.r)r+=`/${t(n[i])}`;return r}class r{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,r,i){this._options=i;for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.c(n,this._options);t.setScope(this.scope),t.compileFilter(),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const r={};for(let i=0;i<e.length;i++){const o=t&&t[e[i].id]||n(e[i]);t&&(t[e[i].id]=o);let s=r[o];s||(s=r[o]=[]),s.push(e[i])}const i=[];for(const e in r)i.push(r[e]);return i}(e.v(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=i[o];s||(s=i[o]=[]),s.push(t)}}}class i{loadTile(t,n){const{uid:r,encoding:i,rawImageData:o,padding:s}=t,a=e.w.ImageBitmap&&o instanceof e.w.ImageBitmap?this.getImageData(o,s):o;n(null,new e.D(r,a,i,t.convertToFloat,s<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}function o(e,t){if(0!==e.length){s(e[0],t);for(var n=1;n<e.length;n++)s(e[n],!t)}}function s(e,t){for(var n=0,r=0,i=0,o=e.length,s=o-1;i<o;s=i++){var a=(e[i][0]-e[s][0])*(e[s][1]+e[i][1]),l=n+a;r+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+r>=0!=!!t&&e.reverse()}var a=e.g((function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)o(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)o(t.coordinates[r],n);return t}));const l=e.V.prototype.toGeoJSON;var c={exports:{}},u=e.p,h=e.a.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],r=[],i=0;i<n.length;i++)r.push(new u(n[i][0],n[i][1]));this.geometry.push(r)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),n=Math.max(n,l.x),r=Math.min(r,l.y),i=Math.max(i,l.y)}return[t,r,n,i]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=e.b,g=d;function y(e){var t=new m;return function(e,t){for(var n in e.layers)t.writeMessage(3,v,e.layers[n])}(e,t),t.finish()}function v(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,_,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)t.writeMessage(4,M,o[n])}function _(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,x,e),t.writeVarintField(3,n.type),t.writeMessage(4,S,n)}function x(e,t){var n=e.feature,r=e.keys,i=e.values,o=e.keycache,s=e.valuecache;for(var a in n.properties){var l=n.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(i.push(l),s[h]=d=i.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function S(e,t){for(var n=e.loadGeometry(),r=e.type,i=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===r&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&t.writeVarint(b(2,u-1));var d=l[h].x-i,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),i+=d,o+=p}3===r&&t.writeVarint(b(7,1))}}function M(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}c.exports=y,c.exports.fromVectorTileJs=y,c.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var r in e)n[r]=new g(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return y({layers:n})},c.exports.GeoJSONWrapper=g;var E=e.g(c.exports);const T={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},C=Math.fround||(A=new Float32Array(1),e=>(A[0]=+e,A[0]));var A;const I=3,P=5,R=6;class L{constructor(e){this.options=Object.assign(Object.create(T),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:r}=this.options;t&&console.time("total time");const i=`prepare ${e.length} points`;t&&console.time(i),this.points=e;const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(!n.geometry)continue;const[r,i]=n.geometry.coordinates,s=C(N(r)),a=C(k(i));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(i);for(let e=r;e>=n;e--){const n=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){const e=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(N(n),k(o),N(i),k(r)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+P]>1?D(l,t,this.clusterProps):this.points[l[t+I]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const o=i.data;if(t*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=i.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const n=t*this.stride;o[n+4]===e&&l.push(o[n+P]>1?D(o,n,this.clusterProps):this.points[o[n+I]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,n){const r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r}getTile(e,t,n){const r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/i,c=(n+1+a)/i,u={features:[]};return this._addTileFeatures(r.range((t-a)/i,l,(t+1+a)/i,c),r.data,t,n,i,u),0===t&&this._addTileFeatures(r.range(1-a/i,l,1,c),r.data,i,n,i,u),t===i-1&&this._addTileFeatures(r.range(0,l,a/i,c),r.data,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,r,i){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?i+o.point_count<=r?i+=o.point_count:i=this._appendLeaves(e,o.cluster_id,n,r,i):i<r?i++:e.push(t),e.length===n)break}return i}_createTree(t){const n=new e.K(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,r,i,o){for(const s of e){const e=s*this.stride,a=t[e+P]>1;let l,c,u;if(a)l=O(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+I]];l=n.properties;const[r,i]=n.geometry.coordinates;c=N(r),u=k(i)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:l};let d;d=a||this.options.generateId?t[e+I]:this.points[t[e+I]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:r,reduce:i,minPoints:o}=this.options,s=n/(r*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let n=0;n<a.length;n+=c){if(a[n+2]<=t)continue;a[n+2]=t;const r=a[n],u=a[n+1],h=e.within(a[n],a[n+1],s),d=a[n+P];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+P])}if(p>d&&p>=o){let e,o=r*d,s=u*d,f=-1;const m=((n/c|0)<<5)+(t+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+P];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,i&&(e||(e=this._map(a,n,!0),f=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(a,l)))}a[n+4]=m,l.push(o/p,s/p,1/0,m,-1,p),i&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[n+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+P]>1){const r=this.clusterProps[e[t+R]];return n?Object.assign({},r):r}const r=this.points[e[t+I]].properties,i=this.options.map(r);return n&&i===r?Object.assign({},i):i}}function D(e,t,n){return{type:"Feature",id:e[t+I],properties:O(e,t,n),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),F(e[t+1])]}};var r}function O(e,t,n){const r=e[t+P],i=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+R],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+I],point_count:r,point_count_abbreviated:i})}function N(e){return e/360+.5}function k(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function F(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var z={exports:{}};z.exports=function(){function e(n,r,i,o){for(var s,a=o,l=i-r>>1,c=i-r,u=n[r],h=n[r+1],d=n[i],p=n[i+1],f=r+3;f<i;f+=3){var m=t(n[f],n[f+1],u,h,d,p);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-r>3&&e(n,r,s,o),n[s+2]=a,i-s>3&&e(n,s,i,o))}function t(e,t,n,r,i,o){var s=i-n,a=o-r;if(0!==s||0!==a){var l=((e-n)*s+(t-r)*a)/(s*s+a*a);l>1?(n=i,r=o):l>0&&(n+=s*l,r+=a*l)}return(s=e-n)*s+(a=t-r)*a}function n(e,t,n,i){var o={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)r(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)r(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var o=0;o<t[i].length;o++)r(e,t[i][o])}(o),o}function r(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function i(e,t,r,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),d=[],p=t.id;if(r.promoteId?p=t.properties[r.promoteId]:r.generateId&&(p=l||0),"Point"===u)o(c,d);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],d);else if("LineString"===u)s(c,d,h,!1);else if("MultiLineString"===u){if(r.lineMetrics){for(f=0;f<c.length;f++)s(c[f],d=[],h,!1),e.push(n(p,"LineString",d,t.properties));return}a(c,d,h,!1)}else if("Polygon"===u)a(c,d,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<t.geometry.geometries.length;f++)i(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},r,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),d.push(m)}}e.push(n(p,u,d,t.properties))}}function o(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function s(t,n,r,i){for(var o,s,a=0,u=0;u<t.length;u++){var h=l(t[u][0]),d=c(t[u][1]);n.push(h),n.push(d),n.push(0),u>0&&(a+=i?(o*d-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(d-s,2))),o=h,s=d}var p=n.length-3;n[2]=1,e(n,0,p,r),n[p+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function a(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];s(e[i],o,n,r),t.push(o)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function u(e,t,r,i,o,s,a,l){if(i/=t,s>=(r/=t)&&a<i)return e;if(a<r||s>=i)return null;for(var c=[],u=0;u<e.length;u++){var p=e[u],m=p.geometry,g=p.type,y=0===o?p.minX:p.minY,v=0===o?p.maxX:p.maxY;if(y>=r&&v<i)c.push(p);else if(!(v<r||y>=i)){var _=[];if("Point"===g||"MultiPoint"===g)h(m,_,r,i,o);else if("LineString"===g)d(m,_,r,i,o,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,_,r,i,o,!1);else if("Polygon"===g)f(m,_,r,i,o,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,r,i,o,!0),b.length&&_.push(b)}if(_.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<_.length;x++)c.push(n(p.id,g,_[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===_.length?(g="LineString",_=_[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===_.length?"Point":"MultiPoint"),c.push(n(p.id,g,_,p.tags))}}}return c.length?c:null}function h(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=n&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function d(e,t,n,r,i,o,s){for(var a,l,c=p(e),u=0===i?g:y,h=e.start,d=0;d<e.length-3;d+=3){var f=e[d],v=e[d+1],_=e[d+2],x=e[d+3],b=e[d+4],w=0===i?f:v,S=0===i?x:b,M=!1;s&&(a=Math.sqrt(Math.pow(f-x,2)+Math.pow(v-b,2))),w<n?S>n&&(l=u(c,f,v,x,b,n),s&&(c.start=h+a*l)):w>r?S<r&&(l=u(c,f,v,x,b,r),s&&(c.start=h+a*l)):m(c,f,v,_),S<n&&w>=n&&(l=u(c,f,v,x,b,n),M=!0),S>r&&w<=r&&(l=u(c,f,v,x,b,r),M=!0),!o&&M&&(s&&(c.end=h+a*l),t.push(c),c=p(e)),s&&(h+=a)}var E=e.length-3;f=e[E],v=e[E+1],_=e[E+2],(w=0===i?f:v)>=n&&w<=r&&m(c,f,v,_),E=c.length-3,o&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,n,r,i,o){for(var s=0;s<e.length;s++)d(e[s],t,n,r,i,o,!1)}function m(e,t,n,r){e.push(t),e.push(n),e.push(r)}function g(e,t,n,r,i,o){var s=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*s),e.push(1),s}function y(e,t,n,r,i,o){var s=(o-n)/(i-n);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function v(e,t){for(var r=[],i=0;i<e.length;i++){var o,s=e[i],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=_(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(_(s.geometry[l],t))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(_(s.geometry[l][u],t));o.push(c)}r.push(n(s.id,a,o,s.tags))}return r}function _(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function x(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(b(c[r],c[r+1],t,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(b(c[r][i],c[r][i+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function b(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function w(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,S(s,e[a],o,i);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function S(e,t,n,r){var i=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)M(s,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)M(s,i[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++){var c=i[l];for(a=0;a<c.length;a++)M(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function M(e,t,n,r,i,o){var s=r*r;if(r>0&&t.size<(i?s:r))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=s,e[i-1-r]=a}}(a,o),e.push(a)}}function E(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)i(n,e.features[r],t,r);else i(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=u(e,1,-1-n,n,0,-1,2,t),o=u(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=u(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=v(i,1).concat(r)),o&&(r=r.concat(v(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function T(e,t,n){return 32*((1<<e)*n+t)+e}return E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(e,t,n,r,i,o,s){for(var a=[e,t,n,r],l=this.options,c=l.debug;a.length;){r=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var h=1<<t,d=T(t,n,r),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,i){if(t===l.maxZoom||t===i)continue;var m=1<<i-t;if(n!==Math.floor(o/m)||r!==Math.floor(s/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var g,y,v,_,x,b,S=.5*l.buffer/l.extent,M=.5-S,E=.5+S,C=1+S;g=y=v=_=null,x=u(e,h,n-S,n+E,0,p.minX,p.maxX,l),b=u(e,h,n+M,n+C,0,p.minX,p.maxX,l),e=null,x&&(g=u(x,h,r-S,r+E,1,p.minY,p.maxY,l),y=u(x,h,r+M,r+C,1,p.minY,p.maxY,l),x=null),b&&(v=u(b,h,r-S,r+E,1,p.minY,p.maxY,l),_=u(b,h,r+M,r+C,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*n,2*r),a.push(y||[],t+1,2*n,2*r+1),a.push(v||[],t+1,2*n+1,2*r),a.push(_||[],t+1,2*n+1,2*r+1)}}},E.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var s=1<<e,a=T(e,t=(t%s+s)%s,n);if(this.tiles[a])return x(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[T(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?x(this.tiles[a],i):null):null},function(e,t){return new E(e,t)}}();var B=e.g(z.exports);function U(t,n){const r=t.tileID.canonical;if(!this._geoJSONIndex)return n(null,null);const i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return n(null,null);const o=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.E,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.E,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const r=[];for(const t of n)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,n){return l.call(this,e,t,n)}}(this._features[t])}}(i.features);let s=E(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),n(null,{vectorTile:o,rawData:s.buffer})}class j extends e.d{constructor(e,t,n,r,i,o){super(e,t,n,r,U,o),i&&(this.loadGeoJSON=i)}loadData(t,n){const r=t&&t.request,i=r&&r.collectResourceTiming;this.loadGeoJSON(t,((o,s)=>{if(o||!s)return n(o);if("object"!=typeof s)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{a(s,!0);try{if(t.filter){const n=e.e(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=s.features.filter((e=>n.value.evaluate({zoom:0},e)));s={type:"FeatureCollection",features:r}}this._geoJSONIndex=t.cluster?new L(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const r={},i={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const t of a){const[o,s]=n[t],a=e.e(s),l=e.e("string"==typeof o?[o,["accumulated"],["get",t]]:o);r[t]=a.value,i[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=r[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=i[t].evaluate(o,s)},t}(t)).load(s.features):B(s,t.geojsonVtOptions)}catch(o){return n(o)}this.loaded={};const l={};if(i){const n=e.f(r);n&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(n)))}n(null,l)}}))}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,n){if(t.request)e.h(t.request,n);else{if("string"!=typeof t.data)return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class V{constructor(t,n){this.tileID=new e.O(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=n}parse(t,n,r,i){this.status="parsing";const o=new e.O(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),s={},a=n.familiesBySource[r.source],l=new e.F(o,r.promoteId);return l.bucketLayerIDs=[],e.l(t).then((t=>{if(!t)return i(new Error("Could not parse tile"));const n=e.j(t,1/e.t(r.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features"),u=new e.k(this.zoom,{brightness:this.brightness});for(const r in a)for(const i of a[r]){const r=i[0],a=t.json.extensionsUsed;r.recalculate(u,[]);const l=new e.T(n,o,a&&a.includes("MAPBOX_mesh_features"),this.brightness);c||(l.needsUpload=!0),s[r.fqid]=l,l.evaluate(r)}this.status="done",i(null,{buckets:s,featureIndex:l})})).catch((e=>i(new Error(e.message))))}}class G{constructor(e,t,n,r,i,o){this.actor=e,this.layerIndex=t,this.brightness=o,this.loading={},this.loaded={}}loadTile(t,n){const r=t.uid,i=this.loading[r]=new V(t,this.brightness);e.i(t.request,((e,o)=>{const s=!this.loading[r];return delete this.loading[r],s||e?(i.status="done",s||(this.loaded[r]=i),n(e)):o&&0!==o.byteLength?void i.parse(o,this.layerIndex,t,((e,t)=>{i.status="done",this.loaded=this.loaded||{},this.loaded[r]=i,e||!t?n(e):n(null,t)})):(i.status="done",this.loaded[r]=i,n())}))}reloadTile(e,t){const n=this.loaded,r=e.uid;if(n&&n[r]){const i=n[r];i.projection=e.projection,i.brightness=e.brightness;const o=(n,r)=>{i.reloadCallback&&(delete i.reloadCallback,this.loadTile(e,t)),t(n,r)};"parsing"===i.status?i.reloadCallback=o:"done"===i.status&&this.loadTile(e,t)}}abortTile(e,t){const n=e.uid;this.loading[n]&&delete this.loading[n],t()}removeTile(e,t){const n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}}class H{constructor(t){this.self=t,this.actor=new e.A(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.m({name:"mercator"}),this.workerSourceTypes={vector:e.d,geojson:j,"batched-model":G},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.n.isParsed())throw new Error("RTL text plugin already registered.");e.n.applyArabicShaping=t.applyArabicShaping,e.n.processBidirectionalText=t.processBidirectionalText,e.n.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,{scope:n,isLoaded:r}){if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][n]=r,this.workerSources[t]&&this.workerSources[t][n])for(const i in this.workerSources[t][n]){const o=this.workerSources[t][n][i];for(const t in o)o[t]instanceof e.d&&(o[t].isSpriteLoaded=r,o[t].fire(new e.o("isSpriteLoaded")))}}setImages(e,{scope:t,images:n},r){if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][t]=n,this.workerSources[e]&&this.workerSources[e][t]){for(const r in this.workerSources[e][t]){const i=this.workerSources[e][t][r];for(const e in i)i[e].availableImages=n}r()}else r()}setProjection(t,n){this.projections[t]=e.m(n)}setBrightness(e,t,n){this.brightness=t,n()}setLayers(e,t,n){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),n()}updateLayers(e,t,n){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),n()}loadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,n)}loadDEMTile(e,t,n){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,n)}reloadTile(e,t,n){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,n)}removeSource(e,t,n){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const r=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}syncRTLPluginState(t,n,r){try{e.n.setState(n);const t=e.n.getPluginURL();if(e.n.isLoaded()&&!e.n.isParsed()&&null!=t){this.self.importScripts(t);const n=e.n.isParsed();r(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),n)}}catch(e){r(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let n=this.availableImages[e][t];return n||(n=[]),n}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let n=this.layerIndexes[e][t];return n||(n=this.layerIndexes[e][t]=new r,n.scope=t),n}getWorkerSource(e,t,n,r){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),this.workerSources[e][r][t]||(this.workerSources[e][r][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][r][t][n]){const i={send:(t,n,r,i,o,s)=>{this.actor.send(t,n,r,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][r][t][n]=new this.workerSourceTypes[t](i,this.getLayerIndex(e,r),this.getAvailableImages(e,r),this.isSpriteLoaded[e][r],void 0,this.brightness)}return this.workerSources[e][r][t][n]}getDEMWorkerSource(e,t,n){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][n]||(this.demWorkerSources[e][n]={}),this.demWorkerSources[e][n][t]||(this.demWorkerSources[e][n][t]=new i),this.demWorkerSources[e][n][t]}enforceCacheSizeLimit(t,n){e.q(n)}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new H(self)),H})),r(0,(function(e){return e.s})),n}()},434:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4836:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},7071:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},7462:(e,t,n)=>{"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(null,arguments)}n.d(t,{Z:()=>r})},3366:(e,t,n)=>{"use strict";function r(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}n.d(t,{Z:()=>r})},4146:(e,t,n)=>{"use strict";function r(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}n.d(t,{Z:()=>i});const i=function(){for(var e,t,n=0,i="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);i.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,i.d(o,s),o},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e=i(7313),t=i.t(e,2),n=i(6377),r=e,o=Symbol.for("react-redux-context"),s="undefined"!=typeof globalThis?globalThis:{};function a(){if(!r.createContext)return{};const e=s[o]??(s[o]=new Map);let t=e.get(r.createContext);return t||(t=r.createContext(null),e.set(r.createContext,t)),t}var l=a(),c=Symbol.for("react.element"),u=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.context"),g=Symbol.for("react.server_context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),w=(Symbol.for("react.offscreen"),Symbol.for("react.client.reference"),y),S=x;function M(e,t,n,r,i){let o,s,a,l,c,{areStatesEqual:u,areOwnPropsEqual:h,areStatePropsEqual:d}=i,p=!1;return function(i,f){return p?function(i,p){const f=!h(p,s),m=!u(i,o,p,s);return o=i,s=p,f&&m?(a=e(o,s),t.dependsOnOwnProps&&(l=t(r,s)),c=n(a,l,s),c):f?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(l=t(r,s)),c=n(a,l,s),c):m?function(){const t=e(o,s),r=!d(t,a);return a=t,r&&(c=n(a,l,s)),c}():c}(i,f):(o=i,s=f,a=e(o,s),l=t(r,s),c=n(a,l,s),p=!0,c)}}function E(e){return function(t){const n=e(t);function r(){return n}return r.dependsOnOwnProps=!1,r}}function T(e){return e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function C(e,t){return function(t,n){let{displayName:r}=n;const i=function(e,t){return i.dependsOnOwnProps?i.mapToProps(e,t):i.mapToProps(e,void 0)};return i.dependsOnOwnProps=!0,i.mapToProps=function(t,n){i.mapToProps=e,i.dependsOnOwnProps=T(e);let r=i(t,n);return"function"==typeof r&&(i.mapToProps=r,i.dependsOnOwnProps=T(r),r=i(t,n)),r},i}}function A(e,t){return(n,r)=>{throw new Error(`Invalid value of type ${typeof e} for ${t} argument when connecting component ${r.wrappedComponentName}.`)}}function I(e,t,n){return{...n,...e,...t}}var P={notify(){},get:()=>[]};function R(e,t){let n,r=P,i=0,o=!1;function s(){c.onStateChange&&c.onStateChange()}function a(){i++,n||(n=t?t.addNestedSub(s):e.subscribe(s),r=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){(()=>{let t=e;for(;t;)t.callback(),t=t.next})()},get(){let t=[],n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0,i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function l(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=P)}const c={addNestedSub:function(e){a();const t=r.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),l())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:s,isSubscribed:function(){return o},trySubscribe:function(){o||(o=!0,a())},tryUnsubscribe:function(){o&&(o=!1,l())},getListeners:()=>r};return c}var L="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?r.useLayoutEffect:r.useEffect;function D(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function O(e,t){if(D(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!D(e[n[r]],t[n[r]]))return!1;return!0}var N={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},k={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},F={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},z={[w]:{$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},[S]:F};function B(e){return function(e){if("object"==typeof e&&null!==e){const t=e.$$typeof;switch(t){case c:{const n=e.type;switch(n){case h:case p:case d:case v:case _:return n;default:{const e=n&&n.$$typeof;switch(e){case g:case m:case y:case b:case x:case f:return e;default:return t}}}}case u:return t}}}(e)===x?F:z[e.$$typeof]||N}var U=Object.defineProperty,j=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,G=Object.getOwnPropertyDescriptor,H=Object.getPrototypeOf,Z=Object.prototype;function W(e,t){if("string"!=typeof t){if(Z){const n=H(t);n&&n!==Z&&W(e,n)}let n=j(t);V&&(n=n.concat(V(t)));const r=B(e),i=B(t);for(let o=0;o<n.length;++o){const s=n[o];if(!(k[s]||i&&i[s]||r&&r[s])){const n=G(t,s);try{U(e,s,n)}catch(e){}}}}return e}var $=()=>{throw new Error("uSES not initialized!")},q=[null,null];function X(e,t,n,r,i,o){e.current=r,n.current=!1,i.current&&(i.current=null,o())}function Y(e,t){return e===t}var K=function(e,t,n){let{pure:i,areStatesEqual:o=Y,areOwnPropsEqual:s=O,areStatePropsEqual:a=O,areMergedPropsEqual:c=O,forwardRef:u=!1,context:h=l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const d=h,p=function(e){return e?"function"==typeof e?C(e):A(e,"mapStateToProps"):E((()=>({})))}(e),f=function(e){return e&&"object"==typeof e?E((t=>function(e,t){const n={};for(const r in e){const i=e[r];"function"==typeof i&&(n[r]=function(){return t(i(...arguments))})}return n}(e,t))):e?"function"==typeof e?C(e):A(e,"mapDispatchToProps"):E((e=>({dispatch:e})))}(t),m=function(e){return e?"function"==typeof e?function(e){return function(t,n){let r,{displayName:i,areMergedPropsEqual:o}=n,s=!1;return function(t,n,i){const a=e(t,n,i);return s?o(a,r)||(r=a):(s=!0,r=a),r}}}(e):A(e,"mergeProps"):()=>I}(n),g=Boolean(e);return e=>{const t=e.displayName||e.name||"Component",n=`Connect(${t})`,i={shouldHandleStateChanges:g,displayName:n,wrappedComponentName:t,WrappedComponent:e,initMapStateToProps:p,initMapDispatchToProps:f,initMergeProps:m,areStatesEqual:o,areStatePropsEqual:a,areOwnPropsEqual:s,areMergedPropsEqual:c};function l(t){const[n,o,s]=r.useMemo((()=>{const{reactReduxForwardedRef:e,...n}=t;return[t.context,e,n]}),[t]),a=r.useMemo((()=>{let e=d;return n?.Consumer,e}),[n,d]),l=r.useContext(a),c=Boolean(t.store)&&Boolean(t.store.getState)&&Boolean(t.store.dispatch),u=Boolean(l)&&Boolean(l.store),h=c?t.store:l.store,p=u?l.getServerState:h.getState,f=r.useMemo((()=>function(e,t){let{initMapStateToProps:n,initMapDispatchToProps:r,initMergeProps:i,...o}=t;return M(n(e,o),r(e,o),i(e,o),e,o)}(h.dispatch,i)),[h]),[m,y]=r.useMemo((()=>{if(!g)return q;const e=R(h,c?void 0:l.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[h,c,l]),v=r.useMemo((()=>c?l:{...l,subscription:m}),[c,l,m]),_=r.useRef(),x=r.useRef(s),b=r.useRef(),w=r.useRef(!1),S=(r.useRef(!1),r.useRef(!1)),E=r.useRef();L((()=>(S.current=!0,()=>{S.current=!1})),[]);const T=r.useMemo((()=>()=>b.current&&s===x.current?b.current:f(h.getState(),s)),[h,s]),C=r.useMemo((()=>e=>m?function(e,t,n,r,i,o,s,a,l,c,u){if(!e)return()=>{};let h=!1,d=null;const p=()=>{if(h||!a.current)return;const e=t.getState();let n,p;try{n=r(e,i.current)}catch(e){p=e,d=e}p||(d=null),n===o.current?s.current||c():(o.current=n,l.current=n,s.current=!0,u())};return n.onStateChange=p,n.trySubscribe(),p(),()=>{if(h=!0,n.tryUnsubscribe(),n.onStateChange=null,d)throw d}}(g,h,m,f,x,_,w,S,b,y,e):()=>{}),[m]);var A,I;let P;A=X,I=[x,_,w,s,b,y],L((()=>A(...I)),undefined);try{P=$(C,T,p?()=>f(p(),s):T)}catch(e){throw E.current&&(e.message+=`\nThe error may be correlated with this previous error:\n${E.current.stack}\n\n`),e}L((()=>{E.current=void 0,b.current=void 0,_.current=P}));const D=r.useMemo((()=>r.createElement(e,{...P,ref:o})),[o,e,P]);return r.useMemo((()=>g?r.createElement(a.Provider,{value:v},D):D),[a,D,v])}const h=r.memo(l);if(h.WrappedComponent=e,h.displayName=l.displayName=n,u){const t=r.forwardRef((function(e,t){return r.createElement(h,{...e,reactReduxForwardedRef:t})}));return t.displayName=n,t.WrappedComponent=e,W(t,e)}return W(h,e)}},J=function(e){let{store:t,context:n,children:i,serverState:o,stabilityCheck:s="once",identityFunctionCheck:a="once"}=e;const c=r.useMemo((()=>{const e=R(t);return{store:t,subscription:e,getServerState:o?()=>o:void 0,stabilityCheck:s,identityFunctionCheck:a}}),[t,o,s,a]),u=r.useMemo((()=>t.getState()),[t]);L((()=>{const{subscription:e}=c;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),u!==t.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}}),[c,u]);const h=n||l;return r.createElement(h.Provider,{value:c},i)};n.useSyncExternalStoreWithSelector,(e=>{$=e})(e.useSyncExternalStore);var Q=i(1739);const ee="_global/RESET";function te(){return{type:ee}}var ne=i(738),re=i.n(ne),ie="persist:",oe="persist/FLUSH",se="persist/REHYDRATE",ae="persist/PAUSE",le="persist/PERSIST",ce="persist/PURGE",ue="persist/REGISTER";function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(e,t,n,r){r.debug;var i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(n,!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n);return e&&"object"===he(e)&&Object.keys(e).forEach((function(r){"_persist"!==r&&t[r]===n[r]&&(i[r]=e[r])})),i}function me(e){return JSON.stringify(e)}function ge(e){var t,n=e.transforms||[],r="".concat(void 0!==e.keyPrefix?e.keyPrefix:ie).concat(e.key),i=e.storage;return e.debug,t=!1===e.deserialize?function(e){return e}:"function"==typeof e.deserialize?e.deserialize:ye,i.getItem(r).then((function(e){if(e)try{var r={},i=t(e);return Object.keys(i).forEach((function(e){r[e]=n.reduceRight((function(t,n){return n.out(t,e,i)}),t(i[e]))})),r}catch(e){throw e}}))}function ye(e){return JSON.parse(e)}function ve(e){}function _e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_e(n,!0).forEach((function(t){be(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function we(e,t){var n=void 0!==e.version?e.version:-1,r=(e.debug,void 0===e.stateReconciler?fe:e.stateReconciler),i=e.getStoredState||ge,o=void 0!==e.timeout?e.timeout:5e3,s=null,a=!1,l=!0,c=function(e){return e._persist.rehydrated&&s&&!l&&s.update(e),e};return function(u,h){var d=u||{},p=d._persist,f=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(d,["_persist"]);if(h.type===le){var m=!1,g=function(t,n){m||(h.rehydrate(e.key,t,n),m=!0)};if(o&&setTimeout((function(){!m&&g(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(e.key,'"')))}),o),l=!1,s||(s=function(e){var t,n=e.blacklist||null,r=e.whitelist||null,i=e.transforms||[],o=e.throttle||0,s="".concat(void 0!==e.keyPrefix?e.keyPrefix:ie).concat(e.key),a=e.storage;t=!1===e.serialize?function(e){return e}:"function"==typeof e.serialize?e.serialize:me;var l=e.writeFailHandler||null,c={},u={},h=[],d=null,p=null;function f(){if(0===h.length)return d&&clearInterval(d),void(d=null);var e=h.shift(),n=i.reduce((function(t,n){return n.in(t,e,c)}),c[e]);if(void 0!==n)try{u[e]=t(n)}catch(e){console.error("redux-persist/createPersistoid: error serializing state",e)}else delete u[e];0===h.length&&(Object.keys(u).forEach((function(e){void 0===c[e]&&delete u[e]})),p=a.setItem(s,t(u)).catch(g))}function m(e){return!(r&&-1===r.indexOf(e)&&"_persist"!==e||n&&-1!==n.indexOf(e))}function g(e){l&&l(e)}return{update:function(e){Object.keys(e).forEach((function(t){m(t)&&c[t]!==e[t]&&-1===h.indexOf(t)&&h.push(t)})),Object.keys(c).forEach((function(t){void 0===e[t]&&m(t)&&-1===h.indexOf(t)&&void 0!==c[t]&&h.push(t)})),null===d&&(d=setInterval(f,o)),c=e},flush:function(){for(;0!==h.length;)f();return p||Promise.resolve()}}}(e)),p)return xe({},t(f,h),{_persist:p});if("function"!=typeof h.rehydrate||"function"!=typeof h.register)throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return h.register(e.key),i(e).then((function(t){var r=e.migrate||function(e,t){return Promise.resolve(e)};r(t,n).then((function(e){g(e)}),(function(e){g(void 0,e)}))}),(function(e){g(void 0,e)})),xe({},t(f,h),{_persist:{version:n,rehydrated:!1}})}if(h.type===ce)return a=!0,h.result(function(e){var t=e.storage,n="".concat(void 0!==e.keyPrefix?e.keyPrefix:ie).concat(e.key);return t.removeItem(n,ve)}(e)),xe({},t(f,h),{_persist:p});if(h.type===oe)return h.result(s&&s.flush()),xe({},t(f,h),{_persist:p});if(h.type===ae)l=!0;else if(h.type===se){if(a)return xe({},f,{_persist:xe({},p,{rehydrated:!0})});if(h.key===e.key){var y=t(f,h),v=h.payload,_=xe({},!1!==r&&void 0!==v?r(v,u,y,e):y,{_persist:xe({},p,{rehydrated:!0})});return c(_)}}if(!p)return t(u,h);var x=t(f,h);return x===f?u:c(xe({},x,{_persist:p}))}}function Se(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var Me=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),Ee=()=>Math.random().toString(36).substring(7).split("").join("."),Te={INIT:`@@redux/INIT${Ee()}`,REPLACE:`@@redux/REPLACE${Ee()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Ee()}`};function Ce(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ae(e,t,n){if("function"!=typeof e)throw new Error(Se(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(Se(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(Se(1));return n(Ae)(e,t)}let r=e,i=t,o=new Map,s=o,a=0,l=!1;function c(){s===o&&(s=new Map,o.forEach(((e,t)=>{s.set(t,e)})))}function u(){if(l)throw new Error(Se(3));return i}function h(e){if("function"!=typeof e)throw new Error(Se(4));if(l)throw new Error(Se(5));let t=!0;c();const n=a++;return s.set(n,e),function(){if(t){if(l)throw new Error(Se(6));t=!1,c(),s.delete(n),o=null}}}function d(e){if(!Ce(e))throw new Error(Se(7));if(void 0===e.type)throw new Error(Se(8));if("string"!=typeof e.type)throw new Error(Se(17));if(l)throw new Error(Se(9));try{l=!0,i=r(i,e)}finally{l=!1}return(o=s).forEach((e=>{e()})),e}return d({type:Te.INIT}),{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(Se(10));r=e,d({type:Te.REPLACE})},[Me]:function(){const e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(Se(11));function n(){const e=t;e.next&&e.next(u())}return n(),{unsubscribe:e(n)}},[Me](){return this}}}}}function Ie(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?e=>e:1===t.length?t[0]:t.reduce(((e,t)=>function(){return e(t(...arguments))}))}function Pe(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(n,!0).forEach((function(t){De(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Oe={registry:[],bootstrapped:!1},Ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ue:return Le({},e,{registry:[].concat(Pe(e.registry),[t.key])});case se:var n=e.registry.indexOf(t.key),r=Pe(e.registry);return r.splice(n,1),Le({},e,{registry:r,bootstrapped:0===r.length});default:return e}};const ke="0.1.0",Fe="aime-web-client",ze=ke,Be={config:null,cross:!1,darkTheme:!1},Ue=we({blacklist:["config"],key:`${Fe}_${ze}_config`,storage:re(),version:ze},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Be,{payload:t,type:n}=arguments.length>1?arguments[1]:void 0;switch(n){case"config/SET_CONFIG":return{...e,config:t.config};case"config/SET_CROSS":return{...e,cross:t.cross};case"config/SET_THEME":return{...e,darkTheme:t.theme};case ee:return Be;default:return e}})),je={name:"Dark",image:"/asset/mapStyle/dark.jpg",imageAlt:"Dark map style",key:"DARK",style:"/data/map/dark_no_label.json"},Ve={name:"Positron",image:"/asset/mapStyle/positron.jpg",imageAlt:"Positron map style",key:"POSITRON",style:"/data/map/positron_no_label.json"},Ge=Fe,He=ke,Ze={opacity:1,style:je.key,terrain:!1,globe:!1},We=we({blacklist:[],key:`${Ge}_${He}_map`,storage:re(),version:He},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ze,{payload:t,type:n}=arguments.length>1?arguments[1]:void 0;switch(n){case"map/SET_GLOBE":return{...e,globe:t.globe};case"map/SET_OPACITY":return{...e,opacity:t.opacity};case"map/SET_STYLE":return{...e,style:t.style};case"map/SET_TERRAIN":return{...e,terrain:t.terrain};case ee:return Ze;default:return e}}));var $e=i(6031),qe=i.n($e),Xe=i(658),Ye=i.n(Xe),Ke=i(1635),Je=i.n(Ke);const Qe="widget/INITIALIZE_WIDGET",et="widget/SET_WIDGET_REDUCER_PROPERTY";function tt(e){return{type:et,payload:{widget:e,properties:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}}}}Ye().extend(Je());const nt={widgetData:{},widgets:[],ready:[]};function rt(e){var t;const n=null===(t=qe().maxBy(e.filter((e=>e.opened)),"index"))||void 0===t?void 0:t.key;return e.map((e=>({...e,active:e.key===n})))}function it(e,t){const n=e.find((e=>e.key===t));return rt(e.map((e=>e.index>n.index?e:e.index<n.index?{...e,index:e.index+1}:{...e,index:0,opened:!1})))}function ot(e,t){const n=e.find((e=>e.key===t));return rt(e.map((t=>t.index>n.index?{...t,index:t.index-1}:t.index<n.index?t:{...t,index:e.length,opened:!0})))}const st=we({whitelist:[],key:`${Fe}_${ke}_widget`,storage:re(),version:ke},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nt,{payload:t,type:n}=arguments.length>1?arguments[1]:void 0;switch(n){case"widget/CLOSE_WIDGET":return{...e,widgets:it(e.widgets,t.widget)};case"widget/MOVE_WIDGET":return{...e,widgets:e.widgets.map((e=>e.key===t.widget?{...e,position:t.position}:e))};case"widget/MOVE_WIDGET_ON_TOP":return{...e,widgets:ot(e.widgets,t.widget)};case Qe:const{initialState:n,...r}=t.widget;return{...e,widgets:e.widgets.map((e=>e.key)).includes(r.key)?e.widgets.map((e=>e.key===r.key?{...e,...r}:e)):[...e.widgets,r],widgetData:{...e.widgetData,[r.key]:n},ready:qe().uniq([...e.ready,t.widget.key])};case"widget/OPEN_WIDGET":return{...e,widgets:ot(e.widgets,t.widget)};case et:return{...e,widgetData:{...e.widgetData,[t.widget]:{...e.widgetData[t.widget],...t.properties}}};case"widget/RESIZE_WIDGET":return{...e,widgets:e.widgets.map((e=>e.key===t.widget?{...e,size:t.size}:e))};case"widget/TOGGLE_WIDGET":return function(e,t){const n=e.find((e=>e.key===t));return n.opened&&n.active}(e.widgets,t.widget)?{...e,widgets:it(e.widgets,t.widget)}:{...e,widgets:ot(e.widgets,t.widget)};case ee:return nt;default:return e}}));var at=Symbol.for("immer-nothing"),lt=Symbol.for("immer-draftable"),ct=Symbol.for("immer-state");function ut(e){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var ht=Object.getPrototypeOf;function dt(e){return!!e&&!!e[ct]}function pt(e){return!!e&&(mt(e)||Array.isArray(e)||!!e[lt]||!!e.constructor?.[lt]||xt(e)||bt(e))}var ft=Object.prototype.constructor.toString();function mt(e){if(!e||"object"!=typeof e)return!1;const t=ht(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===ft}function gt(e,t){0===yt(e)?Object.entries(e).forEach((n=>{let[r,i]=n;t(r,i,e)})):e.forEach(((n,r)=>t(r,n,e)))}function yt(e){const t=e[ct];return t?t.type_:Array.isArray(e)?1:xt(e)?2:bt(e)?3:0}function vt(e,t){return 2===yt(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function _t(e,t,n){const r=yt(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function xt(e){return e instanceof Map}function bt(e){return e instanceof Set}function wt(e){return e.copy_||e.base_}function St(e,t){if(xt(e))return new Map(e);if(bt(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&mt(e)){if(!ht(e)){const t=Object.create(null);return Object.assign(t,e)}return{...e}}const n=Object.getOwnPropertyDescriptors(e);delete n[ct];let r=Reflect.ownKeys(n);for(let t=0;t<r.length;t++){const i=r[t],o=n[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(n[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(ht(e),n)}function Mt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Tt(e)||dt(e)||!pt(e)||(yt(e)>1&&(e.set=e.add=e.clear=e.delete=Et),Object.freeze(e),t&&gt(e,((e,t)=>Mt(t,!0)))),e}function Et(){ut(2)}function Tt(e){return Object.isFrozen(e)}var Ct,At={};function It(e){const t=At[e];return t||ut(0),t}function Pt(){return Ct}function Rt(e,t){t&&(It("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Lt(e){Dt(e),e.drafts_.forEach(Nt),e.drafts_=null}function Dt(e){e===Ct&&(Ct=e.parent_)}function Ot(e){return Ct={drafts_:[],parent_:Ct,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Nt(e){const t=e[ct];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function kt(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[ct].modified_&&(Lt(t),ut(4)),pt(e)&&(e=Ft(t,e),t.parent_||Bt(t,e)),t.patches_&&It("Patches").generateReplacementPatches_(n[ct].base_,e,t.patches_,t.inversePatches_)):e=Ft(t,n,[]),Lt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==at?e:void 0}function Ft(e,t,n){if(Tt(t))return t;const r=t[ct];if(!r)return gt(t,((i,o)=>zt(e,r,t,i,o,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return Bt(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,o=!1;3===r.type_&&(i=new Set(t),t.clear(),o=!0),gt(i,((i,s)=>zt(e,r,t,i,s,n,o))),Bt(e,t,!1),n&&e.patches_&&It("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function zt(e,t,n,r,i,o,s){if(dt(i)){const s=Ft(e,i,o&&t&&3!==t.type_&&!vt(t.assigned_,r)?o.concat(r):void 0);if(_t(n,r,s),!dt(s))return;e.canAutoFreeze_=!1}else s&&n.add(i);if(pt(i)&&!Tt(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ft(e,i),t&&t.scope_.parent_||Bt(e,i)}}function Bt(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Mt(t,n)}var Ut={get(e,t){if(t===ct)return e;const n=wt(e);if(!vt(n,t))return function(e,t,n){const r=Gt(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!pt(r)?r:r===Vt(e.base_,t)?(Zt(e),e.copy_[t]=Wt(r,e)):r},has:(e,t)=>t in wt(e),ownKeys:e=>Reflect.ownKeys(wt(e)),set(e,t,n){const r=Gt(wt(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=Vt(wt(e),t),s=r?.[ct];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((i=n)===(o=r)?0!==i||1/i==1/o:i!=i&&o!=o)&&(void 0!==n||vt(e.base_,t)))return!0;Zt(e),Ht(e)}var i,o;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Vt(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Zt(e),Ht(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=wt(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){ut(11)},getPrototypeOf:e=>ht(e.base_),setPrototypeOf(){ut(12)}},jt={};function Vt(e,t){const n=e[ct];return(n?wt(n):e)[t]}function Gt(e,t){if(!(t in e))return;let n=ht(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=ht(n)}}function Ht(e){e.modified_||(e.modified_=!0,e.parent_&&Ht(e.parent_))}function Zt(e){e.copy_||(e.copy_=St(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function Wt(e,t){const n=xt(e)?It("MapSet").proxyMap_(e,t):bt(e)?It("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:Pt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=Ut;n&&(i=[r],o=jt);const{revoke:s,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=s,a}(e,t);return(t?t.scope_:Pt()).drafts_.push(n),n}function $t(e){return dt(e)||ut(10),qt(e)}function qt(e){if(!pt(e)||Tt(e))return e;const t=e[ct];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=St(e,t.scope_.immer_.useStrictShallowCopy_)}else n=St(e,!0);return gt(n,((e,t)=>{_t(n,e,qt(t))})),t&&(t.finalized_=!1),n}gt(Ut,((e,t)=>{jt[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),jt.deleteProperty=function(e,t){return jt.set.call(this,e,t,void 0)},jt.set=function(e,t,n){return Ut.set.call(this,e[0],t,n,e[0])};var Xt=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];return r.produce(e,(e=>t.call(this,e,...o)))}}let r;if("function"!=typeof t&&ut(6),void 0!==n&&"function"!=typeof n&&ut(7),pt(e)){const i=Ot(this),o=Wt(e,void 0);let s=!0;try{r=t(o),s=!1}finally{s?Lt(i):Dt(i)}return Rt(i,n),kt(r,i)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===at&&(r=void 0),this.autoFreeze_&&Mt(r,!0),n){const t=[],i=[];It("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}ut(1)},this.produceWithPatches=(e,n)=>{if("function"==typeof e)return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return t.produceWithPatches(n,(t=>e(t,...i)))};let r,i;const o=this.produce(e,n,((e,t)=>{r=e,i=t}));return[o,r,i]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){pt(e)||ut(8),dt(e)&&(e=$t(e));const t=Ot(this),n=Wt(e,void 0);return n[ct].isManual_=!0,Dt(t),n}finishDraft(e,t){const n=e&&e[ct];n&&n.isManual_||ut(9);const{scope_:r}=n;return Rt(r,t),kt(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=It("Patches").applyPatches_;return dt(e)?r(e,t):this.produce(e,(e=>r(e,t)))}};Xt.produce;Xt.produceWithPatches.bind(Xt),Xt.setAutoFreeze.bind(Xt),Xt.setUseStrictShallowCopy.bind(Xt),Xt.applyPatches.bind(Xt),Xt.createDraft.bind(Xt),Xt.finishDraft.bind(Xt);var Yt=e=>Array.isArray(e)?e:[e];Symbol(),Object.getPrototypeOf({});var Kt="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}},Jt=0,Qt=1;function en(){return{s:Jt,v:void 0,o:null,p:null}}function tn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=en();const{resultEqualityCheck:r}=t;let i,o=0;function s(){let t=n;const{length:s}=arguments;for(let e=0,n=s;e<n;e++){const n=arguments[e];if("function"==typeof n||"object"==typeof n&&null!==n){let e=t.o;null===e&&(t.o=e=new WeakMap);const r=e.get(n);void 0===r?(t=en(),e.set(n,t)):t=r}else{let e=t.p;null===e&&(t.p=e=new Map);const r=e.get(n);void 0===r?(t=en(),e.set(n,t)):t=r}}const a=t;let l;if(t.s===Qt?l=t.v:(l=e.apply(null,arguments),o++),a.s=Qt,r){const e=i?.deref()??i;null!=e&&r(e,l)&&(l=e,0!==o&&o--),i="object"==typeof l&&null!==l||"function"==typeof l?new Kt(l):l}return a.v=l,l}return s.clearCache=()=>{n=en(),s.resetResultsCount()},s.resultsCount=()=>o,s.resetResultsCount=()=>{o=0},s}function nn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i="function"==typeof e?{memoize:e,memoizeOptions:n}:e;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r,o=0,s=0,a={},l=t.pop();"object"==typeof l&&(a=l,l=t.pop()),function(e){if("function"!=typeof e)throw new TypeError(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected a function, instead received "+typeof e)}(l,`createSelector expects an output function after the inputs, but received: [${typeof l}]`);const c={...i,...a},{memoize:u,memoizeOptions:h=[],argsMemoize:d=tn,argsMemoizeOptions:p=[],devModeChecks:f={}}=c,m=Yt(h),g=Yt(p),y=function(e){const t=Array.isArray(e[0])?e[0]:e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected all items to be functions, instead received the following types: ";if(!e.every((e=>"function"==typeof e))){const n=e.map((e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e)).join(", ");throw new TypeError(`${t}[${n}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}(t),v=u((function(){return o++,l.apply(null,arguments)}),...m),_=d((function(){s++;const e=function(e,t){const n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}(y,arguments);return r=v.apply(null,e),r}),...g);return Object.assign(_,{resultFunc:l,memoizedResultFunc:v,dependencies:y,dependencyRecomputations:()=>s,resetDependencyRecomputations:()=>{s=0},lastResult:()=>r,recomputations:()=>o,resetRecomputations:()=>{o=0},memoize:u,argsMemoize:d})}}function rn(e){return t=>{let{dispatch:n,getState:r}=t;return t=>i=>"function"==typeof i?i(n,r,e):t(i)}}var on=rn(),sn=rn,an=(function(){nn(...arguments)}(tn),"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?Ie:Ie.apply(null,arguments)});function ln(e,t){function n(){if(t){let n=t(...arguments);if(!n)throw new Error(mn(0));return{type:e,payload:n.payload,..."meta"in n&&{meta:n.meta},..."error"in n&&{error:n.error}}}return{type:e,payload:arguments.length<=0?void 0:arguments[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>function(e){return Ce(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,n}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var cn=class e extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return super.concat.apply(this,t)}prepend(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return 1===n.length&&Array.isArray(n[0])?new e(...n[0].concat(this)):new e(...n.concat(this))}};var un=e=>t=>{setTimeout(t,e)},hn="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:un(10);var dn=Symbol.for("rtk-slice-createasyncthunk");!function(){let{creators:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e?.asyncThunk?.[dn]}();var{assign:pn}=Object,fn="listenerMiddleware";function mn(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}ln(`${fn}/add`),ln(`${fn}/removeAll`),ln(`${fn}/remove`),Symbol.for("rtk-state-proxy-original");const gn=function(e){const t=function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let o=new cn;return t&&("boolean"==typeof t?o.push(on):o.push(sn(t.extraArgument))),o},{reducer:n,middleware:r,devTools:i=!0,preloadedState:o,enhancers:s}=e||{};let a,l;if("function"==typeof n)a=n;else{if(!Ce(n))throw new Error(mn(1));a=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const i=t[r];"function"==typeof e[i]&&(n[i]=e[i])}const r=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:Te.INIT}))throw new Error(Se(12));if(void 0===n(void 0,{type:Te.PROBE_UNKNOWN_ACTION()}))throw new Error(Se(13))}))}(n)}catch(e){i=e}return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(i)throw i;let o=!1;const s={};for(let i=0;i<r.length;i++){const a=r[i],l=n[a],c=e[a],u=l(c,t);if(void 0===u)throw t&&t.type,new Error(Se(14));s[a]=u,o=o||u!==c}return o=o||r.length!==Object.keys(e).length,o?s:e}}(n)}l="function"==typeof r?r(t):t();let c=Ie;i&&(c=an({trace:!1,..."object"==typeof i&&i}));const u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>(n,r)=>{const i=e(n,r);let o=()=>{throw new Error(Se(15))};const s={getState:i.getState,dispatch:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o(e,...n)}},a=t.map((e=>e(s)));return o=Ie(...a)(i.dispatch),{...i,dispatch:o}}}(...l),h=(e=>function(t){const{autoBatch:n=!0}=t??{};let r=new cn(e);return n&&r.push(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"raf"};return t=>function(){const n=t(...arguments);let r=!0,i=!1,o=!1;const s=new Set,a="tick"===e.type?queueMicrotask:"raf"===e.type?hn:"callback"===e.type?e.queueNotification:un(e.timeout),l=()=>{o=!1,i&&(i=!1,s.forEach((e=>e())))};return Object.assign({},n,{subscribe(e){const t=n.subscribe((()=>r&&e()));return s.add(e),()=>{t(),s.delete(e)}},dispatch(e){try{return r=!e?.meta?.RTK_autoBatch,i=!r,i&&(o||(o=!0,a(l))),n.dispatch(e)}finally{r=!0}}})}}("object"==typeof n?n:void 0)),r})(u);return Ae(a,o,c(..."function"==typeof s?s(h):h()))}({reducer:{config:Ue,map:We,widget:st},middleware:e=>e({immutableCheck:{warnAfter:128},serializableCheck:{ignoredActions:[oe,se,ae,le,ce,ue],warnAfter:128}})}),yn=gn,vn=function(e,t,n){var r=!1,i=Ae(Ne,Oe,void 0),o=function(e){i.dispatch({type:ue,key:e})},s=function(t,n,o){var s={type:se,payload:n,err:o,key:t};e.dispatch(s),i.dispatch(s),r&&a.getState().bootstrapped&&(r(),r=!1)},a=Le({},i,{purge:function(){var t=[];return e.dispatch({type:ce,result:function(e){t.push(e)}}),Promise.all(t)},flush:function(){var t=[];return e.dispatch({type:oe,result:function(e){t.push(e)}}),Promise.all(t)},pause:function(){e.dispatch({type:ae})},persist:function(){e.dispatch({type:le,register:o,rehydrate:s})}});return a.persist(),a}(yn);var _n=i(7462),xn=i(3038),bn=i.n(xn),wn=i(7798),Sn=i.n(wn),Mn=i(3825),En=i.n(Mn),Tn=i(8743),Cn=i.n(Tn),An=i(1100),In=i.n(An);const Pn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning",n=!1;const r=Array.isArray(e)?e.join("\n"):e;return()=>{n||(n=!0,"error"===t?console.error(r):console.warn(r))}};Ye().extend(En()),Ye().extend(bn()),Ye().extend(Cn()),Ye().extend(In());const Rn=Pn(["Your locale has not been found.","Either the locale key is not a supported one. Locales supported by dayjs are available here: https://github.com/iamkun/dayjs/tree/dev/src/locale","Or you forget to import the locale from 'dayjs/locale/{localeUsed}'","fallback on English locale"]),Ln={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Dn={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime:"LT",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime:"L LT",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},On=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join("\n"),Nn=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join("\n");function kn(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Fn=0;function zn(e){return"__private_"+Fn+++"_"+e}function Bn(e){let t=0;const n=e.toString();for(let e=0;e<n.length;e++)t=(t<<5)-t+n.charCodeAt(e),t|=0;return t.toString()}const Un={init:"init","feature-select":"feature-select"};var jn=zn("context"),Vn=zn("config"),Gn=zn("eventHandlers"),Hn=zn("selectedFeature"),Zn=zn("runHandlersWithContent");class Wn{obtainAccessToken(){return Promise.resolve()}}const $n="JSON_PARSE_FAILURE",qn="NO_DEFINED_CONTENT_TYPE",Xn="REQUEST_FAILURE",Yn="TEXT_PARSE_FAILURE",Kn="TOKEN_OBTAIN_FAILURE";var Jn=zn("authController"),Qn=zn("authHeader");class er{constructor(e){Object.defineProperty(this,Jn,{writable:!0,value:void 0}),Object.defineProperty(this,Qn,{writable:!0,value:void 0}),this.get=(e,t)=>new Promise(((n,r)=>{kn(this,Qn)[Qn]().then((i=>fetch(`${t}${e}`,{headers:{Authorization:i},method:"GET"}).then((e=>{const t=e.headers.get("Content-Type");t?t.includes("text")||t.includes("image/svg+xml")?e.text().then(n).catch((e=>{r({reason:Yn,error:e})})):e.json().then(n).catch((e=>{r({reason:$n,error:e})})):r({reason:qn})})).catch((e=>{r({reason:Xn,error:e})})))).catch((e=>{r({reason:Kn,error:e})}))})),this.post=(e,t,n)=>new Promise(((r,i)=>{kn(this,Qn)[Qn]().then((o=>fetch(`${n}${e}`,{body:JSON.stringify(t),headers:{Authorization:o,"Content-Type":"application/json"},method:"POST"}).then((e=>{const t=e.headers.get("Content-Type");t?t.includes("text")||t.includes("image/svg+xml")?e.text().then(r).catch((e=>{i({reason:Yn,error:e})})):e.json().then(r).catch((e=>{i({reason:$n,error:e})})):i({reason:qn})})).catch((e=>{i({reason:Xn,error:e})})))).catch((e=>{i({reason:Kn,error:e})}))})),kn(this,Jn)[Jn]=e,kn(this,Qn)[Qn]=async()=>`Bearer ${await kn(this,Jn)[Jn].obtainAccessToken()}`}}var tr=6371008.8,nr={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:tr,metres:tr,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function rr(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function ir(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!cr(e[0])||!cr(e[1]))throw new Error("coordinates must contain numbers");return rr({type:"Point",coordinates:e},t,n)}function or(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return rr({type:"Polygon",coordinates:e},t,n)}function sr(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function ar(e,t){void 0===t&&(t="kilometers");var n=nr[t];if(!n)throw new Error(t+" units is invalid");return e*n}function lr(e){return e%360*Math.PI/180}function cr(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function ur(e,t,n){if(null!==e)for(var r,i,o,s,a,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,g=f?e.features.length:1,y=0;y<g;y++){a=(u=!!(c=f?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<a;v++){var _=0,x=0;if(null!==(s=u?c.geometries[v]:c)){l=s.coordinates;var b=s.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===t(l,d,y,_,x))return!1;d++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],d,y,_,x))return!1;d++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(i=0;i<l[r].length-h;i++){if(!1===t(l[r][i],d,y,_,x))return!1;d++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,i=0;i<l[r].length;i++){for(o=0;o<l[r][i].length-h;o++){if(!1===t(l[r][i][o],d,y,_,x))return!1;d++}x++}_++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===ur(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function hr(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function dr(e,t){var n,r,i,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(n=0;n<m;n++){for(a=p?e.features[n].geometry:f?e.geometry:e,c=p?e.features[n].properties:f?e.properties:{},u=p?e.features[n].bbox:f?e.bbox:void 0,h=p?e.features[n].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,i=0;i<s;i++)if(null!==(o=l?a.geometries[i]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function pr(e){var t=[1/0,1/0,-1/0,-1/0];return ur(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}pr.default=pr;const fr=pr;function mr(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function gr(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r,i=mr(e),o="Feature"===(r=t).type?r.geometry:r,s=o.type,a=t.bbox,l=o.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(i,a))return!1;"Polygon"===s&&(l=[l]);for(var c=!1,u=0;u<l.length&&!c;u++)if(yr(i,l[u][0],n.ignoreBoundary)){for(var h=!1,d=1;d<l[u].length&&!h;)yr(i,l[u][d],!n.ignoreBoundary)&&(h=!0),d++;h||(c=!0)}return c}function yr(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,o=t.length-1;i<t.length;o=i++){var s=t[i][0],a=t[i][1],l=t[o][0],c=t[o][1];if(e[1]*(s-l)+a*(l-e[0])+c*(e[0]-s)==0&&(s-e[0])*(l-e[0])<=0&&(a-e[1])*(c-e[1])<=0)return!n;a>e[1]!=c>e[1]&&e[0]<(l-s)*(e[1]-a)/(c-a)+s&&(r=!r)}return r}i(1843),i(7074);Object.prototype.hasOwnProperty;var vr=new ArrayBuffer(16);function _r(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[n,r];return or([[s,[i,r],[i,o],[n,o],s]],t.properties,{bbox:e,id:t.id})}new Float64Array(vr),new Uint32Array(vr),i(5876),function(){function e(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(var t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(t=0;t<this.length-1;t++){var n=this.points[t],r=this.points[t+1];this.centers.push({x:(n.x+r.x)/2,y:(n.y+r.y)/2,z:(n.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),t=0;t<this.centers.length-1;t++){var i=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,o=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,s=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+s)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+i),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(e){var t=[],n=this.pos(0);t.push(0);for(var r=0;r<this.duration;r+=10){var i=this.pos(r);Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))>e&&(t.push(r),n=i)}return t},e.prototype.vector=function(e){var t=this.pos(e+10),n=this.pos(e-10);return{angle:180*Math.atan2(t.y-n.y,t.x-n.x)/3.14,speed:Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)+(n.z-t.z)*(n.z-t.z))}},e.prototype.pos=function(e){var t=e-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var n=t/this.duration;if(n>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*n);return function(e,t,n,r,i){var o=function(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:i.x*o[0]+r.x*o[1]+n.x*o[2]+t.x*o[3],y:i.y*o[0]+r.y*o[1]+n.y*o[2]+t.y*o[3],z:i.z*o[0]+r.z*o[1]+n.z*o[2]+t.z*o[3]}}((this.length-1)*n-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])}}();i(6583),i(3130);var xr=Math.PI/180,br=180/Math.PI,wr=function(e,t){this.lon=e,this.lat=t,this.x=xr*e,this.y=xr*t};wr.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},wr.prototype.antipode=function(){var e=-1*this.lat,t=this.lon<0?180+this.lon:-1*(180-this.lon);return new wr(t,e)};var Sr=function(){this.coords=[],this.length=0};Sr.prototype.move_to=function(e){this.length++,this.coords.push(e)};var Mr=function(e){this.properties=e||{},this.geometries=[]};Mr.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},Mr.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(e){t+=e[0]+" "+e[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};var Er=function(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new wr(e.x,e.y),this.end=new wr(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,i=this.start.y-this.end.y,o=Math.pow(Math.sin(i/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};Er.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),i=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),o=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),s=br*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[br*Math.atan2(i,r),s]},Er.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),i=0;i<e;++i){var o=r*i,s=this.interpolate(o);n.push(s)}for(var a=!1,l=0,c=t&&t.offset?t.offset:10,u=180-c,h=-180+c,d=360-c,p=1;p<n.length;++p){var f=n[p-1][0],m=n[p][0],g=Math.abs(m-f);g>d&&(m>u&&f<h||f>u&&m<h)?a=!0:g>l&&(l=g)}var y=[];if(a&&l<c){var v=[];y.push(v);for(var _=0;_<n.length;++_){var x=parseFloat(n[_][0]);if(_>0&&Math.abs(x-n[_-1][0])>d){var b=parseFloat(n[_-1][0]),w=parseFloat(n[_-1][1]),S=parseFloat(n[_][0]),M=parseFloat(n[_][1]);if(b>-180&&b<h&&180===S&&_+1<n.length&&n[_-1][0]>-180&&n[_-1][0]<h){v.push([-180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b>u&&b<180&&-180===S&&_+1<n.length&&n[_-1][0]>u&&n[_-1][0]<180){v.push([180,n[_][1]]),_++,v.push([n[_][0],n[_][1]]);continue}if(b<h&&S>u){var E=b;b=S,S=E;var T=w;w=M,M=T}if(b>u&&S<h&&(S+=360),b<=180&&S>=180&&b<S){var C=(180-b)/(S-b),A=C*M+(1-C)*w;v.push([n[_-1][0]>u?180:-180,A]),(v=[]).push([n[_-1][0]>u?-180:180,A]),y.push(v)}else v=[],y.push(v);v.push([x,n[_][1]])}else v.push([n[_][0],n[_][1]])}}else{var I=[];y.push(I);for(var P=0;P<n.length;++P)I.push([n[P][0],n[P][1]])}for(var R=new Mr(this.properties),L=0;L<y.length;++L){var D=new Sr;R.geometries.push(D);for(var O=y[L],N=0;N<O.length;++N)D.move_to(O[N])}return R},i(1330);var Tr=[],Cr=[],Ar=[],Ir=[],Pr=[],Rr=[],Lr=[],Dr=[],Or=[],Nr=[],kr=[],Fr=[],zr=[],Br=[],Ur=[],jr=[],Vr=[],Gr=[],Hr=[],Zr=[],Wr=[],$r=[],qr=[],Xr=[];Lr[85]=Nr[85]=-1,Dr[85]=kr[85]=0,Or[85]=Fr[85]=1,Hr[85]=$r[85]=1,Zr[85]=qr[85]=0,Wr[85]=Xr[85]=1,Tr[85]=Ir[85]=0,Cr[85]=Pr[85]=-1,Ar[85]=Ur[85]=0,jr[85]=zr[85]=0,Vr[85]=Br[85]=1,Rr[85]=Gr[85]=1,$r[1]=$r[169]=0,qr[1]=qr[169]=-1,Xr[1]=Xr[169]=0,zr[1]=zr[169]=-1,Br[1]=Br[169]=0,Ur[1]=Ur[169]=0,Nr[4]=Nr[166]=0,kr[4]=kr[166]=-1,Fr[4]=Fr[166]=1,jr[4]=jr[166]=1,Vr[4]=Vr[166]=0,Gr[4]=Gr[166]=0,Lr[16]=Lr[154]=0,Dr[16]=Dr[154]=1,Or[16]=Or[154]=1,Ir[16]=Ir[154]=1,Pr[16]=Pr[154]=0,Rr[16]=Rr[154]=1,Hr[64]=Hr[106]=0,Zr[64]=Zr[106]=1,Wr[64]=Wr[106]=0,Tr[64]=Tr[106]=-1,Cr[64]=Cr[106]=0,Ar[64]=Ar[106]=1,Hr[2]=Hr[168]=0,Zr[2]=Zr[168]=-1,Wr[2]=Wr[168]=1,$r[2]=$r[168]=0,qr[2]=qr[168]=-1,Xr[2]=Xr[168]=0,zr[2]=zr[168]=-1,Br[2]=Br[168]=0,Ur[2]=Ur[168]=0,jr[2]=jr[168]=-1,Vr[2]=Vr[168]=0,Gr[2]=Gr[168]=1,Lr[8]=Lr[162]=0,Dr[8]=Dr[162]=-1,Or[8]=Or[162]=0,Nr[8]=Nr[162]=0,kr[8]=kr[162]=-1,Fr[8]=Fr[162]=1,zr[8]=zr[162]=1,Br[8]=Br[162]=0,Ur[8]=Ur[162]=1,jr[8]=jr[162]=1,Vr[8]=Vr[162]=0,Gr[8]=Gr[162]=0,Lr[32]=Lr[138]=0,Dr[32]=Dr[138]=1,Or[32]=Or[138]=1,Nr[32]=Nr[138]=0,kr[32]=kr[138]=1,Fr[32]=Fr[138]=0,Tr[32]=Tr[138]=1,Cr[32]=Cr[138]=0,Ar[32]=Ar[138]=0,Ir[32]=Ir[138]=1,Pr[32]=Pr[138]=0,Rr[32]=Rr[138]=1,$r[128]=$r[42]=0,qr[128]=qr[42]=1,Xr[128]=Xr[42]=1,Hr[128]=Hr[42]=0,Zr[128]=Zr[42]=1,Wr[128]=Wr[42]=0,Tr[128]=Tr[42]=-1,Cr[128]=Cr[42]=0,Ar[128]=Ar[42]=1,Ir[128]=Ir[42]=-1,Pr[128]=Pr[42]=0,Rr[128]=Rr[42]=0,Nr[5]=Nr[165]=-1,kr[5]=kr[165]=0,Fr[5]=Fr[165]=0,$r[5]=$r[165]=1,qr[5]=qr[165]=0,Xr[5]=Xr[165]=0,jr[20]=jr[150]=0,Vr[20]=Vr[150]=1,Gr[20]=Gr[150]=1,Ir[20]=Ir[150]=0,Pr[20]=Pr[150]=-1,Rr[20]=Rr[150]=1,Lr[80]=Lr[90]=-1,Dr[80]=Dr[90]=0,Or[80]=Or[90]=1,Hr[80]=Hr[90]=1,Zr[80]=Zr[90]=0,Wr[80]=Wr[90]=1,zr[65]=zr[105]=0,Br[65]=Br[105]=1,Ur[65]=Ur[105]=0,Tr[65]=Tr[105]=0,Cr[65]=Cr[105]=-1,Ar[65]=Ar[105]=0,Lr[160]=Lr[10]=-1,Dr[160]=Dr[10]=0,Or[160]=Or[10]=1,Nr[160]=Nr[10]=-1,kr[160]=kr[10]=0,Fr[160]=Fr[10]=0,$r[160]=$r[10]=1,qr[160]=qr[10]=0,Xr[160]=Xr[10]=0,Hr[160]=Hr[10]=1,Zr[160]=Zr[10]=0,Wr[160]=Wr[10]=1,jr[130]=jr[40]=0,Vr[130]=Vr[40]=1,Gr[130]=Gr[40]=1,zr[130]=zr[40]=0,Br[130]=Br[40]=1,Ur[130]=Ur[40]=0,Tr[130]=Tr[40]=0,Cr[130]=Cr[40]=-1,Ar[130]=Ar[40]=0,Ir[130]=Ir[40]=0,Pr[130]=Pr[40]=-1,Rr[130]=Rr[40]=1,Nr[37]=Nr[133]=0,kr[37]=kr[133]=1,Fr[37]=Fr[133]=1,$r[37]=$r[133]=0,qr[37]=qr[133]=1,Xr[37]=Xr[133]=0,Tr[37]=Tr[133]=-1,Cr[37]=Cr[133]=0,Ar[37]=Ar[133]=0,Ir[37]=Ir[133]=1,Pr[37]=Pr[133]=0,Rr[37]=Rr[133]=0,jr[148]=jr[22]=-1,Vr[148]=Vr[22]=0,Gr[148]=Gr[22]=0,$r[148]=$r[22]=0,qr[148]=qr[22]=-1,Xr[148]=Xr[22]=1,Hr[148]=Hr[22]=0,Zr[148]=Zr[22]=1,Wr[148]=Wr[22]=1,Ir[148]=Ir[22]=-1,Pr[148]=Pr[22]=0,Rr[148]=Rr[22]=1,Lr[82]=Lr[88]=0,Dr[82]=Dr[88]=-1,Or[82]=Or[88]=1,jr[82]=jr[88]=1,Vr[82]=Vr[88]=0,Gr[82]=Gr[88]=1,zr[82]=zr[88]=-1,Br[82]=Br[88]=0,Ur[82]=Ur[88]=1,Hr[82]=Hr[88]=0,Zr[82]=Zr[88]=-1,Wr[82]=Wr[88]=0,Lr[73]=Lr[97]=0,Dr[73]=Dr[97]=1,Or[73]=Or[97]=0,Nr[73]=Nr[97]=0,kr[73]=kr[97]=-1,Fr[73]=Fr[97]=0,zr[73]=zr[97]=1,Br[73]=Br[97]=0,Ur[73]=Ur[97]=0,Tr[73]=Tr[97]=1,Cr[73]=Cr[97]=0,Ar[73]=Ar[97]=1,Lr[145]=Lr[25]=0,Dr[145]=Dr[25]=-1,Or[145]=Or[25]=0,zr[145]=zr[25]=1,Br[145]=Br[25]=0,Ur[145]=Ur[25]=1,$r[145]=$r[25]=0,qr[145]=qr[25]=1,Xr[145]=Xr[25]=1,Ir[145]=Ir[25]=-1,Pr[145]=Pr[25]=0,Rr[145]=Rr[25]=0,Nr[70]=Nr[100]=0,kr[70]=kr[100]=1,Fr[70]=Fr[100]=0,jr[70]=jr[100]=-1,Vr[70]=Vr[100]=0,Gr[70]=Gr[100]=1,Hr[70]=Hr[100]=0,Zr[70]=Zr[100]=-1,Wr[70]=Wr[100]=1,Tr[70]=Tr[100]=1,Cr[70]=Cr[100]=0,Ar[70]=Ar[100]=0,Nr[101]=Nr[69]=0,kr[101]=kr[69]=1,Fr[101]=Fr[69]=0,Tr[101]=Tr[69]=1,Cr[101]=Cr[69]=0,Ar[101]=Ar[69]=0,$r[149]=$r[21]=0,qr[149]=qr[21]=1,Xr[149]=Xr[21]=1,Ir[149]=Ir[21]=-1,Pr[149]=Pr[21]=0,Rr[149]=Rr[21]=0,jr[86]=jr[84]=-1,Vr[86]=Vr[84]=0,Gr[86]=Gr[84]=1,Hr[86]=Hr[84]=0,Zr[86]=Zr[84]=-1,Wr[86]=Wr[84]=1,Lr[89]=Lr[81]=0,Dr[89]=Dr[81]=-1,Or[89]=Or[81]=0,zr[89]=zr[81]=1,Br[89]=Br[81]=0,Ur[89]=Ur[81]=1,Lr[96]=Lr[74]=0,Dr[96]=Dr[74]=1,Or[96]=Or[74]=0,Nr[96]=Nr[74]=-1,kr[96]=kr[74]=0,Fr[96]=Fr[74]=1,Hr[96]=Hr[74]=1,Zr[96]=Zr[74]=0,Wr[96]=Wr[74]=0,Tr[96]=Tr[74]=1,Cr[96]=Cr[74]=0,Ar[96]=Ar[74]=1,Lr[24]=Lr[146]=0,Dr[24]=Dr[146]=-1,Or[24]=Or[146]=1,jr[24]=jr[146]=1,Vr[24]=Vr[146]=0,Gr[24]=Gr[146]=1,zr[24]=zr[146]=0,Br[24]=Br[146]=1,Ur[24]=Ur[146]=1,Ir[24]=Ir[146]=0,Pr[24]=Pr[146]=-1,Rr[24]=Rr[146]=0,Nr[6]=Nr[164]=-1,kr[6]=kr[164]=0,Fr[6]=Fr[164]=1,jr[6]=jr[164]=-1,Vr[6]=Vr[164]=0,Gr[6]=Gr[164]=0,$r[6]=$r[164]=0,qr[6]=qr[164]=-1,Xr[6]=Xr[164]=1,Hr[6]=Hr[164]=1,Zr[6]=Zr[164]=0,Wr[6]=Wr[164]=0,zr[129]=zr[41]=0,Br[129]=Br[41]=1,Ur[129]=Ur[41]=1,$r[129]=$r[41]=0,qr[129]=qr[41]=1,Xr[129]=Xr[41]=0,Tr[129]=Tr[41]=-1,Cr[129]=Cr[41]=0,Ar[129]=Ar[41]=0,Ir[129]=Ir[41]=0,Pr[129]=Pr[41]=-1,Rr[129]=Rr[41]=0,jr[66]=jr[104]=0,Vr[66]=Vr[104]=1,Gr[66]=Gr[104]=0,zr[66]=zr[104]=-1,Br[66]=Br[104]=0,Ur[66]=Ur[104]=1,Hr[66]=Hr[104]=0,Zr[66]=Zr[104]=-1,Wr[66]=Wr[104]=0,Tr[66]=Tr[104]=0,Cr[66]=Cr[104]=-1,Ar[66]=Ar[104]=1,Lr[144]=Lr[26]=-1,Dr[144]=Dr[26]=0,Or[144]=Or[26]=0,$r[144]=$r[26]=1,qr[144]=qr[26]=0,Xr[144]=Xr[26]=1,Hr[144]=Hr[26]=0,Zr[144]=Zr[26]=1,Wr[144]=Wr[26]=1,Ir[144]=Ir[26]=-1,Pr[144]=Pr[26]=0,Rr[144]=Rr[26]=1,Nr[36]=Nr[134]=0,kr[36]=kr[134]=1,Fr[36]=Fr[134]=1,jr[36]=jr[134]=0,Vr[36]=Vr[134]=1,Gr[36]=Gr[134]=0,Tr[36]=Tr[134]=0,Cr[36]=Cr[134]=-1,Ar[36]=Ar[134]=1,Ir[36]=Ir[134]=1,Pr[36]=Pr[134]=0,Rr[36]=Rr[134]=0,Lr[9]=Lr[161]=-1,Dr[9]=Dr[161]=0,Or[9]=Or[161]=0,Nr[9]=Nr[161]=0,kr[9]=kr[161]=-1,Fr[9]=Fr[161]=0,zr[9]=zr[161]=1,Br[9]=Br[161]=0,Ur[9]=Ur[161]=0,$r[9]=$r[161]=1,qr[9]=qr[161]=0,Xr[9]=Xr[161]=1,Lr[136]=0,Dr[136]=1,Or[136]=1,Nr[136]=0,kr[136]=1,Fr[136]=0,jr[136]=-1,Vr[136]=0,Gr[136]=1,zr[136]=-1,Br[136]=0,Ur[136]=0,$r[136]=0,qr[136]=-1,Xr[136]=0,Hr[136]=0,Zr[136]=-1,Wr[136]=1,Tr[136]=1,Cr[136]=0,Ar[136]=0,Ir[136]=1,Pr[136]=0,Rr[136]=1,Lr[34]=0,Dr[34]=-1,Or[34]=0,Nr[34]=0,kr[34]=-1,Fr[34]=1,jr[34]=1,Vr[34]=0,Gr[34]=0,zr[34]=1,Br[34]=0,Ur[34]=1,$r[34]=0,qr[34]=1,Xr[34]=1,Hr[34]=0,Zr[34]=1,Wr[34]=0,Tr[34]=-1,Cr[34]=0,Ar[34]=1,Ir[34]=-1,Pr[34]=0,Rr[34]=0,Lr[35]=0,Dr[35]=1,Or[35]=1,Nr[35]=0,kr[35]=-1,Fr[35]=1,jr[35]=1,Vr[35]=0,Gr[35]=0,zr[35]=-1,Br[35]=0,Ur[35]=0,$r[35]=0,qr[35]=-1,Xr[35]=0,Hr[35]=0,Zr[35]=1,Wr[35]=0,Tr[35]=-1,Cr[35]=0,Ar[35]=1,Ir[35]=1,Pr[35]=0,Rr[35]=1,Lr[153]=0,Dr[153]=1,Or[153]=1,zr[153]=-1,Br[153]=0,Ur[153]=0,$r[153]=0,qr[153]=-1,Xr[153]=0,Ir[153]=1,Pr[153]=0,Rr[153]=1,Nr[102]=0,kr[102]=-1,Fr[102]=1,jr[102]=1,Vr[102]=0,Gr[102]=0,Hr[102]=0,Zr[102]=1,Wr[102]=0,Tr[102]=-1,Cr[102]=0,Ar[102]=1,Lr[155]=0,Dr[155]=-1,Or[155]=0,zr[155]=1,Br[155]=0,Ur[155]=1,$r[155]=0,qr[155]=1,Xr[155]=1,Ir[155]=-1,Pr[155]=0,Rr[155]=0,Nr[103]=0,kr[103]=1,Fr[103]=0,jr[103]=-1,Vr[103]=0,Gr[103]=1,Hr[103]=0,Zr[103]=-1,Wr[103]=1,Tr[103]=1,Cr[103]=0,Ar[103]=0,Lr[152]=0,Dr[152]=1,Or[152]=1,jr[152]=-1,Vr[152]=0,Gr[152]=1,zr[152]=-1,Br[152]=0,Ur[152]=0,$r[152]=0,qr[152]=-1,Xr[152]=0,Hr[152]=0,Zr[152]=-1,Wr[152]=1,Ir[152]=1,Pr[152]=0,Rr[152]=1,Lr[156]=0,Dr[156]=-1,Or[156]=1,jr[156]=1,Vr[156]=0,Gr[156]=1,zr[156]=-1,Br[156]=0,Ur[156]=0,$r[156]=0,qr[156]=-1,Xr[156]=0,Hr[156]=0,Zr[156]=1,Wr[156]=1,Ir[156]=-1,Pr[156]=0,Rr[156]=1,Lr[137]=0,Dr[137]=1,Or[137]=1,Nr[137]=0,kr[137]=1,Fr[137]=0,zr[137]=-1,Br[137]=0,Ur[137]=0,$r[137]=0,qr[137]=-1,Xr[137]=0,Tr[137]=1,Cr[137]=0,Ar[137]=0,Ir[137]=1,Pr[137]=0,Rr[137]=1,Lr[139]=0,Dr[139]=1,Or[139]=1,Nr[139]=0,kr[139]=-1,Fr[139]=0,zr[139]=1,Br[139]=0,Ur[139]=0,$r[139]=0,qr[139]=1,Xr[139]=0,Tr[139]=-1,Cr[139]=0,Ar[139]=0,Ir[139]=1,Pr[139]=0,Rr[139]=1,Lr[98]=0,Dr[98]=-1,Or[98]=0,Nr[98]=0,kr[98]=-1,Fr[98]=1,jr[98]=1,Vr[98]=0,Gr[98]=0,zr[98]=1,Br[98]=0,Ur[98]=1,Hr[98]=0,Zr[98]=1,Wr[98]=0,Tr[98]=-1,Cr[98]=0,Ar[98]=1,Lr[99]=0,Dr[99]=1,Or[99]=0,Nr[99]=0,kr[99]=-1,Fr[99]=1,jr[99]=1,Vr[99]=0,Gr[99]=0,zr[99]=-1,Br[99]=0,Ur[99]=1,Hr[99]=0,Zr[99]=-1,Wr[99]=0,Tr[99]=1,Cr[99]=0,Ar[99]=1,Nr[38]=0,kr[38]=-1,Fr[38]=1,jr[38]=1,Vr[38]=0,Gr[38]=0,$r[38]=0,qr[38]=1,Xr[38]=1,Hr[38]=0,Zr[38]=1,Wr[38]=0,Tr[38]=-1,Cr[38]=0,Ar[38]=1,Ir[38]=-1,Pr[38]=0,Rr[38]=0,Nr[39]=0,kr[39]=1,Fr[39]=1,jr[39]=-1,Vr[39]=0,Gr[39]=0,$r[39]=0,qr[39]=-1,Xr[39]=1,Hr[39]=0,Zr[39]=1,Wr[39]=0,Tr[39]=-1,Cr[39]=0,Ar[39]=1,Ir[39]=1,Pr[39]=0,Rr[39]=0;var Yr=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},Kr=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},Jr=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},Qr=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},ei=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},ti=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},ni=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},ri=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},ii=[],oi=[],si=[],ai=[],li=[],ci=[],ui=[],hi=[];ai[1]=li[1]=18,ai[169]=li[169]=18,si[4]=oi[4]=12,si[166]=oi[166]=12,ii[16]=hi[16]=4,ii[154]=hi[154]=4,ci[64]=ui[64]=22,ci[106]=ui[106]=22,si[2]=ci[2]=17,ai[2]=li[2]=18,si[168]=ci[168]=17,ai[168]=li[168]=18,ii[8]=ai[8]=9,oi[8]=si[8]=12,ii[162]=ai[162]=9,oi[162]=si[162]=12,ii[32]=hi[32]=4,oi[32]=ui[32]=1,ii[138]=hi[138]=4,oi[138]=ui[138]=1,li[128]=hi[128]=21,ci[128]=ui[128]=22,li[42]=hi[42]=21,ci[42]=ui[42]=22,oi[5]=li[5]=14,oi[165]=li[165]=14,si[20]=hi[20]=6,si[150]=hi[150]=6,ii[80]=ci[80]=11,ii[90]=ci[90]=11,ai[65]=ui[65]=3,ai[105]=ui[105]=3,ii[160]=ci[160]=11,oi[160]=li[160]=14,ii[10]=ci[10]=11,oi[10]=li[10]=14,si[130]=hi[130]=6,ai[130]=ui[130]=3,si[40]=hi[40]=6,ai[40]=ui[40]=3,oi[101]=ui[101]=1,oi[69]=ui[69]=1,li[149]=hi[149]=21,li[21]=hi[21]=21,si[86]=ci[86]=17,si[84]=ci[84]=17,ii[89]=ai[89]=9,ii[81]=ai[81]=9,ii[96]=ui[96]=0,oi[96]=ci[96]=15,ii[74]=ui[74]=0,oi[74]=ci[74]=15,ii[24]=si[24]=8,ai[24]=hi[24]=7,ii[146]=si[146]=8,ai[146]=hi[146]=7,oi[6]=ci[6]=15,si[6]=li[6]=16,oi[164]=ci[164]=15,si[164]=li[164]=16,ai[129]=hi[129]=7,li[129]=ui[129]=20,ai[41]=hi[41]=7,li[41]=ui[41]=20,si[66]=ui[66]=2,ai[66]=ci[66]=19,si[104]=ui[104]=2,ai[104]=ci[104]=19,ii[144]=li[144]=10,ci[144]=hi[144]=23,ii[26]=li[26]=10,ci[26]=hi[26]=23,oi[36]=hi[36]=5,si[36]=ui[36]=2,oi[134]=hi[134]=5,si[134]=ui[134]=2,ii[9]=li[9]=10,oi[9]=ai[9]=13,ii[161]=li[161]=10,oi[161]=ai[161]=13,oi[37]=hi[37]=5,li[37]=ui[37]=20,oi[133]=hi[133]=5,li[133]=ui[133]=20,si[148]=li[148]=16,ci[148]=hi[148]=23,si[22]=li[22]=16,ci[22]=hi[22]=23,ii[82]=si[82]=8,ai[82]=ci[82]=19,ii[88]=si[88]=8,ai[88]=ci[88]=19,ii[73]=ui[73]=0,oi[73]=ai[73]=13,ii[97]=ui[97]=0,oi[97]=ai[97]=13,ii[145]=ai[145]=9,li[145]=hi[145]=21,ii[25]=ai[25]=9,li[25]=hi[25]=21,oi[70]=ui[70]=1,si[70]=ci[70]=17,oi[100]=ui[100]=1,si[100]=ci[100]=17,ii[34]=ai[34]=9,oi[34]=si[34]=12,li[34]=hi[34]=21,ci[34]=ui[34]=22,ii[136]=hi[136]=4,oi[136]=ui[136]=1,si[136]=ci[136]=17,ai[136]=li[136]=18,ii[35]=hi[35]=4,oi[35]=si[35]=12,ai[35]=li[35]=18,ci[35]=ui[35]=22,ii[153]=hi[153]=4,ai[153]=li[153]=18,oi[102]=si[102]=12,ci[102]=ui[102]=22,ii[155]=ai[155]=9,li[155]=hi[155]=23,oi[103]=ui[103]=1,si[103]=ci[103]=17,ii[152]=hi[152]=4,si[152]=ci[152]=17,ai[152]=li[152]=18,ii[156]=si[156]=8,ai[156]=li[156]=18,ci[156]=hi[156]=23,ii[137]=hi[137]=4,oi[137]=ui[137]=1,ai[137]=li[137]=18,ii[139]=hi[139]=4,oi[139]=ai[139]=13,li[139]=ui[139]=20,ii[98]=ai[98]=9,oi[98]=si[98]=12,ci[98]=ui[98]=22,ii[99]=ui[99]=0,oi[99]=si[99]=12,ai[99]=ci[99]=19,oi[38]=si[38]=12,li[38]=hi[38]=21,ci[38]=ui[38]=22,oi[39]=hi[39]=5,si[39]=li[39]=16,ci[39]=ui[39]=22;var di=[];function pi(e,t,n){var r,i=t[0]-e[0],o=t[1]-e[1],s=n[0]-t[0];return((r=i*(n[1]-t[1])-s*o)>0)-(r<0)||+r}function fi(e,t){return t.geometry.coordinates[0].every((function(t){return gr(ir(t),e)}))}di[1]=di[169]=Yr,di[4]=di[166]=Kr,di[16]=di[154]=Jr,di[64]=di[106]=Qr,di[168]=di[2]=ei,di[162]=di[8]=ti,di[138]=di[32]=ni,di[42]=di[128]=ri,di[5]=di[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},di[20]=di[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},di[80]=di[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},di[65]=di[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},di[160]=di[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},di[130]=di[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},di[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},di[101]=di[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},di[149]=di[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},di[86]=di[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},di[89]=di[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},di[96]=di[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},di[24]=di[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},di[6]=di[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},di[129]=di[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},di[66]=di[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},di[144]=di[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},di[36]=di[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},di[9]=di[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},di[37]=di[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},di[148]=di[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},di[82]=di[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},di[73]=di[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},di[145]=di[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},di[70]=di[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},di[34]=function(e){return[ri(e),ti(e)]},di[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},di[136]=function(e){return[ni(e),ei(e)]},di[153]=function(e){return[Jr(e),Yr(e)]},di[102]=function(e){return[Kr(e),Qr(e)]},di[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},di[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},di[152]=function(e){return[Jr(e),ei(e)]},di[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},di[137]=function(e){return[ni(e),Yr(e)]},di[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},di[98]=function(e){return[ti(e),Qr(e)]},di[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},di[38]=function(e){return[Kr(e),ri(e)]},di[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};var mi=function(){function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(e){return e.join(",")},e.prototype.removeInnerEdge=function(e){this.innerEdges=this.innerEdges.filter((function(t){return t.from.id!==e.from.id}))},e.prototype.removeOuterEdge=function(e){this.outerEdges=this.outerEdges.filter((function(t){return t.to.id!==e.to.id}))},e.prototype.addOuterEdge=function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var e=this;this.outerEdgesSorted||(this.outerEdges.sort((function(t,n){var r=t.to,i=n.to;if(r.coordinates[0]-e.coordinates[0]>=0&&i.coordinates[0]-e.coordinates[0]<0)return 1;if(r.coordinates[0]-e.coordinates[0]<0&&i.coordinates[0]-e.coordinates[0]>=0)return-1;if(r.coordinates[0]-e.coordinates[0]==0&&i.coordinates[0]-e.coordinates[0]==0)return r.coordinates[1]-e.coordinates[1]>=0||i.coordinates[1]-e.coordinates[1]>=0?r.coordinates[1]-i.coordinates[1]:i.coordinates[1]-r.coordinates[1];var o=pi(e.coordinates,r.coordinates,i.coordinates);return o<0?1:o>0?-1:Math.pow(r.coordinates[0]-e.coordinates[0],2)+Math.pow(r.coordinates[1]-e.coordinates[1],2)-(Math.pow(i.coordinates[0]-e.coordinates[0],2)+Math.pow(i.coordinates[1]-e.coordinates[1],2))})),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(e){return this.sortOuterEdges(),this.outerEdges[e]},e.prototype.addInnerEdge=function(e){this.innerEdges.push(e)},e}();const gi=mi,yi=function(){function e(e,t){this.from=e,this.to=t,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(e){return this.from.id===e.from.id&&this.to.id===e.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return function(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return rr({type:"LineString",coordinates:e},t,n)}([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(e){return pi(e.from.coordinates,e.to.coordinates,this.to.coordinates)},e}();var vi=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(e){this.edges.push(e),this.polygon=this.envelope=void 0},e.prototype.get=function(e){return this.edges[e]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){this.edges.forEach(e)},e.prototype.map=function(e){return this.edges.map(e)},e.prototype.some=function(e){return this.edges.some(e)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var e=this,t=this.edges.reduce((function(t,n,r){return n.from.coordinates[1]>e.edges[t].from.coordinates[1]&&(t=r),t}),0),n=(0===t?this.length:t)-1,r=(t+1)%this.length,i=pi(this.edges[n].from.coordinates,this.edges[t].from.coordinates,this.edges[r].from.coordinates);return 0===i?this.edges[n].from.coordinates[0]>this.edges[r].from.coordinates[0]:i>0},e.prototype.toMultiPoint=function(){return function(e,t,n){return void 0===n&&(n={}),rr({type:"MultiPoint",coordinates:e},t,n)}(this.edges.map((function(e){return e.from.coordinates})))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var e=this.edges.map((function(e){return e.from.coordinates}));return e.push(this.edges[0].from.coordinates),this.polygon=or([e])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=(e=this.toPolygon(),_r(fr(e)));var e},e.findEdgeRingContaining=function(e,t){var n,r,i=e.getEnvelope();return t.forEach((function(t){var o,s,a,l,c,u,h=t.getEnvelope();if(r&&(n=r.getEnvelope()),s=i,a=(o=h).geometry.coordinates[0].map((function(e){return e[0]})),l=o.geometry.coordinates[0].map((function(e){return e[1]})),c=s.geometry.coordinates[0].map((function(e){return e[0]})),u=s.geometry.coordinates[0].map((function(e){return e[1]})),(Math.max.apply(null,a)!==Math.max.apply(null,c)||Math.max.apply(null,l)!==Math.max.apply(null,u)||Math.min.apply(null,a)!==Math.min.apply(null,c)||Math.min.apply(null,l)!==Math.min.apply(null,u))&&fi(h,i)){for(var d=e.map((function(e){return e.from.coordinates})),p=void 0,f=function(e){t.some((function(t){return n=e,r=t.from.coordinates,n[0]===r[0]&&n[1]===r[1];var n,r}))||(p=e)},m=0,g=d;m<g.length;m++)f(g[m]);p&&t.inside(ir(p))&&(r&&!fi(n,h)||(r=t))}})),r},e.prototype.inside=function(e){return gr(e,this.toPolygon())},e}();const _i=vi;function xi(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(t){!function(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var n,r=new e;return n=function(e){var t,n,i;!function(e,t,n){if(!e)throw new Error("No feature passed");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)}(e,"LineString","Graph::fromGeoJson"),t=function(e,t){if(e){var n=r.getNode(e),i=r.getNode(t);r.addEdge(n,i)}return t},i=n,ur(e,(function(e,n,r,o,s){i=0===n?e:t(i,e)}),void 0)},dr(t,(function(e,t,r,i,o){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==n(rr(e,r,{bbox:i,id:o}),t,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l];if(!1===n(rr({type:s,coordinates:c},r),t,l))return!1}})),r},e.prototype.getNode=function(e){var t=gi.buildId(e),n=this.nodes[t];return n||(n=this.nodes[t]=new gi(e)),n},e.prototype.addEdge=function(e,t){var n=new yi(e,t),r=n.getSymetric();this.edges.push(n),this.edges.push(r)},e.prototype.deleteDangles=function(){var e=this;Object.keys(this.nodes).map((function(t){return e.nodes[t]})).forEach((function(t){return e._removeIfDangle(t)}))},e.prototype._removeIfDangle=function(e){var t=this;if(e.innerEdges.length<=1){var n=e.getOuterEdges().map((function(e){return e.to}));this.removeNode(e),n.forEach((function(e){return t._removeIfDangle(e)}))}},e.prototype.deleteCutEdges=function(){var e=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(t){t.label===t.symetric.label&&(e.removeEdge(t.symetric),e.removeEdge(t))}))},e.prototype._computeNextCWEdges=function(e){var t=this;void 0===e?Object.keys(this.nodes).forEach((function(e){return t._computeNextCWEdges(t.nodes[e])})):e.getOuterEdges().forEach((function(t,n){e.getOuterEdge((0===n?e.getOuterEdges().length:n)-1).symetric.next=t}))},e.prototype._computeNextCCWEdges=function(e,t){for(var n,r,i=e.getOuterEdges(),o=i.length-1;o>=0;--o){var s=i[o],a=s.symetric,l=void 0,c=void 0;s.label===t&&(l=s),a.label===t&&(c=a),l&&c&&(c&&(r=c),l&&(r&&(r.next=l,r=void 0),n||(n=l)))}r&&(r.next=n)},e.prototype._findLabeledEdgeRings=function(){var e=[],t=0;return this.edges.forEach((function(n){if(!(n.label>=0)){e.push(n);var r=n;do{r.label=t,r=r.next}while(!n.isEqual(r));t++}})),e},e.prototype.getEdgeRings=function(){var e=this;this._computeNextCWEdges(),this.edges.forEach((function(e){e.label=void 0})),this._findLabeledEdgeRings().forEach((function(t){e._findIntersectionNodes(t).forEach((function(n){e._computeNextCCWEdges(n,t.label)}))}));var t=[];return this.edges.forEach((function(n){n.ring||t.push(e._findEdgeRing(n))})),t},e.prototype._findIntersectionNodes=function(e){var t=[],n=e,r=function(){var r=0;n.from.getOuterEdges().forEach((function(t){t.label===e.label&&++r})),r>1&&t.push(n.from),n=n.next};do{r()}while(!e.isEqual(n));return t},e.prototype._findEdgeRing=function(e){var t=e,n=new _i;do{n.push(t),t.ring=n,t=t.next}while(!e.isEqual(t));return n},e.prototype.removeNode=function(e){var t=this;e.getOuterEdges().forEach((function(e){return t.removeEdge(e)})),e.innerEdges.forEach((function(e){return t.removeEdge(e)})),delete this.nodes[e.id]},e.prototype.removeEdge=function(e){this.edges=this.edges.filter((function(t){return!t.isEqual(e)})),e.deleteEdge()}}(),i(9996),i(303),i(2094);var bi={search:function(e,t,n,r){e.cleanDirty();var i=(r=r||{}).heuristic||bi.heuristics.manhattan,o=r.closest||!1,s=new Mi((function(e){return e.f})),a=t;for(t.h=i(t,n),s.push(t);s.size()>0;){var l=s.pop();if(l===n)return xi(l);l.closed=!0;for(var c=e.neighbors(l),u=0,h=c.length;u<h;++u){var d=c[u];if(!d.closed&&!d.isWall()){var p=l.g+d.getCost(l),f=d.visited;(!f||p<d.g)&&(d.visited=!0,d.parent=l,d.h=d.h||i(d,n),d.g=p,d.f=d.g+d.h,e.markDirty(d),o&&(d.h<a.h||d.h===a.h&&d.g<a.g)&&(a=d),f?s.rescoreElement(d):s.push(d))}}}return o?xi(a):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var n=Math.sqrt(2),r=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);return 1*(r+i)+(n-2)*Math.min(r,i)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function wi(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,i=e[n];r<i.length;r++){var o=new Si(n,r,i[r]);this.grid[n][r]=o,this.nodes.push(o)}}this.init()}function Si(e,t,n){this.x=e,this.y=t,this.weight=n}function Mi(e){this.content=[],this.scoreFunction=e}function Ei(){this._=null}function Ti(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Ci(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function Ai(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Ii(e){for(;e.L;)e=e.L;return e}wi.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)bi.cleanNode(this.nodes[e])},wi.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)bi.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},wi.prototype.markDirty=function(e){this.dirtyNodes.push(e)},wi.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,i=this.grid;return i[n-1]&&i[n-1][r]&&t.push(i[n-1][r]),i[n+1]&&i[n+1][r]&&t.push(i[n+1][r]),i[n]&&i[n][r-1]&&t.push(i[n][r-1]),i[n]&&i[n][r+1]&&t.push(i[n][r+1]),this.diagonal&&(i[n-1]&&i[n-1][r-1]&&t.push(i[n-1][r-1]),i[n+1]&&i[n+1][r-1]&&t.push(i[n+1][r-1]),i[n-1]&&i[n-1][r+1]&&t.push(i[n-1][r+1]),i[n+1]&&i[n+1][r+1]&&t.push(i[n+1][r+1])),t},wi.prototype.toString=function(){for(var e,t,n,r,i=[],o=this.grid,s=0,a=o.length;s<a;s++){for(e=[],n=0,r=(t=o[s]).length;n<r;n++)e.push(t[n].weight);i.push(e.join(" "))}return i.join("\n")},Si.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Si.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},Si.prototype.isWall=function(){return 0===this.weight},Mi.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var i,o=e+1<<1,s=o-1,a=null;if(s<t){var l=this.content[s];(i=this.scoreFunction(l))<r&&(a=s)}if(o<t){var c=this.content[o];this.scoreFunction(c)<(null===a?r:i)&&(a=o)}if(null===a)break;this.content[e]=this.content[a],this.content[a]=n,e=a}}},Ei.prototype={constructor:Ei,insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=Ii(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(Ci(this,n),n=(e=n).U),n.C=!1,r.C=!0,Ai(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(Ai(this,n),n=(e=n).U),n.C=!1,r.C=!0,Ci(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,o=e.L,s=e.R;if(n=o?s?Ii(s):o:s,i?i.L===e?i.L=n:i.R=n:this._=n,o&&s?(r=n.C,n.C=e.C,n.L=o,o.U=n,n!==s?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=s,s.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===i.L){if((t=i.R).C&&(t.C=!1,i.C=!0,Ci(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Ai(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,Ci(this,i),e=this._;break}}else if((t=i.L).C&&(t.C=!1,i.C=!0,Ai(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Ci(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,Ai(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}};const Pi=Ei;function Ri(e,t,n,r){var i=[null,null],o=to.push(i)-1;return i.left=e,i.right=t,n&&Di(i,e,t,n),r&&Di(i,t,e,r),Qi[e.index].halfedges.push(o),Qi[t.index].halfedges.push(o),i}function Li(e,t,n){var r=[t,n];return r.left=e,r}function Di(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function Oi(e,t,n,r,i){var o,s=e[0],a=e[1],l=s[0],c=s[1],u=0,h=1,d=a[0]-l,p=a[1]-c;if(o=t-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>u&&(u=o)}if(o=r-l,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<h&&(h=o)}if(o=n-c,p||!(o>0)){if(o/=p,p<0){if(o<u)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>u&&(u=o)}if(o=i-c,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>u&&(u=o)}else if(p>0){if(o<u)return;o<h&&(h=o)}return!(u>0||h<1)||(u>0&&(e[0]=[l+u*d,c+u*p]),h<1&&(e[1]=[l+h*d,c+h*p]),!0)}}}}}function Ni(e,t,n,r,i){var o=e[1];if(o)return!0;var s,a,l=e[0],c=e.left,u=e.right,h=c[0],d=c[1],p=u[0],f=u[1],m=(h+p)/2,g=(d+f)/2;if(f===d){if(m<t||m>=r)return;if(h>p){if(l){if(l[1]>=i)return}else l=[m,n];o=[m,i]}else{if(l){if(l[1]<n)return}else l=[m,i];o=[m,n]}}else if(a=g-(s=(h-p)/(f-d))*m,s<-1||s>1)if(h>p){if(l){if(l[1]>=i)return}else l=[(n-a)/s,n];o=[(i-a)/s,i]}else{if(l){if(l[1]<n)return}else l=[(i-a)/s,i];o=[(n-a)/s,n]}else if(d<f){if(l){if(l[0]>=r)return}else l=[t,s*t+a];o=[r,s*r+a]}else{if(l){if(l[0]<t)return}else l=[r,s*r+a];o=[t,s*t+a]}return e[0]=l,e[1]=o,!0}function ki(e,t){var n=e.site,r=t.left,i=t.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=t[1],i=t[0]):(r=t[0],i=t[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function Fi(e,t){return t[+(t.left!==e.site)]}function zi(e,t){return t[+(t.left===e.site)]}var Bi,Ui=[];function ji(){Ti(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vi(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,o=n.site;if(r!==o){var s=i[0],a=i[1],l=r[0]-s,c=r[1]-a,u=o[0]-s,h=o[1]-a,d=2*(l*h-c*u);if(!(d>=-ro)){var p=l*l+c*c,f=u*u+h*h,m=(h*p-c*f)/d,g=(l*f-u*p)/d,y=Ui.pop()||new ji;y.arc=e,y.site=i,y.x=m+s,y.y=(y.cy=g+a)+Math.sqrt(m*m+g*g),e.circle=y;for(var v=null,_=eo._;_;)if(y.y<_.y||y.y===_.y&&y.x<=_.x){if(!_.L){v=_.P;break}_=_.L}else{if(!_.R){v=_;break}_=_.R}eo.insert(v,y),v||(Bi=y)}}}}function Gi(e){var t=e.circle;t&&(t.P||(Bi=t.N),eo.remove(t),Ui.push(t),Ti(t),e.circle=null)}var Hi=[];function Zi(){Ti(this),this.edge=this.site=this.circle=null}function Wi(e){var t=Hi.pop()||new Zi;return t.site=e,t}function $i(e){Gi(e),Ji.remove(e),Hi.push(e),Ti(e)}function qi(e){var t=e.circle,n=t.x,r=t.cy,i=[n,r],o=e.P,s=e.N,a=[e];$i(e);for(var l=o;l.circle&&Math.abs(n-l.circle.x)<no&&Math.abs(r-l.circle.cy)<no;)o=l.P,a.unshift(l),$i(l),l=o;a.unshift(l),Gi(l);for(var c=s;c.circle&&Math.abs(n-c.circle.x)<no&&Math.abs(r-c.circle.cy)<no;)s=c.N,a.push(c),$i(c),c=s;a.push(c),Gi(c);var u,h=a.length;for(u=1;u<h;++u)c=a[u],l=a[u-1],Di(c.edge,l.site,c.site,i);l=a[0],(c=a[h-1]).edge=Ri(l.site,c.site,null,i),Vi(l),Vi(c)}function Xi(e){for(var t,n,r,i,o=e[0],s=e[1],a=Ji._;a;)if((r=Yi(a,s)-o)>no)a=a.L;else{if(!((i=o-Ki(a,s))>no)){r>-no?(t=a.P,n=a):i>-no?(t=a,n=a.N):t=n=a;break}if(!a.R){t=a;break}a=a.R}!function(e){Qi[e.index]={site:e,halfedges:[]}}(e);var l=Wi(e);if(Ji.insert(t,l),t||n){if(t===n)return Gi(t),n=Wi(t.site),Ji.insert(l,n),l.edge=n.edge=Ri(t.site,l.site),Vi(t),void Vi(n);if(n){Gi(t),Gi(n);var c=t.site,u=c[0],h=c[1],d=e[0]-u,p=e[1]-h,f=n.site,m=f[0]-u,g=f[1]-h,y=2*(d*g-p*m),v=d*d+p*p,_=m*m+g*g,x=[(g*v-p*_)/y+u,(d*_-m*v)/y+h];Di(n.edge,c,f,x),l.edge=Ri(c,e,null,x),n.edge=Ri(e,f,null,x),Vi(t),Vi(n)}else l.edge=Ri(t.site,l.site)}}function Yi(e,t){var n=e.site,r=n[0],i=n[1],o=i-t;if(!o)return r;var s=e.P;if(!s)return-1/0;var a=(n=s.site)[0],l=n[1],c=l-t;if(!c)return a;var u=a-r,h=1/o-1/c,d=u/c;return h?(-d+Math.sqrt(d*d-2*h*(u*u/(-2*c)-l+c/2+i-o/2)))/h+r:(r+a)/2}function Ki(e,t){var n=e.N;if(n)return Yi(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var Ji,Qi,eo,to,no=1e-6,ro=1e-12;function io(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function oo(e,t){return t[1]-e[1]||t[0]-e[0]}function so(e,t){var n,r,i,o=e.sort(oo).pop();for(to=[],Qi=new Array(e.length),Ji=new Pi,eo=new Pi;;)if(i=Bi,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(Xi(o),n=o[0],r=o[1]),o=e.pop();else{if(!i)break;qi(i.arc)}if(function(){for(var e,t,n,r,i=0,o=Qi.length;i<o;++i)if((e=Qi[i])&&(r=(t=e.halfedges).length)){var s=new Array(r),a=new Array(r);for(n=0;n<r;++n)s[n]=n,a[n]=ki(e,to[t[n]]);for(s.sort((function(e,t){return a[t]-a[e]})),n=0;n<r;++n)a[n]=t[s[n]];for(n=0;n<r;++n)t[n]=a[n]}}(),t){var s=+t[0][0],a=+t[0][1],l=+t[1][0],c=+t[1][1];!function(e,t,n,r){for(var i,o=to.length;o--;)Ni(i=to[o],e,t,n,r)&&Oi(i,e,t,n,r)&&(Math.abs(i[0][0]-i[1][0])>no||Math.abs(i[0][1]-i[1][1])>no)||delete to[o]}(s,a,l,c),function(e,t,n,r){var i,o,s,a,l,c,u,h,d,p,f,m,g=Qi.length,y=!0;for(i=0;i<g;++i)if(o=Qi[i]){for(s=o.site,a=(l=o.halfedges).length;a--;)to[l[a]]||l.splice(a,1);for(a=0,c=l.length;a<c;)f=(p=zi(o,to[l[a]]))[0],m=p[1],h=(u=Fi(o,to[l[++a%c]]))[0],d=u[1],(Math.abs(f-h)>no||Math.abs(m-d)>no)&&(l.splice(a,0,to.push(Li(s,p,Math.abs(f-e)<no&&r-m>no?[e,Math.abs(h-e)<no?d:r]:Math.abs(m-r)<no&&n-f>no?[Math.abs(d-r)<no?h:n,r]:Math.abs(f-n)<no&&m-t>no?[n,Math.abs(h-n)<no?d:t]:Math.abs(m-t)<no&&f-e>no?[Math.abs(d-t)<no?h:e,t]:null))-1),++c);c&&(y=!1)}if(y){var v,_,x,b=1/0;for(i=0,y=null;i<g;++i)(o=Qi[i])&&(x=(v=(s=o.site)[0]-e)*v+(_=s[1]-t)*_)<b&&(b=x,y=o);if(y){var w=[e,t],S=[e,r],M=[n,r],E=[n,t];y.halfedges.push(to.push(Li(s=y.site,w,S))-1,to.push(Li(s,S,M))-1,to.push(Li(s,M,E))-1,to.push(Li(s,E,w))-1)}}for(i=0;i<g;++i)(o=Qi[i])&&(o.halfedges.length||delete Qi[i])}(s,a,l,c)}this.edges=to,this.cells=Qi,Ji=eo=to=Qi=null}so.prototype={constructor:so,polygons:function(){var e=this.edges;return this.cells.map((function(t){var n=t.halfedges.map((function(n){return Fi(t,e[n])}));return n.data=t.site.data,n}))},triangles:function(){var e=[],t=this.edges;return this.cells.forEach((function(n,r){if(o=(i=n.halfedges).length)for(var i,o,s,a=n.site,l=-1,c=t[i[o-1]],u=c.left===a?c.right:c.left;++l<o;)s=u,u=(c=t[i[l]]).left===a?c.right:c.left,s&&u&&r<s.index&&r<u.index&&io(a,s,u)<0&&e.push([a.data,s.data,u.data])})),e},links:function(){return this.edges.filter((function(e){return e.right})).map((function(e){return{source:e.left.data,target:e.right.data}}))},find:function(e,t,n){for(var r,i,o=this,s=o._found||0,a=o.cells.length;!(i=o.cells[s]);)if(++s>=a)return null;var l=e-i.site[0],c=t-i.site[1],u=l*l+c*c;do{i=o.cells[r=s],s=null,i.halfedges.forEach((function(n){var r=o.edges[n],a=r.left;if(a!==i.site&&a||(a=r.right)){var l=e-a[0],c=t-a[1],h=l*l+c*c;h<u&&(u=h,s=a.index)}}))}while(null!==s);return o._found=r,null==n||u<=n*n?i.site:null}},i(906);var ao=i(1062);function lo(){return new co}function co(){this.reset()}co.prototype={constructor:co,reset:function(){this.s=this.t=0},add:function(e){ho(uo,e,this.t),ho(this,uo.s,this.s),this.s?this.t+=uo.t:this.s=uo.t},valueOf:function(){return this.s}};var uo=new co;function ho(e,t,n){var r=e.s=t+n,i=r-t,o=r-i;e.t=t-o+(n-i)}var po=1e-6,fo=Math.PI,mo=fo/2,go=fo/4,yo=2*fo,vo=180/fo,_o=fo/180,xo=Math.abs,bo=Math.atan,wo=Math.atan2,So=Math.cos,Mo=(Math.ceil,Math.exp,Math.floor,Math.log,Math.pow,Math.sin),Eo=(Math.sign,Math.sqrt);Math.tan;function To(e){return e>1?0:e<-1?fo:Math.acos(e)}function Co(e){return e>1?mo:e<-1?-mo:Math.asin(e)}function Ao(){}function Io(e,t){e&&Do.hasOwnProperty(e.type)&&Do[e.type](e,t)}var Po,Ro,Lo={Feature:function(e,t){Io(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)Io(n[r].geometry,t)}},Do={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Oo(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Oo(n[r],t,0)},Polygon:function(e,t){No(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)No(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)Io(n[r],t)}};function Oo(e,t,n){var r,i=-1,o=e.length-n;for(t.lineStart();++i<o;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function No(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Oo(e[n],t,1);t.polygonEnd()}function ko(e){return[wo(e[1],e[0]),Co(e[2])]}function Fo(e){var t=e[0],n=e[1],r=So(n);return[r*So(t),r*Mo(t),Mo(n)]}function zo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Bo(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Uo(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function jo(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Vo(e){var t=Eo(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Go(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Ho(e,t){return[e>fo?e-yo:e<-fo?e+yo:e,t]}function Zo(e){return function(t,n){return[(t+=e)>fo?t-yo:t<-fo?t+yo:t,n]}}function Wo(e){var t=Zo(e);return t.invert=Zo(-e),t}function $o(e,t){var n=So(e),r=Mo(e),i=So(t),o=Mo(t);function s(e,t){var s=So(t),a=So(e)*s,l=Mo(e)*s,c=Mo(t),u=c*n+a*r;return[wo(l*i-u*o,a*n-c*r),Co(u*i+l*o)]}return s.invert=function(e,t){var s=So(t),a=So(e)*s,l=Mo(e)*s,c=Mo(t),u=c*i-l*o;return[wo(l*i+c*o,a*n+u*r),Co(u*n-a*r)]},s}function qo(e,t){(t=Fo(t))[0]-=e,Vo(t);var n=To(-t[1]);return((-t[2]<0?-n:n)+yo-po)%yo}function Xo(){var e,t=[];return{point:function(t,n){e.push([t,n])},lineStart:function(){t.push(e=[])},lineEnd:Ao,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Yo(e,t){return xo(e[0]-t[0])<po&&xo(e[1]-t[1])<po}function Ko(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Jo(e,t,n,r,i){var o,s,a=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],s=e[t];if(Yo(r,s)){for(i.lineStart(),o=0;o<t;++o)i.point((r=e[o])[0],r[1]);i.lineEnd()}else a.push(n=new Ko(r,e,null,!0)),l.push(n.o=new Ko(r,null,n,!1)),a.push(n=new Ko(s,e,null,!1)),l.push(n.o=new Ko(s,null,n,!0))}})),a.length){for(l.sort(t),Qo(a),Qo(l),o=0,s=l.length;o<s;++o)l[o].e=n=!n;for(var c,u,h=a[0];;){for(var d=h,p=!0;d.v;)if((d=d.n)===h)return;c=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(p)for(o=0,s=c.length;o<s;++o)i.point((u=c[o])[0],u[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(p)for(c=d.p.z,o=c.length-1;o>=0;--o)i.point((u=c[o])[0],u[1]);else r(d.x,d.p.x,-1,i);d=d.p}c=(d=d.o).z,p=!p}while(!d.v);i.lineEnd()}}}function Qo(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function es(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}lo(),lo(),lo(),Ho.invert=Ho,1===(Po=es).length&&(Ro=Po,Po=function(e,t){return es(Ro(e),t)});var ts=Array.prototype;function ns(e){for(var t,n,r,i=e.length,o=-1,s=0;++o<i;)s+=e[o].length;for(n=new Array(s);--i>=0;)for(t=(r=e[i]).length;--t>=0;)n[--s]=r[t];return n}ts.slice,ts.map,Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var rs=1e9,is=-rs;var os=lo();lo(),lo(),lo();var ss=1/0,as=ss,ls=-ss,cs=ls;const us={point:function(e,t){e<ss&&(ss=e),e>ls&&(ls=e),t<as&&(as=t),t>cs&&(cs=t)},lineStart:Ao,lineEnd:Ao,polygonStart:Ao,polygonEnd:Ao,result:function(){var e=[[ss,as],[ls,cs]];return ls=cs=-(as=ss=1/0),e}};function hs(e,t,n,r){return function(i,o){var s,a,l,c=t(o),u=i.invert(r[0],r[1]),h=Xo(),d=t(h),p=!1,f={point:m,lineStart:y,lineEnd:v,polygonStart:function(){f.point=_,f.lineStart=x,f.lineEnd=b,a=[],s=[]},polygonEnd:function(){f.point=m,f.lineStart=y,f.lineEnd=v,a=ns(a);var e=function(e,t){var n=t[0],r=t[1],i=[Mo(n),-So(n),0],o=0,s=0;os.reset();for(var a=0,l=e.length;a<l;++a)if(u=(c=e[a]).length)for(var c,u,h=c[u-1],d=h[0],p=h[1]/2+go,f=Mo(p),m=So(p),g=0;g<u;++g,d=v,f=x,m=b,h=y){var y=c[g],v=y[0],_=y[1]/2+go,x=Mo(_),b=So(_),w=v-d,S=w>=0?1:-1,M=S*w,E=M>fo,T=f*x;if(os.add(wo(T*S*Mo(M),m*b+T*So(M))),o+=E?w+S*yo:w,E^d>=n^v>=n){var C=Bo(Fo(h),Fo(y));Vo(C);var A=Bo(i,C);Vo(A);var I=(E^w>=0?-1:1)*Co(A[2]);(r>I||r===I&&(C[0]||C[1]))&&(s+=E^w>=0?1:-1)}}return(o<-po||o<po&&os<-po)^1&s}(s,u);a.length?(p||(o.polygonStart(),p=!0),Jo(a,ps,e,n,o)):e&&(p||(o.polygonStart(),p=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),p&&(o.polygonEnd(),p=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function m(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&o.point(t,n)}function g(e,t){var n=i(e,t);c.point(n[0],n[1])}function y(){f.point=g,c.lineStart()}function v(){f.point=m,c.lineEnd()}function _(e,t){l.push([e,t]);var n=i(e,t);d.point(n[0],n[1])}function x(){d.lineStart(),l=[]}function b(){_(l[0][0],l[0][1]),d.lineEnd();var e,t,n,r,i=d.clean(),c=h.result(),u=c.length;if(l.pop(),s.push(l),l=null,u)if(1&i){if((t=(n=c[0]).length-1)>0){for(p||(o.polygonStart(),p=!0),o.lineStart(),e=0;e<t;++e)o.point((r=n[e])[0],r[1]);o.lineEnd()}}else u>1&&2&i&&c.push(c.pop().concat(c.shift())),a.push(c.filter(ds))}return f}}function ds(e){return e.length>1}function ps(e,t){return((e=e.x)[0]<0?e[1]-mo-po:mo-e[1])-((t=t.x)[0]<0?t[1]-mo-po:mo-t[1])}lo();const fs=hs((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(o,s){var a=o>0?fo:-fo,l=xo(o-n);xo(l-fo)<po?(e.point(n,r=(r+s)/2>0?mo:-mo),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(o,r),t=0):i!==a&&l>=fo&&(xo(n-i)<po&&(n-=i*po),xo(o-a)<po&&(o-=a*po),r=function(e,t,n,r){var i,o,s=Mo(e-n);return xo(s)>po?bo((Mo(t)*(o=So(r))*Mo(n)-Mo(r)*(i=So(t))*Mo(e))/(i*o*s)):(t+r)/2}(n,r,o,s),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(a,r),t=0),e.point(n=o,r=s),i=a},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*mo,r.point(-fo,i),r.point(0,i),r.point(fo,i),r.point(fo,0),r.point(fo,-i),r.point(0,-i),r.point(-fo,-i),r.point(-fo,0),r.point(-fo,i);else if(xo(e[0]-t[0])>po){var o=e[0]<t[0]?fo:-fo;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(t[0],t[1])}),[-fo,-mo]);function ms(e){return e}function gs(e){return function(t){var n=new ys;for(var r in e)n[r]=e[r];return n.stream=t,n}}function ys(){}function vs(e,t,n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],o=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=o&&e.clipExtent(null),function(e,t){e&&Lo.hasOwnProperty(e.type)?Lo[e.type](e,t):Io(e,t)}(n,e.stream(us));var s=us.result(),a=Math.min(r/(s[1][0]-s[0][0]),i/(s[1][1]-s[0][1])),l=+t[0][0]+(r-a*(s[1][0]+s[0][0]))/2,c=+t[0][1]+(i-a*(s[1][1]+s[0][1]))/2;return null!=o&&e.clipExtent(o),e.scale(150*a).translate([l,c])}ys.prototype={constructor:ys,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var _s=16,xs=So(30*_o);function bs(e,t){return+t?function(e,t){function n(r,i,o,s,a,l,c,u,h,d,p,f,m,g){var y=c-r,v=u-i,_=y*y+v*v;if(_>4*t&&m--){var x=s+d,b=a+p,w=l+f,S=Eo(x*x+b*b+w*w),M=Co(w/=S),E=xo(xo(w)-1)<po||xo(o-h)<po?(o+h)/2:wo(b,x),T=e(E,M),C=T[0],A=T[1],I=C-r,P=A-i,R=v*I-y*P;(R*R/_>t||xo((y*I+v*P)/_-.5)>.3||s*d+a*p+l*f<xs)&&(n(r,i,o,s,a,l,C,A,E,x/=S,b/=S,w,m,g),g.point(C,A),n(C,A,E,x,b,w,c,u,h,d,p,f,m,g))}}return function(t){var r,i,o,s,a,l,c,u,h,d,p,f,m={point:g,lineStart:y,lineEnd:_,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){u=NaN,m.point=v,t.lineStart()}function v(r,i){var o=Fo([r,i]),s=e(r,i);n(u,h,c,d,p,f,u=s[0],h=s[1],c=r,d=o[0],p=o[1],f=o[2],_s,t),t.point(u,h)}function _(){m.point=g,t.lineEnd()}function x(){y(),m.point=b,m.lineEnd=w}function b(e,t){v(r=e,t),i=u,o=h,s=d,a=p,l=f,m.point=v}function w(){n(u,h,c,d,p,f,i,o,r,s,a,l,_s,t),m.lineEnd=_,_()}return m}}(e,t):function(e){return gs({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var ws=gs({point:function(e,t){this.stream.point(e*_o,t*_o)}});function Ss(e){return function(e){var t,n,r,i,o,s,a,l,c,u,h=150,d=480,p=250,f=0,m=0,g=0,y=0,v=0,_=null,x=fs,b=null,w=ms,S=.5,M=bs(C,S);function E(e){return[(e=o(e[0]*_o,e[1]*_o))[0]*h+n,r-e[1]*h]}function T(e){return(e=o.invert((e[0]-n)/h,(r-e[1])/h))&&[e[0]*vo,e[1]*vo]}function C(e,i){return[(e=t(e,i))[0]*h+n,r-e[1]*h]}function A(){o=Go(i=function(e,t,n){return(e%=yo)?t||n?Go(Wo(e),$o(t,n)):Wo(e):t||n?$o(t,n):Ho}(g,y,v),t);var e=t(f,m);return n=d-e[0]*h,r=p+e[1]*h,I()}function I(){return c=u=null,E}return E.stream=function(e){return c&&u===e?c:c=ws(x(i,M(w(u=e))))},E.clipAngle=function(e){return arguments.length?(x=+e?function(e,t){var n=So(e),r=n>0,i=xo(n)>po;function o(e,t){return So(e)*So(t)>n}function s(e,t,r){var i=[1,0,0],o=Bo(Fo(e),Fo(t)),s=zo(o,o),a=o[0],l=s-a*a;if(!l)return!r&&e;var c=n*s/l,u=-n*a/l,h=Bo(i,o),d=jo(i,c);Uo(d,jo(o,u));var p=h,f=zo(d,p),m=zo(p,p),g=f*f-m*(zo(d,d)-1);if(!(g<0)){var y=Eo(g),v=jo(p,(-f-y)/m);if(Uo(v,d),v=ko(v),!r)return v;var _,x=e[0],b=t[0],w=e[1],S=t[1];b<x&&(_=x,x=b,b=_);var M=b-x,E=xo(M-fo)<po;if(!E&&S<w&&(_=w,w=S,S=_),E||M<po?E?w+S>0^v[1]<(xo(v[0]-x)<po?w:S):w<=v[1]&&v[1]<=S:M>fo^(x<=v[0]&&v[0]<=b)){var T=jo(p,(-f+y)/m);return Uo(T,d),[v,ko(T)]}}}function a(t,n){var i=r?e:fo-e,o=0;return t<-i?o|=1:t>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return hs(o,(function(e){var t,n,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,d){var p,f=[h,d],m=o(h,d),g=r?m?0:a(h,d):m?a(h+(h<0?fo:-fo),d):0;if(!t&&(c=l=m)&&e.lineStart(),m!==l&&(!(p=s(t,f))||Yo(t,p)||Yo(f,p))&&(f[0]+=po,f[1]+=po,m=o(f[0],f[1])),m!==l)u=0,m?(e.lineStart(),p=s(f,t),e.point(p[0],p[1])):(p=s(t,f),e.point(p[0],p[1]),e.lineEnd()),t=p;else if(i&&t&&r^m){var y;g&n||!(y=s(f,t,!0))||(u=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1])))}!m||t&&Yo(t,f)||e.point(f[0],f[1]),t=f,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return u|(c&&l)<<1}}}),(function(n,r,i,o){!function(e,t,n,r,i,o){if(n){var s=So(t),a=Mo(t),l=r*n;null==i?(i=t+r*yo,o=t-l/2):(i=qo(s,i),o=qo(s,o),(r>0?i<o:i>o)&&(i+=r*yo));for(var c,u=i;r>0?u>o:u<o;u-=l)c=ko([s,-a*So(u),-a*Mo(u)]),e.point(c[0],c[1])}}(o,e,t,i,n,r)}),r?[0,-e]:[-fo,e-fo])}(_=e*_o,6*_o):(_=null,fs),I()):_*vo},E.clipExtent=function(e){return arguments.length?(w=null==e?(b=s=a=l=null,ms):function(e,t,n,r){function i(i,o){return e<=i&&i<=n&&t<=o&&o<=r}function o(i,o,a,c){var u=0,h=0;if(null==i||(u=s(i,a))!==(h=s(o,a))||l(i,o)<0^a>0)do{c.point(0===u||3===u?e:n,u>1?r:t)}while((u=(u+a+4)%4)!==h);else c.point(o[0],o[1])}function s(r,i){return xo(r[0]-e)<po?i>0?0:3:xo(r[0]-n)<po?i>0?2:1:xo(r[1]-t)<po?i>0?1:0:i>0?3:2}function a(e,t){return l(e.x,t.x)}function l(e,t){var n=s(e,1),r=s(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){var l,c,u,h,d,p,f,m,g,y,v,_=s,x=Xo(),b={point:w,lineStart:function(){b.point=S,c&&c.push(u=[]),y=!0,g=!1,f=m=NaN},lineEnd:function(){l&&(S(h,d),p&&g&&x.rejoin(),l.push(x.result())),b.point=w,g&&_.lineEnd()},polygonStart:function(){_=x,l=[],c=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=c.length;n<i;++n)for(var o,s,a=c[n],l=1,u=a.length,h=a[0],d=h[0],p=h[1];l<u;++l)o=d,s=p,d=(h=a[l])[0],p=h[1],s<=r?p>r&&(d-o)*(r-s)>(p-s)*(e-o)&&++t:p<=r&&(d-o)*(r-s)<(p-s)*(e-o)&&--t;return t}(),n=v&&t,i=(l=ns(l)).length;(n||i)&&(s.polygonStart(),n&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),i&&Jo(l,a,t,o,s),s.polygonEnd()),_=s,l=c=u=null}};function w(e,t){i(e,t)&&_.point(e,t)}function S(o,s){var a=i(o,s);if(c&&u.push([o,s]),y)h=o,d=s,p=a,y=!1,a&&(_.lineStart(),_.point(o,s));else if(a&&g)_.point(o,s);else{var l=[f=Math.max(is,Math.min(rs,f)),m=Math.max(is,Math.min(rs,m))],x=[o=Math.max(is,Math.min(rs,o)),s=Math.max(is,Math.min(rs,s))];!function(e,t,n,r,i,o){var s,a=e[0],l=e[1],c=0,u=1,h=t[0]-a,d=t[1]-l;if(s=n-a,h||!(s>0)){if(s/=h,h<0){if(s<c)return;s<u&&(u=s)}else if(h>0){if(s>u)return;s>c&&(c=s)}if(s=i-a,h||!(s<0)){if(s/=h,h<0){if(s>u)return;s>c&&(c=s)}else if(h>0){if(s<c)return;s<u&&(u=s)}if(s=r-l,d||!(s>0)){if(s/=d,d<0){if(s<c)return;s<u&&(u=s)}else if(d>0){if(s>u)return;s>c&&(c=s)}if(s=o-l,d||!(s<0)){if(s/=d,d<0){if(s>u)return;s>c&&(c=s)}else if(d>0){if(s<c)return;s<u&&(u=s)}return c>0&&(e[0]=a+c*h,e[1]=l+c*d),u<1&&(t[0]=a+u*h,t[1]=l+u*d),!0}}}}}(l,x,e,t,n,r)?a&&(_.lineStart(),_.point(o,s),v=!1):(g||(_.lineStart(),_.point(l[0],l[1])),_.point(x[0],x[1]),a||_.lineEnd(),v=!1)}f=o,m=s,g=a}return b}}(b=+e[0][0],s=+e[0][1],a=+e[1][0],l=+e[1][1]),I()):null==b?null:[[b,s],[a,l]]},E.scale=function(e){return arguments.length?(h=+e,A()):h},E.translate=function(e){return arguments.length?(d=+e[0],p=+e[1],A()):[d,p]},E.center=function(e){return arguments.length?(f=e[0]%360*_o,m=e[1]%360*_o,A()):[f*vo,m*vo]},E.rotate=function(e){return arguments.length?(g=e[0]%360*_o,y=e[1]%360*_o,v=e.length>2?e[2]%360*_o:0,A()):[g*vo,y*vo,v*vo]},E.precision=function(e){return arguments.length?(M=bs(C,S=e*e),I()):Eo(S)},E.fitExtent=function(e,t){return vs(E,e,t)},E.fitSize=function(e,t){return function(e,t,n){return vs(e,[[0,0],t],n)}(E,e,t)},function(){return t=e.apply(this,arguments),E.invert=t.invert&&T,A()}}((function(){return e}))()}function Ms(e){return function(t,n){var r=So(t),i=So(n),o=e(r*i);return[o*i*Mo(t),o*Mo(n)]}}function Es(e){return function(t,n){var r=Eo(t*t+n*n),i=e(r),o=Mo(i),s=So(i);return[wo(t*o,r*s),Co(r&&n*o/r)]}}Ms((function(e){return Eo(2/(1+e))})).invert=Es((function(e){return 2*Co(e/2)}));var Ts=Ms((function(e){return(e=To(e))&&e/Mo(e)}));function Cs(e,t){return[e,t]}function As(e,t,n,r){var i=e.properties||{},o="Feature"===e.type?e.geometry:e;if("GeometryCollection"===o.type){var s=[];return dr(e,(function(e){var i=As(e,t,n,r);i&&s.push(i)})),sr(s)}var a=function(e){var t=function(e,t){void 0===t&&(t={});var n=fr(e);return ir([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}(e).geometry.coordinates,n=[-t[0],-t[1]];return Ss(Ts).scale(79.4188).clipAngle(179.999).rotate(n).scale(tr)}(o),l={type:o.type,coordinates:Ps(o.coordinates,a)},c=(new ao.GeoJSONReader).read(l),u=ar(function(e,t){void 0===t&&(t="kilometers");var n=nr[t];if(!n)throw new Error(t+" units is invalid");return e/n}(t,n),"meters"),h=ao.BufferOp.bufferOp(c,u,r);if(!Is((h=(new ao.GeoJSONWriter).write(h)).coordinates))return rr({type:h.type,coordinates:Rs(h.coordinates,a)},i)}function Is(e){return Array.isArray(e[0])?Is(e[0]):isNaN(e[0])}function Ps(e,t){return"object"!=typeof e[0]?t(e):e.map((function(e){return Ps(e,t)}))}function Rs(e,t){return"object"!=typeof e[0]?t.invert(e):e.map((function(e){return Rs(e,t)}))}Ts.invert=Es((function(e){return e})),Cs.invert=Cs,Es(bo),Es(Co),Es((function(e){return 2*bo(e)}));function Ls(e){e.setTerrain(null),e.getLayer("sky")&&e.removeLayer("sky"),e.getSource("mapbox-dem")&&setTimeout((()=>e.removeSource("mapbox-dem")),100)}const Ds={COMB:"comb",CROSSHATCH:"crosshatch",DOTS:"dots",DOTSONELINE:"dotsoneline",FILL:"fill"},Os={ARROW:"arrow",EVENT:"event",ARP:"ARP",BASIC_RADIO:"BasicRadio",DESIGNATED_POINT:"DesignatedPoint",LIGHTED_GROUP_OBSTACLES:"LightedGroupObstacles",LIGHTED_OBSTACLE:"LightedObstacle",OBSTACLE:"Obstacle",DME:"DME",NDB:"NDB",NONE:"None",TACAN:"TACAN",VOR:"VOR"};function Ns(e){Object.values(Ds).forEach((t=>{e.loadImage(`/asset/image/pattern/${t}.png`,((n,r)=>{n?console.error(`Failed to fetch image ${t}\nError: `,n):!e.listImages().includes(t)&&e.addImage(t,r,{sdf:!0})}))})),Object.values(Os).forEach((t=>{e.loadImage(`/asset/image/icon/${t}.png`,((n,r)=>{n?console.error(`Failed to fetch image ${t}\nError: `,n):!e.listImages().includes(t)&&e.addImage(t,r,{sdf:!0})}))}))}function ks(e){var t;return!e||!e.parent&&(0,$e.isEmpty)(e.userData)?null:null!=e&&null!==(t=e.userData)&&void 0!==t&&t.identifier?e.userData:ks(e.parent)}var Fs=i(6158),zs=i.n(Fs),Bs=i(1462);var Us=i(4132),js=i.n(Us),Vs=i(7657),Gs=i.n(Vs);const Hs="159",Zs=1,Ws=2,$s=3,qs=100,Xs=0,Ys=1,Ks=2,Js=0,Qs=1,ea=2,ta=3,na=4,ra=5,ia=301,oa=302,sa=306,aa=1e3,la=1001,ca=1002,ua=1003,ha=1005,da=1006,pa=1008,fa=1009,ma=1012,ga=1014,ya=1015,va=1016,_a=1020,xa=1023,ba=1026,wa=1027,Sa=33776,Ma=33777,Ea=33778,Ta=33779,Ca=36492,Aa=2300,Ia=2301,Pa=2302,Ra=3001,La="",Da="srgb",Oa="srgb-linear",Na="display-p3",ka="display-p3-linear",Fa="linear",za="srgb",Ba="rec709",Ua="p3",ja=7680,Va="300 es",Ga=1035,Ha=2e3,Za=2001;class Wa{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const $a=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],qa=Math.PI/180,Xa=180/Math.PI;function Ya(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return($a[255&e]+$a[e>>8&255]+$a[e>>16&255]+$a[e>>24&255]+"-"+$a[255&t]+$a[t>>8&255]+"-"+$a[t>>16&15|64]+$a[t>>24&255]+"-"+$a[63&n|128]+$a[n>>8&255]+"-"+$a[n>>16&255]+$a[n>>24&255]+$a[255&r]+$a[r>>8&255]+$a[r>>16&255]+$a[r>>24&255]).toLowerCase()}function Ka(e,t,n){return Math.max(t,Math.min(n,e))}function Ja(e,t,n){return(1-n)*e+n*t}function Qa(e){return 0==(e&e-1)&&0!==e}function el(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function tl(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function nl(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;rl.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ka(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class il{constructor(e,t,n,r,i,o,s,a,l){il.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,o,s,a,l)}set(e,t,n,r,i,o,s,a,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=s,c[3]=t,c[4]=i,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],y=r[1],v=r[4],_=r[7],x=r[2],b=r[5],w=r[8];return i[0]=o*f+s*y+a*x,i[3]=o*m+s*v+a*b,i[6]=o*g+s*_+a*w,i[1]=l*f+c*y+u*x,i[4]=l*m+c*v+u*b,i[7]=l*g+c*_+u*w,i[2]=h*f+d*y+p*x,i[5]=h*m+d*v+p*b,i[8]=h*g+d*_+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*s*l-n*i*c+n*s*a+r*i*l-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=c*o-s*l,h=s*a-c*i,d=l*i-o*a,p=t*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(s*n-r*o)*f,e[3]=h*f,e[4]=(c*t-r*a)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),l=Math.sin(i);return this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-r*l,r*a,-r*(-l*o+a*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(ol.makeScale(e,t)),this}rotate(e){return this.premultiply(ol.makeRotation(-e)),this}translate(e,t){return this.premultiply(ol.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const ol=new il;function sl(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function al(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ll(){const e=al("canvas");return e.style.display="block",e}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const cl={};function ul(e){e in cl||(cl[e]=!0,console.warn(e))}const hl=(new il).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),dl=(new il).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pl={[Oa]:{transfer:Fa,primaries:Ba,toReference:e=>e,fromReference:e=>e},[Da]:{transfer:za,primaries:Ba,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[ka]:{transfer:Fa,primaries:Ua,toReference:e=>e.applyMatrix3(dl),fromReference:e=>e.applyMatrix3(hl)},[Na]:{transfer:za,primaries:Ua,toReference:e=>e.convertSRGBToLinear().applyMatrix3(dl),fromReference:e=>e.applyMatrix3(hl).convertLinearToSRGB()}},fl=new Set([Oa,ka]),ml={enabled:!0,_workingColorSpace:Oa,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!fl.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;const r=pl[t].toReference;return(0,pl[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return pl[e].primaries},getTransfer:function(e){return e===La?Fa:pl[e].transfer}};function gl(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function yl(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let vl;class _l{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===vl&&(vl=al("canvas")),vl.width=e.width,vl.height=e.height;const n=vl.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=vl}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=al("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*gl(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*gl(t[e]/255)):t[e]=gl(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let xl=0;class bl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:xl++}),this.uuid=Ya(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(wl(r[t].image)):e.push(wl(r[t]))}else e=wl(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function wl(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?_l.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Sl=0;class Ml extends Wa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ml.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ml.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:la,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:la,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:da,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:pa,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:xa,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:fa,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Ml.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:La;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Sl++}),this.uuid=Ya(),this.name="",this.source=new bl(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=a,this.offset=new rl(0,0),this.repeat=new rl(1,1),this.center=new rl(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new il,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(ul("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Ra?Da:La),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){void 0===e&&(e=null),this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case aa:e.x=e.x-Math.floor(e.x);break;case la:e.x=e.x<0?0:1;break;case ca:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case aa:e.y=e.y-Math.floor(e.y);break;case la:e.y=e.y<0?0:1;break;case ca:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ul("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Da?Ra:3e3}set encoding(e){ul("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ra?Da:La}}Ml.DEFAULT_IMAGE=null,Ml.DEFAULT_MAPPING=300,Ml.DEFAULT_ANISOTROPY=1;class El{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;El.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,s=.1,a=e.elements,l=a[0],c=a[4],u=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(p-m)<o){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(d+1)/2,y=(g+1)/2,v=(c+h)/4,_=(u+f)/4,x=(p+m)/4;return e>a&&e>y?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=_/n):a>y?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=x/r):y<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(y),n=_/i,r=x/i),this.set(n,r,i,t),this}let y=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(y)<.001&&(y=1),this.x=(m-p)/y,this.y=(u-f)/y,this.z=(h-c)/y,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Tl extends Wa{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new El(0,0,e,t),this.scissorTest=!1,this.viewport=new El(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==n.encoding&&(ul("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Ra?Da:La),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:da,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Ml(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bl(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Cl extends Tl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),this.isWebGLRenderTarget=!0}}class Al extends Ml{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ua,this.minFilter=ua,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Il extends Ml{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ua,this.minFilter=ua,this.wrapR=la,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];const h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(0===s)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||a!==h||l!==d||c!==p){let e=1-s;const t=a*h+l*d+c*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+h*i,l=l*e+d*i,c=c*e+p*i,u=u*e+f*i,e===1-s){const e=1/Math.sqrt(a*a+l*l+c*c+u*u);a*=e,l*=e,c*=e,u*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],d=i[o+2],p=i[o+3];return e[t]=s*p+c*u+a*d-l*h,e[t+1]=a*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-a*u,e[t+3]=c*p-s*u-a*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,l=s(n/2),c=s(r/2),u=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);switch(o){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(i-l)*e,this._z=(o-r)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(o-r)/e,this._x=(i+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ka(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*s+r*l-i*a,this._y=r*c+o*a+i*s-n*l,this._z=i*c+o*l+n*a-r*s,this._w=o*c-n*s-r*a-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=r*u+this._y*h,this._z=i*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Rl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Rl.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Dl.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Dl.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=2*(o*r-s*n),c=2*(s*t-i*r),u=2*(i*n-o*t);return this.x=t+a*l+o*u-s*c,this.y=n+a*c+s*l-i*u,this.z=r+a*u+i*c-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Ll.copy(this).projectOnVector(e),this.sub(Ll)}reflect(e){return this.sub(Ll.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ka(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ll=new Rl,Dl=new Pl;class Ol{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(kl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(kl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=kl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,kl):kl.fromBufferAttribute(r,t),kl.applyMatrix4(e.matrixWorld),this.expandByPoint(kl);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Fl.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Fl.copy(n.boundingBox)),Fl.applyMatrix4(e.matrixWorld),this.union(Fl)}const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,kl),kl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Hl),Zl.subVectors(this.max,Hl),zl.subVectors(e.a,Hl),Bl.subVectors(e.b,Hl),Ul.subVectors(e.c,Hl),jl.subVectors(Bl,zl),Vl.subVectors(Ul,Bl),Gl.subVectors(zl,Ul);let t=[0,-jl.z,jl.y,0,-Vl.z,Vl.y,0,-Gl.z,Gl.y,jl.z,0,-jl.x,Vl.z,0,-Vl.x,Gl.z,0,-Gl.x,-jl.y,jl.x,0,-Vl.y,Vl.x,0,-Gl.y,Gl.x,0];return!!ql(t,zl,Bl,Ul,Zl)&&(t=[1,0,0,0,1,0,0,0,1],!!ql(t,zl,Bl,Ul,Zl)&&(Wl.crossVectors(jl,Vl),t=[Wl.x,Wl.y,Wl.z],ql(t,zl,Bl,Ul,Zl)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,kl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(kl).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Nl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Nl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Nl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Nl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Nl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Nl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Nl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Nl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Nl)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Nl=[new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl,new Rl],kl=new Rl,Fl=new Ol,zl=new Rl,Bl=new Rl,Ul=new Rl,jl=new Rl,Vl=new Rl,Gl=new Rl,Hl=new Rl,Zl=new Rl,Wl=new Rl,$l=new Rl;function ql(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){$l.fromArray(e,o);const s=i.x*Math.abs($l.x)+i.y*Math.abs($l.y)+i.z*Math.abs($l.z),a=t.dot($l),l=n.dot($l),c=r.dot($l);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>s)return!1}return!0}const Xl=new Ol,Yl=new Rl,Kl=new Rl;class Jl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Xl.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Yl.subVectors(e,this.center);const t=Yl.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Yl,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Kl.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Yl.copy(e.center).add(Kl)),this.expandByPoint(Yl.copy(e.center).sub(Kl))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ql=new Rl,ec=new Rl,tc=new Rl,nc=new Rl,rc=new Rl,ic=new Rl,oc=new Rl;class sc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ql)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ql.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ql.copy(this.origin).addScaledVector(this.direction,t),Ql.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){ec.copy(e).add(t).multiplyScalar(.5),tc.copy(t).sub(e).normalize(),nc.copy(this.origin).sub(ec);const i=.5*e.distanceTo(t),o=-this.direction.dot(tc),s=nc.dot(this.direction),a=-nc.dot(tc),l=nc.lengthSq(),c=Math.abs(1-o*o);let u,h,d,p;if(c>0)if(u=o*a-s,h=o*s-a,p=i*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+o*h+2*s)+h*(o*u+h+2*a)+l}else h=i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h=-i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;else h<=-p?(u=Math.max(0,-(-o*i+s)),h=u>0?-i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l):h<=p?(u=0,h=Math.min(Math.max(-i,-a),i),d=h*(h+2*a)+l):(u=Math.max(0,-(o*i+s)),h=u>0?i:Math.min(Math.max(-i,-a),i),d=-u*u+h*(h+2*a)+l);else h=o>0?-i:i,u=Math.max(0,-(o*h+s)),d=-u*u+h*(h+2*a)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(ec).addScaledVector(tc,h),d}intersectSphere(e,t){Ql.subVectors(e.center,this.origin);const n=Ql.dot(this.direction),r=Ql.dot(Ql)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(i=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||i>r?null:((i>n||isNaN(n))&&(n=i),(o<r||isNaN(r))&&(r=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,Ql)}intersectTriangle(e,t,n,r,i){rc.subVectors(t,e),ic.subVectors(n,e),oc.crossVectors(rc,ic);let o,s=this.direction.dot(oc);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}nc.subVectors(this.origin,e);const a=o*this.direction.dot(ic.crossVectors(nc,ic));if(a<0)return null;const l=o*this.direction.dot(rc.cross(nc));if(l<0)return null;if(a+l>s)return null;const c=-o*nc.dot(oc);return c<0?null:this.at(c/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ac{constructor(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){ac.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m)}set(e,t,n,r,i,o,s,a,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ac).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/lc.setFromMatrixColumn(e,0).length(),i=1/lc.setFromMatrixColumn(e,1).length(),o=1/lc.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=-a*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*a,t[2]=i-e*l,t[6]=r+n*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*l,t[1]=o*u,t[5]=o*c,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,n=a*u,r=l*c,i=l*u;t[0]=e-i*s,t[4]=-o*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*c,t[9]=i-e*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,n=o*u,r=s*c,i=s*u;t[0]=a*c,t[4]=r*l-n,t[8]=e*l+i,t[1]=a*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=o*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){const e=o*a,n=o*l,r=s*a,i=s*l;t[0]=a*c,t[4]=-u,t[8]=l*c,t[1]=e*u+i,t[5]=o*c,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*c,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(uc,e,hc)}lookAt(e,t,n){const r=this.elements;return fc.subVectors(e,t),0===fc.lengthSq()&&(fc.z=1),fc.normalize(),dc.crossVectors(n,fc),0===dc.lengthSq()&&(1===Math.abs(n.z)?fc.x+=1e-4:fc.z+=1e-4,fc.normalize(),dc.crossVectors(n,fc)),dc.normalize(),pc.crossVectors(fc,dc),r[0]=dc.x,r[4]=pc.x,r[8]=fc.x,r[1]=dc.y,r[5]=pc.y,r[9]=fc.y,r[2]=dc.z,r[6]=pc.z,r[10]=fc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],y=n[3],v=n[7],_=n[11],x=n[15],b=r[0],w=r[4],S=r[8],M=r[12],E=r[1],T=r[5],C=r[9],A=r[13],I=r[2],P=r[6],R=r[10],L=r[14],D=r[3],O=r[7],N=r[11],k=r[15];return i[0]=o*b+s*E+a*I+l*D,i[4]=o*w+s*T+a*P+l*O,i[8]=o*S+s*C+a*R+l*N,i[12]=o*M+s*A+a*L+l*k,i[1]=c*b+u*E+h*I+d*D,i[5]=c*w+u*T+h*P+d*O,i[9]=c*S+u*C+h*R+d*N,i[13]=c*M+u*A+h*L+d*k,i[2]=p*b+f*E+m*I+g*D,i[6]=p*w+f*T+m*P+g*O,i[10]=p*S+f*C+m*R+g*N,i[14]=p*M+f*A+m*L+g*k,i[3]=y*b+v*E+_*I+x*D,i[7]=y*w+v*T+_*P+x*O,i[11]=y*S+v*C+_*R+x*N,i[15]=y*M+v*A+_*L+x*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*a*u-r*l*u-i*s*h+n*l*h+r*s*d-n*a*d)+e[7]*(+t*a*d-t*l*h+i*o*h-r*o*d+r*l*c-i*a*c)+e[11]*(+t*l*u-t*s*d-i*o*u+n*o*d+i*s*c-n*l*c)+e[15]*(-r*s*c-t*a*u+t*s*h+r*o*u-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],y=u*m*l-f*h*l+f*a*d-s*m*d-u*a*g+s*h*g,v=p*h*l-c*m*l-p*a*d+o*m*d+c*a*g-o*h*g,_=c*f*l-p*u*l+p*s*d-o*f*d-c*s*g+o*u*g,x=p*u*a-c*f*a-p*s*h+o*f*h+c*s*m-o*u*m,b=t*y+n*v+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=y*w,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*w,e[2]=(s*m*i-f*a*i+f*r*l-n*m*l-s*r*g+n*a*g)*w,e[3]=(u*a*i-s*h*i-u*r*l+n*h*l+s*r*d-n*a*d)*w,e[4]=v*w,e[5]=(c*m*i-p*h*i+p*r*d-t*m*d-c*r*g+t*h*g)*w,e[6]=(p*a*i-o*m*i-p*r*l+t*m*l+o*r*g-t*a*g)*w,e[7]=(o*h*i-c*a*i+c*r*l-t*h*l-o*r*d+t*a*d)*w,e[8]=_*w,e[9]=(p*u*i-c*f*i-p*n*d+t*f*d+c*n*g-t*u*g)*w,e[10]=(o*f*i-p*s*i+p*n*l-t*f*l-o*n*g+t*s*g)*w,e[11]=(c*s*i-o*u*i-c*n*l+t*u*l+o*n*d-t*s*d)*w,e[12]=x*w,e[13]=(c*f*r-p*u*r+p*n*h-t*f*h-c*n*m+t*u*m)*w,e[14]=(p*s*r-o*f*r-p*n*a+t*f*a+o*n*m-t*s*m)*w,e[15]=(o*u*r-c*s*r+c*n*a-t*u*a-o*n*h+t*s*h)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,c=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,c*s+n,c*a-r*o,0,l*a-r*s,c*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,l=i+i,c=o+o,u=s+s,h=i*l,d=i*c,p=i*u,f=o*c,m=o*u,g=s*u,y=a*l,v=a*c,_=a*u,x=n.x,b=n.y,w=n.z;return r[0]=(1-(f+g))*x,r[1]=(d+_)*x,r[2]=(p-v)*x,r[3]=0,r[4]=(d-_)*b,r[5]=(1-(h+g))*b,r[6]=(m+y)*b,r[7]=0,r[8]=(p+v)*w,r[9]=(m-y)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=lc.set(r[0],r[1],r[2]).length();const o=lc.set(r[4],r[5],r[6]).length(),s=lc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],cc.copy(this);const a=1/i,l=1/o,c=1/s;return cc.elements[0]*=a,cc.elements[1]*=a,cc.elements[2]*=a,cc.elements[4]*=l,cc.elements[5]*=l,cc.elements[6]*=l,cc.elements[8]*=c,cc.elements[9]*=c,cc.elements[10]*=c,t.setFromRotationMatrix(cc),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ha;const a=this.elements,l=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),h=(n+r)/(n-r);let d,p;if(s===Ha)d=-(o+i)/(o-i),p=-2*o*i/(o-i);else{if(s!==Za)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-o/(o-i),p=-o*i/(o-i)}return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,i,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ha;const a=this.elements,l=1/(t-e),c=1/(n-r),u=1/(o-i),h=(t+e)*l,d=(n+r)*c;let p,f;if(s===Ha)p=(o+i)*u,f=-2*u;else{if(s!==Za)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=i*u,f=-1*u}return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=f,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const lc=new Rl,cc=new ac,uc=new Rl(0,0,0),hc=new Rl(1,1,1),dc=new Rl,pc=new Rl,fc=new Rl,mc=new ac,gc=new Pl;class yc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:yc.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.elements,i=r[0],o=r[4],s=r[8],a=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Ka(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ka(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ka(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-Ka(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Ka(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-Ka(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return mc.makeRotationFromQuaternion(e),this.setFromRotationMatrix(mc,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return gc.setFromEuler(this),this.setFromQuaternion(gc,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yc.DEFAULT_ORDER="XYZ";class vc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let _c=0;const xc=new Rl,bc=new Pl,wc=new ac,Sc=new Rl,Mc=new Rl,Ec=new Rl,Tc=new Pl,Cc=new Rl(1,0,0),Ac=new Rl(0,1,0),Ic=new Rl(0,0,1),Pc={type:"added"},Rc={type:"removed"};class Lc extends Wa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_c++}),this.uuid=Ya(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lc.DEFAULT_UP.clone();const e=new Rl,t=new yc,n=new Pl,r=new Rl(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ac},normalMatrix:{value:new il}}),this.matrix=new ac,this.matrixWorld=new ac,this.matrixAutoUpdate=Lc.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Lc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new vc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return bc.setFromAxisAngle(e,t),this.quaternion.multiply(bc),this}rotateOnWorldAxis(e,t){return bc.setFromAxisAngle(e,t),this.quaternion.premultiply(bc),this}rotateX(e){return this.rotateOnAxis(Cc,e)}rotateY(e){return this.rotateOnAxis(Ac,e)}rotateZ(e){return this.rotateOnAxis(Ic,e)}translateOnAxis(e,t){return xc.copy(e).applyQuaternion(this.quaternion),this.position.add(xc.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Cc,e)}translateY(e){return this.translateOnAxis(Ac,e)}translateZ(e){return this.translateOnAxis(Ic,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(wc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Sc.copy(e):Sc.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Mc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wc.lookAt(Mc,Sc,this.up):wc.lookAt(Sc,Mc,this.up),this.quaternion.setFromRotationMatrix(wc),r&&(wc.extractRotation(r.matrixWorld),bc.setFromRotationMatrix(wc),this.quaternion.premultiply(bc.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Pc)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Rc)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),wc.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),wc.multiply(e.parent.matrixWorld)),e.applyMatrix4(wc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[e]===t&&n.push(this);const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Mc,e,Ec),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Mc,Tc,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){const n=e[t];!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations),u=o(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Lc.DEFAULT_UP=new Rl(0,1,0),Lc.DEFAULT_MATRIX_AUTO_UPDATE=!0,Lc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Dc=new Rl,Oc=new Rl,Nc=new Rl,kc=new Rl,Fc=new Rl,zc=new Rl,Bc=new Rl,Uc=new Rl,jc=new Rl,Vc=new Rl;let Gc=!1;class Hc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rl;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Dc.subVectors(e,t),r.cross(Dc);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Dc.subVectors(r,t),Oc.subVectors(n,t),Nc.subVectors(e,t);const o=Dc.dot(Dc),s=Dc.dot(Oc),a=Dc.dot(Nc),l=Oc.dot(Oc),c=Oc.dot(Nc),u=o*l-s*s;if(0===u)return i.set(-2,-1,-1);const h=1/u,d=(l*a-s*c)*h,p=(o*c-s*a)*h;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,kc),kc.x>=0&&kc.y>=0&&kc.x+kc.y<=1}static getUV(e,t,n,r,i,o,s,a){return!1===Gc&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Gc=!0),this.getInterpolation(e,t,n,r,i,o,s,a)}static getInterpolation(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,kc),a.setScalar(0),a.addScaledVector(i,kc.x),a.addScaledVector(o,kc.y),a.addScaledVector(s,kc.z),a}static isFrontFacing(e,t,n,r){return Dc.subVectors(n,t),Oc.subVectors(e,t),Dc.cross(Oc).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Dc.subVectors(this.c,this.b),Oc.subVectors(this.a,this.b),.5*Dc.cross(Oc).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Hc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Hc.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return!1===Gc&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Gc=!0),Hc.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}getInterpolation(e,t,n,r,i){return Hc.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Hc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Hc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,s;Fc.subVectors(r,n),zc.subVectors(i,n),Uc.subVectors(e,n);const a=Fc.dot(Uc),l=zc.dot(Uc);if(a<=0&&l<=0)return t.copy(n);jc.subVectors(e,r);const c=Fc.dot(jc),u=zc.dot(jc);if(c>=0&&u<=c)return t.copy(r);const h=a*u-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(Fc,o);Vc.subVectors(e,i);const d=Fc.dot(Vc),p=zc.dot(Vc);if(p>=0&&d<=p)return t.copy(i);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(zc,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return Bc.subVectors(i,r),s=(u-c)/(u-c+(d-p)),t.copy(r).addScaledVector(Bc,s);const g=1/(m+f+h);return o=f*g,s=h*g,t.copy(n).addScaledVector(Fc,o).addScaledVector(zc,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Zc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Wc={h:0,s:0,l:0},$c={h:0,s:0,l:0};function qc(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class Xc{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Da;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ml.toWorkingColorSpace(this,t),this}setRGB(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ml.workingColorSpace;return this.r=e,this.g=t,this.b=n,ml.toWorkingColorSpace(this,r),this}setHSL(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ml.workingColorSpace;if(e=function(e,t){return(e%t+t)%t}(e,1),t=Ka(t,0,1),n=Ka(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=qc(i,r,e+1/3),this.g=qc(i,r,e),this.b=qc(i,r,e-1/3)}return ml.toWorkingColorSpace(this,r),this}setStyle(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Da;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const o=t[1],s=t[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,n);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,n);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=t[1],i=r.length;if(3===i)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,n);if(6===i)return this.setHex(parseInt(r,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Da;const n=Zc[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=gl(e.r),this.g=gl(e.g),this.b=gl(e.b),this}copyLinearToSRGB(e){return this.r=yl(e.r),this.g=yl(e.g),this.b=yl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Da;return ml.fromWorkingColorSpace(Yc.copy(this),e),65536*Math.round(Ka(255*Yc.r,0,255))+256*Math.round(Ka(255*Yc.g,0,255))+Math.round(Ka(255*Yc.b,0,255))}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Da;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ml.workingColorSpace;ml.fromWorkingColorSpace(Yc.copy(this),t);const n=Yc.r,r=Yc.g,i=Yc.b,o=Math.max(n,r,i),s=Math.min(n,r,i);let a,l;const c=(s+o)/2;if(s===o)a=0,l=0;else{const e=o-s;switch(l=c<=.5?e/(o+s):e/(2-o-s),o){case n:a=(r-i)/e+(r<i?6:0);break;case r:a=(i-n)/e+2;break;case i:a=(n-r)/e+4}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ml.workingColorSpace;return ml.fromWorkingColorSpace(Yc.copy(this),t),e.r=Yc.r,e.g=Yc.g,e.b=Yc.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Da;ml.fromWorkingColorSpace(Yc.copy(this),e);const t=Yc.r,n=Yc.g,r=Yc.b;return e!==Da?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(Wc),this.setHSL(Wc.h+e,Wc.s+t,Wc.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Wc),e.getHSL($c);const n=Ja(Wc.h,$c.h,t),r=Ja(Wc.s,$c.s,t),i=Ja(Wc.l,$c.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Yc=new Xc;Xc.NAMES=Zc;let Kc=0;class Jc extends Wa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Kc++}),this.uuid=Ya(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=qs,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Xc(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ja,this.stencilZFail=ja,this.stencilZPass=ja,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==qs&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ja&&(n.stencilFail=this.stencilFail),this.stencilZFail!==ja&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==ja&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class Qc extends Jc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Xc(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Xs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const eu=new Rl,tu=new rl;class nu{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ya,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn('THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)tu.fromBufferAttribute(this,t),tu.applyMatrix3(e),this.setXY(t,tu.x,tu.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)eu.fromBufferAttribute(this,t),eu.applyMatrix3(e),this.setXYZ(t,eu.x,eu.y,eu.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)eu.fromBufferAttribute(this,t),eu.applyMatrix4(e),this.setXYZ(t,eu.x,eu.y,eu.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)eu.fromBufferAttribute(this,t),eu.applyNormalMatrix(e),this.setXYZ(t,eu.x,eu.y,eu.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)eu.fromBufferAttribute(this,t),eu.transformDirection(e),this.setXYZ(t,eu.x,eu.y,eu.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=tl(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=nl(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=tl(t,this.array)),t}setX(e,t){return this.normalized&&(t=nl(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=tl(t,this.array)),t}setY(e,t){return this.normalized&&(t=nl(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=tl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=nl(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=tl(t,this.array)),t}setW(e,t){return this.normalized&&(t=nl(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=nl(t,this.array),n=nl(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=nl(t,this.array),n=nl(n,this.array),r=nl(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=nl(t,this.array),n=nl(n,this.array),r=nl(r,this.array),i=nl(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class ru extends nu{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class iu extends nu{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ou extends nu{constructor(e,t,n){super(new Float32Array(e),t,n)}}let su=0;const au=new ac,lu=new Lc,cu=new Rl,uu=new Ol,hu=new Ol,du=new Rl;class pu extends Wa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:su++}),this.uuid=Ya(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(sl(e)?iu:ru)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new il).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return au.makeRotationFromQuaternion(e),this.applyMatrix4(au),this}rotateX(e){return au.makeRotationX(e),this.applyMatrix4(au),this}rotateY(e){return au.makeRotationY(e),this.applyMatrix4(au),this}rotateZ(e){return au.makeRotationZ(e),this.applyMatrix4(au),this}translate(e,t,n){return au.makeTranslation(e,t,n),this.applyMatrix4(au),this}scale(e,t,n){return au.makeScale(e,t,n),this.applyMatrix4(au),this}lookAt(e){return lu.lookAt(e),lu.updateMatrix(),this.applyMatrix4(lu.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cu).negate(),this.translate(cu.x,cu.y,cu.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ou(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ol);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Rl(-1/0,-1/0,-1/0),new Rl(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];uu.setFromBufferAttribute(n),this.morphTargetsRelative?(du.addVectors(this.boundingBox.min,uu.min),this.boundingBox.expandByPoint(du),du.addVectors(this.boundingBox.max,uu.max),this.boundingBox.expandByPoint(du)):(this.boundingBox.expandByPoint(uu.min),this.boundingBox.expandByPoint(uu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Jl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Rl,1/0);if(e){const n=this.boundingSphere.center;if(uu.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];hu.setFromBufferAttribute(n),this.morphTargetsRelative?(du.addVectors(uu.min,hu.min),uu.expandByPoint(du),du.addVectors(uu.max,hu.max),uu.expandByPoint(du)):(uu.expandByPoint(hu.min),uu.expandByPoint(hu.max))}uu.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)du.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(du));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)du.fromBufferAttribute(o,t),s&&(cu.fromBufferAttribute(e,t),du.add(cu)),r=Math.max(r,n.distanceToSquared(du))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,s=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new nu(new Float32Array(4*s),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new Rl,c[e]=new Rl;const u=new Rl,h=new Rl,d=new Rl,p=new rl,f=new rl,m=new rl,g=new Rl,y=new Rl;function v(e,t,n){u.fromArray(r,3*e),h.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(o,2*e),f.fromArray(o,2*t),m.fromArray(o,2*n),h.sub(u),d.sub(u),f.sub(p),m.sub(p);const i=1/(f.x*m.y-m.x*f.y);isFinite(i)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(i),y.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(i),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(y),c[t].add(y),c[n].add(y))}let _=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)v(n[e+0],n[e+1],n[e+2])}const x=new Rl,b=new Rl,w=new Rl,S=new Rl;function M(e){w.fromArray(i,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),b.crossVectors(S,t);const n=b.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=n}for(let e=0,t=_.length;e<t;++e){const t=_[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)M(n[e+0]),M(n[e+1]),M(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new nu(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Rl,i=new Rl,o=new Rl,s=new Rl,a=new Rl,l=new Rl,c=new Rl,u=new Rl;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,f),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),s.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),a.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,i),u.subVectors(r,i),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)du.fromBufferAttribute(e,t),du.normalize(),e.setXYZ(t,du.x,du.y,du.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let i=0,l=t.length;i<l;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new nu(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pu,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const fu=new ac,mu=new sc,gu=new Jl,yu=new Rl,vu=new Rl,_u=new Rl,xu=new Rl,bu=new Rl,wu=new Rl,Su=new rl,Mu=new rl,Eu=new rl,Tu=new Rl,Cu=new Rl,Au=new Rl,Iu=new Rl,Pu=new Rl;class Ru extends Lc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Qc;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(i&&s){wu.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=s[n],a=i[n];0!==r&&(bu.fromBufferAttribute(a,e),o?wu.addScaledVector(bu,r):wu.addScaledVector(bu.sub(t),r))}t.add(wu)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),gu.copy(n.boundingSphere),gu.applyMatrix4(i),mu.copy(e.ray).recast(e.near),!1===gu.containsPoint(mu.origin)){if(null===mu.intersectSphere(gu,yu))return;if(mu.origin.distanceToSquared(yu)>(e.far-e.near)**2)return}fu.copy(i).invert(),mu.copy(e.ray).applyMatrix4(fu),null!==n.boundingBox&&!1===mu.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,mu)}}_computeIntersections(e,t,n){let r;const i=this.geometry,o=this.material,s=i.index,a=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv1,u=i.attributes.normal,h=i.groups,d=i.drawRange;if(null!==s)if(Array.isArray(o))for(let i=0,a=h.length;i<a;i++){const a=h[i],p=o[a.materialIndex];for(let i=Math.max(a.start,d.start),o=Math.min(s.count,Math.min(a.start+a.count,d.start+d.count));i<o;i+=3)r=Lu(this,p,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}else for(let i=Math.max(0,d.start),a=Math.min(s.count,d.start+d.count);i<a;i+=3)r=Lu(this,o,e,n,l,c,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r));else if(void 0!==a)if(Array.isArray(o))for(let i=0,s=h.length;i<s;i++){const s=h[i],p=o[s.materialIndex];for(let i=Math.max(s.start,d.start),o=Math.min(a.count,Math.min(s.start+s.count,d.start+d.count));i<o;i+=3)r=Lu(this,p,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))}else for(let i=Math.max(0,d.start),s=Math.min(a.count,d.start+d.count);i<s;i+=3)r=Lu(this,o,e,n,l,c,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}function Lu(e,t,n,r,i,o,s,a,l,c){e.getVertexPosition(a,vu),e.getVertexPosition(l,_u),e.getVertexPosition(c,xu);const u=function(e,t,n,r,i,o,s,a){let l;if(l=1===t.side?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,0===t.side,a),null===l)return null;Pu.copy(a),Pu.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Pu);return c<n.near||c>n.far?null:{distance:c,point:Pu.clone(),object:e}}(e,t,n,r,vu,_u,xu,Iu);if(u){i&&(Su.fromBufferAttribute(i,a),Mu.fromBufferAttribute(i,l),Eu.fromBufferAttribute(i,c),u.uv=Hc.getInterpolation(Iu,vu,_u,xu,Su,Mu,Eu,new rl)),o&&(Su.fromBufferAttribute(o,a),Mu.fromBufferAttribute(o,l),Eu.fromBufferAttribute(o,c),u.uv1=Hc.getInterpolation(Iu,vu,_u,xu,Su,Mu,Eu,new rl),u.uv2=u.uv1),s&&(Tu.fromBufferAttribute(s,a),Cu.fromBufferAttribute(s,l),Au.fromBufferAttribute(s,c),u.normal=Hc.getInterpolation(Iu,vu,_u,xu,Tu,Cu,Au,new Rl),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const e={a,b:l,c,normal:new Rl,materialIndex:0};Hc.getNormal(vu,_u,xu,e.normal),u.face=e}return u}class Du extends pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,y){const v=o/m,_=p/g,x=o/2,b=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const C=new Rl;for(let o=0;o<M;o++){const s=o*_-b;for(let a=0;a<S;a++){const h=a*v-x;C[e]=h*r,C[t]=s*i,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),u.push(a/m),u.push(1-o/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+S*e,r=h+t+S*(e+1),i=h+(t+1)+S*(e+1),o=h+(t+1)+S*e;a.push(n,r,o),a.push(r,i,o),T+=6}s.addGroup(d,T,y),d+=T,h+=E}p("z","y","x",-1,-1,n,t,e,o,i,0),p("z","y","x",1,-1,n,t,-e,o,i,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new ou(l,3)),this.setAttribute("normal",new ou(c,3)),this.setAttribute("uv",new ou(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Du(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ou(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Nu(e){const t={};for(let n=0;n<e.length;n++){const r=Ou(e[n]);for(const e in r)t[e]=r[e]}return t}function ku(e){return null===e.getRenderTarget()?e.outputColorSpace:ml.workingColorSpace}const Fu={clone:Ou,merge:Nu};class zu extends Jc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ou(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Bu extends Lc{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ac,this.projectionMatrix=new ac,this.projectionMatrixInverse=new ac,this.coordinateSystem=Ha}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Uu extends Bu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Xa*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*qa*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Xa*Math.atan(Math.tan(.5*qa*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*qa*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ju=-90;class Vu extends Lc{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Uu(ju,1,e,t);r.layers=this.layers,this.add(r);const i=new Uu(ju,1,e,t);i.layers=this.layers,this.add(i);const o=new Uu(ju,1,e,t);o.layers=this.layers,this.add(o);const s=new Uu(ju,1,e,t);s.layers=this.layers,this.add(s);const a=new Uu(ju,1,e,t);a.layers=this.layers,this.add(a);const l=new Uu(ju,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,o,s,a]=t;for(const e of t)this.remove(e);if(e===Ha)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(e!==Za)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,o,s,a,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,a),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Gu extends Ml{constructor(e,t,n,r,i,o,s,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:ia,n,r,i,o,s,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Hu extends Cl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];void 0!==t.encoding&&(ul("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ra?Da:La),this.texture=new Gu(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:da}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new Du(5,5,5),s=new zu({name:"CubemapFromEquirect",uniforms:Ou(n),vertexShader:r,fragmentShader:i,side:1,blending:0});s.uniforms.tEquirect.value=t;const a=new Ru(o,s),l=t.minFilter;return t.minFilter===pa&&(t.minFilter=da),new Vu(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}const Zu=new Rl,Wu=new Rl,$u=new il;class qu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Zu.subVectors(n,t).cross(Wu.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Zu),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||$u.getNormalMatrix(e),r=this.coplanarPoint(Zu).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Xu=new Jl,Yu=new Rl;class Ku{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new qu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new qu,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qu,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new qu,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new qu,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new qu;this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ha;const n=this.planes,r=e.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],y=r[13],v=r[14],_=r[15];if(n[0].setComponents(a-i,h-l,m-d,_-g).normalize(),n[1].setComponents(a+i,h+l,m+d,_+g).normalize(),n[2].setComponents(a+o,h+c,m+p,_+y).normalize(),n[3].setComponents(a-o,h-c,m-p,_-y).normalize(),n[4].setComponents(a-s,h-u,m-f,_-v).normalize(),t===Ha)n[5].setComponents(a+s,h+u,m+f,_+v).normalize();else{if(t!==Za)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Xu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Xu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Xu)}intersectsSprite(e){return Xu.center.set(0,0,0),Xu.radius=.7071067811865476,Xu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xu)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Yu.x=r.normal.x>0?e.max.x:e.min.x,Yu.y=r.normal.y>0?e.max.y:e.min.y,Yu.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Yu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ju(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Qu(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);if(void 0===o)r.set(t,function(t,r){const i=t.array,o=t.usage,s=i.byteLength,a=e.createBuffer();let l;if(e.bindBuffer(r,a),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)l=e.FLOAT;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");l=e.HALF_FLOAT}else l=e.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=e.SHORT;else if(i instanceof Uint32Array)l=e.UNSIGNED_INT;else if(i instanceof Int32Array)l=e.INT;else if(i instanceof Int8Array)l=e.BYTE;else if(i instanceof Uint8Array)l=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);l=e.UNSIGNED_BYTE}return{buffer:a,type:l,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}}(t,i));else if(o.version<t.version){if(o.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,r,i){const o=r.array,s=r._updateRange,a=r.updateRanges;if(e.bindBuffer(i,t),-1===s.count&&0===a.length&&e.bufferSubData(i,0,o),0!==a.length){for(let t=0,r=a.length;t<r;t++){const r=a[t];n?e.bufferSubData(i,r.start*o.BYTES_PER_ELEMENT,o,r.start,r.count):e.bufferSubData(i,r.start*o.BYTES_PER_ELEMENT,o.subarray(r.start,r.start+r.count))}r.clearUpdateRanges()}-1!==s.count&&(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1),r.onUploadCallback()}(o.buffer,t,i),o.version=t.version}}}}class eh extends pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),l=s+1,c=a+1,u=e/s,h=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*h-o;for(let n=0;n<l;n++){const r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),o=t+1+l*e;d.push(n,r,o),d.push(r,i,o)}this.setIndex(d),this.setAttribute("position",new ou(p,3)),this.setAttribute("normal",new ou(f,3)),this.setAttribute("uv",new ou(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eh(e.width,e.height,e.widthSegments,e.heightSegments)}}const th={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},nh={common:{diffuse:{value:new Xc(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new il},alphaMap:{value:null},alphaMapTransform:{value:new il},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new il}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new il}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new il}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new il},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new il},normalScale:{value:new rl(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new il},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new il}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new il}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new il}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Xc(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Xc(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new il},alphaTest:{value:0},uvTransform:{value:new il}},sprite:{diffuse:{value:new Xc(16777215)},opacity:{value:1},center:{value:new rl(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new il},alphaMap:{value:null},alphaMapTransform:{value:new il},alphaTest:{value:0}}},rh={basic:{uniforms:Nu([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.fog]),vertexShader:th.meshbasic_vert,fragmentShader:th.meshbasic_frag},lambert:{uniforms:Nu([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.fog,nh.lights,{emissive:{value:new Xc(0)}}]),vertexShader:th.meshlambert_vert,fragmentShader:th.meshlambert_frag},phong:{uniforms:Nu([nh.common,nh.specularmap,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.fog,nh.lights,{emissive:{value:new Xc(0)},specular:{value:new Xc(1118481)},shininess:{value:30}}]),vertexShader:th.meshphong_vert,fragmentShader:th.meshphong_frag},standard:{uniforms:Nu([nh.common,nh.envmap,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.roughnessmap,nh.metalnessmap,nh.fog,nh.lights,{emissive:{value:new Xc(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:th.meshphysical_vert,fragmentShader:th.meshphysical_frag},toon:{uniforms:Nu([nh.common,nh.aomap,nh.lightmap,nh.emissivemap,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.gradientmap,nh.fog,nh.lights,{emissive:{value:new Xc(0)}}]),vertexShader:th.meshtoon_vert,fragmentShader:th.meshtoon_frag},matcap:{uniforms:Nu([nh.common,nh.bumpmap,nh.normalmap,nh.displacementmap,nh.fog,{matcap:{value:null}}]),vertexShader:th.meshmatcap_vert,fragmentShader:th.meshmatcap_frag},points:{uniforms:Nu([nh.points,nh.fog]),vertexShader:th.points_vert,fragmentShader:th.points_frag},dashed:{uniforms:Nu([nh.common,nh.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:th.linedashed_vert,fragmentShader:th.linedashed_frag},depth:{uniforms:Nu([nh.common,nh.displacementmap]),vertexShader:th.depth_vert,fragmentShader:th.depth_frag},normal:{uniforms:Nu([nh.common,nh.bumpmap,nh.normalmap,nh.displacementmap,{opacity:{value:1}}]),vertexShader:th.meshnormal_vert,fragmentShader:th.meshnormal_frag},sprite:{uniforms:Nu([nh.sprite,nh.fog]),vertexShader:th.sprite_vert,fragmentShader:th.sprite_frag},background:{uniforms:{uvTransform:{value:new il},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:th.background_vert,fragmentShader:th.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:th.backgroundCube_vert,fragmentShader:th.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:th.cube_vert,fragmentShader:th.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:th.equirect_vert,fragmentShader:th.equirect_frag},distanceRGBA:{uniforms:Nu([nh.common,nh.displacementmap,{referencePosition:{value:new Rl},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:th.distanceRGBA_vert,fragmentShader:th.distanceRGBA_frag},shadow:{uniforms:Nu([nh.lights,nh.fog,{color:{value:new Xc(0)},opacity:{value:1}}]),vertexShader:th.shadow_vert,fragmentShader:th.shadow_frag}};rh.physical={uniforms:Nu([rh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new il},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new il},clearcoatNormalScale:{value:new rl(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new il},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new il},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new il},sheen:{value:0},sheenColor:{value:new Xc(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new il},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new il},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new il},transmissionSamplerSize:{value:new rl},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new il},attenuationDistance:{value:0},attenuationColor:{value:new Xc(0)},specularColor:{value:new Xc(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new il},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new il},anisotropyVector:{value:new rl},anisotropyMap:{value:null},anisotropyMapTransform:{value:new il}}]),vertexShader:th.meshphysical_vert,fragmentShader:th.meshphysical_frag};const ih={r:0,b:0,g:0};function oh(e,t,n,r,i,o,s){const a=new Xc(0);let l,c,u=!0===o?0:1,h=null,d=0,p=null;function f(t,n){t.getRGB(ih,ku(e)),r.buffers.color.setClear(ih.r,ih.g,ih.b,n,s)}return{getClearColor:function(){return a},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a.set(e),u=t,f(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,f(a,u)},render:function(o,m){let g=!1,y=!0===m.isScene?m.background:null;y&&y.isTexture&&(y=(m.backgroundBlurriness>0?n:t).get(y)),null===y?f(a,u):y&&y.isColor&&(f(y,1),g=!0);const v=e.xr.getEnvironmentBlendMode();"additive"===v?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===v&&r.buffers.color.setClear(0,0,0,0,s),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===sa)?(void 0===c&&(c=new Ru(new Du(1,1,1),new zu({name:"BackgroundCubeMaterial",uniforms:Ou(rh.backgroundCube.uniforms),vertexShader:rh.backgroundCube.vertexShader,fragmentShader:rh.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=ml.getTransfer(y.colorSpace)!==za,h===y&&d===y.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),c.layers.enableAll(),o.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===l&&(l=new Ru(new eh(2,2),new zu({name:"BackgroundMaterial",uniforms:Ou(rh.background.uniforms),vertexShader:rh.background.vertexShader,fragmentShader:rh.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=y,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=ml.getTransfer(y.colorSpace)!==za,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),h===y&&d===y.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=y,d=y.version,p=e.toneMapping),l.layers.enableAll(),o.unshift(l,l.geometry,l.material,0,0,null))}}}function sh(e,t,n,r){const i=e.getParameter(e.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},l=p(null);let c=l,u=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function d(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function p(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function m(e){g(e,0)}function g(n,i){const o=c.newAttributes,s=c.enabledAttributes,a=c.attributeDivisors;o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i)}function y(){const t=c.newAttributes,n=c.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function v(t,n,r,i,o,s,a){!0===a?e.vertexAttribIPointer(t,n,r,o,s):e.vertexAttribPointer(t,n,r,i,o,s)}function _(){x(),u=!0,c!==l&&(c=l,h(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,d,_,x){let b=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let u=c[s];return void 0===u&&(u=p(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[s]=u),u}(_,d,l);c!==t&&(c=t,h(c.object)),b=function(e,t,n,r){const i=c.attributes,o=t.attributes;let s=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){const n=i[t];let r=o[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==r}(i,_,d,x),b&&function(e,t,n,r){const i={},o=t.attributes;let s=0;const a=n.getAttributes();for(const t in a)if(a[t].location>=0){let n=o[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,s++}c.attributes=i,c.attributesNum=s,c.index=r}(i,_,d,x)}else{const e=!0===l.wireframe;c.geometry===_.id&&c.program===d.id&&c.wireframe===e||(c.geometry=_.id,c.program=d.id,c.wireframe=e,b=!0)}null!==x&&n.update(x,e.ELEMENT_ARRAY_BUFFER),(b||u)&&(u=!1,function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();const l=a.attributes,c=s.getAttributes(),u=o.defaultAttributeValues;for(const t in c){const o=c[t];if(o.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&i.instanceMatrix&&(s=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(s=i.instanceColor)),void 0!==s){const t=s.normalized,l=s.itemSize,c=n.get(s);if(void 0===c)continue;const u=c.buffer,h=c.type,d=c.bytesPerElement,p=!0===r.isWebGL2&&(h===e.INT||h===e.UNSIGNED_INT||1013===s.gpuType);if(s.isInterleavedBufferAttribute){const n=s.data,r=n.stride,c=s.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<o.locationSize;e++)g(o.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)v(o.location+e,l/o.locationSize,h,t,r*d,(c+l/o.locationSize*e)*d,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<o.locationSize;e++)g(o.location+e,s.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<o.locationSize;e++)m(o.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<o.locationSize;e++)v(o.location+e,l/o.locationSize,h,t,l*d,l/o.locationSize*e*d,p)}}else if(void 0!==u){const n=u[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(o.location,n);break;case 3:e.vertexAttrib3fv(o.location,n);break;case 4:e.vertexAttrib4fv(o.location,n);break;default:e.vertexAttrib1fv(o.location,n)}}}}y()}(i,l,d,_),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(x).buffer))},reset:_,resetDefaultState:x,dispose:function(){_();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)d(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)d(r[e].object),delete r[e];delete n[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:y}}function ah(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let l,c;if(i)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,r,s,a),n.update(s,o,a)},this.renderMultiDraw=function(e,r,i){if(0===i)return;const s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<i;t++)this.render(e[t],r[t]);else{s.multiDrawArraysWEBGL(o,e,0,r,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,o,1)}}}function lh(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const l=o||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),y=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,_=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:v,floatFragmentTextures:_,floatVertexTextures:v&&_,maxSamples:o?e.getParameter(e.MAX_SAMPLES):0}}function ch(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new qu,a=new il,l={value:null,needsUpdate:!1};function c(e,n,r,i){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==i||null===c){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(c,n),c[n+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,a,u){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!i||null===h||0===h.length||o&&!p)o?c(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{const e=o?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=c(h,a,t,u);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function uh(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=ia:304===t&&(e.mapping=oa),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping;if(303===o||304===o){if(t.has(i))return n(t.get(i).texture,i.mapping);{const o=i.image;if(o&&o.height>0){const s=new Hu(o.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}class hh extends Bu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const dh=[.125,.215,.35,.446,.526,.582],ph=new hh,fh=new Xc;let mh=null,gh=0,yh=0;const vh=(1+Math.sqrt(5))/2,_h=1/vh,xh=[new Rl(1,1,1),new Rl(-1,1,1),new Rl(1,1,-1),new Rl(-1,1,-1),new Rl(0,vh,_h),new Rl(0,vh,-_h),new Rl(_h,0,vh),new Rl(-_h,0,vh),new Rl(vh,_h,0),new Rl(-vh,_h,0)];class bh{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;mh=this._renderer.getRenderTarget(),gh=this._renderer.getActiveCubeFace(),yh=this._renderer.getActiveMipmapLevel(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Eh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Mh(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mh,gh,yh),e.scissorTest=!1,Sh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ia||e.mapping===oa?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mh=this._renderer.getRenderTarget(),gh=this._renderer.getActiveCubeFace(),yh=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:da,minFilter:da,generateMipmaps:!1,type:va,format:xa,colorSpace:Oa,depthBuffer:!1},r=wh(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=wh(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const o=e-4+1+dh.length;for(let s=0;s<o;s++){const o=Math.pow(2,i);n.push(o);let a=1/o;s>e-4?a=dh[s-e+4-1]:0===s&&(a=0),r.push(a);const l=1/(o-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,y=new Float32Array(f*p*d),v=new Float32Array(m*p*d),_=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];y.set(r,f*p*e),v.set(h,m*p*e);const i=[e,e,e,e,e,e];_.set(i,g*p*e)}const x=new pu;x.setAttribute("position",new nu(y,f)),x.setAttribute("uv",new nu(v,m)),x.setAttribute("faceIndex",new nu(_,g)),t.push(x),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(20),i=new Rl(0,1,0);return new zu({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new Ru(this._lodPlanes[0],e);this._renderer.compile(t,ph)}_sceneToCubeUV(e,t,n,r){const i=new Uu(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.toneMapping;a.getClearColor(fh),a.toneMapping=Js,a.autoClear=!1;const u=new Qc({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Ru(new Du,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(fh),d=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1===n?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t]));const l=this._cubeSize;Sh(r,n*l,t>2?l:0,l,l),a.setRenderTarget(r),d&&a.render(h,i),a.render(e,i)}h.geometry.dispose(),h.material.dispose(),a.toneMapping=c,a.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===ia||e.mapping===oa;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Eh()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Mh());const i=r?this._cubemapMaterial:this._equirectMaterial,o=new Ru(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const s=this._cubeSize;Sh(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(o,ph)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=xh[(t-1)%xh.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,s){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Ru(this._lodPlanes[r],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,s&&(u.poleAxis.value=s);const{_lodMax:y}=this;u.dTheta.value=d,u.mipInt.value=y-n;const v=this._sizeLods[r];Sh(t,3*v*(r>y-4?r-y+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(c,ph)}}function wh(e,t,n){const r=new Cl(e,t,n);return r.texture.mapping=sa,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Sh(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Mh(){return new zu({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Eh(){return new zu({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Th(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const o=i.mapping,s=303===o||304===o,a=o===ia||o===oa;if(s||a){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;let r=t.get(i);return null===n&&(n=new bh(e)),r=s?n.fromEquirectangular(i,r):n.fromCubemap(i,r),t.set(i,r),r.texture}if(t.has(i))return t.get(i).texture;{const o=i.image;if(s&&o&&o.height>0||a&&o&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(o)){null===n&&(n=new bh(e));const o=s?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,o),i.addEventListener("dispose",r),o.texture}return null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Ch(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ah(e,t,n,r){const i={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);for(const e in a.morphAttributes){const n=a.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}a.removeEventListener("dispose",s),delete i[a.id];const l=o.get(a);l&&(t.remove(l),o.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{if(void 0===i)return;{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const a=new(sl(n)?iu:ru)(n,1);a.version=s;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER);const i=n.morphAttributes;for(const n in i){const r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Ih(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,l,c){if(0===c)return;let u,h;if(i)u=e,h="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](o,l,s,r*a,c),n.update(l,o,c)},this.renderMultiDraw=function(e,r,i){if(0===i)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<i;t++)this.render(e[t]/a,r[t]);else{l.multiDrawElementsWEBGL(o,r,0,s,e,0,i);let t=0;for(let e=0;e<i;e++)t+=r[e];n.update(t,o,1)}}}function Ph(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Rh(e,t){return e[0]-t[0]}function Lh(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Dh(e,t,n){const r={},i=new Float32Array(8),o=new WeakMap,s=new El,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,c,u){const h=l.morphTargetInfluences;if(!0===t.isWebGL2){const d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0;let f=o.get(c);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const y=void 0!==c.morphAttributes.position,v=void 0!==c.morphAttributes.normal,_=void 0!==c.morphAttributes.color,x=c.morphAttributes.position||[],b=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let S=0;!0===y&&(S=1),!0===v&&(S=2),!0===_&&(S=3);let M=c.attributes.position.count*S,E=1;M>t.maxTextureSize&&(E=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);const T=new Float32Array(M*E*4*p),C=new Al(T,M,E,p);C.type=ya,C.needsUpdate=!0;const A=4*S;for(let P=0;P<p;P++){const R=x[P],L=b[P],D=w[P],O=M*E*4*P;for(let N=0;N<R.count;N++){const k=N*A;!0===y&&(s.fromBufferAttribute(R,N),T[O+k+0]=s.x,T[O+k+1]=s.y,T[O+k+2]=s.z,T[O+k+3]=0),!0===v&&(s.fromBufferAttribute(L,N),T[O+k+4]=s.x,T[O+k+5]=s.y,T[O+k+6]=s.z,T[O+k+7]=0),!0===_&&(s.fromBufferAttribute(D,N),T[O+k+8]=s.x,T[O+k+9]=s.y,T[O+k+10]=s.z,T[O+k+11]=4===D.itemSize?s.w:1)}}function I(){C.dispose(),o.delete(c),c.removeEventListener("dispose",I)}f={count:p,texture:C,size:new rl(M,E)},o.set(c,f),c.addEventListener("dispose",I)}let m=0;for(let F=0;F<h.length;F++)m+=h[F];const g=c.morphTargetsRelative?1:1-m;u.getUniforms().setValue(e,"morphTargetBaseInfluence",g),u.getUniforms().setValue(e,"morphTargetInfluences",h),u.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),u.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const z=void 0===h?0:h.length;let B=r[c.id];if(void 0===B||B.length!==z){B=[];for(let H=0;H<z;H++)B[H]=[H,0];r[c.id]=B}for(let Z=0;Z<z;Z++){const W=B[Z];W[0]=Z,W[1]=h[Z]}B.sort(Lh);for(let $=0;$<8;$++)$<z&&B[$][1]?(a[$][0]=B[$][0],a[$][1]=B[$][1]):(a[$][0]=Number.MAX_SAFE_INTEGER,a[$][1]=0);a.sort(Rh);const U=c.morphAttributes.position,j=c.morphAttributes.normal;let V=0;for(let q=0;q<8;q++){const X=a[q],Y=X[0],K=X[1];Y!==Number.MAX_SAFE_INTEGER&&K?(U&&c.getAttribute("morphTarget"+q)!==U[Y]&&c.setAttribute("morphTarget"+q,U[Y]),j&&c.getAttribute("morphNormal"+q)!==j[Y]&&c.setAttribute("morphNormal"+q,j[Y]),i[q]=K,V+=K):(U&&!0===c.hasAttribute("morphTarget"+q)&&c.deleteAttribute("morphTarget"+q),j&&!0===c.hasAttribute("morphNormal"+q)&&c.deleteAttribute("morphNormal"+q),i[q]=0)}const G=c.morphTargetsRelative?1:1-V;u.getUniforms().setValue(e,"morphTargetBaseInfluence",G),u.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function Oh(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const a=r.render.frame,l=s.geometry,c=t.get(s,l);if(i.get(c)!==a&&(t.update(c),i.set(c,a)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",o)&&s.addEventListener("dispose",o),i.get(s)!==a&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,a))),s.isSkinnedMesh){const e=s.skeleton;i.get(e)!==a&&(e.update(),i.set(e,a))}return c},dispose:function(){i=new WeakMap}}}class Nh extends Ml{constructor(e,t,n,r,i,o,s,a,l,c){if((c=void 0!==c?c:ba)!==ba&&c!==wa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===ba&&(n=ga),void 0===n&&c===wa&&(n=_a),super(null,r,i,o,s,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ua,this.minFilter=void 0!==a?a:ua,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const kh=new Ml,Fh=new Nh(1,1);Fh.compareFunction=515;const zh=new Al,Bh=new Il,Uh=new Gu,jh=[],Vh=[],Gh=new Float32Array(16),Hh=new Float32Array(9),Zh=new Float32Array(4);function Wh(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=jh[i];if(void 0===o&&(o=new Float32Array(i),jh[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function $h(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function qh(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Xh(e,t){let n=Vh[t];void 0===n&&(n=new Int32Array(t),Vh[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Yh(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Kh(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if($h(n,t))return;e.uniform2fv(this.addr,t),qh(n,t)}}function Jh(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if($h(n,t))return;e.uniform3fv(this.addr,t),qh(n,t)}}function Qh(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if($h(n,t))return;e.uniform4fv(this.addr,t),qh(n,t)}}function ed(e,t){const n=this.cache,r=t.elements;if(void 0===r){if($h(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),qh(n,t)}else{if($h(n,r))return;Zh.set(r),e.uniformMatrix2fv(this.addr,!1,Zh),qh(n,r)}}function td(e,t){const n=this.cache,r=t.elements;if(void 0===r){if($h(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),qh(n,t)}else{if($h(n,r))return;Hh.set(r),e.uniformMatrix3fv(this.addr,!1,Hh),qh(n,r)}}function nd(e,t){const n=this.cache,r=t.elements;if(void 0===r){if($h(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),qh(n,t)}else{if($h(n,r))return;Gh.set(r),e.uniformMatrix4fv(this.addr,!1,Gh),qh(n,r)}}function rd(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function id(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if($h(n,t))return;e.uniform2iv(this.addr,t),qh(n,t)}}function od(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if($h(n,t))return;e.uniform3iv(this.addr,t),qh(n,t)}}function sd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if($h(n,t))return;e.uniform4iv(this.addr,t),qh(n,t)}}function ad(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function ld(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if($h(n,t))return;e.uniform2uiv(this.addr,t),qh(n,t)}}function cd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if($h(n,t))return;e.uniform3uiv(this.addr,t),qh(n,t)}}function ud(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if($h(n,t))return;e.uniform4uiv(this.addr,t),qh(n,t)}}function hd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i);const o=this.type===e.SAMPLER_2D_SHADOW?Fh:kh;n.setTexture2D(t||o,i)}function dd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Bh,i)}function pd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Uh,i)}function fd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||zh,i)}function md(e,t){e.uniform1fv(this.addr,t)}function gd(e,t){const n=Wh(t,this.size,2);e.uniform2fv(this.addr,n)}function yd(e,t){const n=Wh(t,this.size,3);e.uniform3fv(this.addr,n)}function vd(e,t){const n=Wh(t,this.size,4);e.uniform4fv(this.addr,n)}function _d(e,t){const n=Wh(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function xd(e,t){const n=Wh(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function bd(e,t){const n=Wh(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function wd(e,t){e.uniform1iv(this.addr,t)}function Sd(e,t){e.uniform2iv(this.addr,t)}function Md(e,t){e.uniform3iv(this.addr,t)}function Ed(e,t){e.uniform4iv(this.addr,t)}function Td(e,t){e.uniform1uiv(this.addr,t)}function Cd(e,t){e.uniform2uiv(this.addr,t)}function Ad(e,t){e.uniform3uiv(this.addr,t)}function Id(e,t){e.uniform4uiv(this.addr,t)}function Pd(e,t,n){const r=this.cache,i=t.length,o=Xh(n,i);$h(r,o)||(e.uniform1iv(this.addr,o),qh(r,o));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||kh,o[e])}function Rd(e,t,n){const r=this.cache,i=t.length,o=Xh(n,i);$h(r,o)||(e.uniform1iv(this.addr,o),qh(r,o));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||Bh,o[e])}function Ld(e,t,n){const r=this.cache,i=t.length,o=Xh(n,i);$h(r,o)||(e.uniform1iv(this.addr,o),qh(r,o));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Uh,o[e])}function Dd(e,t,n){const r=this.cache,i=t.length,o=Xh(n,i);$h(r,o)||(e.uniform1iv(this.addr,o),qh(r,o));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||zh,o[e])}class Od{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return Yh;case 35664:return Kh;case 35665:return Jh;case 35666:return Qh;case 35674:return ed;case 35675:return td;case 35676:return nd;case 5124:case 35670:return rd;case 35667:case 35671:return id;case 35668:case 35672:return od;case 35669:case 35673:return sd;case 5125:return ad;case 36294:return ld;case 36295:return cd;case 36296:return ud;case 35678:case 36198:case 36298:case 36306:case 35682:return hd;case 35679:case 36299:case 36307:return dd;case 35680:case 36300:case 36308:case 36293:return pd;case 36289:case 36303:case 36311:case 36292:return fd}}(t.type)}}class Nd{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return md;case 35664:return gd;case 35665:return yd;case 35666:return vd;case 35674:return _d;case 35675:return xd;case 35676:return bd;case 5124:case 35670:return wd;case 35667:case 35671:return Sd;case 35668:case 35672:return Md;case 35669:case 35673:return Ed;case 5125:return Td;case 36294:return Cd;case 36295:return Ad;case 36296:return Id;case 35678:case 36198:case 36298:case 36306:case 35682:return Pd;case 35679:case 36299:case 36307:return Rd;case 35680:case 36300:case 36308:case 36293:return Ld;case 36289:case 36303:case 36311:case 36292:return Dd}}(t.type)}}class kd{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}}}const Fd=/(\w+)(\])?(\[|\.)?/g;function zd(e,t){e.seq.push(t),e.map[t.id]=t}function Bd(e,t,n){const r=e.name,i=r.length;for(Fd.lastIndex=0;;){const o=Fd.exec(r),s=Fd.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&s+2===i){zd(n,void 0===c?new Od(a,e,t):new Nd(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new kd(a),zd(n,e)),n=e}}}class Ud{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);Bd(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function jd(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}const Vd=37297;let Gd=0;function Hd(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const r=parseInt(o[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),o=Math.min(t+6,n.length);for(let e=i;e<o;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function Zd(e,t){const n=function(e){const t=ml.getPrimaries(ml.workingColorSpace),n=ml.getPrimaries(e);let r;switch(t===n?r="":t===Ua&&n===Ba?r="LinearDisplayP3ToLinearSRGB":t===Ba&&n===Ua&&(r="LinearSRGBToLinearDisplayP3"),e){case Oa:case ka:return[r,"LinearTransferOETF"];case Da:case Na:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function Wd(e,t){let n;switch(t){case Qs:n="Linear";break;case ea:n="Reinhard";break;case ta:n="OptimizedCineon";break;case na:n="ACESFilmic";break;case ra:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function $d(e){return""!==e}function qd(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Xd(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Yd=/^[ \t]*#include +<([\w\d./]+)>/gm;function Kd(e){return e.replace(Yd,Qd)}const Jd=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Qd(e,t){let n=th[t];if(void 0===n){const e=Jd.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=th[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return Kd(n)}const ep=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tp(e){return e.replace(ep,np)}function np(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function rp(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ip(e,t,n,r){const i=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Zs?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Ws?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===$s&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ia:case oa:t="ENVMAP_TYPE_CUBE";break;case sa:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";return e.envMap&&e.envMapMode===oa&&(t="ENVMAP_MODE_REFRACTION"),t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Xs:t="ENVMAP_BLENDING_MULTIPLY";break;case Ys:t="ENVMAP_BLENDING_MIX";break;case Ks:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($d).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),m=i.createProgram();let g,y,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter($d).join("\n"),g.length>0&&(g+="\n"),y=[p,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter($d).join("\n"),y.length>0&&(y+="\n")):(g=[rp(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($d).join("\n"),y=[p,rp(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Js?"#define TONE_MAPPING":"",n.toneMapping!==Js?th.tonemapping_pars_fragment:"",n.toneMapping!==Js?Wd("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",th.colorspace_pars_fragment,Zd("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter($d).join("\n")),s=Kd(s),s=qd(s,n),s=Xd(s,n),a=Kd(a),a=qd(a,n),a=Xd(a,n),s=tp(s),a=tp(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,y=["precision mediump sampler2DArray;","#define varying in",n.glslVersion===Va?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Va?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=v+g+s,x=v+y+a,b=jd(i,i.VERTEX_SHADER,_),w=jd(i,i.FRAGMENT_SHADER,x);function S(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(b).trim(),o=i.getShaderInfoLog(w).trim();let s=!0,a=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,b,w);else{const e=Hd(i,b,"vertex"),t=Hd(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+t)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==r&&""!==o||(a=!1);a&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:o,prefix:y}})}i.deleteShader(b),i.deleteShader(w),M=new Ud(i,m),E=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),o=r.name;let s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(i,m)}let M,E;i.attachShader(m,b),i.attachShader(m,w),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===E&&S(this),E};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=i.getProgramParameter(m,Vd)),T},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Gd++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=w,this}let op=0;class sp{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new ap(e),t.set(e,n)),n}}class ap{constructor(e){this.id=op++,this.code=e,this.usedTimes=0}}function lp(e,t,n,r,i,o,s){const a=new vc,l=new sp,c=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,d=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(o,a,c,g,y){const v=g.fog,_=y.geometry,x=o.isMeshStandardMaterial?g.environment:null,b=(o.isMeshStandardMaterial?n:t).get(o.envMap||x),w=b&&b.mapping===sa?b.image.height:null,S=f[o.type];null!==o.precision&&(p=i.getMaxPrecision(o.precision),p!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",p,"instead."));const M=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,E=void 0!==M?M.length:0;let T,C,A,I,P=0;if(void 0!==_.morphAttributes.position&&(P=1),void 0!==_.morphAttributes.normal&&(P=2),void 0!==_.morphAttributes.color&&(P=3),S){const e=rh[S];T=e.vertexShader,C=e.fragmentShader}else T=o.vertexShader,C=o.fragmentShader,l.update(o),A=l.getVertexShaderID(o),I=l.getFragmentShaderID(o);const R=e.getRenderTarget(),L=!0===y.isInstancedMesh,D=!0===y.isBatchedMesh,O=!!o.map,N=!!o.matcap,k=!!b,F=!!o.aoMap,z=!!o.lightMap,B=!!o.bumpMap,U=!!o.normalMap,j=!!o.displacementMap,V=!!o.emissiveMap,G=!!o.metalnessMap,H=!!o.roughnessMap,Z=o.anisotropy>0,W=o.clearcoat>0,$=o.iridescence>0,q=o.sheen>0,X=o.transmission>0,Y=Z&&!!o.anisotropyMap,K=W&&!!o.clearcoatMap,J=W&&!!o.clearcoatNormalMap,Q=W&&!!o.clearcoatRoughnessMap,ee=$&&!!o.iridescenceMap,te=$&&!!o.iridescenceThicknessMap,ne=q&&!!o.sheenColorMap,re=q&&!!o.sheenRoughnessMap,ie=!!o.specularMap,oe=!!o.specularColorMap,se=!!o.specularIntensityMap,ae=X&&!!o.transmissionMap,le=X&&!!o.thicknessMap,ce=!!o.gradientMap,ue=!!o.alphaMap,he=o.alphaTest>0,de=!!o.alphaHash,pe=!!o.extensions,fe=!!_.attributes.uv1,me=!!_.attributes.uv2,ge=!!_.attributes.uv3;let ye=Js;return o.toneMapped&&(null!==R&&!0!==R.isXRRenderTarget||(ye=e.toneMapping)),{isWebGL2:u,shaderID:S,shaderType:o.type,shaderName:o.name,vertexShader:T,fragmentShader:C,defines:o.defines,customVertexShaderID:A,customFragmentShaderID:I,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:p,batching:D,instancing:L,instancingColor:L&&null!==y.instanceColor,supportsVertexTextures:d,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:Oa,map:O,matcap:N,envMap:k,envMapMode:k&&b.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:z,bumpMap:B,normalMap:U,displacementMap:d&&j,emissiveMap:V,normalMapObjectSpace:U&&1===o.normalMapType,normalMapTangentSpace:U&&0===o.normalMapType,metalnessMap:G,roughnessMap:H,anisotropy:Z,anisotropyMap:Y,clearcoat:W,clearcoatMap:K,clearcoatNormalMap:J,clearcoatRoughnessMap:Q,iridescence:$,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:q,sheenColorMap:ne,sheenRoughnessMap:re,specularMap:ie,specularColorMap:oe,specularIntensityMap:se,transmission:X,transmissionMap:ae,thicknessMap:le,gradientMap:ce,opaque:!1===o.transparent&&1===o.blending,alphaMap:ue,alphaTest:he,alphaHash:de,combine:o.combine,mapUv:O&&m(o.map.channel),aoMapUv:F&&m(o.aoMap.channel),lightMapUv:z&&m(o.lightMap.channel),bumpMapUv:B&&m(o.bumpMap.channel),normalMapUv:U&&m(o.normalMap.channel),displacementMapUv:j&&m(o.displacementMap.channel),emissiveMapUv:V&&m(o.emissiveMap.channel),metalnessMapUv:G&&m(o.metalnessMap.channel),roughnessMapUv:H&&m(o.roughnessMap.channel),anisotropyMapUv:Y&&m(o.anisotropyMap.channel),clearcoatMapUv:K&&m(o.clearcoatMap.channel),clearcoatNormalMapUv:J&&m(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(o.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(o.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(o.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&m(o.sheenColorMap.channel),sheenRoughnessMapUv:re&&m(o.sheenRoughnessMap.channel),specularMapUv:ie&&m(o.specularMap.channel),specularColorMapUv:oe&&m(o.specularColorMap.channel),specularIntensityMapUv:se&&m(o.specularIntensityMap.channel),transmissionMapUv:ae&&m(o.transmissionMap.channel),thicknessMapUv:le&&m(o.thicknessMap.channel),alphaMapUv:ue&&m(o.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(U||Z),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,vertexUv1s:fe,vertexUv2s:me,vertexUv3s:ge,pointsUvs:!0===y.isPoints&&!!_.attributes.uv&&(O||ue),fog:!!v,useFog:!0===o.fog,fogExp2:v&&v.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===y.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:E,morphTextureStride:P,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ye,useLegacyLights:e._useLegacyLights,decodeVideoTexture:O&&!0===o.map.isVideoTexture&&ml.getTransfer(o.map.colorSpace)===za,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionDerivatives:pe&&!0===o.extensions.derivatives,extensionFragDepth:pe&&!0===o.extensions.fragDepth,extensionDrawBuffers:pe&&!0===o.extensions.drawBuffers,extensionShaderTextureLOD:pe&&!0===o.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0),t.supportsVertexTextures&&a.enable(1),t.instancing&&a.enable(2),t.instancingColor&&a.enable(3),t.matcap&&a.enable(4),t.envMap&&a.enable(5),t.normalMapObjectSpace&&a.enable(6),t.normalMapTangentSpace&&a.enable(7),t.clearcoat&&a.enable(8),t.iridescence&&a.enable(9),t.alphaTest&&a.enable(10),t.vertexColors&&a.enable(11),t.vertexAlphas&&a.enable(12),t.vertexUv1s&&a.enable(13),t.vertexUv2s&&a.enable(14),t.vertexUv3s&&a.enable(15),t.vertexTangents&&a.enable(16),t.anisotropy&&a.enable(17),t.alphaHash&&a.enable(18),t.batching&&a.enable(19),e.push(a.mask),a.disableAll(),t.fog&&a.enable(0),t.useFog&&a.enable(1),t.flatShading&&a.enable(2),t.logarithmicDepthBuffer&&a.enable(3),t.skinning&&a.enable(4),t.morphTargets&&a.enable(5),t.morphNormals&&a.enable(6),t.morphColors&&a.enable(7),t.premultipliedAlpha&&a.enable(8),t.shadowMapEnabled&&a.enable(9),t.useLegacyLights&&a.enable(10),t.doubleSided&&a.enable(11),t.flipSided&&a.enable(12),t.useDepthPacking&&a.enable(13),t.dithering&&a.enable(14),t.transmission&&a.enable(15),t.sheen&&a.enable(16),t.opaque&&a.enable(17),t.pointsUvs&&a.enable(18),t.decodeVideoTexture&&a.enable(19),e.push(a.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=rh[t];n=Fu.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new ip(e,n,t,o),c.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function cp(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function up(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function hp(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function dp(){const e=[];let t=0;const n=[],r=[],i=[];function o(n,r,i,o,s,a){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=o,l.renderOrder=n.renderOrder,l.z=s,l.group=a),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?r.push(u):!0===s.transparent?i.push(u):n.push(u)},unshift:function(e,t,s,a,l,c){const u=o(e,t,s,a,l,c);s.transmission>0?r.unshift(u):!0===s.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||up),r.length>1&&r.sort(t||hp),i.length>1&&i.sort(t||hp)}}}function pp(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new dp,e.set(t,[i])):n>=r.length?(i=new dp,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function fp(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Rl,color:new Xc};break;case"SpotLight":n={position:new Rl,direction:new Rl,color:new Xc,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Rl,color:new Xc,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Rl,skyColor:new Xc,groundColor:new Xc};break;case"RectAreaLight":n={color:new Xc,position:new Rl,halfWidth:new Rl,halfHeight:new Rl}}return e[t.id]=n,n}}}let mp=0;function gp(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function yp(e,t){const n=new fp,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new rl};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new rl,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)i.probe.push(new Rl);const o=new Rl,s=new ac,a=new ac;return{setup:function(o,s){let a=0,l=0,c=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let u=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,v=0,_=0,x=0;o.sort(gp);const b=!0===s?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.color,w=t.intensity,S=t.distance,M=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=s.r*w*b,l+=s.g*w*b,c+=s.b*w*b;else if(t.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],w);x++}else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[u]=n,i.directionalShadowMap[u]=M,i.directionalShadowMatrix[u]=t.shadow.matrix,m++}i.directional[u]=e,u++}else if(t.isSpotLight){const e=n.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(w*b),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,i.spot[d]=e;const o=t.shadow;if(t.map&&(i.spotLightMap[v]=t.map,v++,o.updateMatrices(t),t.castShadow&&_++),i.spotLightMatrix[d]=o.matrix,t.castShadow){const e=r.get(t);e.shadowBias=o.bias,e.shadowNormalBias=o.normalBias,e.shadowRadius=o.radius,e.shadowMapSize=o.mapSize,i.spotShadow[d]=e,i.spotShadowMap[d]=M,y++}d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*b),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[h]=n,i.pointShadowMap[h]=M,i.pointShadowMatrix[h]=t.shadow.matrix,g++}i.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(w*b),e.groundColor.copy(t.groundColor).multiplyScalar(w*b),i.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=nh.LTC_FLOAT_1,i.rectAreaLTC2=nh.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=nh.LTC_HALF_1,i.rectAreaLTC2=nh.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=l,i.ambient[2]=c;const w=i.hash;w.directionalLength===u&&w.pointLength===h&&w.spotLength===d&&w.rectAreaLength===p&&w.hemiLength===f&&w.numDirectionalShadows===m&&w.numPointShadows===g&&w.numSpotShadows===y&&w.numSpotMaps===v&&w.numLightProbes===x||(i.directional.length=u,i.spot.length=d,i.rectArea.length=p,i.point.length=h,i.hemi.length=f,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotLightMatrix.length=y+v-_,i.spotLightMap.length=v,i.numSpotLightShadowsWithMaps=_,i.numLightProbes=x,w.directionalLength=u,w.pointLength=h,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=y,w.numSpotMaps=v,w.numLightProbes=x,i.version=mp++)},setupView:function(e,t){let n=0,r=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),a.identity(),s.copy(d.matrixWorld),s.premultiply(h),a.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),r++}else if(d.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function vp(e,t){const n=new yp(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function _p(e,t){let n=new WeakMap;return{get:function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const o=n.get(r);let s;return void 0===o?(s=new vp(e,t),n.set(r,[s])):i>=o.length?(s=new vp(e,t),o.push(s)):s=o[i],s},dispose:function(){n=new WeakMap}}}class xp extends Jc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class bp extends Jc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function wp(e,t,n){let r=new Ku;const i=new rl,o=new rl,s=new El,a=new xp({depthPacking:3201}),l=new bp,c={},u=n.maxTextureSize,h={0:1,1:0,2:2},d=new zu({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new rl},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new pu;f.setAttribute("position",new nu(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ru(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Zs;let y=this.type;function v(n,r){const o=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Cl(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,o,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,o,p,m,null)}function _(t,n,r,i){let o=null;const s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)o=s;else if(o=!0===r.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=o.uuid,t=n.uuid;let r=c[e];void 0===r&&(r={},c[e]=r);let i=r[t];void 0===i&&(i=o.clone(),r[t]=i),o=i}return o.visible=n.visible,o.wireframe=n.wireframe,o.side=i===$s?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],o.alphaMap=n.alphaMap,o.alphaTest=n.alphaTest,o.map=n.map,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.clipIntersection=n.clipIntersection,o.displacementMap=n.displacementMap,o.displacementScale=n.displacementScale,o.displacementBias=n.displacementBias,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,!0===r.isPointLight&&!0===o.isMeshDistanceMaterial&&(e.properties.get(o).light=r),o}function x(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&a===$s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=_(n,h,s,a);n.onBeforeShadow(e,n,i,o,r,t,u),e.renderBufferDirect(o,null,r,t,n,u),n.onAfterShadow(e,n,i,o,r,t,u)}}}else if(l.visible){const t=_(n,l,s,a);n.onBeforeShadow(e,n,i,o,r,t,null),e.renderBufferDirect(o,null,r,t,n,null),n.onAfterShadow(e,n,i,o,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],i,o,s,a)}this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=y!==$s&&this.type===$s,f=y===$s&&this.type!==$s;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;i.copy(h.mapSize);const m=h.getFrameExtents();if(i.multiply(m),o.copy(h.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/m.x),i.x=o.x*m.x,h.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/m.y),i.y=o.y*m.y,h.mapSize.y=o.y)),null===h.map||!0===p||!0===f){const e=this.type!==$s?{minFilter:ua,magFilter:ua}:{};null!==h.map&&h.map.dispose(),h.map=new Cl(i.x,i.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const g=h.getViewportCount();for(let e=0;e<g;e++){const t=h.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),d.viewport(s),h.updateMatrices(c,e),r=h.getFrustum(),x(n,a,h.camera,c,this.type)}!0!==h.isPointLightShadow&&this.type===$s&&v(h,a),h.needsUpdate=!1}y=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function Sp(e,t,n){const r=n.isWebGL2,i=new function(){let t=!1;const n=new El;let r=null;const i=new El(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?V(e.DEPTH_TEST):G(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?V(e.STENCIL_TEST):G(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&l===r||(e.stencilOp(t,n,r),s=t,a=n,l=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,c=null}}},a=new WeakMap,l=new WeakMap;let c={},u={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,y=null,v=null,_=null,x=null,b=null,w=new Xc(0,0,0),S=0,M=!1,E=null,T=null,C=null,A=null,I=null;const P=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,L=0;const D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(D)[1]),R=L>=1):-1!==D.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),R=L>=2);let O=null,N={};const k=e.getParameter(e.SCISSOR_BOX),F=e.getParameter(e.VIEWPORT),z=(new El).fromArray(k),B=(new El).fromArray(F);function U(t,n,i,o){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<i;a++)!r||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage3D(n,0,e.RGBA,1,1,o,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const j={};function V(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function G(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}j[e.TEXTURE_2D]=U(e.TEXTURE_2D,e.TEXTURE_2D,1),j[e.TEXTURE_CUBE_MAP]=U(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(j[e.TEXTURE_2D_ARRAY]=U(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),j[e.TEXTURE_3D]=U(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),i.setClear(0,0,0,1),o.setClear(1),s.setClear(0),V(e.DEPTH_TEST),o.setFunc(3),$(!1),q(1),V(e.CULL_FACE),W(0);const H={[qs]:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(r)H[103]=e.MIN,H[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(H[103]=e.MIN_EXT,H[104]=e.MAX_EXT)}const Z={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA,211:e.CONSTANT_COLOR,212:e.ONE_MINUS_CONSTANT_COLOR,213:e.CONSTANT_ALPHA,214:e.ONE_MINUS_CONSTANT_ALPHA};function W(t,n,r,i,o,s,a,l,c,u){if(0!==t){if(!1===f&&(V(e.BLEND),f=!0),5===t)o=o||n,s=s||r,a=a||i,n===g&&o===_||(e.blendEquationSeparate(H[n],H[o]),g=n,_=o),r===y&&i===v&&s===x&&a===b||(e.blendFuncSeparate(Z[r],Z[i],Z[s],Z[a]),y=r,v=i,x=s,b=a),!1!==l.equals(w)&&c===S||(e.blendColor(l.r,l.g,l.b,c),w.copy(l),S=c),m=t,M=!1;else if(t!==m||u!==M){if(g===qs&&_===qs||(e.blendEquation(e.FUNC_ADD),g=qs,_=qs),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}y=null,v=null,x=null,b=null,w.set(0,0,0),S=0,m=t,M=u}}else!0===f&&(G(e.BLEND),f=!1)}function $(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function q(t){0!==t?(V(e.CULL_FACE),t!==T&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):G(e.CULL_FACE),T=t}function X(t,n,r){t?(V(e.POLYGON_OFFSET_FILL),A===n&&I===r||(e.polygonOffset(n,r),A=n,I=r)):G(e.POLYGON_OFFSET_FILL)}return{buffers:{color:i,depth:o,stencil:s},enable:V,disable:G,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,r&&(t===e.DRAW_FRAMEBUFFER&&(u[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(u[e.DRAW_FRAMEBUFFER]=n)),!0)},drawBuffers:function(r,i){let o=d,s=!1;if(r)if(o=h.get(i),void 0===o&&(o=[],h.set(i,o)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(o.length!==t.length||o[0]!==e.COLOR_ATTACHMENT0){for(let n=0,r=t.length;n<r;n++)o[n]=e.COLOR_ATTACHMENT0+n;o.length=t.length,s=!0}}else o[0]!==e.COLOR_ATTACHMENT0&&(o[0]=e.COLOR_ATTACHMENT0,s=!0);else o[0]!==e.BACK&&(o[0]=e.BACK,s=!0);s&&(n.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:W,setMaterial:function(t,n){2===t.side?G(e.CULL_FACE):V(e.CULL_FACE);let r=1===t.side;n&&(r=!r),$(r),1===t.blending&&!1===t.transparent?W(0):W(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);const a=t.stencilWrite;s.setTest(a),a&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),X(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?V(e.SAMPLE_ALPHA_TO_COVERAGE):G(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:$,setCullFace:q,setLineWidth:function(t){t!==C&&(R&&e.lineWidth(t),C=t)},setPolygonOffset:X,setScissorTest:function(t){t?V(e.SCISSOR_TEST):G(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+P-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===O?e.TEXTURE0+P-1:O);let i=N[r];void 0===i&&(i={type:void 0,texture:void 0},N[r]=i),i.type===t&&i.texture===n||(O!==r&&(e.activeTexture(r),O=r),e.bindTexture(t,n||j[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=N[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=l.get(n);void 0===r&&(r=new WeakMap,l.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=l.get(n).get(t);a.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),a.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===z.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),z.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===r&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},O=null,N={},u={},h=new WeakMap,d=[],p=null,f=!1,m=null,g=null,y=null,v=null,_=null,x=null,b=null,w=new Xc(0,0,0),S=0,M=!1,E=null,T=null,C=null,A=null,I=null,z.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),i.reset(),o.reset(),s.reset()}}}function Mp(e,t,n,r,i,o,s){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,h=i.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap;let m;const g=new WeakMap;let y=!1;try{y="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return y?new OffscreenCanvas(e,t):al("canvas")}function _(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?el:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===m&&(m=v(o,s));const a=n?v(o,s):m;return a.width=o,a.height=s,a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function x(e){return Qa(e.width)&&Qa(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==ua&&e.minFilter!==da}function w(t){e.generateMipmap(t)}function S(n,r,i,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let l=r;if(r===e.RED&&(i===e.FLOAT&&(l=e.R32F),i===e.HALF_FLOAT&&(l=e.R16F),i===e.UNSIGNED_BYTE&&(l=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(l=e.R8UI),i===e.UNSIGNED_SHORT&&(l=e.R16UI),i===e.UNSIGNED_INT&&(l=e.R32UI),i===e.BYTE&&(l=e.R8I),i===e.SHORT&&(l=e.R16I),i===e.INT&&(l=e.R32I)),r===e.RG&&(i===e.FLOAT&&(l=e.RG32F),i===e.HALF_FLOAT&&(l=e.RG16F),i===e.UNSIGNED_BYTE&&(l=e.RG8)),r===e.RGBA){const t=s?Fa:ml.getTransfer(o);i===e.FLOAT&&(l=e.RGBA32F),i===e.HALF_FLOAT&&(l=e.RGBA16F),i===e.UNSIGNED_BYTE&&(l=t===za?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function M(e,t,n){return!0===b(e,n)||e.isFramebufferTexture&&e.minFilter!==ua&&e.minFilter!==da?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(t){return t===ua||1004===t||t===ha?e.NEAREST:e.LINEAR}function T(e){const t=e.target;t.removeEventListener("dispose",T),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=g.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&A(e),0===Object.keys(i).length&&g.delete(n)}r.remove(e)}(t),t.isVideoTexture&&f.delete(t)}function C(t){const n=t.target;n.removeEventListener("dispose",C),function(t){const n=t.texture,i=r.get(t),o=r.get(n);if(void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(i.__webglFramebuffer[t]))for(let n=0;n<i.__webglFramebuffer[t].length;n++)e.deleteFramebuffer(i.__webglFramebuffer[t][n]);else e.deleteFramebuffer(i.__webglFramebuffer[t]);i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t])}else{if(Array.isArray(i.__webglFramebuffer))for(let t=0;t<i.__webglFramebuffer.length;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let t=0;t<i.__webglColorRenderbuffer.length;t++)i.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[t]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),s.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function A(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete g.get(i)[n.__cacheKey],s.memory.textures--}let I=0;function P(t,i){const o=r.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;f.get(e)!==t&&(f.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&o.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void k(o,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,o.__webglTexture,e.TEXTURE0+i)}const R={[aa]:e.REPEAT,[la]:e.CLAMP_TO_EDGE,[ca]:e.MIRRORED_REPEAT},L={[ua]:e.NEAREST,1004:e.NEAREST_MIPMAP_NEAREST,[ha]:e.NEAREST_MIPMAP_LINEAR,[da]:e.LINEAR,1007:e.LINEAR_MIPMAP_NEAREST,[pa]:e.LINEAR_MIPMAP_LINEAR},D={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function O(n,o,s){if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,R[o.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,R[o.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,R[o.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,L[o.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,L[o.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),o.wrapS===la&&o.wrapT===la||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,E(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,E(o.minFilter)),o.minFilter!==ua&&o.minFilter!==da&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,D[o.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(o.magFilter===ua)return;if(o.minFilter!==ha&&o.minFilter!==pa)return;if(o.type===ya&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&o.type===va&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function N(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",T));const i=n.source;let o=g.get(i);void 0===o&&(o={},g.set(i,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),o[a].usedTimes++;const i=o[t.__cacheKey];void 0!==i&&(o[t.__cacheKey].usedTimes--,0===i.usedTimes&&A(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return r}function k(t,i,s){let l=e.TEXTURE_2D;(i.isDataArrayTexture||i.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),i.isData3DTexture&&(l=e.TEXTURE_3D);const c=N(t,i),h=i.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+s);const d=r.get(h);if(h.version!==d.__version||!0===c){n.activeTexture(e.TEXTURE0+s);const t=ml.getPrimaries(ml.workingColorSpace),r=i.colorSpace===La?null:ml.getPrimaries(i.colorSpace),p=i.colorSpace===La||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const f=function(e){return!a&&(e.wrapS!==la||e.wrapT!==la||e.minFilter!==ua&&e.minFilter!==da)}(i)&&!1===x(i.image);let m=_(i.image,f,!1,u);m=V(i,m);const g=x(m)||a,y=o.convert(i.format,i.colorSpace);let v,E=o.convert(i.type),T=S(i.internalFormat,y,E,i.colorSpace,i.isVideoTexture);O(l,i,g);const C=i.mipmaps,A=a&&!0!==i.isVideoTexture&&36196!==T,I=void 0===d.__version||!0===c,P=M(i,m,g);if(i.isDepthTexture)T=e.DEPTH_COMPONENT,a?T=i.type===ya?e.DEPTH_COMPONENT32F:i.type===ga?e.DEPTH_COMPONENT24:i.type===_a?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:i.type===ya&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===ba&&T===e.DEPTH_COMPONENT&&i.type!==ma&&i.type!==ga&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=ga,E=o.convert(i.type)),i.format===wa&&T===e.DEPTH_COMPONENT&&(T=e.DEPTH_STENCIL,i.type!==_a&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=_a,E=o.convert(i.type))),I&&(A?n.texStorage2D(e.TEXTURE_2D,1,T,m.width,m.height):n.texImage2D(e.TEXTURE_2D,0,T,m.width,m.height,0,y,E,null));else if(i.isDataTexture)if(C.length>0&&g){A&&I&&n.texStorage2D(e.TEXTURE_2D,P,T,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)v=C[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,y,E,v.data):n.texImage2D(e.TEXTURE_2D,t,T,v.width,v.height,0,y,E,v.data);i.generateMipmaps=!1}else A?(I&&n.texStorage2D(e.TEXTURE_2D,P,T,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,y,E,m.data)):n.texImage2D(e.TEXTURE_2D,0,T,m.width,m.height,0,y,E,m.data);else if(i.isCompressedTexture)if(i.isCompressedArrayTexture){A&&I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,P,T,C[0].width,C[0].height,m.depth);for(let t=0,r=C.length;t<r;t++)v=C[t],i.format!==xa?null!==y?A?n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,v.width,v.height,m.depth,y,v.data,0,0):n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,T,v.width,v.height,m.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,v.width,v.height,m.depth,y,E,v.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,T,v.width,v.height,m.depth,0,y,E,v.data)}else{A&&I&&n.texStorage2D(e.TEXTURE_2D,P,T,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)v=C[t],i.format!==xa?null!==y?A?n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,y,v.data):n.compressedTexImage2D(e.TEXTURE_2D,t,T,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,v.width,v.height,y,E,v.data):n.texImage2D(e.TEXTURE_2D,t,T,v.width,v.height,0,y,E,v.data)}else if(i.isDataArrayTexture)A?(I&&n.texStorage3D(e.TEXTURE_2D_ARRAY,P,T,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,y,E,m.data)):n.texImage3D(e.TEXTURE_2D_ARRAY,0,T,m.width,m.height,m.depth,0,y,E,m.data);else if(i.isData3DTexture)A?(I&&n.texStorage3D(e.TEXTURE_3D,P,T,m.width,m.height,m.depth),n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,y,E,m.data)):n.texImage3D(e.TEXTURE_3D,0,T,m.width,m.height,m.depth,0,y,E,m.data);else if(i.isFramebufferTexture){if(I)if(A)n.texStorage2D(e.TEXTURE_2D,P,T,m.width,m.height);else{let t=m.width,r=m.height;for(let i=0;i<P;i++)n.texImage2D(e.TEXTURE_2D,i,T,t,r,0,y,E,null),t>>=1,r>>=1}}else if(C.length>0&&g){A&&I&&n.texStorage2D(e.TEXTURE_2D,P,T,C[0].width,C[0].height);for(let t=0,r=C.length;t<r;t++)v=C[t],A?n.texSubImage2D(e.TEXTURE_2D,t,0,0,y,E,v):n.texImage2D(e.TEXTURE_2D,t,T,y,E,v);i.generateMipmaps=!1}else A?(I&&n.texStorage2D(e.TEXTURE_2D,P,T,m.width,m.height),n.texSubImage2D(e.TEXTURE_2D,0,0,0,y,E,m)):n.texImage2D(e.TEXTURE_2D,0,T,y,E,m);b(i,g)&&w(l),d.__version=h.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function F(t,i,s,a,l,c){const u=o.convert(s.format,s.colorSpace),h=o.convert(s.type),p=S(s.internalFormat,u,h,s.colorSpace);if(!r.get(i).__hasExternalTextures){const t=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?n.texImage3D(l,c,p,t,r,i.depth,0,u,h,null):n.texImage2D(l,c,p,t,r,0,u,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),j(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,a,l,r.get(s).__webglTexture,0,U(i)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,a,l,r.get(s).__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function z(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let i=!0===a?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(r||j(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===ya?i=e.DEPTH_COMPONENT32F:t.type===ga&&(i=e.DEPTH_COMPONENT24));const r=U(n);j(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,i,n.width,n.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,r,i,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,i,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=U(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):j(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,e.DEPTH24_STENCIL8,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let i=0;i<t.length;i++){const s=t[i],a=o.convert(s.format,s.colorSpace),l=o.convert(s.type),c=S(s.internalFormat,a,l,s.colorSpace),u=U(n);r&&!1===j(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,c,n.width,n.height):j(n)?d.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function B(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),P(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture,s=U(i);if(i.depthTexture.format===ba)j(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(i.depthTexture.format!==wa)throw new Error("Unknown depthTexture format");j(i)?d.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),z(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),z(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(e){return Math.min(h,e.samples)}function j(e){const n=r.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function V(e,n){const r=e.colorSpace,i=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Ga||r!==Oa&&r!==La&&(ml.getTransfer(r)===za?!1===a?!0===t.has("EXT_sRGB")&&i===xa?(e.format=Ga,e.minFilter=da,e.generateMipmaps=!1):n=_l.sRGBToLinear(n):i===xa&&o===fa||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",r)),n}this.allocateTextureUnit=function(){const e=I;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),I+=1,e},this.resetTextureUnits=function(){I=0},this.setTexture2D=P,this.setTexture2DArray=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?k(o,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,o.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const o=r.get(t);t.version>0&&o.__version!==t.version?k(o,t,i):n.bindTexture(e.TEXTURE_3D,o.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,i,s){if(6!==i.image.length)return;const l=N(t,i),u=i.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);const h=r.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(e.TEXTURE0+s);const t=ml.getPrimaries(ml.workingColorSpace),r=i.colorSpace===La?null:ml.getPrimaries(i.colorSpace),d=i.colorSpace===La||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=i.isCompressedTexture||i.image[0].isCompressedTexture,f=i.image[0]&&i.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=p||f?f?i.image[e].image:i.image[e]:_(i.image[e],!1,!0,c),m[e]=V(i,m[e]);const g=m[0],y=x(g)||a,v=o.convert(i.format,i.colorSpace),E=o.convert(i.type),T=S(i.internalFormat,v,E,i.colorSpace),C=a&&!0!==i.isVideoTexture,A=void 0===h.__version||!0===l;let I,P=M(i,g,y);if(O(e.TEXTURE_CUBE_MAP,i,y),p){C&&A&&n.texStorage2D(e.TEXTURE_CUBE_MAP,P,T,g.width,g.height);for(let t=0;t<6;t++){I=m[t].mipmaps;for(let r=0;r<I.length;r++){const o=I[r];i.format!==xa?null!==v?C?n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,o.width,o.height,v,o.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,T,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,o.width,o.height,v,E,o.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,T,o.width,o.height,0,v,E,o.data)}}}else{I=i.mipmaps,C&&A&&(I.length>0&&P++,n.texStorage2D(e.TEXTURE_CUBE_MAP,P,T,m[0].width,m[0].height));for(let t=0;t<6;t++)if(f){C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,v,E,m[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,T,m[t].width,m[t].height,0,v,E,m[t].data);for(let r=0;r<I.length;r++){const i=I[r].image[t].image;C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,v,E,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,T,i.width,i.height,0,v,E,i.data)}}else{C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,v,E,m[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,T,v,E,m[t]);for(let r=0;r<I.length;r++){const i=I[r];C?n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,v,E,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,T,v,E,i.image[t])}}}b(i,y)&&w(e.TEXTURE_CUBE_MAP),h.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(s,t,i):n.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+i)},this.rebindTextures=function(t,n,i){const o=r.get(t);void 0!==n&&F(o.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&B(t)},this.setupRenderTarget=function(t){const l=t.texture,c=r.get(t),u=r.get(l);t.addEventListener("dispose",C),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,s.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=x(t)||a;if(h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let n=0;n<l.mipmaps.length;n++)c.__webglFramebuffer[t][n]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(a&&l.mipmaps&&l.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&t.samples>0&&!1===j(t)){const r=d?l:[l];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let n=0;n<r.length;n++){const i=r[n];c.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const s=o.convert(i.format,i.colorSpace),a=o.convert(i.type),l=S(i.internalFormat,s,a,i.colorSpace,!0===t.isXRRenderTarget),u=U(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,c.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),z(c.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),O(e.TEXTURE_CUBE_MAP,l,p);for(let n=0;n<6;n++)if(a&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)F(c.__webglFramebuffer[n][r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);b(l,p)&&w(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){const i=t.texture;for(let o=0,s=i.length;o<s;o++){const s=i[o],a=r.get(s);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),O(e.TEXTURE_2D,s,p),F(c.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,0),b(s,p)&&w(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(r,u.__webglTexture),O(r,l,p),a&&l.mipmaps&&l.mipmaps.length>0)for(let n=0;n<l.mipmaps.length;n++)F(c.__webglFramebuffer[n],t,l,e.COLOR_ATTACHMENT0,r,n);else F(c.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,r,0);b(l,p)&&w(r),n.unbindTexture()}t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(t){const i=x(t)||a,o=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=o.length;s<a;s++){const a=o[s];if(b(a,i)){const i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=r.get(a).__webglTexture;n.bindTexture(i,o),w(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===j(t)){const i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],o=t.width,s=t.height;let a=e.COLOR_BUFFER_BIT;const l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),h=!0===t.isWebGLMultipleRenderTargets;if(h)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){l.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&l.push(c);const d=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT)),h&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),h){const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,o,s,0,0,o,s,a,e.NEAREST),p&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const o=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,o,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=B,this.setupFrameBufferTexture=F,this.useMultisampledRTT=j}function Ep(e,t,n){const r=n.isWebGL2;return{convert:function(n){let i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:La;const s=ml.getTransfer(o);if(n===fa)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(n===ma)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(n===ga)return e.UNSIGNED_INT;if(n===ya)return e.FLOAT;if(n===va)return r?e.HALF_FLOAT:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(n===xa)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===ba)return e.DEPTH_COMPONENT;if(n===wa)return e.DEPTH_STENCIL;if(n===Ga)return i=t.get("EXT_sRGB"),null!==i?i.SRGB_ALPHA_EXT:null;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(n===Sa||n===Ma||n===Ea||n===Ta)if(s===za){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Sa)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ma)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Ea)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Ta)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Sa)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ma)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Ea)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ta)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(35840===n)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===n||37496===n){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(37492===n)return s===za?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(37496===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(37808===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===n)return s===za?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Ca||36494===n||36495===n){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===Ca)return s===za?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===n)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===n)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||36284===n||36285===n||36286===n){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===Ca)return i.COMPRESSED_RED_RGTC1_EXT;if(36284===n)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===n)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===n)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===_a?r?e.UNSIGNED_INT_24_8:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[n]?e[n]:null}}}class Tp extends Uu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}}class Cp extends Lc{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Ap={type:"move"};class Ip{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Cp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Cp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Rl,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Rl),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Cp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Rl,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Rl),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),a=.02,c=.005;l.inputState.pinching&&s>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Ap)))}return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Cp;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Pp extends Wa{constructor(e,t){super();const n=this;let r=null,i=1,o=null,s="local-floor",a=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=t.getContextAttributes();let m=null,g=null;const y=[],v=[],_=new rl;let x=null;const b=new Uu;b.layers.enable(1),b.viewport=new El;const w=new Uu;w.layers.enable(2),w.viewport=new El;const S=[b,w],M=new Tp;M.layers.enable(1),M.layers.enable(2);let E=null,T=null;function C(e){const t=v.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||o),n.dispatchEvent({type:e.type,data:e.inputSource}))}function A(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",A),r.removeEventListener("inputsourceschange",I);for(let e=0;e<y.length;e++){const t=v[e];null!==t&&(v[e]=null,y[e].disconnect(t))}E=null,T=null,e.setRenderTarget(m),d=null,h=null,u=null,r=null,g=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(x),e.setSize(_.width,_.height,!1),n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=v.indexOf(n);r>=0&&(v[r]=null,y[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=v.indexOf(n);if(-1===r){for(let e=0;e<y.length;e++){if(e>=v.length){v.push(n),r=e;break}if(null===v[e]){v[e]=n,r=e;break}}if(-1===r)break}const i=y[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new Ip,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new Ip,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new Ip,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(c){if(r=c,null!==r){if(m=e.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",A),r.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(_),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new Cl(d.framebufferWidth,d.framebufferHeight,{format:xa,type:fa,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let n=null,o=null,s=null;f.depth&&(s=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=f.stencil?wa:ba,o=f.stencil?_a:ga);const a={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(a),r.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),g=new Cl(h.textureWidth,h.textureHeight,{format:xa,type:fa,depthTexture:new Nh(h.textureWidth,h.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),l=null,o=await r.requestReferenceSpace(s),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const P=new Rl,R=new Rl;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;M.near=w.near=b.near=e.near,M.far=w.far=b.far=e.far,E===M.near&&T===M.far||(r.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,T=M.far);const t=e.parent,n=M.cameras;L(M,t);for(let e=0;e<n.length;e++)L(n[e],t);2===n.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const r=P.distanceTo(R),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=s*u,p=s*h,f=r/(-u+h),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+f,y=a+f,v=d-m,_=p+(r-m),x=l*a/y*g,b=c*a/y*g;e.projectionMatrix.makePerspective(v,_,x,b,g,y),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(M,b,w):M.projectionMatrix.copy(b.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Xa*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,M,t)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==h||null!==d)return a},this.setFoveation=function(e){a=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let D=null;const O=new Ju;O.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||o),p=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let n=!1;t.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let o=null;if(null!==d)o=d.getViewport(i);else{const t=u.getViewSubImage(h,i);o=t.viewport,0===r&&(e.setRenderTargetTextures(g,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=S[r];void 0===s&&(s=new Uu,s.layers.enable(r),s.viewport=new El,S[r]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&(M.matrix.copy(s.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===n&&M.cameras.push(s)}}for(let e=0;e<y.length;e++){const t=v[e],n=y[e];null!==t&&void 0!==n&&n.update(t,r,l||o)}D&&D(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){D=e},this.dispose=function(){}}}function Rp(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(r,i){r.opacity.value=i.opacity,i.color&&r.diffuse.value.copy(i.color),i.emissive&&r.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(r.map.value=i.map,n(i.map,r.mapTransform)),i.alphaMap&&(r.alphaMap.value=i.alphaMap,n(i.alphaMap,r.alphaMapTransform)),i.bumpMap&&(r.bumpMap.value=i.bumpMap,n(i.bumpMap,r.bumpMapTransform),r.bumpScale.value=i.bumpScale,1===i.side&&(r.bumpScale.value*=-1)),i.normalMap&&(r.normalMap.value=i.normalMap,n(i.normalMap,r.normalMapTransform),r.normalScale.value.copy(i.normalScale),1===i.side&&r.normalScale.value.negate()),i.displacementMap&&(r.displacementMap.value=i.displacementMap,n(i.displacementMap,r.displacementMapTransform),r.displacementScale.value=i.displacementScale,r.displacementBias.value=i.displacementBias),i.emissiveMap&&(r.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,r.emissiveMapTransform)),i.specularMap&&(r.specularMap.value=i.specularMap,n(i.specularMap,r.specularMapTransform)),i.alphaTest>0&&(r.alphaTest.value=i.alphaTest);const o=t.get(i).envMap;if(o&&(r.envMap.value=o,r.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,r.reflectivity.value=i.reflectivity,r.ior.value=i.ior,r.refractionRatio.value=i.refractionRatio),i.lightMap){r.lightMap.value=i.lightMap;const t=!0===e._useLegacyLights?Math.PI:1;r.lightMapIntensity.value=i.lightMapIntensity*t,n(i.lightMap,r.lightMapTransform)}i.aoMap&&(r.aoMap.value=i.aoMap,r.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,r.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,ku(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,o,s,a){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,r){e.metalness.value=r.metalness,r.metalnessMap&&(e.metalnessMap.value=r.metalnessMap,n(r.metalnessMap,e.metalnessMapTransform)),e.roughness.value=r.roughness,r.roughnessMap&&(e.roughnessMap.value=r.roughnessMap,n(r.roughnessMap,e.roughnessMapTransform));t.get(r).envMap&&(e.envMapIntensity.value=r.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,a)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,o,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Lp(e,t,n,r){let i={},o={},s=[];const a=n.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,n){const r=e.value;if(void 0===n[t]){if("number"==typeof r)n[t]=r;else{const e=Array.isArray(r)?r:[r],i=[];for(let t=0;t<e.length;t++)i.push(e[t].clone());n[t]=i}return!0}if("number"==typeof r){if(n[t]!==r)return n[t]=r,!0}else{const e=Array.isArray(n[t])?n[t]:[n[t]],i=Array.isArray(r)?r:[r];for(let t=0;t<e.length;t++){const n=e[t];if(!1===n.equals(i[t]))return n.copy(i[t]),!0}}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete o[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){let d=i[n.id];void 0===d&&(function(e){const t=e.uniforms;let n=0;let r=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],o={boundary:0,storage:0},s=Array.isArray(i.value)?i.value:[i.value];for(let e=0,t=s.length;e<t;e++){const t=c(s[e]);o.boundary+=t.boundary,o.storage+=t.storage}i.__data=new Float32Array(o.storage/Float32Array.BYTES_PER_ELEMENT),i.__offset=n,e>0&&(r=n%16,0!==r&&16-r-o.boundary<0&&(n+=16-r,i.__offset=n)),n+=o.storage}r=n%16,r>0&&(n+=16-r),e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<a;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,o=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,o),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u));const p=h.program;r.updateUBOMapping(n,p);const f=t.render.frame;o[n.id]!==f&&(function(t){const n=i[t.id],r=t.uniforms,o=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=r[t];if(!0===l(n,t,o)){const t=n.__offset,r=Array.isArray(n.value)?n.value:[n.value];let i=0;for(let o=0;o<r.length;o++){const s=r[o],a=c(s);"number"==typeof s?(n.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+i,n.__data)):s.isMatrix3?(n.__data[0]=s.elements[0],n.__data[1]=s.elements[1],n.__data[2]=s.elements[2],n.__data[3]=s.elements[0],n.__data[4]=s.elements[3],n.__data[5]=s.elements[4],n.__data[6]=s.elements[5],n.__data[7]=s.elements[0],n.__data[8]=s.elements[6],n.__data[9]=s.elements[7],n.__data[10]=s.elements[8],n.__data[11]=s.elements[0]):(s.toArray(n.__data,i),i+=a.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,n.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),o[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);s=[],i={},o={}}}}class Dp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{canvas:t=ll(),context:n=null,depth:r=!0,stencil:i=!0,alpha:o=!1,antialias:s=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let h;this.isWebGLRenderer=!0,h=null!==n?n.getContextAttributes().alpha:o;const d=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],y=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Da,this._useLegacyLights=!1,this.toneMapping=Js,this.toneMappingExposure=1;const v=this;let _=!1,x=0,b=0,w=null,S=-1,M=null;const E=new El,T=new El;let C=null;const A=new Xc(0);let I=0,P=t.width,R=t.height,L=1,D=null,O=null;const N=new El(0,0,P,R),k=new El(0,0,P,R);let F=!1;const z=new Ku;let B=!1,U=!1,j=null;const V=new ac,G=new rl,H=new Rl,Z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===w?L:1}let $,q,X,Y,K,J,Q,ee,te,ne,re,ie,oe,se,ae,le,ce,ue,he,de,pe,fe,me,ge,ye=n;function ve(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Hs}`),t.addEventListener("webglcontextlost",be,!1),t.addEventListener("webglcontextrestored",we,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ye){const t=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&t.shift(),ye=ve(t,e),null===ye)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&ye instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ye.getShaderPrecisionFormat&&(ye.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function _e(){$=new Ch(ye),q=new lh(ye,$,e),$.init(q),fe=new Ep(ye,$,q),X=new Sp(ye,$,q),Y=new Ph(ye),K=new cp,J=new Mp(ye,$,X,K,q,fe,Y),Q=new uh(v),ee=new Th(v),te=new Qu(ye,q),me=new sh(ye,$,te,q),ne=new Ah(ye,te,Y,me),re=new Oh(ye,ne,te,Y),he=new Dh(ye,q,J),le=new ch(K),ie=new lp(v,Q,ee,$,q,me,le),oe=new Rp(v,K),se=new pp,ae=new _p($,q),ue=new oh(v,Q,ee,X,re,h,a),ce=new wp(v,re,q),ge=new Lp(ye,Y,q,X),de=new ah(ye,$,Y,q),pe=new Ih(ye,$,Y,q),Y.programs=ie.programs,v.capabilities=q,v.extensions=$,v.properties=K,v.renderLists=se,v.shadowMap=ce,v.state=X,v.info=Y}_e();const xe=new Pp(v,ye);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const e=Y.autoReset,t=ce.enabled,n=ce.autoUpdate,r=ce.needsUpdate,i=ce.type;_e(),Y.autoReset=e,ce.enabled=t,ce.autoUpdate=n,ce.needsUpdate=r,ce.type=i}function Se(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){const t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){const t=K.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),K.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Oe(e,t,n),e.side=0,e.needsUpdate=!0,Oe(e,t,n),e.side=2):Oe(e,t,n)}this.xr=xe,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=$.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=$.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(P,R,!1))},this.getSize=function(e){return e.set(P,R)},this.setSize=function(e,n){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];xe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,R=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(P*L,R*L).floor()},this.setDrawingBufferSize=function(e,n,r){P=e,R=n,L=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(E)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),X.viewport(E.copy(N).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(k)},this.setScissor=function(e,t,n,r){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,n,r),X.scissor(T.copy(k).multiplyScalar(L).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){X.setScissorTest(F=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){O=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0;if(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]){let e=!1;if(null!==w){const t=w.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=w.texture.type,t=e===fa||e===ga||e===ma||e===_a||1017===e||1018===e,n=ue.getClearColor(),r=ue.getClearAlpha(),i=n.r,o=n.g,s=n.b;t?(d[0]=i,d[1]=o,d[2]=s,d[3]=r,ye.clearBufferuiv(ye.COLOR,0,d)):(p[0]=i,p[1]=o,p[2]=s,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else n|=ye.COLOR_BUFFER_BIT}e&&(n|=ye.DEPTH_BUFFER_BIT),t&&(n|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",be,!1),t.removeEventListener("webglcontextrestored",we,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),se.dispose(),ae.dispose(),K.dispose(),Q.dispose(),ee.dispose(),re.dispose(),me.dispose(),ge.dispose(),ie.dispose(),xe.dispose(),xe.removeEventListener("sessionstart",Ce),xe.removeEventListener("sessionend",Ae),j&&(j.dispose(),j=null),Ie.stop()},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=Z);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=function(e,t,n,r,i){!0!==t.isScene&&(t=Z),J.resetTextureUnits();const o=t.fog,s=r.isMeshStandardMaterial?t.environment:null,a=null===w?v.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Oa,l=(r.isMeshStandardMaterial?ee:Q).get(r.envMap||s),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=Js;r.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=v.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==g?g.length:0,_=K.get(r),x=m.state.lights;if(!0===B&&(!0===U||e!==M)){const t=e===M&&r.id===S;le.setState(r,e,t)}let b=!1;r.version===_.__version?_.needsLights&&_.lightsStateVersion!==x.state.version||_.outputColorSpace!==a||i.isBatchedMesh&&!1===_.batching?b=!0:i.isBatchedMesh||!0!==_.batching?i.isInstancedMesh&&!1===_.instancing?b=!0:i.isInstancedMesh||!0!==_.instancing?i.isSkinnedMesh&&!1===_.skinning?b=!0:i.isSkinnedMesh||!0!==_.skinning?i.isInstancedMesh&&!0===_.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===_.instancingColor&&null!==i.instanceColor||_.envMap!==l||!0===r.fog&&_.fog!==o?b=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===le.numPlanes&&_.numIntersection===le.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==u||_.morphTargets!==h||_.morphNormals!==d||_.morphColors!==p||_.toneMapping!==f||!0===q.isWebGL2&&_.morphTargetsCount!==y)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,_.__version=r.version);let E=_.currentProgram;!0===b&&(E=Oe(r,t,i));let T=!1,C=!1,A=!1;const I=E.getUniforms(),P=_.uniforms;if(X.useProgram(E.program)&&(T=!0,C=!0,A=!0),r.id!==S&&(S=r.id,C=!0),T||M!==e){I.setValue(ye,"projectionMatrix",e.projectionMatrix),I.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=I.map.cameraPosition;void 0!==t&&t.setValue(ye,H.setFromMatrixPosition(e.matrixWorld)),q.logarithmicDepthBuffer&&I.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&I.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,C=!0,A=!0)}if(i.isSkinnedMesh){I.setOptional(ye,i,"bindMatrix"),I.setOptional(ye,i,"bindMatrixInverse");const e=i.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),I.setValue(ye,"boneTexture",e.boneTexture,J)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}i.isBatchedMesh&&(I.setOptional(ye,i,"batchingTexture"),I.setValue(ye,"batchingTexture",i._matricesTexture,J));const D=n.morphAttributes;var O,N;if((void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===q.isWebGL2)&&he.update(i,n,E),(C||_.receiveShadow!==i.receiveShadow)&&(_.receiveShadow=i.receiveShadow,I.setValue(ye,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),C&&(I.setValue(ye,"toneMappingExposure",v.toneMappingExposure),_.needsLights&&(N=A,(O=P).ambientLightColor.needsUpdate=N,O.lightProbe.needsUpdate=N,O.directionalLights.needsUpdate=N,O.directionalLightShadows.needsUpdate=N,O.pointLights.needsUpdate=N,O.pointLightShadows.needsUpdate=N,O.spotLights.needsUpdate=N,O.spotLightShadows.needsUpdate=N,O.rectAreaLights.needsUpdate=N,O.hemisphereLights.needsUpdate=N),o&&!0===r.fog&&oe.refreshFogUniforms(P,o),oe.refreshMaterialUniforms(P,r,L,R,j),Ud.upload(ye,Ne(_),P,J)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ud.upload(ye,Ne(_),P,J),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&I.setValue(ye,"center",i.center),I.setValue(ye,"modelViewMatrix",i.modelViewMatrix),I.setValue(ye,"normalMatrix",i.normalMatrix),I.setValue(ye,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++)if(q.isWebGL2){const n=e[t];ge.update(n,E),ge.bind(n,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,n,r,i);X.setMaterial(r,s);let l=n.index,c=1;if(!0===r.wireframe){if(l=ne.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==o&&(d=Math.max(d,o.start*c),p=Math.min(p,(o.start+o.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let g;me.setup(i,r,a,n,l);let y=de;if(null!==l&&(g=te.get(l),y=pe,y.setIndex(g)),i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*W()),y.setMode(ye.LINES)):y.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*W()),i.isLineSegments?y.setMode(ye.LINES):i.isLineLoop?y.setMode(ye.LINE_LOOP):y.setMode(ye.LINE_STRIP)}else i.isPoints?y.setMode(ye.POINTS):i.isSprite&&y.setMode(ye.TRIANGLES);if(i.isBatchedMesh)y.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else if(i.isInstancedMesh)y.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);y.renderInstances(d,f,t)}else y.render(d,f)},this.compile=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=e),m=ae.get(n),m.init(),y.push(m),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(v._useLegacyLights);const r=new Set;return e.traverse((function(e){const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const o=t[i];Ee(o,n,e),r.add(o)}else Ee(t,n,e),r.add(t)})),y.pop(),m=null,r},this.compileAsync=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.compile(e,t,n);return new Promise((t=>{function n(){r.forEach((function(e){K.get(e).currentProgram.isReady()&&r.delete(e)})),0!==r.size?setTimeout(n,10):t(e)}null!==$.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Te=null;function Ce(){Ie.stop()}function Ae(){Ie.start()}const Ie=new Ju;function Pe(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||z.intersectsSprite(e)){r&&H.setFromMatrixPosition(e.matrixWorld).applyMatrix4(V);const t=re.update(e),i=e.material;i.visible&&f.push(e,t,i,n,H.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||z.intersectsObject(e))){const t=re.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),H.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),H.copy(t.boundingSphere.center)),H.applyMatrix4(e.matrixWorld).applyMatrix4(V)),Array.isArray(i)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&f.push(e,t,a,n,H.z,s)}}else i.visible&&f.push(e,t,i,n,H.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)Pe(i[e],t,n,r)}function Re(e,t,n,r){const i=e.opaque,o=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===B&&le.setGlobalState(v.clippingPlanes,n),o.length>0&&function(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;const i=q.isWebGL2;null===j&&(j=new Cl(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")?va:fa,minFilter:pa,samples:i?4:0})),v.getDrawingBufferSize(G),i?j.setSize(G.x,G.y):j.setSize(el(G.x),el(G.y));const o=v.getRenderTarget();v.setRenderTarget(j),v.getClearColor(A),I=v.getClearAlpha(),I<1&&v.setClearColor(16777215,.5),v.clear();const s=v.toneMapping;v.toneMapping=Js,Le(e,n,r),J.updateMultisampleRenderTarget(j),J.updateRenderTargetMipmap(j);let a=!1;for(let e=0,i=t.length;e<i;e++){const i=t[e],o=i.object,s=i.geometry,l=i.material,c=i.group;if(2===l.side&&o.layers.test(r.layers)){const e=l.side;l.side=1,l.needsUpdate=!0,De(o,n,r,s,l,c),l.side=e,l.needsUpdate=!0,a=!0}}!0===a&&(J.updateMultisampleRenderTarget(j),J.updateRenderTargetMipmap(j)),v.setRenderTarget(o),v.setClearColor(A,I),v.toneMapping=s}(i,o,t,n),r&&X.viewport(E.copy(r)),i.length>0&&Le(i,t,n),o.length>0&&Le(o,t,n),s.length>0&&Le(s,t,n),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1)}function Le(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,l=null===r?o.material:r,c=o.group;s.layers.test(n.layers)&&De(s,t,n,a,l,c)}}function De(e,t,n,r,i,o){e.onBeforeRender(v,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,o),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,o),i.side=0,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,o),i.side=2):v.renderBufferDirect(n,t,r,i,e,o),e.onAfterRender(v,t,n,r,i,o)}function Oe(e,t,n){!0!==t.isScene&&(t=Z);const r=K.get(e),i=m.state.lights,o=m.state.shadowsArray,s=i.state.version,a=ie.getParameters(e,i.state,o,t,n),l=ie.getProgramCacheKey(a);let c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:Q).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",Me),c=new Map,r.programs=c);let u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return ke(e,a),u}else a.uniforms=ie.getUniforms(e),e.onBuild(n,a,v),e.onBeforeCompile(a,v),u=ie.acquireProgram(a,l),c.set(l,u),r.uniforms=a.uniforms;const h=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=le.uniform),ke(e,a),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Ne(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=Ud.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function ke(e,t){const n=K.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ie.setAnimationLoop((function(e){Te&&Te(e)})),"undefined"!=typeof self&&Ie.setContext(self),this.setAnimationLoop=function(e){Te=e,xe.setAnimationLoop(e),null===e?Ie.stop():Ie.start()},xe.addEventListener("sessionstart",Ce),xe.addEventListener("sessionend",Ae),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===_)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===xe.enabled&&!0===xe.isPresenting&&(!0===xe.cameraAutoUpdate&&xe.updateCamera(t),t=xe.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,w),m=ae.get(e,y.length),m.init(),y.push(m),V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),z.setFromProjectionMatrix(V),U=this.localClippingEnabled,B=le.init(this.clippingPlanes,U),f=se.get(e,g.length),f.init(),g.push(f),Pe(e,t,0,v.sortObjects),f.finish(),!0===v.sortObjects&&f.sort(D,O),this.info.render.frame++,!0===B&&le.beginShadows();const n=m.state.shadowsArray;if(ce.render(n,e,t),!0===B&&le.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(f,e),m.setupLights(v._useLegacyLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Re(f,e,r,r.viewport)}}else Re(f,e,t);null!==w&&(J.updateMultisampleRenderTarget(w),J.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(v,e,t),me.resetDefaultState(),S=-1,M=null,y.pop(),m=y.length>0?y[y.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){K.get(e.texture).__webglTexture=t,K.get(e.depthTexture).__webglTexture=n;const r=K.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===$.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=K.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;w=e,x=t,b=n;let r=!0,i=null,o=!1,s=!1;if(e){const a=K.get(e);void 0!==a.__useDefaultFramebuffer?(X.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1):void 0===a.__webglFramebuffer?J.setupRenderTarget(e):a.__hasExternalTextures&&J.rebindTextures(e,K.get(e.texture).__webglTexture,K.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(c[t])?c[t][n]:c[t],o=!0):i=q.isWebGL2&&e.samples>0&&!1===J.useMultisampledRTT(e)?K.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,E.copy(e.viewport),T.copy(e.scissor),C=e.scissorTest}else E.copy(N).multiplyScalar(L).floor(),T.copy(k).multiplyScalar(L).floor(),C=F;if(X.bindFramebuffer(ye.FRAMEBUFFER,i)&&q.drawBuffers&&r&&X.drawBuffers(e,i),X.viewport(E),X.scissor(T),X.setScissorTest(C),o){const r=K.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){const r=K.get(e.texture),i=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){X.bindFramebuffer(ye.FRAMEBUFFER,a);try{const s=e.texture,a=s.format,l=s.type;if(a!==xa&&fe.convert(a)!==ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===va&&($.has("EXT_color_buffer_half_float")||q.isWebGL2&&$.has("EXT_color_buffer_float"));if(!(l===fa||fe.convert(l)===ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_TYPE)||l===ya&&(q.isWebGL2||$.has("OES_texture_float")||$.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ye.readPixels(t,n,r,i,fe.convert(a),fe.convert(l),o)}finally{const e=null!==w?K.get(w).__webglFramebuffer:null;X.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);J.setTexture2D(t,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,e.x,e.y,i,o),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=t.image.width,o=t.image.height,s=fe.convert(n.format),a=fe.convert(n.type);J.setTexture2D(n,0),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,n.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ye.texSubImage2D(ye.TEXTURE_2D,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&ye.generateMipmap(ye.TEXTURE_2D),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=fe.convert(r.format),c=fe.convert(r.type);let u;if(r.isData3DTexture)J.setTexture3D(r,0),u=ye.TEXTURE_3D;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(r,0),u=ye.TEXTURE_2D_ARRAY}ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,r.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,r.unpackAlignment);const h=ye.getParameter(ye.UNPACK_ROW_LENGTH),d=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),p=ye.getParameter(ye.UNPACK_SKIP_PIXELS),f=ye.getParameter(ye.UNPACK_SKIP_ROWS),m=ye.getParameter(ye.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;ye.pixelStorei(ye.UNPACK_ROW_LENGTH,g.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,g.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,e.min.x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,e.min.y),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,e.min.z),n.isDataTexture||n.isData3DTexture?ye.texSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ye.compressedTexSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,g.data)):ye.texSubImage3D(u,i,t.x,t.y,t.z,o,s,a,l,c,g),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,h),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,d),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,p),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,f),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&ye.generateMipmap(u),X.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?J.setTextureCube(e,0):e.isData3DTexture?J.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?J.setTexture2DArray(e,0):J.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){x=0,b=0,w=null,X.reset(),me.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ha}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Na?"display-p3":"srgb",t.unpackColorSpace=ml.workingColorSpace===ka?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Da?Ra:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ra?Da:Oa}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends Dp{}).prototype.isWebGL1Renderer=!0;class Op extends Jc{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Xc(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Np=new Rl,kp=new Rl,Fp=new ac,zp=new sc,Bp=new Jl;class Up extends Lc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pu,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Op;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Np.fromBufferAttribute(t,e-1),kp.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Np.distanceTo(kp);e.setAttribute("lineDistance",new ou(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Bp.copy(n.boundingSphere),Bp.applyMatrix4(r),Bp.radius+=i,!1===e.ray.intersectsSphere(Bp))return;Fp.copy(r).invert(),zp.copy(e.ray).applyMatrix4(Fp);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,l=new Rl,c=new Rl,u=new Rl,h=new Rl,d=this.isLineSegments?2:1,p=n.index,f=n.attributes.position;if(null!==p)for(let n=Math.max(0,o.start),r=Math.min(p.count,o.start+o.count)-1;n<r;n+=d){const r=p.getX(n),i=p.getX(n+1);if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,i),zp.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const o=e.ray.origin.distanceTo(h);o<e.near||o>e.far||t.push({distance:o,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,o.start),r=Math.min(f.count,o.start+o.count)-1;n<r;n+=d){if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,n+1),zp.distanceSqToSegment(l,c,h,u)>a)continue;h.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(h);r<e.near||r>e.far||t.push({distance:r,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}const jp=new Rl,Vp=new Rl;class Gp extends Up{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)jp.fromBufferAttribute(t,e),Vp.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+jp.distanceTo(Vp);e.setAttribute("lineDistance",new ou(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Hp{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,l=i-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===o)return r/(i-1);const c=n[r];return(r+(o-c)/(n[r+1]-c))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=t||(o.isVector2?new rl:new Rl);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Rl,r=[],i=[],o=[],s=new Rl,a=new ac;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Rl)}i[0]=new Rl,o[0]=new Rl;let l=Number.MAX_VALUE;const c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),h<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(Ka(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Ka(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Zp extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new rl,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=l-this.aY;a=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function Wp(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,c=(n-t)/s-(r-t)/(s+a)+(r-n)/a;l*=s,c*=s,i(t,n,l,c)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}const $p=new Rl,qp=new Wp,Xp=new Wp,Yp=new Wp;function Kp(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function Jp(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Qp(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class ef extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rl,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new rl;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(Qp(e,n.x,r.x,i.x,o.x),Qp(e,n.y,r.y,i.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class tf extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class nf extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl).subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rf extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rl;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl,n=this.v0,r=this.v1,i=this.v2;return t.set(Jp(e,n.x,r.x,i.x),Jp(e,n.y,r.y,i.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class of extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rl;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=this.v0,r=this.v1,i=this.v2;return t.set(Jp(e,n.x,r.x,i.x),Jp(e,n.y,r.y,i.y),Jp(e,n.z,r.z,i.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sf extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rl,n=this.points,r=(n.length-1)*e,i=Math.floor(r),o=r-i,s=n[0===i?i:i-1],a=n[i],l=n[i>n.length-2?n.length-1:i+1],c=n[i>n.length-3?n.length-1:i+2];return t.set(Kp(o,s.x,a.x,l.x,c.x),Kp(o,s.y,a.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new rl).fromArray(n))}return this}}var af=Object.freeze({__proto__:null,ArcCurve:class extends Zp{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=this.points,r=n.length,i=(r-(this.closed?0:1))*e;let o,s,a=Math.floor(i),l=i-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:0===l&&a===r-1&&(a=r-2,l=1),this.closed||a>0?o=n[(a-1)%r]:($p.subVectors(n[0],n[1]).add(n[0]),o=$p);const c=n[a%r],u=n[(a+1)%r];if(this.closed||a+2<r?s=n[(a+2)%r]:($p.subVectors(n[r-1],n[r-2]).add(n[r-1]),s=$p),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),r=Math.pow(u.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),qp.initNonuniformCatmullRom(o.x,c.x,u.x,s.x,t,n,r),Xp.initNonuniformCatmullRom(o.y,c.y,u.y,s.y,t,n,r),Yp.initNonuniformCatmullRom(o.z,c.z,u.z,s.z,t,n,r)}else"catmullrom"===this.curveType&&(qp.initCatmullRom(o.x,c.x,u.x,s.x,this.tension),Xp.initCatmullRom(o.y,c.y,u.y,s.y,this.tension),Yp.initCatmullRom(o.z,c.z,u.z,s.z,this.tension));return t.set(qp.calc(l),Xp.calc(l),Yp.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Rl).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:ef,CubicBezierCurve3:class extends Hp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rl,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Rl;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rl,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(Qp(e,n.x,r.x,i.x,o.x),Qp(e,n.y,r.y,i.y,o.y),Qp(e,n.z,r.z,i.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:Zp,LineCurve:tf,LineCurve3:nf,QuadraticBezierCurve:rf,QuadraticBezierCurve3:of,SplineCurve:sf});class lf extends Hp{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new af[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,o=this.curves[i],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new af[n.type]).fromJSON(n))}return this}}class cf extends lf{constructor(e){super(),this.type="Path",this.currentPoint=new rl,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new tf(this.currentPoint.clone(),new rl(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new rf(this.currentPoint.clone(),new rl(e,t),new rl(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const s=new ef(this.currentPoint.clone(),new rl(e,t),new rl(n,r),new rl(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new sf(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,o,s,a),this}absellipse(e,t,n,r,i,o,s,a){const l=new Zp(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}const uf=new Rl,hf=new Rl,df=new Rl,pf=new Hc;class ff extends pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(qa*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,l=[0,0,0],c=["a","b","c"],u=new Array(3),h={},d=[];for(let e=0;e<a;e+=3){o?(l[0]=o.getX(e),l[1]=o.getX(e+1),l[2]=o.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:a}=pf;if(t.fromBufferAttribute(s,l[0]),n.fromBufferAttribute(s,l[1]),a.fromBufferAttribute(s,l[2]),pf.getNormal(df),u[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,u[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,u[2]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=u[e],r=u[t],o=pf[c[e]],s=pf[c[t]],a=`${n}_${r}`,p=`${r}_${n}`;p in h&&h[p]?(df.dot(h[p].normal)<=i&&(d.push(o.x,o.y,o.z),d.push(s.x,s.y,s.z)),h[p]=null):a in h||(h[a]={index0:l[e],index1:l[t],normal:df.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];uf.fromBufferAttribute(s,t),hf.fromBufferAttribute(s,n),d.push(uf.x,uf.y,uf.z),d.push(hf.x,hf.y,hf.z)}this.setAttribute("position",new ou(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class mf extends cf{constructor(e){super(e),this.uuid=Ya(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new cf).fromJSON(n))}return this}}function gf(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=Ff(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=Ff(o,e[o],e[o+1],s);return s&&Rf(s,s.next)&&(zf(s),s=s.next),s}function yf(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Rf(r,r.next)&&0!==Pf(r.prev,r,r.next))r=r.next;else{if(zf(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function vf(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Tf(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<c&&(a++,r=r.nextZ,r);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(e,r,i,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?xf(e,r,i,o):_f(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),zf(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?vf(e=bf(yf(e),t,n),t,n,r,i,o,2):2===s&&wf(e,t,n,r,i,o):vf(yf(e),t,n,r,i,o,1);break}}function _f(e){const t=e.prev,n=e,r=e.next;if(Pf(t,n,r)>=0)return!1;const i=t.x,o=n.x,s=r.x,a=t.y,l=n.y,c=r.y,u=i<o?i<s?i:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=i>o?i>s?i:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Af(i,a,o,l,s,c,f.x,f.y)&&Pf(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function xf(e,t,n,r){const i=e.prev,o=e,s=e.next;if(Pf(i,o,s)>=0)return!1;const a=i.x,l=o.x,c=s.x,u=i.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,y=Tf(p,f,t,n,r),v=Tf(m,g,t,n,r);let _=e.prevZ,x=e.nextZ;for(;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&Af(a,u,l,h,c,d,_.x,_.y)&&Pf(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&Af(a,u,l,h,c,d,x.x,x.y)&&Pf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==s&&Af(a,u,l,h,c,d,_.x,_.y)&&Pf(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&Af(a,u,l,h,c,d,x.x,x.y)&&Pf(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function bf(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!Rf(i,o)&&Lf(i,r,r.next,o)&&Nf(i,o)&&Nf(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),zf(r),zf(r.next),r=e=o),r=r.next}while(r!==e);return yf(r)}function wf(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&If(s,e)){let a=kf(s,e);return s=yf(s,s.next),a=yf(a,a.next),vf(s,t,n,r,i,o,0),void vf(a,t,n,r,i,o,0)}e=e.next}s=s.next}while(s!==e)}function Sf(e,t){return e.x-t.x}function Mf(e,t){const n=function(e,t){let n,r=t,i=-1/0;const o=e.x,s=e.y;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const e=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=o&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===o))return n}r=r.next}while(r!==t);if(!n)return null;const a=n,l=n.x,c=n.y;let u,h=1/0;r=n;do{o>=r.x&&r.x>=l&&o!==r.x&&Af(s<c?o:i,s,l,c,s<c?i:o,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(o-r.x),Nf(r,e)&&(u<h||u===h&&(r.x>n.x||r.x===n.x&&Ef(n,r)))&&(n=r,h=u)),r=r.next}while(r!==a);return n}(e,t);if(!n)return t;const r=kf(n,e);return yf(r,r.next),yf(n,n.next)}function Ef(e,t){return Pf(e.prev,e,t.prev)<0&&Pf(t.next,e,e.next)<0}function Tf(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cf(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Af(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function If(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Lf(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Nf(e,t)&&Nf(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Pf(e.prev,e,t.prev)||Pf(e,t.prev,t))||Rf(e,t)&&Pf(e.prev,e,e.next)>0&&Pf(t.prev,t,t.next)>0)}function Pf(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Rf(e,t){return e.x===t.x&&e.y===t.y}function Lf(e,t,n,r){const i=Of(Pf(e,t,n)),o=Of(Pf(e,t,r)),s=Of(Pf(n,r,e)),a=Of(Pf(n,r,t));return i!==o&&s!==a||!(0!==i||!Df(e,n,t))||!(0!==o||!Df(e,r,t))||!(0!==s||!Df(n,e,r))||!(0!==a||!Df(n,t,r))}function Df(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Of(e){return e>0?1:e<0?-1:0}function Nf(e,t){return Pf(e.prev,e,e.next)<0?Pf(e,t,e.next)>=0&&Pf(e,e.prev,t)>=0:Pf(e,t,e.prev)<0||Pf(e,e.next,t)<0}function kf(e,t){const n=new Bf(e.i,e.x,e.y),r=new Bf(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ff(e,t,n,r){const i=new Bf(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function zf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bf(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Uf{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Uf.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];jf(e),Vf(n,e);let o=e.length;t.forEach(jf);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,Vf(n,t[e]);const s=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const r=t&&t.length,i=r?t[0]*n:e.length;let o=gf(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c,u,h,d,p;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,l,c;for(o=0,s=t.length;o<s;o++)a=t[o]*r,l=o<s-1?t[o+1]*r:e.length,c=gf(e,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Cf(c));for(i.sort(Sf),o=0;o<i.length;o++)n=Mf(i[o],n);return n}(e,t,o,n)),e.length>80*n){a=c=e[0],l=u=e[1];for(let t=n;t<i;t+=n)h=e[t],d=e[t+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-a,u-l),p=0!==p?32767/p:0}return vf(o,s,n,a,l,p,0),s}(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function jf(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Vf(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Gf extends pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mf([new rl(.5,.5),new rl(-.5,.5),new rl(-.5,-.5),new rl(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++)o(e[t]);function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let c=void 0===t.bevelEnabled||t.bevelEnabled,u=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:u-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Hf;let g,y,v,_,x,b=!1;f&&(g=f.getSpacedPoints(a),b=!0,c=!1,y=f.computeFrenetFrames(a,!1),v=new Rl,_=new Rl,x=new Rl),c||(p=0,u=0,h=0,d=0);const w=e.extractPoints(s);let S=w.shape;const M=w.holes;if(!Uf.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];Uf.isClockWise(t)&&(M[e]=t.reverse())}}const E=Uf.triangulateShape(S,M),T=S;for(let e=0,t=M.length;e<t;e++){const t=M[e];S=S.concat(t)}function C(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}const A=S.length,I=E.length;function P(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=s*s+a*a,h=s*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-a/h,f=t.y+s/h,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(s*c-a*l);r=p+s*m-e.x,i=f+a*m-e.y;const g=r*r+i*i;if(g<=2)return new rl(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(u)):(r=s,i=a,o=Math.sqrt(u/2))}return new rl(r/o,i/o)}const R=[];for(let e=0,t=T.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),R[e]=P(T[e],T[n],T[r]);const L=[];let D,O=R.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];D=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),D[e]=P(t[e],t[r],t[i]);L.push(D),O=O.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=C(T[e],R[e],r);F(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];D=L[e];for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);F(i.x,i.y,-n)}}}const N=h+d;for(let e=0;e<A;e++){const t=c?C(S[e],O[e],N):S[e];b?(_.copy(y.normals[0]).multiplyScalar(t.x),v.copy(y.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(v),F(x.x,x.y,x.z)):F(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const n=c?C(S[t],O[t],N):S[t];b?(_.copy(y.normals[e]).multiplyScalar(n.x),v.copy(y.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(_).add(v),F(x.x,x.y,x.z)):F(n.x,n.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=u*Math.cos(t*Math.PI/2),r=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=T.length;e<t;e++){const t=C(T[e],R[e],r);F(t.x,t.y,l+n)}for(let e=0,t=M.length;e<t;e++){const t=M[e];D=L[e];for(let e=0,i=t.length;e<i;e++){const i=C(t[e],D[e],r);b?F(i.x,i.y+g[a-1].y,g[a-1].x+n):F(i.x,i.y,l+n)}}}function k(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*p;e<n;e++){const n=A*e,o=A*(e+1);B(t+r+n,t+i+n,t+i+o,t+r+o)}}}function F(e,t,n){o.push(e),o.push(t),o.push(n)}function z(e,t,i){U(e),U(t),U(i);const o=r.length/3,s=m.generateTopUV(n,r,o-3,o-2,o-1);j(s[0]),j(s[1]),j(s[2])}function B(e,t,i,o){U(e),U(t),U(o),U(t),U(i),U(o);const s=r.length/3,a=m.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);j(a[0]),j(a[1]),j(a[3]),j(a[1]),j(a[2]),j(a[3])}function U(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function j(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(c){let e=0,t=A*e;for(let e=0;e<I;e++){const n=E[e];z(n[2]+t,n[1]+t,n[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<I;e++){const n=E[e];z(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<I;e++){const t=E[e];z(t[2],t[1],t[0])}for(let e=0;e<I;e++){const t=E[e];z(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;k(T,t),t+=T.length;for(let e=0,n=M.length;e<n;e++){const n=M[e];k(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new ou(r,3)),this.setAttribute("uv",new ou(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new af[r.type]).fromJSON(r)),new Gf(n,e.options)}}const Hf={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],l=t[3*r+1],c=t[3*i],u=t[3*i+1];return[new rl(o,s),new rl(a,l),new rl(c,u)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],y=t[3*o+2];return Math.abs(a-u)<Math.abs(s-c)?[new rl(s,1-l),new rl(c,1-h),new rl(d,1-f),new rl(m,1-y)]:[new rl(a,1-l),new rl(u,1-h),new rl(p,1-f),new rl(g,1-y)]}};class Zf extends pu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new of(new Rl(-1,-1,0),new Rl(-1,1,0),new Rl(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new Rl,a=new Rl,l=new rl;let c=new Rl;const u=[],h=[],d=[],p=[];function f(i){c=e.getPointAt(i/t,c);const l=o.normals[i],d=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+i*d.x,a.y=o*l.y+i*d.y,a.z=o*l.z+i*d.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=c.x+n*a.x,s.y=c.y+n*a.y,s.z=c.z+n*a.z,u.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,o,s)}}()}(),this.setIndex(p),this.setAttribute("position",new ou(u,3)),this.setAttribute("normal",new ou(h,3)),this.setAttribute("uv",new ou(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Zf((new af[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}function Wf(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}class $f{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class qf extends $f{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:i=e,s=2*t-n;break;case 2402:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=e,a=2*n-t;break;case 2402:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=i*c,this._offsetNext=o*c}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,y=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,v=(-1-d)*m+(1.5+d)*f+.5*p,_=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*o[c+e]+y*o[l+e]+v*o[a+e]+_*o[u+e];return i}}class Xf extends $f{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==s;++e)i[e]=o[l+e]*u+o[a+e]*c;return i}}class Yf extends $f{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Kf{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Wf(t,this.TimeBufferType),this.values=Wf(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Wf(e.times,Array),values:Wf(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Yf(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Xf(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qf(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Aa:t=this.InterpolantFactoryMethodDiscrete;break;case Ia:t=this.InterpolantFactoryMethodLinear;break;case Pa:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Aa;case this.InterpolantFactoryMethodLinear:return Ia;case this.InterpolantFactoryMethodSmooth:return Pa}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=n.slice(i,o),this.values=this.values.slice(i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&(s=r,ArrayBuffer.isView(s)&&!(s instanceof DataView)))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}var s;return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Pa,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Kf.prototype.TimeBufferType=Float32Array,Kf.prototype.ValueBufferType=Float32Array,Kf.prototype.DefaultInterpolation=Ia;class Jf extends Kf{}Jf.prototype.ValueTypeName="bool",Jf.prototype.ValueBufferType=Array,Jf.prototype.DefaultInterpolation=Aa,Jf.prototype.InterpolantFactoryMethodLinear=void 0,Jf.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Kf{}).prototype.ValueTypeName="color";(class extends Kf{}).prototype.ValueTypeName="number";class Qf extends $f{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let l=e*s;for(let e=l+s;l!==e;l+=4)Pl.slerpFlat(i,0,o,l-s,o,l,a);return i}}class em extends Kf{InterpolantFactoryMethodLinear(e){return new Qf(this.times,this.values,this.getValueSize(),e)}}em.prototype.ValueTypeName="quaternion",em.prototype.DefaultInterpolation=Ia,em.prototype.InterpolantFactoryMethodSmooth=void 0;class tm extends Kf{}tm.prototype.ValueTypeName="string",tm.prototype.ValueBufferType=Array,tm.prototype.DefaultInterpolation=Aa,tm.prototype.InterpolantFactoryMethodLinear=void 0,tm.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Kf{}).prototype.ValueTypeName="vector";const nm="\\[\\]\\.:\\/",rm=new RegExp("["+nm+"]","g"),im="[^"+nm+"]",om="[^"+nm.replace("\\.","")+"]",sm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",im)+/(WCOD+)?/.source.replace("WCOD",om)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",im)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",im)+"$"),am=["material","materials","bones","map"];class lm{constructor(e,t,n){this.path=t,this.parsedPath=n||lm.parseTrackName(t),this.node=lm.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new lm.Composite(e,t,n):new lm(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(rm,"")}static parseTrackName(e){const t=sm.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==am.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=lm.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lm.Composite=class{constructor(e,t,n){const r=n||lm.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},lm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},lm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},lm.prototype.GetterByBindingType=[lm.prototype._getValue_direct,lm.prototype._getValue_array,lm.prototype._getValue_arrayElement,lm.prototype._getValue_toArray],lm.prototype.SetterByBindingTypeAndVersioning=[[lm.prototype._setValue_direct,lm.prototype._setValue_direct_setNeedsUpdate,lm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lm.prototype._setValue_array,lm.prototype._setValue_array_setNeedsUpdate,lm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lm.prototype._setValue_arrayElement,lm.prototype._setValue_arrayElement_setNeedsUpdate,lm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lm.prototype._setValue_fromArray,lm.prototype._setValue_fromArray_setNeedsUpdate,lm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hs}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hs);const cm={bevelEnabled:!1,bevelOffset:0,bevelSegments:0,bevelSize:0,bevelThickness:1,steps:1},um=function(e,t){var n,r,i;const o=_r(fr(e)),s=function(e,t,n){void 0===n&&(n={});var r=mr(e),i=mr(t),o=lr(i[1]-r[1]),s=lr(i[0]-r[0]),a=lr(r[1]),l=lr(i[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return ar(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}(o.geometry.coordinates[0][0],o.geometry.coordinates[0][1],{units:"meters"}),a=qe().get(e,["properties","elevationFrom"]),l=qe().get(e,["properties","elevationTo"]),c=(null===(n=new(Gs())(a))||void 0===n?void 0:n.m)||0,u=((null===(r=new(Gs())(l))||void 0===r?void 0:r.m)||12400)-c,h=function(e){let{activity:t,airspaceType:n=""}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215;return"INACTIVE"===t?14700624:n.startsWith("OTHER")?r.OTHER:r[n]||i}(e.properties,t),d=new Op({color:h,linewidth:1});let p;const f=null===(i=qe().get(e,["geometry","coordinates",0]))||void 0===i?void 0:i.map((e=>[e[0],e[1],c])),m=js().projectToWorld([f[0][0],f[0][1],u]).z;if(s<40){const t=function(e,t){void 0===t&&(t={});var n=0,r=0,i=0;return ur(e,(function(e){n+=e[0],r+=e[1],i++}),!0),ir([n/i,r/i],t.properties)}(e),n=s/2,r=js().projectToWorld([...t.geometry.coordinates,c]),i=js().projectToWorld([...t.geometry.coordinates,c+u]),o=new nf(r,i),a=new Zf(o,64,n,16);p=new Gp(new ff(a),d)}else{const e=null==f?void 0:f.map((e=>js().projectToWorld(e))),t=new mf(e),n=new Gf(t,{...cm,depth:m});p=new Gp(new ff(n),d),p.position.setZ(e[0].z)}return p.userData=e.properties,p};function hm(e){return"Group"===e.type?hm((0,$e.first)(null==e?void 0:e.children)):"LineSegments"===e.type?e:null}function dm(e){const t=hm(e),{geometry:n}=t.geometry.parameters;let r=new Ru(n,new Qc({color:t.material.color,side:0,opacity:.5,transparent:!0}));return"Group"===e.type?r.position.set(e.position.x,e.position.y,e.position.z):r.position.set(t.position.x,t.position.y,t.position.z),r}var pm=zn("map"),fm=zn("threebox"),mm=zn("airspaces"),gm=zn("airspaceSelected"),ym=zn("colors");var vm=zn("layers"),_m=zn("layersHidden"),xm=zn("map");var bm=zn("map"),wm=zn("sources");const Sm=199,Mm=499,Em=500,Tm=501,Cm={antialias:!0,attributionControl:!0,container:"map-view-container",fadeDuration:0,logoPosition:"bottom-right",maxPitch:85,zoom:1.4},Am={resize:"resize",remove:"remove",mousedown:"mousedown",mouseup:"mouseup",mouseover:"mouseover",mousemove:"mousemove",mouseenter:"mouseenter",mouseleave:"mouseleave",mouseout:"mouseout",preclick:"preclick",click:"click",dbclick:"dbclick",contextmenu:"contextmenu",wheel:"wheel",touchstart:"touchstart",touchend:"touchend",touchmove:"touchmove",touchcancel:"touchcancel",movestart:"movestart",move:"move",moveend:"moveend",dragstart:"dragstart",drag:"drag",dragend:"dragend",boxzoomstart:"boxzoomstart",boxzoomend:"boxzoomend",boxzoomcancel:"boxzoomcancel",zoomstart:"zoomstart",zoom:"zoom",zoomend:"zoomend",rotatestart:"rotatestart",rotate:"rotate",rotateend:"rotateend",pitchstart:"pitchstart",pitch:"pitch",pitchend:"pitchend",load:"load",renderstart:"renderstart",render:"render",idle:"idle",error:"error",webglcontextlost:"webglcontextlost",webglcontextrestored:"webglcontextrestored",data:"data",dataloading:"dataloading",sourcedata:"sourcedata",sourcedataloading:"sourcedataloading",styledata:"styledata",styledataloading:"styledataloading",styleimagemissing:"styleimagemissing","style.import.load":"style.import.load","style.load":"style.load"},Im="threebox-base-layer",Pm="globe",Rm="mercator";var Lm=zn("config"),Dm=zn("context"),Om=zn("map"),Nm=zn("threebox"),km=zn("eventHandlers"),Fm=zn("aixmLayers"),zm=zn("globe"),Bm=zn("opacity"),Um=zn("style"),jm=zn("terrain"),Vm=zn("mountThreebox"),Gm=zn("registerEventHandlers"),Hm=zn("setThreeboxThresholdByZoom");class Zm{constructor(){var e=this;Object.defineProperty(this,Lm,{writable:!0,value:void 0}),Object.defineProperty(this,Dm,{writable:!0,value:void 0}),Object.defineProperty(this,Om,{writable:!0,value:null}),Object.defineProperty(this,Nm,{writable:!0,value:null}),Object.defineProperty(this,km,{writable:!0,value:new Map}),Object.defineProperty(this,Fm,{writable:!0,value:[]}),Object.defineProperty(this,zm,{writable:!0,value:!1}),Object.defineProperty(this,Bm,{writable:!0,value:1}),Object.defineProperty(this,Um,{writable:!0,value:null}),Object.defineProperty(this,jm,{writable:!0,value:!1}),Object.defineProperty(this,Vm,{writable:!0,value:()=>{kn(this,Om)[Om].off("zoomend",kn(this,Hm)[Hm]),kn(this,Om)[Om].getLayer(Im)&&this.layer.remove(Im),this.layer.set(Im,{id:Im,type:"custom",renderingMode:"3d",onAdd:(e,t)=>{window.tb=new Bs.Threebox(e,t,{defaultLights:!0}),window.tb.raycaster.params.Line.threshold=3,kn(this,Nm)[Nm]=window.tb,kn(this,Om)[Om].on("zoomend",kn(this,Hm)[Hm])},render:()=>window.tb.update(),index:Em})}}),Object.defineProperty(this,Gm,{writable:!0,value:e=>{const t=kn(this,km)[km].get(e);if(t.function&&kn(this,Om)[Om].off(e,t.function),t.handlers.length){const n=t.handlers.some((e=>e.options.once));t.function=r=>{t.handlers.every((e=>{let{handler:n,options:i={}}=e;return n(r),i.once&&(t.handlers=t.handlers.filter((e=>e.handler!==n))),!i.stopPropagation})),n&&kn(this,Gm)[Gm](e)},kn(this,Om)[Om].on(e,t.function)}}}),Object.defineProperty(this,Hm,{writable:!0,value:()=>{var e,t;null!==(e=kn(this,Nm)[Nm])&&void 0!==e&&null!==(t=e.params)&&void 0!==t&&t.Line&&(kn(this,Nm)[Nm].params.Line.threshold=3+Math.pow(14-kn(this,Om)[Om].transform.zoom,2))}}),this.mount=function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cm;return new Promise((i=>{kn(e,Dm)[Dm]=t,kn(e,Lm)[Lm]=n,zs().accessToken=kn(e,Lm)[Lm].mapboxAccessToken,kn(e,Om)[Om]=new(zs().Map)(r).once("load",(async()=>{Ns(kn(e,Om)[Om]),e.source=new class{constructor(e){Object.defineProperty(this,bm,{writable:!0,value:void 0}),Object.defineProperty(this,wm,{writable:!0,value:new Map}),this.get=e=>kn(this,wm)[wm].get(e),this.getAll=()=>kn(this,wm)[wm],this.rehydrate=e=>{kn(this,bm)[bm]=e,Array.from(kn(this,wm)[wm].entries()).forEach((e=>{let[t,n]=e;kn(this,bm)[bm].getSource(t)||kn(this,bm)[bm].addSource(t,n)}))},this.remove=e=>{kn(this,bm)[bm].getSource(e)&&kn(this,bm)[bm].removeSource(e),kn(this,wm)[wm].delete(e)},this.set=(e,t)=>{const n=kn(this,bm)[bm].getSource(e),r={type:"geojson",data:t,generateId:!0};n?n.setData(t):kn(this,bm)[bm].addSource(e,r),kn(this,wm)[wm].set(e,r)},kn(this,bm)[bm]=e}}(kn(e,Om)[Om]),e.layer=new class{constructor(e){Object.defineProperty(this,vm,{writable:!0,value:new Map}),Object.defineProperty(this,_m,{writable:!0,value:[]}),Object.defineProperty(this,xm,{writable:!0,value:void 0}),this.getAll=()=>kn(this,vm)[vm],this.getHidden=()=>kn(this,_m)[_m],this.hide=e=>{kn(this,xm)[xm].getLayer(e)&&(kn(this,xm)[xm].setLayoutProperty(e,"visibility","none"),kn(this,_m)[_m].includes(e)||kn(this,_m)[_m].push(e))},this.rehydrate=e=>{kn(this,xm)[xm]=e,Array.from(kn(this,vm)[vm].entries()).forEach((e=>{let[t,n]=e;kn(this,xm)[xm].getLayer(t)||kn(this,xm)[xm].addLayer(n)})),this.sort(),kn(this,_m)[_m].forEach((e=>this.hide(e)))},this.remove=e=>{kn(this,xm)[xm].getLayer(e)&&kn(this,xm)[xm].removeLayer(e),kn(this,vm)[vm].delete(e),this.sort()},this.set=(e,t)=>{kn(this,xm)[xm].getLayer(e)||(kn(this,xm)[xm].addLayer(t),kn(this,vm)[vm].set(e,t),this.sort())},this.show=e=>{kn(this,xm)[xm].getLayer(e)&&(kn(this,xm)[xm].setLayoutProperty(e,"visibility","visible"),kn(this,_m)[_m].includes(e)||(kn(this,_m)[_m]=kn(this,_m)[_m].filter((t=>t!==e))))},this.sort=()=>{const e=(0,$e.orderBy)(Array.from(kn(this,vm)[vm].values()).filter((e=>kn(this,xm)[xm].getLayer(e.id))),"index").map((e=>e.id));for(let t=e.length-1;t>0;t--)kn(this,xm)[xm].moveLayer(e[t-1],e[t])},kn(this,xm)[xm]=e}}(kn(e,Om)[Om]),kn(e,Vm)[Vm](),e.airspace=new class{constructor(e,t){var n=this;Object.defineProperty(this,pm,{writable:!0,value:void 0}),Object.defineProperty(this,fm,{writable:!0,value:void 0}),Object.defineProperty(this,mm,{writable:!0,value:new Map}),Object.defineProperty(this,gm,{writable:!0,value:null}),Object.defineProperty(this,ym,{writable:!0,value:new Map}),this.colors={get:()=>kn(this,ym)[ym],set:e=>{kn(this,ym)[ym]=e}},this.getAll=()=>kn(this,mm)[mm],this.getSelected=()=>kn(this,gm)[gm],this.hide=e=>{kn(this,mm)[mm].has(e)&&(kn(this,mm)[mm].get(e).visible=!1)},this.hideAll=()=>{Array.from(kn(this,mm)[mm].keys()).forEach((e=>{kn(this,mm)[mm].get(e).visible=!1}))},this.rehydrate=(e,t)=>{kn(this,pm)[pm]=e,kn(this,fm)[fm]=t,Array.from(kn(this,mm)[mm].values()).forEach((e=>kn(this,fm)[fm].add(e))),kn(this,gm)[gm]&&kn(this,fm)[fm].add(kn(this,gm)[gm])},this.remove=e=>{kn(this,mm)[mm].has(e)&&(kn(this,fm)[fm].remove(kn(this,mm)[mm].get(e)),kn(this,mm)[mm].delete(e))},this.removeAll=()=>{Array.from(kn(this,mm)[mm].values()).forEach((e=>kn(this,fm)[fm].remove(e))),kn(this,mm)[mm].clear()},this.select=e=>{kn(this,gm)[gm]&&kn(this,fm)[fm].remove(kn(this,gm)[gm]),kn(this,mm)[mm].has(e)?(kn(this,gm)[gm]=dm(kn(this,mm)[mm].get(e)),kn(this,fm)[fm].add(kn(this,gm)[gm])):kn(this,gm)[gm]=null,kn(this,pm)[pm].triggerRepaint()},this.set=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=e.properties.identifier;if(kn(n,mm)[mm].has(r))kn(n,mm)[mm].get(r).visible=t;else{let i=um(e,kn(n,ym)[ym]);i.visible=t,kn(n,fm)[fm].add(i),kn(n,mm)[mm].set(r,i)}},this.show=e=>{kn(this,mm)[mm].has(e)&&(kn(this,mm)[mm].get(e).visible=!0)},this.showAll=()=>{Array.from(kn(this,mm)[mm].keys()).forEach((e=>{kn(this,mm)[mm].get(e).visible=!0}))},kn(this,pm)[pm]=e,kn(this,fm)[fm]=t}}(kn(e,Om)[Om],kn(e,Nm)[Nm]),i()}))}))},this.unmount=()=>{var e,t;null===(e=kn(this,Om)[Om])||void 0===e||null===(t=e.remove)||void 0===t||t.call(e)},this.aixmLayers={get:()=>kn(this,Fm)[Fm],set:e=>{kn(this,Fm)[Fm]=e}},this.bearing={get:()=>kn(this,Om)[Om].getBearing(),set:e=>{kn(this,Om)[Om].setBearing(e)}},this.bbox={get:()=>{const{_sw:e,_ne:t}=kn(this,Om)[Om].getBounds();return[e.lng,e.lat,t.lng,t.lat]},check:e=>function(e){return Array.isArray(e)&&4===e.length&&(0,$e.every)(e,$e.isFinite)}(e),fit:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{bearing:kn(e,Om)[Om].getBearing(),maxZoom:18,padding:{left:60},pitch:kn(e,Om)[Om].getPitch(),speed:2};if(e.bbox.check(t)){const[r,i,o,s]=t;kn(e,Om)[Om].fitBounds([[r,i],[o,s]],n)}}},this.center={get:()=>kn(this,Om)[Om].getCenter(),set:e=>kn(this,Om)[Om].setCenter(e)},this.geojson={fit:(e,t)=>{try{const n=function(e,t,n){var r=(n=n||{}).units||"kilometers",i=n.steps||8;if(!e)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof i)throw new Error("steps must be an number");if(void 0===t)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var o=[];switch(e.type){case"GeometryCollection":return dr(e,(function(e){var n=As(e,t,r,i);n&&o.push(n)})),sr(o);case"FeatureCollection":return hr(e,(function(e){var n=As(e,t,r,i);n&&hr(n,(function(e){e&&o.push(e)}))})),sr(o)}return As(e,t,r,i)}(e,5,{units:"meters",steps:1});this.bbox.fit(fr(n),t)}catch(t){console.error("Invalid geojson: ",e,"\nError: ",t)}}},this.getMapboxFeatures=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return kn(e,Om)[Om].queryRenderedFeatures(t,n)},this.getThreeboxFeatures=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return kn(e,Nm)[Nm].queryRenderedFeatures(t).map((e=>e.object)).filter((e=>!!n||e.visible)).map(ks).filter((e=>!!e))},this.globe={get:()=>kn(this,zm)[zm],set:(e,t)=>{kn(this,Lm)[Lm].enabledGlobe&&(e!==kn(this,zm)[zm]||t)&&(kn(this,zm)[zm]=e,kn(this,zm)[zm]?kn(this,Om)[Om].setProjection(Pm):kn(this,Om)[Om].setProjection(Rm))}},this.jumpTo=e=>{kn(this,Om)[Om].jumpTo(e)},this.off=(e,t)=>{if(kn(this,km)[km].has(e)){const n=Bn(t);kn(this,km)[km].get(e).handlers=kn(this,km)[km].get(e).handlers.filter((e=>e.hash!==n)),kn(this,Gm)[Gm](e)}},this.on=function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Am[t]&&(kn(e,km)[km].has(t)||kn(e,km)[km].set(t,{function:null,handlers:[]}),kn(e,km)[km].get(t).handlers=qe().orderBy([...kn(e,km)[km].get(t).handlers,{handler:n,hash:Bn(n),options:r}],(e=>e.options.priority||0),"desc"),kn(e,Gm)[Gm](t))},this.opacity={get:()=>kn(this,Bm)[Bm],set:function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(t!==kn(e,Bm)[Bm]||n)&&(kn(e,Bm)[Bm]=t,qe().differenceBy(kn(e,Om)[Om].getStyle().layers,Array.from(e.layer.getAll().values()),"id").forEach((t=>{"symbol"===t.type?(kn(e,Om)[Om].setPaintProperty(t.id,"icon-opacity",kn(e,Bm)[Bm]),kn(e,Om)[Om].setPaintProperty(t.id,"text-opacity",kn(e,Bm)[Bm])):kn(e,Om)[Om].setPaintProperty(t.id,`${t.type}-opacity`,kn(e,Bm)[Bm])})))}},this.pitch={get:()=>kn(this,Om)[Om].getPitch(),set:e=>{kn(this,Om)[Om].setPitch(e)}},this.removeFeatureState=e=>{kn(this,Om)[Om].removeFeatureState(e)},this.setFeatureState=(e,t)=>{kn(this,Om)[Om].setFeatureState(e,t)},this.setStyle=e=>{var t;(t=e,new Promise((function(e,n){t.startsWith("/")?fetch(t).then((t=>{t.json().then(e).catch(n)})).catch(n):e(t)}))).then((e=>{kn(this,Um)[Um]=e,kn(this,Om)[Om].setStyle(kn(this,Um)[Um]),kn(this,Om)[Om].once(Am["style.load"],(()=>{Ns(kn(this,Om)[Om]),this.globe.set(kn(this,zm)[zm],!0),this.opacity.set(kn(this,Bm)[Bm],!0),this.terrain.set(kn(this,jm)[jm],!0),kn(this,Vm)[Vm](),this.source.rehydrate(kn(this,Om)[Om]),this.layer.rehydrate(kn(this,Om)[Om]),this.airspace.rehydrate(kn(this,Om)[Om],kn(this,Nm)[Nm]),this.aircraft.rehydrate(kn(this,Om)[Om],kn(this,Nm)[Nm])}))}))},this.terrain={get:()=>kn(this,jm)[jm],set:(e,t)=>{var n;kn(this,Lm)[Lm].enabledTerrain&&(e!==kn(this,jm)[jm]||t)&&(kn(this,jm)[jm]=e,kn(this,jm)[jm]?(Ls(n=kn(this,Om)[Om]),n.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:256,maxzoom:14}),n.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,0],"sky-atmosphere-sun-intensity":15}}),n.setTerrain({source:"mapbox-dem"})):Ls(kn(this,Om)[Om]),kn(this,Om)[Om].triggerRepaint())}},this.zoom={get:()=>kn(this,Om)[Om].getZoom(),set:e=>{kn(this,Om)[Om].setZoom(e)}}}}var Wm=i(1168);function $m(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=$m(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}const qm=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=$m(e))&&(r&&(r+=" "),r+=t);return r};let Xm={data:""},Ym=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||Xm,Km=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Jm=/\/\*[^]*?\*\/|  +/g,Qm=/\n+/g,eg=(e,t)=>{let n="",r="",i="";for(let o in e){let s=e[o];"@"==o[0]?"i"==o[1]?n=o+" "+s+";":r+="f"==o[1]?eg(s,o):o+"{"+eg(s,"k"==o[1]?"":t)+"}":"object"==typeof s?r+=eg(s,t?t.replace(/([^,])+/g,(e=>o.replace(/(^:.*)|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):o):null!=s&&(o=/^--/.test(o)?o:o.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=eg.p?eg.p(o,s):o+":"+s+";")}return n+(t&&i?t+"{"+i+"}":i)+r},tg={},ng=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+ng(e[n]);return t}return e},rg=(e,t,n,r,i)=>{let o=ng(e),s=tg[o]||(tg[o]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(o));if(!tg[s]){let t=o!==e?e:(e=>{let t,n,r=[{}];for(;t=Km.exec(e.replace(Jm,""));)t[4]?r.shift():t[3]?(n=t[3].replace(Qm," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(Qm," ").trim();return r[0]})(e);tg[s]=eg(i?{["@keyframes "+s]:t}:t,n?"":"."+s)}let a=n&&tg.g?tg.g:null;return n&&(tg.g=tg[s]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(tg[s],t,r,a),s},ig=(e,t,n)=>e.reduce(((e,r,i)=>{let o=t[i];if(o&&o.call){let e=o(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;o=t?"."+t:e&&"object"==typeof e?e.props?"":eg(e,""):!1===e?"":e}return e+r+(null==o?"":o)}),"");function og(e){let t=this||{},n=e.call?e(t.p):e;return rg(n.unshift?n.raw?ig(n,[].slice.call(arguments,1),t.p):n.reduce(((e,n)=>Object.assign(e,n&&n.call?n(t.p):n)),{}):n,Ym(t.target),t.g,t.o,t.k)}function sg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ag(e,t,n){return t&&sg(e.prototype,t),n&&sg(e,n),e}function lg(){return lg=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},lg.apply(this,arguments)}function cg(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ug(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function hg(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}og.bind({g:1}),og.bind({k:1});var dg=function(){return""},pg=e.createContext({enqueueSnackbar:dg,closeSnackbar:dg}),fg="@media (max-width:599.95px)",mg="@media (min-width:600px)",gg=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},yg=function(e){return""+gg(e.vertical)+gg(e.horizontal)},vg=function(e){return!!e||0===e},_g="unmounted",xg="exited",bg="entering",wg="entered",Sg="exiting",Mg=function(e){function t(t){var n;n=e.call(this,t)||this;var r,i=t.appear;return n.appearStatus=null,t.in?i?(r=xg,n.appearStatus=bg):r=wg:r=t.unmountOnExit||t.mountOnEnter?_g:xg,n.state={status:r},n.nextCallback=null,n}cg(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===_g?{status:xg}:null};var n=t.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==bg&&n!==wg&&(t=bg):n!==bg&&n!==wg||(t=Sg)}this.updateStatus(!1,t)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var e=this.props.timeout,t=e,n=e;return null!=e&&"number"!=typeof e&&"string"!=typeof e&&(n=e.exit,t=e.enter),{exit:n,enter:t}},n.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===bg?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===xg&&this.setState({status:_g})},n.performEnter=function(e){var t=this,n=this.props.enter,r=e,i=this.getTimeouts();e||n?(this.props.onEnter&&this.props.onEnter(this.node,r),this.safeSetState({status:bg},(function(){t.props.onEntering&&t.props.onEntering(t.node,r),t.onTransitionEnd(i.enter,(function(){t.safeSetState({status:wg},(function(){t.props.onEntered&&t.props.onEntered(t.node,r)}))}))}))):this.safeSetState({status:wg},(function(){t.props.onEntered&&t.props.onEntered(t.node,r)}))},n.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts();t?(this.props.onExit&&this.props.onExit(this.node),this.safeSetState({status:Sg},(function(){e.props.onExiting&&e.props.onExiting(e.node),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:xg},(function(){e.props.onExited&&e.props.onExited(e.node)}))}))}))):this.safeSetState({status:xg},(function(){e.props.onExited&&e.props.onExited(e.node)}))},n.cancelNextCallback=function(){null!==this.nextCallback&&this.nextCallback.cancel&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},n.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(){n&&(n=!1,t.nextCallback=null,e())},this.nextCallback.cancel=function(){n=!1},this.nextCallback},n.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=null==e&&!this.props.addEndListener;this.node&&!n?(this.props.addEndListener&&this.props.addEndListener(this.node,this.nextCallback),null!=e&&setTimeout(this.nextCallback,e)):setTimeout(this.nextCallback,0)},n.render=function(){var e=this.state.status;if(e===_g)return null;var t=this.props;return(0,t.children)(e,ug(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]))},ag(t,[{key:"node",get:function(){var e,t=null===(e=this.props.nodeRef)||void 0===e?void 0:e.current;if(!t)throw new Error("notistack - Custom snackbar is not refForwarding");return t}}]),t}(e.Component);function Eg(){}function Tg(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function Cg(t,n){return(0,e.useMemo)((function(){return null==t&&null==n?null:function(e){Tg(t,e),Tg(n,e)}}),[t,n])}function Ag(e){var t=e.timeout,n=e.style,r=void 0===n?{}:n,i=e.mode;return{duration:"object"==typeof t?t[i]||0:t,easing:r.transitionTimingFunction,delay:r.transitionDelay}}Mg.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Eg,onEntering:Eg,onEntered:Eg,onExit:Eg,onExiting:Eg,onExited:Eg};var Ig=function(e){e.scrollTop=e.scrollTop},Pg=function(e){return Math.round(e)+"ms"};function Rg(e,t){void 0===e&&(e=["all"]);var n=t||{},r=n.duration,i=void 0===r?300:r,o=n.easing,s=void 0===o?"cubic-bezier(0.4, 0, 0.2, 1)":o,a=n.delay,l=void 0===a?0:a;return(Array.isArray(e)?e:[e]).map((function(e){var t="string"==typeof i?i:Pg(i),n="string"==typeof l?l:Pg(l);return e+" "+t+" "+s+" "+n})).join(",")}function Lg(e){var t=function(e){return e&&e.ownerDocument||document}(e);return t.defaultView||window}function Dg(e,t){if(t){var n=function(e,t){var n,r=t.getBoundingClientRect(),i=Lg(t);if(t.fakeTransform)n=t.fakeTransform;else{var o=i.getComputedStyle(t);n=o.getPropertyValue("-webkit-transform")||o.getPropertyValue("transform")}var s=0,a=0;if(n&&"none"!==n&&"string"==typeof n){var l=n.split("(")[1].split(")")[0].split(",");s=parseInt(l[4],10),a=parseInt(l[5],10)}switch(e){case"left":return"translateX("+(i.innerWidth+s-r.left)+"px)";case"right":return"translateX(-"+(r.left+r.width-s)+"px)";case"up":return"translateY("+(i.innerHeight+a-r.top)+"px)";default:return"translateY(-"+(r.top+r.height-a)+"px)"}}(e,t);n&&(t.style.webkitTransform=n,t.style.transform=n)}}var Og=(0,e.forwardRef)((function(t,n){var r=t.children,i=t.direction,o=void 0===i?"down":i,s=t.in,a=t.style,l=t.timeout,c=void 0===l?0:l,u=t.onEnter,h=t.onEntered,d=t.onExit,p=t.onExited,f=ug(t,["children","direction","in","style","timeout","onEnter","onEntered","onExit","onExited"]),m=(0,e.useRef)(null),g=Cg(r.ref,m),y=Cg(g,n),v=(0,e.useCallback)((function(){m.current&&Dg(o,m.current)}),[o]);return(0,e.useEffect)((function(){if(!s&&"down"!==o&&"right"!==o){var e=function(e,t){var n;function r(){for(var r=this,i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];clearTimeout(n),n=setTimeout((function(){e.apply(r,o)}),t)}return void 0===t&&(t=166),r.clear=function(){clearTimeout(n)},r}((function(){m.current&&Dg(o,m.current)})),t=Lg(m.current);return t.addEventListener("resize",e),function(){e.clear(),t.removeEventListener("resize",e)}}}),[o,s]),(0,e.useEffect)((function(){s||v()}),[s,v]),(0,e.createElement)(Mg,Object.assign({appear:!0,nodeRef:m,onEnter:function(e,t){Dg(o,e),Ig(e),u&&u(e,t)},onEntered:h,onEntering:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||"cubic-bezier(0.0, 0, 0.2, 1)",n=Ag({timeout:c,mode:"enter",style:lg({},a,{transitionTimingFunction:t})});e.style.webkitTransition=Rg("-webkit-transform",n),e.style.transition=Rg("transform",n),e.style.webkitTransform="none",e.style.transform="none"},onExit:function(e){var t=(null==a?void 0:a.transitionTimingFunction)||"cubic-bezier(0.4, 0, 0.6, 1)",n=Ag({timeout:c,mode:"exit",style:lg({},a,{transitionTimingFunction:t})});e.style.webkitTransition=Rg("-webkit-transform",n),e.style.transition=Rg("transform",n),Dg(o,e),d&&d(e)},onExited:function(e){e.style.webkitTransition="",e.style.transition="",p&&p(e)},in:s,timeout:c},f),(function(t,n){return(0,e.cloneElement)(r,lg({ref:y,style:lg({visibility:"exited"!==t||s?void 0:"hidden"},a,{},r.props.style)},n))}))}));Og.displayName="Slide";var Ng=function(t){return e.createElement("svg",Object.assign({viewBox:"0 0 24 24",focusable:"false",style:{fontSize:20,marginInlineEnd:8,userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0}},t))},kg=function(){return e.createElement(Ng,null,e.createElement("path",{d:"M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41\n        10.59L10 14.17L17.59 6.58L19 8L10 17Z"}))},Fg=function(){return e.createElement(Ng,null,e.createElement("path",{d:"M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"}))},zg=function(){return e.createElement(Ng,null,e.createElement("path",{d:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,\n        6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,\n        13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"}))},Bg=function(){return e.createElement(Ng,null,e.createElement("path",{d:"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,\n        0 22,12A10,10 0 0,0 12,2Z"}))},Ug={maxSnack:3,persist:!1,hideIconVariant:!1,disableWindowBlurListener:!1,variant:"default",autoHideDuration:5e3,iconVariant:{default:void 0,success:e.createElement(kg,null),warning:e.createElement(Fg,null),error:e.createElement(zg,null),info:e.createElement(Bg,null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},TransitionComponent:Og,transitionDuration:{enter:225,exit:195}};function jg(e){return Object.entries(e).reduce((function(e,t){var n,r=t[0],i=t[1];return lg({},e,((n={})[r]=og(i),n))}),{})}var Vg="notistack-CollapseWrapper",Gg=function(e){return"notistack-MuiContent-"+e},Hg=jg({root:{height:0},entered:{height:"auto"}}),Zg="0px",Wg=(0,e.forwardRef)((function(t,n){var r=t.children,i=t.in,o=t.onExited,s=(0,e.useRef)(null),a=(0,e.useRef)(null),l=Cg(n,a),c=function(){return s.current?s.current.clientHeight:0};return(0,e.createElement)(Mg,{in:i,unmountOnExit:!0,onEnter:function(e){e.style.height=Zg},onEntered:function(e){e.style.height="auto"},onEntering:function(e){var t=c(),n=Ag({timeout:175,mode:"enter"}),r=n.duration,i=n.easing;e.style.transitionDuration="string"==typeof r?r:r+"ms",e.style.height=t+"px",e.style.transitionTimingFunction=i||""},onExit:function(e){e.style.height=c()+"px"},onExited:o,onExiting:function(e){Ig(e);var t=Ag({timeout:175,mode:"exit"}),n=t.duration,r=t.easing;e.style.transitionDuration="string"==typeof n?n:n+"ms",e.style.height=Zg,e.style.transitionTimingFunction=r||""},nodeRef:a,timeout:175},(function(t,n){return(0,e.createElement)("div",Object.assign({ref:l,className:qm(Hg.root,"entered"===t&&Hg.entered),style:lg({pointerEvents:"all",overflow:"hidden",minHeight:Zg,transition:Rg("height")},"entered"===t&&{overflow:"visible"},{},"exited"===t&&!i&&{visibility:"hidden"})},n),(0,e.createElement)("div",{ref:s,className:Vg,style:{display:"flex",width:"100%"}},r))}))}));Wg.displayName="Collapse";var $g={right:"left",left:"right",bottom:"up",top:"down"},qg=function(e){return"anchorOrigin"+yg(e)},Xg=function(){};function Yg(e,t){return e.reduce((function(e,n){return null==n?e:function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=[].concat(i);t&&-1===s.indexOf(t)&&s.push(t),e.apply(this,s),n.apply(this,s)}}),Xg)}var Kg="undefined"!=typeof window?e.useLayoutEffect:e.useEffect;function Jg(t){var n=(0,e.useRef)(t);return Kg((function(){n.current=t})),(0,e.useCallback)((function(){return n.current.apply(void 0,arguments)}),[])}var Qg,ey=(0,e.forwardRef)((function(t,n){var r=t.children,i=t.className,o=t.autoHideDuration,s=t.disableWindowBlurListener,a=void 0!==s&&s,l=t.onClose,c=t.id,u=t.open,h=t.SnackbarProps,d=void 0===h?{}:h,p=(0,e.useRef)(),f=Jg((function(){l&&l.apply(void 0,arguments)})),m=Jg((function(e){l&&null!=e&&(p.current&&clearTimeout(p.current),p.current=setTimeout((function(){f(null,"timeout",c)}),e))}));(0,e.useEffect)((function(){return u&&m(o),function(){p.current&&clearTimeout(p.current)}}),[u,o,m]);var g=function(){p.current&&clearTimeout(p.current)},y=(0,e.useCallback)((function(){null!=o&&m(.5*o)}),[o,m]);return(0,e.useEffect)((function(){if(!a&&u)return window.addEventListener("focus",y),window.addEventListener("blur",g),function(){window.removeEventListener("focus",y),window.removeEventListener("blur",g)}}),[a,y,u]),(0,e.createElement)("div",Object.assign({ref:n},d,{className:qm("notistack-Snackbar",i),onMouseEnter:function(e){d.onMouseEnter&&d.onMouseEnter(e),g()},onMouseLeave:function(e){d.onMouseLeave&&d.onMouseLeave(e),y()}}),r)}));ey.displayName="Snackbar";var ty=jg({root:(Qg={display:"flex",flexWrap:"wrap",flexGrow:1},Qg[mg]={flexGrow:"initial",minWidth:"288px"},Qg)}),ny=(0,e.forwardRef)((function(t,n){var r=t.className,i=ug(t,["className"]);return e.createElement("div",Object.assign({ref:n,className:qm(ty.root,r)},i))}));ny.displayName="SnackbarContent";var ry=jg({root:{backgroundColor:"#313131",fontSize:"0.875rem",lineHeight:1.43,letterSpacing:"0.01071em",color:"#fff",alignItems:"center",padding:"6px 16px",borderRadius:"4px",boxShadow:"0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12)"},lessPadding:{paddingLeft:"20px"},default:{backgroundColor:"#313131"},success:{backgroundColor:"#43a047"},error:{backgroundColor:"#d32f2f"},warning:{backgroundColor:"#ff9800"},info:{backgroundColor:"#2196f3"},message:{display:"flex",alignItems:"center",padding:"8px 0"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:"16px",marginRight:"-8px"}}),iy="notistack-snackbar",oy=(0,e.forwardRef)((function(t,n){var r=t.id,i=t.message,o=t.action,s=t.iconVariant,a=t.variant,l=t.hideIconVariant,c=t.style,u=t.className,h=s[a],d=o;return"function"==typeof d&&(d=d(r)),e.createElement(ny,{ref:n,role:"alert","aria-describedby":iy,style:c,className:qm("notistack-MuiContent",Gg(a),ry.root,ry[a],u,!l&&h&&ry.lessPadding)},e.createElement("div",{id:iy,className:ry.message},l?null:h,i),d&&e.createElement("div",{className:ry.action},d))}));oy.displayName="MaterialDesignContent";var sy,ay,ly,cy,uy,hy,dy=(0,e.memo)(oy),py=jg({wrappedRoot:{width:"100%",position:"relative",transform:"translateX(0)",top:0,right:0,bottom:0,left:0,minWidth:"288px"}}),fy=function(t){var n=(0,e.useRef)(),r=(0,e.useState)(!0),i=r[0],o=r[1],s=Yg([t.snack.onClose,t.onClose]),a=(0,e.useCallback)((function(){n.current=setTimeout((function(){o((function(e){return!e}))}),125)}),[]);(0,e.useEffect)((function(){return function(){n.current&&clearTimeout(n.current)}}),[]);var l,c=t.snack,u=t.classes,h=t.Component,d=void 0===h?dy:h,p=(0,e.useMemo)((function(){return function(e){void 0===e&&(e={});var t={containerRoot:!0,containerAnchorOriginTopCenter:!0,containerAnchorOriginBottomCenter:!0,containerAnchorOriginTopRight:!0,containerAnchorOriginBottomRight:!0,containerAnchorOriginTopLeft:!0,containerAnchorOriginBottomLeft:!0};return Object.keys(e).filter((function(e){return!t[e]})).reduce((function(t,n){var r;return lg({},t,((r={})[n]=e[n],r))}),{})}(u)}),[u]),f=c.open,m=c.SnackbarProps,g=c.TransitionComponent,y=c.TransitionProps,v=c.transitionDuration,_=c.disableWindowBlurListener,x=c.content,b=ug(c,["open","SnackbarProps","TransitionComponent","TransitionProps","transitionDuration","disableWindowBlurListener","content","entered","requestClose","onEnter","onEntered","onExit","onExited"]),w=lg({direction:(l=b.anchorOrigin,"center"!==l.horizontal?$g[l.horizontal]:$g[l.vertical]),timeout:v},y),S=x;"function"==typeof S&&(S=S(b.id,b.message));var M=["onEnter","onEntered","onExit","onExited"].reduce((function(e,n){var r;return lg({},e,((r={})[n]=Yg([t.snack[n],t[n]],b.id),r))}),{});return e.createElement(Wg,{in:i,onExited:M.onExited},e.createElement(ey,{open:f,id:b.id,disableWindowBlurListener:_,autoHideDuration:b.autoHideDuration,className:qm(py.wrappedRoot,p.root,p[qg(b.anchorOrigin)]),SnackbarProps:m,onClose:s},e.createElement(g,Object.assign({},w,{appear:!0,in:f,onExit:M.onExit,onExited:a,onEnter:M.onEnter,onEntered:Yg([M.onEntered,function(){t.snack.requestClose&&s(null,"instructed",t.snack.id)}],b.id)}),S||e.createElement(d,Object.assign({},b)))))},my=20,gy=6,yy=2,vy="."+Vg,_y=jg({root:(sy={boxSizing:"border-box",display:"flex",maxHeight:"100%",position:"fixed",zIndex:1400,height:"auto",width:"auto",transition:Rg(["top","right","bottom","left","max-width"],{duration:300,easing:"ease"}),pointerEvents:"none"},sy[vy]={padding:gy+"px 0px",transition:"padding 300ms ease 0ms"},sy.maxWidth="calc(100% - "+2*my+"px)",sy[fg]={width:"100%",maxWidth:"calc(100% - 32px)"},sy),rootDense:(ay={},ay[vy]={padding:yy+"px 0px"},ay),top:{top:my-gy+"px",flexDirection:"column"},bottom:{bottom:my-gy+"px",flexDirection:"column-reverse"},left:(ly={left:my+"px"},ly[mg]={alignItems:"flex-start"},ly[fg]={left:"16px"},ly),right:(cy={right:my+"px"},cy[mg]={alignItems:"flex-end"},cy[fg]={right:"16px"},cy),center:(uy={left:"50%",transform:"translateX(-50%)"},uy[mg]={alignItems:"center"},uy)}),xy=function(t){var n=t.classes,r=void 0===n?{}:n,i=t.anchorOrigin,o=t.dense,s=t.children,a=qm("notistack-SnackbarContainer",_y[i.vertical],_y[i.horizontal],_y.root,r.containerRoot,r["containerAnchorOrigin"+yg(i)],o&&_y.rootDense);return e.createElement("div",{className:a},s)},by=(0,e.memo)(xy),wy=function(t){return!("string"==typeof t||(0,e.isValidElement)(t))},Sy=function(t){function n(e){var n;return(n=t.call(this,e)||this).enqueueSnackbar=function(e,t){if(void 0===t&&(t={}),null==e)throw new Error("enqueueSnackbar called with invalid argument");var r=wy(e)?e:t,i=wy(e)?e.message:e,o=r.key,s=r.preventDuplicate,a=ug(r,["key","preventDuplicate"]),l=vg(o),c=l?o:(new Date).getTime()+Math.random(),u=function(e,t){return function(n,r){return void 0===r&&(r=!1),r?lg({},Ug[n],{},t[n],{},e[n]):"autoHideDuration"===n?(i=e.autoHideDuration,o=t.autoHideDuration,(s=function(e){return"number"==typeof e||null===e})(i)?i:s(o)?o:Ug.autoHideDuration):"transitionDuration"===n?function(e,t){var n=function(e,t){return t.some((function(t){return typeof e===t}))};return n(e,["string","number"])?e:n(e,["object"])?lg({},Ug.transitionDuration,{},n(t,["object"])&&t,{},e):n(t,["string","number"])?t:n(t,["object"])?lg({},Ug.transitionDuration,{},t):Ug.transitionDuration}(e.transitionDuration,t.transitionDuration):e[n]||t[n]||Ug[n];var i,o,s}}(a,n.props),h=lg({id:c},a,{message:i,open:!0,entered:!1,requestClose:!1,persist:u("persist"),action:u("action"),content:u("content"),variant:u("variant"),anchorOrigin:u("anchorOrigin"),disableWindowBlurListener:u("disableWindowBlurListener"),autoHideDuration:u("autoHideDuration"),hideIconVariant:u("hideIconVariant"),TransitionComponent:u("TransitionComponent"),transitionDuration:u("transitionDuration"),TransitionProps:u("TransitionProps",!0),iconVariant:u("iconVariant",!0),style:u("style",!0),SnackbarProps:u("SnackbarProps",!0),className:qm(n.props.className,a.className)});return h.persist&&(h.autoHideDuration=void 0),n.setState((function(e){if(void 0===s&&n.props.preventDuplicate||s){var t=function(e){return l?e.id===c:e.message===i},r=e.queue.findIndex(t)>-1,o=e.snacks.findIndex(t)>-1;if(r||o)return e}return n.handleDisplaySnack(lg({},e,{queue:[].concat(e.queue,[h])}))})),c},n.handleDisplaySnack=function(e){return e.snacks.length>=n.maxSnack?n.handleDismissOldest(e):n.processQueue(e)},n.processQueue=function(e){var t=e.queue,n=e.snacks;return t.length>0?lg({},e,{snacks:[].concat(n,[t[0]]),queue:t.slice(1,t.length)}):e},n.handleDismissOldest=function(e){if(e.snacks.some((function(e){return!e.open||e.requestClose})))return e;var t=!1,r=!1,i=e.snacks.reduce((function(e,t){return e+(t.open&&t.persist?1:0)}),0);i===n.maxSnack&&(r=!0);var o=e.snacks.map((function(e){return t||e.persist&&!r?lg({},e):(t=!0,e.entered?(e.onClose&&e.onClose(null,"maxsnack",e.id),n.props.onClose&&n.props.onClose(null,"maxsnack",e.id),lg({},e,{open:!1})):lg({},e,{requestClose:!0}))}));return lg({},e,{snacks:o})},n.handleEnteredSnack=function(e,t,r){if(!vg(r))throw new Error("handleEnteredSnack Cannot be called with undefined key");n.setState((function(e){return{snacks:e.snacks.map((function(e){return e.id===r?lg({},e,{entered:!0}):lg({},e)}))}}))},n.handleCloseSnack=function(e,t,r){n.props.onClose&&n.props.onClose(e,t,r);var i=void 0===r;n.setState((function(e){var t=e.snacks,n=e.queue;return{snacks:t.map((function(e){return i||e.id===r?e.entered?lg({},e,{open:!1}):lg({},e,{requestClose:!0}):lg({},e)})),queue:n.filter((function(e){return e.id!==r}))}}))},n.closeSnackbar=function(e){var t=n.state.snacks.find((function(t){return t.id===e}));vg(e)&&t&&t.onClose&&t.onClose(null,"instructed",e),n.handleCloseSnack(null,"instructed",e)},n.handleExitedSnack=function(e,t){if(!vg(t))throw new Error("handleExitedSnack Cannot be called with undefined key");n.setState((function(e){var r=n.processQueue(lg({},e,{snacks:e.snacks.filter((function(e){return e.id!==t}))}));return 0===r.queue.length?r:n.handleDismissOldest(r)}))},hy=n.enqueueSnackbar,n.closeSnackbar,n.state={snacks:[],queue:[],contextValue:{enqueueSnackbar:n.enqueueSnackbar.bind(hg(n)),closeSnackbar:n.closeSnackbar.bind(hg(n))}},n}return cg(n,t),n.prototype.render=function(){var t=this,n=this.state.contextValue,r=this.props,i=r.domRoot,o=r.children,s=r.dense,a=void 0!==s&&s,l=r.Components,c=void 0===l?{}:l,u=r.classes,h=this.state.snacks.reduce((function(e,t){var n,r=yg(t.anchorOrigin),i=e[r]||[];return lg({},e,((n={})[r]=[].concat(i,[t]),n))}),{}),d=Object.keys(h).map((function(n){var r=h[n],i=r[0];return e.createElement(by,{key:n,dense:a,anchorOrigin:i.anchorOrigin,classes:u},r.map((function(n){return e.createElement(fy,{key:n.id,snack:n,classes:u,Component:c[n.variant],onClose:t.handleCloseSnack,onEnter:t.props.onEnter,onExit:t.props.onExit,onExited:Yg([t.handleExitedSnack,t.props.onExited],n.id),onEntered:Yg([t.handleEnteredSnack,t.props.onEntered],n.id)})})))}));return e.createElement(pg.Provider,{value:n},o,i?(0,Wm.createPortal)(d,i):d)},ag(n,[{key:"maxSnack",get:function(){return this.props.maxSnack||Ug.maxSnack}}]),n}(e.Component),My=i(3366),Ey=i(4146),Ty=i(649),Cy=i(8007),Ay=i(2755),Iy=i(7592),Py=i(3727),Ry=i(7342),Ly=i(6983),Dy=i(3236),Oy=i(6336);function Ny(e,t){return Ny=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ny(e,t)}function ky(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ny(e,t)}const Fy=e.createContext(null);function zy(t,n){var r=Object.create(null);return t&&e.Children.map(t,(function(e){return e})).forEach((function(t){r[t.key]=function(t){return n&&(0,e.isValidElement)(t)?n(t):t}(t)})),r}function By(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Uy(t,n,r){var i=zy(t.children),o=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),o=[];for(var s in e)s in t?o.length&&(i[s]=o,o=[]):o.push(s);var a={};for(var l in t){if(i[l])for(r=0;r<i[l].length;r++){var c=i[l][r];a[i[l][r]]=n(c)}a[l]=n(l)}for(r=0;r<o.length;r++)a[o[r]]=n(o[r]);return a}(n,i);return Object.keys(o).forEach((function(s){var a=o[s];if((0,e.isValidElement)(a)){var l=s in n,c=s in i,u=n[s],h=(0,e.isValidElement)(u)&&!u.props.in;!c||l&&!h?c||!l||h?c&&l&&(0,e.isValidElement)(u)&&(o[s]=(0,e.cloneElement)(a,{onExited:r.bind(null,a),in:u.props.in,exit:By(a,"exit",t),enter:By(a,"enter",t)})):o[s]=(0,e.cloneElement)(a,{in:!1}):o[s]=(0,e.cloneElement)(a,{onExited:r.bind(null,a),in:!0,exit:By(a,"exit",t),enter:By(a,"enter",t)})}})),o}var jy=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Vy=function(t){function n(e,n){var r,i=(r=t.call(this,e,n)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}ky(n,t);var r=n.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(t,n){var r,i,o=n.children,s=n.handleExited;return{children:n.firstRender?(r=t,i=s,zy(r.children,(function(t){return(0,e.cloneElement)(t,{onExited:i.bind(null,t),in:!0,appear:By(t,"appear",r),enter:By(t,"enter",r),exit:By(t,"exit",r)})}))):Uy(t,o,s),firstRender:!1}},r.handleExited=function(e,t){var n=zy(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,_n.Z)({},t.children);return delete n[e.key],{children:n}})))},r.render=function(){var t=this.props,n=t.component,r=t.childFactory,i=(0,My.Z)(t,["component","childFactory"]),o=this.state.contextValue,s=jy(this.state.children).map(r);return delete i.appear,delete i.enter,delete i.exit,null===n?e.createElement(Fy.Provider,{value:o},s):e.createElement(Fy.Provider,{value:o},e.createElement(n,i,s))},n}(e.Component);Vy.propTypes={},Vy.defaultProps={component:"div",childFactory:function(e){return e}};const Gy=Vy;var Hy=i(686),Zy=i(6383),Wy=i(6417);var $y=i(4363);const qy=(0,$y.Z)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Xy=["center","classes","className"];let Yy,Ky,Jy,Qy,ev=e=>e;const tv=(0,Hy.F4)(Yy||(Yy=ev`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),nv=(0,Hy.F4)(Ky||(Ky=ev`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),rv=(0,Hy.F4)(Jy||(Jy=ev`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),iv=(0,Iy.ZP)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),ov=(0,Iy.ZP)((function(t){const{className:n,classes:r,pulsate:i=!1,rippleX:o,rippleY:s,rippleSize:a,in:l,onExited:c,timeout:u}=t,[h,d]=e.useState(!1),p=(0,Ey.Z)(n,r.ripple,r.rippleVisible,i&&r.ripplePulsate),f={width:a,height:a,top:-a/2+s,left:-a/2+o},m=(0,Ey.Z)(r.child,h&&r.childLeaving,i&&r.childPulsate);return l||h||d(!0),e.useEffect((()=>{if(!l&&null!=c){const e=setTimeout(c,u);return()=>{clearTimeout(e)}}}),[c,l,u]),(0,Wy.jsx)("span",{className:p,style:f,children:(0,Wy.jsx)("span",{className:m})})}),{name:"MuiTouchRipple",slot:"Ripple"})(Qy||(Qy=ev`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),qy.rippleVisible,tv,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),qy.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),qy.child,qy.childLeaving,nv,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),qy.childPulsate,rv,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),sv=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiTouchRipple"}),{center:i=!1,classes:o={},className:s}=r,a=(0,My.Z)(r,Xy),[l,c]=e.useState([]),u=e.useRef(0),h=e.useRef(null);e.useEffect((()=>{h.current&&(h.current(),h.current=null)}),[l]);const d=e.useRef(!1),p=(0,Zy.Z)(),f=e.useRef(null),m=e.useRef(null),g=e.useCallback((e=>{const{pulsate:t,rippleX:n,rippleY:r,rippleSize:i,cb:s}=e;c((e=>[...e,(0,Wy.jsx)(ov,{classes:{ripple:(0,Ey.Z)(o.ripple,qy.ripple),rippleVisible:(0,Ey.Z)(o.rippleVisible,qy.rippleVisible),ripplePulsate:(0,Ey.Z)(o.ripplePulsate,qy.ripplePulsate),child:(0,Ey.Z)(o.child,qy.child),childLeaving:(0,Ey.Z)(o.childLeaving,qy.childLeaving),childPulsate:(0,Ey.Z)(o.childPulsate,qy.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i},u.current)])),u.current+=1,h.current=s}),[o]),y=e.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:r=!1,center:o=i||t.pulsate,fakeElement:s=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&d.current)return void(d.current=!1);"touchstart"===(null==e?void 0:e.type)&&(d.current=!0);const a=s?null:m.current,l=a?a.getBoundingClientRect():{width:0,height:0,left:0,top:0};let c,u,h;if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)c=Math.round(l.width/2),u=Math.round(l.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;c=Math.round(t-l.left),u=Math.round(n-l.top)}if(o)h=Math.sqrt((2*l.width**2+l.height**2)/3),h%2==0&&(h+=1);else{const e=2*Math.max(Math.abs((a?a.clientWidth:0)-c),c)+2,t=2*Math.max(Math.abs((a?a.clientHeight:0)-u),u)+2;h=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===f.current&&(f.current=()=>{g({pulsate:r,rippleX:c,rippleY:u,rippleSize:h,cb:n})},p.start(80,(()=>{f.current&&(f.current(),f.current=null)}))):g({pulsate:r,rippleX:c,rippleY:u,rippleSize:h,cb:n})}),[i,g,p]),v=e.useCallback((()=>{y({},{pulsate:!0})}),[y]),_=e.useCallback(((e,t)=>{if(p.clear(),"touchend"===(null==e?void 0:e.type)&&f.current)return f.current(),f.current=null,void p.start(0,(()=>{_(e,t)}));f.current=null,c((e=>e.length>0?e.slice(1):e)),h.current=t}),[p]);return e.useImperativeHandle(n,(()=>({pulsate:v,start:y,stop:_})),[v,y,_]),(0,Wy.jsx)(iv,(0,_n.Z)({className:(0,Ey.Z)(qy.root,o.root,s),ref:m},a,{children:(0,Wy.jsx)(Gy,{component:null,exit:!0,children:l})}))})),av=sv;var lv=i(1167);function cv(e){return(0,lv.ZP)("MuiButtonBase",e)}const uv=(0,$y.Z)("MuiButtonBase",["root","disabled","focusVisible"]),hv=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],dv=(0,Iy.ZP)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${uv.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),pv=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiButtonBase"}),{action:i,centerRipple:o=!1,children:s,className:a,component:l="button",disabled:c=!1,disableRipple:u=!1,disableTouchRipple:h=!1,focusRipple:d=!1,LinkComponent:p="a",onBlur:f,onClick:m,onContextMenu:g,onDragLeave:y,onFocus:v,onFocusVisible:_,onKeyDown:x,onKeyUp:b,onMouseDown:w,onMouseLeave:S,onMouseUp:M,onTouchEnd:E,onTouchMove:T,onTouchStart:C,tabIndex:A=0,TouchRippleProps:I,touchRippleRef:P,type:R}=r,L=(0,My.Z)(r,hv),D=e.useRef(null),O=e.useRef(null),N=(0,Ly.Z)(O,P),{isFocusVisibleRef:k,onFocus:F,onBlur:z,ref:B}=(0,Oy.Z)(),[U,j]=e.useState(!1);c&&U&&j(!1),e.useImperativeHandle(i,(()=>({focusVisible:()=>{j(!0),D.current.focus()}})),[]);const[V,G]=e.useState(!1);e.useEffect((()=>{G(!0)}),[]);const H=V&&!u&&!c;function Z(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;return(0,Dy.Z)((r=>(t&&t(r),!n&&O.current&&O.current[e](r),!0)))}e.useEffect((()=>{U&&d&&!u&&V&&O.current.pulsate()}),[u,d,U,V]);const W=Z("start",w),$=Z("stop",g),q=Z("stop",y),X=Z("stop",M),Y=Z("stop",(e=>{U&&e.preventDefault(),S&&S(e)})),K=Z("start",C),J=Z("stop",E),Q=Z("stop",T),ee=Z("stop",(e=>{z(e),!1===k.current&&j(!1),f&&f(e)}),!1),te=(0,Dy.Z)((e=>{D.current||(D.current=e.currentTarget),F(e),!0===k.current&&(j(!0),_&&_(e)),v&&v(e)})),ne=()=>{const e=D.current;return l&&"button"!==l&&!("A"===e.tagName&&e.href)},re=e.useRef(!1),ie=(0,Dy.Z)((e=>{d&&!re.current&&U&&O.current&&" "===e.key&&(re.current=!0,O.current.stop(e,(()=>{O.current.start(e)}))),e.target===e.currentTarget&&ne()&&" "===e.key&&e.preventDefault(),x&&x(e),e.target===e.currentTarget&&ne()&&"Enter"===e.key&&!c&&(e.preventDefault(),m&&m(e))})),oe=(0,Dy.Z)((e=>{d&&" "===e.key&&O.current&&U&&!e.defaultPrevented&&(re.current=!1,O.current.stop(e,(()=>{O.current.pulsate(e)}))),b&&b(e),m&&e.target===e.currentTarget&&ne()&&" "===e.key&&!e.defaultPrevented&&m(e)}));let se=l;"button"===se&&(L.href||L.to)&&(se=p);const ae={};"button"===se?(ae.type=void 0===R?"button":R,ae.disabled=c):(L.href||L.to||(ae.role="button"),c&&(ae["aria-disabled"]=c));const le=(0,Ly.Z)(n,B,D),ce=(0,_n.Z)({},r,{centerRipple:o,component:l,disabled:c,disableRipple:u,disableTouchRipple:h,focusRipple:d,tabIndex:A,focusVisible:U}),ue=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:r,classes:i}=e,o={root:["root",t&&"disabled",n&&"focusVisible"]},s=(0,Cy.Z)(o,cv,i);return n&&r&&(s.root+=` ${r}`),s})(ce);return(0,Wy.jsxs)(dv,(0,_n.Z)({as:se,className:(0,Ey.Z)(ue.root,a),ownerState:ce,onBlur:ee,onClick:m,onContextMenu:$,onFocus:te,onKeyDown:ie,onKeyUp:oe,onMouseDown:W,onMouseLeave:Y,onMouseUp:X,onDragLeave:q,onTouchEnd:J,onTouchMove:Q,onTouchStart:K,ref:le,tabIndex:c?-1:A,type:R},ae,L,{children:[s,H?(0,Wy.jsx)(av,(0,_n.Z)({ref:N,center:o},I)):null]}))})),fv=pv;var mv=i(1615);function gv(e){return(0,lv.ZP)("MuiButton",e)}const yv=(0,$y.Z)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),vv=e.createContext({}),_v=e.createContext(void 0),xv=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],bv=e=>(0,_n.Z)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),wv=(0,Iy.ZP)(fv,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${(0,mv.Z)(n.color)}`],t[`size${(0,mv.Z)(n.size)}`],t[`${n.variant}Size${(0,mv.Z)(n.size)}`],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:n}=e;var r,i;const o="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],s="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,_n.Z)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,_n.Z)({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===n.variant&&"inherit"!==n.color&&{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===n.variant&&"inherit"!==n.color&&{border:`1px solid ${(t.vars||t).palette[n.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===n.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===n.variant&&"inherit"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}),"&:active":(0,_n.Z)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${yv.focusVisible}`]:(0,_n.Z)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${yv.disabled}`]:(0,_n.Z)({color:(t.vars||t).palette.action.disabled},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"contained"===n.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===n.variant&&{padding:"6px 8px"},"text"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main},"outlined"===n.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[n.color].mainChannel} / 0.5)`:`1px solid ${(0,Ay.Fq)(t.palette[n.color].main,.5)}`},"contained"===n.variant&&{color:t.vars?t.vars.palette.text.primary:null==(r=(i=t.palette).getContrastText)?void 0:r.call(i,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:o,boxShadow:(t.vars||t).shadows[2]},"contained"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main},"inherit"===n.color&&{color:"inherit",borderColor:"currentColor"},"small"===n.size&&"text"===n.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"text"===n.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"outlined"===n.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"outlined"===n.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"contained"===n.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"contained"===n.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${yv.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${yv.disabled}`]:{boxShadow:"none"}}})),Sv=(0,Iy.ZP)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,t[`iconSize${(0,mv.Z)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},bv(t))})),Mv=(0,Iy.ZP)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,t[`iconSize${(0,mv.Z)(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},bv(t))})),Ev=e.forwardRef((function(t,n){const r=e.useContext(vv),i=e.useContext(_v),o=(0,Ty.Z)(r,t),s=(0,Ry.Z)({props:o,name:"MuiButton"}),{children:a,color:l="primary",component:c="button",className:u,disabled:h=!1,disableElevation:d=!1,disableFocusRipple:p=!1,endIcon:f,focusVisibleClassName:m,fullWidth:g=!1,size:y="medium",startIcon:v,type:_,variant:x="text"}=s,b=(0,My.Z)(s,xv),w=(0,_n.Z)({},s,{color:l,component:c,disabled:h,disableElevation:d,disableFocusRipple:p,fullWidth:g,size:y,type:_,variant:x}),S=(e=>{const{color:t,disableElevation:n,fullWidth:r,size:i,variant:o,classes:s}=e,a={root:["root",o,`${o}${(0,mv.Z)(t)}`,`size${(0,mv.Z)(i)}`,`${o}Size${(0,mv.Z)(i)}`,`color${(0,mv.Z)(t)}`,n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${(0,mv.Z)(i)}`],endIcon:["icon","endIcon",`iconSize${(0,mv.Z)(i)}`]},l=(0,Cy.Z)(a,gv,s);return(0,_n.Z)({},s,l)})(w),M=v&&(0,Wy.jsx)(Sv,{className:S.startIcon,ownerState:w,children:v}),E=f&&(0,Wy.jsx)(Mv,{className:S.endIcon,ownerState:w,children:f}),T=i||"";return(0,Wy.jsxs)(wv,(0,_n.Z)({ownerState:w,className:(0,Ey.Z)(r.className,S.root,u,T),component:c,disabled:h,focusRipple:!p,focusVisibleClassName:(0,Ey.Z)(S.focusVisible,m),ref:n,type:_},b,{classes:S,children:[M,a,E]}))})),Tv=Ev;var Cv=i(8557),Av=i(4290),Iv=i(4976);function Pv(t,n,r,i,o){const[s,a]=e.useState((()=>o&&r?r(t).matches:i?i(t).matches:n));return(0,Cv.Z)((()=>{let e=!0;if(!r)return;const n=r(t),i=()=>{e&&a(n.matches)};return i(),n.addListener(i),()=>{e=!1,n.removeListener(i)}}),[t,r]),s}const Rv=t.useSyncExternalStore;function Lv(t,n,r,i,o){const s=e.useCallback((()=>n),[n]),a=e.useMemo((()=>{if(o&&r)return()=>r(t).matches;if(null!==i){const{matches:e}=i(t);return()=>e}return s}),[s,t,i,o,r]),[l,c]=e.useMemo((()=>{if(null===r)return[s,()=>()=>{}];const e=r(t);return[()=>e.matches,t=>(e.addListener(t),()=>{e.removeListener(t)})]}),[s,r,t]);return Rv(c,l,a)}function Dv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,Iv.Z)(),r="undefined"!=typeof window&&void 0!==window.matchMedia,{defaultMatches:i=!1,matchMedia:o=(r?window.matchMedia:null),ssrMatchMedia:s=null,noSsr:a=!1}=(0,Av.Z)({name:"MuiUseMediaQuery",props:t,theme:n});let l="function"==typeof e?e(n):e;return l=l.replace(/^@media( ?)/m,""),(void 0!==Rv?Lv:Pv)(l,i,o,s,a)}var Ov=i(5192),Nv=i.n(Ov);function kv(e,t,n){return"function"==typeof e?e(t,n):e}const Fv=Nv().oneOfType([Nv().func,Nv().object]);function zv(e){return(0,lv.ZP)("MuiDivider",e)}const Bv=(0,$y.Z)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Uv=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],jv=(0,Iy.ZP)("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.absolute&&t.absolute,t[n.variant],n.light&&t.light,"vertical"===n.orientation&&t.vertical,n.flexItem&&t.flexItem,n.children&&t.withChildren,n.children&&"vertical"===n.orientation&&t.withChildrenVertical,"right"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignRight,"left"===n.textAlign&&"vertical"!==n.orientation&&t.textAlignLeft]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin"},n.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},n.light&&{borderColor:t.vars?`rgba(${t.vars.palette.dividerChannel} / 0.08)`:(0,Ay.Fq)(t.palette.divider,.08)},"inset"===n.variant&&{marginLeft:72},"middle"===n.variant&&"horizontal"===n.orientation&&{marginLeft:t.spacing(2),marginRight:t.spacing(2)},"middle"===n.variant&&"vertical"===n.orientation&&{marginTop:t.spacing(1),marginBottom:t.spacing(1)},"vertical"===n.orientation&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},n.flexItem&&{alignSelf:"stretch",height:"auto"})}),(e=>{let{ownerState:t}=e;return(0,_n.Z)({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{content:'""',alignSelf:"center"}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},n.children&&"vertical"!==n.orientation&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},n.children&&"vertical"===n.orientation&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`}})}),(e=>{let{ownerState:t}=e;return(0,_n.Z)({},"right"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},"left"===t.textAlign&&"vertical"!==t.orientation&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})})),Vv=(0,Iy.ZP)("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.wrapper,"vertical"===n.orientation&&t.wrapperVertical]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`},"vertical"===n.orientation&&{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`})})),Gv=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiDivider"}),{absolute:r=!1,children:i,className:o,component:s=(i?"div":"hr"),flexItem:a=!1,light:l=!1,orientation:c="horizontal",role:u=("hr"!==s?"separator":void 0),textAlign:h="center",variant:d="fullWidth"}=n,p=(0,My.Z)(n,Uv),f=(0,_n.Z)({},n,{absolute:r,component:s,flexItem:a,light:l,orientation:c,role:u,textAlign:h,variant:d}),m=(e=>{const{absolute:t,children:n,classes:r,flexItem:i,light:o,orientation:s,textAlign:a,variant:l}=e,c={root:["root",t&&"absolute",l,o&&"light","vertical"===s&&"vertical",i&&"flexItem",n&&"withChildren",n&&"vertical"===s&&"withChildrenVertical","right"===a&&"vertical"!==s&&"textAlignRight","left"===a&&"vertical"!==s&&"textAlignLeft"],wrapper:["wrapper","vertical"===s&&"wrapperVertical"]};return(0,Cy.Z)(c,zv,r)})(f);return(0,Wy.jsx)(jv,(0,_n.Z)({as:s,className:(0,Ey.Z)(m.root,o),role:u,ref:t,ownerState:f},p,{children:i?(0,Wy.jsx)(Vv,{className:m.wrapper,ownerState:f,children:i}):null}))}));Gv.muiSkipListHighlight=!0;const Hv=Gv,Zv=(e,t)=>e.length===t.length&&t.every((t=>e.includes(t))),Wv=(e,t,n)=>{let r=t;return r=e.setHours(r,e.getHours(n)),r=e.setMinutes(r,e.getMinutes(n)),r=e.setSeconds(r,e.getSeconds(n)),r},$v=e=>{let{date:t,disableFuture:n,disablePast:r,maxDate:i,minDate:o,isDateDisabled:s,utils:a,timezone:l}=e;const c=Wv(a,a.date(void 0,l),t);r&&a.isBefore(o,c)&&(o=c),n&&a.isAfter(i,c)&&(i=c);let u=t,h=t;for(a.isBefore(t,o)&&(u=o,h=null),a.isAfter(t,i)&&(h&&(h=i),u=null);u||h;){if(u&&a.isAfter(u,i)&&(u=null),h&&a.isBefore(h,o)&&(h=null),u){if(!s(u))return u;u=a.addDays(u,1)}if(h){if(!s(h))return h;h=a.addDays(h,-1)}}return null},qv=(e,t,n)=>null!=t&&e.isValid(t)?t:n,Xv=(e,t)=>{const n=[e.startOfYear(t)];for(;n.length<12;){const t=n[n.length-1];n.push(e.addMonths(t,1))}return n},Yv=(e,t,n)=>"date"===n?e.startOfDay(e.date(void 0,t)):e.date(void 0,t),Kv=(e,t)=>{const n=e.setHours(e.date(),"am"===t?2:14);return e.format(n,"meridiem")},Jv=["year","month","day"],Qv=e=>Jv.includes(e),e_=(e,t,n)=>{let{format:r,views:i}=t;if(null!=r)return r;const o=e.formats;return Zv(i,["year"])?o.year:Zv(i,["month"])?o.month:Zv(i,["day"])?o.dayOfMonth:Zv(i,["month","year"])?`${o.month} ${o.year}`:Zv(i,["day","month"])?`${o.month} ${o.dayOfMonth}`:n?/en/.test(e.getCurrentLocaleCode())?o.normalDateWithWeekday:o.normalDate:o.keyboardDate},t_=(e,t)=>{const n=e.startOfWeek(t);return[0,1,2,3,4,5,6].map((t=>e.addDays(n,t)))},n_=["hours","minutes","seconds"],r_=e=>n_.includes(e),i_=e=>n_.includes(e)||"meridiem"===e,o_=(e,t)=>e?t.getHours(e)>=12?"pm":"am":null,s_=(e,t,n)=>n&&(e>=12?"pm":"am")!==t?"am"===t?e-12:e+12:e,a_=(e,t,n,r)=>{const i=s_(r.getHours(e),t,n);return r.setHours(e,i)},l_=(e,t)=>3600*t.getHours(e)+60*t.getMinutes(e)+t.getSeconds(e),c_=(e,t)=>(n,r)=>e?t.isAfter(n,r):l_(n,t)>l_(r,t),u_=(e,t)=>{let{format:n,views:r,ampm:i}=t;if(null!=n)return n;const o=e.formats;return Zv(r,["hours"])?i?`${o.hours12h} ${o.meridiem}`:o.hours24h:Zv(r,["minutes"])?o.minutes:Zv(r,["seconds"])?o.seconds:Zv(r,["minutes","seconds"])?`${o.minutes}:${o.seconds}`:Zv(r,["hours","minutes","seconds"])?i?`${o.hours12h}:${o.minutes}:${o.seconds} ${o.meridiem}`:`${o.hours24h}:${o.minutes}:${o.seconds}`:i?`${o.hours12h}:${o.minutes} ${o.meridiem}`:`${o.hours24h}:${o.minutes}`},h_={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7},d_=(e,t,n)=>{if(t===h_.year)return e.startOfYear(n);if(t===h_.month)return e.startOfMonth(n);if(t===h_.day)return e.startOfDay(n);let r=n;return t<h_.minutes&&(r=e.setMinutes(r,0)),t<h_.seconds&&(r=e.setSeconds(r,0)),t<h_.milliseconds&&(r=e.setMilliseconds(r,0)),r},p_=(e,t)=>{const n=e.formatTokenMap[t];if(null==n)throw new Error([`MUI X: The token "${t}" is not supported by the Date and Time Pickers.`,"Please try using another token or open an issue on https://github.com/mui/mui-x/issues/new/choose if you think it should be supported."].join("\n"));return"string"==typeof n?{type:n,contentType:"meridiem"===n?"letter":"digit",maxLength:void 0}:{type:n.sectionType,contentType:n.contentType,maxLength:n.maxLength}},f_=(e,t,n)=>{const r=[],i=e.date(void 0,t),o=e.startOfWeek(i),s=e.endOfWeek(i);let a=o;for(;e.isBefore(a,s);)r.push(a),a=e.addDays(a,1);return r.map((t=>e.formatByString(t,n)))},m_=(e,t,n,r)=>{switch(n){case"month":return Xv(e,e.date(void 0,t)).map((t=>e.formatByString(t,r)));case"weekDay":return f_(e,t,r);case"meridiem":{const n=e.date(void 0,t);return[e.startOfDay(n),e.endOfDay(n)].map((t=>e.formatByString(t,r)))}default:return[]}},g_=["0","1","2","3","4","5","6","7","8","9"],y_=(e,t)=>{if("0"===t[0])return e;const n=[];let r="";for(let i=0;i<e.length;i+=1){r+=e[i];const o=t.indexOf(r);o>-1&&(n.push(o.toString()),r="")}return n.join("")},v_=(e,t)=>"0"===t[0]?e:e.split("").map((e=>t[Number(e)])).join(""),__=(e,t)=>{const n=y_(e,t);return!Number.isNaN(Number(n))},x_=(e,t)=>{let n=e;for(n=Number(n).toString();n.length<t;)n=`0${n}`;return n},b_=(e,t,n,r,i)=>{if("day"===i.type&&"digit-with-letter"===i.contentType){const r=e.setDate(n.longestMonth,t);return e.formatByString(r,i.format)}let o=t.toString();return i.hasLeadingZerosInInput&&(o=x_(o,i.maxLength)),v_(o,r)},w_=(e,t,n)=>{let r=e.value||e.placeholder;const i="non-input"===t?e.hasLeadingZerosInFormat:e.hasLeadingZerosInInput;return"non-input"===t&&e.hasLeadingZerosInInput&&!e.hasLeadingZerosInFormat&&(r=Number(y_(r,n)).toString()),["input-rtl","input-ltr"].includes(t)&&"digit"===e.contentType&&!i&&1===r.length&&(r=`${r}`),"input-rtl"===t&&(r=`${r}`),r},S_=(e,t,n,r)=>e.formatByString(e.parse(t,n),r),M_=(e,t,n)=>4===e.formatByString(e.date(void 0,t),n).length,E_=(e,t,n,r,i)=>{if("digit"!==n)return!1;const o=e.date(void 0,t);switch(r){case"year":return M_(e,t,i)?"0001"===e.formatByString(e.setYear(o,1),i):"01"===e.formatByString(e.setYear(o,2001),i);case"month":return e.formatByString(e.startOfYear(o),i).length>1;case"day":return e.formatByString(e.startOfMonth(o),i).length>1;case"weekDay":return e.formatByString(e.startOfWeek(o),i).length>1;case"hours":return e.formatByString(e.setHours(o,1),i).length>1;case"minutes":return e.formatByString(e.setMinutes(o,1),i).length>1;case"seconds":return e.formatByString(e.setSeconds(o,1),i).length>1;default:throw new Error("Invalid section type")}},T_={year:1,month:2,day:3,weekDay:4,hours:5,minutes:6,seconds:7,meridiem:8,empty:9},C_=(e,t,n,r,i,o)=>[...r].sort(((e,t)=>T_[e.type]-T_[t.type])).reduce(((r,i)=>!o||i.modified?((e,t,n,r,i)=>{switch(n.type){case"year":return e.setYear(i,e.getYear(r));case"month":return e.setMonth(i,e.getMonth(r));case"weekDay":{const i=f_(e,t,n.format),o=e.formatByString(r,n.format),s=i.indexOf(o),a=i.indexOf(n.value)-s;return e.addDays(r,a)}case"day":return e.setDate(i,e.getDate(r));case"meridiem":{const t=e.getHours(r)<12,n=e.getHours(i);return t&&n>=12?e.addHours(i,-12):!t&&n<12?e.addHours(i,12):i}case"hours":return e.setHours(i,e.getHours(r));case"minutes":return e.setMinutes(i,e.getMinutes(r));case"seconds":return e.setSeconds(i,e.getSeconds(r));default:return i}})(e,t,i,n,r):r),i),A_=(e,t)=>null==e?null:"all"===e?"all":"string"==typeof e?t.findIndex((t=>t.type===e)):e,I_=(e,t)=>{if(e.value)switch(e.type){case"month":{if("digit"===e.contentType)return t.format(t.setMonth(t.date(),Number(e.value)-1),"month");const n=t.parse(e.value,e.format);return n?t.format(n,"month"):void 0}case"day":return"digit"===e.contentType?t.format(t.setDate(t.startOfYear(t.date()),Number(e.value)),"dayOfMonthFull"):e.value;default:return}},P_=(e,t)=>{if(e.value)switch(e.type){case"weekDay":if("letter"===e.contentType)return;return Number(e.value);case"meridiem":{const n=t.parse(`01:00 ${e.value}`,`${t.formats.hours12h}:${t.formats.minutes} ${e.format}`);return n?t.getHours(n)>=12?1:0:void 0}case"day":return"digit-with-letter"===e.contentType?parseInt(e.value,10):Number(e.value);case"month":{if("digit"===e.contentType)return Number(e.value);const n=t.parse(e.value,e.format);return n?t.getMonth(n)+1:void 0}default:return"letter"!==e.contentType?Number(e.value):void 0}},R_=["value","referenceDate"],L_={emptyValue:null,getTodayValue:Yv,getInitialReferenceValue:e=>{let{value:t,referenceDate:n}=e,r=(0,My.Z)(e,R_);return null!=t&&r.utils.isValid(t)?t:null!=n?n:(e=>{let{props:t,utils:n,granularity:r,timezone:i,getTodayDate:o}=e,s=o?o():d_(n,r,Yv(n,i));null!=t.minDate&&n.isAfterDay(t.minDate,s)&&(s=d_(n,r,t.minDate)),null!=t.maxDate&&n.isBeforeDay(t.maxDate,s)&&(s=d_(n,r,t.maxDate));const a=c_(t.disableIgnoringDatePartForTimeValidation??!1,n);return null!=t.minTime&&a(t.minTime,s)&&(s=d_(n,r,t.disableIgnoringDatePartForTimeValidation?t.minTime:Wv(n,s,t.minTime))),null!=t.maxTime&&a(s,t.maxTime)&&(s=d_(n,r,t.disableIgnoringDatePartForTimeValidation?t.maxTime:Wv(n,s,t.maxTime))),s})(r)},cleanValue:(e,t)=>null!=t&&e.isValid(t)?t:null,areValuesEqual:(e,t,n)=>!e.isValid(t)&&null!=t&&!e.isValid(n)&&null!=n||e.isEqual(t,n),isSameError:(e,t)=>e===t,hasError:e=>null!=e,defaultErrorState:null,getTimezone:(e,t)=>null!=t&&e.isValid(t)?e.getTimezone(t):null,setTimezone:(e,t,n)=>null==n?null:e.setTimezone(n,t)},D_={updateReferenceValue:(e,t,n)=>null!=t&&e.isValid(t)?t:n,getSectionsFromValue:(e,t,n,r)=>!e.isValid(t)&&n?n:r(t),getV7HiddenInputValueFromSections:e=>e.map((e=>`${e.startSeparator}${e.value||e.placeholder}${e.endSeparator}`)).join(""),getV6InputValueFromSections:(e,t,n)=>{const r=e.map((e=>{const r=w_(e,n?"input-rtl":"input-ltr",t);return`${e.startSeparator}${r}${e.endSeparator}`})).join("");return n?`${r}`:r},getActiveDateManager:(e,t)=>({date:t.value,referenceDate:t.referenceValue,getSections:e=>e,getNewValuesFromNewActiveDate:n=>({value:n,referenceValue:null!=n&&e.isValid(n)?n:t.referenceValue})}),parseValueStr:(e,t,n)=>n(e.trim(),t)};var O_=i(994),N_=i(3364),k_=i(3491),F_=i(8990),z_=i(4949),B_=i(2454);const U_=["onChange","maxRows","minRows","style","value"];function j_(e){return parseInt(e,10)||0}const V_={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"},G_=e.forwardRef((function(t,n){const{onChange:r,maxRows:i,minRows:o=1,style:s,value:a}=t,l=(0,My.Z)(t,U_),{current:c}=e.useRef(null!=a),u=e.useRef(null),h=(0,F_.Z)(n,u),d=e.useRef(null),p=e.useCallback((()=>{const e=u.current,n=(0,z_.Z)(e).getComputedStyle(e);if("0px"===n.width)return{outerHeightStyle:0,overflowing:!1};const r=d.current;r.style.width=n.width,r.value=e.value||t.placeholder||"x","\n"===r.value.slice(-1)&&(r.value+=" ");const s=n.boxSizing,a=j_(n.paddingBottom)+j_(n.paddingTop),l=j_(n.borderBottomWidth)+j_(n.borderTopWidth),c=r.scrollHeight;r.value="x";const h=r.scrollHeight;let p=c;return o&&(p=Math.max(Number(o)*h,p)),i&&(p=Math.min(Number(i)*h,p)),p=Math.max(p,h),{outerHeightStyle:p+("border-box"===s?a+l:0),overflowing:Math.abs(p-c)<=1}}),[i,o,t.placeholder]),f=e.useCallback((()=>{const e=p();if(null==(t=e)||0===Object.keys(t).length||0===t.outerHeightStyle&&!t.overflowing)return;var t;const n=u.current;n.style.height=`${e.outerHeightStyle}px`,n.style.overflow=e.overflowing?"hidden":""}),[p]);return(0,Cv.Z)((()=>{const e=()=>{f()};const t=(0,B_.Z)(e),n=u.current,r=(0,z_.Z)(n);let i;return r.addEventListener("resize",t),"undefined"!=typeof ResizeObserver&&(i=new ResizeObserver(e),i.observe(n)),()=>{t.clear(),cancelAnimationFrame(undefined),r.removeEventListener("resize",t),i&&i.disconnect()}}),[p,f]),(0,Cv.Z)((()=>{f()})),(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)("textarea",(0,_n.Z)({value:a,onChange:e=>{c||f(),r&&r(e)},ref:h,rows:o,style:s},l)),(0,Wy.jsx)("textarea",{"aria-hidden":!0,className:t.className,readOnly:!0,ref:d,tabIndex:-1,style:(0,_n.Z)({},V_,s,{paddingTop:0,paddingBottom:0})})]})}));function H_(e){return"string"==typeof e}function Z_(e){let{props:t,states:n,muiFormControl:r}=e;return n.reduce(((e,n)=>(e[n]=t[n],r&&void 0===t[n]&&(e[n]=r[n]),e)),{})}const W_=e.createContext(void 0);function $_(){return e.useContext(W_)}var q_=i(4993),X_=i(5150),Y_=i(6728);const K_=function(e){let{styles:t,themeId:n,defaultTheme:r={}}=e;const i=(0,Y_.Z)(r),o="function"==typeof t?t(n&&i[n]||i):t;return(0,Wy.jsx)(X_.Z,{styles:o})};var J_=i(2248),Q_=i(2951);const ex=function(e){return(0,Wy.jsx)(K_,(0,_n.Z)({},e,{defaultTheme:J_.Z,themeId:Q_.Z}))};function tx(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function nx(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(tx(e.value)&&""!==e.value||t&&tx(e.defaultValue)&&""!==e.defaultValue)}function rx(e){return(0,lv.ZP)("MuiInputBase",e)}const ix=(0,$y.Z)("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),ox=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],sx=(e,t)=>{const{ownerState:n}=e;return[t.root,n.formControl&&t.formControl,n.startAdornment&&t.adornedStart,n.endAdornment&&t.adornedEnd,n.error&&t.error,"small"===n.size&&t.sizeSmall,n.multiline&&t.multiline,n.color&&t[`color${(0,mv.Z)(n.color)}`],n.fullWidth&&t.fullWidth,n.hiddenLabel&&t.hiddenLabel]},ax=(e,t)=>{const{ownerState:n}=e;return[t.input,"small"===n.size&&t.inputSizeSmall,n.multiline&&t.inputMultiline,"search"===n.type&&t.inputTypeSearch,n.startAdornment&&t.inputAdornedStart,n.endAdornment&&t.inputAdornedEnd,n.hiddenLabel&&t.inputHiddenLabel]},lx=(0,Iy.ZP)("div",{name:"MuiInputBase",slot:"Root",overridesResolver:sx})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${ix.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},n.multiline&&(0,_n.Z)({padding:"4px 0 5px"},"small"===n.size&&{paddingTop:1}),n.fullWidth&&{width:"100%"})})),cx=(0,Iy.ZP)("input",{name:"MuiInputBase",slot:"Input",overridesResolver:ax})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode,i=(0,_n.Z)({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),o={opacity:"0 !important"},s=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5};return(0,_n.Z)({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${ix.formControl} &`]:{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&:-ms-input-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},[`&.${ix.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},"small"===n.size&&{paddingTop:1},n.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===n.type&&{MozAppearance:"textfield"})})),ux=(0,Wy.jsx)(ex,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),hx=e.forwardRef((function(t,n){var r;const i=(0,Ry.Z)({props:t,name:"MuiInputBase"}),{"aria-describedby":o,autoComplete:s,autoFocus:a,className:l,components:c={},componentsProps:u={},defaultValue:h,disabled:d,disableInjectingGlobalStyles:p,endAdornment:f,fullWidth:m=!1,id:g,inputComponent:y="input",inputProps:v={},inputRef:_,maxRows:x,minRows:b,multiline:w=!1,name:S,onBlur:M,onChange:E,onClick:T,onFocus:C,onKeyDown:A,onKeyUp:I,placeholder:P,readOnly:R,renderSuffix:L,rows:D,slotProps:O={},slots:N={},startAdornment:k,type:F="text",value:z}=i,B=(0,My.Z)(i,ox),U=null!=v.value?v.value:z,{current:j}=e.useRef(null!=U),V=e.useRef(),G=e.useCallback((e=>{}),[]),H=(0,Ly.Z)(V,_,v.ref,G),[Z,W]=e.useState(!1),$=$_(),q=Z_({props:i,muiFormControl:$,states:["color","disabled","error","hiddenLabel","size","required","filled"]});q.focused=$?$.focused:Z,e.useEffect((()=>{!$&&d&&Z&&(W(!1),M&&M())}),[$,d,Z,M]);const X=$&&$.onFilled,Y=$&&$.onEmpty,K=e.useCallback((e=>{nx(e)?X&&X():Y&&Y()}),[X,Y]);(0,q_.Z)((()=>{j&&K({value:U})}),[U,K,j]),e.useEffect((()=>{K(V.current)}),[]);let J=y,Q=v;w&&"input"===J&&(Q=D?(0,_n.Z)({type:void 0,minRows:D,maxRows:D},Q):(0,_n.Z)({type:void 0,maxRows:x,minRows:b},Q),J=G_),e.useEffect((()=>{$&&$.setAdornedStart(Boolean(k))}),[$,k]);const ee=(0,_n.Z)({},i,{color:q.color||"primary",disabled:q.disabled,endAdornment:f,error:q.error,focused:q.focused,formControl:$,fullWidth:m,hiddenLabel:q.hiddenLabel,multiline:w,size:q.size,startAdornment:k,type:F}),te=(e=>{const{classes:t,color:n,disabled:r,error:i,endAdornment:o,focused:s,formControl:a,fullWidth:l,hiddenLabel:c,multiline:u,readOnly:h,size:d,startAdornment:p,type:f}=e,m={root:["root",`color${(0,mv.Z)(n)}`,r&&"disabled",i&&"error",l&&"fullWidth",s&&"focused",a&&"formControl",d&&"medium"!==d&&`size${(0,mv.Z)(d)}`,u&&"multiline",p&&"adornedStart",o&&"adornedEnd",c&&"hiddenLabel",h&&"readOnly"],input:["input",r&&"disabled","search"===f&&"inputTypeSearch",u&&"inputMultiline","small"===d&&"inputSizeSmall",c&&"inputHiddenLabel",p&&"inputAdornedStart",o&&"inputAdornedEnd",h&&"readOnly"]};return(0,Cy.Z)(m,rx,t)})(ee),ne=N.root||c.Root||lx,re=O.root||u.root||{},ie=N.input||c.Input||cx;return Q=(0,_n.Z)({},Q,null!=(r=O.input)?r:u.input),(0,Wy.jsxs)(e.Fragment,{children:[!p&&ux,(0,Wy.jsxs)(ne,(0,_n.Z)({},re,!H_(ne)&&{ownerState:(0,_n.Z)({},ee,re.ownerState)},{ref:n,onClick:e=>{V.current&&e.currentTarget===e.target&&V.current.focus(),T&&T(e)}},B,{className:(0,Ey.Z)(te.root,re.className,l,R&&"MuiInputBase-readOnly"),children:[k,(0,Wy.jsx)(W_.Provider,{value:null,children:(0,Wy.jsx)(ie,(0,_n.Z)({ownerState:ee,"aria-invalid":q.error,"aria-describedby":o,autoComplete:s,autoFocus:a,defaultValue:h,disabled:q.disabled,id:g,onAnimationStart:e=>{K("mui-auto-fill-cancel"===e.animationName?V.current:{value:"x"})},name:S,placeholder:P,readOnly:R,required:q.required,rows:D,value:U,onKeyDown:A,onKeyUp:I,type:F},Q,!H_(ie)&&{as:J,ownerState:(0,_n.Z)({},ee,Q.ownerState)},{ref:H,className:(0,Ey.Z)(te.input,Q.className,R&&"MuiInputBase-readOnly"),onBlur:e=>{M&&M(e),v.onBlur&&v.onBlur(e),$&&$.onBlur?$.onBlur(e):W(!1)},onChange:function(e){if(!j){const t=e.target||V.current;if(null==t)throw new Error((0,k_.Z)(1));K({value:t.value})}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];v.onChange&&v.onChange(e,...n),E&&E(e,...n)},onFocus:e=>{q.disabled?e.stopPropagation():(C&&C(e),v.onFocus&&v.onFocus(e),$&&$.onFocus?$.onFocus(e):W(!0))}}))}),f,L?L((0,_n.Z)({},q,{startAdornment:k})):null]}))]})})),dx=hx;function px(e){return(0,lv.ZP)("MuiInput",e)}const fx=(0,_n.Z)({},ix,(0,$y.Z)("MuiInput",["root","underline","input"])),mx=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],gx=(0,Iy.ZP)(lx,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...sx(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e,r="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),(0,_n.Z)({position:"relative"},n.formControl&&{"label + &":{marginTop:16}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[n.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${fx.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${fx.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${fx.disabled}, .${fx.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${fx.disabled}:before`]:{borderBottomStyle:"dotted"}})})),yx=(0,Iy.ZP)(cx,{name:"MuiInput",slot:"Input",overridesResolver:ax})({}),vx=e.forwardRef((function(e,t){var n,r,i,o;const s=(0,Ry.Z)({props:e,name:"MuiInput"}),{disableUnderline:a,components:l={},componentsProps:c,fullWidth:u=!1,inputComponent:h="input",multiline:d=!1,slotProps:p,slots:f={},type:m="text"}=s,g=(0,My.Z)(s,mx),y=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,Cy.Z)(r,px,t);return(0,_n.Z)({},t,i)})(s),v={root:{ownerState:{disableUnderline:a}}},_=(null!=p?p:c)?(0,N_.Z)(null!=p?p:c,v):v,x=null!=(n=null!=(r=f.root)?r:l.Root)?n:gx,b=null!=(i=null!=(o=f.input)?o:l.Input)?i:yx;return(0,Wy.jsx)(dx,(0,_n.Z)({slots:{root:x,input:b},slotProps:_,fullWidth:u,inputComponent:h,multiline:d,ref:t,type:m},g,{classes:y}))}));vx.muiName="Input";const _x=vx;function xx(e){return(0,lv.ZP)("MuiFilledInput",e)}const bx=(0,_n.Z)({},ix,(0,$y.Z)("MuiFilledInput",["root","underline","input"])),wx=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],Sx=(0,Iy.ZP)(lx,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[...sx(e,t),!n.disableUnderline&&t.underline]}})((e=>{let{theme:t,ownerState:n}=e;var r;const i="light"===t.palette.mode,o=i?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=i?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",a=i?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",l=i?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return(0,_n.Z)({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:a,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},[`&.${bx.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},[`&.${bx.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:l}},!n.disableUnderline&&{"&::after":{borderBottom:`2px solid ${null==(r=(t.vars||t).palette[n.color||"primary"])?void 0:r.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${bx.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${bx.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:o}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${bx.disabled}, .${bx.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${bx.disabled}:before`]:{borderBottomStyle:"dotted"}},n.startAdornment&&{paddingLeft:12},n.endAdornment&&{paddingRight:12},n.multiline&&(0,_n.Z)({padding:"25px 12px 8px"},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9}))})),Mx=(0,Iy.ZP)(cx,{name:"MuiFilledInput",slot:"Input",overridesResolver:ax})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9},n.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})})),Ex=e.forwardRef((function(e,t){var n,r,i,o;const s=(0,Ry.Z)({props:e,name:"MuiFilledInput"}),{components:a={},componentsProps:l,fullWidth:c=!1,inputComponent:u="input",multiline:h=!1,slotProps:d,slots:p={},type:f="text"}=s,m=(0,My.Z)(s,wx),g=(0,_n.Z)({},s,{fullWidth:c,inputComponent:u,multiline:h,type:f}),y=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,Cy.Z)(r,xx,t);return(0,_n.Z)({},t,i)})(s),v={root:{ownerState:g},input:{ownerState:g}},_=(null!=d?d:l)?(0,N_.Z)(v,null!=d?d:l):v,x=null!=(n=null!=(r=p.root)?r:a.Root)?n:Sx,b=null!=(i=null!=(o=p.input)?o:a.Input)?i:Mx;return(0,Wy.jsx)(dx,(0,_n.Z)({slots:{root:x,input:b},componentsProps:_,fullWidth:c,inputComponent:u,multiline:h,ref:t,type:f},m,{classes:y}))}));Ex.muiName="Input";const Tx=Ex;var Cx;const Ax=["children","classes","className","label","notched"],Ix=(0,Iy.ZP)("fieldset",{shouldForwardProp:Py.Z})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Px=(0,Iy.ZP)("legend",{shouldForwardProp:Py.Z})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})},t.withLabel&&(0,_n.Z)({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}))}));function Rx(e){return(0,lv.ZP)("MuiOutlinedInput",e)}const Lx=(0,_n.Z)({},ix,(0,$y.Z)("MuiOutlinedInput",["root","notchedOutline","input"])),Dx=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],Ox=(0,Iy.ZP)(lx,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiOutlinedInput",slot:"Root",overridesResolver:sx})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return(0,_n.Z)({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${Lx.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${Lx.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:r}},[`&.${Lx.focused} .${Lx.notchedOutline}`]:{borderColor:(t.vars||t).palette[n.color].main,borderWidth:2},[`&.${Lx.error} .${Lx.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${Lx.disabled} .${Lx.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}},n.startAdornment&&{paddingLeft:14},n.endAdornment&&{paddingRight:14},n.multiline&&(0,_n.Z)({padding:"16.5px 14px"},"small"===n.size&&{padding:"8.5px 14px"}))})),Nx=(0,Iy.ZP)((function(e){const{className:t,label:n,notched:r}=e,i=(0,My.Z)(e,Ax),o=null!=n&&""!==n,s=(0,_n.Z)({},e,{notched:r,withLabel:o});return(0,Wy.jsx)(Ix,(0,_n.Z)({"aria-hidden":!0,className:t,ownerState:s},i,{children:(0,Wy.jsx)(Px,{ownerState:s,children:o?(0,Wy.jsx)("span",{children:n}):Cx||(Cx=(0,Wy.jsx)("span",{className:"notranslate",children:""}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}})),kx=(0,Iy.ZP)(cx,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:ax})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},"small"===n.size&&{padding:"8.5px 14px"},n.multiline&&{padding:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0})})),Fx=e.forwardRef((function(t,n){var r,i,o,s,a;const l=(0,Ry.Z)({props:t,name:"MuiOutlinedInput"}),{components:c={},fullWidth:u=!1,inputComponent:h="input",label:d,multiline:p=!1,notched:f,slots:m={},type:g="text"}=l,y=(0,My.Z)(l,Dx),v=(e=>{const{classes:t}=e,n=(0,Cy.Z)({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Rx,t);return(0,_n.Z)({},t,n)})(l),_=$_(),x=Z_({props:l,muiFormControl:_,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),b=(0,_n.Z)({},l,{color:x.color||"primary",disabled:x.disabled,error:x.error,focused:x.focused,formControl:_,fullWidth:u,hiddenLabel:x.hiddenLabel,multiline:p,size:x.size,type:g}),w=null!=(r=null!=(i=m.root)?i:c.Root)?r:Ox,S=null!=(o=null!=(s=m.input)?s:c.Input)?o:kx;return(0,Wy.jsx)(dx,(0,_n.Z)({slots:{root:w,input:S},renderSuffix:t=>(0,Wy.jsx)(Nx,{ownerState:b,className:v.notchedOutline,label:null!=d&&""!==d&&x.required?a||(a=(0,Wy.jsxs)(e.Fragment,{children:[d,"","*"]})):d,notched:void 0!==f?f:Boolean(t.startAdornment||t.filled||t.focused)}),fullWidth:u,inputComponent:h,multiline:p,ref:n,type:g},y,{classes:(0,_n.Z)({},v,{notchedOutline:null})}))}));Fx.muiName="Input";const zx=Fx;function Bx(e){return(0,lv.ZP)("MuiFormLabel",e)}const Ux=(0,$y.Z)("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),jx=["children","className","color","component","disabled","error","filled","focused","required"],Vx=(0,Iy.ZP)("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,_n.Z)({},t.root,"secondary"===n.color&&t.colorSecondary,n.filled&&t.filled)}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${Ux.focused}`]:{color:(t.vars||t).palette[n.color].main},[`&.${Ux.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Ux.error}`]:{color:(t.vars||t).palette.error.main}})})),Gx=(0,Iy.ZP)("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${Ux.error}`]:{color:(t.vars||t).palette.error.main}}})),Hx=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiFormLabel"}),{children:r,className:i,component:o="label"}=n,s=(0,My.Z)(n,jx),a=Z_({props:n,muiFormControl:$_(),states:["color","required","focused","disabled","error","filled"]}),l=(0,_n.Z)({},n,{color:a.color||"primary",component:o,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),c=(e=>{const{classes:t,color:n,focused:r,disabled:i,error:o,filled:s,required:a}=e,l={root:["root",`color${(0,mv.Z)(n)}`,i&&"disabled",o&&"error",s&&"filled",r&&"focused",a&&"required"],asterisk:["asterisk",o&&"error"]};return(0,Cy.Z)(l,Bx,t)})(l);return(0,Wy.jsxs)(Vx,(0,_n.Z)({as:o,ownerState:l,className:(0,Ey.Z)(c.root,i),ref:t},s,{children:[r,a.required&&(0,Wy.jsxs)(Gx,{ownerState:l,"aria-hidden":!0,className:c.asterisk,children:["","*"]})]}))})),Zx=Hx;function Wx(e){return(0,lv.ZP)("MuiInputLabel",e)}(0,$y.Z)("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const $x=["disableAnimation","margin","shrink","variant","className"],qx=(0,Iy.ZP)(Zx,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${Ux.asterisk}`]:t.asterisk},t.root,n.formControl&&t.formControl,"small"===n.size&&t.sizeSmall,n.shrink&&t.shrink,!n.disableAnimation&&t.animated,n.focused&&t.focused,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},n.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===n.size&&{transform:"translate(0, 17px) scale(1)"},n.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!n.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===n.variant&&(0,_n.Z)({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(12px, 13px) scale(1)"},n.shrink&&(0,_n.Z)({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===n.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===n.variant&&(0,_n.Z)({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(14px, 9px) scale(1)"},n.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))})),Xx=e.forwardRef((function(e,t){const n=(0,Ry.Z)({name:"MuiInputLabel",props:e}),{disableAnimation:r=!1,shrink:i,className:o}=n,s=(0,My.Z)(n,$x),a=$_();let l=i;void 0===l&&a&&(l=a.filled||a.focused||a.adornedStart);const c=Z_({props:n,muiFormControl:a,states:["size","variant","required","focused"]}),u=(0,_n.Z)({},n,{disableAnimation:r,formControl:a,shrink:l,size:c.size,variant:c.variant,required:c.required,focused:c.focused}),h=(e=>{const{classes:t,formControl:n,size:r,shrink:i,disableAnimation:o,variant:s,required:a}=e,l={root:["root",n&&"formControl",!o&&"animated",i&&"shrink",r&&"normal"!==r&&`size${(0,mv.Z)(r)}`,s],asterisk:[a&&"asterisk"]},c=(0,Cy.Z)(l,Wx,t);return(0,_n.Z)({},t,c)})(u);return(0,Wy.jsx)(qx,(0,_n.Z)({"data-shrink":l,ownerState:u,ref:t,className:(0,Ey.Z)(h.root,o)},s,{classes:h}))})),Yx=Xx;var Kx=i(2537);function Jx(e){return(0,lv.ZP)("MuiFormControl",e)}(0,$y.Z)("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Qx=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],eb=(0,Iy.ZP)("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return(0,_n.Z)({},t.root,t[`margin${(0,mv.Z)(n.margin)}`],n.fullWidth&&t.fullWidth)}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),tb=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiFormControl"}),{children:i,className:o,color:s="primary",component:a="div",disabled:l=!1,error:c=!1,focused:u,fullWidth:h=!1,hiddenLabel:d=!1,margin:p="none",required:f=!1,size:m="medium",variant:g="outlined"}=r,y=(0,My.Z)(r,Qx),v=(0,_n.Z)({},r,{color:s,component:a,disabled:l,error:c,fullWidth:h,hiddenLabel:d,margin:p,required:f,size:m,variant:g}),_=(e=>{const{classes:t,margin:n,fullWidth:r}=e,i={root:["root","none"!==n&&`margin${(0,mv.Z)(n)}`,r&&"fullWidth"]};return(0,Cy.Z)(i,Jx,t)})(v),[x,b]=e.useState((()=>{let t=!1;return i&&e.Children.forEach(i,(e=>{if(!(0,Kx.Z)(e,["Input","Select"]))return;const n=(0,Kx.Z)(e,["Select"])?e.props.input:e;n&&n.props.startAdornment&&(t=!0)})),t})),[w,S]=e.useState((()=>{let t=!1;return i&&e.Children.forEach(i,(e=>{(0,Kx.Z)(e,["Input","Select"])&&(nx(e.props,!0)||nx(e.props.inputProps,!0))&&(t=!0)})),t})),[M,E]=e.useState(!1);l&&M&&E(!1);const T=void 0===u||l?M:u;let C;const A=e.useMemo((()=>({adornedStart:x,setAdornedStart:b,color:s,disabled:l,error:c,filled:w,focused:T,fullWidth:h,hiddenLabel:d,size:m,onBlur:()=>{E(!1)},onEmpty:()=>{S(!1)},onFilled:()=>{S(!0)},onFocus:()=>{E(!0)},registerEffect:C,required:f,variant:g})),[x,s,l,c,w,T,h,d,C,f,m,g]);return(0,Wy.jsx)(W_.Provider,{value:A,children:(0,Wy.jsx)(eb,(0,_n.Z)({as:a,ownerState:v,className:(0,Ey.Z)(_.root,o),ref:n},y,{children:i}))})})),nb=tb;function rb(e){return(0,lv.ZP)("MuiFormHelperText",e)}const ib=(0,$y.Z)("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var ob;const sb=["children","className","component","disabled","error","filled","focused","margin","required","variant"],ab=(0,Iy.ZP)("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.size&&t[`size${(0,mv.Z)(n.size)}`],n.contained&&t.contained,n.filled&&t.filled]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${ib.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${ib.error}`]:{color:(t.vars||t).palette.error.main}},"small"===n.size&&{marginTop:4},n.contained&&{marginLeft:14,marginRight:14})})),lb=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiFormHelperText"}),{children:r,className:i,component:o="p"}=n,s=(0,My.Z)(n,sb),a=Z_({props:n,muiFormControl:$_(),states:["variant","size","disabled","error","filled","focused","required"]}),l=(0,_n.Z)({},n,{component:o,contained:"filled"===a.variant||"outlined"===a.variant,variant:a.variant,size:a.size,disabled:a.disabled,error:a.error,filled:a.filled,focused:a.focused,required:a.required}),c=(e=>{const{classes:t,contained:n,size:r,disabled:i,error:o,filled:s,focused:a,required:l}=e,c={root:["root",i&&"disabled",o&&"error",r&&`size${(0,mv.Z)(r)}`,n&&"contained",a&&"focused",s&&"filled",l&&"required"]};return(0,Cy.Z)(c,rb,t)})(l);return(0,Wy.jsx)(ab,(0,_n.Z)({as:o,ownerState:l,className:(0,Ey.Z)(c.root,i),ref:t},s,{children:" "===r?ob||(ob=(0,Wy.jsx)("span",{className:"notranslate",children:""})):r}))})),cb=lb;i(478);var ub=i(6106);function hb(e,t,n){return void 0===e||H_(e)?t:(0,_n.Z)({},t,{ownerState:(0,_n.Z)({},t.ownerState,n)})}function db(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"==typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n}function pb(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"==typeof e[t]))).forEach((n=>{t[n]=e[n]})),t}function fb(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:r,externalForwardedProps:i,className:o}=e;if(!t){const e=(0,Ey.Z)(null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),t=(0,_n.Z)({},null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),s=(0,_n.Z)({},n,i,r);return e.length>0&&(s.className=e),Object.keys(t).length>0&&(s.style=t),{props:s,internalRef:void 0}}const s=db((0,_n.Z)({},i,r)),a=pb(r),l=pb(i),c=t(s),u=(0,Ey.Z)(null==c?void 0:c.className,null==n?void 0:n.className,o,null==i?void 0:i.className,null==r?void 0:r.className),h=(0,_n.Z)({},null==c?void 0:c.style,null==n?void 0:n.style,null==i?void 0:i.style,null==r?void 0:r.style),d=(0,_n.Z)({},c,n,l,a);return u.length>0&&(d.className=u),Object.keys(h).length>0&&(d.style=h),{props:d,internalRef:c.ref}}const mb=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function gb(e){var t;const{elementType:n,externalSlotProps:r,ownerState:i,skipResolvingSlotProps:o=!1}=e,s=(0,My.Z)(e,mb),a=o?{}:kv(r,i),{props:l,internalRef:c}=fb((0,_n.Z)({},s,{externalSlotProps:a})),u=(0,F_.Z)(c,null==a?void 0:a.ref,null==(t=e.additionalProps)?void 0:t.ref);return hb(n,(0,_n.Z)({},l,{ref:u}),i)}const yb=e.createContext(),vb=()=>{const t=e.useContext(yb);return null!=t&&t},_b=e.createContext({});function xb(e){return(0,lv.ZP)("MuiList",e)}(0,$y.Z)("MuiList",["root","padding","dense","subheader"]);const bb=["children","className","component","dense","disablePadding","subheader"],wb=(0,Iy.ZP)("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disablePadding&&t.padding,n.dense&&t.dense,n.subheader&&t.subheader]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),Sb=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiList"}),{children:i,className:o,component:s="ul",dense:a=!1,disablePadding:l=!1,subheader:c}=r,u=(0,My.Z)(r,bb),h=e.useMemo((()=>({dense:a})),[a]),d=(0,_n.Z)({},r,{component:s,dense:a,disablePadding:l}),p=(e=>{const{classes:t,disablePadding:n,dense:r,subheader:i}=e,o={root:["root",!n&&"padding",r&&"dense",i&&"subheader"]};return(0,Cy.Z)(o,xb,t)})(d);return(0,Wy.jsx)(_b.Provider,{value:h,children:(0,Wy.jsxs)(wb,(0,_n.Z)({as:s,className:(0,Ey.Z)(p.root,o),ref:n,ownerState:d},u,{children:[c,i]}))})})),Mb=Sb;function Eb(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const Tb=Eb,Cb=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function Ab(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function Ib(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function Pb(e,t){if(void 0===t)return!0;let n=e.innerText;return void 0===n&&(n=e.textContent),n=n.trim().toLowerCase(),0!==n.length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function Rb(e,t,n,r,i,o){let s=!1,a=i(e,t,!!t&&n);for(;a;){if(a===e.firstChild){if(s)return!1;s=!0}const t=!r&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&Pb(a,o)&&!t)return a.focus(),!0;a=i(e,a,n)}return!1}const Lb=e.forwardRef((function(t,n){const{actions:r,autoFocus:i=!1,autoFocusItem:o=!1,children:s,className:a,disabledItemsFocusable:l=!1,disableListWrap:c=!1,onKeyDown:u,variant:h="selectedMenu"}=t,d=(0,My.Z)(t,Cb),p=e.useRef(null),f=e.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});(0,q_.Z)((()=>{i&&p.current.focus()}),[i]),e.useImperativeHandle(r,(()=>({adjustStyleForScrollbar:(e,t)=>{let{direction:n}=t;const r=!p.current.style.width;if(e.clientHeight<p.current.clientHeight&&r){const t=`${Tb((0,ub.Z)(e))}px`;p.current.style["rtl"===n?"paddingLeft":"paddingRight"]=t,p.current.style.width=`calc(100% + ${t})`}return p.current}})),[]);const m=(0,Ly.Z)(p,n);let g=-1;e.Children.forEach(s,((t,n)=>{e.isValidElement(t)?(t.props.disabled||("selectedMenu"===h&&t.props.selected||-1===g)&&(g=n),g===n&&(t.props.disabled||t.props.muiSkipListHighlight||t.type.muiSkipListHighlight)&&(g+=1,g>=s.length&&(g=-1))):g===n&&(g+=1,g>=s.length&&(g=-1))}));const y=e.Children.map(s,((t,n)=>{if(n===g){const n={};return o&&(n.autoFocus=!0),void 0===t.props.tabIndex&&"selectedMenu"===h&&(n.tabIndex=0),e.cloneElement(t,n)}return t}));return(0,Wy.jsx)(Mb,(0,_n.Z)({role:"menu",ref:m,className:a,onKeyDown:e=>{const t=p.current,n=e.key,r=(0,ub.Z)(t).activeElement;if("ArrowDown"===n)e.preventDefault(),Rb(t,r,c,l,Ab);else if("ArrowUp"===n)e.preventDefault(),Rb(t,r,c,l,Ib);else if("Home"===n)e.preventDefault(),Rb(t,null,c,l,Ab);else if("End"===n)e.preventDefault(),Rb(t,null,c,l,Ib);else if(1===n.length){const i=f.current,o=n.toLowerCase(),s=performance.now();i.keys.length>0&&(s-i.lastTime>500?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&o!==i.keys[0]&&(i.repeating=!1)),i.lastTime=s,i.keys.push(o);const a=r&&!i.repeating&&Pb(r,i);i.previousKeyMatched&&(a||Rb(t,r,!1,l,Ab,i))?e.preventDefault():i.previousKeyMatched=!1}u&&u(e)},tabIndex:i?0:-1},d,{children:y}))})),Db=Lb;var Ob=i(8706),Nb=i(3533);var kb=function(e){return e.scrollTop},Fb="unmounted",zb="exited",Bb="entering",Ub="entered",jb="exiting",Vb=function(t){function n(e,n){var r;r=t.call(this,e,n)||this;var i,o=n&&!n.isMounting?e.enter:e.appear;return r.appearStatus=null,e.in?o?(i=zb,r.appearStatus=Bb):i=Ub:i=e.unmountOnExit||e.mountOnEnter?Fb:zb,r.state={status:i},r.nextCallback=null,r}ky(n,t),n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Fb?{status:zb}:null};var r=n.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==Bb&&n!==Ub&&(t=Bb):n!==Bb&&n!==Ub||(t=jb)}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!=typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===Bb){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:Wm.findDOMNode(this);n&&kb(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===zb&&this.setState({status:Fb})},r.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,i=this.props.nodeRef?[r]:[Wm.findDOMNode(this),r],o=i[0],s=i[1],a=this.getTimeouts(),l=r?a.appear:a.enter;e||n?(this.props.onEnter(o,s),this.safeSetState({status:Bb},(function(){t.props.onEntering(o,s),t.onTransitionEnd(l,(function(){t.safeSetState({status:Ub},(function(){t.props.onEntered(o,s)}))}))}))):this.safeSetState({status:Ub},(function(){t.props.onEntered(o)}))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:Wm.findDOMNode(this);t?(this.props.onExit(r),this.safeSetState({status:jb},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:zb},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:zb},(function(){e.props.onExited(r)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:Wm.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var i=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=i[0],s=i[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var t=this.state.status;if(t===Fb)return null;var n=this.props,r=n.children,i=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,(0,My.Z)(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return e.createElement(Fy.Provider,{value:null},"function"==typeof r?r(t,i):e.cloneElement(e.Children.only(r),i))},n}(e.Component);function Gb(){}Vb.contextType=Fy,Vb.propTypes={},Vb.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Gb,onEntering:Gb,onEntered:Gb,onExit:Gb,onExiting:Gb,onExited:Gb},Vb.UNMOUNTED=Fb,Vb.EXITED=zb,Vb.ENTERING=Bb,Vb.ENTERED=Ub,Vb.EXITING=jb;const Hb=Vb;function Zb(){const e=(0,Y_.Z)(J_.Z);return e[Q_.Z]||e}const Wb=e=>e.scrollTop;function $b(e,t){var n,r;const{timeout:i,easing:o,style:s={}}=e;return{duration:null!=(n=s.transitionDuration)?n:"number"==typeof i?i:i[t.mode]||0,easing:null!=(r=s.transitionTimingFunction)?r:"object"==typeof o?o[t.mode]:o,delay:s.transitionDelay}}const qb=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function Xb(e){return`scale(${e}, ${e**2})`}const Yb={entering:{opacity:1,transform:Xb(1)},entered:{opacity:1,transform:"none"}},Kb="undefined"!=typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),Jb=e.forwardRef((function(t,n){const{addEndListener:r,appear:i=!0,children:o,easing:s,in:a,onEnter:l,onEntered:c,onEntering:u,onExit:h,onExited:d,onExiting:p,style:f,timeout:m="auto",TransitionComponent:g=Hb}=t,y=(0,My.Z)(t,qb),v=(0,Zy.Z)(),_=e.useRef(),x=Zb(),b=e.useRef(null),w=(0,Ly.Z)(b,o.ref,n),S=e=>t=>{if(e){const n=b.current;void 0===t?e(n):e(n,t)}},M=S(u),E=S(((e,t)=>{Wb(e);const{duration:n,delay:r,easing:i}=$b({style:f,timeout:m,easing:s},{mode:"enter"});let o;"auto"===m?(o=x.transitions.getAutoHeightDuration(e.clientHeight),_.current=o):o=n,e.style.transition=[x.transitions.create("opacity",{duration:o,delay:r}),x.transitions.create("transform",{duration:Kb?o:.666*o,delay:r,easing:i})].join(","),l&&l(e,t)})),T=S(c),C=S(p),A=S((e=>{const{duration:t,delay:n,easing:r}=$b({style:f,timeout:m,easing:s},{mode:"exit"});let i;"auto"===m?(i=x.transitions.getAutoHeightDuration(e.clientHeight),_.current=i):i=t,e.style.transition=[x.transitions.create("opacity",{duration:i,delay:n}),x.transitions.create("transform",{duration:Kb?i:.666*i,delay:Kb?n:n||.333*i,easing:r})].join(","),e.style.opacity=0,e.style.transform=Xb(.75),h&&h(e)})),I=S(d);return(0,Wy.jsx)(g,(0,_n.Z)({appear:i,in:a,nodeRef:b,onEnter:E,onEntered:T,onEntering:M,onExit:A,onExited:I,onExiting:C,addEndListener:e=>{"auto"===m&&v.start(_.current||0,e),r&&r(b.current,e)},timeout:"auto"===m?null:m},y,{children:(t,n)=>e.cloneElement(o,(0,_n.Z)({style:(0,_n.Z)({opacity:0,transform:Xb(.75),visibility:"exited"!==t||a?void 0:"hidden"},Yb[t],f,o.props.style),ref:w},n))}))}));Jb.muiSupportAuto=!0;const Qb=Jb;var ew=i(2133),tw=i(1782),nw=i(4792);function rw(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function iw(e){return parseInt((0,z_.Z)(e).getComputedStyle(e).paddingRight,10)||0}function ow(e,t,n,r,i){const o=[t,n,...r];[].forEach.call(e.children,(e=>{const t=-1===o.indexOf(e),n=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&rw(e,i)}))}function sw(e,t){let n=-1;return e.some(((e,r)=>!!t(e)&&(n=r,!0))),n}const aw=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&rw(e.modalRef,!1);const r=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);ow(t,e.mount,e.modalRef,r,!0);const i=sw(this.containers,(e=>e.container===t));return-1!==i?(this.containers[i].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:r}),n)}mount(e,t){const n=sw(this.containers,(t=>-1!==t.modals.indexOf(e))),r=this.containers[n];r.restore||(r.restore=function(e,t){const n=[],r=e.container;if(!t.disableScrollLock){if(function(e){const t=(0,ew.Z)(e);return t.body===e?(0,z_.Z)(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(r)){const e=Eb((0,ew.Z)(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight=`${iw(r)+e}px`;const t=(0,ew.Z)(r).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight=`${iw(t)+e}px`}))}let e;if(r.parentNode instanceof DocumentFragment)e=(0,ew.Z)(r).body;else{const t=r.parentElement,n=(0,z_.Z)(r);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:r}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach((e=>{let{value:t,el:n,property:r}=e;t?n.style.setProperty(r,t):n.style.removeProperty(r)}))}}(r,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const r=sw(this.containers,(t=>-1!==t.modals.indexOf(e))),i=this.containers[r];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(n,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&rw(e.modalRef,t),ow(i.container,e.mount,e.modalRef,i.hiddenSiblings,!1),this.containers.splice(r,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&rw(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const lw=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function cw(e){const t=[],n=[];return Array.from(e.querySelectorAll(lw)).forEach(((e,r)=>{const i=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==i&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let n=t(`[name="${e.name}"]:checked`);return n||(n=t(`[name="${e.name}"]`)),n!==e}(e))}(e)&&(0===i?t.push(e):n.push({documentOrder:r,tabIndex:i,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function uw(){return!0}function hw(t){const{children:n,disableAutoFocus:r=!1,disableEnforceFocus:i=!1,disableRestoreFocus:o=!1,getTabbable:s=cw,isEnabled:a=uw,open:l}=t,c=e.useRef(!1),u=e.useRef(null),h=e.useRef(null),d=e.useRef(null),p=e.useRef(null),f=e.useRef(!1),m=e.useRef(null),g=(0,F_.Z)(n.ref,m),y=e.useRef(null);e.useEffect((()=>{l&&m.current&&(f.current=!r)}),[r,l]),e.useEffect((()=>{if(!l||!m.current)return;const e=(0,ew.Z)(m.current);return m.current.contains(e.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),f.current&&m.current.focus()),()=>{o||(d.current&&d.current.focus&&(c.current=!0,d.current.focus()),d.current=null)}}),[l]),e.useEffect((()=>{if(!l||!m.current)return;const e=(0,ew.Z)(m.current),t=t=>{y.current=t,!i&&a()&&"Tab"===t.key&&e.activeElement===m.current&&t.shiftKey&&(c.current=!0,h.current&&h.current.focus())},n=()=>{const t=m.current;if(null===t)return;if(!e.hasFocus()||!a()||c.current)return void(c.current=!1);if(t.contains(e.activeElement))return;if(i&&e.activeElement!==u.current&&e.activeElement!==h.current)return;if(e.activeElement!==p.current)p.current=null;else if(null!==p.current)return;if(!f.current)return;let n=[];if(e.activeElement!==u.current&&e.activeElement!==h.current||(n=s(m.current)),n.length>0){var r,o;const e=Boolean((null==(r=y.current)?void 0:r.shiftKey)&&"Tab"===(null==(o=y.current)?void 0:o.key)),t=n[0],i=n[n.length-1];"string"!=typeof t&&"string"!=typeof i&&(e?i.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const r=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(r),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[r,i,o,a,l,s]);const v=e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0};return(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)("div",{tabIndex:l?0:-1,onFocus:v,ref:u,"data-testid":"sentinelStart"}),e.cloneElement(n,{ref:g,onFocus:e=>{null===d.current&&(d.current=e.relatedTarget),f.current=!0,p.current=e.target;const t=n.props.onFocus;t&&t(e)}}),(0,Wy.jsx)("div",{tabIndex:l?0:-1,onFocus:v,ref:h,"data-testid":"sentinelEnd"})]})}var dw=i(7495);const pw=e.forwardRef((function(t,n){const{children:r,container:i,disablePortal:o=!1}=t,[s,a]=e.useState(null),l=(0,F_.Z)(e.isValidElement(r)?r.ref:null,n);if((0,Cv.Z)((()=>{o||a(function(e){return"function"==typeof e?e():e}(i)||document.body)}),[i,o]),(0,Cv.Z)((()=>{if(s&&!o)return(0,dw.Z)(n,s),()=>{(0,dw.Z)(n,null)}}),[n,s,o]),o){if(e.isValidElement(r)){const t={ref:l};return e.cloneElement(r,t)}return(0,Wy.jsx)(e.Fragment,{children:r})}return(0,Wy.jsx)(e.Fragment,{children:s?Wm.createPortal(r,s):s})})),fw=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],mw={entering:{opacity:1},entered:{opacity:1}},gw=e.forwardRef((function(t,n){const r=Zb(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:o,appear:s=!0,children:a,easing:l,in:c,onEnter:u,onEntered:h,onEntering:d,onExit:p,onExited:f,onExiting:m,style:g,timeout:y=i,TransitionComponent:v=Hb}=t,_=(0,My.Z)(t,fw),x=e.useRef(null),b=(0,Ly.Z)(x,a.ref,n),w=e=>t=>{if(e){const n=x.current;void 0===t?e(n):e(n,t)}},S=w(d),M=w(((e,t)=>{Wb(e);const n=$b({style:g,timeout:y,easing:l},{mode:"enter"});e.style.webkitTransition=r.transitions.create("opacity",n),e.style.transition=r.transitions.create("opacity",n),u&&u(e,t)})),E=w(h),T=w(m),C=w((e=>{const t=$b({style:g,timeout:y,easing:l},{mode:"exit"});e.style.webkitTransition=r.transitions.create("opacity",t),e.style.transition=r.transitions.create("opacity",t),p&&p(e)})),A=w(f);return(0,Wy.jsx)(v,(0,_n.Z)({appear:s,in:c,nodeRef:x,onEnter:M,onEntered:E,onEntering:S,onExit:C,onExited:A,onExiting:T,addEndListener:e=>{o&&o(x.current,e)},timeout:y},_,{children:(t,n)=>e.cloneElement(a,(0,_n.Z)({style:(0,_n.Z)({opacity:0,visibility:"exited"!==t||c?void 0:"hidden"},mw[t],g,a.props.style),ref:b},n))}))}));function yw(e){return(0,lv.ZP)("MuiBackdrop",e)}(0,$y.Z)("MuiBackdrop",["root","invisible"]);const vw=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],_w=(0,Iy.ZP)("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),xw=e.forwardRef((function(e,t){var n,r,i;const o=(0,Ry.Z)({props:e,name:"MuiBackdrop"}),{children:s,className:a,component:l="div",components:c={},componentsProps:u={},invisible:h=!1,open:d,slotProps:p={},slots:f={},TransitionComponent:m=gw,transitionDuration:g}=o,y=(0,My.Z)(o,vw),v=(0,_n.Z)({},o,{component:l,invisible:h}),_=(e=>{const{classes:t,invisible:n}=e,r={root:["root",n&&"invisible"]};return(0,Cy.Z)(r,yw,t)})(v),x=null!=(n=p.root)?n:u.root;return(0,Wy.jsx)(m,(0,_n.Z)({in:d,timeout:g},y,{children:(0,Wy.jsx)(_w,(0,_n.Z)({"aria-hidden":!0},x,{as:null!=(r=null!=(i=f.root)?i:c.Root)?r:l,className:(0,Ey.Z)(_.root,a,null==x?void 0:x.className),ownerState:(0,_n.Z)({},v,null==x?void 0:x.ownerState),classes:_,ref:t,children:s}))}))})),bw=xw;function ww(e){return(0,lv.ZP)("MuiModal",e)}(0,$y.Z)("MuiModal",["root","hidden","backdrop"]);const Sw=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],Mw=(0,Iy.ZP)("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),Ew=(0,Iy.ZP)(bw,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),Tw=e.forwardRef((function(t,n){var r,i,o,s,a,l;const c=(0,Ry.Z)({name:"MuiModal",props:t}),{BackdropComponent:u=Ew,BackdropProps:h,className:d,closeAfterTransition:p=!1,children:f,container:m,component:g,components:y={},componentsProps:v={},disableAutoFocus:_=!1,disableEnforceFocus:x=!1,disableEscapeKeyDown:b=!1,disablePortal:w=!1,disableRestoreFocus:S=!1,disableScrollLock:M=!1,hideBackdrop:E=!1,keepMounted:T=!1,onBackdropClick:C,open:A,slotProps:I,slots:P}=c,R=(0,My.Z)(c,Sw),L=(0,_n.Z)({},c,{closeAfterTransition:p,disableAutoFocus:_,disableEnforceFocus:x,disableEscapeKeyDown:b,disablePortal:w,disableRestoreFocus:S,disableScrollLock:M,hideBackdrop:E,keepMounted:T}),{getRootProps:D,getBackdropProps:O,getTransitionProps:N,portalRef:k,isTopModal:F,exited:z,hasTransition:B}=function(t){const{container:n,disableEscapeKeyDown:r=!1,disableScrollLock:i=!1,manager:o=aw,closeAfterTransition:s=!1,onTransitionEnter:a,onTransitionExited:l,children:c,onClose:u,open:h,rootRef:d}=t,p=e.useRef({}),f=e.useRef(null),m=e.useRef(null),g=(0,F_.Z)(m,d),[y,v]=e.useState(!h),_=function(e){return!!e&&e.props.hasOwnProperty("in")}(c);let x=!0;"false"!==t["aria-hidden"]&&!1!==t["aria-hidden"]||(x=!1);const b=()=>(p.current.modalRef=m.current,p.current.mount=f.current,p.current),w=()=>{o.mount(b(),{disableScrollLock:i}),m.current&&(m.current.scrollTop=0)},S=(0,tw.Z)((()=>{const e=function(e){return"function"==typeof e?e():e}(n)||(0,ew.Z)(f.current).body;o.add(b(),e),m.current&&w()})),M=e.useCallback((()=>o.isTopModal(b())),[o]),E=(0,tw.Z)((e=>{f.current=e,e&&(h&&M()?w():m.current&&rw(m.current,x))})),T=e.useCallback((()=>{o.remove(b(),x)}),[x,o]);e.useEffect((()=>()=>{T()}),[T]),e.useEffect((()=>{h?S():_&&s||T()}),[h,T,_,s,S]);const C=e=>t=>{var n;null==(n=e.onKeyDown)||n.call(e,t),"Escape"===t.key&&229!==t.which&&M()&&(r||(t.stopPropagation(),u&&u(t,"escapeKeyDown")))};return{getRootProps:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=db(t);delete n.onTransitionEnter,delete n.onTransitionExited;const r=(0,_n.Z)({},n,e);return(0,_n.Z)({role:"presentation"},r,{onKeyDown:C(r),ref:g})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,_n.Z)({"aria-hidden":!0},e,{onClick:(t=e,e=>{var n;null==(n=t.onClick)||n.call(t,e),e.target===e.currentTarget&&u&&u(e,"backdropClick")}),open:h});var t},getTransitionProps:()=>({onEnter:(0,nw.Z)((()=>{v(!1),a&&a()}),null==c?void 0:c.props.onEnter),onExited:(0,nw.Z)((()=>{v(!0),l&&l(),s&&T()}),null==c?void 0:c.props.onExited)}),rootRef:g,portalRef:E,isTopModal:M,exited:y,hasTransition:_}}((0,_n.Z)({},L,{rootRef:n})),U=(0,_n.Z)({},L,{exited:z}),j=(e=>{const{open:t,exited:n,classes:r}=e,i={root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]};return(0,Cy.Z)(i,ww,r)})(U),V={};if(void 0===f.props.tabIndex&&(V.tabIndex="-1"),B){const{onEnter:e,onExited:t}=N();V.onEnter=e,V.onExited=t}const G=null!=(r=null!=(i=null==P?void 0:P.root)?i:y.Root)?r:Mw,H=null!=(o=null!=(s=null==P?void 0:P.backdrop)?s:y.Backdrop)?o:u,Z=null!=(a=null==I?void 0:I.root)?a:v.root,W=null!=(l=null==I?void 0:I.backdrop)?l:v.backdrop,$=gb({elementType:G,externalSlotProps:Z,externalForwardedProps:R,getSlotProps:D,additionalProps:{ref:n,as:g},ownerState:U,className:(0,Ey.Z)(d,null==Z?void 0:Z.className,null==j?void 0:j.root,!U.open&&U.exited&&(null==j?void 0:j.hidden))}),q=gb({elementType:H,externalSlotProps:W,additionalProps:h,getSlotProps:e=>O((0,_n.Z)({},e,{onClick:t=>{C&&C(t),null!=e&&e.onClick&&e.onClick(t)}})),className:(0,Ey.Z)(null==W?void 0:W.className,null==h?void 0:h.className,null==j?void 0:j.backdrop),ownerState:U});return T||A||B&&!z?(0,Wy.jsx)(pw,{ref:k,container:m,disablePortal:w,children:(0,Wy.jsxs)(G,(0,_n.Z)({},$,{children:[!E&&u?(0,Wy.jsx)(H,(0,_n.Z)({},q)):null,(0,Wy.jsx)(hw,{disableEnforceFocus:x,disableAutoFocus:_,disableRestoreFocus:S,isEnabled:F,open:A,children:e.cloneElement(f,V)})]}))}):null})),Cw=Tw,Aw=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};function Iw(e){return(0,lv.ZP)("MuiPaper",e)}(0,$y.Z)("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Pw=["className","component","elevation","square","variant"],Rw=(0,Iy.ZP)("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t[`elevation${n.elevation}`]]}})((e=>{let{theme:t,ownerState:n}=e;var r;return(0,_n.Z)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!n.square&&{borderRadius:t.shape.borderRadius},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.divider}`},"elevation"===n.variant&&(0,_n.Z)({boxShadow:(t.vars||t).shadows[n.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:`linear-gradient(${(0,Ay.Fq)("#fff",Aw(n.elevation))}, ${(0,Ay.Fq)("#fff",Aw(n.elevation))})`},t.vars&&{backgroundImage:null==(r=t.vars.overlays)?void 0:r[n.elevation]}))})),Lw=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPaper"}),{className:r,component:i="div",elevation:o=1,square:s=!1,variant:a="elevation"}=n,l=(0,My.Z)(n,Pw),c=(0,_n.Z)({},n,{component:i,elevation:o,square:s,variant:a}),u=(e=>{const{square:t,elevation:n,variant:r,classes:i}=e,o={root:["root",r,!t&&"rounded","elevation"===r&&`elevation${n}`]};return(0,Cy.Z)(o,Iw,i)})(c);return(0,Wy.jsx)(Rw,(0,_n.Z)({as:i,ownerState:c,className:(0,Ey.Z)(u.root,r),ref:t},l))})),Dw=Lw;function Ow(e){return(0,lv.ZP)("MuiPopover",e)}(0,$y.Z)("MuiPopover",["root","paper"]);const Nw=["onEntering"],kw=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"],Fw=["slotProps"];function zw(e,t){let n=0;return"number"==typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function Bw(e,t){let n=0;return"number"==typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function Uw(e){return[e.horizontal,e.vertical].map((e=>"number"==typeof e?`${e}px`:e)).join(" ")}function jw(e){return"function"==typeof e?e():e}const Vw=(0,Iy.ZP)(Cw,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Gw=(0,Iy.ZP)(Dw,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Hw=e.forwardRef((function(t,n){var r,i,o;const s=(0,Ry.Z)({props:t,name:"MuiPopover"}),{action:a,anchorEl:l,anchorOrigin:c={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:h="anchorEl",children:d,className:p,container:f,elevation:m=8,marginThreshold:g=16,open:y,PaperProps:v={},slots:_,slotProps:x,transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:w=Qb,transitionDuration:S="auto",TransitionProps:{onEntering:M}={},disableScrollLock:E=!1}=s,T=(0,My.Z)(s.TransitionProps,Nw),C=(0,My.Z)(s,kw),A=null!=(r=null==x?void 0:x.paper)?r:v,I=e.useRef(),P=(0,Ly.Z)(I,A.ref),R=(0,_n.Z)({},s,{anchorOrigin:c,anchorReference:h,elevation:m,marginThreshold:g,externalPaperSlotProps:A,transformOrigin:b,TransitionComponent:w,transitionDuration:S,TransitionProps:T}),L=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],paper:["paper"]},Ow,t)})(R),D=e.useCallback((()=>{if("anchorPosition"===h)return u;const e=jw(l),t=(e&&1===e.nodeType?e:(0,ub.Z)(I.current).body).getBoundingClientRect();return{top:t.top+zw(t,c.vertical),left:t.left+Bw(t,c.horizontal)}}),[l,c.horizontal,c.vertical,u,h]),O=e.useCallback((e=>({vertical:zw(e,b.vertical),horizontal:Bw(e,b.horizontal)})),[b.horizontal,b.vertical]),N=e.useCallback((e=>{const t={width:e.offsetWidth,height:e.offsetHeight},n=O(t);if("none"===h)return{top:null,left:null,transformOrigin:Uw(n)};const r=D();let i=r.top-n.vertical,o=r.left-n.horizontal;const s=i+t.height,a=o+t.width,c=(0,Nb.Z)(jw(l)),u=c.innerHeight-g,d=c.innerWidth-g;if(null!==g&&i<g){const e=i-g;i-=e,n.vertical+=e}else if(null!==g&&s>u){const e=s-u;i-=e,n.vertical+=e}if(null!==g&&o<g){const e=o-g;o-=e,n.horizontal+=e}else if(a>d){const e=a-d;o-=e,n.horizontal+=e}return{top:`${Math.round(i)}px`,left:`${Math.round(o)}px`,transformOrigin:Uw(n)}}),[l,h,D,O,g]),[k,F]=e.useState(y),z=e.useCallback((()=>{const e=I.current;if(!e)return;const t=N(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin,F(!0)}),[N]);e.useEffect((()=>(E&&window.addEventListener("scroll",z),()=>window.removeEventListener("scroll",z))),[l,E,z]),e.useEffect((()=>{y&&z()})),e.useImperativeHandle(a,(()=>y?{updatePosition:()=>{z()}}:null),[y,z]),e.useEffect((()=>{if(!y)return;const e=(0,Ob.Z)((()=>{z()})),t=(0,Nb.Z)(l);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[l,y,z]);let B=S;"auto"!==S||w.muiSupportAuto||(B=void 0);const U=f||(l?(0,ub.Z)(jw(l)).body:void 0),j=null!=(i=null==_?void 0:_.root)?i:Vw,V=null!=(o=null==_?void 0:_.paper)?o:Gw,G=gb({elementType:V,externalSlotProps:(0,_n.Z)({},A,{style:k?A.style:(0,_n.Z)({},A.style,{opacity:0})}),additionalProps:{elevation:m,ref:P},ownerState:R,className:(0,Ey.Z)(L.paper,null==A?void 0:A.className)}),H=gb({elementType:j,externalSlotProps:(null==x?void 0:x.root)||{},externalForwardedProps:C,additionalProps:{ref:n,slotProps:{backdrop:{invisible:!0}},container:U,open:y},ownerState:R,className:(0,Ey.Z)(L.root,p)}),{slotProps:Z}=H,W=(0,My.Z)(H,Fw);return(0,Wy.jsx)(j,(0,_n.Z)({},W,!H_(j)&&{slotProps:Z,disableScrollLock:E},{children:(0,Wy.jsx)(w,(0,_n.Z)({appear:!0,in:y,onEntering:(e,t)=>{M&&M(e,t),z()},onExited:()=>{F(!1)},timeout:B},T,{children:(0,Wy.jsx)(V,(0,_n.Z)({},G,{children:d}))}))}))})),Zw=Hw;function Ww(e){return(0,lv.ZP)("MuiMenu",e)}(0,$y.Z)("MuiMenu",["root","paper","list"]);const $w=["onEntering"],qw=["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"],Xw={vertical:"top",horizontal:"right"},Yw={vertical:"top",horizontal:"left"},Kw=(0,Iy.ZP)(Zw,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Jw=(0,Iy.ZP)(Gw,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Qw=(0,Iy.ZP)(Db,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),eS=e.forwardRef((function(t,n){var r,i;const o=(0,Ry.Z)({props:t,name:"MuiMenu"}),{autoFocus:s=!0,children:a,className:l,disableAutoFocusItem:c=!1,MenuListProps:u={},onClose:h,open:d,PaperProps:p={},PopoverClasses:f,transitionDuration:m="auto",TransitionProps:{onEntering:g}={},variant:y="selectedMenu",slots:v={},slotProps:_={}}=o,x=(0,My.Z)(o.TransitionProps,$w),b=(0,My.Z)(o,qw),w=vb(),S=(0,_n.Z)({},o,{autoFocus:s,disableAutoFocusItem:c,MenuListProps:u,onEntering:g,PaperProps:p,transitionDuration:m,TransitionProps:x,variant:y}),M=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],paper:["paper"],list:["list"]},Ww,t)})(S),E=s&&!c&&d,T=e.useRef(null);let C=-1;e.Children.map(a,((t,n)=>{e.isValidElement(t)&&(t.props.disabled||("selectedMenu"===y&&t.props.selected||-1===C)&&(C=n))}));const A=null!=(r=v.paper)?r:Jw,I=null!=(i=_.paper)?i:p,P=gb({elementType:v.root,externalSlotProps:_.root,ownerState:S,className:[M.root,l]}),R=gb({elementType:A,externalSlotProps:I,ownerState:S,className:M.paper});return(0,Wy.jsx)(Kw,(0,_n.Z)({onClose:h,anchorOrigin:{vertical:"bottom",horizontal:w?"right":"left"},transformOrigin:w?Xw:Yw,slots:{paper:A,root:v.root},slotProps:{root:P,paper:R},open:d,ref:n,transitionDuration:m,TransitionProps:(0,_n.Z)({onEntering:(e,t)=>{T.current&&T.current.adjustStyleForScrollbar(e,{direction:w?"rtl":"ltr"}),g&&g(e,t)}},x),ownerState:S},b,{classes:f,children:(0,Wy.jsx)(Qw,(0,_n.Z)({onKeyDown:e=>{"Tab"===e.key&&(e.preventDefault(),h&&h(e,"tabKeyDown"))},actions:T,autoFocus:s&&(-1===C||c),autoFocusItem:E,variant:y},u,{className:(0,Ey.Z)(M.list,u.className),children:a}))}))})),tS=eS;function nS(e){return(0,lv.ZP)("MuiNativeSelect",e)}const rS=(0,$y.Z)("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),iS=["className","disabled","error","IconComponent","inputRef","variant"],oS=e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":(0,_n.Z)({},n.vars?{backgroundColor:`rgba(${n.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:"light"===n.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${rS.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(n.vars||n).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},"filled"===t.variant&&{"&&&":{paddingRight:32}},"outlined"===t.variant&&{borderRadius:(n.vars||n).shape.borderRadius,"&:focus":{borderRadius:(n.vars||n).shape.borderRadius},"&&&":{paddingRight:32}})},sS=(0,Iy.ZP)("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Py.Z,overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.select,t[n.variant],n.error&&t.error,{[`&.${rS.multiple}`]:t.multiple}]}})(oS),aS=e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(n.vars||n).palette.action.active,[`&.${rS.disabled}`]:{color:(n.vars||n).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},lS=(0,Iy.ZP)("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,mv.Z)(n.variant)}`],n.open&&t.iconOpen]}})(aS),cS=e.forwardRef((function(t,n){const{className:r,disabled:i,error:o,IconComponent:s,inputRef:a,variant:l="standard"}=t,c=(0,My.Z)(t,iS),u=(0,_n.Z)({},t,{disabled:i,variant:l,error:o}),h=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon",`icon${(0,mv.Z)(n)}`,o&&"iconOpen",r&&"disabled"]};return(0,Cy.Z)(a,nS,t)})(u);return(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(sS,(0,_n.Z)({ownerState:u,className:(0,Ey.Z)(h.select,r),disabled:i,ref:a||n},c)),t.multiple?null:(0,Wy.jsx)(lS,{as:s,ownerState:u,className:h.icon})]})})),uS=cS;var hS=i(4205),dS=i(3800);function pS(e){return(0,lv.ZP)("MuiSelect",e)}const fS=(0,$y.Z)("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var mS;const gS=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],yS=(0,Iy.ZP)("div",{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`&.${fS.select}`]:t.select},{[`&.${fS.select}`]:t[n.variant]},{[`&.${fS.error}`]:t.error},{[`&.${fS.multiple}`]:t.multiple}]}})(oS,{[`&.${fS.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),vS=(0,Iy.ZP)("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.icon,n.variant&&t[`icon${(0,mv.Z)(n.variant)}`],n.open&&t.iconOpen]}})(aS),_S=(0,Iy.ZP)("input",{shouldForwardProp:e=>(0,hS.Z)(e)&&"classes"!==e,name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function xS(e,t){return"object"==typeof t&&null!==t?e===t:String(e)===String(t)}function bS(e){return null==e||"string"==typeof e&&!e.trim()}const wS=e.forwardRef((function(t,n){var r;const{"aria-describedby":i,"aria-label":o,autoFocus:s,autoWidth:a,children:l,className:c,defaultOpen:u,defaultValue:h,disabled:d,displayEmpty:p,error:f=!1,IconComponent:m,inputRef:g,labelId:y,MenuProps:v={},multiple:_,name:x,onBlur:b,onChange:w,onClose:S,onFocus:M,onOpen:E,open:T,readOnly:C,renderValue:A,SelectDisplayProps:I={},tabIndex:P,value:R,variant:L="standard"}=t,D=(0,My.Z)(t,gS),[O,N]=(0,dS.Z)({controlled:R,default:h,name:"Select"}),[k,F]=(0,dS.Z)({controlled:T,default:u,name:"Select"}),z=e.useRef(null),B=e.useRef(null),[U,j]=e.useState(null),{current:V}=e.useRef(null!=T),[G,H]=e.useState(),Z=(0,Ly.Z)(n,g),W=e.useCallback((e=>{B.current=e,e&&j(e)}),[]),$=null==U?void 0:U.parentNode;e.useImperativeHandle(Z,(()=>({focus:()=>{B.current.focus()},node:z.current,value:O})),[O]),e.useEffect((()=>{u&&k&&U&&!V&&(H(a?null:$.clientWidth),B.current.focus())}),[U,a]),e.useEffect((()=>{s&&B.current.focus()}),[s]),e.useEffect((()=>{if(!y)return;const e=(0,ub.Z)(B.current).getElementById(y);if(e){const t=()=>{getSelection().isCollapsed&&B.current.focus()};return e.addEventListener("click",t),()=>{e.removeEventListener("click",t)}}}),[y]);const q=(e,t)=>{e?E&&E(t):S&&S(t),V||(H(a?null:$.clientWidth),F(e))},X=e.Children.toArray(l),Y=e=>t=>{let n;if(t.currentTarget.hasAttribute("tabindex")){if(_){n=Array.isArray(O)?O.slice():[];const t=O.indexOf(e.props.value);-1===t?n.push(e.props.value):n.splice(t,1)}else n=e.props.value;if(e.props.onClick&&e.props.onClick(t),O!==n&&(N(n),w)){const r=t.nativeEvent||t,i=new r.constructor(r.type,r);Object.defineProperty(i,"target",{writable:!0,value:{value:n,name:x}}),w(i,e)}_||q(!1,t)}},K=null!==U&&k;let J,Q;delete D["aria-invalid"];const ee=[];let te=!1,ne=!1;(nx({value:O})||p)&&(A?J=A(O):te=!0);const re=X.map((t=>{if(!e.isValidElement(t))return null;let n;if(_){if(!Array.isArray(O))throw new Error((0,k_.Z)(2));n=O.some((e=>xS(e,t.props.value))),n&&te&&ee.push(t.props.children)}else n=xS(O,t.props.value),n&&te&&(Q=t.props.children);return n&&(ne=!0),e.cloneElement(t,{"aria-selected":n?"true":"false",onClick:Y(t),onKeyUp:e=>{" "===e.key&&e.preventDefault(),t.props.onKeyUp&&t.props.onKeyUp(e)},role:"option",selected:n,value:void 0,"data-value":t.props.value})}));te&&(J=_?0===ee.length?null:ee.reduce(((e,t,n)=>(e.push(t),n<ee.length-1&&e.push(", "),e)),[]):Q);let ie,oe=G;!a&&V&&U&&(oe=$.clientWidth),ie=void 0!==P?P:d?null:0;const se=I.id||(x?`mui-component-select-${x}`:void 0),ae=(0,_n.Z)({},t,{variant:L,value:O,open:K,error:f}),le=(e=>{const{classes:t,variant:n,disabled:r,multiple:i,open:o,error:s}=e,a={select:["select",n,r&&"disabled",i&&"multiple",s&&"error"],icon:["icon",`icon${(0,mv.Z)(n)}`,o&&"iconOpen",r&&"disabled"],nativeInput:["nativeInput"]};return(0,Cy.Z)(a,pS,t)})(ae),ce=(0,_n.Z)({},v.PaperProps,null==(r=v.slotProps)?void 0:r.paper),ue=(0,O_.Z)();return(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(yS,(0,_n.Z)({ref:W,tabIndex:ie,role:"combobox","aria-controls":ue,"aria-disabled":d?"true":void 0,"aria-expanded":K?"true":"false","aria-haspopup":"listbox","aria-label":o,"aria-labelledby":[y,se].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:e=>{C||-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),q(!0,e))},onMouseDown:d||C?null:e=>{0===e.button&&(e.preventDefault(),B.current.focus(),q(!0,e))},onBlur:e=>{!K&&b&&(Object.defineProperty(e,"target",{writable:!0,value:{value:O,name:x}}),b(e))},onFocus:M},I,{ownerState:ae,className:(0,Ey.Z)(I.className,le.select,c),id:se,children:bS(J)?mS||(mS=(0,Wy.jsx)("span",{className:"notranslate",children:""})):J})),(0,Wy.jsx)(_S,(0,_n.Z)({"aria-invalid":f,value:Array.isArray(O)?O.join(","):O,name:x,ref:z,"aria-hidden":!0,onChange:e=>{const t=X.find((t=>t.props.value===e.target.value));void 0!==t&&(N(t.props.value),w&&w(e,t))},tabIndex:-1,disabled:d,className:le.nativeInput,autoFocus:s,ownerState:ae},D)),(0,Wy.jsx)(vS,{as:m,className:le.icon,ownerState:ae}),(0,Wy.jsx)(tS,(0,_n.Z)({id:`menu-${x||""}`,anchorEl:$,open:K,onClose:e=>{q(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},v,{MenuListProps:(0,_n.Z)({"aria-labelledby":y,role:"listbox","aria-multiselectable":_?"true":void 0,disableListWrap:!0,id:ue},v.MenuListProps),slotProps:(0,_n.Z)({},v.slotProps,{paper:(0,_n.Z)({},ce,{style:(0,_n.Z)({minWidth:oe},null!=ce?ce.style:null)})}),children:re}))]})})),SS=wS;var MS=i(1171);const ES=(0,MS.Z)((0,Wy.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),TS=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],CS=["root"],AS={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>(0,Py.Z)(e)&&"variant"!==e,slot:"Root"},IS=(0,Iy.ZP)(_x,AS)(""),PS=(0,Iy.ZP)(zx,AS)(""),RS=(0,Iy.ZP)(Tx,AS)(""),LS=e.forwardRef((function(t,n){const r=(0,Ry.Z)({name:"MuiSelect",props:t}),{autoWidth:i=!1,children:o,classes:s={},className:a,defaultOpen:l=!1,displayEmpty:c=!1,IconComponent:u=ES,id:h,input:d,inputProps:p,label:f,labelId:m,MenuProps:g,multiple:y=!1,native:v=!1,onClose:_,onOpen:x,open:b,renderValue:w,SelectDisplayProps:S,variant:M="outlined"}=r,E=(0,My.Z)(r,TS),T=v?uS:SS,C=Z_({props:r,muiFormControl:$_(),states:["variant","error"]}),A=C.variant||M,I=(0,_n.Z)({},r,{variant:A,classes:s}),P=(e=>{const{classes:t}=e;return t})(I),R=(0,My.Z)(P,CS),L=d||{standard:(0,Wy.jsx)(IS,{ownerState:I}),outlined:(0,Wy.jsx)(PS,{label:f,ownerState:I}),filled:(0,Wy.jsx)(RS,{ownerState:I})}[A],D=(0,Ly.Z)(n,L.ref);return(0,Wy.jsx)(e.Fragment,{children:e.cloneElement(L,(0,_n.Z)({inputComponent:T,inputProps:(0,_n.Z)({children:o,error:C.error,IconComponent:u,variant:A,type:void 0,multiple:y},v?{id:h}:{autoWidth:i,defaultOpen:l,displayEmpty:c,labelId:m,MenuProps:g,onClose:_,onOpen:x,open:b,renderValue:w,SelectDisplayProps:(0,_n.Z)({id:h},S)},p,{classes:p?(0,N_.Z)(R,p.classes):R},d?d.props.inputProps:{})},(y&&v||c)&&"outlined"===A?{notched:!0}:{},{ref:D,className:(0,Ey.Z)(L.props.className,a,P.root)},!d&&{variant:A},E))})}));LS.muiName="Select";const DS=LS;function OS(e){return(0,lv.ZP)("MuiTextField",e)}(0,$y.Z)("MuiTextField",["root"]);const NS=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],kS={standard:_x,filled:Tx,outlined:zx},FS=(0,Iy.ZP)(nb,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),zS=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiTextField"}),{autoComplete:r,autoFocus:i=!1,children:o,className:s,color:a="primary",defaultValue:l,disabled:c=!1,error:u=!1,FormHelperTextProps:h,fullWidth:d=!1,helperText:p,id:f,InputLabelProps:m,inputProps:g,InputProps:y,inputRef:v,label:_,maxRows:x,minRows:b,multiline:w=!1,name:S,onBlur:M,onChange:E,onFocus:T,placeholder:C,required:A=!1,rows:I,select:P=!1,SelectProps:R,type:L,value:D,variant:O="outlined"}=n,N=(0,My.Z)(n,NS),k=(0,_n.Z)({},n,{autoFocus:i,color:a,disabled:c,error:u,fullWidth:d,multiline:w,required:A,select:P,variant:O}),F=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},OS,t)})(k),z={};"outlined"===O&&(m&&void 0!==m.shrink&&(z.notched=m.shrink),z.label=_),P&&(R&&R.native||(z.id=void 0),z["aria-describedby"]=void 0);const B=(0,O_.Z)(f),U=p&&B?`${B}-helper-text`:void 0,j=_&&B?`${B}-label`:void 0,V=kS[O],G=(0,Wy.jsx)(V,(0,_n.Z)({"aria-describedby":U,autoComplete:r,autoFocus:i,defaultValue:l,fullWidth:d,multiline:w,name:S,rows:I,maxRows:x,minRows:b,type:L,value:D,id:B,inputRef:v,onBlur:M,onChange:E,onFocus:T,placeholder:C,inputProps:g},z,y));return(0,Wy.jsxs)(FS,(0,_n.Z)({className:(0,Ey.Z)(F.root,s),disabled:c,error:u,fullWidth:d,ref:t,required:A,color:a,variant:O,ownerState:k},N,{children:[null!=_&&""!==_&&(0,Wy.jsx)(Yx,(0,_n.Z)({htmlFor:B,id:j},m,{children:_})),P?(0,Wy.jsx)(DS,(0,_n.Z)({"aria-describedby":U,id:B,labelId:j,value:D,input:G},R,{children:o})):G,p&&(0,Wy.jsx)(cb,(0,_n.Z)({id:U},h,{children:p}))]}))})),BS=zS,US=["localeText"],jS=e.createContext(null),VS=function(t){const{localeText:n}=t,r=(0,My.Z)(t,US),{utils:i,localeText:o}=e.useContext(jS)??{utils:void 0,localeText:void 0},s=(0,Ry.Z)({props:r,name:"MuiLocalizationProvider"}),{children:a,dateAdapter:l,dateFormats:c,dateLibInstance:u,adapterLocale:h,localeText:d}=s,p=e.useMemo((()=>(0,_n.Z)({},d,o,n)),[d,o,n]),f=e.useMemo((()=>{if(!l)return i||null;const e=new l({locale:h,formats:c,instance:u});if(!e.isMUIAdapter)throw new Error(["MUI X: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/getting-started/#installation"].join("\n"));return e}),[l,h,c,u,i]),m=e.useMemo((()=>f?{minDate:f.date("1900-01-01T00:00:00.000"),maxDate:f.date("2099-12-31T00:00:00.000")}:null),[f]),g=e.useMemo((()=>({utils:f,defaultDates:m,localeText:p})),[m,f,p]);return(0,Wy.jsx)(jS.Provider,{value:g,children:a})},GS={previousMonth:"Previous month",nextMonth:"Next month",openPreviousView:"Open previous view",openNextView:"Open next view",calendarViewSwitchingButtonAriaLabel:e=>"year"===e?"year view is open, switch to calendar view":"calendar view is open, switch to year view",start:"Start",end:"End",startDate:"Start date",startTime:"Start time",endDate:"End date",endTime:"End time",cancelButtonLabel:"Cancel",clearButtonLabel:"Clear",okButtonLabel:"OK",todayButtonLabel:"Today",datePickerToolbarTitle:"Select date",dateTimePickerToolbarTitle:"Select date & time",timePickerToolbarTitle:"Select time",dateRangePickerToolbarTitle:"Select date range",clockLabelText:(e,t,n)=>`Select ${e}. ${null===t?"No time selected":`Selected time is ${n.format(t,"fullTime")}`}`,hoursClockNumberText:e=>`${e} hours`,minutesClockNumberText:e=>`${e} minutes`,secondsClockNumberText:e=>`${e} seconds`,selectViewText:e=>`Select ${e}`,calendarWeekNumberHeaderLabel:"Week number",calendarWeekNumberHeaderText:"#",calendarWeekNumberAriaLabelText:e=>`Week ${e}`,calendarWeekNumberText:e=>`${e}`,openDatePickerDialogue:(e,t)=>null!==e&&t.isValid(e)?`Choose date, selected date is ${t.format(e,"fullDate")}`:"Choose date",openTimePickerDialogue:(e,t)=>null!==e&&t.isValid(e)?`Choose time, selected time is ${t.format(e,"fullTime")}`:"Choose time",fieldClearLabel:"Clear value",timeTableLabel:"pick time",dateTableLabel:"pick date",fieldYearPlaceholder:e=>"Y".repeat(e.digitAmount),fieldMonthPlaceholder:e=>"letter"===e.contentType?"MMMM":"MM",fieldDayPlaceholder:()=>"DD",fieldWeekDayPlaceholder:e=>"letter"===e.contentType?"EEEE":"EE",fieldHoursPlaceholder:()=>"hh",fieldMinutesPlaceholder:()=>"mm",fieldSecondsPlaceholder:()=>"ss",fieldMeridiemPlaceholder:()=>"aa",year:"Year",month:"Month",day:"Day",weekDay:"Week day",hours:"Hours",minutes:"Minutes",seconds:"Seconds",meridiem:"Meridiem",empty:"Empty"},HS=GS;var ZS;ZS=GS,(0,_n.Z)({},ZS);const WS=()=>{const t=e.useContext(jS);if(null===t)throw new Error(["MUI X: Can not find the date and time pickers localization context.","It looks like you forgot to wrap your component in LocalizationProvider.","This can also happen if you are bundling multiple versions of the `@mui/x-date-pickers` package"].join("\n"));if(null===t.utils)throw new Error(["MUI X: Can not find the date and time pickers adapter from its localization context.","It looks like you forgot to pass a `dateAdapter` to your LocalizationProvider."].join("\n"));const n=e.useMemo((()=>(0,_n.Z)({},HS,t.localeText)),[t.localeText]);return e.useMemo((()=>(0,_n.Z)({},t,{localeText:n})),[t,n])},$S=()=>WS().utils,qS=()=>WS().defaultDates,XS=()=>WS().localeText,YS=t=>{const n=$S(),r=e.useRef();return void 0===r.current&&(r.current=n.date(void 0,t)),r.current};function KS(t,n,r,i){const{value:o,onError:s}=t,a=WS(),l=e.useRef(i),c=n({adapter:a,value:o,props:t});return e.useEffect((()=>{s&&!r(c,l.current)&&s(c,o),l.current=c}),[r,s,l,c,o]),c}var JS=i(9511);const QS=(e,t,n,r,i)=>{switch(r.type){case"year":return n.fieldYearPlaceholder({digitAmount:e.formatByString(e.date(void 0,t),i).length,format:i});case"month":return n.fieldMonthPlaceholder({contentType:r.contentType,format:i});case"day":return n.fieldDayPlaceholder({format:i});case"weekDay":return n.fieldWeekDayPlaceholder({contentType:r.contentType,format:i});case"hours":return n.fieldHoursPlaceholder({format:i});case"minutes":return n.fieldMinutesPlaceholder({format:i});case"seconds":return n.fieldSecondsPlaceholder({format:i});case"meridiem":return n.fieldMeridiemPlaceholder({format:i});default:return i}},eM=e=>{let{utils:t,timezone:n,date:r,shouldRespectLeadingZeros:i,localeText:o,localizedDigits:s,now:a,token:l,startSeparator:c}=e;if(""===l)throw new Error("MUI X: Should not call `commitToken` with an empty token");const u=p_(t,l),h=E_(t,n,u.contentType,u.type,l),d=i?h:"digit"===u.contentType,p=null!=r&&t.isValid(r);let f=p?t.formatByString(r,l):"",m=null;if(d)if(h)m=""===f?t.formatByString(a,l).length:f.length;else{if(null==u.maxLength)throw new Error(`MUI X: The token ${l} should have a 'maxDigitNumber' property on it's adapter`);m=u.maxLength,p&&(f=v_(x_(y_(f,s),m),s))}return(0,_n.Z)({},u,{format:l,maxLength:m,value:f,placeholder:QS(t,n,o,u,l),hasLeadingZerosInFormat:h,hasLeadingZerosInInput:d,startSeparator:c,endSeparator:"",modified:!1})},tM=e=>{let t=(e=>{let{utils:t,format:n}=e,r=10,i=n,o=t.expandFormat(n);for(;o!==i;)if(i=o,o=t.expandFormat(i),r-=1,r<0)throw new Error("MUI X: The format expansion seems to be in an infinite loop. Please open an issue with the format passed to the picker component.");return o})(e);e.isRTL&&e.enableAccessibleFieldDOMStructure&&(t=t.split(" ").reverse().join(" "));const n=(e=>{let{utils:t,expandedFormat:n}=e;const r=[],{start:i,end:o}=t.escapedCharacters,s=new RegExp(`(\\${i}[^\\${o}]*\\${o})+`,"g");let a=null;for(;a=s.exec(n);)r.push({start:a.index,end:s.lastIndex-1});return r})((0,_n.Z)({},e,{expandedFormat:t})),r=(e=>{const{utils:t,expandedFormat:n,escapedParts:r}=e,i=t.date(void 0),o=[];let s="";const a=Object.keys(t.formatTokenMap).sort(((e,t)=>t.length-e.length)),l=/^([a-zA-Z]+)/,c=new RegExp(`^(${a.join("|")})*$`),u=new RegExp(`^(${a.join("|")})`),h=e=>r.find((t=>t.start<=e&&t.end>=e));let d=0;for(;d<n.length;){const t=h(d),r=null!=t,a=l.exec(n.slice(d))?.[1];if(!r&&null!=a&&c.test(a)){let t=a;for(;t.length>0;){const n=u.exec(t)[1];t=t.slice(n.length),o.push(eM((0,_n.Z)({},e,{now:i,token:n,startSeparator:s}))),s=""}d+=a.length}else{const e=n[d];r&&t?.start===d||t?.end===d||(0===o.length?s+=e:o[o.length-1].endSeparator+=e),d+=1}}return 0===o.length&&s.length>0&&o.push({type:"empty",contentType:"letter",maxLength:null,format:"",value:"",placeholder:"",hasLeadingZerosInFormat:!1,hasLeadingZerosInInput:!1,startSeparator:s,endSeparator:"",modified:!1}),o})((0,_n.Z)({},e,{expandedFormat:t,escapedParts:n}));return(e=>{let{isRTL:t,formatDensity:n,sections:r}=e;return r.map((e=>{const r=e=>{let r=e;return t&&null!==r&&r.includes(" ")&&(r=`${r}`),"spacious"===n&&["/",".","-"].includes(r)&&(r=` ${r} `),r};return e.startSeparator=r(e.startSeparator),e.endSeparator=r(e.endSeparator),e}))})((0,_n.Z)({},e,{sections:r}))},nM=t=>{let{timezone:n,value:r,defaultValue:i,onChange:o,valueManager:s}=t;const a=$S(),l=e.useRef(i),c=r??l.current??s.emptyValue,u=e.useMemo((()=>s.getTimezone(a,c)),[a,s,c]),h=(0,tw.Z)((e=>null==u?e:s.setTimezone(a,u,e))),d=n??u??"default";return{value:e.useMemo((()=>s.setTimezone(a,d,c)),[s,a,d,c]),handleValueChange:(0,tw.Z)((function(e){const t=h(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];o?.(t,...r)})),timezone:d}},rM=e=>{let{name:t,timezone:n,value:r,defaultValue:i,onChange:o,valueManager:s}=e;const[a,l]=(0,JS.Z)({name:t,state:"value",controlled:r,default:i??s.emptyValue}),c=(0,tw.Z)((function(e){l(e);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];o?.(e,...n)}));return nM({timezone:n,value:a,defaultValue:void 0,onChange:c,valueManager:s})},iM=e=>null!=e.saveQuery,oM=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).activeElement;return e?e.shadowRoot?oM(e.shadowRoot):e:null},sM="@media (pointer: fine)",aM=t=>{const{internalProps:{disabled:n,readOnly:r=!1},forwardedProps:{sectionListRef:i,onBlur:o,onClick:s,onFocus:a,onInput:l,onPaste:c,focused:u,autoFocus:h=!1},fieldValueManager:d,applyCharacterEditing:p,resetCharacterQuery:f,setSelectedSections:m,parsedSelectedSections:g,state:y,clearActiveSection:v,clearValue:_,updateSectionValue:x,updateValueFromValueStr:b,sectionOrder:w,areAllSectionsEmpty:S,sectionsValueBoundaries:M}=t,E=e.useRef(null),T=(0,F_.Z)(i,E),C=XS(),A=$S(),I=(0,O_.Z)(),[P,R]=e.useState(!1),L=e.useMemo((()=>({syncSelectionToDOM:()=>{if(!E.current)return;const e=document.getSelection();if(!e)return;if(null==g)return e.rangeCount>0&&E.current.getRoot().contains(e.getRangeAt(0).startContainer)&&e.removeAllRanges(),void(P&&E.current.getRoot().blur());if(!E.current.getRoot().contains(oM(document)))return;const t=new window.Range;let n;n="all"===g?E.current.getRoot():"empty"===y.sections[g].type?E.current.getSectionContainer(g):E.current.getSectionContent(g),t.selectNodeContents(n),n.focus(),e.removeAllRanges(),e.addRange(t)},getActiveSectionIndexFromDOM:()=>{const e=oM(document);return e&&E.current&&E.current.getRoot().contains(e)?E.current.getSectionIndexFromDOMElement(e):null},focusField:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!E.current)return;const t=A_(e,y.sections);R(!0),E.current.getSectionContent(t).focus()},setSelectedSections:e=>{if(!E.current)return;const t=A_(e,y.sections);R(null!==("all"===t?0:t)),m(e)},isFieldFocused:()=>{const e=oM(document);return!!E.current&&E.current.getRoot().contains(e)}})),[g,m,y.sections,P]),D=(0,tw.Z)((e=>{if(!E.current)return;const t=y.sections[e];E.current.getSectionContent(e).innerHTML=t.value||t.placeholder,L.syncSelectionToDOM()})),O=(0,tw.Z)((function(e){if(!e.isDefaultPrevented()&&E.current){R(!0);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];s?.(e,...n),"all"===g?setTimeout((()=>{const e=document.getSelection().getRangeAt(0).startOffset;if(0===e)return void m(w.startIndex);let t=0,n=0;for(;n<e&&t<y.sections.length;){const e=y.sections[t];t+=1,n+=`${e.startSeparator}${e.value||e.placeholder}${e.endSeparator}`.length}m(t-1)})):P?E.current.getRoot().contains(e.target)||m(w.startIndex):(R(!0),m(w.startIndex))}})),N=(0,tw.Z)((e=>{if(l?.(e),!E.current||"all"!==g)return;const t=e.target.textContent??"";E.current.getRoot().innerHTML=y.sections.map((e=>`${e.startSeparator}${e.value||e.placeholder}${e.endSeparator}`)).join(""),L.syncSelectionToDOM(),0===t.length||10===t.charCodeAt(0)?(f(),_(),m("all")):t.length>1?b(t):p({keyPressed:t,sectionIndex:0})})),k=(0,tw.Z)((e=>{if(c?.(e),r||"all"!==g)return void e.preventDefault();const t=e.clipboardData.getData("text");e.preventDefault(),f(),b(t)})),F=(0,tw.Z)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a?.(...t),!P&&E.current&&(R(!0),null!=E.current.getSectionIndexFromDOMElement(oM(document))||m(w.startIndex))})),z=(0,tw.Z)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];o?.(...t),setTimeout((()=>{if(!E.current)return;const e=oM(document);!E.current.getRoot().contains(e)&&(R(!1),m(null))}))})),B=(0,tw.Z)((e=>t=>{t.isDefaultPrevented()||r||m(e)})),U=(0,tw.Z)((e=>{e.preventDefault()})),j=(0,tw.Z)((e=>()=>{r||m(e)})),V=(0,tw.Z)((e=>{if(e.preventDefault(),r||"number"!=typeof g)return;const t=y.sections[g],n=e.clipboardData.getData("text"),i=/^[a-zA-Z]+$/.test(n),o=/^[0-9]+$/.test(n),s=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(n);"letter"===t.contentType&&i||"digit"===t.contentType&&o||"digit-with-letter"===t.contentType&&s?(f(),x({activeSection:t,newSectionValue:n,shouldGoToNextSection:!0})):i||o||(f(),b(n))})),G=(0,tw.Z)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"})),H=(0,tw.Z)((e=>{if(!E.current)return;const t=e.target,n=t.textContent??"",i=E.current.getSectionIndexFromDOMElement(t),o=y.sections[i];if(!r&&E.current){if(0===n.length){if(""===o.value)return void D(i);const t=e.nativeEvent.inputType;return"insertParagraph"===t||"insertLineBreak"===t?void D(i):(f(),void v())}p({keyPressed:n,sectionIndex:i}),D(i)}else D(i)}));(0,Cv.Z)((()=>{if(P&&E.current)if("all"===g)E.current.getRoot().focus();else if("number"==typeof g){const e=E.current.getSectionContent(g);e&&e.focus()}}),[g,P]);const Z=e.useMemo((()=>y.sections.reduce(((e,t)=>(e[t.type]=M[t.type]({currentDate:null,contentType:t.contentType,format:t.format}),e)),{})),[M,y.sections]),W="all"===g,$=e.useMemo((()=>y.sections.map(((t,i)=>{const o=!W&&!n&&!r;return{container:{"data-sectionindex":i,onClick:B(i)},content:{tabIndex:W||i>0?-1:0,contentEditable:!W&&!n&&!r,role:"spinbutton",id:`${I}-${t.type}`,"aria-labelledby":`${I}-${t.type}`,"aria-readonly":r,"aria-valuenow":P_(t,A),"aria-valuemin":Z[t.type].minimum,"aria-valuemax":Z[t.type].maximum,"aria-valuetext":t.value?I_(t,A):C.empty,"aria-label":C[t.type],"aria-disabled":n,spellCheck:!o&&void 0,autoCapitalize:o?"off":void 0,autoCorrect:o?"off":void 0,[parseInt(e.version,10)>=17?"enterKeyHint":"enterkeyhint"]:o?"next":void 0,children:t.value||t.placeholder,onInput:H,onPaste:V,onFocus:j(i),onDragOver:G,onMouseUp:U,inputMode:"letter"===t.contentType?"text":"numeric"},before:{children:t.startSeparator},after:{children:t.endSeparator}}}))),[y.sections,j,V,G,H,B,U,n,r,W,C,A,Z,I]),q=(0,tw.Z)((e=>{b(e.target.value)})),X=e.useMemo((()=>S?"":d.getV7HiddenInputValueFromSections(y.sections)),[S,y.sections,d]);return e.useEffect((()=>{if(null==E.current)throw new Error(["MUI X: The `sectionListRef` prop has not been initialized by `PickersSectionList`","You probably tried to pass a component to the `textField` slot that contains an `<input />` element instead of a `PickersSectionList`.","","If you want to keep using an `<input />` HTML element for the editing, please remove the `enableAccessibleFieldDOMStructure` prop from your picker or field component:","","<DatePicker slots={{ textField: MyCustomTextField }} />","","Learn more about the field accessible DOM structure on the MUI documentation: https://mui.com/x/react-date-pickers/fields/#fields-to-edit-a-single-element"].join("\n"));h&&E.current&&E.current.getSectionContent(w.startIndex).focus()}),[]),{interactions:L,returnedValue:{autoFocus:h,readOnly:r,focused:u??P,sectionListRef:T,onBlur:z,onClick:O,onFocus:F,onInput:N,onPaste:k,enableAccessibleFieldDOMStructure:!0,elements:$,tabIndex:0===g?-1:0,contentEditable:W,value:X,onChange:q,areAllSectionsEmpty:S}}},lM=e=>e.replace(/[\u2066\u2067\u2068\u2069]/g,""),cM=t=>{const n="rtl"===Zb().direction,r=e.useRef(),{forwardedProps:{onFocus:i,onClick:o,onPaste:s,onBlur:a,inputRef:l,placeholder:c},internalProps:{readOnly:u=!1},parsedSelectedSections:h,activeSectionIndex:d,state:p,fieldValueManager:f,valueManager:m,applyCharacterEditing:g,resetCharacterQuery:y,updateSectionValue:v,updateValueFromValueStr:_,clearActiveSection:x,clearValue:b,setTempAndroidValueStr:w,setSelectedSections:S,getSectionsFromValue:M,areAllSectionsEmpty:E,localizedDigits:T}=t,C=e.useRef(null),A=(0,F_.Z)(l,C),I=e.useMemo((()=>((e,t,n)=>{let r=0,i=n?1:0;const o=[];for(let s=0;s<e.length;s+=1){const a=e[s],l=w_(a,n?"input-rtl":"input-ltr",t),c=`${a.startSeparator}${l}${a.endSeparator}`,u=lM(c).length,h=c.length,d=lM(l),p=i+(""===d?0:l.indexOf(d[0]))+a.startSeparator.length,f=p+d.length;o.push((0,_n.Z)({},a,{start:r,end:r+u,startInInput:p,endInInput:f})),r+=u,i+=h}return o})(p.sections,T,n)),[p.sections,T,n]),P=e.useMemo((()=>({syncSelectionToDOM:()=>{if(!C.current)return;if(null==h)return void(C.current.scrollLeft&&(C.current.scrollLeft=0));if(C.current!==oM(document))return;const e=C.current.scrollTop;if("all"===h)C.current.select();else{const e=I[h],t="empty"===e.type?e.startInInput-e.startSeparator.length:e.startInInput,n="empty"===e.type?e.endInInput+e.endSeparator.length:e.endInInput;t===C.current.selectionStart&&n===C.current.selectionEnd||C.current===oM(document)&&C.current.setSelectionRange(t,n)}C.current.scrollTop=e},getActiveSectionIndexFromDOM:()=>{const e=C.current.selectionStart??0,t=C.current.selectionEnd??0,n=!!C.current?.readOnly;if(0===e&&0===t||n)return null;const r=e<=I[0].startInInput?1:I.findIndex((t=>t.startInInput-t.startSeparator.length>e));return-1===r?I.length-1:r-1},focusField:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;C.current?.focus(),S(e)},setSelectedSections:e=>S(e),isFieldFocused:()=>C.current===oM(document)})),[C,h,I,S]),R=()=>{if(u)return void S(null);const e=C.current.selectionStart??0;let t;t=e<=I[0].startInInput||e>=I[I.length-1].endInInput?1:I.findIndex((t=>t.startInInput-t.startSeparator.length>e));const n=-1===t?I.length-1:t-1;S(n)},L=(0,tw.Z)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i?.(...t);const o=C.current;clearTimeout(r.current),r.current=setTimeout((()=>{o&&o===C.current&&(null!=d||u||(o.value.length&&Number(o.selectionEnd)-Number(o.selectionStart)===o.value.length?S("all"):R()))}))})),D=(0,tw.Z)((function(e){if(!e.isDefaultPrevented()){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];o?.(e,...n),R()}})),O=(0,tw.Z)((e=>{if(s?.(e),e.preventDefault(),u)return;const t=e.clipboardData.getData("text");if("number"==typeof h){const e=p.sections[h],n=/^[a-zA-Z]+$/.test(t),r=/^[0-9]+$/.test(t),i=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(t);if("letter"===e.contentType&&n||"digit"===e.contentType&&r||"digit-with-letter"===e.contentType&&i)return y(),void v({activeSection:e,newSectionValue:t,shouldGoToNextSection:!0});if(n||r)return}y(),_(t)})),N=(0,tw.Z)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a?.(...t),S(null)})),k=(0,tw.Z)((e=>{if(u)return;const t=e.target.value;if(""===t)return y(),void b();const r=e.nativeEvent.data,i=r&&r.length>1,o=i?r:t,s=lM(o);if(null==d||i)return void _(i?r:s);let a;if("all"===h&&1===s.length)a=s;else{const e=lM(f.getV6InputValueFromSections(I,T,n));let t=-1,r=-1;for(let n=0;n<e.length;n+=1)-1===t&&e[n]!==s[n]&&(t=n),-1===r&&e[e.length-n-1]!==s[s.length-n-1]&&(r=n);const i=I[d];if(t<i.start||e.length-r-1>i.end)return;const o=s.length-e.length+i.end-lM(i.endSeparator||"").length;a=s.slice(i.start+lM(i.startSeparator||"").length,o)}0!==a.length?g({keyPressed:a,sectionIndex:d}):navigator.userAgent.toLowerCase().indexOf("android")>-1?w(o):(y(),x())})),F=e.useMemo((()=>void 0!==c?c:f.getV6InputValueFromSections(M(m.emptyValue),T,n)),[c,f,M,m.emptyValue,T,n]),z=e.useMemo((()=>p.tempValueStrAndroid??f.getV6InputValueFromSections(p.sections,T,n)),[p.sections,f,p.tempValueStrAndroid,T,n]);e.useEffect((()=>(C.current&&C.current===oM(document)&&S("all"),()=>{clearTimeout(r.current)})),[]);const B=e.useMemo((()=>null==d||"letter"===p.sections[d].contentType?"text":"numeric"),[d,p.sections]),U=C.current&&C.current===oM(document);return{interactions:P,returnedValue:{readOnly:u,onBlur:N,onClick:D,onFocus:L,onPaste:O,inputRef:A,enableAccessibleFieldDOMStructure:!1,placeholder:F,inputMode:B,autoComplete:"off",value:!U&&E?"":z,onChange:k}}},uM=e=>{let{props:t,value:n,adapter:r}=e;if(null===n)return null;const{shouldDisableDate:i,shouldDisableMonth:o,shouldDisableYear:s,disablePast:a,disableFuture:l,timezone:c}=t,u=r.utils.date(void 0,c),h=qv(r.utils,t.minDate,r.defaultDates.minDate),d=qv(r.utils,t.maxDate,r.defaultDates.maxDate);switch(!0){case!r.utils.isValid(n):return"invalidDate";case Boolean(i&&i(n)):return"shouldDisableDate";case Boolean(o&&o(n)):return"shouldDisableMonth";case Boolean(s&&s(n)):return"shouldDisableYear";case Boolean(l&&r.utils.isAfterDay(n,u)):return"disableFuture";case Boolean(a&&r.utils.isBeforeDay(n,u)):return"disablePast";case Boolean(h&&r.utils.isBeforeDay(n,h)):return"minDate";case Boolean(d&&r.utils.isAfterDay(n,d)):return"maxDate";default:return null}},hM=e=>{let{props:t,value:n,adapter:r}=e;const i=uM({adapter:r,value:n,props:t});return null!==i?i:(e=>{let{adapter:t,value:n,props:r}=e;if(null===n)return null;const{minTime:i,maxTime:o,minutesStep:s,shouldDisableTime:a,disableIgnoringDatePartForTimeValidation:l=!1,disablePast:c,disableFuture:u,timezone:h}=r,d=t.utils.date(void 0,h),p=c_(l,t.utils);switch(!0){case!t.utils.isValid(n):return"invalidDate";case Boolean(i&&p(i,n)):return"minTime";case Boolean(o&&p(n,o)):return"maxTime";case Boolean(u&&t.utils.isAfter(n,d)):return"disableFuture";case Boolean(c&&t.utils.isBefore(n,d)):return"disablePast";case Boolean(a&&a(n,"hours")):return"shouldDisableTime-hours";case Boolean(a&&a(n,"minutes")):return"shouldDisableTime-minutes";case Boolean(a&&a(n,"seconds")):return"shouldDisableTime-seconds";case Boolean(s&&t.utils.getMinutes(n)%s!=0):return"minutesStep";default:return null}})({adapter:r,value:n,props:t})},dM=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],pM=["disablePast","disableFuture","minTime","maxTime","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],fM=["minDateTime","maxDateTime"],mM=[...dM,...pM,...fM],gM=e=>mM.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{}),yM=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef","enableAccessibleFieldDOMStructure","disabled","readOnly","dateSeparator"],vM=t=>{const n=(e=>{const t=$S(),n=qS(),r=e.ampm??t.is12HourCycleInCurrentLocale()?t.formats.keyboardDateTime12h:t.formats.keyboardDateTime24h;return(0,_n.Z)({},e,{disablePast:e.disablePast??!1,disableFuture:e.disableFuture??!1,format:e.format??r,disableIgnoringDatePartForTimeValidation:Boolean(e.minDateTime||e.maxDateTime),minDate:qv(t,e.minDateTime??e.minDate,n.minDate),maxDate:qv(t,e.maxDateTime??e.maxDate,n.maxDate),minTime:e.minDateTime??e.minTime,maxTime:e.maxDateTime??e.maxTime})})(t),{forwardedProps:r,internalProps:i}=((e,t)=>{const n=(0,_n.Z)({},e),r={},i=e=>{n.hasOwnProperty(e)&&(r[e]=n[e],delete n[e])};return yM.forEach(i),dM.forEach(i),pM.forEach(i),fM.forEach(i),{forwardedProps:n,internalProps:r}})(n);return(t=>{const n=$S(),{internalProps:r,internalProps:{unstableFieldRef:i,minutesStep:o,enableAccessibleFieldDOMStructure:s=!1,disabled:a=!1,readOnly:l=!1},forwardedProps:{onKeyDown:c,error:u,clearable:h,onClear:d},fieldValueManager:p,valueManager:f,validator:m}=t,g="rtl"===Zb().direction,y=(t=>{const n=$S(),r=XS(),i=WS(),o="rtl"===Zb().direction,{valueManager:s,fieldValueManager:a,valueType:l,validator:c,internalProps:u,internalProps:{value:h,defaultValue:d,referenceDate:p,onChange:f,format:m,formatDensity:g="dense",selectedSections:y,onSelectedSectionsChange:v,shouldRespectLeadingZeros:_=!1,timezone:x,enableAccessibleFieldDOMStructure:b=!1}}=t,{timezone:w,value:S,handleValueChange:M}=nM({timezone:x,value:h,defaultValue:d,onChange:f,valueManager:s}),E=e.useMemo((()=>(e=>{const t=e.date(void 0);return"0"===e.formatByString(e.setSeconds(t,0),"s")?g_:Array.from({length:10}).map(((n,r)=>e.formatByString(e.setSeconds(t,r),"s")))})(n)),[n]),T=e.useMemo((()=>((e,t,n)=>{const r=e.date(void 0,n),i=e.endOfYear(r),o=e.endOfDay(r),{maxDaysInMonth:s,longestMonth:a}=Xv(e,r).reduce(((t,n)=>{const r=e.getDaysInMonth(n);return r>t.maxDaysInMonth?{maxDaysInMonth:r,longestMonth:n}:t}),{maxDaysInMonth:0,longestMonth:null});return{year:t=>{let{format:r}=t;return{minimum:0,maximum:M_(e,n,r)?9999:99}},month:()=>({minimum:1,maximum:e.getMonth(i)+1}),day:t=>{let{currentDate:n}=t;return{minimum:1,maximum:null!=n&&e.isValid(n)?e.getDaysInMonth(n):s,longestMonth:a}},weekDay:t=>{let{format:r,contentType:i}=t;if("digit"===i){const t=f_(e,n,r).map(Number);return{minimum:Math.min(...t),maximum:Math.max(...t)}}return{minimum:1,maximum:7}},hours:n=>{let{format:i}=n;const s=e.getHours(o);return y_(e.formatByString(e.endOfDay(r),i),t)!==s.toString()?{minimum:1,maximum:Number(y_(e.formatByString(e.startOfDay(r),i),t))}:{minimum:0,maximum:s}},minutes:()=>({minimum:0,maximum:e.getMinutes(o)}),seconds:()=>({minimum:0,maximum:e.getSeconds(o)}),meridiem:()=>({minimum:0,maximum:1}),empty:()=>({minimum:0,maximum:0})}})(n,E,w)),[n,E,w]),C=e.useCallback((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a.getSectionsFromValue(n,e,t,(e=>tM({utils:n,timezone:w,localeText:r,localizedDigits:E,format:m,date:e,formatDensity:g,shouldRespectLeadingZeros:_,enableAccessibleFieldDOMStructure:b,isRTL:o})))}),[a,m,r,E,o,_,n,g,w,b]),[A,I]=e.useState((()=>{const e=C(S),t={sections:e,value:S,referenceValue:s.emptyValue,tempValueStrAndroid:null},r=(e=>Math.max(...e.map((e=>h_[e.type]??1))))(e),i=s.getInitialReferenceValue({referenceDate:p,value:S,utils:n,props:u,granularity:r,timezone:w});return(0,_n.Z)({},t,{referenceValue:i})})),[P,R]=(0,JS.Z)({controlled:y,default:null,name:"useField",state:"selectedSections"}),L=e=>{R(e),v?.(e)},D=e.useMemo((()=>A_(P,A.sections)),[P,A.sections]),O="all"===D?0:D,N=e=>{let{value:t,referenceValue:r,sections:o}=e;if(I((e=>(0,_n.Z)({},e,{sections:o,value:t,referenceValue:r,tempValueStrAndroid:null}))),s.areValuesEqual(n,A.value,t))return;const a={validationError:c({adapter:i,value:t,props:(0,_n.Z)({},u,{value:t,timezone:w})})};M(t,a)},k=(e,t)=>{const n=[...A.sections];return n[e]=(0,_n.Z)({},n[e],{value:t,modified:!0}),n};return e.useEffect((()=>{const e=C(A.value);I((t=>(0,_n.Z)({},t,{sections:e})))}),[m,n.locale,o]),e.useEffect((()=>{let e;e=!s.areValuesEqual(n,A.value,S)||s.getTimezone(n,A.value)!==s.getTimezone(n,S),e&&I((e=>(0,_n.Z)({},e,{value:S,referenceValue:a.updateReferenceValue(n,S,e.referenceValue),sections:C(S)})))}),[S]),{state:A,activeSectionIndex:O,parsedSelectedSections:D,setSelectedSections:L,clearValue:()=>{N({value:s.emptyValue,referenceValue:A.referenceValue,sections:C(s.emptyValue)})},clearActiveSection:()=>{if(null==O)return;const e=A.sections[O],t=a.getActiveDateManager(n,A,e),r=t.getSections(A.sections).filter((e=>""!==e.value)).length===(""===e.value?0:1),i=k(O,""),o=r?null:n.getInvalidDate(),s=t.getNewValuesFromNewActiveDate(o);N((0,_n.Z)({},s,{sections:i}))},updateSectionValue:e=>{let{activeSection:t,newSectionValue:r,shouldGoToNextSection:i}=e;i&&O<A.sections.length-1&&L(O+1);const o=a.getActiveDateManager(n,A,t),s=k(O,r),l=o.getSections(s),c=((e,t,n)=>{const r=t.some((e=>"day"===e.type)),i=[],o=[];for(let e=0;e<t.length;e+=1){const s=t[e];r&&"weekDay"===s.type||(i.push(s.format),o.push(w_(s,"non-input",n)))}const s=i.join(" "),a=o.join(" ");return e.parse(a,s)})(n,l,E);let u,h;if(null!=c&&n.isValid(c)){const e=C_(n,w,c,l,o.referenceDate,!0);u=o.getNewValuesFromNewActiveDate(e),h=!0}else u=o.getNewValuesFromNewActiveDate(c),h=(null!=c&&!n.isValid(c))!=(null!=o.date&&!n.isValid(o.date));return h?N((0,_n.Z)({},u,{sections:s})):I((e=>(0,_n.Z)({},e,u,{sections:s,tempValueStrAndroid:null})))},updateValueFromValueStr:e=>{const t=a.parseValueStr(e,A.referenceValue,((e,t)=>{const i=n.parse(e,m);if(null==i||!n.isValid(i))return null;const s=tM({utils:n,timezone:w,localeText:r,localizedDigits:E,format:m,date:i,formatDensity:g,shouldRespectLeadingZeros:_,enableAccessibleFieldDOMStructure:b,isRTL:o});return C_(n,w,i,s,t,!1)})),i=a.updateReferenceValue(n,t,A.referenceValue);N({value:t,referenceValue:i,sections:C(t,A.sections)})},setTempAndroidValueStr:e=>I((t=>(0,_n.Z)({},t,{tempValueStrAndroid:e}))),getSectionsFromValue:C,sectionsValueBoundaries:T,localizedDigits:E,timezone:w}})(t),{state:v,activeSectionIndex:_,parsedSelectedSections:x,setSelectedSections:b,clearValue:w,clearActiveSection:S,updateSectionValue:M,setTempAndroidValueStr:E,sectionsValueBoundaries:T,localizedDigits:C,timezone:A}=y,I=(t=>{let{sections:n,updateSectionValue:r,sectionsValueBoundaries:i,localizedDigits:o,setTempAndroidValueStr:s,timezone:a}=t;const l=$S(),[c,u]=e.useState(null),h=(0,tw.Z)((()=>u(null)));e.useEffect((()=>{null!=c&&n[c.sectionIndex]?.type!==c.sectionType&&h()}),[n,c,h]),e.useEffect((()=>{if(null!=c){const e=setTimeout((()=>h()),5e3);return()=>{clearTimeout(e)}}return()=>{}}),[c,h]);const d=(e,t,r)=>{let{keyPressed:i,sectionIndex:o}=e;const s=i.toLowerCase(),a=n[o];if(null!=c&&(!r||r(c.value))&&c.sectionIndex===o){const e=`${c.value}${s}`,n=t(e,a);if(!iM(n))return u({sectionIndex:o,value:e,sectionType:a.type}),n}const l=t(s,a);return iM(l)&&!l.saveQuery?(h(),null):(u({sectionIndex:o,value:s,sectionType:a.type}),iM(l)?null:l)};return{applyCharacterEditing:(0,tw.Z)((e=>{const t=n[e.sectionIndex],c=__(e.keyPressed,o)?(e=>{const t=(e,t)=>{const n=y_(e,o),r=Number(n),s=i[t.type]({currentDate:null,format:t.format,contentType:t.contentType});if(r>s.maximum)return{saveQuery:!1};if(r<s.minimum)return{saveQuery:!0};const a=10*r>s.maximum||n.length===s.maximum.toString().length;return{sectionValue:b_(l,r,s,o,t),shouldGoToNextSection:a}};return d(e,((e,n)=>{if("digit"===n.contentType||"digit-with-letter"===n.contentType)return t(e,n);if("month"===n.type){const r=E_(l,a,"digit","month","MM"),i=t(e,{type:n.type,format:"MM",hasLeadingZerosInFormat:r,hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(iM(i))return i;const o=S_(l,i.sectionValue,"MM",n.format);return(0,_n.Z)({},i,{sectionValue:o})}if("weekDay"===n.type){const r=t(e,n);if(iM(r))return r;const i=f_(l,a,n.format)[Number(r.sectionValue)-1];return(0,_n.Z)({},r,{sectionValue:i})}return{saveQuery:!1}}),(e=>__(e,o)))})((0,_n.Z)({},e,{keyPressed:v_(e.keyPressed,o)})):(e=>{const t=(e,t,n)=>{const r=t.filter((e=>e.toLowerCase().startsWith(n)));return 0===r.length?{saveQuery:!1}:{sectionValue:r[0],shouldGoToNextSection:1===r.length}},n=(e,n,r,i)=>{const o=e=>m_(l,a,n.type,e);if("letter"===n.contentType)return t(n.format,o(n.format),e);if(r&&null!=i&&"letter"===p_(l,r).contentType){const n=o(r),s=t(0,n,e);return iM(s)?{saveQuery:!1}:(0,_n.Z)({},s,{sectionValue:i(s.sectionValue,n)})}return{saveQuery:!1}};return d(e,((e,t)=>{switch(t.type){case"month":{const r=e=>S_(l,e,l.formats.month,t.format);return n(e,t,l.formats.month,r)}case"weekDay":{const r=(e,t)=>t.indexOf(e).toString();return n(e,t,l.formats.weekday,r)}case"meridiem":return n(e,t);default:return{saveQuery:!1}}}))})(e);null!=c?r({activeSection:t,newSectionValue:c.sectionValue,shouldGoToNextSection:c.shouldGoToNextSection}):s(null)})),resetCharacterQuery:h}})({sections:v.sections,updateSectionValue:M,sectionsValueBoundaries:T,localizedDigits:C,setTempAndroidValueStr:E,timezone:A}),{resetCharacterQuery:P}=I,R=f.areValuesEqual(n,v.value,f.emptyValue),L=s?aM:cM,D=e.useMemo((()=>((e,t)=>{const n={};if(!t)return e.forEach(((t,r)=>{const i=0===r?null:r-1,o=r===e.length-1?null:r+1;n[r]={leftIndex:i,rightIndex:o}})),{neighbors:n,startIndex:0,endIndex:e.length-1};const r={},i={};let o=0,s=0,a=e.length-1;for(;a>=0;){s=e.findIndex(((e,t)=>t>=o&&e.endSeparator?.includes(" ")&&" / "!==e.endSeparator)),-1===s&&(s=e.length-1);for(let e=s;e>=o;e-=1)i[e]=a,r[a]=e,a-=1;o=s+1}return e.forEach(((t,o)=>{const s=i[o],a=0===s?null:r[s-1],l=s===e.length-1?null:r[s+1];n[o]={leftIndex:a,rightIndex:l}})),{neighbors:n,startIndex:r[0],endIndex:r[e.length-1]}})(v.sections,g&&!s)),[v.sections,g,s]),{returnedValue:O,interactions:N}=L((0,_n.Z)({},t,y,I,{areAllSectionsEmpty:R,sectionOrder:D})),k=(0,tw.Z)((e=>{switch(c?.(e),!0){case(e.ctrlKey||e.metaKey)&&"a"===e.key.toLowerCase()&&!e.shiftKey&&!e.altKey:e.preventDefault(),b("all");break;case"ArrowRight"===e.key:if(e.preventDefault(),null==x)b(D.startIndex);else if("all"===x)b(D.endIndex);else{const e=D.neighbors[x].rightIndex;null!==e&&b(e)}break;case"ArrowLeft"===e.key:if(e.preventDefault(),null==x)b(D.endIndex);else if("all"===x)b(D.startIndex);else{const e=D.neighbors[x].leftIndex;null!==e&&b(e)}break;case"Delete"===e.key:if(e.preventDefault(),l)break;null==x||"all"===x?w():S(),P();break;case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(e.key):{if(e.preventDefault(),l||null==_)break;const t=v.sections[_],r=p.getActiveDateManager(n,v,t),i=((e,t,n,r,i,o,s,a)=>{const l=(e=>{switch(e){case"ArrowUp":return 1;case"ArrowDown":return-1;case"PageUp":return 5;case"PageDown":return-5;default:return 0}})(r),c="Home"===r,u="End"===r,h=""===n.value||c||u;return"digit"===n.contentType||"digit-with-letter"===n.contentType?(()=>{const r=i[n.type]({currentDate:s,format:n.format,contentType:n.contentType}),d=t=>b_(e,t,r,o,n),p="minutes"===n.type&&a?.minutesStep?a.minutesStep:1;let f=parseInt(y_(n.value,o),10)+l*p;if(h){if("year"===n.type&&!u&&!c)return e.formatByString(e.date(void 0,t),n.format);f=l>0||c?r.minimum:r.maximum}return f%p!=0&&((l<0||c)&&(f+=p-(p+f)%p),(l>0||u)&&(f-=f%p)),f>r.maximum?d(r.minimum+(f-r.maximum-1)%(r.maximum-r.minimum+1)):f<r.minimum?d(r.maximum-(r.minimum-f-1)%(r.maximum-r.minimum+1)):d(f)})():(()=>{const r=m_(e,t,n.type,n.format);if(0===r.length)return n.value;if(h)return l>0||c?r[0]:r[r.length-1];const i=r.indexOf(n.value);return r[(i+r.length+l)%r.length]})()})(n,A,t,e.key,T,C,r.date,{minutesStep:o});M({activeSection:t,newSectionValue:i,shouldGoToNextSection:!1});break}}}));(0,Cv.Z)((()=>{N.syncSelectionToDOM()}));const F=KS((0,_n.Z)({},r,{value:v.value,timezone:A}),m,f.isSameError,f.defaultErrorState),z=e.useMemo((()=>void 0!==u?u:f.hasError(F)),[f,F,u]);e.useEffect((()=>{z||null!=_||P()}),[v.referenceValue,_,z]),e.useEffect((()=>{null!=v.tempValueStrAndroid&&null!=_&&(P(),S())}),[v.sections]),e.useImperativeHandle(i,(()=>({getSections:()=>v.sections,getActiveSectionIndex:N.getActiveSectionIndexFromDOM,setSelectedSections:N.setSelectedSections,focusField:N.focusField,isFieldFocused:N.isFieldFocused})));const B={onKeyDown:k,onClear:(0,tw.Z)((function(e){e.preventDefault();for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];d?.(e,...n),w(),N.isFieldFocused()?b(D.startIndex):N.focusField(0)})),error:z,clearable:Boolean(h&&!R&&!l&&!a)},U={disabled:a,readOnly:l};return(0,_n.Z)({},t.forwardedProps,B,U,O)})({forwardedProps:r,internalProps:i,valueManager:L_,fieldValueManager:D_,validator:hM,valueType:"date-time"})};function _M(e){return(0,lv.ZP)("MuiIconButton",e)}const xM=(0,$y.Z)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),bM=["edge","children","className","color","disabled","disableFocusRipple","size"],wM=(0,Iy.ZP)(fv,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"default"!==n.color&&t[`color${(0,mv.Z)(n.color)}`],n.edge&&t[`edge${(0,mv.Z)(n.edge)}`],t[`size${(0,mv.Z)(n.size)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest})},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===n.edge&&{marginLeft:"small"===n.size?-3:-12},"end"===n.edge&&{marginRight:"small"===n.size?-3:-12})}),(e=>{let{theme:t,ownerState:n}=e;var r;const i=null==(r=(t.vars||t).palette)?void 0:r[n.color];return(0,_n.Z)({},"inherit"===n.color&&{color:"inherit"},"inherit"!==n.color&&"default"!==n.color&&(0,_n.Z)({color:null==i?void 0:i.main},!n.disableRipple&&{"&:hover":(0,_n.Z)({},i&&{backgroundColor:t.vars?`rgba(${i.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(i.main,t.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===n.size&&{padding:5,fontSize:t.typography.pxToRem(18)},"large"===n.size&&{padding:12,fontSize:t.typography.pxToRem(28)},{[`&.${xM.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}})})),SM=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiIconButton"}),{edge:r=!1,children:i,className:o,color:s="default",disabled:a=!1,disableFocusRipple:l=!1,size:c="medium"}=n,u=(0,My.Z)(n,bM),h=(0,_n.Z)({},n,{edge:r,color:s,disabled:a,disableFocusRipple:l,size:c}),d=(e=>{const{classes:t,disabled:n,color:r,edge:i,size:o}=e,s={root:["root",n&&"disabled","default"!==r&&`color${(0,mv.Z)(r)}`,i&&`edge${(0,mv.Z)(i)}`,`size${(0,mv.Z)(o)}`]};return(0,Cy.Z)(s,_M,t)})(h);return(0,Wy.jsx)(wM,(0,_n.Z)({className:(0,Ey.Z)(d.root,o),centerRipple:!0,focusRipple:!l,disabled:a,ref:t},u,{ownerState:h,children:i}))})),MM=SM;var EM=i(9028);function TM(e){return(0,lv.ZP)("MuiTypography",e)}(0,$y.Z)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const CM=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],AM=(0,Iy.ZP)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t[`align${(0,mv.Z)(n.align)}`],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({margin:0},"inherit"===n.variant&&{font:"inherit"},"inherit"!==n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),IM={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},PM={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},RM=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiTypography"}),r=(e=>PM[e]||e)(n.color),i=(0,EM.Z)((0,_n.Z)({},n,{color:r})),{align:o="inherit",className:s,component:a,gutterBottom:l=!1,noWrap:c=!1,paragraph:u=!1,variant:h="body1",variantMapping:d=IM}=i,p=(0,My.Z)(i,CM),f=(0,_n.Z)({},i,{align:o,color:r,className:s,component:a,gutterBottom:l,noWrap:c,paragraph:u,variant:h,variantMapping:d}),m=a||(u?"p":d[h]||IM[h])||"span",g=(e=>{const{align:t,gutterBottom:n,noWrap:r,paragraph:i,variant:o,classes:s}=e,a={root:["root",o,"inherit"!==e.align&&`align${(0,mv.Z)(t)}`,n&&"gutterBottom",r&&"noWrap",i&&"paragraph"]};return(0,Cy.Z)(a,TM,s)})(f);return(0,Wy.jsx)(AM,(0,_n.Z)({as:m,ref:t,ownerState:f,className:(0,Ey.Z)(g.root,s)},p))})),LM=RM;function DM(e){return(0,lv.ZP)("MuiInputAdornment",e)}const OM=(0,$y.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var NM;const kM=["children","className","component","disablePointerEvents","disableTypography","position","variant"],FM=(0,Iy.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`position${(0,mv.Z)(n.position)}`],!0===n.disablePointerEvents&&t.disablePointerEvents,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active},"filled"===n.variant&&{[`&.${OM.positionStart}&:not(.${OM.hiddenLabel})`]:{marginTop:16}},"start"===n.position&&{marginRight:8},"end"===n.position&&{marginLeft:8},!0===n.disablePointerEvents&&{pointerEvents:"none"})})),zM=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiInputAdornment"}),{children:i,className:o,component:s="div",disablePointerEvents:a=!1,disableTypography:l=!1,position:c,variant:u}=r,h=(0,My.Z)(r,kM),d=$_()||{};let p=u;u&&d.variant,d&&!p&&(p=d.variant);const f=(0,_n.Z)({},r,{hiddenLabel:d.hiddenLabel,size:d.size,disablePointerEvents:a,position:c,variant:p}),m=(e=>{const{classes:t,disablePointerEvents:n,hiddenLabel:r,position:i,size:o,variant:s}=e,a={root:["root",n&&"disablePointerEvents",i&&`position${(0,mv.Z)(i)}`,s,r&&"hiddenLabel",o&&`size${(0,mv.Z)(o)}`]};return(0,Cy.Z)(a,DM,t)})(f);return(0,Wy.jsx)(W_.Provider,{value:null,children:(0,Wy.jsx)(FM,(0,_n.Z)({as:s,ownerState:f,className:(0,Ey.Z)(m.root,o),ref:n},h,{children:"string"!=typeof i||l?(0,Wy.jsxs)(e.Fragment,{children:["start"===c?NM||(NM=(0,Wy.jsx)("span",{className:"notranslate",children:""})):null,i]}):(0,Wy.jsx)(LM,{color:"text.secondary",children:i})}))})})),BM=zM,UM=(0,MS.Z)((0,Wy.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),jM=(0,MS.Z)((0,Wy.jsx)("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"ArrowLeft"),VM=(0,MS.Z)((0,Wy.jsx)("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"ArrowRight"),GM=(0,MS.Z)((0,Wy.jsx)("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Calendar"),HM=((0,MS.Z)((0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),(0,Wy.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Clock"),(0,MS.Z)((0,Wy.jsx)("path",{d:"M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"}),"DateRange")),ZM=(0,MS.Z)((0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),(0,Wy.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Time"),WM=(0,MS.Z)((0,Wy.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),$M=["clearable","onClear","InputProps","sx","slots","slotProps"],qM=["ownerState"];function XM(e){return(0,lv.ZP)("MuiPickersTextField",e)}function YM(e){return(0,lv.ZP)("MuiPickersInputBase",e)}(0,$y.Z)("MuiPickersTextField",["root","focused","disabled","error","required"]);const KM=(0,$y.Z)("MuiPickersInputBase",["root","focused","disabled","error","notchedOutline","sectionContent","sectionBefore","sectionAfter","adornedStart","adornedEnd","input"]);function JM(e){return(0,lv.ZP)("MuiPickersOutlinedInput",e)}const QM=(0,_n.Z)({},KM,(0,$y.Z)("MuiPickersOutlinedInput",["root","notchedOutline","input"])),eE=["children","className","label","notched","shrink"],tE=(0,Iy.ZP)("fieldset",{name:"MuiPickersOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%",borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}})),nE=(0,Iy.ZP)("span")((e=>{let{theme:t}=e;return{fontFamily:t.typography.fontFamily,fontSize:"inherit"}})),rE=(0,Iy.ZP)("legend")((e=>{let{theme:t}=e;return{float:"unset",width:"auto",overflow:"hidden",variants:[{props:{withLabel:!1},style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:{withLabel:!0},style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:{withLabel:!0,notched:!0},style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]}}));function iE(e){const{className:t,label:n}=e,r=(0,My.Z)(e,eE),i=null!=n&&""!==n,o=(0,_n.Z)({},e,{withLabel:i});return(0,Wy.jsx)(tE,(0,_n.Z)({"aria-hidden":!0,className:t},r,{ownerState:o,children:(0,Wy.jsx)(rE,{ownerState:o,children:i?(0,Wy.jsx)(nE,{children:n}):(0,Wy.jsx)(nE,{className:"notranslate",children:""})})}))}var oE=i(1179);function sE(e){return(0,lv.ZP)("MuiPickersSectionList",e)}const aE=(0,$y.Z)("MuiPickersSectionList",["root","section","sectionContent"]),lE=["slots","slotProps","elements","sectionListRef"],cE=(0,Iy.ZP)("div",{name:"MuiPickersSectionList",slot:"Root",overridesResolver:(e,t)=>t.root})({direction:"ltr /*! @noflip */",outline:"none"}),uE=(0,Iy.ZP)("span",{name:"MuiPickersSectionList",slot:"Section",overridesResolver:(e,t)=>t.section})({}),hE=(0,Iy.ZP)("span",{name:"MuiPickersSectionList",slot:"SectionSeparator",overridesResolver:(e,t)=>t.sectionSeparator})({whiteSpace:"pre"}),dE=(0,Iy.ZP)("span",{name:"MuiPickersSectionList",slot:"SectionContent",overridesResolver:(e,t)=>t.sectionContent})({outline:"none"});function pE(e){const{slots:t,slotProps:n,element:r,classes:i}=e,o=t?.section??uE,s=gb({elementType:o,externalSlotProps:n?.section,externalForwardedProps:r.container,className:i.section,ownerState:{}}),a=t?.sectionContent??dE,l=gb({elementType:a,externalSlotProps:n?.sectionContent,externalForwardedProps:r.content,additionalProps:{suppressContentEditableWarning:!0},className:i.sectionContent,ownerState:{}}),c=t?.sectionSeparator??hE,u=gb({elementType:c,externalSlotProps:n?.sectionSeparator,externalForwardedProps:r.before,ownerState:{position:"before"}}),h=gb({elementType:c,externalSlotProps:n?.sectionSeparator,externalForwardedProps:r.after,ownerState:{position:"after"}});return(0,Wy.jsxs)(o,(0,_n.Z)({},s,{children:[(0,Wy.jsx)(c,(0,_n.Z)({},u)),(0,Wy.jsx)(a,(0,_n.Z)({},l)),(0,Wy.jsx)(c,(0,_n.Z)({},h))]}))}const fE=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiPickersSectionList"}),{slots:i,slotProps:o,elements:s,sectionListRef:a}=r,l=(0,My.Z)(r,lE),c=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],section:["section"],sectionContent:["sectionContent"]},sE,t)})(r),u=e.useRef(null),h=(0,F_.Z)(n,u),d=e=>{if(!u.current)throw new Error(`MUI X: Cannot call sectionListRef.${e} before the mount of the component.`);return u.current};e.useImperativeHandle(a,(()=>({getRoot:()=>d("getRoot"),getSectionContainer:e=>d("getSectionContainer").querySelector(`.${aE.section}[data-sectionindex="${e}"]`),getSectionContent:e=>d("getSectionContent").querySelector(`.${aE.section}[data-sectionindex="${e}"] .${aE.sectionContent}`),getSectionIndexFromDOMElement(e){const t=d("getSectionIndexFromDOMElement");if(null==e||!t.contains(e))return null;let n=null;return e.classList.contains(aE.section)?n=e:e.classList.contains(aE.sectionContent)&&(n=e.parentElement),null==n?null:Number(n.dataset.sectionindex)}})));const p=i?.root??cE,f=gb({elementType:p,externalSlotProps:o?.root,externalForwardedProps:l,additionalProps:{ref:h,suppressContentEditableWarning:!0},className:c.root,ownerState:{}});return(0,Wy.jsx)(p,(0,_n.Z)({},f,{children:f.contentEditable?s.map((e=>{let{content:t,before:n,after:r}=e;return`${n.children}${t.children}${r.children}`})).join(""):(0,Wy.jsx)(e.Fragment,{children:s.map(((e,t)=>(0,Wy.jsx)(pE,{slots:i,slotProps:o,element:e,classes:c},t)))})}))})),mE=["elements","areAllSectionsEmpty","defaultValue","label","value","onChange","id","autoFocus","endAdornment","startAdornment","renderSuffix","slots","slotProps","contentEditable","tabIndex","onInput","onPaste","onKeyDown","fullWidth","name","readOnly","inputProps","inputRef","sectionListRef"],gE=(0,Iy.ZP)("div",{name:"MuiPickersInputBase",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return(0,_n.Z)({},t.typography.body1,{color:(t.vars||t).palette.text.primary,cursor:"text",padding:0,display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",boxSizing:"border-box",letterSpacing:(.15/16,Math.round(937.5)/1e5+"em"),variants:[{props:{fullWidth:!0},style:{width:"100%"}}]})})),yE=(0,Iy.ZP)(cE,{name:"MuiPickersInputBase",slot:"SectionsContainer",overridesResolver:(e,t)=>t.sectionsContainer})((e=>{let{theme:t}=e;return(0,_n.Z)({padding:"4px 0 5px",fontFamily:t.typography.fontFamily,fontSize:"inherit",lineHeight:"1.4375em",flexGrow:1,outline:"none",display:"flex",flexWrap:"nowrap",overflow:"hidden",letterSpacing:"inherit",width:"182px"},"rtl"===t.direction&&{textAlign:"right /*! @noflip */"},{variants:[{props:{size:"small"},style:{paddingTop:1}},{props:{adornedStart:!1,focused:!1,filled:!1},style:{color:"currentColor",opacity:0}},{props:e=>{let{adornedStart:t,focused:n,filled:r,label:i}=e;return!t&&!n&&!r&&null==i},style:t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:"light"===t.palette.mode?.42:.5}}]})})),vE=(0,Iy.ZP)(uE,{name:"MuiPickersInputBase",slot:"Section",overridesResolver:(e,t)=>t.section})((e=>{let{theme:t}=e;return{fontFamily:t.typography.fontFamily,fontSize:"inherit",letterSpacing:"inherit",lineHeight:"1.4375em",display:"flex"}})),_E=(0,Iy.ZP)(dE,{name:"MuiPickersInputBase",slot:"SectionContent",overridesResolver:(e,t)=>t.content})((e=>{let{theme:t}=e;return{fontFamily:t.typography.fontFamily,lineHeight:"1.4375em",letterSpacing:"inherit",width:"fit-content",outline:"none"}})),xE=(0,Iy.ZP)(hE,{name:"MuiPickersInputBase",slot:"Separator",overridesResolver:(e,t)=>t.separator})((()=>({whiteSpace:"pre",letterSpacing:"inherit"}))),bE=(0,Iy.ZP)("input",{name:"MuiPickersInputBase",slot:"Input",overridesResolver:(e,t)=>t.hiddenInput})((0,_n.Z)({},{border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"})),wE=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiPickersInputBase"}),{elements:i,areAllSectionsEmpty:o,value:s,onChange:a,id:l,endAdornment:c,startAdornment:u,renderSuffix:h,slots:d,slotProps:p,contentEditable:f,tabIndex:m,onInput:g,onPaste:y,onKeyDown:v,name:_,readOnly:x,inputProps:b,inputRef:w,sectionListRef:S}=r,M=(0,My.Z)(r,mE),E=e.useRef(null),T=(0,F_.Z)(n,E),C=(0,F_.Z)(b?.ref,w),A=$_();if(!A)throw new Error("MUI X: PickersInputBase should always be used inside a PickersTextField component");e.useEffect((()=>{A&&A.setAdornedStart(Boolean(u))}),[A,u]),e.useEffect((()=>{A&&(o?A.onEmpty():A.onFilled())}),[A,o]);const I=(0,_n.Z)({},r,A),P=(e=>{const{focused:t,disabled:n,error:r,classes:i,fullWidth:o,readOnly:s,color:a,size:l,endAdornment:c,startAdornment:u}=e,h={root:["root",t&&!n&&"focused",n&&"disabled",s&&"readOnly",r&&"error",o&&"fullWidth",`color${(0,oE.Z)(a)}`,"small"===l&&"inputSizeSmall",Boolean(u)&&"adornedStart",Boolean(c)&&"adornedEnd"],notchedOutline:["notchedOutline"],input:["input"],sectionsContainer:["sectionsContainer"],sectionContent:["sectionContent"],sectionBefore:["sectionBefore"],sectionAfter:["sectionAfter"]};return(0,Cy.Z)(h,YM,i)})(I),R=d?.root||gE,L=gb({elementType:R,externalSlotProps:p?.root,externalForwardedProps:M,additionalProps:{"aria-invalid":A.error,ref:T},className:P.root,ownerState:I}),D=d?.input||yE;return(0,Wy.jsxs)(R,(0,_n.Z)({},L,{children:[u,(0,Wy.jsx)(fE,{sectionListRef:S,elements:i,contentEditable:f,tabIndex:m,className:P.sectionsContainer,onFocus:e=>{A.disabled?e.stopPropagation():A.onFocus?.(e)},onBlur:A.onBlur,onInput:g,onPaste:y,onKeyDown:v,slots:{root:D,section:vE,sectionContent:_E,sectionSeparator:xE},slotProps:{root:{ownerState:I},sectionContent:{className:KM.sectionContent},sectionSeparator:e=>{let{position:t}=e;return{className:"before"===t?KM.sectionBefore:KM.sectionAfter}}}}),c,h?h((0,_n.Z)({},A)):null,(0,Wy.jsx)(bE,(0,_n.Z)({name:_,className:P.input,value:s,onChange:a,id:l,"aria-hidden":"true",tabIndex:-1,readOnly:x,required:A.required,disabled:A.disabled},b,{ref:C}))]}))})),SE=["label","autoFocus","ownerState","notched"],ME=(0,Iy.ZP)(gE,{name:"MuiPickersOutlinedInput",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;const n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{padding:"0 14px",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${QM.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${QM.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:n}},[`&.${QM.focused} .${QM.notchedOutline}`]:{borderStyle:"solid",borderWidth:2},[`&.${QM.disabled}`]:{[`& .${QM.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled},"*":{color:(t.vars||t).palette.action.disabled}},[`&.${QM.error} .${QM.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},variants:Object.keys((t.vars??t).palette).filter((e=>(t.vars??t).palette[e]?.main??!1)).map((e=>({props:{color:e},style:{[`&.${QM.focused}:not(.${QM.error}) .${QM.notchedOutline}`]:{borderColor:(t.vars||t).palette[e].main}}})))}})),EE=(0,Iy.ZP)(yE,{name:"MuiPickersOutlinedInput",slot:"SectionsContainer",overridesResolver:(e,t)=>t.sectionsContainer})({padding:"16.5px 0",variants:[{props:{size:"small"},style:{padding:"8.5px 0"}}]}),TE=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiPickersOutlinedInput"}),{label:i,ownerState:o,notched:s}=r,a=(0,My.Z)(r,SE),l=$_(),c=(0,_n.Z)({},r,o,l,{color:l?.color||"primary"}),u=(e=>{const{classes:t}=e,n=(0,Cy.Z)({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},JM,t);return(0,_n.Z)({},t,n)})(c);return(0,Wy.jsx)(wE,(0,_n.Z)({slots:{root:ME,input:EE},renderSuffix:t=>(0,Wy.jsx)(iE,{shrink:Boolean(s||t.adornedStart||t.focused||t.filled),notched:Boolean(s||t.adornedStart||t.focused||t.filled),className:u.notchedOutline,label:null!=i&&""!==i&&l?.required?(0,Wy.jsxs)(e.Fragment,{children:[i,"","*"]}):i,ownerState:c})},a,{label:i,classes:u,ref:n}))}));TE.muiName="Input";var CE=i(4995),AE=i(1821),IE=i(3649);const PE=["ownerState"],RE=["variants"],LE=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function DE(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const OE=(0,AE.Z)(),NE=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function kE(e){let{defaultTheme:t,theme:n,themeId:r}=e;return i=n,0===Object.keys(i).length?t:n[r]||n;var i}function FE(e){return e?(t,n)=>n[e]:null}function zE(e,t){let{ownerState:n}=t,r=(0,My.Z)(t,PE);const i="function"==typeof e?e((0,_n.Z)({ownerState:n},r)):e;if(Array.isArray(i))return i.flatMap((e=>zE(e,(0,_n.Z)({ownerState:n},r))));if(i&&"object"==typeof i&&Array.isArray(i.variants)){const{variants:e=[]}=i;let t=(0,My.Z)(i,RE);return e.forEach((e=>{let i=!0;"function"==typeof e.props?i=e.props((0,_n.Z)({ownerState:n},r,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&r[t]!==e.props[t]&&(i=!1)})),i&&(Array.isArray(t)||(t=[t]),t.push("function"==typeof e.style?e.style((0,_n.Z)({ownerState:n},r,n)):e.style))})),t}return i}function BE(e){return(0,lv.ZP)("MuiPickersFilledInput",e)}const UE=(0,_n.Z)({},KM,(0,$y.Z)("MuiPickersFilledInput",["root","underline","input"])),jE=["label","autoFocus","disableUnderline","ownerState"],VE=(0,Iy.ZP)(gE,{name:"MuiPickersFilledInput",slot:"Root",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>DE(e)&&"disableUnderline"!==e})((e=>{let{theme:t}=e;const n="light"===t.palette.mode,r=n?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",i=n?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",o=n?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",s=n?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:i,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:o,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:i}},[`&.${UE.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:i},[`&.${UE.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:s},variants:[...Object.keys((t.vars??t).palette).filter((e=>(t.vars??t).palette[e].main)).map((e=>({props:{color:e,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[e]?.main}`}}}))),{props:{disableUnderline:!1},style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${UE.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${UE.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${UE.disabled}, .${UE.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${UE.disabled}:before`]:{borderBottomStyle:"dotted"}}},{props:e=>{let{startAdornment:t}=e;return!!t},style:{paddingLeft:12}},{props:e=>{let{endAdornment:t}=e;return!!t},style:{paddingRight:12}}]}})),GE=(0,Iy.ZP)(yE,{name:"MuiPickersFilledInput",slot:"sectionsContainer",overridesResolver:(e,t)=>t.sectionsContainer})({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:e=>{let{startAdornment:t}=e;return!!t},style:{paddingLeft:0}},{props:e=>{let{endAdornment:t}=e;return!!t},style:{paddingRight:0}},{props:{hiddenLabel:!0},style:{paddingTop:16,paddingBottom:17}},{props:{hiddenLabel:!0,size:"small"},style:{paddingTop:8,paddingBottom:9}}]}),HE=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPickersFilledInput"}),{label:r,disableUnderline:i=!1,ownerState:o}=n,s=(0,My.Z)(n,jE),a=$_(),l=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,Cy.Z)(r,BE,t);return(0,_n.Z)({},t,i)})((0,_n.Z)({},n,o,a,{color:a?.color||"primary"}));return(0,Wy.jsx)(wE,(0,_n.Z)({slots:{root:VE,input:GE},slotProps:{root:{disableUnderline:i}}},s,{label:r,classes:l,ref:t}))}));function ZE(e){return(0,lv.ZP)("MuiPickersFilledInput",e)}HE.muiName="Input";const WE=(0,_n.Z)({},KM,(0,$y.Z)("MuiPickersInput",["root","input"])),$E=["label","autoFocus","disableUnderline","ownerState"],qE=(0,Iy.ZP)(gE,{name:"MuiPickersInput",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e,n="light"===t.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(n=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{"label + &":{marginTop:16},variants:[...Object.keys((t.vars??t).palette).filter((e=>(t.vars??t).palette[e].main)).map((e=>({props:{color:e},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[e].main}`}}}))),{props:{disableUnderline:!1},style:{"&::after":{background:"red",left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${WE.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${WE.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${n}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${WE.disabled}, .${WE.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${n}`}},[`&.${WE.disabled}:before`]:{borderBottomStyle:"dotted"}}}]}})),XE=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPickersInput"}),{label:r,disableUnderline:i=!1,ownerState:o}=n,s=(0,My.Z)(n,$E),a=$_(),l=(e=>{const{classes:t,disableUnderline:n}=e,r={root:["root",!n&&"underline"],input:["input"]},i=(0,Cy.Z)(r,ZE,t);return(0,_n.Z)({},t,i)})((0,_n.Z)({},n,o,a,{disableUnderline:i,color:a?.color||"primary"}));return(0,Wy.jsx)(wE,(0,_n.Z)({slots:{root:qE}},s,{label:r,classes:l,ref:t}))}));XE.muiName="Input";const YE=["onFocus","onBlur","className","color","disabled","error","variant","required","InputProps","inputProps","inputRef","sectionListRef","elements","areAllSectionsEmpty","onClick","onKeyDown","onKeyUp","onPaste","onInput","endAdornment","startAdornment","tabIndex","contentEditable","focused","value","onChange","fullWidth","id","name","helperText","FormHelperTextProps","label","InputLabelProps"],KE={standard:XE,filled:HE,outlined:TE},JE=(0,Iy.ZP)(nb,{name:"MuiPickersTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),QE=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiPickersTextField"}),{onFocus:i,onBlur:o,className:s,color:a="primary",disabled:l=!1,error:c=!1,variant:u="outlined",required:h=!1,InputProps:d,inputProps:p,inputRef:f,sectionListRef:m,elements:g,areAllSectionsEmpty:y,onClick:v,onKeyDown:_,onPaste:x,onInput:b,endAdornment:w,startAdornment:S,tabIndex:M,contentEditable:E,focused:T,value:C,onChange:A,fullWidth:I,id:P,name:R,helperText:L,FormHelperTextProps:D,label:O,InputLabelProps:N}=r,k=(0,My.Z)(r,YE),F=e.useRef(null),z=(0,F_.Z)(n,F),B=(0,O_.Z)(P),U=L&&B?`${B}-helper-text`:void 0,j=O&&B?`${B}-label`:void 0,V=(0,_n.Z)({},r,{color:a,disabled:l,error:c,focused:T,required:h,variant:u}),G=(e=>{const{focused:t,disabled:n,classes:r,required:i}=e,o={root:["root",t&&!n&&"focused",n&&"disabled",i&&"required"]};return(0,Cy.Z)(o,XM,r)})(V),H=KE[u];return(0,Wy.jsxs)(JE,(0,_n.Z)({className:(0,Ey.Z)(G.root,s),ref:z,focused:T,onFocus:i,onBlur:o,disabled:l,variant:u,error:c,color:a,fullWidth:I,required:h,ownerState:V},k,{children:[(0,Wy.jsx)(Yx,(0,_n.Z)({htmlFor:B,id:j},N,{children:O})),(0,Wy.jsx)(H,(0,_n.Z)({elements:g,areAllSectionsEmpty:y,onClick:v,onKeyDown:_,onInput:b,onPaste:x,endAdornment:w,startAdornment:S,tabIndex:M,contentEditable:E,value:C,onChange:A,id:B,fullWidth:I,inputProps:p,inputRef:f,sectionListRef:m,label:O,name:R,role:"group","aria-labelledby":j},d)),L&&(0,Wy.jsx)(cb,(0,_n.Z)({id:U},D,{children:L}))]}))})),eT=["enableAccessibleFieldDOMStructure"],tT=["InputProps","readOnly"],nT=["onPaste","onKeyDown","inputMode","readOnly","InputProps","inputProps","inputRef"],rT=["slots","slotProps","InputProps","inputProps"],iT=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiDateTimeField"}),{slots:i,slotProps:o,InputProps:s,inputProps:a}=r,l=(0,My.Z)(r,rT),c=r,u=i?.textField??(t.enableAccessibleFieldDOMStructure?QE:BS),h=gb({elementType:u,externalSlotProps:o?.textField,externalForwardedProps:l,ownerState:c,additionalProps:{ref:n}});h.inputProps=(0,_n.Z)({},a,h.inputProps),h.InputProps=(0,_n.Z)({},s,h.InputProps);const d=(e=>{let{enableAccessibleFieldDOMStructure:t}=e,n=(0,My.Z)(e,eT);if(t){const{InputProps:e,readOnly:t}=n,r=(0,My.Z)(n,tT);return(0,_n.Z)({},r,{InputProps:(0,_n.Z)({},e??{},{readOnly:t})})}const{onPaste:r,onKeyDown:i,inputMode:o,readOnly:s,InputProps:a,inputProps:l,inputRef:c}=n,u=(0,My.Z)(n,nT);return(0,_n.Z)({},u,{InputProps:(0,_n.Z)({},a??{},{readOnly:s}),inputProps:(0,_n.Z)({},l??{},{inputMode:o,onPaste:r,onKeyDown:i,ref:c})})})(vM(h)),p=(t=>{const n=XS(),{clearable:r,onClear:i,InputProps:o,sx:s,slots:a,slotProps:l}=t,c=(0,My.Z)(t,$M),u=a?.clearButton??MM,h=gb({elementType:u,externalSlotProps:l?.clearButton,ownerState:{},className:"clearButton",additionalProps:{title:n.fieldClearLabel}}),d=(0,My.Z)(h,qM),p=a?.clearIcon??WM,f=gb({elementType:p,externalSlotProps:l?.clearIcon,ownerState:{}});return(0,_n.Z)({},c,{InputProps:(0,_n.Z)({},o,{endAdornment:(0,Wy.jsxs)(e.Fragment,{children:[r&&(0,Wy.jsx)(BM,{position:"end",sx:{marginRight:o?.endAdornment?-1:-1.5},children:(0,Wy.jsx)(u,(0,_n.Z)({},d,{onClick:i,children:(0,Wy.jsx)(p,(0,_n.Z)({fontSize:"small"},f))}))}),o?.endAdornment]})}),sx:[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(s)?s:[s]]})})((0,_n.Z)({},d,{slots:i,slotProps:o}));return(0,Wy.jsx)(u,(0,_n.Z)({},p))}));function oT(e){return(0,lv.ZP)("MuiTab",e)}const sT=(0,$y.Z)("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),aT=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],lT=(0,Iy.ZP)(fv,{name:"MuiTab",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.label&&n.icon&&t.labelIcon,t[`textColor${(0,mv.Z)(n.textColor)}`],n.fullWidth&&t.fullWidth,n.wrapped&&t.wrapped]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},t.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},n.label&&{flexDirection:"top"===n.iconPosition||"bottom"===n.iconPosition?"column":"row"},{lineHeight:1.25},n.icon&&n.label&&{minHeight:72,paddingTop:9,paddingBottom:9,[`& > .${sT.iconWrapper}`]:(0,_n.Z)({},"top"===n.iconPosition&&{marginBottom:6},"bottom"===n.iconPosition&&{marginTop:6},"start"===n.iconPosition&&{marginRight:t.spacing(1)},"end"===n.iconPosition&&{marginLeft:t.spacing(1)})},"inherit"===n.textColor&&{color:"inherit",opacity:.6,[`&.${sT.selected}`]:{opacity:1},[`&.${sT.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"primary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,[`&.${sT.selected}`]:{color:(t.vars||t).palette.primary.main},[`&.${sT.disabled}`]:{color:(t.vars||t).palette.text.disabled}},"secondary"===n.textColor&&{color:(t.vars||t).palette.text.secondary,[`&.${sT.selected}`]:{color:(t.vars||t).palette.secondary.main},[`&.${sT.disabled}`]:{color:(t.vars||t).palette.text.disabled}},n.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},n.wrapped&&{fontSize:t.typography.pxToRem(12)})})),cT=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiTab"}),{className:i,disabled:o=!1,disableFocusRipple:s=!1,fullWidth:a,icon:l,iconPosition:c="top",indicator:u,label:h,onChange:d,onClick:p,onFocus:f,selected:m,selectionFollowsFocus:g,textColor:y="inherit",value:v,wrapped:_=!1}=r,x=(0,My.Z)(r,aT),b=(0,_n.Z)({},r,{disabled:o,disableFocusRipple:s,selected:m,icon:!!l,iconPosition:c,label:!!h,fullWidth:a,textColor:y,wrapped:_}),w=(e=>{const{classes:t,textColor:n,fullWidth:r,wrapped:i,icon:o,label:s,selected:a,disabled:l}=e,c={root:["root",o&&s&&"labelIcon",`textColor${(0,mv.Z)(n)}`,r&&"fullWidth",i&&"wrapped",a&&"selected",l&&"disabled"],iconWrapper:["iconWrapper"]};return(0,Cy.Z)(c,oT,t)})(b),S=l&&h&&e.isValidElement(l)?e.cloneElement(l,{className:(0,Ey.Z)(w.iconWrapper,l.props.className)}):l;return(0,Wy.jsxs)(lT,(0,_n.Z)({focusRipple:!s,className:(0,Ey.Z)(w.root,i),ref:n,role:"tab","aria-selected":m,disabled:o,onClick:e=>{!m&&d&&d(e,v),p&&p(e)},onFocus:e=>{g&&!m&&d&&d(e,v),f&&f(e)},ownerState:b,tabIndex:m?0:-1},x,{children:["top"===c||"start"===c?(0,Wy.jsxs)(e.Fragment,{children:[S,h]}):(0,Wy.jsxs)(e.Fragment,{children:[h,S]}),u]}))})),uT=cT;let hT;function dT(){if(hT)return hT;const e=document.createElement("div"),t=document.createElement("div");return t.style.width="10px",t.style.height="1px",e.appendChild(t),e.dir="rtl",e.style.fontSize="14px",e.style.width="4px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.overflow="scroll",document.body.appendChild(e),hT="reverse",e.scrollLeft>0?hT="default":(e.scrollLeft=1,0===e.scrollLeft&&(hT="negative")),document.body.removeChild(e),hT}function pT(e,t){const n=e.scrollLeft;if("rtl"!==t)return n;switch(dT()){case"negative":return e.scrollWidth-e.clientWidth+n;case"reverse":return e.scrollWidth-e.clientWidth-n;default:return n}}function fT(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}const mT=["onChange"],gT={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"},yT=(0,MS.Z)((0,Wy.jsx)("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),vT=(0,MS.Z)((0,Wy.jsx)("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight");function _T(e){return(0,lv.ZP)("MuiTabScrollButton",e)}const xT=(0,$y.Z)("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),bT=["className","slots","slotProps","direction","orientation","disabled"],wT=(0,Iy.ZP)(fv,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.orientation&&t[n.orientation]]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({width:40,flexShrink:0,opacity:.8,[`&.${xT.disabled}`]:{opacity:0}},"vertical"===t.orientation&&{width:"100%",height:40,"& svg":{transform:`rotate(${t.isRtl?-90:90}deg)`}})})),ST=e.forwardRef((function(e,t){var n,r;const i=(0,Ry.Z)({props:e,name:"MuiTabScrollButton"}),{className:o,slots:s={},slotProps:a={},direction:l}=i,c=(0,My.Z)(i,bT),u=vb(),h=(0,_n.Z)({isRtl:u},i),d=(e=>{const{classes:t,orientation:n,disabled:r}=e,i={root:["root",n,r&&"disabled"]};return(0,Cy.Z)(i,_T,t)})(h),p=null!=(n=s.StartScrollButtonIcon)?n:yT,f=null!=(r=s.EndScrollButtonIcon)?r:vT,m=gb({elementType:p,externalSlotProps:a.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:h}),g=gb({elementType:f,externalSlotProps:a.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:h});return(0,Wy.jsx)(wT,(0,_n.Z)({component:"div",className:(0,Ey.Z)(d.root,o),ref:t,role:null,ownerState:h,tabIndex:null},c,{children:"left"===l?(0,Wy.jsx)(p,(0,_n.Z)({},m)):(0,Wy.jsx)(f,(0,_n.Z)({},g))}))})),MT=ST;function ET(e){return(0,lv.ZP)("MuiTabs",e)}const TT=(0,$y.Z)("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),CT=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","slots","slotProps","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],AT=(e,t)=>e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:e.firstChild,IT=(e,t)=>e===t?e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:e.lastChild,PT=(e,t,n)=>{let r=!1,i=n(e,t);for(;i;){if(i===e.firstChild){if(r)return;r=!0}const t=i.disabled||"true"===i.getAttribute("aria-disabled");if(i.hasAttribute("tabindex")&&!t)return void i.focus();i=n(e,i)}},RT=(0,Iy.ZP)("div",{name:"MuiTabs",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${TT.scrollButtons}`]:t.scrollButtons},{[`& .${TT.scrollButtons}`]:n.scrollButtonsHideMobile&&t.scrollButtonsHideMobile},t.root,n.vertical&&t.vertical]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},t.vertical&&{flexDirection:"column"},t.scrollButtonsHideMobile&&{[`& .${TT.scrollButtons}`]:{[n.breakpoints.down("sm")]:{display:"none"}}})})),LT=(0,Iy.ZP)("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.scroller,n.fixed&&t.fixed,n.hideScrollbar&&t.hideScrollbar,n.scrollableX&&t.scrollableX,n.scrollableY&&t.scrollableY]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},t.fixed&&{overflowX:"hidden",width:"100%"},t.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},t.scrollableX&&{overflowX:"auto",overflowY:"hidden"},t.scrollableY&&{overflowY:"auto",overflowX:"hidden"})})),DT=(0,Iy.ZP)("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.flexContainer,n.vertical&&t.flexContainerVertical,n.centered&&t.centered]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"flex"},t.vertical&&{flexDirection:"column"},t.centered&&{justifyContent:"center"})})),OT=(0,Iy.ZP)("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:(e,t)=>t.indicator})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({position:"absolute",height:2,bottom:0,width:"100%",transition:n.transitions.create()},"primary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.primary.main},"secondary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.secondary.main},t.vertical&&{height:"100%",width:2,right:0})})),NT=(0,Iy.ZP)((function(t){const{onChange:n}=t,r=(0,My.Z)(t,mT),i=e.useRef(),o=e.useRef(null),s=()=>{i.current=o.current.offsetHeight-o.current.clientHeight};return(0,q_.Z)((()=>{const e=(0,Ob.Z)((()=>{const e=i.current;s(),e!==i.current&&n(i.current)})),t=(0,Nb.Z)(o.current);return t.addEventListener("resize",e),()=>{e.clear(),t.removeEventListener("resize",e)}}),[n]),e.useEffect((()=>{s(),n(i.current)}),[n]),(0,Wy.jsx)("div",(0,_n.Z)({style:gT,ref:o},r))}))({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),kT={},FT=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiTabs"}),i=Zb(),o=vb(),{"aria-label":s,"aria-labelledby":a,action:l,centered:c=!1,children:u,className:h,component:d="div",allowScrollButtonsMobile:p=!1,indicatorColor:f="primary",onChange:m,orientation:g="horizontal",ScrollButtonComponent:y=MT,scrollButtons:v="auto",selectionFollowsFocus:_,slots:x={},slotProps:b={},TabIndicatorProps:w={},TabScrollButtonProps:S={},textColor:M="primary",value:E,variant:T="standard",visibleScrollbar:C=!1}=r,A=(0,My.Z)(r,CT),I="scrollable"===T,P="vertical"===g,R=P?"scrollTop":"scrollLeft",L=P?"top":"left",D=P?"bottom":"right",O=P?"clientHeight":"clientWidth",N=P?"height":"width",k=(0,_n.Z)({},r,{component:d,allowScrollButtonsMobile:p,indicatorColor:f,orientation:g,vertical:P,scrollButtons:v,textColor:M,variant:T,visibleScrollbar:C,fixed:!I,hideScrollbar:I&&!C,scrollableX:I&&!P,scrollableY:I&&P,centered:c&&!I,scrollButtonsHideMobile:!p}),F=(e=>{const{vertical:t,fixed:n,hideScrollbar:r,scrollableX:i,scrollableY:o,centered:s,scrollButtonsHideMobile:a,classes:l}=e,c={root:["root",t&&"vertical"],scroller:["scroller",n&&"fixed",r&&"hideScrollbar",i&&"scrollableX",o&&"scrollableY"],flexContainer:["flexContainer",t&&"flexContainerVertical",s&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",a&&"scrollButtonsHideMobile"],scrollableX:[i&&"scrollableX"],hideScrollbar:[r&&"hideScrollbar"]};return(0,Cy.Z)(c,ET,l)})(k),z=gb({elementType:x.StartScrollButtonIcon,externalSlotProps:b.startScrollButtonIcon,ownerState:k}),B=gb({elementType:x.EndScrollButtonIcon,externalSlotProps:b.endScrollButtonIcon,ownerState:k}),[U,j]=e.useState(!1),[V,G]=e.useState(kT),[H,Z]=e.useState(!1),[W,$]=e.useState(!1),[q,X]=e.useState(!1),[Y,K]=e.useState({overflow:"hidden",scrollbarWidth:0}),J=new Map,Q=e.useRef(null),ee=e.useRef(null),te=()=>{const e=Q.current;let t,n;if(e){const n=e.getBoundingClientRect();t={clientWidth:e.clientWidth,scrollLeft:e.scrollLeft,scrollTop:e.scrollTop,scrollLeftNormalized:pT(e,o?"rtl":"ltr"),scrollWidth:e.scrollWidth,top:n.top,bottom:n.bottom,left:n.left,right:n.right}}if(e&&!1!==E){const e=ee.current.children;if(e.length>0){const t=e[J.get(E)];n=t?t.getBoundingClientRect():null}}return{tabsMeta:t,tabMeta:n}},ne=(0,Dy.Z)((()=>{const{tabsMeta:e,tabMeta:t}=te();let n,r=0;if(P)n="top",t&&e&&(r=t.top-e.top+e.scrollTop);else if(n=o?"right":"left",t&&e){const i=o?e.scrollLeftNormalized+e.clientWidth-e.scrollWidth:e.scrollLeft;r=(o?-1:1)*(t[n]-e[n]+i)}const i={[n]:r,[N]:t?t[N]:0};if(isNaN(V[n])||isNaN(V[N]))G(i);else{const e=Math.abs(V[n]-i[n]),t=Math.abs(V[N]-i[N]);(e>=1||t>=1)&&G(i)}})),re=function(e){let{animation:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t?function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const{ease:o=fT,duration:s=300}=r;let a=null;const l=t[e];let c=!1;const u=r=>{if(c)return void i(new Error("Animation cancelled"));null===a&&(a=r);const h=Math.min(1,(r-a)/s);t[e]=o(h)*(n-l)+l,h>=1?requestAnimationFrame((()=>{i(null)})):requestAnimationFrame(u)};l===n?i(new Error("Element already at target position")):requestAnimationFrame(u)}(R,Q.current,e,{duration:i.transitions.duration.standard}):Q.current[R]=e},ie=e=>{let t=Q.current[R];P?t+=e:(t+=e*(o?-1:1),t*=o&&"reverse"===dT()?-1:1),re(t)},oe=()=>{const e=Q.current[O];let t=0;const n=Array.from(ee.current.children);for(let r=0;r<n.length;r+=1){const i=n[r];if(t+i[O]>e){0===r&&(t=e);break}t+=i[O]}return t},se=()=>{ie(-1*oe())},ae=()=>{ie(oe())},le=e.useCallback((e=>{K({overflow:null,scrollbarWidth:e})}),[]),ce=(0,Dy.Z)((e=>{const{tabsMeta:t,tabMeta:n}=te();if(n&&t)if(n[L]<t[L]){const r=t[R]+(n[L]-t[L]);re(r,{animation:e})}else if(n[D]>t[D]){const r=t[R]+(n[D]-t[D]);re(r,{animation:e})}})),ue=(0,Dy.Z)((()=>{I&&!1!==v&&X(!q)}));e.useEffect((()=>{const e=(0,Ob.Z)((()=>{Q.current&&ne()}));let t;const n=(0,Nb.Z)(Q.current);let r;return n.addEventListener("resize",e),"undefined"!=typeof ResizeObserver&&(t=new ResizeObserver(e),Array.from(ee.current.children).forEach((e=>{t.observe(e)}))),"undefined"!=typeof MutationObserver&&(r=new MutationObserver((n=>{n.forEach((e=>{e.removedNodes.forEach((e=>{var n;null==(n=t)||n.unobserve(e)})),e.addedNodes.forEach((e=>{var n;null==(n=t)||n.observe(e)}))})),e(),ue()})),r.observe(ee.current,{childList:!0})),()=>{var i,o;e.clear(),n.removeEventListener("resize",e),null==(i=r)||i.disconnect(),null==(o=t)||o.disconnect()}}),[ne,ue]),e.useEffect((()=>{const e=Array.from(ee.current.children),t=e.length;if("undefined"!=typeof IntersectionObserver&&t>0&&I&&!1!==v){const n=e[0],r=e[t-1],i={root:Q.current,threshold:.99},o=new IntersectionObserver((e=>{Z(!e[0].isIntersecting)}),i);o.observe(n);const s=new IntersectionObserver((e=>{$(!e[0].isIntersecting)}),i);return s.observe(r),()=>{o.disconnect(),s.disconnect()}}}),[I,v,q,null==u?void 0:u.length]),e.useEffect((()=>{j(!0)}),[]),e.useEffect((()=>{ne()})),e.useEffect((()=>{ce(kT!==V)}),[ce,V]),e.useImperativeHandle(l,(()=>({updateIndicator:ne,updateScrollButtons:ue})),[ne,ue]);const he=(0,Wy.jsx)(OT,(0,_n.Z)({},w,{className:(0,Ey.Z)(F.indicator,w.className),ownerState:k,style:(0,_n.Z)({},V,w.style)}));let de=0;const pe=e.Children.map(u,(t=>{if(!e.isValidElement(t))return null;const n=void 0===t.props.value?de:t.props.value;J.set(n,de);const r=n===E;return de+=1,e.cloneElement(t,(0,_n.Z)({fullWidth:"fullWidth"===T,indicator:r&&!U&&he,selected:r,selectionFollowsFocus:_,onChange:m,textColor:M,value:n},1!==de||!1!==E||t.props.tabIndex?{}:{tabIndex:0}))})),fe=(()=>{const e={};e.scrollbarSizeListener=I?(0,Wy.jsx)(NT,{onChange:le,className:(0,Ey.Z)(F.scrollableX,F.hideScrollbar)}):null;const t=I&&("auto"===v&&(H||W)||!0===v);return e.scrollButtonStart=t?(0,Wy.jsx)(y,(0,_n.Z)({slots:{StartScrollButtonIcon:x.StartScrollButtonIcon},slotProps:{startScrollButtonIcon:z},orientation:g,direction:o?"right":"left",onClick:se,disabled:!H},S,{className:(0,Ey.Z)(F.scrollButtons,S.className)})):null,e.scrollButtonEnd=t?(0,Wy.jsx)(y,(0,_n.Z)({slots:{EndScrollButtonIcon:x.EndScrollButtonIcon},slotProps:{endScrollButtonIcon:B},orientation:g,direction:o?"left":"right",onClick:ae,disabled:!W},S,{className:(0,Ey.Z)(F.scrollButtons,S.className)})):null,e})();return(0,Wy.jsxs)(RT,(0,_n.Z)({className:(0,Ey.Z)(F.root,h),ownerState:k,ref:n,as:d},A,{children:[fe.scrollButtonStart,fe.scrollbarSizeListener,(0,Wy.jsxs)(LT,{className:F.scroller,ownerState:k,style:{overflow:Y.overflow,[P?"margin"+(o?"Left":"Right"):"marginBottom"]:C?void 0:-Y.scrollbarWidth},ref:Q,children:[(0,Wy.jsx)(DT,{"aria-label":s,"aria-labelledby":a,"aria-orientation":"vertical"===g?"vertical":null,className:F.flexContainer,ownerState:k,onKeyDown:e=>{const t=ee.current,n=(0,ub.Z)(t).activeElement;if("tab"!==n.getAttribute("role"))return;let r="horizontal"===g?"ArrowLeft":"ArrowUp",i="horizontal"===g?"ArrowRight":"ArrowDown";switch("horizontal"===g&&o&&(r="ArrowRight",i="ArrowLeft"),e.key){case r:e.preventDefault(),PT(t,n,IT);break;case i:e.preventDefault(),PT(t,n,AT);break;case"Home":e.preventDefault(),PT(t,null,AT);break;case"End":e.preventDefault(),PT(t,null,IT)}},ref:ee,role:"tablist",children:pe}),U&&he]}),fe.scrollButtonEnd]}))})),zT=FT;function BT(e){return(0,lv.ZP)("MuiDateTimePickerTabs",e)}(0,$y.Z)("MuiDateTimePickerTabs",["root"]);const UT=e=>Qv(e)?"date":"time",jT=(0,Iy.ZP)(zT,{name:"MuiDateTimePickerTabs",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{boxShadow:`0 -1px 0 0 inset ${(t.vars||t).palette.divider}`,"&:last-child":{boxShadow:`0 1px 0 0 inset ${(t.vars||t).palette.divider}`,[`& .${TT.indicator}`]:{bottom:"auto",top:0}}}})),VT=function(t){const n=(0,Ry.Z)({props:t,name:"MuiDateTimePickerTabs"}),{dateIcon:r=(0,Wy.jsx)(HM,{}),onViewChange:i,timeIcon:o=(0,Wy.jsx)(ZM,{}),view:s,hidden:a="undefined"==typeof window||window.innerHeight<667,className:l,sx:c}=n,u=XS(),h=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},BT,t)})(n);return a?null:(0,Wy.jsxs)(jT,{ownerState:n,variant:"fullWidth",value:UT(s),onChange:(e,t)=>{i("date"===t?"day":"hours")},className:(0,Ey.Z)(l,h.root),sx:c,children:[(0,Wy.jsx)(uT,{value:"date","aria-label":u.dateTableLabel,icon:(0,Wy.jsx)(e.Fragment,{children:r})}),(0,Wy.jsx)(uT,{value:"time","aria-label":u.timeTableLabel,icon:(0,Wy.jsx)(e.Fragment,{children:o})})]})};function GT(e){return(0,lv.ZP)("MuiPickersToolbarText",e)}const HT=(0,$y.Z)("MuiPickersToolbarText",["root","selected"]),ZT=["className","selected","value"],WT=(0,Iy.ZP)(LM,{name:"MuiPickersToolbarText",slot:"Root",overridesResolver:(e,t)=>[t.root,{[`&.${HT.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return{transition:t.transitions.create("color"),color:(t.vars||t).palette.text.secondary,[`&.${HT.selected}`]:{color:(t.vars||t).palette.text.primary}}})),$T=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPickersToolbarText"}),{className:r,value:i}=n,o=(0,My.Z)(n,ZT),s=(e=>{const{classes:t,selected:n}=e,r={root:["root",n&&"selected"]};return(0,Cy.Z)(r,GT,t)})(n);return(0,Wy.jsx)(WT,(0,_n.Z)({ref:t,className:(0,Ey.Z)(r,s.root),component:"span"},o,{children:i}))}));function qT(e){return(0,lv.ZP)("MuiPickersToolbar",e)}const XT=(0,$y.Z)("MuiPickersToolbar",["root","content"]),YT=["children","className","toolbarTitle","hidden","titleId","isLandscape","classes","landscapeDirection"],KT=(0,Iy.ZP)("div",{name:"MuiPickersToolbar",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",padding:t.spacing(2,3),variants:[{props:{isLandscape:!0},style:{height:"auto",maxWidth:160,padding:16,justifyContent:"flex-start",flexWrap:"wrap"}}]}})),JT=(0,Iy.ZP)("div",{name:"MuiPickersToolbar",slot:"Content",overridesResolver:(e,t)=>t.content})({display:"flex",flexWrap:"wrap",width:"100%",flex:1,justifyContent:"space-between",alignItems:"center",flexDirection:"row",variants:[{props:{isLandscape:!0},style:{justifyContent:"flex-start",alignItems:"flex-start",flexDirection:"column"}},{props:{isLandscape:!0,landscapeDirection:"row"},style:{flexDirection:"row"}}]}),QT=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPickersToolbar"}),{children:r,className:i,toolbarTitle:o,hidden:s,titleId:a}=n,l=(0,My.Z)(n,YT),c=n,u=(e=>{const{classes:t,isLandscape:n}=e,r={root:["root"],content:["content"],penIconButton:["penIconButton",n&&"penIconButtonLandscape"]};return(0,Cy.Z)(r,qT,t)})(c);return s?null:(0,Wy.jsxs)(KT,(0,_n.Z)({ref:t,className:(0,Ey.Z)(u.root,i),ownerState:c},l,{children:[(0,Wy.jsx)(LM,{color:"text.secondary",variant:"overline",id:a,children:o}),(0,Wy.jsx)(JT,{className:u.content,ownerState:c,children:r})]}))})),eC=["align","className","selected","typographyClassName","value","variant","width"],tC=(0,Iy.ZP)(Tv,{name:"MuiPickersToolbarButton",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:0,minWidth:16,textTransform:"none"}),nC=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiPickersToolbarButton"}),{align:r,className:i,selected:o,typographyClassName:s,value:a,variant:l,width:c}=n,u=(0,My.Z)(n,eC),h=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},qT,t)})(n);return(0,Wy.jsx)(tC,(0,_n.Z)({variant:"text",ref:t,className:(0,Ey.Z)(i,h.root)},c?{sx:{width:c}}:{},u,{children:(0,Wy.jsx)($T,{align:r,className:s,variant:l,value:a,selected:o})}))}));function rC(e){return(0,lv.ZP)("MuiDateTimePickerToolbar",e)}const iC=(0,$y.Z)("MuiDateTimePickerToolbar",["root","dateContainer","timeContainer","timeDigitsContainer","separator","timeLabelReverse","ampmSelection","ampmLandscape","ampmLabel"]);function oC(t,n,r,i){const o=$S();return{meridiemMode:o_(t,o),handleMeridiemChange:e.useCallback((e=>{const s=null==t?null:a_(t,e,Boolean(n),o);r(s,i??"partial")}),[n,t,r,i,o])}}const sC=320,aC=336,lC=48,cC=["ampm","ampmInClock","value","onChange","view","isLandscape","onViewChange","toolbarFormat","toolbarPlaceholder","views","disabled","readOnly","toolbarVariant","toolbarTitle","className"],uC=e=>{const{classes:t,theme:n,isLandscape:r}=e,i={root:["root"],dateContainer:["dateContainer"],timeContainer:["timeContainer","rtl"===n.direction&&"timeLabelReverse"],timeDigitsContainer:["timeDigitsContainer","rtl"===n.direction&&"timeLabelReverse"],separator:["separator"],ampmSelection:["ampmSelection",r&&"ampmLandscape"],ampmLabel:["ampmLabel"]};return(0,Cy.Z)(i,rC,t)},hC=(0,Iy.ZP)(QT,{name:"MuiDateTimePickerToolbar",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{paddingLeft:16,paddingRight:16,justifyContent:"space-around",position:"relative",variants:[{props:{toolbarVariant:"desktop"},style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,[`& .${XT.content} .${HT.selected}`]:{color:(t.vars||t).palette.primary.main,fontWeight:t.typography.fontWeightBold}}},{props:{toolbarVariant:"desktop",isLandscape:!0},style:{borderRight:`1px solid ${(t.vars||t).palette.divider}`}},{props:{toolbarVariant:"desktop",isLandscape:!1},style:{paddingLeft:24,paddingRight:0}}]}})),dC=(0,Iy.ZP)("div",{name:"MuiDateTimePickerToolbar",slot:"DateContainer",overridesResolver:(e,t)=>t.dateContainer})({display:"flex",flexDirection:"column",alignItems:"flex-start"}),pC=(0,Iy.ZP)("div",{name:"MuiDateTimePickerToolbar",slot:"TimeContainer",overridesResolver:(e,t)=>t.timeContainer})((e=>{let{theme:t}=e;return(0,_n.Z)({display:"flex",flexDirection:"row"},"rtl"===t.direction&&{flexDirection:"row-reverse"},{variants:[{props:e=>{let{isLandscape:t,toolbarVariant:n}=e;return t&&"desktop"!==n},style:(0,_n.Z)({flexDirection:"column"},"rtl"===t.direction&&{flexDirection:"column-reverse"})},{props:{toolbarVariant:"desktop",isLandscape:!1},style:{gap:9,marginRight:4,alignSelf:"flex-end"}}]})})),fC=(0,Iy.ZP)("div",{name:"MuiDateTimePickerToolbar",slot:"TimeDigitsContainer",overridesResolver:(e,t)=>t.timeDigitsContainer})((e=>{let{theme:t}=e;return(0,_n.Z)({display:"flex"},"rtl"===t.direction&&{flexDirection:"row-reverse"},{variants:[{props:{toolbarVariant:"desktop"},style:{gap:1.5}}]})})),mC=(0,Iy.ZP)($T,{name:"MuiDateTimePickerToolbar",slot:"Separator",overridesResolver:(e,t)=>t.separator})({margin:"0 4px 0 2px",cursor:"default",variants:[{props:{toolbarVariant:"desktop"},style:{margin:0}}]}),gC=(0,Iy.ZP)("div",{name:"MuiDateTimePickerToolbar",slot:"AmPmSelection",overridesResolver:(e,t)=>[{[`.${iC.ampmLabel}`]:t.ampmLabel},{[`&.${iC.ampmLandscape}`]:t.ampmLandscape},t.ampmSelection]})({display:"flex",flexDirection:"column",marginRight:"auto",marginLeft:12,[`& .${iC.ampmLabel}`]:{fontSize:17},variants:[{props:{isLandscape:!0},style:{margin:"4px 0 auto",flexDirection:"row",justifyContent:"space-around",width:"100%"}}]});function yC(t){const n=(0,Ry.Z)({props:t,name:"MuiDateTimePickerToolbar"}),{ampm:r,ampmInClock:i,value:o,onChange:s,view:a,isLandscape:l,onViewChange:c,toolbarFormat:u,toolbarPlaceholder:h="",views:d,disabled:p,readOnly:f,toolbarVariant:m="mobile",toolbarTitle:g,className:y}=n,v=(0,My.Z)(n,cC),_=n,x=$S(),{meridiemMode:b,handleMeridiemChange:w}=oC(o,r,s),S=Boolean(r&&!i),M="desktop"===m,E=XS(),T=Zb(),C=uC((0,_n.Z)({},_,{theme:T})),A=g??E.dateTimePickerToolbarTitle,I=e.useMemo((()=>o?u?x.formatByString(o,u):x.format(o,"shortDate"):h),[o,u,h,x]);return(0,Wy.jsxs)(hC,(0,_n.Z)({isLandscape:l,className:(0,Ey.Z)(C.root,y),toolbarTitle:A},v,{ownerState:_,children:[(0,Wy.jsxs)(dC,{className:C.dateContainer,ownerState:_,children:[d.includes("year")&&(0,Wy.jsx)(nC,{tabIndex:-1,variant:"subtitle1",onClick:()=>c("year"),selected:"year"===a,value:o?x.format(o,"year"):""}),d.includes("day")&&(0,Wy.jsx)(nC,{tabIndex:-1,variant:M?"h5":"h4",onClick:()=>c("day"),selected:"day"===a,value:I})]}),(0,Wy.jsxs)(pC,{className:C.timeContainer,ownerState:_,children:[(0,Wy.jsxs)(fC,{className:C.timeDigitsContainer,ownerState:_,children:[d.includes("hours")&&(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(nC,{variant:M?"h5":"h3",width:M&&!l?lC:void 0,onClick:()=>c("hours"),selected:"hours"===a,value:o?(P=o,r?x.format(P,"hours12h"):x.format(P,"hours24h")):"--"}),(0,Wy.jsx)(mC,{variant:M?"h5":"h3",value:":",className:C.separator,ownerState:_}),(0,Wy.jsx)(nC,{variant:M?"h5":"h3",width:M&&!l?lC:void 0,onClick:()=>c("minutes"),selected:"minutes"===a||!d.includes("minutes")&&"hours"===a,value:o?x.format(o,"minutes"):"--",disabled:!d.includes("minutes")})]}),d.includes("seconds")&&(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(mC,{variant:M?"h5":"h3",value:":",className:C.separator,ownerState:_}),(0,Wy.jsx)(nC,{variant:M?"h5":"h3",width:M&&!l?lC:void 0,onClick:()=>c("seconds"),selected:"seconds"===a,value:o?x.format(o,"seconds"):"--"})]})]}),S&&!M&&(0,Wy.jsxs)(gC,{className:C.ampmSelection,ownerState:_,children:[(0,Wy.jsx)(nC,{variant:"subtitle2",selected:"am"===b,typographyClassName:C.ampmLabel,value:Kv(x,"am"),onClick:f?void 0:()=>w("am"),disabled:p}),(0,Wy.jsx)(nC,{variant:"subtitle2",selected:"pm"===b,typographyClassName:C.ampmLabel,value:Kv(x,"pm"),onClick:f?void 0:()=>w("pm"),disabled:p})]}),r&&M&&(0,Wy.jsx)(nC,{variant:"h5",onClick:()=>c("meridiem"),selected:"meridiem"===a,value:o&&b?Kv(x,b):"--",width:lC})]})]}));var P}function vC(t,n){const r=$S(),i=qS(),o=(0,Ry.Z)({props:t,name:n}),s=o.ampm??r.is12HourCycleInCurrentLocale(),a=e.useMemo((()=>null==o.localeText?.toolbarTitle?o.localeText:(0,_n.Z)({},o.localeText,{dateTimePickerToolbarTitle:o.localeText.toolbarTitle})),[o.localeText]);return(0,_n.Z)({},o,(e=>{let{openTo:t,defaultOpenTo:n,views:r,defaultViews:i}=e;const o=r??i;let s;if(null!=t)s=t;else if(o.includes(n))s=n;else{if(!(o.length>0))throw new Error("MUI X: The `views` prop must contain at least one view.");s=o[0]}return{views:o,openTo:s}})({views:o.views,openTo:o.openTo,defaultViews:["year","day","hours","minutes"],defaultOpenTo:"day"}),{ampm:s,localeText:a,orientation:o.orientation??"portrait",disableIgnoringDatePartForTimeValidation:o.disableIgnoringDatePartForTimeValidation??Boolean(o.minDateTime||o.maxDateTime||o.disablePast||o.disableFuture),disableFuture:o.disableFuture??!1,disablePast:o.disablePast??!1,minDate:qv(r,o.minDateTime??o.minDate,i.minDate),maxDate:qv(r,o.maxDateTime??o.maxDate,i.maxDate),minTime:o.minDateTime??o.minTime,maxTime:o.maxDateTime??o.maxTime,slots:(0,_n.Z)({toolbar:yC,tabs:VT},o.slots),slotProps:(0,_n.Z)({},o.slotProps,{toolbar:(0,_n.Z)({ampm:s},o.slotProps?.toolbar)})})}const _C=t=>{let{shouldDisableDate:n,shouldDisableMonth:r,shouldDisableYear:i,minDate:o,maxDate:s,disableFuture:a,disablePast:l,timezone:c}=t;const u=WS();return e.useCallback((e=>null!==uM({adapter:u,value:e,props:{shouldDisableDate:n,shouldDisableMonth:r,shouldDisableYear:i,minDate:o,maxDate:s,disableFuture:a,disablePast:l,timezone:c}})),[u,n,r,i,o,s,a,l,c])},xC=e=>(0,lv.ZP)("MuiPickersFadeTransitionGroup",e),bC=((0,$y.Z)("MuiPickersFadeTransitionGroup",["root"]),(0,Iy.ZP)(Gy,{name:"MuiPickersFadeTransitionGroup",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"block",position:"relative"}));function wC(e){const t=(0,Ry.Z)({props:e,name:"MuiPickersFadeTransitionGroup"}),{children:n,className:r,reduceAnimations:i,transKey:o}=t,s=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},xC,t)})(t),a=Zb();return i?n:(0,Wy.jsx)(bC,{className:(0,Ey.Z)(s.root,r),children:(0,Wy.jsx)(gw,{appear:!1,mountOnEnter:!0,unmountOnExit:!0,timeout:{appear:a.transitions.duration.enteringScreen,enter:a.transitions.duration.enteringScreen,exit:0},children:n},o)})}var SC=i(3753);function MC(e){if(e.type)return e;if("#"===e.charAt(0))return MC(function(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,k_.Z)(9,e));let r,i=e.substring(t+1,e.length-1);if("color"===n){if(i=i.split(" "),r=i.shift(),4===i.length&&"/"===i[3].charAt(0)&&(i[3]=i[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error((0,k_.Z)(10,r))}else i=i.split(",");return i=i.map((e=>parseFloat(e))),{type:n,values:i,colorSpace:r}}function EC(e,t){return e=MC(e),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,SC.Z)(e,t,n)}(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,function(e){const{type:t,colorSpace:n}=e;let{values:r}=e;return-1!==t.indexOf("rgb")?r=r.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),r=-1!==t.indexOf("color")?`${n} ${r.join(" ")}`:`${r.join(", ")}`,`${t}(${r})`}(e)}function TC(e){return(0,lv.ZP)("MuiPickersDay",e)}const CC=(0,$y.Z)("MuiPickersDay",["root","dayWithMargin","dayOutsideMonth","hiddenDaySpacingFiller","today","selected","disabled"]),AC=["autoFocus","className","day","disabled","disableHighlightToday","disableMargin","hidden","isAnimating","onClick","onDaySelect","onFocus","onBlur","onKeyDown","onMouseDown","onMouseEnter","outsideCurrentMonth","selected","showDaysOutsideCurrentMonth","children","today","isFirstVisibleCell","isLastVisibleCell"],IC=e=>{let{theme:t}=e;return(0,_n.Z)({},t.typography.caption,{width:36,height:36,borderRadius:"50%",padding:0,backgroundColor:"transparent",transition:t.transitions.create("background-color",{duration:t.transitions.duration.short}),color:(t.vars||t).palette.text.primary,"@media (pointer: fine)":{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.primary.main,t.palette.action.hoverOpacity)}},"&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.focusOpacity})`:EC(t.palette.primary.main,t.palette.action.focusOpacity),[`&.${CC.selected}`]:{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${CC.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,fontWeight:t.typography.fontWeightMedium,"&:hover":{willChange:"background-color",backgroundColor:(t.vars||t).palette.primary.dark}},[`&.${CC.disabled}:not(.${CC.selected})`]:{color:(t.vars||t).palette.text.disabled},[`&.${CC.disabled}&.${CC.selected}`]:{opacity:.6},variants:[{props:{disableMargin:!1},style:{margin:"0 2px"}},{props:{outsideCurrentMonth:!0,showDaysOutsideCurrentMonth:!0},style:{color:(t.vars||t).palette.text.secondary}},{props:{disableHighlightToday:!1,today:!0},style:{[`&:not(.${CC.selected})`]:{border:`1px solid ${(t.vars||t).palette.text.secondary}`}}}]})},PC=(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableMargin&&t.dayWithMargin,!n.disableHighlightToday&&n.today&&t.today,!n.outsideCurrentMonth&&n.showDaysOutsideCurrentMonth&&t.dayOutsideMonth,n.outsideCurrentMonth&&!n.showDaysOutsideCurrentMonth&&t.hiddenDaySpacingFiller]},RC=(0,Iy.ZP)(fv,{name:"MuiPickersDay",slot:"Root",overridesResolver:PC})(IC),LC=(0,Iy.ZP)("div",{name:"MuiPickersDay",slot:"Root",overridesResolver:PC})((e=>{let{theme:t}=e;return(0,_n.Z)({},IC({theme:t}),{opacity:0,pointerEvents:"none"})})),DC=()=>{},OC=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiPickersDay"}),{autoFocus:i=!1,className:o,day:s,disabled:a=!1,disableHighlightToday:l=!1,disableMargin:c=!1,isAnimating:u,onClick:h,onDaySelect:d,onFocus:p=DC,onBlur:f=DC,onKeyDown:m=DC,onMouseDown:g=DC,onMouseEnter:y=DC,outsideCurrentMonth:v,selected:_=!1,showDaysOutsideCurrentMonth:x=!1,children:b,today:w=!1}=r,S=(0,My.Z)(r,AC),M=(0,_n.Z)({},r,{autoFocus:i,disabled:a,disableHighlightToday:l,disableMargin:c,selected:_,showDaysOutsideCurrentMonth:x,today:w}),E=(e=>{const{selected:t,disableMargin:n,disableHighlightToday:r,today:i,disabled:o,outsideCurrentMonth:s,showDaysOutsideCurrentMonth:a,classes:l}=e,c=s&&!a,u={root:["root",t&&!c&&"selected",o&&"disabled",!n&&"dayWithMargin",!r&&i&&"today",s&&a&&"dayOutsideMonth",c&&"hiddenDaySpacingFiller"],hiddenDaySpacingFiller:["hiddenDaySpacingFiller"]};return(0,Cy.Z)(u,TC,l)})(M),T=$S(),C=e.useRef(null),A=(0,F_.Z)(C,n);return(0,Cv.Z)((()=>{!i||a||u||v||C.current.focus()}),[i,a,u,v]),v&&!x?(0,Wy.jsx)(LC,{className:(0,Ey.Z)(E.root,E.hiddenDaySpacingFiller,o),ownerState:M,role:S.role}):(0,Wy.jsx)(RC,(0,_n.Z)({className:(0,Ey.Z)(E.root,o),ref:A,centerRipple:!0,disabled:a,tabIndex:_?0:-1,onKeyDown:e=>m(e,s),onFocus:e=>p(e,s),onBlur:e=>f(e,s),onMouseEnter:e=>y(e,s),onClick:e=>{a||d(s),v&&e.currentTarget.focus(),h&&h(e)},onMouseDown:e=>{g(e),v&&e.preventDefault()}},S,{ownerState:M,children:b||T.format(s,"dayOfMonth")}))})),NC=e.memo(OC);function kC(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var FC=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.remove(r):"string"==typeof n.className?n.className=kC(n.className,r):n.setAttribute("class",kC(n.className&&n.className.baseVal||"",r)));var n,r}))},zC=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).appliedClasses={appear:{},enter:{},exit:{}},e.onEnter=function(t,n){var r=e.resolveArguments(t,n),i=r[0],o=r[1];e.removeClasses(i,"exit"),e.addClass(i,o?"appear":"enter","base"),e.props.onEnter&&e.props.onEnter(t,n)},e.onEntering=function(t,n){var r=e.resolveArguments(t,n),i=r[0],o=r[1]?"appear":"enter";e.addClass(i,o,"active"),e.props.onEntering&&e.props.onEntering(t,n)},e.onEntered=function(t,n){var r=e.resolveArguments(t,n),i=r[0],o=r[1]?"appear":"enter";e.removeClasses(i,o),e.addClass(i,o,"done"),e.props.onEntered&&e.props.onEntered(t,n)},e.onExit=function(t){var n=e.resolveArguments(t)[0];e.removeClasses(n,"appear"),e.removeClasses(n,"enter"),e.addClass(n,"exit","base"),e.props.onExit&&e.props.onExit(t)},e.onExiting=function(t){var n=e.resolveArguments(t)[0];e.addClass(n,"exit","active"),e.props.onExiting&&e.props.onExiting(t)},e.onExited=function(t){var n=e.resolveArguments(t)[0];e.removeClasses(n,"exit"),e.addClass(n,"exit","done"),e.props.onExited&&e.props.onExited(t)},e.resolveArguments=function(t,n){return e.props.nodeRef?[e.props.nodeRef.current,t]:[t,n]},e.getClassNames=function(t){var n=e.props.classNames,r="string"==typeof n,i=r?(r&&n?n+"-":"")+t:n[t];return{baseClassName:i,activeClassName:r?i+"-active":n[t+"Active"],doneClassName:r?i+"-done":n[t+"Done"]}},e}ky(n,t);var r=n.prototype;return r.addClass=function(e,t,n){var r=this.getClassNames(t)[n+"ClassName"],i=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===n&&i&&(r+=" "+i),"active"===n&&e&&kb(e),r&&(this.appliedClasses[t][n]=r,function(e,t){e&&t&&t.split(" ").forEach((function(t){return r=t,void((n=e).classList?n.classList.add(r):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(n,r)||("string"==typeof n.className?n.className=n.className+" "+r:n.setAttribute("class",(n.className&&n.className.baseVal||"")+" "+r)));var n,r}))}(e,r))},r.removeClasses=function(e,t){var n=this.appliedClasses[t],r=n.base,i=n.active,o=n.done;this.appliedClasses[t]={},r&&FC(e,r),i&&FC(e,i),o&&FC(e,o)},r.render=function(){var t=this.props,n=(t.classNames,(0,My.Z)(t,["classNames"]));return e.createElement(Hb,(0,_n.Z)({},n,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},n}(e.Component);zC.defaultProps={classNames:""},zC.propTypes={};const BC=zC,UC=e=>(0,lv.ZP)("MuiPickersSlideTransition",e),jC=(0,$y.Z)("MuiPickersSlideTransition",["root","slideEnter-left","slideEnter-right","slideEnterActive","slideExit","slideExitActiveLeft-left","slideExitActiveLeft-right"]),VC=["children","className","reduceAnimations","slideDirection","transKey","classes"],GC=(0,Iy.ZP)(Gy,{name:"MuiPickersSlideTransition",slot:"Root",overridesResolver:(e,t)=>[t.root,{[`.${jC["slideEnter-left"]}`]:t["slideEnter-left"]},{[`.${jC["slideEnter-right"]}`]:t["slideEnter-right"]},{[`.${jC.slideEnterActive}`]:t.slideEnterActive},{[`.${jC.slideExit}`]:t.slideExit},{[`.${jC["slideExitActiveLeft-left"]}`]:t["slideExitActiveLeft-left"]},{[`.${jC["slideExitActiveLeft-right"]}`]:t["slideExitActiveLeft-right"]}]})((e=>{let{theme:t}=e;const n=t.transitions.create("transform",{duration:t.transitions.duration.complex,easing:"cubic-bezier(0.35, 0.8, 0.4, 1)"});return{display:"block",position:"relative",overflowX:"hidden","& > *":{position:"absolute",top:0,right:0,left:0},[`& .${jC["slideEnter-left"]}`]:{willChange:"transform",transform:"translate(100%)",zIndex:1},[`& .${jC["slideEnter-right"]}`]:{willChange:"transform",transform:"translate(-100%)",zIndex:1},[`& .${jC.slideEnterActive}`]:{transform:"translate(0%)",transition:n},[`& .${jC.slideExit}`]:{transform:"translate(0%)"},[`& .${jC["slideExitActiveLeft-left"]}`]:{willChange:"transform",transform:"translate(-100%)",transition:n,zIndex:0},[`& .${jC["slideExitActiveLeft-right"]}`]:{willChange:"transform",transform:"translate(100%)",transition:n,zIndex:0}}})),HC=e=>(0,lv.ZP)("MuiDayCalendar",e),ZC=((0,$y.Z)("MuiDayCalendar",["root","header","weekDayLabel","loadingContainer","slideTransition","monthContainer","weekContainer","weekNumberLabel","weekNumber"]),["parentProps","day","focusableDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"]),WC=["ownerState"],$C=(0,Iy.ZP)("div",{name:"MuiDayCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({}),qC=(0,Iy.ZP)("div",{name:"MuiDayCalendar",slot:"Header",overridesResolver:(e,t)=>t.header})({display:"flex",justifyContent:"center",alignItems:"center"}),XC=(0,Iy.ZP)(LM,{name:"MuiDayCalendar",slot:"WeekDayLabel",overridesResolver:(e,t)=>t.weekDayLabel})((e=>{let{theme:t}=e;return{width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(t.vars||t).palette.text.secondary}})),YC=(0,Iy.ZP)(LM,{name:"MuiDayCalendar",slot:"WeekNumberLabel",overridesResolver:(e,t)=>t.weekNumberLabel})((e=>{let{theme:t}=e;return{width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:t.palette.text.disabled}})),KC=(0,Iy.ZP)(LM,{name:"MuiDayCalendar",slot:"WeekNumber",overridesResolver:(e,t)=>t.weekNumber})((e=>{let{theme:t}=e;return(0,_n.Z)({},t.typography.caption,{width:36,height:36,padding:0,margin:"0 2px",color:t.palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"})})),JC=(0,Iy.ZP)("div",{name:"MuiDayCalendar",slot:"LoadingContainer",overridesResolver:(e,t)=>t.loadingContainer})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:240}),QC=(0,Iy.ZP)((function(t){const n=(0,Ry.Z)({props:t,name:"MuiPickersSlideTransition"}),{children:r,className:i,reduceAnimations:o,transKey:s}=n,a=(0,My.Z)(n,VC),l=(e=>{const{classes:t,slideDirection:n}=e,r={root:["root"],exit:["slideExit"],enterActive:["slideEnterActive"],enter:[`slideEnter-${n}`],exitActive:[`slideExitActiveLeft-${n}`]};return(0,Cy.Z)(r,UC,t)})(n),c=Zb();if(o)return(0,Wy.jsx)("div",{className:(0,Ey.Z)(l.root,i),children:r});const u={exit:l.exit,enterActive:l.enterActive,enter:l.enter,exitActive:l.exitActive};return(0,Wy.jsx)(GC,{className:(0,Ey.Z)(l.root,i),childFactory:t=>e.cloneElement(t,{classNames:u}),role:"presentation",children:(0,Wy.jsx)(BC,(0,_n.Z)({mountOnEnter:!0,unmountOnExit:!0,timeout:c.transitions.duration.complex,classNames:u},a,{children:r}),s)})}),{name:"MuiDayCalendar",slot:"SlideTransition",overridesResolver:(e,t)=>t.slideTransition})({minHeight:240}),eA=(0,Iy.ZP)("div",{name:"MuiDayCalendar",slot:"MonthContainer",overridesResolver:(e,t)=>t.monthContainer})({overflow:"hidden"}),tA=(0,Iy.ZP)("div",{name:"MuiDayCalendar",slot:"WeekContainer",overridesResolver:(e,t)=>t.weekContainer})({margin:"2px 0",display:"flex",justifyContent:"center"});function nA(t){let{parentProps:n,day:r,focusableDay:i,selectedDays:o,isDateDisabled:s,currentMonthNumber:a,isViewFocused:l}=t,c=(0,My.Z)(t,ZC);const{disabled:u,disableHighlightToday:h,isMonthSwitchingAnimating:d,showDaysOutsideCurrentMonth:p,slots:f,slotProps:m,timezone:g}=n,y=$S(),v=YS(g),_=null!==i&&y.isSameDay(r,i),x=o.some((e=>y.isSameDay(e,r))),b=y.isSameDay(r,v),w=f?.day??NC,S=gb({elementType:w,externalSlotProps:m?.day,additionalProps:(0,_n.Z)({disableHighlightToday:h,showDaysOutsideCurrentMonth:p,role:"gridcell",isAnimating:d,"data-timestamp":y.toJsDate(r).valueOf()},c),ownerState:(0,_n.Z)({},n,{day:r,selected:x})}),M=(0,My.Z)(S,WC),E=e.useMemo((()=>u||s(r)),[u,s,r]),T=e.useMemo((()=>y.getMonth(r)!==a),[y,r,a]),C=e.useMemo((()=>{const e=y.startOfMonth(y.setMonth(r,a));return p?y.isSameDay(r,y.startOfWeek(e)):y.isSameDay(r,e)}),[a,r,p,y]),A=e.useMemo((()=>{const e=y.endOfMonth(y.setMonth(r,a));return p?y.isSameDay(r,y.endOfWeek(e)):y.isSameDay(r,e)}),[a,r,p,y]);return(0,Wy.jsx)(w,(0,_n.Z)({},M,{day:r,disabled:E,autoFocus:l&&_,today:b,outsideCurrentMonth:T,isFirstVisibleCell:C,isLastVisibleCell:A,selected:x,tabIndex:_?0:-1,"aria-selected":x,"aria-current":b?"date":void 0}))}function rA(t){const n=(0,Ry.Z)({props:t,name:"MuiDayCalendar"}),r=$S(),{onFocusedDayChange:i,className:o,currentMonth:s,selectedDays:a,focusedDay:l,loading:c,onSelectedDaysChange:u,onMonthSwitchingAnimationEnd:h,readOnly:d,reduceAnimations:p,renderLoading:f=(()=>(0,Wy.jsx)("span",{children:"..."})),slideDirection:m,TransitionProps:g,disablePast:y,disableFuture:v,minDate:_,maxDate:x,shouldDisableDate:b,shouldDisableMonth:w,shouldDisableYear:S,dayOfWeekFormatter:M=(e=>r.format(e,"weekdayShort").charAt(0).toUpperCase()),hasFocus:E,onFocusedViewChange:T,gridLabelId:C,displayWeekNumber:A,fixedWeekNumber:I,autoFocus:P,timezone:R}=n,L=YS(R),D=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},HC,t)})(n),O="rtl"===Zb().direction,N=_C({shouldDisableDate:b,shouldDisableMonth:w,shouldDisableYear:S,minDate:_,maxDate:x,disablePast:y,disableFuture:v,timezone:R}),k=XS(),[F,z]=(0,JS.Z)({name:"DayCalendar",state:"hasFocus",controlled:E,default:P??!1}),[B,U]=e.useState((()=>l||L)),j=(0,tw.Z)((e=>{d||u(e)})),V=e=>{N(e)||(i(e),U(e),T?.(!0),z(!0))},G=(0,tw.Z)(((e,t)=>{switch(e.key){case"ArrowUp":V(r.addDays(t,-7)),e.preventDefault();break;case"ArrowDown":V(r.addDays(t,7)),e.preventDefault();break;case"ArrowLeft":{const n=r.addDays(t,O?1:-1),i=r.addMonths(t,O?1:-1),o=$v({utils:r,date:n,minDate:O?n:r.startOfMonth(i),maxDate:O?r.endOfMonth(i):n,isDateDisabled:N,timezone:R});V(o||n),e.preventDefault();break}case"ArrowRight":{const n=r.addDays(t,O?-1:1),i=r.addMonths(t,O?-1:1),o=$v({utils:r,date:n,minDate:O?r.startOfMonth(i):n,maxDate:O?n:r.endOfMonth(i),isDateDisabled:N,timezone:R});V(o||n),e.preventDefault();break}case"Home":V(r.startOfWeek(t)),e.preventDefault();break;case"End":V(r.endOfWeek(t)),e.preventDefault();break;case"PageUp":V(r.addMonths(t,1)),e.preventDefault();break;case"PageDown":V(r.addMonths(t,-1)),e.preventDefault()}})),H=(0,tw.Z)(((e,t)=>V(t))),Z=(0,tw.Z)(((e,t)=>{F&&r.isSameDay(B,t)&&T?.(!1)})),W=r.getMonth(s),$=r.getYear(s),q=e.useMemo((()=>a.filter((e=>!!e)).map((e=>r.startOfDay(e)))),[r,a]),X=`${$}-${W}`,Y=e.useMemo((()=>e.createRef()),[X]),K=r.startOfWeek(L),J=e.useMemo((()=>{const e=r.startOfMonth(s),t=r.endOfMonth(s);return N(B)||r.isAfterDay(B,t)||r.isBeforeDay(B,e)?$v({utils:r,date:B,minDate:e,maxDate:t,disablePast:y,disableFuture:v,isDateDisabled:N,timezone:R}):B}),[s,v,y,B,N,r,R]),Q=e.useMemo((()=>{const e=r.setTimezone(s,R),t=r.getWeekArray(e);let n=r.addMonths(e,1);for(;I&&t.length<I;){const e=r.getWeekArray(n),i=r.isSameDay(t[t.length-1][0],e[0][0]);e.slice(i?1:0).forEach((e=>{t.length<I&&t.push(e)})),n=r.addMonths(n,1)}return t}),[s,I,r,R]);return(0,Wy.jsxs)($C,{role:"grid","aria-labelledby":C,className:D.root,children:[(0,Wy.jsxs)(qC,{role:"row",className:D.header,children:[A&&(0,Wy.jsx)(YC,{variant:"caption",role:"columnheader","aria-label":k.calendarWeekNumberHeaderLabel,className:D.weekNumberLabel,children:k.calendarWeekNumberHeaderText}),t_(r,L).map(((e,t)=>(0,Wy.jsx)(XC,{variant:"caption",role:"columnheader","aria-label":r.format(r.addDays(K,t),"weekday"),className:D.weekDayLabel,children:M(e)},t.toString())))]}),c?(0,Wy.jsx)(JC,{className:D.loadingContainer,children:f()}):(0,Wy.jsx)(QC,(0,_n.Z)({transKey:X,onExited:h,reduceAnimations:p,slideDirection:m,className:(0,Ey.Z)(o,D.slideTransition)},g,{nodeRef:Y,children:(0,Wy.jsx)(eA,{ref:Y,role:"rowgroup",className:D.monthContainer,children:Q.map(((e,t)=>(0,Wy.jsxs)(tA,{role:"row",className:D.weekContainer,"aria-rowindex":t+1,children:[A&&(0,Wy.jsx)(KC,{className:D.weekNumber,role:"rowheader","aria-label":k.calendarWeekNumberAriaLabelText(r.getWeekNumber(e[0])),children:k.calendarWeekNumberText(r.getWeekNumber(e[0]))}),e.map(((e,t)=>(0,Wy.jsx)(nA,{parentProps:n,day:e,selectedDays:q,focusableDay:J,onKeyDown:G,onFocus:H,onBlur:Z,onDaySelect:j,isDateDisabled:N,currentMonthNumber:W,isViewFocused:F,"aria-colindex":t+1},e.toString())))]},`week-${e[0]}`)))})}))]})}function iA(e){return(0,lv.ZP)("MuiPickersMonth",e)}const oA=(0,$y.Z)("MuiPickersMonth",["root","monthButton","disabled","selected"]),sA=["autoFocus","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","aria-label","monthsPerRow"],aA=(0,Iy.ZP)("div",{name:"MuiPickersMonth",slot:"Root",overridesResolver:(e,t)=>[t.root]})({display:"flex",alignItems:"center",justifyContent:"center",flexBasis:"33.3%",variants:[{props:{monthsPerRow:4},style:{flexBasis:"25%"}}]}),lA=(0,Iy.ZP)("button",{name:"MuiPickersMonth",slot:"MonthButton",overridesResolver:(e,t)=>[t.monthButton,{[`&.${oA.disabled}`]:t.disabled},{[`&.${oA.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return(0,_n.Z)({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{margin:"8px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.action.active,t.palette.action.hoverOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${oA.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${oA.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})})),cA=e.memo((function(t){const n=(0,Ry.Z)({props:t,name:"MuiPickersMonth"}),{autoFocus:r,children:i,disabled:o,selected:s,value:a,tabIndex:l,onClick:c,onKeyDown:u,onFocus:h,onBlur:d,"aria-current":p,"aria-label":f}=n,m=(0,My.Z)(n,sA),g=e.useRef(null),y=(e=>{const{disabled:t,selected:n,classes:r}=e,i={root:["root"],monthButton:["monthButton",t&&"disabled",n&&"selected"]};return(0,Cy.Z)(i,iA,r)})(n);return(0,Cv.Z)((()=>{r&&g.current?.focus()}),[r]),(0,Wy.jsx)(aA,(0,_n.Z)({className:y.root,ownerState:n},m,{children:(0,Wy.jsx)(lA,{ref:g,disabled:o,type:"button",role:"radio",tabIndex:o?-1:l,"aria-current":p,"aria-checked":s,"aria-label":f,onClick:e=>c(e,a),onKeyDown:e=>u(e,a),onFocus:e=>h(e,a),onBlur:e=>d(e,a),className:y.monthButton,ownerState:n,children:i})}))}));function uA(e){return(0,lv.ZP)("MuiMonthCalendar",e)}(0,$y.Z)("MuiMonthCalendar",["root"]);const hA=["className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","shouldDisableMonth","readOnly","disableHighlightToday","autoFocus","onMonthFocus","hasFocus","onFocusedViewChange","monthsPerRow","timezone","gridLabelId"],dA=(0,Iy.ZP)("div",{name:"MuiMonthCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexWrap:"wrap",alignContent:"stretch",padding:"0 4px",width:sC,boxSizing:"border-box"}),pA=e.forwardRef((function(t,n){const r=function(e,t){const n=$S(),r=qS(),i=(0,Ry.Z)({props:e,name:"MuiMonthCalendar"});return(0,_n.Z)({disableFuture:!1,disablePast:!1},i,{minDate:qv(n,i.minDate,r.minDate),maxDate:qv(n,i.maxDate,r.maxDate)})}(t),{className:i,value:o,defaultValue:s,referenceDate:a,disabled:l,disableFuture:c,disablePast:u,maxDate:h,minDate:d,onChange:p,shouldDisableMonth:f,readOnly:m,autoFocus:g=!1,onMonthFocus:y,hasFocus:v,onFocusedViewChange:_,monthsPerRow:x=3,timezone:b,gridLabelId:w}=r,S=(0,My.Z)(r,hA),{value:M,handleValueChange:E,timezone:T}=rM({name:"MonthCalendar",timezone:b,value:o,defaultValue:s,onChange:p,valueManager:L_}),C=YS(T),A=(0,Y_.Z)(),I=$S(),P=e.useMemo((()=>L_.getInitialReferenceValue({value:M,utils:I,props:r,timezone:T,referenceDate:a,granularity:h_.month})),[]),R=r,L=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},uA,t)})(R),D=e.useMemo((()=>I.getMonth(C)),[I,C]),O=e.useMemo((()=>null!=M?I.getMonth(M):null),[M,I]),[N,k]=e.useState((()=>O||I.getMonth(P))),[F,z]=(0,JS.Z)({name:"MonthCalendar",state:"hasFocus",controlled:v,default:g??!1}),B=(0,tw.Z)((e=>{z(e),_&&_(e)})),U=e.useCallback((e=>{const t=I.startOfMonth(u&&I.isAfter(C,d)?C:d),n=I.startOfMonth(c&&I.isBefore(C,h)?C:h),r=I.startOfMonth(e);return!!I.isBefore(r,t)||!!I.isAfter(r,n)||!!f&&f(r)}),[c,u,h,d,C,f,I]),j=(0,tw.Z)(((e,t)=>{if(m)return;const n=I.setMonth(M??P,t);E(n)})),V=(0,tw.Z)((e=>{U(I.setMonth(M??P,e))||(k(e),B(!0),y&&y(e))}));e.useEffect((()=>{k((e=>null!==O&&e!==O?O:e))}),[O]);const G=(0,tw.Z)(((e,t)=>{const n=12;switch(e.key){case"ArrowUp":V((n+t-3)%n),e.preventDefault();break;case"ArrowDown":V((n+t+3)%n),e.preventDefault();break;case"ArrowLeft":V((n+t+("ltr"===A.direction?-1:1))%n),e.preventDefault();break;case"ArrowRight":V((n+t+("ltr"===A.direction?1:-1))%n),e.preventDefault()}})),H=(0,tw.Z)(((e,t)=>{V(t)})),Z=(0,tw.Z)(((e,t)=>{N===t&&B(!1)}));return(0,Wy.jsx)(dA,(0,_n.Z)({ref:n,className:(0,Ey.Z)(L.root,i),ownerState:R,role:"radiogroup","aria-labelledby":w},S,{children:Xv(I,M??P).map((e=>{const t=I.getMonth(e),n=I.format(e,"monthShort"),r=I.format(e,"month"),i=t===O,o=l||U(e);return(0,Wy.jsx)(cA,{selected:i,value:t,onClick:j,onKeyDown:G,autoFocus:F&&t===N,disabled:o,tabIndex:t===N?0:-1,onFocus:H,onBlur:Z,"aria-current":D===t?"date":void 0,"aria-label":r,monthsPerRow:x,children:n},n)}))}))}));function fA(e){return(0,lv.ZP)("MuiPickersYear",e)}const mA=(0,$y.Z)("MuiPickersYear",["root","yearButton","selected","disabled"]),gA=["autoFocus","className","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","yearsPerRow"],yA=(0,Iy.ZP)("div",{name:"MuiPickersYear",slot:"Root",overridesResolver:(e,t)=>[t.root]})({display:"flex",alignItems:"center",justifyContent:"center",flexBasis:"33.3%",variants:[{props:{yearsPerRow:4},style:{flexBasis:"25%"}}]}),vA=(0,Iy.ZP)("button",{name:"MuiPickersYear",slot:"YearButton",overridesResolver:(e,t)=>[t.yearButton,{[`&.${mA.disabled}`]:t.disabled},{[`&.${mA.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return(0,_n.Z)({color:"unset",backgroundColor:"transparent",border:0,outline:0},t.typography.subtitle1,{margin:"6px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.focusOpacity})`:EC(t.palette.action.active,t.palette.action.focusOpacity)},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.action.active,t.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${mA.disabled}`]:{color:(t.vars||t).palette.text.secondary},[`&.${mA.selected}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.main,"&:focus, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}}})})),_A=e.memo((function(t){const n=(0,Ry.Z)({props:t,name:"MuiPickersYear"}),{autoFocus:r,className:i,children:o,disabled:s,selected:a,value:l,tabIndex:c,onClick:u,onKeyDown:h,onFocus:d,onBlur:p,"aria-current":f}=n,m=(0,My.Z)(n,gA),g=e.useRef(null),y=(e=>{const{disabled:t,selected:n,classes:r}=e,i={root:["root"],yearButton:["yearButton",t&&"disabled",n&&"selected"]};return(0,Cy.Z)(i,fA,r)})(n);return e.useEffect((()=>{r&&g.current.focus()}),[r]),(0,Wy.jsx)(yA,(0,_n.Z)({className:(0,Ey.Z)(y.root,i),ownerState:n},m,{children:(0,Wy.jsx)(vA,{ref:g,disabled:s,type:"button",role:"radio",tabIndex:s?-1:c,"aria-current":f,"aria-checked":a,onClick:e=>u(e,l),onKeyDown:e=>h(e,l),onFocus:e=>d(e,l),onBlur:e=>p(e,l),className:y.yearButton,ownerState:n,children:o})}))}));function xA(e){return(0,lv.ZP)("MuiYearCalendar",e)}(0,$y.Z)("MuiYearCalendar",["root"]);const bA=["autoFocus","className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsPerRow","timezone","gridLabelId"],wA=(0,Iy.ZP)("div",{name:"MuiYearCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"row",flexWrap:"wrap",overflowY:"auto",height:"100%",padding:"0 4px",width:sC,maxHeight:280,boxSizing:"border-box",position:"relative"}),SA=e.forwardRef((function(t,n){const r=function(e,t){const n=$S(),r=qS(),i=(0,Ry.Z)({props:e,name:"MuiYearCalendar"});return(0,_n.Z)({disablePast:!1,disableFuture:!1},i,{yearsPerRow:i.yearsPerRow??3,minDate:qv(n,i.minDate,r.minDate),maxDate:qv(n,i.maxDate,r.maxDate)})}(t),{autoFocus:i,className:o,value:s,defaultValue:a,referenceDate:l,disabled:c,disableFuture:u,disablePast:h,maxDate:d,minDate:p,onChange:f,readOnly:m,shouldDisableYear:g,onYearFocus:y,hasFocus:v,onFocusedViewChange:_,yearsPerRow:x,timezone:b,gridLabelId:w}=r,S=(0,My.Z)(r,bA),{value:M,handleValueChange:E,timezone:T}=rM({name:"YearCalendar",timezone:b,value:s,defaultValue:a,onChange:f,valueManager:L_}),C=YS(T),A=(0,Y_.Z)(),I=$S(),P=e.useMemo((()=>L_.getInitialReferenceValue({value:M,utils:I,props:r,timezone:T,referenceDate:l,granularity:h_.year})),[]),R=r,L=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},xA,t)})(R),D=e.useMemo((()=>I.getYear(C)),[I,C]),O=e.useMemo((()=>null!=M?I.getYear(M):null),[M,I]),[N,k]=e.useState((()=>O||I.getYear(P))),[F,z]=(0,JS.Z)({name:"YearCalendar",state:"hasFocus",controlled:v,default:i??!1}),B=(0,tw.Z)((e=>{z(e),_&&_(e)})),U=e.useCallback((e=>{if(h&&I.isBeforeYear(e,C))return!0;if(u&&I.isAfterYear(e,C))return!0;if(p&&I.isBeforeYear(e,p))return!0;if(d&&I.isAfterYear(e,d))return!0;if(!g)return!1;const t=I.startOfYear(e);return g(t)}),[u,h,d,p,C,g,I]),j=(0,tw.Z)(((e,t)=>{if(m)return;const n=I.setYear(M??P,t);E(n)})),V=(0,tw.Z)((e=>{U(I.setYear(M??P,e))||(k(e),B(!0),y?.(e))}));e.useEffect((()=>{k((e=>null!==O&&e!==O?O:e))}),[O]);const G=(0,tw.Z)(((e,t)=>{switch(e.key){case"ArrowUp":V(t-x),e.preventDefault();break;case"ArrowDown":V(t+x),e.preventDefault();break;case"ArrowLeft":V(t+("ltr"===A.direction?-1:1)),e.preventDefault();break;case"ArrowRight":V(t+("ltr"===A.direction?1:-1)),e.preventDefault()}})),H=(0,tw.Z)(((e,t)=>{V(t)})),Z=(0,tw.Z)(((e,t)=>{N===t&&B(!1)})),W=e.useRef(null),$=(0,F_.Z)(n,W);return e.useEffect((()=>{if(i||null===W.current)return;const e=W.current.querySelector('[tabindex="0"]');if(!e)return;const t=e.offsetHeight,n=e.offsetTop,r=W.current.clientHeight,o=W.current.scrollTop,s=n+t;t>r||n<o||(W.current.scrollTop=s-r/2-t/2)}),[i]),(0,Wy.jsx)(wA,(0,_n.Z)({ref:$,className:(0,Ey.Z)(L.root,o),ownerState:R,role:"radiogroup","aria-labelledby":w},S,{children:I.getYearRange([p,d]).map((e=>{const t=I.getYear(e),n=t===O,r=c||U(e);return(0,Wy.jsx)(_A,{selected:n,value:t,onClick:j,onKeyDown:G,autoFocus:F&&t===N,disabled:r,tabIndex:t===N?0:-1,onFocus:H,onBlur:Z,"aria-current":D===t?"date":void 0,yearsPerRow:x,children:I.format(e,"year")},I.format(e,"year"))}))}))}));function MA(t){let{onChange:n,onViewChange:r,openTo:i,view:o,views:s,autoFocus:a,focusedView:l,onFocusedViewChange:c}=t;const u=e.useRef(i),h=e.useRef(s),d=e.useRef(s.includes(i)?i:s[0]),[p,f]=(0,JS.Z)({name:"useViews",state:"view",controlled:o,default:d.current}),m=e.useRef(a?p:null),[g,y]=(0,JS.Z)({name:"useViews",state:"focusedView",controlled:l,default:m.current});e.useEffect((()=>{(u.current&&u.current!==i||h.current&&h.current.some((e=>!s.includes(e))))&&(f(s.includes(i)?i:s[0]),h.current=s,u.current=i)}),[i,f,p,s]);const v=s.indexOf(p),_=s[v-1]??null,x=s[v+1]??null,b=(0,tw.Z)(((e,t)=>{y(t?e:t=>e===t?null:t),c?.(e,t)})),w=(0,tw.Z)((e=>{b(e,!0),e!==p&&(f(e),r&&r(e))})),S=(0,tw.Z)((()=>{x&&w(x)})),M=(0,tw.Z)(((e,t,r)=>{const i="finish"===t,o=r?s.indexOf(r)<s.length-1:Boolean(x);if(n(e,i&&o?"partial":t,r),r&&r!==p){const e=s[s.indexOf(r)+1];e&&w(e)}else i&&S()}));return{view:p,setView:w,focusedView:g,setFocusedView:b,nextView:x,previousView:_,defaultView:s.includes(i)?i:s[0],goToNextView:S,setValueAndGoToNextView:M}}function EA(e){return(0,lv.ZP)("MuiPickersArrowSwitcher",e)}(0,$y.Z)("MuiPickersArrowSwitcher",["root","spacer","button"]);const TA=["children","className","slots","slotProps","isNextDisabled","isNextHidden","onGoToNext","nextLabel","isPreviousDisabled","isPreviousHidden","onGoToPrevious","previousLabel"],CA=["ownerState"],AA=["ownerState"],IA=(0,Iy.ZP)("div",{name:"MuiPickersArrowSwitcher",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex"}),PA=(0,Iy.ZP)("div",{name:"MuiPickersArrowSwitcher",slot:"Spacer",overridesResolver:(e,t)=>t.spacer})((e=>{let{theme:t}=e;return{width:t.spacing(3)}})),RA=(0,Iy.ZP)(MM,{name:"MuiPickersArrowSwitcher",slot:"Button",overridesResolver:(e,t)=>t.button})({variants:[{props:{hidden:!0},style:{visibility:"hidden"}}]}),LA=e.forwardRef((function(e,t){const n="rtl"===Zb().direction,r=(0,Ry.Z)({props:e,name:"MuiPickersArrowSwitcher"}),{children:i,className:o,slots:s,slotProps:a,isNextDisabled:l,isNextHidden:c,onGoToNext:u,nextLabel:h,isPreviousDisabled:d,isPreviousHidden:p,onGoToPrevious:f,previousLabel:m}=r,g=(0,My.Z)(r,TA),y=r,v=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],spacer:["spacer"],button:["button"]},EA,t)})(y),_={isDisabled:l,isHidden:c,goTo:u,label:h},x={isDisabled:d,isHidden:p,goTo:f,label:m},b=s?.previousIconButton??RA,w=gb({elementType:b,externalSlotProps:a?.previousIconButton,additionalProps:{size:"medium",title:x.label,"aria-label":x.label,disabled:x.isDisabled,edge:"end",onClick:x.goTo},ownerState:(0,_n.Z)({},y,{hidden:x.isHidden}),className:v.button}),S=s?.nextIconButton??RA,M=gb({elementType:S,externalSlotProps:a?.nextIconButton,additionalProps:{size:"medium",title:_.label,"aria-label":_.label,disabled:_.isDisabled,edge:"start",onClick:_.goTo},ownerState:(0,_n.Z)({},y,{hidden:_.isHidden}),className:v.button}),E=s?.leftArrowIcon??jM,T=gb({elementType:E,externalSlotProps:a?.leftArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),C=(0,My.Z)(T,CA),A=s?.rightArrowIcon??VM,I=gb({elementType:A,externalSlotProps:a?.rightArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),P=(0,My.Z)(I,AA);return(0,Wy.jsxs)(IA,(0,_n.Z)({ref:t,className:(0,Ey.Z)(v.root,o),ownerState:y},g,{children:[(0,Wy.jsx)(b,(0,_n.Z)({},w,{children:n?(0,Wy.jsx)(A,(0,_n.Z)({},P)):(0,Wy.jsx)(E,(0,_n.Z)({},C))})),i?(0,Wy.jsx)(LM,{variant:"subtitle1",component:"span",children:i}):(0,Wy.jsx)(PA,{className:v.spacer,ownerState:y}),(0,Wy.jsx)(S,(0,_n.Z)({},M,{children:n?(0,Wy.jsx)(E,(0,_n.Z)({},C)):(0,Wy.jsx)(A,(0,_n.Z)({},P))}))]}))})),DA=e=>(0,lv.ZP)("MuiPickersCalendarHeader",e),OA=(0,$y.Z)("MuiPickersCalendarHeader",["root","labelContainer","label","switchViewButton","switchViewIcon"]),NA=["slots","slotProps","currentMonth","disabled","disableFuture","disablePast","maxDate","minDate","onMonthChange","onViewChange","view","reduceAnimations","views","labelId","className","timezone","format"],kA=["ownerState"],FA=(0,Iy.ZP)("div",{name:"MuiPickersCalendarHeader",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",alignItems:"center",marginTop:12,marginBottom:4,paddingLeft:24,paddingRight:12,maxHeight:40,minHeight:40}),zA=(0,Iy.ZP)("div",{name:"MuiPickersCalendarHeader",slot:"LabelContainer",overridesResolver:(e,t)=>t.labelContainer})((e=>{let{theme:t}=e;return(0,_n.Z)({display:"flex",overflow:"hidden",alignItems:"center",cursor:"pointer",marginRight:"auto"},t.typography.body1,{fontWeight:t.typography.fontWeightMedium})})),BA=(0,Iy.ZP)("div",{name:"MuiPickersCalendarHeader",slot:"Label",overridesResolver:(e,t)=>t.label})({marginRight:6}),UA=(0,Iy.ZP)(MM,{name:"MuiPickersCalendarHeader",slot:"SwitchViewButton",overridesResolver:(e,t)=>t.switchViewButton})({marginRight:"auto",variants:[{props:{view:"year"},style:{[`.${OA.switchViewIcon}`]:{transform:"rotate(180deg)"}}}]}),jA=(0,Iy.ZP)(UM,{name:"MuiPickersCalendarHeader",slot:"SwitchViewIcon",overridesResolver:(e,t)=>t.switchViewIcon})((e=>{let{theme:t}=e;return{willChange:"transform",transition:t.transitions.create("transform"),transform:"rotate(0deg)"}})),VA=e.forwardRef((function(t,n){const r=XS(),i=$S(),o=(0,Ry.Z)({props:t,name:"MuiPickersCalendarHeader"}),{slots:s,slotProps:a,currentMonth:l,disabled:c,disableFuture:u,disablePast:h,maxDate:d,minDate:p,onMonthChange:f,onViewChange:m,view:g,reduceAnimations:y,views:v,labelId:_,className:x,timezone:b,format:w=`${i.formats.month} ${i.formats.year}`}=o,S=(0,My.Z)(o,NA),M=o,E=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],labelContainer:["labelContainer"],label:["label"],switchViewButton:["switchViewButton"],switchViewIcon:["switchViewIcon"]},DA,t)})(o),T=s?.switchViewButton??UA,C=gb({elementType:T,externalSlotProps:a?.switchViewButton,additionalProps:{size:"small","aria-label":r.calendarViewSwitchingButtonAriaLabel(g)},ownerState:M,className:E.switchViewButton}),A=s?.switchViewIcon??jA,I=gb({elementType:A,externalSlotProps:a?.switchViewIcon,ownerState:void 0,className:E.switchViewIcon}),P=(0,My.Z)(I,kA),R=function(t,n){let{disableFuture:r,maxDate:i,timezone:o}=n;const s=$S();return e.useMemo((()=>{const e=s.date(void 0,o),n=s.startOfMonth(r&&s.isBefore(e,i)?e:i);return!s.isAfter(n,t)}),[r,i,t,s,o])}(l,{disableFuture:u,maxDate:d,timezone:b}),L=function(t,n){let{disablePast:r,minDate:i,timezone:o}=n;const s=$S();return e.useMemo((()=>{const e=s.date(void 0,o),n=s.startOfMonth(r&&s.isAfter(e,i)?e:i);return!s.isBefore(n,t)}),[r,i,t,s,o])}(l,{disablePast:h,minDate:p,timezone:b});if(1===v.length&&"year"===v[0])return null;const D=i.formatByString(l,w);return(0,Wy.jsxs)(FA,(0,_n.Z)({},S,{ownerState:M,className:(0,Ey.Z)(x,E.root),ref:n,children:[(0,Wy.jsxs)(zA,{role:"presentation",onClick:()=>{if(1!==v.length&&m&&!c)if(2===v.length)m(v.find((e=>e!==g))||v[0]);else{const e=0!==v.indexOf(g)?0:1;m(v[e])}},ownerState:M,"aria-live":"polite",className:E.labelContainer,children:[(0,Wy.jsx)(wC,{reduceAnimations:y,transKey:D,children:(0,Wy.jsx)(BA,{id:_,ownerState:M,className:E.label,children:D})}),v.length>1&&!c&&(0,Wy.jsx)(T,(0,_n.Z)({},C,{children:(0,Wy.jsx)(A,(0,_n.Z)({},P))}))]}),(0,Wy.jsx)(gw,{in:"day"===g,children:(0,Wy.jsx)(LA,{slots:s,slotProps:a,onGoToPrevious:()=>f(i.addMonths(l,-1),"right"),isPreviousDisabled:L,previousLabel:r.previousMonth,onGoToNext:()=>f(i.addMonths(l,1),"left"),isNextDisabled:R,nextLabel:r.nextMonth})})]}))})),GA=(0,Iy.ZP)("div")({overflow:"hidden",width:sC,maxHeight:aC,display:"flex",flexDirection:"column",margin:"0 auto"}),HA="undefined"!=typeof navigator&&navigator.userAgent.match(/android\s(\d+)|OS\s(\d+)/i),ZA=HA&&HA[1]?parseInt(HA[1],10):null,WA=HA&&HA[2]?parseInt(HA[2],10):null,$A=ZA&&ZA<10||WA&&WA<13||!1,qA=()=>Dv("@media (prefers-reduced-motion: reduce)",{defaultMatches:!1})||$A,XA=e=>(0,lv.ZP)("MuiDateCalendar",e),YA=((0,$y.Z)("MuiDateCalendar",["root","viewTransitionContainer"]),["autoFocus","onViewChange","value","defaultValue","referenceDate","disableFuture","disablePast","onChange","onYearChange","onMonthChange","reduceAnimations","shouldDisableDate","shouldDisableMonth","shouldDisableYear","view","views","openTo","className","disabled","readOnly","minDate","maxDate","disableHighlightToday","focusedView","onFocusedViewChange","showDaysOutsideCurrentMonth","fixedWeekNumber","dayOfWeekFormatter","slots","slotProps","loading","renderLoading","displayWeekNumber","yearsPerRow","monthsPerRow","timezone"]),KA=(0,Iy.ZP)(GA,{name:"MuiDateCalendar",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"column",height:aC}),JA=(0,Iy.ZP)(wC,{name:"MuiDateCalendar",slot:"ViewTransitionContainer",overridesResolver:(e,t)=>t.viewTransitionContainer})({}),QA=e.forwardRef((function(t,n){const r=$S(),i=(0,O_.Z)(),o=function(e,t){const n=$S(),r=qS(),i=qA(),o=(0,Ry.Z)({props:e,name:"MuiDateCalendar"});return(0,_n.Z)({},o,{loading:o.loading??!1,disablePast:o.disablePast??!1,disableFuture:o.disableFuture??!1,openTo:o.openTo??"day",views:o.views??["year","day"],reduceAnimations:o.reduceAnimations??i,renderLoading:o.renderLoading??(()=>(0,Wy.jsx)("span",{children:"..."})),minDate:qv(n,o.minDate,r.minDate),maxDate:qv(n,o.maxDate,r.maxDate)})}(t),{autoFocus:s,onViewChange:a,value:l,defaultValue:c,referenceDate:u,disableFuture:h,disablePast:d,onChange:p,onYearChange:f,onMonthChange:m,reduceAnimations:g,shouldDisableDate:y,shouldDisableMonth:v,shouldDisableYear:_,view:x,views:b,openTo:w,className:S,disabled:M,readOnly:E,minDate:T,maxDate:C,disableHighlightToday:A,focusedView:I,onFocusedViewChange:P,showDaysOutsideCurrentMonth:R,fixedWeekNumber:L,dayOfWeekFormatter:D,slots:O,slotProps:N,loading:k,renderLoading:F,displayWeekNumber:z,yearsPerRow:B,monthsPerRow:U,timezone:j}=o,V=(0,My.Z)(o,YA),{value:G,handleValueChange:H,timezone:Z}=rM({name:"DateCalendar",timezone:j,value:l,defaultValue:c,onChange:p,valueManager:L_}),{view:W,setView:$,focusedView:q,setFocusedView:X,goToNextView:Y,setValueAndGoToNextView:K}=MA({view:x,views:b,openTo:w,onChange:H,onViewChange:a,autoFocus:s,focusedView:I,onFocusedViewChange:P}),{referenceDate:J,calendarState:Q,changeFocusedDay:ee,changeMonth:te,handleChangeMonth:ne,isDateDisabled:re,onMonthSwitchingAnimationEnd:ie}=(t=>{const{value:n,referenceDate:r,disableFuture:i,disablePast:o,disableSwitchToMonthOnDayFocus:s=!1,maxDate:a,minDate:l,onMonthChange:c,reduceAnimations:u,shouldDisableDate:h,timezone:d}=t,p=$S(),f=e.useRef(((e,t,n)=>(r,i)=>{switch(i.type){case"changeMonth":return(0,_n.Z)({},r,{slideDirection:i.direction,currentMonth:i.newMonth,isMonthSwitchingAnimating:!e});case"finishMonthSwitchingAnimation":return(0,_n.Z)({},r,{isMonthSwitchingAnimating:!1});case"changeFocusedDay":{if(null!=r.focusedDay&&null!=i.focusedDay&&n.isSameDay(i.focusedDay,r.focusedDay))return r;const o=null!=i.focusedDay&&!t&&!n.isSameMonth(r.currentMonth,i.focusedDay);return(0,_n.Z)({},r,{focusedDay:i.focusedDay,isMonthSwitchingAnimating:o&&!e&&!i.withoutMonthSwitchingAnimation,currentMonth:o?n.startOfMonth(i.focusedDay):r.currentMonth,slideDirection:null!=i.focusedDay&&n.isAfterDay(i.focusedDay,r.currentMonth)?"left":"right"})}default:throw new Error("missing support")}})(Boolean(u),s,p)).current,m=e.useMemo((()=>L_.getInitialReferenceValue({value:n,utils:p,timezone:d,props:t,referenceDate:r,granularity:h_.day})),[]),[g,y]=e.useReducer(f,{isMonthSwitchingAnimating:!1,focusedDay:m,currentMonth:p.startOfMonth(m),slideDirection:"left"}),v=e.useCallback((e=>{y((0,_n.Z)({type:"changeMonth"},e)),c&&c(e.newMonth)}),[c]),_=e.useCallback((e=>{const t=e;p.isSameMonth(t,g.currentMonth)||v({newMonth:p.startOfMonth(t),direction:p.isAfterDay(t,g.currentMonth)?"left":"right"})}),[g.currentMonth,v,p]),x=_C({shouldDisableDate:h,minDate:l,maxDate:a,disableFuture:i,disablePast:o,timezone:d}),b=e.useCallback((()=>{y({type:"finishMonthSwitchingAnimation"})}),[]),w=(0,tw.Z)(((e,t)=>{x(e)||y({type:"changeFocusedDay",focusedDay:e,withoutMonthSwitchingAnimation:t})}));return{referenceDate:m,calendarState:g,changeMonth:_,changeFocusedDay:w,isDateDisabled:x,onMonthSwitchingAnimationEnd:b,handleChangeMonth:v}})({value:G,referenceDate:u,reduceAnimations:g,onMonthChange:m,minDate:T,maxDate:C,shouldDisableDate:y,disablePast:d,disableFuture:h,timezone:Z}),oe=M&&G||T,se=M&&G||C,ae=`${i}-grid-label`,le=null!==q,ce=O?.calendarHeader??VA,ue=gb({elementType:ce,externalSlotProps:N?.calendarHeader,additionalProps:{views:b,view:W,currentMonth:Q.currentMonth,onViewChange:$,onMonthChange:(e,t)=>ne({newMonth:e,direction:t}),minDate:oe,maxDate:se,disabled:M,disablePast:d,disableFuture:h,reduceAnimations:g,timezone:Z,labelId:ae},ownerState:o}),he=(0,tw.Z)((e=>{const t=r.startOfMonth(e),n=r.endOfMonth(e),i=re(e)?$v({utils:r,date:e,minDate:r.isBefore(T,t)?t:T,maxDate:r.isAfter(C,n)?n:C,disablePast:d,disableFuture:h,isDateDisabled:re,timezone:Z}):e;i?(K(i,"finish"),m?.(t)):(Y(),te(t)),ee(i,!0)})),de=(0,tw.Z)((e=>{const t=r.startOfYear(e),n=r.endOfYear(e),i=re(e)?$v({utils:r,date:e,minDate:r.isBefore(T,t)?t:T,maxDate:r.isAfter(C,n)?n:C,disablePast:d,disableFuture:h,isDateDisabled:re,timezone:Z}):e;i?(K(i,"finish"),f?.(i)):(Y(),te(t)),ee(i,!0)})),pe=(0,tw.Z)((e=>H(e?Wv(r,e,G??J):e,"finish",W)));e.useEffect((()=>{null!=G&&r.isValid(G)&&te(G)}),[G]);const fe=o,me=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],viewTransitionContainer:["viewTransitionContainer"]},XA,t)})(fe),ge={disablePast:d,disableFuture:h,maxDate:C,minDate:T},ye={disableHighlightToday:A,readOnly:E,disabled:M,timezone:Z,gridLabelId:ae},ve=e.useRef(W);e.useEffect((()=>{ve.current!==W&&(q===ve.current&&X(W,!0),ve.current=W)}),[q,X,W]);const _e=e.useMemo((()=>[G]),[G]);return(0,Wy.jsxs)(KA,(0,_n.Z)({ref:n,className:(0,Ey.Z)(me.root,S),ownerState:fe},V,{children:[(0,Wy.jsx)(ce,(0,_n.Z)({},ue,{slots:O,slotProps:N})),(0,Wy.jsx)(JA,{reduceAnimations:g,className:me.viewTransitionContainer,transKey:W,ownerState:fe,children:(0,Wy.jsxs)("div",{children:["year"===W&&(0,Wy.jsx)(SA,(0,_n.Z)({},ge,ye,{value:G,onChange:de,shouldDisableYear:_,hasFocus:le,onFocusedViewChange:e=>X("year",e),yearsPerRow:B,referenceDate:J})),"month"===W&&(0,Wy.jsx)(pA,(0,_n.Z)({},ge,ye,{hasFocus:le,className:S,value:G,onChange:he,shouldDisableMonth:v,onFocusedViewChange:e=>X("month",e),monthsPerRow:U,referenceDate:J})),"day"===W&&(0,Wy.jsx)(rA,(0,_n.Z)({},Q,ge,ye,{onMonthSwitchingAnimationEnd:ie,onFocusedDayChange:ee,reduceAnimations:g,selectedDays:_e,onSelectedDaysChange:pe,shouldDisableDate:y,shouldDisableMonth:v,shouldDisableYear:_,hasFocus:le,onFocusedViewChange:e=>X("day",e),showDaysOutsideCurrentMonth:R,fixedWeekNumber:L,dayOfWeekFormatter:D,displayWeekNumber:z,slots:O,slotProps:N,loading:k,renderLoading:F}))]})})]}))})),eI=e=>{let{view:t,onViewChange:n,views:r,focusedView:i,onFocusedViewChange:o,value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minDate:f,maxDate:m,shouldDisableDate:g,shouldDisableMonth:y,shouldDisableYear:v,reduceAnimations:_,onMonthChange:x,monthsPerRow:b,onYearChange:w,yearsPerRow:S,slots:M,slotProps:E,loading:T,renderLoading:C,disableHighlightToday:A,readOnly:I,disabled:P,showDaysOutsideCurrentMonth:R,dayOfWeekFormatter:L,sx:D,autoFocus:O,fixedWeekNumber:N,displayWeekNumber:k,timezone:F}=e;return(0,Wy.jsx)(QA,{view:t,onViewChange:n,views:r.filter(Qv),focusedView:i&&Qv(i)?i:null,onFocusedViewChange:o,value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minDate:f,maxDate:m,shouldDisableDate:g,shouldDisableMonth:y,shouldDisableYear:v,reduceAnimations:_,onMonthChange:x,monthsPerRow:b,onYearChange:w,yearsPerRow:S,slots:M,slotProps:E,loading:T,renderLoading:C,disableHighlightToday:A,readOnly:I,disabled:P,showDaysOutsideCurrentMonth:R,dayOfWeekFormatter:L,sx:D,autoFocus:O,fixedWeekNumber:N,displayWeekNumber:k,timezone:F})};function tI(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function nI(e){return e instanceof tI(e).Element||e instanceof Element}function rI(e){return e instanceof tI(e).HTMLElement||e instanceof HTMLElement}function iI(e){return"undefined"!=typeof ShadowRoot&&(e instanceof tI(e).ShadowRoot||e instanceof ShadowRoot)}var oI=Math.max,sI=Math.min,aI=Math.round;function lI(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function cI(){return!/^((?!chrome|android).)*safari/i.test(lI())}function uI(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),i=1,o=1;t&&rI(e)&&(i=e.offsetWidth>0&&aI(r.width)/e.offsetWidth||1,o=e.offsetHeight>0&&aI(r.height)/e.offsetHeight||1);var s=(nI(e)?tI(e):window).visualViewport,a=!cI()&&n,l=(r.left+(a&&s?s.offsetLeft:0))/i,c=(r.top+(a&&s?s.offsetTop:0))/o,u=r.width/i,h=r.height/o;return{width:u,height:h,top:c,right:l+u,bottom:c+h,left:l,x:l,y:c}}function hI(e){var t=tI(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function dI(e){return e?(e.nodeName||"").toLowerCase():null}function pI(e){return((nI(e)?e.ownerDocument:e.document)||window.document).documentElement}function fI(e){return uI(pI(e)).left+hI(e).scrollLeft}function mI(e){return tI(e).getComputedStyle(e)}function gI(e){var t=mI(e),n=t.overflow,r=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function yI(e,t,n){void 0===n&&(n=!1);var r,i,o=rI(t),s=rI(t)&&function(e){var t=e.getBoundingClientRect(),n=aI(t.width)/e.offsetWidth||1,r=aI(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(t),a=pI(t),l=uI(e,s,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(o||!o&&!n)&&(("body"!==dI(t)||gI(a))&&(c=(r=t)!==tI(r)&&rI(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:hI(r)),rI(t)?((u=uI(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):a&&(u.x=fI(a))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function vI(e){var t=uI(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function _I(e){return"html"===dI(e)?e:e.assignedSlot||e.parentNode||(iI(e)?e.host:null)||pI(e)}function xI(e){return["html","body","#document"].indexOf(dI(e))>=0?e.ownerDocument.body:rI(e)&&gI(e)?e:xI(_I(e))}function bI(e,t){var n;void 0===t&&(t=[]);var r=xI(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),o=tI(r),s=i?[o].concat(o.visualViewport||[],gI(r)?r:[]):r,a=t.concat(s);return i?a:a.concat(bI(_I(s)))}function wI(e){return["table","td","th"].indexOf(dI(e))>=0}function SI(e){return rI(e)&&"fixed"!==mI(e).position?e.offsetParent:null}function MI(e){for(var t=tI(e),n=SI(e);n&&wI(n)&&"static"===mI(n).position;)n=SI(n);return n&&("html"===dI(n)||"body"===dI(n)&&"static"===mI(n).position)?t:n||function(e){var t=/firefox/i.test(lI());if(/Trident/i.test(lI())&&rI(e)&&"fixed"===mI(e).position)return null;var n=_I(e);for(iI(n)&&(n=n.host);rI(n)&&["html","body"].indexOf(dI(n))<0;){var r=mI(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(e)||t}var EI="top",TI="bottom",CI="right",AI="left",II="auto",PI=[EI,TI,CI,AI],RI="start",LI="end",DI="viewport",OI="popper",NI=PI.reduce((function(e,t){return e.concat([t+"-"+RI,t+"-"+LI])}),[]),kI=[].concat(PI,[II]).reduce((function(e,t){return e.concat([t,t+"-"+RI,t+"-"+LI])}),[]),FI=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function zI(e){var t=new Map,n=new Set,r=[];function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&i(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||i(e)})),r}function BI(e){var t;return function(){return t||(t=new Promise((function(n){Promise.resolve().then((function(){t=void 0,n(e())}))}))),t}}var UI={placement:"bottom",modifiers:[],strategy:"absolute"};function jI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function VI(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,o=void 0===i?UI:i;return function(e,t,n){void 0===n&&(n=o);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},UI,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},s=[],a=!1,l={state:i,setOptions:function(n){var a="function"==typeof n?n(i.options):n;c(),i.options=Object.assign({},o,i.options,a),i.scrollParents={reference:nI(e)?bI(e):e.contextElement?bI(e.contextElement):[],popper:bI(t)};var u,h,d=function(e){var t=zI(e);return FI.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}((u=[].concat(r,i.options.modifiers),h=u.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{}),Object.keys(h).map((function(e){return h[e]}))));return i.orderedModifiers=d.filter((function(e){return e.enabled})),i.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,o=e.effect;if("function"==typeof o){var a=o({state:i,name:t,instance:l,options:r});s.push(a||function(){})}})),l.update()},forceUpdate:function(){if(!a){var e=i.elements,t=e.reference,n=e.popper;if(jI(t,n)){i.rects={reference:yI(t,MI(n),"fixed"===i.options.strategy),popper:vI(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(e){return i.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var o=i.orderedModifiers[r],s=o.fn,c=o.options,u=void 0===c?{}:c,h=o.name;"function"==typeof s&&(i=s({state:i,options:u,name:h,instance:l})||i)}else i.reset=!1,r=-1}}},update:BI((function(){return new Promise((function(e){l.forceUpdate(),e(i)}))})),destroy:function(){c(),a=!0}};if(!jI(e,t))return l;function c(){s.forEach((function(e){return e()})),s=[]}return l.setOptions(n).then((function(e){!a&&n.onFirstUpdate&&n.onFirstUpdate(e)})),l}}var GI={passive:!0};function HI(e){return e.split("-")[0]}function ZI(e){return e.split("-")[1]}function WI(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function $I(e){var t,n=e.reference,r=e.element,i=e.placement,o=i?HI(i):null,s=i?ZI(i):null,a=n.x+n.width/2-r.width/2,l=n.y+n.height/2-r.height/2;switch(o){case EI:t={x:a,y:n.y-r.height};break;case TI:t={x:a,y:n.y+n.height};break;case CI:t={x:n.x+n.width,y:l};break;case AI:t={x:n.x-r.width,y:l};break;default:t={x:n.x,y:n.y}}var c=o?WI(o):null;if(null!=c){var u="y"===c?"height":"width";switch(s){case RI:t[c]=t[c]-(n[u]/2-r[u]/2);break;case LI:t[c]=t[c]+(n[u]/2-r[u]/2)}}return t}var qI={top:"auto",right:"auto",bottom:"auto",left:"auto"};function XI(e){var t,n=e.popper,r=e.popperRect,i=e.placement,o=e.variation,s=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,u=e.roundOffsets,h=e.isFixed,d=s.x,p=void 0===d?0:d,f=s.y,m=void 0===f?0:f,g="function"==typeof u?u({x:p,y:m}):{x:p,y:m};p=g.x,m=g.y;var y=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),_=AI,x=EI,b=window;if(c){var w=MI(n),S="clientHeight",M="clientWidth";w===tI(n)&&"static"!==mI(w=pI(n)).position&&"absolute"===a&&(S="scrollHeight",M="scrollWidth"),(i===EI||(i===AI||i===CI)&&o===LI)&&(x=TI,m-=(h&&w===b&&b.visualViewport?b.visualViewport.height:w[S])-r.height,m*=l?1:-1),i!==AI&&(i!==EI&&i!==TI||o!==LI)||(_=CI,p-=(h&&w===b&&b.visualViewport?b.visualViewport.width:w[M])-r.width,p*=l?1:-1)}var E,T=Object.assign({position:a},c&&qI),C=!0===u?function(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1;return{x:aI(n*i)/i||0,y:aI(r*i)/i||0}}({x:p,y:m},tI(n)):{x:p,y:m};return p=C.x,m=C.y,l?Object.assign({},T,((E={})[x]=v?"0":"",E[_]=y?"0":"",E.transform=(b.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",E)):Object.assign({},T,((t={})[x]=v?m+"px":"",t[_]=y?p+"px":"",t.transform="",t))}var YI={left:"right",right:"left",bottom:"top",top:"bottom"};function KI(e){return e.replace(/left|right|bottom|top/g,(function(e){return YI[e]}))}var JI={start:"end",end:"start"};function QI(e){return e.replace(/start|end/g,(function(e){return JI[e]}))}function eP(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&iI(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function tP(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function nP(e,t,n){return t===DI?tP(function(e,t){var n=tI(e),r=pI(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;var c=cI();(c||!c&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a+fI(e),y:l}}(e,n)):nI(t)?function(e,t){var n=uI(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):tP(function(e){var t,n=pI(e),r=hI(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=oI(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=oI(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+fI(e),l=-r.scrollTop;return"rtl"===mI(i||n).direction&&(a+=oI(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:s,x:a,y:l}}(pI(e)))}function rP(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function iP(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function oP(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=void 0===r?e.placement:r,o=n.strategy,s=void 0===o?e.strategy:o,a=n.boundary,l=void 0===a?"clippingParents":a,c=n.rootBoundary,u=void 0===c?DI:c,h=n.elementContext,d=void 0===h?OI:h,p=n.altBoundary,f=void 0!==p&&p,m=n.padding,g=void 0===m?0:m,y=rP("number"!=typeof g?g:iP(g,PI)),v=d===OI?"reference":OI,_=e.rects.popper,x=e.elements[f?v:d],b=function(e,t,n,r){var i="clippingParents"===t?function(e){var t=bI(_I(e)),n=["absolute","fixed"].indexOf(mI(e).position)>=0&&rI(e)?MI(e):e;return nI(n)?t.filter((function(e){return nI(e)&&eP(e,n)&&"body"!==dI(e)})):[]}(e):[].concat(t),o=[].concat(i,[n]),s=o[0],a=o.reduce((function(t,n){var i=nP(e,n,r);return t.top=oI(i.top,t.top),t.right=sI(i.right,t.right),t.bottom=sI(i.bottom,t.bottom),t.left=oI(i.left,t.left),t}),nP(e,s,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}(nI(x)?x:x.contextElement||pI(e.elements.popper),l,u,s),w=uI(e.elements.reference),S=$I({reference:w,element:_,strategy:"absolute",placement:i}),M=tP(Object.assign({},_,S)),E=d===OI?M:w,T={top:b.top-E.top+y.top,bottom:E.bottom-b.bottom+y.bottom,left:b.left-E.left+y.left,right:E.right-b.right+y.right},C=e.modifiersData.offset;if(d===OI&&C){var A=C[i];Object.keys(T).forEach((function(e){var t=[CI,TI].indexOf(e)>=0?1:-1,n=[EI,TI].indexOf(e)>=0?"y":"x";T[e]+=A[n]*t}))}return T}const sP={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var i=n.mainAxis,o=void 0===i||i,s=n.altAxis,a=void 0===s||s,l=n.fallbackPlacements,c=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,p=n.flipVariations,f=void 0===p||p,m=n.allowedAutoPlacements,g=t.options.placement,y=HI(g),v=l||(y!==g&&f?function(e){if(HI(e)===II)return[];var t=KI(e);return[QI(e),t,QI(t)]}(g):[KI(g)]),_=[g].concat(v).reduce((function(e,n){return e.concat(HI(n)===II?function(e,t){void 0===t&&(t={});var n=t,r=n.placement,i=n.boundary,o=n.rootBoundary,s=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?kI:l,u=ZI(r),h=u?a?NI:NI.filter((function(e){return ZI(e)===u})):PI,d=h.filter((function(e){return c.indexOf(e)>=0}));0===d.length&&(d=h);var p=d.reduce((function(t,n){return t[n]=oP(e,{placement:n,boundary:i,rootBoundary:o,padding:s})[HI(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:n,boundary:u,rootBoundary:h,padding:c,flipVariations:f,allowedAutoPlacements:m}):n)}),[]),x=t.rects.reference,b=t.rects.popper,w=new Map,S=!0,M=_[0],E=0;E<_.length;E++){var T=_[E],C=HI(T),A=ZI(T)===RI,I=[EI,TI].indexOf(C)>=0,P=I?"width":"height",R=oP(t,{placement:T,boundary:u,rootBoundary:h,altBoundary:d,padding:c}),L=I?A?CI:AI:A?TI:EI;x[P]>b[P]&&(L=KI(L));var D=KI(L),O=[];if(o&&O.push(R[C]<=0),a&&O.push(R[L]<=0,R[D]<=0),O.every((function(e){return e}))){M=T,S=!1;break}w.set(T,O)}if(S)for(var N=function(e){var t=_.find((function(t){var n=w.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return M=t,"break"},k=f?3:1;k>0&&"break"!==N(k);k--);t.placement!==M&&(t.modifiersData[r]._skip=!0,t.placement=M,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function aP(e,t,n){return oI(e,sI(t,n))}const lP={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.mainAxis,o=void 0===i||i,s=n.altAxis,a=void 0!==s&&s,l=n.boundary,c=n.rootBoundary,u=n.altBoundary,h=n.padding,d=n.tether,p=void 0===d||d,f=n.tetherOffset,m=void 0===f?0:f,g=oP(t,{boundary:l,rootBoundary:c,padding:h,altBoundary:u}),y=HI(t.placement),v=ZI(t.placement),_=!v,x=WI(y),b="x"===x?"y":"x",w=t.modifiersData.popperOffsets,S=t.rects.reference,M=t.rects.popper,E="function"==typeof m?m(Object.assign({},t.rects,{placement:t.placement})):m,T="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(w){if(o){var I,P="y"===x?EI:AI,R="y"===x?TI:CI,L="y"===x?"height":"width",D=w[x],O=D+g[P],N=D-g[R],k=p?-M[L]/2:0,F=v===RI?S[L]:M[L],z=v===RI?-M[L]:-S[L],B=t.elements.arrow,U=p&&B?vI(B):{width:0,height:0},j=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},V=j[P],G=j[R],H=aP(0,S[L],U[L]),Z=_?S[L]/2-k-H-V-T.mainAxis:F-H-V-T.mainAxis,W=_?-S[L]/2+k+H+G+T.mainAxis:z+H+G+T.mainAxis,$=t.elements.arrow&&MI(t.elements.arrow),q=$?"y"===x?$.clientTop||0:$.clientLeft||0:0,X=null!=(I=null==C?void 0:C[x])?I:0,Y=D+W-X,K=aP(p?sI(O,D+Z-X-q):O,D,p?oI(N,Y):N);w[x]=K,A[x]=K-D}if(a){var J,Q="x"===x?EI:AI,ee="x"===x?TI:CI,te=w[b],ne="y"===b?"height":"width",re=te+g[Q],ie=te-g[ee],oe=-1!==[EI,AI].indexOf(y),se=null!=(J=null==C?void 0:C[b])?J:0,ae=oe?re:te-S[ne]-M[ne]-se+T.altAxis,le=oe?te+S[ne]+M[ne]-se-T.altAxis:ie,ce=p&&oe?function(e,t,n){var r=aP(e,t,n);return r>n?n:r}(ae,te,le):aP(p?ae:re,te,p?le:ie);w[b]=ce,A[b]=ce-te}t.modifiersData[r]=A}},requiresIfExists:["offset"]};function cP(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function uP(e){return[EI,CI,TI,AI].some((function(t){return e[t]>=0}))}var hP=VI({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,o=void 0===i||i,s=r.resize,a=void 0===s||s,l=tI(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&c.forEach((function(e){e.addEventListener("scroll",n.update,GI)})),a&&l.addEventListener("resize",n.update,GI),function(){o&&c.forEach((function(e){e.removeEventListener("scroll",n.update,GI)})),a&&l.removeEventListener("resize",n.update,GI)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name;t.modifiersData[n]=$I({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,s=void 0===o||o,a=n.roundOffsets,l=void 0===a||a,c={placement:HI(t.placement),variation:ZI(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,XI(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,XI(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e];rI(i)&&dI(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],i=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce((function(e,t){return e[t]="",e}),{});rI(r)&&dI(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,i=n.offset,o=void 0===i?[0,0]:i,s=kI.reduce((function(e,n){return e[n]=function(e,t,n){var r=HI(e),i=[AI,EI].indexOf(r)>=0?-1:1,o="function"==typeof n?n(Object.assign({},t,{placement:e})):n,s=o[0],a=o[1];return s=s||0,a=(a||0)*i,[AI,CI].indexOf(r)>=0?{x:a,y:s}:{x:s,y:a}}(n,t.rects,o),e}),{}),a=s[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=s}},sP,lP,{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,i=e.options,o=n.elements.arrow,s=n.modifiersData.popperOffsets,a=HI(n.placement),l=WI(a),c=[AI,CI].indexOf(a)>=0?"height":"width";if(o&&s){var u=function(e,t){return rP("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:iP(e,PI))}(i.padding,n),h=vI(o),d="y"===l?EI:AI,p="y"===l?TI:CI,f=n.rects.reference[c]+n.rects.reference[l]-s[l]-n.rects.popper[c],m=s[l]-n.rects.reference[l],g=MI(o),y=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,v=f/2-m/2,_=u[d],x=y-h[c]-u[p],b=y/2-h[c]/2+v,w=aP(_,b,x),S=l;n.modifiersData[r]=((t={})[S]=w,t.centerOffset=w-b,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&eP(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,s=oP(t,{elementContext:"reference"}),a=oP(t,{altBoundary:!0}),l=cP(s,r),c=cP(a,i,o),u=uP(l),h=uP(c);t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}}]});const dP="base";function pP(e,t){const n=lv._v[t];return n?`${dP}--${n}`:function(e,t){return`${dP}-${e}-${t}`}(e,t)}function fP(e,t){const n={};return t.forEach((t=>{n[t]=pP(e,t)})),n}const mP="Popper";function gP(e){return pP(mP,e)}fP(mP,["root"]);const yP={disableDefaultClasses:!1},vP=e.createContext(yP);const _P=["anchorEl","children","direction","disablePortal","modifiers","open","placement","popperOptions","popperRef","slotProps","slots","TransitionProps","ownerState"],xP=["anchorEl","children","container","direction","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition","slotProps","slots"];function bP(e){return"function"==typeof e?e():e}const wP={},SP=e.forwardRef((function(t,n){var r;const{anchorEl:i,children:o,direction:s,disablePortal:a,modifiers:l,open:c,placement:u,popperOptions:h,popperRef:d,slotProps:p={},slots:f={},TransitionProps:m}=t,g=(0,My.Z)(t,_P),y=e.useRef(null),v=(0,F_.Z)(y,n),_=e.useRef(null),x=(0,F_.Z)(_,d),b=e.useRef(x);(0,Cv.Z)((()=>{b.current=x}),[x]),e.useImperativeHandle(d,(()=>_.current),[]);const w=function(e,t){if("ltr"===t)return e;switch(e){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return e}}(u,s),[S,M]=e.useState(w),[E,T]=e.useState(bP(i));e.useEffect((()=>{_.current&&_.current.forceUpdate()})),e.useEffect((()=>{i&&T(bP(i))}),[i]),(0,Cv.Z)((()=>{if(!E||!c)return;let e=[{name:"preventOverflow",options:{altBoundary:a}},{name:"flip",options:{altBoundary:a}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:e=>{let{state:t}=e;M(t.placement)}}];null!=l&&(e=e.concat(l)),h&&null!=h.modifiers&&(e=e.concat(h.modifiers));const t=hP(E,y.current,(0,_n.Z)({placement:w},h,{modifiers:e}));return b.current(t),()=>{t.destroy(),b.current(null)}}),[E,a,l,c,h,w]);const C={placement:S};null!==m&&(C.TransitionProps=m);const A=(0,Cy.Z)({root:["root"]},function(t){const{disableDefaultClasses:n}=e.useContext(vP);return e=>n?"":t(e)}(gP)),I=null!=(r=f.root)?r:"div",P=gb({elementType:I,externalSlotProps:p.root,externalForwardedProps:g,additionalProps:{role:"tooltip",ref:v},ownerState:t,className:A.root});return(0,Wy.jsx)(I,(0,_n.Z)({},P,{children:"function"==typeof o?o(C):o}))})),MP=e.forwardRef((function(t,n){const{anchorEl:r,children:i,container:o,direction:s="ltr",disablePortal:a=!1,keepMounted:l=!1,modifiers:c,open:u,placement:h="bottom",popperOptions:d=wP,popperRef:p,style:f,transition:m=!1,slotProps:g={},slots:y={}}=t,v=(0,My.Z)(t,xP),[_,x]=e.useState(!0);if(!l&&!u&&(!m||_))return null;let b;if(o)b=o;else if(r){const e=bP(r);b=e&&void 0!==e.nodeType?(0,ew.Z)(e).body:(0,ew.Z)(null).body}const w=u||!l||m&&!_?void 0:"none",S=m?{in:u,onEnter:()=>{x(!1)},onExited:()=>{x(!0)}}:void 0;return(0,Wy.jsx)(pw,{disablePortal:a,container:b,children:(0,Wy.jsx)(SP,(0,_n.Z)({anchorEl:r,direction:s,disablePortal:a,modifiers:c,ref:n,open:m?!_:u,placement:h,popperOptions:d,popperRef:p,slotProps:g,slots:y},v,{style:(0,_n.Z)({position:"fixed",top:0,left:0,display:w},f),TransitionProps:S,children:i}))})}));var EP=i(653);const TP=["anchorEl","component","components","componentsProps","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","transition","slots","slotProps"],CP=(0,Iy.ZP)(MP,{name:"MuiPopper",slot:"Root",overridesResolver:(e,t)=>t.root})({}),AP=e.forwardRef((function(e,t){var n;const r=(0,EP.Z)(),i=(0,Ry.Z)({props:e,name:"MuiPopper"}),{anchorEl:o,component:s,components:a,componentsProps:l,container:c,disablePortal:u,keepMounted:h,modifiers:d,open:p,placement:f,popperOptions:m,popperRef:g,transition:y,slots:v,slotProps:_}=i,x=(0,My.Z)(i,TP),b=null!=(n=null==v?void 0:v.root)?n:null==a?void 0:a.Root,w=(0,_n.Z)({anchorEl:o,container:c,disablePortal:u,keepMounted:h,modifiers:d,open:p,placement:f,popperOptions:m,popperRef:g,transition:y},x);return(0,Wy.jsx)(CP,(0,_n.Z)({as:s,direction:null==r?void 0:r.direction,slots:{root:b},slotProps:null!=_?_:l},w,{ref:t}))}));function IP(e){return(0,lv.ZP)("MuiPickersPopper",e)}(0,$y.Z)("MuiPickersPopper",["root","paper"]);const PP=["PaperComponent","popperPlacement","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],RP=(0,Iy.ZP)(AP,{name:"MuiPickersPopper",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{zIndex:t.zIndex.modal}})),LP=(0,Iy.ZP)(Dw,{name:"MuiPickersPopper",slot:"Paper",overridesResolver:(e,t)=>t.paper})({outline:0,transformOrigin:"top center",variants:[{props:e=>{let{placement:t}=e;return["top","top-start","top-end"].includes(t)},style:{transformOrigin:"bottom center"}}]}),DP=e.forwardRef(((e,t)=>{const{PaperComponent:n,popperPlacement:r,ownerState:i,children:o,paperSlotProps:s,paperClasses:a,onPaperClick:l,onPaperTouchStart:c}=e,u=(0,My.Z)(e,PP),h=(0,_n.Z)({},i,{placement:r}),d=gb({elementType:n,externalSlotProps:s,additionalProps:{tabIndex:-1,elevation:8,ref:t},className:a,ownerState:h});return(0,Wy.jsx)(n,(0,_n.Z)({},u,d,{onClick:e=>{l(e),d.onClick?.(e)},onTouchStart:e=>{c(e),d.onTouchStart?.(e)},ownerState:h,children:o}))}));function OP(t){const n=(0,Ry.Z)({props:t,name:"MuiPickersPopper"}),{anchorEl:r,children:i,containerRef:o=null,shouldRestoreFocus:s,onBlur:a,onDismiss:l,open:c,role:u,placement:h,slots:d,slotProps:p,reduceAnimations:f}=n;e.useEffect((()=>{function e(e){c&&"Escape"===e.key&&l()}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[l,c]);const m=e.useRef(null);e.useEffect((()=>{"tooltip"===u||s&&!s()||(c?m.current=oM(document):m.current&&m.current instanceof HTMLElement&&setTimeout((()=>{m.current instanceof HTMLElement&&m.current.focus()})))}),[c,u,s]);const[g,y,v]=function(t,n){const r=e.useRef(!1),i=e.useRef(!1),o=e.useRef(null),s=e.useRef(!1);e.useEffect((()=>{if(t)return document.addEventListener("mousedown",e,!0),document.addEventListener("touchstart",e,!0),()=>{document.removeEventListener("mousedown",e,!0),document.removeEventListener("touchstart",e,!0),s.current=!1};function e(){s.current=!0}}),[t]);const a=(0,tw.Z)((e=>{if(!s.current)return;const t=i.current;i.current=!1;const a=(0,ew.Z)(o.current);if(!o.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,a))return;if(r.current)return void(r.current=!1);let l;l=e.composedPath?e.composedPath().indexOf(o.current)>-1:!a.documentElement.contains(e.target)||o.current.contains(e.target),l||t||n(e)})),l=()=>{i.current=!0};return e.useEffect((()=>{if(t){const e=(0,ew.Z)(o.current),t=()=>{r.current=!0};return e.addEventListener("touchstart",a),e.addEventListener("touchmove",t),()=>{e.removeEventListener("touchstart",a),e.removeEventListener("touchmove",t)}}}),[t,a]),e.useEffect((()=>{if(t){const e=(0,ew.Z)(o.current);return e.addEventListener("click",a),()=>{e.removeEventListener("click",a),i.current=!1}}}),[t,a]),[o,l,l]}(c,a??l),_=e.useRef(null),x=(0,F_.Z)(_,o),b=(0,F_.Z)(x,g),w=n,S=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],paper:["paper"]},IP,t)})(w),M=qA(),E=f??M,T=d?.desktopTransition??E?gw:Qb,C=d?.desktopTrapFocus??hw,A=d?.desktopPaper??LP,I=d?.popper??RP,P=gb({elementType:I,externalSlotProps:p?.popper,additionalProps:{transition:!0,role:u,open:c,anchorEl:r,placement:h,onKeyDown:e=>{"Escape"===e.key&&(e.stopPropagation(),l())}},className:S.root,ownerState:n});return(0,Wy.jsx)(I,(0,_n.Z)({},P,{children:e=>{let{TransitionProps:t,placement:n}=e;return(0,Wy.jsx)(C,(0,_n.Z)({open:c,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:"tooltip"===u,isEnabled:()=>!0},p?.desktopTrapFocus,{children:(0,Wy.jsx)(T,(0,_n.Z)({},t,p?.desktopTransition,{children:(0,Wy.jsx)(DP,{PaperComponent:A,ownerState:w,popperPlacement:n,ref:b,onPaperClick:y,onPaperTouchStart:v,paperClasses:S.paper,paperSlotProps:p?.desktopPaper,children:i})}))}))}}))}const NP=["className","sx"];function kP(){return"undefined"==typeof window?"portrait":window.screen&&window.screen.orientation&&window.screen.orientation.angle?90===Math.abs(window.screen.orientation.angle)?"landscape":"portrait":window.orientation&&90===Math.abs(Number(window.orientation))?"landscape":"portrait"}const FP=(Pn(["The `renderInput` prop has been removed in version 6.0 of the Date and Time Pickers.","You can replace it with the `textField` component slot in most cases.","For more information, please have a look at the migration guide (https://mui.com/x/migration/migration-pickers-v5/#input-renderer-required-in-v5)."]),t=>{let{props:n,valueManager:r,valueType:i,wrapperVariant:o,additionalViewProps:s,validator:a,autoFocusView:l,rendererInterceptor:c,fieldRef:u}=t;const h=(t=>{let{props:n,valueManager:r,valueType:i,wrapperVariant:o,validator:s}=t;const{onAccept:a,onChange:l,value:c,defaultValue:u,closeOnSelect:h="desktop"===o,timezone:d}=n,{current:p}=e.useRef(u),{current:f}=e.useRef(void 0!==c),m=$S(),g=WS(),{isOpen:y,setIsOpen:v}=(t=>{let{open:n,onOpen:r,onClose:i}=t;const o=e.useRef("boolean"==typeof n).current,[s,a]=e.useState(!1);return e.useEffect((()=>{if(o){if("boolean"!=typeof n)throw new Error("You must not mix controlling and uncontrolled mode for `open` prop");a(n)}}),[o,n]),{isOpen:s,setIsOpen:e.useCallback((e=>{o||a(e),e&&r&&r(),!e&&i&&i()}),[o,r,i])}})(n),[_,x]=e.useState((()=>{let e;return e=void 0!==c?c:void 0!==p?p:r.emptyValue,{draft:e,lastPublishedValue:e,lastCommittedValue:e,lastControlledValue:c,hasBeenModifiedSinceMount:!1}})),{timezone:b,handleValueChange:w}=nM({timezone:d,value:c,defaultValue:p,onChange:l,valueManager:r});KS((0,_n.Z)({},n,{value:_.draft,timezone:b}),s,r.isSameError,r.defaultErrorState);const S=(0,tw.Z)((e=>{const t={action:e,dateState:_,hasChanged:t=>!r.areValuesEqual(m,e.value,t),isControlled:f,closeOnSelect:h},i=(e=>{const{action:t,hasChanged:n,dateState:r,isControlled:i}=e,o=!i&&!r.hasBeenModifiedSinceMount;return"setValueFromField"===t.name||("setValueFromAction"===t.name?!(!o||!["accept","today","clear"].includes(t.pickerAction))||n(r.lastPublishedValue):("setValueFromView"===t.name&&"shallow"!==t.selectionState||"setValueFromShortcut"===t.name)&&(!!o||n(r.lastPublishedValue)))})(t),o=(e=>{const{action:t,hasChanged:n,dateState:r,isControlled:i,closeOnSelect:o}=e,s=!i&&!r.hasBeenModifiedSinceMount;return"setValueFromAction"===t.name?!(!s||!["accept","today","clear"].includes(t.pickerAction))||n(r.lastCommittedValue):"setValueFromView"===t.name&&"finish"===t.selectionState&&o?!!s||n(r.lastCommittedValue):"setValueFromShortcut"===t.name&&"accept"===t.changeImportance&&n(r.lastCommittedValue)})(t),l=(e=>{const{action:t,closeOnSelect:n}=e;return"setValueFromAction"===t.name||("setValueFromView"===t.name?"finish"===t.selectionState&&n:"setValueFromShortcut"===t.name&&"accept"===t.changeImportance)})(t);if(x((t=>(0,_n.Z)({},t,{draft:e.value,lastPublishedValue:i?e.value:t.lastPublishedValue,lastCommittedValue:o?e.value:t.lastCommittedValue,hasBeenModifiedSinceMount:!0}))),i){const t={validationError:"setValueFromField"===e.name?e.context.validationError:s({adapter:g,value:e.value,props:(0,_n.Z)({},n,{value:e.value,timezone:b})})};"setValueFromShortcut"===e.name&&(t.shortcut=e.shortcut),w(e.value,t)}o&&a&&a(e.value),l&&v(!1)}));if(void 0!==c&&(void 0===_.lastControlledValue||!r.areValuesEqual(m,_.lastControlledValue,c))){const e=r.areValuesEqual(m,_.draft,c);x((t=>(0,_n.Z)({},t,{lastControlledValue:c},e?{}:{lastCommittedValue:c,lastPublishedValue:c,draft:c,hasBeenModifiedSinceMount:!0})))}const M=(0,tw.Z)((()=>{S({value:r.emptyValue,name:"setValueFromAction",pickerAction:"clear"})})),E=(0,tw.Z)((()=>{S({value:_.lastPublishedValue,name:"setValueFromAction",pickerAction:"accept"})})),T=(0,tw.Z)((()=>{S({value:_.lastPublishedValue,name:"setValueFromAction",pickerAction:"dismiss"})})),C=(0,tw.Z)((()=>{S({value:_.lastCommittedValue,name:"setValueFromAction",pickerAction:"cancel"})})),A=(0,tw.Z)((()=>{S({value:r.getTodayValue(m,b,i),name:"setValueFromAction",pickerAction:"today"})})),I=(0,tw.Z)((e=>{e.preventDefault(),v(!0)})),P=(0,tw.Z)((e=>{e?.preventDefault(),v(!1)})),R=(0,tw.Z)((function(e){return S({name:"setValueFromView",value:e,selectionState:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"partial"})})),L=(0,tw.Z)(((e,t,n)=>S({name:"setValueFromShortcut",value:e,changeImportance:t,shortcut:n}))),D=(0,tw.Z)(((e,t)=>S({name:"setValueFromField",value:e,context:t}))),O={onClear:M,onAccept:E,onDismiss:T,onCancel:C,onSetToday:A,onOpen:I,onClose:P},N={value:_.draft,onChange:D},k=e.useMemo((()=>r.cleanValue(m,_.draft)),[m,r,_.draft]);return{open:y,fieldProps:N,viewProps:{value:k,onChange:R,onClose:P,open:y},layoutProps:(0,_n.Z)({},O,{value:k,onChange:R,onSelectShortcut:L,isValid:e=>{const t=s({adapter:g,value:e,props:(0,_n.Z)({},n,{value:e,timezone:b})});return!r.hasError(t)}}),actions:O}})({props:n,valueManager:r,valueType:i,wrapperVariant:o,validator:a}),d=(t=>{let{props:n,propsFromPickerValue:r,additionalViewProps:i,autoFocusView:o,rendererInterceptor:s,fieldRef:a}=t;const{onChange:l,open:c,onClose:u}=r,{views:h,openTo:d,onViewChange:p,viewRenderers:f,timezone:m}=n,g=(0,My.Z)(n,NP),{view:y,setView:v,defaultView:_,focusedView:x,setFocusedView:b,setValueAndGoToNextView:w}=MA({view:void 0,views:h,openTo:d,onChange:l,onViewChange:p,autoFocus:o}),{hasUIView:S,viewModeLookup:M}=e.useMemo((()=>h.reduce(((e,t)=>{let n;return n=null!=f[t]?"UI":"field",e.viewModeLookup[t]=n,"UI"===n&&(e.hasUIView=!0),e}),{hasUIView:!1,viewModeLookup:{}})),[f,h]),E=e.useMemo((()=>h.reduce(((e,t)=>null!=f[t]&&r_(t)?e+1:e),0)),[f,h]),T=M[y],C=(0,tw.Z)((()=>"UI"===T)),[A,I]=e.useState("UI"===T?y:null);return A!==y&&"UI"===M[y]&&I(y),(0,Cv.Z)((()=>{"field"===T&&c&&(u(),setTimeout((()=>{a?.current?.setSelectedSections(y),a?.current?.focusField(y)})))}),[y]),(0,Cv.Z)((()=>{if(!c)return;let e=y;"field"===T&&null!=A&&(e=A),e!==_&&"UI"===M[e]&&"UI"===M[_]&&(e=_),e!==y&&v(e),b(e,!0)}),[c]),{hasUIView:S,shouldRestoreFocus:C,layoutProps:{views:h,view:A,onViewChange:v},renderCurrentView:()=>{if(null==A)return null;const e=f[A];if(null==e)return null;const t=(0,_n.Z)({},g,i,r,{views:h,timezone:m,onChange:w,view:A,onViewChange:v,focusedView:x,onFocusedViewChange:b,showViewSwitcher:E>1,timeViewsCount:E});return s?s(f,A,t):e(t)}}})({props:n,additionalViewProps:s,autoFocusView:l,fieldRef:u,propsFromPickerValue:h.viewProps,rendererInterceptor:c}),p=(t=>{let{props:n,propsFromPickerValue:r,propsFromPickerViews:i,wrapperVariant:o}=t;const{orientation:s}=n,a=((t,n)=>{const[r,i]=e.useState(kP);return(0,Cv.Z)((()=>{const e=()=>{i(kP())};return window.addEventListener("orientationchange",e),()=>{window.removeEventListener("orientationchange",e)}}),[]),!function(e,t){return Array.isArray(t)?t.every((t=>-1!==e.indexOf(t))):-1!==e.indexOf(t)}(t,["hours","minutes","seconds"])&&"landscape"===(n||r)})(i.views,s);return{layoutProps:(0,_n.Z)({},i,r,{isLandscape:a,wrapperVariant:o,disabled:n.disabled,readOnly:n.readOnly})}})({props:n,wrapperVariant:o,propsFromPickerValue:h.layoutProps,propsFromPickerViews:d.layoutProps});return{open:h.open,actions:h.actions,fieldProps:h.fieldProps,renderCurrentView:d.renderCurrentView,hasUIView:d.hasUIView,shouldRestoreFocus:d.shouldRestoreFocus,layoutProps:p.layoutProps}});function zP(e){return(0,lv.ZP)("MuiPickersLayout",e)}const BP=(0,$y.Z)("MuiPickersLayout",["root","landscape","contentWrapper","toolbar","actionBar","tabs","shortcuts"]);function UP(e){return(0,lv.ZP)("MuiDialogActions",e)}(0,$y.Z)("MuiDialogActions",["root","spacing"]);const jP=["className","disableSpacing"],VP=(0,Iy.ZP)("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),GP=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiDialogActions"}),{className:r,disableSpacing:i=!1}=n,o=(0,My.Z)(n,jP),s=(0,_n.Z)({},n,{disableSpacing:i}),a=(e=>{const{classes:t,disableSpacing:n}=e,r={root:["root",!n&&"spacing"]};return(0,Cy.Z)(r,UP,t)})(s);return(0,Wy.jsx)(VP,(0,_n.Z)({className:(0,Ey.Z)(a.root,r),ownerState:s,ref:t},o))})),HP=GP,ZP=["onAccept","onClear","onCancel","onSetToday","actions"];function WP(e){const{onAccept:t,onClear:n,onCancel:r,onSetToday:i,actions:o}=e,s=(0,My.Z)(e,ZP),a=XS();if(null==o||0===o.length)return null;const l=o?.map((e=>{switch(e){case"clear":return(0,Wy.jsx)(Tv,{onClick:n,children:a.clearButtonLabel},e);case"cancel":return(0,Wy.jsx)(Tv,{onClick:r,children:a.cancelButtonLabel},e);case"accept":return(0,Wy.jsx)(Tv,{onClick:t,children:a.okButtonLabel},e);case"today":return(0,Wy.jsx)(Tv,{onClick:i,children:a.todayButtonLabel},e);default:return null}}));return(0,Wy.jsx)(HP,(0,_n.Z)({},s,{children:l}))}function $P(e){return(0,lv.ZP)("MuiListItem",e)}const qP=(0,$y.Z)("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]);function XP(e){return(0,lv.ZP)("MuiListItemButton",e)}const YP=(0,$y.Z)("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]);function KP(e){return(0,lv.ZP)("MuiListItemSecondaryAction",e)}(0,$y.Z)("MuiListItemSecondaryAction",["root","disableGutters"]);const JP=["className"],QP=(0,Iy.ZP)("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.disableGutters&&t.disableGutters]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})})),eR=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiListItemSecondaryAction"}),{className:i}=r,o=(0,My.Z)(r,JP),s=e.useContext(_b),a=(0,_n.Z)({},r,{disableGutters:s.disableGutters}),l=(e=>{const{disableGutters:t,classes:n}=e,r={root:["root",t&&"disableGutters"]};return(0,Cy.Z)(r,KP,n)})(a);return(0,Wy.jsx)(QP,(0,_n.Z)({className:(0,Ey.Z)(l.root,i),ownerState:a,ref:n},o))}));eR.muiName="ListItemSecondaryAction";const tR=eR,nR=["className"],rR=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],iR=(0,Iy.ZP)("div",{name:"MuiListItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters,!n.disablePadding&&t.padding,n.button&&t.button,n.hasSecondaryAction&&t.secondaryAction]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!n.disablePadding&&(0,_n.Z)({paddingTop:8,paddingBottom:8},n.dense&&{paddingTop:4,paddingBottom:4},!n.disableGutters&&{paddingLeft:16,paddingRight:16},!!n.secondaryAction&&{paddingRight:48}),!!n.secondaryAction&&{[`& > .${YP.root}`]:{paddingRight:48}},{[`&.${qP.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${qP.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${qP.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${qP.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},"flex-start"===n.alignItems&&{alignItems:"flex-start"},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},n.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${qP.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}}},n.hasSecondaryAction&&{paddingRight:48})})),oR=(0,Iy.ZP)("li",{name:"MuiListItem",slot:"Container",overridesResolver:(e,t)=>t.container})({position:"relative"}),sR=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiListItem"}),{alignItems:i="center",autoFocus:o=!1,button:s=!1,children:a,className:l,component:c,components:u={},componentsProps:h={},ContainerComponent:d="li",ContainerProps:{className:p}={},dense:f=!1,disabled:m=!1,disableGutters:g=!1,disablePadding:y=!1,divider:v=!1,focusVisibleClassName:_,secondaryAction:x,selected:b=!1,slotProps:w={},slots:S={}}=r,M=(0,My.Z)(r.ContainerProps,nR),E=(0,My.Z)(r,rR),T=e.useContext(_b),C=e.useMemo((()=>({dense:f||T.dense||!1,alignItems:i,disableGutters:g})),[i,T.dense,f,g]),A=e.useRef(null);(0,q_.Z)((()=>{o&&A.current&&A.current.focus()}),[o]);const I=e.Children.toArray(a),P=I.length&&(0,Kx.Z)(I[I.length-1],["ListItemSecondaryAction"]),R=(0,_n.Z)({},r,{alignItems:i,autoFocus:o,button:s,dense:C.dense,disabled:m,disableGutters:g,disablePadding:y,divider:v,hasSecondaryAction:P,selected:b}),L=(e=>{const{alignItems:t,button:n,classes:r,dense:i,disabled:o,disableGutters:s,disablePadding:a,divider:l,hasSecondaryAction:c,selected:u}=e,h={root:["root",i&&"dense",!s&&"gutters",!a&&"padding",l&&"divider",o&&"disabled",n&&"button","flex-start"===t&&"alignItemsFlexStart",c&&"secondaryAction",u&&"selected"],container:["container"]};return(0,Cy.Z)(h,$P,r)})(R),D=(0,Ly.Z)(A,n),O=S.root||u.Root||iR,N=w.root||h.root||{},k=(0,_n.Z)({className:(0,Ey.Z)(L.root,N.className,l),disabled:m},E);let F=c||"li";return s&&(k.component=c||"div",k.focusVisibleClassName=(0,Ey.Z)(qP.focusVisible,_),F=fv),P?(F=k.component||c?F:"div","li"===d&&("li"===F?F="div":"li"===k.component&&(k.component="div")),(0,Wy.jsx)(_b.Provider,{value:C,children:(0,Wy.jsxs)(oR,(0,_n.Z)({as:d,className:(0,Ey.Z)(L.container,p),ref:D,ownerState:R},M,{children:[(0,Wy.jsx)(O,(0,_n.Z)({},N,!H_(O)&&{as:F,ownerState:(0,_n.Z)({},R,N.ownerState)},k,{children:I})),I.pop()]}))})):(0,Wy.jsx)(_b.Provider,{value:C,children:(0,Wy.jsxs)(O,(0,_n.Z)({},N,{as:F,ref:D},!H_(O)&&{ownerState:(0,_n.Z)({},R,N.ownerState)},k,{children:[I,x&&(0,Wy.jsx)(tR,{children:x})]}))})})),aR=sR,lR=(0,MS.Z)((0,Wy.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");function cR(e){return(0,lv.ZP)("MuiChip",e)}const uR=(0,$y.Z)("MuiChip",["root","sizeSmall","sizeMedium","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),hR=["avatar","className","clickable","color","component","deleteIcon","disabled","icon","label","onClick","onDelete","onKeyDown","onKeyUp","size","variant","tabIndex","skipFocusWhenDisabled"],dR=(0,Iy.ZP)("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{color:r,iconColor:i,clickable:o,onDelete:s,size:a,variant:l}=n;return[{[`& .${uR.avatar}`]:t.avatar},{[`& .${uR.avatar}`]:t[`avatar${(0,mv.Z)(a)}`]},{[`& .${uR.avatar}`]:t[`avatarColor${(0,mv.Z)(r)}`]},{[`& .${uR.icon}`]:t.icon},{[`& .${uR.icon}`]:t[`icon${(0,mv.Z)(a)}`]},{[`& .${uR.icon}`]:t[`iconColor${(0,mv.Z)(i)}`]},{[`& .${uR.deleteIcon}`]:t.deleteIcon},{[`& .${uR.deleteIcon}`]:t[`deleteIcon${(0,mv.Z)(a)}`]},{[`& .${uR.deleteIcon}`]:t[`deleteIconColor${(0,mv.Z)(r)}`]},{[`& .${uR.deleteIcon}`]:t[`deleteIcon${(0,mv.Z)(l)}Color${(0,mv.Z)(r)}`]},t.root,t[`size${(0,mv.Z)(a)}`],t[`color${(0,mv.Z)(r)}`],o&&t.clickable,o&&"default"!==r&&t[`clickableColor${(0,mv.Z)(r)})`],s&&t.deletable,s&&"default"!==r&&t[`deletableColor${(0,mv.Z)(r)}`],t[l],t[`${l}${(0,mv.Z)(r)}`]]}})((e=>{let{theme:t,ownerState:n}=e;const r="light"===t.palette.mode?t.palette.grey[700]:t.palette.grey[300];return(0,_n.Z)({maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:16,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${uR.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${uR.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:r,fontSize:t.typography.pxToRem(12)},[`& .${uR.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${uR.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${uR.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${uR.icon}`]:(0,_n.Z)({marginLeft:5,marginRight:-6},"small"===n.size&&{fontSize:18,marginLeft:4,marginRight:-4},n.iconColor===n.color&&(0,_n.Z)({color:t.vars?t.vars.palette.Chip.defaultIconColor:r},"default"!==n.color&&{color:"inherit"})),[`& .${uR.deleteIcon}`]:(0,_n.Z)({WebkitTapHighlightColor:"transparent",color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.26)`:(0,Ay.Fq)(t.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:(0,Ay.Fq)(t.palette.text.primary,.4)}},"small"===n.size&&{fontSize:16,marginRight:4,marginLeft:-4},"default"!==n.color&&{color:t.vars?`rgba(${t.vars.palette[n.color].contrastTextChannel} / 0.7)`:(0,Ay.Fq)(t.palette[n.color].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].contrastText}})},"small"===n.size&&{height:24},"default"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].main,color:(t.vars||t).palette[n.color].contrastText},n.onDelete&&{[`&.${uR.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ay.Fq)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},n.onDelete&&"default"!==n.color&&{[`&.${uR.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},n.clickable&&{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ay.Fq)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)},[`&.${uR.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ay.Fq)(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},"&:active":{boxShadow:(t.vars||t).shadows[1]}},n.clickable&&"default"!==n.color&&{[`&:hover, &.${uR.focusVisible}`]:{backgroundColor:(t.vars||t).palette[n.color].dark}})}),(e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},"outlined"===n.variant&&{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${"light"===t.palette.mode?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${uR.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${uR.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${uR.avatar}`]:{marginLeft:4},[`& .${uR.avatarSmall}`]:{marginLeft:2},[`& .${uR.icon}`]:{marginLeft:4},[`& .${uR.iconSmall}`]:{marginLeft:2},[`& .${uR.deleteIcon}`]:{marginRight:5},[`& .${uR.deleteIconSmall}`]:{marginRight:3}},"outlined"===n.variant&&"default"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,Ay.Fq)(t.palette[n.color].main,.7)}`,[`&.${uR.clickable}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette[n.color].main,t.palette.action.hoverOpacity)},[`&.${uR.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.focusOpacity})`:(0,Ay.Fq)(t.palette[n.color].main,t.palette.action.focusOpacity)},[`& .${uR.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / 0.7)`:(0,Ay.Fq)(t.palette[n.color].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[n.color].main}}})})),pR=(0,Iy.ZP)("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,t)=>{const{ownerState:n}=e,{size:r}=n;return[t.label,t[`label${(0,mv.Z)(r)}`]]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap"},"outlined"===t.variant&&{paddingLeft:11,paddingRight:11},"small"===t.size&&{paddingLeft:8,paddingRight:8},"small"===t.size&&"outlined"===t.variant&&{paddingLeft:7,paddingRight:7})}));function fR(e){return"Backspace"===e.key||"Delete"===e.key}const mR=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiChip"}),{avatar:i,className:o,clickable:s,color:a="default",component:l,deleteIcon:c,disabled:u=!1,icon:h,label:d,onClick:p,onDelete:f,onKeyDown:m,onKeyUp:g,size:y="medium",variant:v="filled",tabIndex:_,skipFocusWhenDisabled:x=!1}=r,b=(0,My.Z)(r,hR),w=e.useRef(null),S=(0,Ly.Z)(w,n),M=e=>{e.stopPropagation(),f&&f(e)},E=!(!1===s||!p)||s,T=E||f?fv:l||"div",C=(0,_n.Z)({},r,{component:T,disabled:u,size:y,color:a,iconColor:e.isValidElement(h)&&h.props.color||a,onDelete:!!f,clickable:E,variant:v}),A=(e=>{const{classes:t,disabled:n,size:r,color:i,iconColor:o,onDelete:s,clickable:a,variant:l}=e,c={root:["root",l,n&&"disabled",`size${(0,mv.Z)(r)}`,`color${(0,mv.Z)(i)}`,a&&"clickable",a&&`clickableColor${(0,mv.Z)(i)}`,s&&"deletable",s&&`deletableColor${(0,mv.Z)(i)}`,`${l}${(0,mv.Z)(i)}`],label:["label",`label${(0,mv.Z)(r)}`],avatar:["avatar",`avatar${(0,mv.Z)(r)}`,`avatarColor${(0,mv.Z)(i)}`],icon:["icon",`icon${(0,mv.Z)(r)}`,`iconColor${(0,mv.Z)(o)}`],deleteIcon:["deleteIcon",`deleteIcon${(0,mv.Z)(r)}`,`deleteIconColor${(0,mv.Z)(i)}`,`deleteIcon${(0,mv.Z)(l)}Color${(0,mv.Z)(i)}`]};return(0,Cy.Z)(c,cR,t)})(C),I=T===fv?(0,_n.Z)({component:l||"div",focusVisibleClassName:A.focusVisible},f&&{disableRipple:!0}):{};let P=null;f&&(P=c&&e.isValidElement(c)?e.cloneElement(c,{className:(0,Ey.Z)(c.props.className,A.deleteIcon),onClick:M}):(0,Wy.jsx)(lR,{className:(0,Ey.Z)(A.deleteIcon),onClick:M}));let R=null;i&&e.isValidElement(i)&&(R=e.cloneElement(i,{className:(0,Ey.Z)(A.avatar,i.props.className)}));let L=null;return h&&e.isValidElement(h)&&(L=e.cloneElement(h,{className:(0,Ey.Z)(A.icon,h.props.className)})),(0,Wy.jsxs)(dR,(0,_n.Z)({as:T,className:(0,Ey.Z)(A.root,o),disabled:!(!E||!u)||void 0,onClick:p,onKeyDown:e=>{e.currentTarget===e.target&&fR(e)&&e.preventDefault(),m&&m(e)},onKeyUp:e=>{e.currentTarget===e.target&&(f&&fR(e)?f(e):"Escape"===e.key&&w.current&&w.current.blur()),g&&g(e)},ref:S,tabIndex:x&&u?-1:_,ownerState:C},I,b,{children:[R||L,(0,Wy.jsx)(pR,{className:(0,Ey.Z)(A.label),ownerState:C,children:d}),P]}))})),gR=mR,yR=["items","changeImportance","isLandscape","onChange","isValid"],vR=["getValue"];function _R(e){const{items:t,changeImportance:n="accept",onChange:r,isValid:i}=e,o=(0,My.Z)(e,yR);if(null==t||0===t.length)return null;const s=t.map((e=>{let{getValue:t}=e,o=(0,My.Z)(e,vR);const s=t({isValid:i});return(0,_n.Z)({},o,{label:o.label,onClick:()=>{r(s,n,o)},disabled:!i(s)})}));return(0,Wy.jsx)(Mb,(0,_n.Z)({dense:!0,sx:[{maxHeight:aC,maxWidth:200,overflow:"auto"},...Array.isArray(o.sx)?o.sx:[o.sx]]},o,{children:s.map((e=>(0,Wy.jsx)(aR,{children:(0,Wy.jsx)(gR,(0,_n.Z)({},e))},e.id??e.label)))}))}const xR=e=>{const{wrapperVariant:t,onAccept:n,onClear:r,onCancel:i,onSetToday:o,view:s,views:a,onViewChange:l,value:c,onChange:u,onSelectShortcut:h,isValid:d,isLandscape:p,disabled:f,readOnly:m,children:g,slots:y,slotProps:v}=e,_=(e=>{const{classes:t,isLandscape:n}=e,r={root:["root",n&&"landscape"],contentWrapper:["contentWrapper"],toolbar:["toolbar"],actionBar:["actionBar"],tabs:["tabs"],landscape:["landscape"],shortcuts:["shortcuts"]};return(0,Cy.Z)(r,zP,t)})(e),x=y?.actionBar??WP,b=gb({elementType:x,externalSlotProps:v?.actionBar,additionalProps:{onAccept:n,onClear:r,onCancel:i,onSetToday:o,actions:"desktop"===t?[]:["cancel","accept"]},className:_.actionBar,ownerState:(0,_n.Z)({},e,{wrapperVariant:t})}),w=(0,Wy.jsx)(x,(0,_n.Z)({},b)),S=y?.toolbar,M=gb({elementType:S,externalSlotProps:v?.toolbar,additionalProps:{isLandscape:p,onChange:u,value:c,view:s,onViewChange:l,views:a,disabled:f,readOnly:m},className:_.toolbar,ownerState:(0,_n.Z)({},e,{wrapperVariant:t})}),E=function(e){return null!==e.view}(M)&&S?(0,Wy.jsx)(S,(0,_n.Z)({},M)):null,T=g,C=y?.tabs,A=s&&C?(0,Wy.jsx)(C,(0,_n.Z)({view:s,onViewChange:l,className:_.tabs},v?.tabs)):null,I=y?.shortcuts??_R,P=gb({elementType:I,externalSlotProps:v?.shortcuts,additionalProps:{isValid:d,isLandscape:p,onChange:h},className:_.shortcuts,ownerState:{isValid:d,isLandscape:p,onChange:h,wrapperVariant:t}});return{toolbar:E,content:T,tabs:A,actionBar:w,shortcuts:s&&I?(0,Wy.jsx)(I,(0,_n.Z)({},P)):null}},bR=(0,Iy.ZP)("div",{name:"MuiPickersLayout",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"grid",gridAutoColumns:"max-content auto max-content",gridAutoRows:"max-content auto max-content",[`& .${BP.actionBar}`]:{gridColumn:"1 / 4",gridRow:3},variants:[{props:{isLandscape:!0},style:{[`& .${BP.toolbar}`]:{gridColumn:"rtl"===t.direction?3:1,gridRow:"2 / 3"},[`.${BP.shortcuts}`]:{gridColumn:"2 / 4",gridRow:1}}},{props:{isLandscape:!1},style:{[`& .${BP.toolbar}`]:{gridColumn:"2 / 4",gridRow:1},[`& .${BP.shortcuts}`]:{gridColumn:"rtl"===t.direction?3:1,gridRow:"2 / 3"}}}]}})),wR=(0,Iy.ZP)("div",{name:"MuiPickersLayout",slot:"ContentWrapper",overridesResolver:(e,t)=>t.contentWrapper})({gridColumn:2,gridRow:2,display:"flex",flexDirection:"column"}),SR=function(t){const n=(0,Ry.Z)({props:t,name:"MuiPickersLayout"}),{toolbar:r,content:i,tabs:o,actionBar:s,shortcuts:a}=xR(n),{sx:l,className:c,isLandscape:u,ref:h,wrapperVariant:d}=n,p=n,f=(e=>{const{isLandscape:t,classes:n}=e,r={root:["root",t&&"landscape"],contentWrapper:["contentWrapper"]};return(0,Cy.Z)(r,zP,n)})(p);return(0,Wy.jsxs)(bR,{ref:h,sx:l,className:(0,Ey.Z)(c,f.root),ownerState:p,children:[u?a:r,u?r:a,(0,Wy.jsx)(wR,{className:f.contentWrapper,children:"desktop"===d?(0,Wy.jsxs)(e.Fragment,{children:[i,o]}):(0,Wy.jsxs)(e.Fragment,{children:[o,i]})}),s]})},MR=["props","getOpenDialogAriaText"],ER=["ownerState"],TR=["ownerState"],CR=["views","format"],AR=(e,t)=>{let{views:n,format:r}=t,i=(0,My.Z)(t,CR);if(r)return r;const o=[],s=[];if(n.forEach((e=>{r_(e)?s.push(e):o.push(e)})),0===s.length)return e_(e,(0,_n.Z)({views:o},i),!1);if(0===o.length)return u_(e,(0,_n.Z)({views:s},i));const a=u_(e,(0,_n.Z)({views:s},i));return`${e_(e,(0,_n.Z)({views:o},i),!1)} ${a}`},IR=(e,t,n)=>n?t.filter((e=>!i_(e)||"hours"===e)):e?[...t,"meridiem"]:t;function PR(e){return(0,lv.ZP)("MuiTimeClock",e)}(0,$y.Z)("MuiTimeClock",["root","arrowSwitcher"]);const RR=220,LR=36,DR=RR/2,OR=RR/2,NR=DR-DR,kR=0-OR,FR=(e,t,n)=>{const r=t-DR,i=n-OR;let o=(Math.atan2(NR,kR)-Math.atan2(r,i))*(180/Math.PI);o=Math.round(o/e)*e,o%=360;const s=r**2+i**2;return{value:Math.floor(o/e)||0,distance:Math.sqrt(s)}};function zR(e){return(0,lv.ZP)("MuiClockPointer",e)}(0,$y.Z)("MuiClockPointer",["root","thumb"]);const BR=["className","hasSelected","isInner","type","viewValue"],UR=e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],thumb:["thumb"]},zR,t)},jR=(0,Iy.ZP)("div",{name:"MuiClockPointer",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{width:2,backgroundColor:(t.vars||t).palette.primary.main,position:"absolute",left:"calc(50% - 1px)",bottom:"50%",transformOrigin:"center bottom 0px",variants:[{props:{shouldAnimate:!0},style:{transition:t.transitions.create(["transform","height"])}}]}})),VR=(0,Iy.ZP)("div",{name:"MuiClockPointer",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})((e=>{let{theme:t}=e;return{width:4,height:4,backgroundColor:(t.vars||t).palette.primary.contrastText,borderRadius:"50%",position:"absolute",top:-21,left:"calc(50% - 18px)",border:`16px solid ${(t.vars||t).palette.primary.main}`,boxSizing:"content-box",variants:[{props:{hasSelected:!0},style:{backgroundColor:(t.vars||t).palette.primary.main}}]}}));function GR(t){const n=(0,Ry.Z)({props:t,name:"MuiClockPointer"}),{className:r,isInner:i,type:o,viewValue:s}=n,a=(0,My.Z)(n,BR),l=e.useRef(o);e.useEffect((()=>{l.current=o}),[o]);const c=(0,_n.Z)({},n,{shouldAnimate:l.current!==o}),u=UR(c);return(0,Wy.jsx)(jR,(0,_n.Z)({style:(()=>{let e=360/("hours"===o?12:60)*s;return"hours"===o&&s>12&&(e-=360),{height:Math.round((i?.26:.4)*RR),transform:`rotateZ(${e}deg)`}})(),className:(0,Ey.Z)(r,u.root),ownerState:c},a,{children:(0,Wy.jsx)(VR,{ownerState:c,className:u.thumb})}))}function HR(e){return(0,lv.ZP)("MuiClock",e)}(0,$y.Z)("MuiClock",["root","clock","wrapper","squareMask","pin","amButton","pmButton","meridiemText"]);const ZR=(0,Iy.ZP)("div",{name:"MuiClock",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"center",alignItems:"center",margin:t.spacing(2)}})),WR=(0,Iy.ZP)("div",{name:"MuiClock",slot:"Clock",overridesResolver:(e,t)=>t.clock})({backgroundColor:"rgba(0,0,0,.07)",borderRadius:"50%",height:220,width:220,flexShrink:0,position:"relative",pointerEvents:"none"}),$R=(0,Iy.ZP)("div",{name:"MuiClock",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})({"&:focus":{outline:"none"}}),qR=(0,Iy.ZP)("div",{name:"MuiClock",slot:"SquareMask",overridesResolver:(e,t)=>t.squareMask})({width:"100%",height:"100%",position:"absolute",pointerEvents:"auto",outline:0,touchAction:"none",userSelect:"none",variants:[{props:{disabled:!1},style:{"@media (pointer: fine)":{cursor:"pointer",borderRadius:"50%"},"&:active":{cursor:"move"}}}]}),XR=(0,Iy.ZP)("div",{name:"MuiClock",slot:"Pin",overridesResolver:(e,t)=>t.pin})((e=>{let{theme:t}=e;return{width:6,height:6,borderRadius:"50%",backgroundColor:(t.vars||t).palette.primary.main,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})),YR=(0,Iy.ZP)(MM,{name:"MuiClock",slot:"AmButton",overridesResolver:(e,t)=>t.amButton})((e=>{let{theme:t}=e;return{zIndex:1,position:"absolute",bottom:8,left:8,paddingLeft:4,paddingRight:4,width:LR,variants:[{props:{meridiemMode:"am"},style:{backgroundColor:(t.vars||t).palette.primary.main,color:(t.vars||t).palette.primary.contrastText,"&:hover":{backgroundColor:(t.vars||t).palette.primary.light}}}]}})),KR=(0,Iy.ZP)(MM,{name:"MuiClock",slot:"PmButton",overridesResolver:(e,t)=>t.pmButton})((e=>{let{theme:t}=e;return{zIndex:1,position:"absolute",bottom:8,right:8,paddingLeft:4,paddingRight:4,width:LR,variants:[{props:{meridiemMode:"pm"},style:{backgroundColor:(t.vars||t).palette.primary.main,color:(t.vars||t).palette.primary.contrastText,"&:hover":{backgroundColor:(t.vars||t).palette.primary.light}}}]}})),JR=(0,Iy.ZP)(LM,{name:"MuiClock",slot:"meridiemText",overridesResolver:(e,t)=>t.meridiemText})({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"});function QR(t){const n=(0,Ry.Z)({props:t,name:"MuiClock"}),{ampm:r,ampmInClock:i,autoFocus:o,children:s,value:a,handleMeridiemChange:l,isTimeDisabled:c,meridiemMode:u,minutesStep:h=1,onChange:d,selectedId:p,type:f,viewValue:m,disabled:g=!1,readOnly:y,className:v}=n,_=n,x=$S(),b=XS(),w=e.useRef(!1),S=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],clock:["clock"],wrapper:["wrapper"],squareMask:["squareMask"],pin:["pin"],amButton:["amButton"],pmButton:["pmButton"],meridiemText:["meridiemText"]},HR,t)})(_),M=c(m,f),E=!r&&"hours"===f&&(m<1||m>12),T=(e,t)=>{g||y||c(e,f)||d(e,t)},C=(e,t)=>{let{offsetX:n,offsetY:i}=e;if(void 0===n){const t=e.target.getBoundingClientRect();n=e.changedTouches[0].clientX-t.left,i=e.changedTouches[0].clientY-t.top}const o="seconds"===f||"minutes"===f?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=6*n;let{value:i}=FR(r,e,t);return i=i*n%60,i}(n,i,h):((e,t,n)=>{const{value:r,distance:i}=FR(30,e,t);let o=r||12;return n?o%=12:i<RR/2-LR&&(o+=12,o%=24),o})(n,i,Boolean(r));T(o,t)},A=e.useMemo((()=>"hours"===f||m%5==0),[f,m]),I="minutes"===f?h:1,P=e.useRef(null);return(0,Cv.Z)((()=>{o&&P.current.focus()}),[o]),(0,Wy.jsxs)(ZR,{className:(0,Ey.Z)(v,S.root),children:[(0,Wy.jsxs)(WR,{className:S.clock,children:[(0,Wy.jsx)(qR,{onTouchMove:e=>{w.current=!0,C(e,"shallow")},onTouchEnd:e=>{w.current&&(C(e,"finish"),w.current=!1)},onMouseUp:e=>{w.current&&(w.current=!1),C(e.nativeEvent,"finish")},onMouseMove:e=>{e.buttons>0&&C(e.nativeEvent,"shallow")},ownerState:{disabled:g},className:S.squareMask}),!M&&(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(XR,{className:S.pin}),null!=a&&(0,Wy.jsx)(GR,{type:f,viewValue:m,isInner:E,hasSelected:A})]}),(0,Wy.jsx)($R,{"aria-activedescendant":p,"aria-label":b.clockLabelText(f,a,x),ref:P,role:"listbox",onKeyDown:e=>{if(!w.current)switch(e.key){case"Home":T(0,"partial"),e.preventDefault();break;case"End":T("minutes"===f?59:23,"partial"),e.preventDefault();break;case"ArrowUp":T(m+I,"partial"),e.preventDefault();break;case"ArrowDown":T(m-I,"partial"),e.preventDefault()}},tabIndex:0,className:S.wrapper,children:s})]}),r&&i&&(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(YR,{onClick:y?void 0:()=>l("am"),disabled:g||null===u,ownerState:_,className:S.amButton,title:Kv(x,"am"),children:(0,Wy.jsx)(JR,{variant:"caption",className:S.meridiemText,children:Kv(x,"am")})}),(0,Wy.jsx)(KR,{disabled:g||null===u,onClick:y?void 0:()=>l("pm"),ownerState:_,className:S.pmButton,title:Kv(x,"pm"),children:(0,Wy.jsx)(JR,{variant:"caption",className:S.meridiemText,children:Kv(x,"pm")})})]})]})}function eL(e){return(0,lv.ZP)("MuiClockNumber",e)}const tL=(0,$y.Z)("MuiClockNumber",["root","selected","disabled"]),nL=["className","disabled","index","inner","label","selected"],rL=(0,Iy.ZP)("span",{name:"MuiClockNumber",slot:"Root",overridesResolver:(e,t)=>[t.root,{[`&.${tL.disabled}`]:t.disabled},{[`&.${tL.selected}`]:t.selected}]})((e=>{let{theme:t}=e;return{height:LR,width:LR,position:"absolute",left:"calc((100% - 36px) / 2)",display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",color:(t.vars||t).palette.text.primary,fontFamily:t.typography.fontFamily,"&:focused":{backgroundColor:(t.vars||t).palette.background.paper},[`&.${tL.selected}`]:{color:(t.vars||t).palette.primary.contrastText},[`&.${tL.disabled}`]:{pointerEvents:"none",color:(t.vars||t).palette.text.disabled},variants:[{props:{inner:!0},style:(0,_n.Z)({},t.typography.body2,{color:(t.vars||t).palette.text.secondary})}]}}));function iL(e){const t=(0,Ry.Z)({props:e,name:"MuiClockNumber"}),{className:n,disabled:r,index:i,inner:o,label:s,selected:a}=t,l=(0,My.Z)(t,nL),c=t,u=(e=>{const{classes:t,selected:n,disabled:r}=e,i={root:["root",n&&"selected",r&&"disabled"]};return(0,Cy.Z)(i,eL,t)})(c),h=i%12/12*Math.PI*2-Math.PI/2,d=(RR-LR-2)/2*(o?.65:1),p=Math.round(Math.cos(h)*d),f=Math.round(Math.sin(h)*d);return(0,Wy.jsx)(rL,(0,_n.Z)({className:(0,Ey.Z)(n,u.root),"aria-disabled":!!r||void 0,"aria-selected":!!a||void 0,role:"option",style:{transform:`translate(${p}px, ${f+(RR-LR)/2}px`},ownerState:c},l,{children:s}))}const oL=e=>{let{ampm:t,value:n,getClockNumberText:r,isDisabled:i,selectedId:o,utils:s}=e;const a=n?s.getHours(n):null,l=[],c=t?12:23,u=e=>null!==a&&(t?12===e?12===a||0===a:a===e||a-12===e:a===e);for(let e=t?1:0;e<=c;e+=1){let n=e.toString();0===e&&(n="00");const a=!t&&(0===e||e>12);n=s.formatNumber(n);const c=u(e);l.push((0,Wy.jsx)(iL,{id:c?o:void 0,index:e,inner:a,selected:c,disabled:i(e),label:n,"aria-label":r(n)},e))}return l},sL=e=>{let{utils:t,value:n,isDisabled:r,getClockNumberText:i,selectedId:o}=e;const s=t.formatNumber;return[[5,s("05")],[10,s("10")],[15,s("15")],[20,s("20")],[25,s("25")],[30,s("30")],[35,s("35")],[40,s("40")],[45,s("45")],[50,s("50")],[55,s("55")],[0,s("00")]].map(((e,t)=>{let[s,a]=e;const l=s===n;return(0,Wy.jsx)(iL,{label:a,id:l?o:void 0,index:t+1,inner:!1,disabled:r(s),selected:l,"aria-label":i(a)},s)}))},aL=t=>{let{value:n,referenceDate:r,utils:i,props:o,timezone:s}=t;const a=e.useMemo((()=>L_.getInitialReferenceValue({value:n,utils:i,props:o,referenceDate:r,granularity:h_.day,timezone:s,getTodayDate:()=>Yv(i,s,"date")})),[]);return n??a},lL=["ampm","ampmInClock","autoFocus","slots","slotProps","value","defaultValue","referenceDate","disableIgnoringDatePartForTimeValidation","maxTime","minTime","disableFuture","disablePast","minutesStep","shouldDisableTime","showViewSwitcher","onChange","view","views","openTo","onViewChange","focusedView","onFocusedViewChange","className","disabled","readOnly","timezone"],cL=(0,Iy.ZP)(GA,{name:"MuiTimeClock",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"column",position:"relative"}),uL=(0,Iy.ZP)(LA,{name:"MuiTimeClock",slot:"ArrowSwitcher",overridesResolver:(e,t)=>t.arrowSwitcher})({position:"absolute",right:12,top:15}),hL=["hours","minutes"],dL=e.forwardRef((function(t,n){const r=$S(),i=(0,Ry.Z)({props:t,name:"MuiTimeClock"}),{ampm:o=r.is12HourCycleInCurrentLocale(),ampmInClock:s=!1,autoFocus:a,slots:l,slotProps:c,value:u,defaultValue:h,referenceDate:d,disableIgnoringDatePartForTimeValidation:p=!1,maxTime:f,minTime:m,disableFuture:g,disablePast:y,minutesStep:v=1,shouldDisableTime:_,showViewSwitcher:x,onChange:b,view:w,views:S=hL,openTo:M,onViewChange:E,focusedView:T,onFocusedViewChange:C,className:A,disabled:I,readOnly:P,timezone:R}=i,L=(0,My.Z)(i,lL),{value:D,handleValueChange:O,timezone:N}=rM({name:"TimeClock",timezone:R,value:u,defaultValue:h,onChange:b,valueManager:L_}),k=aL({value:D,referenceDate:d,utils:r,props:i,timezone:N}),F=XS(),z=YS(N),{view:B,setView:U,previousView:j,nextView:V,setValueAndGoToNextView:G}=MA({view:w,views:S,openTo:M,onViewChange:E,onChange:O,focusedView:T,onFocusedViewChange:C}),{meridiemMode:H,handleMeridiemChange:Z}=oC(k,o,G),W=e.useCallback(((e,t)=>{const n=c_(p,r),i="hours"===t||"minutes"===t&&S.includes("seconds"),s=e=>{let{start:t,end:r}=e;return!(m&&n(m,r)||f&&n(t,f)||g&&n(t,z)||y&&n(z,i?r:t))},a=function(e){if(e%(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)!=0)return!1;if(_)switch(t){case"hours":return!_(r.setHours(k,e),"hours");case"minutes":return!_(r.setMinutes(k,e),"minutes");case"seconds":return!_(r.setSeconds(k,e),"seconds");default:return!1}return!0};switch(t){case"hours":{const t=s_(e,H,o),n=r.setHours(k,t);return!s({start:r.setSeconds(r.setMinutes(n,0),0),end:r.setSeconds(r.setMinutes(n,59),59)})||!a(t)}case"minutes":{const t=r.setMinutes(k,e);return!s({start:r.setSeconds(t,0),end:r.setSeconds(t,59)})||!a(e,v)}case"seconds":{const t=r.setSeconds(k,e);return!s({start:t,end:t})||!a(e)}default:throw new Error("not supported")}}),[o,k,p,f,H,m,v,_,r,g,y,z,S]),$=(0,O_.Z)(),q=e.useMemo((()=>{switch(B){case"hours":{const e=(e,t)=>{const n=s_(e,H,o);G(r.setHours(k,n),t,"hours")};return{onChange:e,viewValue:r.getHours(k),children:oL({value:D,utils:r,ampm:o,onChange:e,getClockNumberText:F.hoursClockNumberText,isDisabled:e=>I||W(e,"hours"),selectedId:$})}}case"minutes":{const e=r.getMinutes(k),t=(e,t)=>{G(r.setMinutes(k,e),t,"minutes")};return{viewValue:e,onChange:t,children:sL({utils:r,value:e,onChange:t,getClockNumberText:F.minutesClockNumberText,isDisabled:e=>I||W(e,"minutes"),selectedId:$})}}case"seconds":{const e=r.getSeconds(k),t=(e,t)=>{G(r.setSeconds(k,e),t,"seconds")};return{viewValue:e,onChange:t,children:sL({utils:r,value:e,onChange:t,getClockNumberText:F.secondsClockNumberText,isDisabled:e=>I||W(e,"seconds"),selectedId:$})}}default:throw new Error("You must provide the type for ClockView")}}),[B,r,D,o,F.hoursClockNumberText,F.minutesClockNumberText,F.secondsClockNumberText,H,G,k,W,$,I]),X=i,Y=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],arrowSwitcher:["arrowSwitcher"]},PR,t)})(X);return(0,Wy.jsxs)(cL,(0,_n.Z)({ref:n,className:(0,Ey.Z)(Y.root,A),ownerState:X},L,{children:[(0,Wy.jsx)(QR,(0,_n.Z)({autoFocus:a??!!T,ampmInClock:s&&S.includes("hours"),value:D,type:B,ampm:o,minutesStep:v,isTimeDisabled:W,meridiemMode:H,handleMeridiemChange:Z,selectedId:$,disabled:I,readOnly:P},q)),x&&(0,Wy.jsx)(uL,{className:Y.arrowSwitcher,slots:l,slotProps:c,onGoToPrevious:()=>U(j),isPreviousDisabled:!j,previousLabel:F.openPreviousView,onGoToNext:()=>U(V),isNextDisabled:!V,nextLabel:F.openNextView,ownerState:X})]}))}));function pL(e){return(0,lv.ZP)("MuiListItemIcon",e)}const fL=(0,$y.Z)("MuiListItemIcon",["root","alignItemsFlexStart"]);function mL(e){return(0,lv.ZP)("MuiListItemText",e)}const gL=(0,$y.Z)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);function yL(e){return(0,lv.ZP)("MuiMenuItem",e)}const vL=(0,$y.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),_L=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],xL=(0,Iy.ZP)(fv,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${vL.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${vL.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${vL.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${vL.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${vL.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Bv.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Bv.inset}`]:{marginLeft:52},[`& .${gL.root}`]:{marginTop:0,marginBottom:0},[`& .${gL.inset}`]:{paddingLeft:36},[`& .${fL.root}`]:{minWidth:36}},!n.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},n.dense&&(0,_n.Z)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${fL.root} svg`]:{fontSize:"1.25rem"}}))})),bL=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiMenuItem"}),{autoFocus:i=!1,component:o="li",dense:s=!1,divider:a=!1,disableGutters:l=!1,focusVisibleClassName:c,role:u="menuitem",tabIndex:h,className:d}=r,p=(0,My.Z)(r,_L),f=e.useContext(_b),m=e.useMemo((()=>({dense:s||f.dense||!1,disableGutters:l})),[f.dense,s,l]),g=e.useRef(null);(0,q_.Z)((()=>{i&&g.current&&g.current.focus()}),[i]);const y=(0,_n.Z)({},r,{dense:m.dense,divider:a,disableGutters:l}),v=(e=>{const{disabled:t,dense:n,divider:r,disableGutters:i,selected:o,classes:s}=e,a={root:["root",n&&"dense",t&&"disabled",!i&&"gutters",r&&"divider",o&&"selected"]},l=(0,Cy.Z)(a,yL,s);return(0,_n.Z)({},s,l)})(r),_=(0,Ly.Z)(g,n);let x;return r.disabled||(x=void 0!==h?h:-1),(0,Wy.jsx)(_b.Provider,{value:m,children:(0,Wy.jsx)(xL,(0,_n.Z)({ref:_,role:u,tabIndex:x,component:o,focusVisibleClassName:(0,Ey.Z)(v.focusVisible,c),className:(0,Ey.Z)(v.root,d)},p,{ownerState:y,classes:v}))})})),wL=bL;function SL(e){return(0,lv.ZP)("MuiDigitalClock",e)}const ML=(0,$y.Z)("MuiDigitalClock",["root","list","item"]),EL=["ampm","timeStep","autoFocus","slots","slotProps","value","defaultValue","referenceDate","disableIgnoringDatePartForTimeValidation","maxTime","minTime","disableFuture","disablePast","minutesStep","shouldDisableTime","onChange","view","openTo","onViewChange","focusedView","onFocusedViewChange","className","disabled","readOnly","views","skipDisabled","timezone"],TL=(0,Iy.ZP)(GA,{name:"MuiDigitalClock",slot:"Root",overridesResolver:(e,t)=>t.root})({overflowY:"auto",width:"100%","@media (prefers-reduced-motion: no-preference)":{scrollBehavior:"auto"},maxHeight:232,variants:[{props:{alreadyRendered:!0},style:{"@media (prefers-reduced-motion: no-preference)":{scrollBehavior:"smooth"}}}]}),CL=(0,Iy.ZP)(Db,{name:"MuiDigitalClock",slot:"List",overridesResolver:(e,t)=>t.list})({padding:0}),AL=(0,Iy.ZP)(wL,{name:"MuiDigitalClock",slot:"Item",overridesResolver:(e,t)=>t.item})((e=>{let{theme:t}=e;return{padding:"8px 16px",margin:"2px 4px","&:first-of-type":{marginTop:4},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.primary.main,t.palette.action.hoverOpacity)},"&.Mui-selected":{backgroundColor:(t.vars||t).palette.primary.main,color:(t.vars||t).palette.primary.contrastText,"&:focus-visible, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}},"&.Mui-focusVisible":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.focusOpacity})`:EC(t.palette.primary.main,t.palette.action.focusOpacity)}}})),IL=e.forwardRef((function(t,n){const r=$S(),i=e.useRef(null),o=(0,F_.Z)(n,i),s=(0,Ry.Z)({props:t,name:"MuiDigitalClock"}),{ampm:a=r.is12HourCycleInCurrentLocale(),timeStep:l=30,autoFocus:c,slots:u,slotProps:h,value:d,defaultValue:p,referenceDate:f,disableIgnoringDatePartForTimeValidation:m=!1,maxTime:g,minTime:y,disableFuture:v,disablePast:_,minutesStep:x=1,shouldDisableTime:b,onChange:w,view:S,openTo:M,onViewChange:E,focusedView:T,onFocusedViewChange:C,className:A,disabled:I,readOnly:P,views:R=["hours"],skipDisabled:L=!1,timezone:D}=s,O=(0,My.Z)(s,EL),{value:N,handleValueChange:k,timezone:F}=rM({name:"DigitalClock",timezone:D,value:d,defaultValue:p,onChange:w,valueManager:L_}),z=XS(),B=YS(F),U=e.useMemo((()=>(0,_n.Z)({},s,{alreadyRendered:!!i.current})),[s]),j=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],list:["list"],item:["item"]},SL,t)})(U),V=u?.digitalClockItem??AL,G=gb({elementType:V,externalSlotProps:h?.digitalClockItem,ownerState:{},className:j.item}),H=aL({value:N,referenceDate:f,utils:r,props:s,timezone:F}),Z=(0,tw.Z)((e=>k(e,"finish","hours"))),{setValueAndGoToNextView:W}=MA({view:S,views:R,openTo:M,onViewChange:E,onChange:Z,focusedView:T,onFocusedViewChange:C}),$=(0,tw.Z)((e=>{W(e,"finish")}));e.useEffect((()=>{if(null===i.current)return;const e=i.current.querySelector('[role="listbox"] [role="option"][tabindex="0"], [role="listbox"] [role="option"][aria-selected="true"]');if(!e)return;const t=e.offsetTop;(c||T)&&e.focus(),i.current.scrollTop=t-4}));const q=e.useCallback((e=>{const t=c_(m,r);return!!(y&&t(y,e)||g&&t(e,g)||v&&t(e,B)||_&&t(B,e))||!!(r.getMinutes(e)%x!=0||b&&b(e,"hours"))}),[m,r,y,g,v,B,_,x,b]),X=e.useMemo((()=>{const e=r.startOfDay(H);return[e,...Array.from({length:Math.ceil(1440/l)-1},((t,n)=>r.addMinutes(e,l*(n+1))))]}),[H,l,r]),Y=X.findIndex((e=>r.isEqual(e,H)));return(0,Wy.jsx)(TL,(0,_n.Z)({ref:o,className:(0,Ey.Z)(j.root,A),ownerState:U},O,{children:(0,Wy.jsx)(CL,{role:"listbox","aria-label":z.timePickerToolbarTitle,className:j.list,children:X.map(((e,t)=>{if(L&&q(e))return null;const n=r.isEqual(e,N),i=r.format(e,a?"fullTime12h":"fullTime24h"),o=Y===t||-1===Y&&0===t?0:-1;return(0,Wy.jsx)(V,(0,_n.Z)({onClick:()=>!P&&$(e),selected:n,disabled:I||q(e),disableRipple:P,role:"option","aria-disabled":P,"aria-selected":n,tabIndex:o},G,{children:i}),i)}))})}))}));function PL(e){return(0,lv.ZP)("MuiMultiSectionDigitalClock",e)}const RL=(0,$y.Z)("MuiMultiSectionDigitalClock",["root"]);function LL(e){return(0,lv.ZP)("MuiMultiSectionDigitalClockSection",e)}const DL=(0,$y.Z)("MuiMultiSectionDigitalClockSection",["root","item"]),OL=["autoFocus","onChange","className","disabled","readOnly","items","active","slots","slotProps","skipDisabled"],NL=(0,Iy.ZP)(Db,{name:"MuiMultiSectionDigitalClockSection",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{maxHeight:232,width:56,padding:0,overflow:"hidden","@media (prefers-reduced-motion: no-preference)":{scrollBehavior:"auto"},"@media (pointer: fine)":{"&:hover":{overflowY:"auto"}},"@media (pointer: none), (pointer: coarse)":{overflowY:"auto"},"&:not(:first-of-type)":{borderLeft:`1px solid ${(t.vars||t).palette.divider}`},"&::after":{display:"block",content:'""',height:"calc(100% - 40px - 6px)"},variants:[{props:{alreadyRendered:!0},style:{"@media (prefers-reduced-motion: no-preference)":{scrollBehavior:"smooth"}}}]}})),kL=(0,Iy.ZP)(wL,{name:"MuiMultiSectionDigitalClockSection",slot:"Item",overridesResolver:(e,t)=>t.item})((e=>{let{theme:t}=e;return{padding:8,margin:"2px 4px",width:lC,justifyContent:"center","&:first-of-type":{marginTop:4},"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.hoverOpacity})`:EC(t.palette.primary.main,t.palette.action.hoverOpacity)},"&.Mui-selected":{backgroundColor:(t.vars||t).palette.primary.main,color:(t.vars||t).palette.primary.contrastText,"&:focus-visible, &:hover":{backgroundColor:(t.vars||t).palette.primary.dark}},"&.Mui-focusVisible":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.focusOpacity})`:EC(t.palette.primary.main,t.palette.action.focusOpacity)}}})),FL=e.forwardRef((function(t,n){const r=e.useRef(null),i=(0,F_.Z)(n,r),o=e.useRef(null),s=(0,Ry.Z)({props:t,name:"MuiMultiSectionDigitalClockSection"}),{autoFocus:a,onChange:l,className:c,disabled:u,readOnly:h,items:d,active:p,slots:f,slotProps:m,skipDisabled:g}=s,y=(0,My.Z)(s,OL),v=e.useMemo((()=>(0,_n.Z)({},s,{alreadyRendered:!!r.current})),[s]),_=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],item:["item"]},LL,t)})(v),x=f?.digitalClockSectionItem??kL;e.useEffect((()=>{if(null===r.current)return;const e=r.current.querySelector('[role="option"][tabindex="0"], [role="option"][aria-selected="true"]');if(p&&a&&e&&e.focus(),!e||o.current===e)return;o.current=e;const t=e.offsetTop;r.current.scrollTop=t-4}));const b=d.findIndex((e=>e.isFocused(e.value)));return(0,Wy.jsx)(NL,(0,_n.Z)({ref:i,className:(0,Ey.Z)(_.root,c),ownerState:v,autoFocusItem:a&&p,role:"listbox"},y,{children:d.map(((e,t)=>{const n=e.isDisabled?.(e.value),r=u||n;if(g&&r)return null;const i=e.isSelected(e.value),o=b===t||-1===b&&0===t?0:-1;return(0,Wy.jsx)(x,(0,_n.Z)({onClick:()=>!h&&l(e.value),selected:i,disabled:r,disableRipple:h,role:"option","aria-disabled":h||r||void 0,"aria-label":e.ariaLabel,"aria-selected":i,tabIndex:o,className:_.item},m?.digitalClockSectionItem,{children:e.label}),e.label)}))}))})),zL=e=>{let{now:t,value:n,utils:r,ampm:i,isDisabled:o,resolveAriaLabel:s,timeStep:a,valueOrReferenceDate:l}=e;const c=n?r.getHours(n):null,u=[],h=(e,t)=>{const n=t??c;return null!==n&&(i?12===e?12===n||0===n:n===e||n-12===e:n===e)},d=e=>h(e,r.getHours(l)),p=i?11:23;for(let e=0;e<=p;e+=a){let n=r.format(r.setHours(t,e),i?"hours12h":"hours24h");const a=s(parseInt(n,10).toString());n=r.formatNumber(n),u.push({value:e,label:n,isSelected:h,isDisabled:o,isFocused:d,ariaLabel:a})}return u},BL=e=>{let{value:t,utils:n,isDisabled:r,timeStep:i,resolveLabel:o,resolveAriaLabel:s,hasValue:a=!0}=e;const l=e=>null!==t&&a&&t===e,c=e=>t===e;return[...Array.from({length:Math.ceil(60/i)},((e,t)=>{const a=i*t;return{value:a,label:n.formatNumber(o(a)),isDisabled:r,isSelected:l,isFocused:c,ariaLabel:s(a.toString())}}))]},UL=["ampm","timeSteps","autoFocus","slots","slotProps","value","defaultValue","referenceDate","disableIgnoringDatePartForTimeValidation","maxTime","minTime","disableFuture","disablePast","minutesStep","shouldDisableTime","onChange","view","views","openTo","onViewChange","focusedView","onFocusedViewChange","className","disabled","readOnly","skipDisabled","timezone"],jL=(0,Iy.ZP)(GA,{name:"MuiMultiSectionDigitalClock",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"flex",flexDirection:"row",width:"100%",borderBottom:`1px solid ${(t.vars||t).palette.divider}`}})),VL=e.forwardRef((function(t,n){const r=$S(),i=(0,Ry.Z)({props:t,name:"MuiMultiSectionDigitalClock"}),{ampm:o=r.is12HourCycleInCurrentLocale(),timeSteps:s,autoFocus:a,slots:l,slotProps:c,value:u,defaultValue:h,referenceDate:d,disableIgnoringDatePartForTimeValidation:p=!1,maxTime:f,minTime:m,disableFuture:g,disablePast:y,minutesStep:v=1,shouldDisableTime:_,onChange:x,view:b,views:w=["hours","minutes"],openTo:S,onViewChange:M,focusedView:E,onFocusedViewChange:T,className:C,disabled:A,readOnly:I,skipDisabled:P=!1,timezone:R}=i,L=(0,My.Z)(i,UL),{value:D,handleValueChange:O,timezone:N}=rM({name:"MultiSectionDigitalClock",timezone:R,value:u,defaultValue:h,onChange:x,valueManager:L_}),k=XS(),F=YS(N),z=e.useMemo((()=>(0,_n.Z)({hours:1,minutes:5,seconds:5},s)),[s]),B=aL({value:D,referenceDate:d,utils:r,props:i,timezone:N}),U=(0,tw.Z)(((e,t,n)=>O(e,t,n))),j=e.useMemo((()=>o&&w.includes("hours")?w.includes("meridiem")?w:[...w,"meridiem"]:w),[o,w]),{view:V,setValueAndGoToNextView:G,focusedView:H}=MA({view:b,views:j,openTo:S,onViewChange:M,onChange:U,focusedView:E,onFocusedViewChange:T}),Z=(0,tw.Z)((e=>{G(e,"finish","meridiem")})),{meridiemMode:W,handleMeridiemChange:$}=oC(B,o,Z,"finish"),q=e.useCallback(((e,t)=>{const n=c_(p,r),i="hours"===t||"minutes"===t&&j.includes("seconds"),s=e=>{let{start:t,end:r}=e;return!(m&&n(m,r)||f&&n(t,f)||g&&n(t,F)||y&&n(F,i?r:t))},a=function(e){if(e%(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)!=0)return!1;if(_)switch(t){case"hours":return!_(r.setHours(B,e),"hours");case"minutes":return!_(r.setMinutes(B,e),"minutes");case"seconds":return!_(r.setSeconds(B,e),"seconds");default:return!1}return!0};switch(t){case"hours":{const t=s_(e,W,o),n=r.setHours(B,t);return!s({start:r.setSeconds(r.setMinutes(n,0),0),end:r.setSeconds(r.setMinutes(n,59),59)})||!a(t)}case"minutes":{const t=r.setMinutes(B,e);return!s({start:r.setSeconds(t,0),end:r.setSeconds(t,59)})||!a(e,v)}case"seconds":{const t=r.setSeconds(B,e);return!s({start:t,end:t})||!a(e)}default:throw new Error("not supported")}}),[o,B,p,f,W,m,v,_,r,g,y,F,j]),X=e.useCallback((e=>{switch(e){case"hours":return{onChange:e=>{const t=s_(e,W,o);G(r.setHours(B,t),"finish","hours")},items:zL({now:F,value:D,ampm:o,utils:r,isDisabled:e=>q(e,"hours"),timeStep:z.hours,resolveAriaLabel:k.hoursClockNumberText,valueOrReferenceDate:B})};case"minutes":return{onChange:e=>{G(r.setMinutes(B,e),"finish","minutes")},items:BL({value:r.getMinutes(B),utils:r,isDisabled:e=>q(e,"minutes"),resolveLabel:e=>r.format(r.setMinutes(F,e),"minutes"),timeStep:z.minutes,hasValue:!!D,resolveAriaLabel:k.minutesClockNumberText})};case"seconds":return{onChange:e=>{G(r.setSeconds(B,e),"finish","seconds")},items:BL({value:r.getSeconds(B),utils:r,isDisabled:e=>q(e,"seconds"),resolveLabel:e=>r.format(r.setSeconds(F,e),"seconds"),timeStep:z.seconds,hasValue:!!D,resolveAriaLabel:k.secondsClockNumberText})};case"meridiem":{const e=Kv(r,"am"),t=Kv(r,"pm");return{onChange:$,items:[{value:"am",label:e,isSelected:()=>!!D&&"am"===W,isFocused:()=>!!B&&"am"===W,ariaLabel:e},{value:"pm",label:t,isSelected:()=>!!D&&"pm"===W,isFocused:()=>!!B&&"pm"===W,ariaLabel:t}]}}default:throw new Error(`Unknown view: ${e} found.`)}}),[F,D,o,r,z.hours,z.minutes,z.seconds,k.hoursClockNumberText,k.minutesClockNumberText,k.secondsClockNumberText,W,G,B,q,$]),Y=e.useMemo((()=>j.reduce(((e,t)=>(0,_n.Z)({},e,{[t]:X(t)})),{})),[j,X]),K=i,J=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},PL,t)})(K);return(0,Wy.jsx)(jL,(0,_n.Z)({ref:n,className:(0,Ey.Z)(J.root,C),ownerState:K,role:"group"},L,{children:Object.entries(Y).map((e=>{let[t,n]=e;return(0,Wy.jsx)(FL,{items:n.items,onChange:n.onChange,active:V===t,autoFocus:a??H===t,disabled:A,readOnly:I,slots:l,slotProps:c,skipDisabled:P,"aria-label":k.selectViewText(t)},t)}))}))})),GL=e=>{let{view:t,onViewChange:n,focusedView:r,onFocusedViewChange:i,views:o,value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,ampmInClock:_,slots:x,slotProps:b,readOnly:w,disabled:S,sx:M,autoFocus:E,showViewSwitcher:T,disableIgnoringDatePartForTimeValidation:C,timezone:A}=e;return(0,Wy.jsx)(dL,{view:t,onViewChange:n,focusedView:r&&r_(r)?r:null,onFocusedViewChange:i,views:o.filter(r_),value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,ampmInClock:_,slots:x,slotProps:b,readOnly:w,disabled:S,sx:M,autoFocus:E,showViewSwitcher:T,disableIgnoringDatePartForTimeValidation:C,timezone:A})},HL=e=>{let{view:t,onViewChange:n,focusedView:r,onFocusedViewChange:i,views:o,value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,slots:_,slotProps:x,readOnly:b,disabled:w,sx:S,autoFocus:M,disableIgnoringDatePartForTimeValidation:E,timeSteps:T,skipDisabled:C,timezone:A}=e;return(0,Wy.jsx)(IL,{view:t,onViewChange:n,focusedView:r,onFocusedViewChange:i,views:o.filter(r_),value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,slots:_,slotProps:x,readOnly:b,disabled:w,sx:S,autoFocus:M,disableIgnoringDatePartForTimeValidation:E,timeStep:T?.minutes,skipDisabled:C,timezone:A})},ZL=e=>{let{view:t,onViewChange:n,focusedView:r,onFocusedViewChange:i,views:o,value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,slots:_,slotProps:x,readOnly:b,disabled:w,sx:S,autoFocus:M,disableIgnoringDatePartForTimeValidation:E,timeSteps:T,skipDisabled:C,timezone:A}=e;return(0,Wy.jsx)(VL,{view:t,onViewChange:n,focusedView:r,onFocusedViewChange:i,views:o.filter(r_),value:s,defaultValue:a,referenceDate:l,onChange:c,className:u,classes:h,disableFuture:d,disablePast:p,minTime:f,maxTime:m,shouldDisableTime:g,minutesStep:y,ampm:v,slots:_,slotProps:x,readOnly:b,disabled:w,sx:S,autoFocus:M,disableIgnoringDatePartForTimeValidation:E,timeSteps:T,skipDisabled:C,timezone:A})};function WL(e){const{toolbar:t,tabs:n,content:r,actionBar:i,shortcuts:o}=xR(e),{sx:s,className:a,isLandscape:l,ref:c,classes:u}=e,h=i&&(i.props.actions?.length??0)>0;return(0,Wy.jsxs)(bR,{ref:c,className:(0,Ey.Z)(a,BP.root,u?.root),sx:[{[`& .${BP.tabs}`]:{gridRow:4,gridColumn:"1 / 4"},[`& .${BP.actionBar}`]:{gridRow:5}},...Array.isArray(s)?s:[s]],ownerState:e,children:[l?o:t,l?t:o,(0,Wy.jsxs)(wR,{className:(0,Ey.Z)(BP.contentWrapper,u?.contentWrapper),sx:{display:"grid"},children:[r,n,h&&(0,Wy.jsx)(Hv,{sx:{gridRow:3,gridColumn:"1 / 4"}})]}),i]})}const $L=["openTo","focusedView","timeViewsCount"],qL=function(t,n,r){const{openTo:i,focusedView:o,timeViewsCount:s}=r,a=(0,My.Z)(r,$L),l=(0,_n.Z)({},a,{focusedView:null,sx:[{[`&.${RL.root}`]:{borderBottom:0},[`&.${RL.root}, .${DL.root}, &.${ML.root}`]:{maxHeight:aC}}]}),c=i_(n);return(0,Wy.jsxs)(e.Fragment,{children:[t[c?"day":n]?.((0,_n.Z)({},r,{view:c?"day":n,focusedView:o&&Qv(o)?o:null,views:r.views.filter(Qv),sx:[{gridColumn:1},...l.sx]})),s>0&&(0,Wy.jsxs)(e.Fragment,{children:[(0,Wy.jsx)(Hv,{orientation:"vertical",sx:{gridColumn:2}}),t[c?n:"hours"]?.((0,_n.Z)({},l,{view:c?n:"hours",focusedView:o&&i_(o)?o:null,openTo:i_(i)?i:"hours",views:r.views.filter(i_),sx:[{gridColumn:3},...l.sx]}))]})]})},XL=e.forwardRef((function(t,n){const r=XS(),i=$S(),o=vC(t,"MuiDesktopDateTimePicker"),{shouldRenderTimeInASingleColumn:s,thresholdToRenderTimeInASingleColumn:a,views:l,timeSteps:c}=function(e){let{thresholdToRenderTimeInASingleColumn:t,ampm:n,timeSteps:r,views:i}=e;const o=t??24,s=(0,_n.Z)({hours:1,minutes:5,seconds:5},r),a=((e,t)=>1440/((e.hours??1)*(e.minutes??5))<=t)(s,o);return{thresholdToRenderTimeInASingleColumn:o,timeSteps:s,shouldRenderTimeInASingleColumn:a,views:IR(n,i,a)}}(o),u=s?HL:ZL,h=(0,_n.Z)({day:eI,month:eI,year:eI,hours:u,minutes:u,seconds:u,meridiem:u},o.viewRenderers),d=o.ampmInClock??!0,p=h.hours?.name===ZL.name?l:l.filter((e=>"meridiem"!==e)),f=s?[]:["accept"],m=(0,_n.Z)({},o,{viewRenderers:h,format:AR(i,o),views:p,yearsPerRow:o.yearsPerRow??4,ampmInClock:d,timeSteps:c,thresholdToRenderTimeInASingleColumn:a,shouldRenderTimeInASingleColumn:s,slots:(0,_n.Z)({field:iT,layout:WL,openPickerIcon:GM},o.slots),slotProps:(0,_n.Z)({},o.slotProps,{field:e=>(0,_n.Z)({},kv(o.slotProps?.field,e),gM(o),{ref:n}),toolbar:(0,_n.Z)({hidden:!0,ampmInClock:d,toolbarVariant:"desktop"},o.slotProps?.toolbar),tabs:(0,_n.Z)({hidden:!0},o.slotProps?.tabs),actionBar:e=>(0,_n.Z)({actions:f},kv(o.slotProps?.actionBar,e))})}),{renderPicker:g}=(t=>{let{props:n,getOpenDialogAriaText:r}=t,i=(0,My.Z)(t,MR);const{slots:o,slotProps:s,className:a,sx:l,format:c,formatDensity:u,enableAccessibleFieldDOMStructure:h,selectedSections:d,onSelectedSectionsChange:p,timezone:f,name:m,label:g,inputRef:y,readOnly:v,disabled:_,autoFocus:x,localeText:b,reduceAnimations:w}=n,S=$S(),M=e.useRef(null),E=e.useRef(null),T=(0,O_.Z)(),C=s?.toolbar?.hidden??!1,{open:A,actions:I,hasUIView:P,layoutProps:R,renderCurrentView:L,shouldRestoreFocus:D,fieldProps:O}=FP((0,_n.Z)({},i,{props:n,fieldRef:E,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"desktop"})),N=o.inputAdornment??BM,k=gb({elementType:N,externalSlotProps:s?.inputAdornment,additionalProps:{position:"end"},ownerState:n}),F=(0,My.Z)(k,ER),z=o.openPickerButton??MM,B=gb({elementType:z,externalSlotProps:s?.openPickerButton,additionalProps:{disabled:_||v,onClick:A?I.onClose:I.onOpen,"aria-label":r(O.value,S),edge:F.position},ownerState:n}),U=(0,My.Z)(B,TR),j=o.openPickerIcon,V=o.field,G=gb({elementType:V,externalSlotProps:s?.field,additionalProps:(0,_n.Z)({},O,C&&{id:T},{readOnly:v,disabled:_,className:a,sx:l,format:c,formatDensity:u,enableAccessibleFieldDOMStructure:h,selectedSections:d,onSelectedSectionsChange:p,timezone:f,label:g,name:m,autoFocus:x&&!n.open,focused:!!A||void 0},y?{inputRef:y}:{}),ownerState:n});P&&(G.InputProps=(0,_n.Z)({},G.InputProps,{ref:M},!n.disableOpenPicker&&{[`${F.position}Adornment`]:(0,Wy.jsx)(N,(0,_n.Z)({},F,{children:(0,Wy.jsx)(z,(0,_n.Z)({},U,{children:(0,Wy.jsx)(j,(0,_n.Z)({},s?.openPickerIcon))}))}))}));const H=(0,_n.Z)({textField:o.textField,clearIcon:o.clearIcon,clearButton:o.clearButton},G.slots),Z=o.layout??SR;let W=T;C&&(W=g?`${T}-label`:void 0);const $=(0,_n.Z)({},s,{toolbar:(0,_n.Z)({},s?.toolbar,{titleId:T}),popper:(0,_n.Z)({"aria-labelledby":W},s?.popper)}),q=(0,F_.Z)(E,G.unstableFieldRef);return{renderPicker:()=>(0,Wy.jsxs)(VS,{localeText:b,children:[(0,Wy.jsx)(V,(0,_n.Z)({},G,{slots:H,slotProps:$,unstableFieldRef:q})),(0,Wy.jsx)(OP,(0,_n.Z)({role:"dialog",placement:"bottom-start",anchorEl:M.current},I,{open:A,slots:o,slotProps:$,shouldRestoreFocus:D,reduceAnimations:w,children:(0,Wy.jsx)(Z,(0,_n.Z)({},R,$?.layout,{slots:o,slotProps:$,children:L()}))}))]})}})({props:m,valueManager:L_,valueType:"date-time",getOpenDialogAriaText:m.localeText?.openDatePickerDialogue??r.openDatePickerDialogue,validator:hM,rendererInterceptor:qL});return g()}));function YL(e){return(0,lv.ZP)("MuiDialogContent",e)}function KL(e){return(0,lv.ZP)("MuiDialogTitle",e)}XL.propTypes={ampm:Nv().bool,ampmInClock:Nv().bool,autoFocus:Nv().bool,className:Nv().string,closeOnSelect:Nv().bool,dayOfWeekFormatter:Nv().func,defaultValue:Nv().object,disabled:Nv().bool,disableFuture:Nv().bool,disableHighlightToday:Nv().bool,disableIgnoringDatePartForTimeValidation:Nv().bool,disableOpenPicker:Nv().bool,disablePast:Nv().bool,displayWeekNumber:Nv().bool,enableAccessibleFieldDOMStructure:Nv().any,fixedWeekNumber:Nv().number,format:Nv().string,formatDensity:Nv().oneOf(["dense","spacious"]),inputRef:Fv,label:Nv().node,loading:Nv().bool,localeText:Nv().object,maxDate:Nv().object,maxDateTime:Nv().object,maxTime:Nv().object,minDate:Nv().object,minDateTime:Nv().object,minTime:Nv().object,minutesStep:Nv().number,monthsPerRow:Nv().oneOf([3,4]),name:Nv().string,onAccept:Nv().func,onChange:Nv().func,onClose:Nv().func,onError:Nv().func,onMonthChange:Nv().func,onOpen:Nv().func,onSelectedSectionsChange:Nv().func,onViewChange:Nv().func,onYearChange:Nv().func,open:Nv().bool,openTo:Nv().oneOf(["day","hours","meridiem","minutes","month","seconds","year"]),orientation:Nv().oneOf(["landscape","portrait"]),readOnly:Nv().bool,reduceAnimations:Nv().bool,referenceDate:Nv().object,renderLoading:Nv().func,selectedSections:Nv().oneOfType([Nv().oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Nv().number]),shouldDisableDate:Nv().func,shouldDisableMonth:Nv().func,shouldDisableTime:Nv().func,shouldDisableYear:Nv().func,showDaysOutsideCurrentMonth:Nv().bool,skipDisabled:Nv().bool,slotProps:Nv().object,slots:Nv().object,sx:Nv().oneOfType([Nv().arrayOf(Nv().oneOfType([Nv().func,Nv().object,Nv().bool])),Nv().func,Nv().object]),thresholdToRenderTimeInASingleColumn:Nv().number,timeSteps:Nv().shape({hours:Nv().number,minutes:Nv().number,seconds:Nv().number}),timezone:Nv().string,value:Nv().object,view:Nv().oneOf(["day","hours","meridiem","minutes","month","seconds","year"]),viewRenderers:Nv().shape({day:Nv().func,hours:Nv().func,meridiem:Nv().func,minutes:Nv().func,month:Nv().func,seconds:Nv().func,year:Nv().func}),views:Nv().arrayOf(Nv().oneOf(["day","hours","minutes","month","seconds","year"]).isRequired),yearsPerRow:Nv().oneOf([3,4])},(0,$y.Z)("MuiDialogContent",["root","dividers"]);const JL=(0,$y.Z)("MuiDialogTitle",["root"]),QL=["className","dividers"],eD=(0,Iy.ZP)("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dividers&&t.dividers]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},n.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${JL.root} + &`]:{paddingTop:0}})})),tD=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiDialogContent"}),{className:r,dividers:i=!1}=n,o=(0,My.Z)(n,QL),s=(0,_n.Z)({},n,{dividers:i}),a=(e=>{const{classes:t,dividers:n}=e,r={root:["root",n&&"dividers"]};return(0,Cy.Z)(r,YL,t)})(s);return(0,Wy.jsx)(eD,(0,_n.Z)({className:(0,Ey.Z)(a.root,r),ownerState:s,ref:t},o))})),nD=tD;function rD(e){return(0,lv.ZP)("MuiDialog",e)}const iD=(0,$y.Z)("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),oD=e.createContext({}),sD=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],aD=(0,Iy.ZP)(bw,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),lD=(0,Iy.ZP)(Cw,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),cD=(0,Iy.ZP)("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.container,t[`scroll${(0,mv.Z)(n.scroll)}`]]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===t.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===t.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})})),uD=(0,Iy.ZP)(Dw,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t[`scrollPaper${(0,mv.Z)(n.scroll)}`],t[`paperWidth${(0,mv.Z)(String(n.maxWidth))}`],n.fullWidth&&t.paperFullWidth,n.fullScreen&&t.paperFullScreen]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===n.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===n.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!n.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===n.maxWidth&&{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${iD.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},n.maxWidth&&"xs"!==n.maxWidth&&{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`,[`&.${iD.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[n.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},n.fullWidth&&{width:"calc(100% - 64px)"},n.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${iD.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})})),hD=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiDialog"}),i=Zb(),o={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{"aria-describedby":s,"aria-labelledby":a,BackdropComponent:l,BackdropProps:c,children:u,className:h,disableEscapeKeyDown:d=!1,fullScreen:p=!1,fullWidth:f=!1,maxWidth:m="sm",onBackdropClick:g,onClick:y,onClose:v,open:_,PaperComponent:x=Dw,PaperProps:b={},scroll:w="paper",TransitionComponent:S=gw,transitionDuration:M=o,TransitionProps:E}=r,T=(0,My.Z)(r,sD),C=(0,_n.Z)({},r,{disableEscapeKeyDown:d,fullScreen:p,fullWidth:f,maxWidth:m,scroll:w}),A=(e=>{const{classes:t,scroll:n,maxWidth:r,fullWidth:i,fullScreen:o}=e,s={root:["root"],container:["container",`scroll${(0,mv.Z)(n)}`],paper:["paper",`paperScroll${(0,mv.Z)(n)}`,`paperWidth${(0,mv.Z)(String(r))}`,i&&"paperFullWidth",o&&"paperFullScreen"]};return(0,Cy.Z)(s,rD,t)})(C),I=e.useRef(),P=(0,O_.Z)(a),R=e.useMemo((()=>({titleId:P})),[P]);return(0,Wy.jsx)(lD,(0,_n.Z)({className:(0,Ey.Z)(A.root,h),closeAfterTransition:!0,components:{Backdrop:aD},componentsProps:{backdrop:(0,_n.Z)({transitionDuration:M,as:l},c)},disableEscapeKeyDown:d,onClose:v,open:_,ref:n,onClick:e=>{y&&y(e),I.current&&(I.current=null,g&&g(e),v&&v(e,"backdropClick"))},ownerState:C},T,{children:(0,Wy.jsx)(S,(0,_n.Z)({appear:!0,in:_,timeout:M,role:"presentation"},E,{children:(0,Wy.jsx)(cD,{className:(0,Ey.Z)(A.container),onMouseDown:e=>{I.current=e.target===e.currentTarget},ownerState:C,children:(0,Wy.jsx)(uD,(0,_n.Z)({as:x,elevation:24,role:"dialog","aria-describedby":s,"aria-labelledby":P},b,{className:(0,Ey.Z)(A.paper,b.className),ownerState:C,children:(0,Wy.jsx)(oD.Provider,{value:R,children:u})}))})}))}))})),dD=hD,pD=(0,Iy.ZP)(dD)({[`& .${iD.container}`]:{outline:0},[`& .${iD.paper}`]:{outline:0,minWidth:sC}}),fD=(0,Iy.ZP)(nD)({"&:first-of-type":{padding:0}});function mD(e){const{children:t,onDismiss:n,open:r,slots:i,slotProps:o}=e,s=i?.dialog??pD,a=i?.mobileTransition??gw;return(0,Wy.jsx)(s,(0,_n.Z)({open:r,onClose:n},o?.dialog,{TransitionComponent:a,TransitionProps:o?.mobileTransition,PaperComponent:i?.mobilePaper,PaperProps:o?.mobilePaper,children:(0,Wy.jsx)(fD,{children:t})}))}const gD=["props","getOpenDialogAriaText"],yD=e.forwardRef((function(t,n){const r=XS(),i=$S(),o=vC(t,"MuiMobileDateTimePicker"),s=(0,_n.Z)({day:eI,month:eI,year:eI,hours:GL,minutes:GL,seconds:GL},o.viewRenderers),a=o.ampmInClock??!1,l=(0,_n.Z)({},o,{viewRenderers:s,format:AR(i,o),ampmInClock:a,slots:(0,_n.Z)({field:iT},o.slots),slotProps:(0,_n.Z)({},o.slotProps,{field:e=>(0,_n.Z)({},kv(o.slotProps?.field,e),gM(o),{ref:n}),toolbar:(0,_n.Z)({hidden:!1,ampmInClock:a},o.slotProps?.toolbar),tabs:(0,_n.Z)({hidden:!1},o.slotProps?.tabs)})}),{renderPicker:c}=(t=>{let{props:n,getOpenDialogAriaText:r}=t,i=(0,My.Z)(t,gD);const{slots:o,slotProps:s,className:a,sx:l,format:c,formatDensity:u,enableAccessibleFieldDOMStructure:h,selectedSections:d,onSelectedSectionsChange:p,timezone:f,name:m,label:g,inputRef:y,readOnly:v,disabled:_,localeText:x}=n,b=$S(),w=e.useRef(null),S=(0,O_.Z)(),M=s?.toolbar?.hidden??!1,{open:E,actions:T,layoutProps:C,renderCurrentView:A,fieldProps:I}=FP((0,_n.Z)({},i,{props:n,fieldRef:w,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"mobile"})),P=o.field,R=gb({elementType:P,externalSlotProps:s?.field,additionalProps:(0,_n.Z)({},I,M&&{id:S},!(_||v)&&{onClick:T.onOpen,onKeyDown:(L=T.onOpen,e=>{"Enter"!==e.key&&" "!==e.key||(L(e),e.preventDefault(),e.stopPropagation())})},{readOnly:v??!0,disabled:_,className:a,sx:l,format:c,formatDensity:u,enableAccessibleFieldDOMStructure:h,selectedSections:d,onSelectedSectionsChange:p,timezone:f,label:g,name:m},y?{inputRef:y}:{}),ownerState:n});var L;R.inputProps=(0,_n.Z)({},R.inputProps,{"aria-label":r(I.value,b)});const D=(0,_n.Z)({textField:o.textField},R.slots),O=o.layout??SR;let N=S;M&&(N=g?`${S}-label`:void 0);const k=(0,_n.Z)({},s,{toolbar:(0,_n.Z)({},s?.toolbar,{titleId:S}),mobilePaper:(0,_n.Z)({"aria-labelledby":N},s?.mobilePaper)}),F=(0,F_.Z)(w,R.unstableFieldRef);return{renderPicker:()=>(0,Wy.jsxs)(VS,{localeText:x,children:[(0,Wy.jsx)(P,(0,_n.Z)({},R,{slots:D,slotProps:k,unstableFieldRef:F})),(0,Wy.jsx)(mD,(0,_n.Z)({},T,{open:E,slots:o,slotProps:k,children:(0,Wy.jsx)(O,(0,_n.Z)({},C,k?.layout,{slots:o,slotProps:k,children:A()}))}))]})}})({props:l,valueManager:L_,valueType:"date-time",getOpenDialogAriaText:l.localeText?.openDatePickerDialogue??r.openDatePickerDialogue,validator:hM});return c()}));yD.propTypes={ampm:Nv().bool,ampmInClock:Nv().bool,autoFocus:Nv().bool,className:Nv().string,closeOnSelect:Nv().bool,dayOfWeekFormatter:Nv().func,defaultValue:Nv().object,disabled:Nv().bool,disableFuture:Nv().bool,disableHighlightToday:Nv().bool,disableIgnoringDatePartForTimeValidation:Nv().bool,disableOpenPicker:Nv().bool,disablePast:Nv().bool,displayWeekNumber:Nv().bool,enableAccessibleFieldDOMStructure:Nv().any,fixedWeekNumber:Nv().number,format:Nv().string,formatDensity:Nv().oneOf(["dense","spacious"]),inputRef:Fv,label:Nv().node,loading:Nv().bool,localeText:Nv().object,maxDate:Nv().object,maxDateTime:Nv().object,maxTime:Nv().object,minDate:Nv().object,minDateTime:Nv().object,minTime:Nv().object,minutesStep:Nv().number,monthsPerRow:Nv().oneOf([3,4]),name:Nv().string,onAccept:Nv().func,onChange:Nv().func,onClose:Nv().func,onError:Nv().func,onMonthChange:Nv().func,onOpen:Nv().func,onSelectedSectionsChange:Nv().func,onViewChange:Nv().func,onYearChange:Nv().func,open:Nv().bool,openTo:Nv().oneOf(["day","hours","minutes","month","seconds","year"]),orientation:Nv().oneOf(["landscape","portrait"]),readOnly:Nv().bool,reduceAnimations:Nv().bool,referenceDate:Nv().object,renderLoading:Nv().func,selectedSections:Nv().oneOfType([Nv().oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Nv().number]),shouldDisableDate:Nv().func,shouldDisableMonth:Nv().func,shouldDisableTime:Nv().func,shouldDisableYear:Nv().func,showDaysOutsideCurrentMonth:Nv().bool,slotProps:Nv().object,slots:Nv().object,sx:Nv().oneOfType([Nv().arrayOf(Nv().oneOfType([Nv().func,Nv().object,Nv().bool])),Nv().func,Nv().object]),timezone:Nv().string,value:Nv().object,view:Nv().oneOf(["day","hours","minutes","month","seconds","year"]),viewRenderers:Nv().shape({day:Nv().func,hours:Nv().func,minutes:Nv().func,month:Nv().func,seconds:Nv().func,year:Nv().func}),views:Nv().arrayOf(Nv().oneOf(["day","hours","minutes","month","seconds","year"]).isRequired),yearsPerRow:Nv().oneOf([3,4])};const vD=["desktopModeMediaQuery"],_D=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiDateTimePicker"}),{desktopModeMediaQuery:r=sM}=n,i=(0,My.Z)(n,vD);return Dv(r,{defaultMatches:!0})?(0,Wy.jsx)(XL,(0,_n.Z)({ref:t},i)):(0,Wy.jsx)(yD,(0,_n.Z)({ref:t},i))})),xD=["className","id"],bD=(0,Iy.ZP)(LM,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),wD=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiDialogTitle"}),{className:i,id:o}=r,s=(0,My.Z)(r,xD),a=r,l=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},KL,t)})(a),{titleId:c=o}=e.useContext(oD);return(0,Wy.jsx)(bD,(0,_n.Z)({component:"h2",className:(0,Ey.Z)(l.root,i),ownerState:a,ref:n,variant:"h6",id:null!=o?o:c},s))})),SD=wD,MD="YYYY-MM-DD[T]HH:mm:ss",ED="RWY.CLS",TD="TWY.CLS",CD={folderName:"AIXMData",key:"widget-aixm-data",name:"AIXM data"},AD={reason:"",startTime:null,endTime:null,note:""};function ID(t){const n=BD(),{name:r,identifier:i,onClose:o}=t,[s,a]=(0,e.useState)(AD);return(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsxs)(SD,{children:[ED," - ",r]}),(0,Wy.jsx)(nD,{children:(0,Wy.jsxs)("div",{className:"grid-cols-2 grid-gap-4 px-3",children:[(0,Wy.jsx)(BS,{className:"mt-2",id:`${CD.key}-notam-rwy-cls-reason-textfield`,label:"Closure Reason",onChange:e=>a((t=>({...t,reason:e.target.value}))),required:!0,sx:{gridColumn:"1 / 3"},value:s.reason}),(0,Wy.jsx)(_D,{ampm:!1,className:"mt-2",slotProps:{actionBar:{actions:["accept","clear"]}},format:MD,label:"Start Time (UTC)",maxDateTime:s.endTime,minDateTime:Ye()(),onChange:e=>a((t=>({...t,startTime:e}))),timezone:"UTC",value:s.startTime}),(0,Wy.jsx)(_D,{ampm:!1,className:"mt-2",slotProps:{actionBar:{actions:["accept","clear"]}},format:MD,label:"End Time (UTC)",minDateTime:s.startTime||Ye()(),onChange:e=>a((t=>({...t,endTime:e}))),timezone:"UTC",value:s.endTime}),(0,Wy.jsx)(BS,{className:"mt-2",id:`${CD.key}-notam-rwy-cls-note-textfield`,label:"Note",multiline:!0,onChange:e=>a((t=>({...t,note:e.target.value}))),rows:4,sx:{gridColumn:"1 / 3"},value:s.note})]})}),(0,Wy.jsxs)(HP,{children:[(0,Wy.jsx)(Tv,{onClick:o,children:"Cancel"}),(0,Wy.jsx)(Tv,{disabled:s.reason.length<2||!s.startTime||!s.endTime||(null===(l=s.startTime)||void 0===l||null===(c=l.isAfter)||void 0===c?void 0:c.call(l,null==s?void 0:s.endTime)),onClick:function(){n.authRequest.post("/poc/api/v0/notam/rwyCls/create",{RunwayAixmId:i,ClosureReason:s.reason,StartTimeUtc:s.startTime.format(`${MD}[Z]`),EndTimeUtc:s.endTime.format(`${MD}[Z]`),Note:s.note},"http://localhost:5160").then((()=>{hy("Notam successfully created.",{variant:"success"}),null==o||o()})).catch((e=>{hy("Failed to create notam. See console for further details.",{variant:"error"}),console.log(e)}))},children:"Publish"})]})]});var l,c}const PD={AERIAL_REFUELLING:"AerialRefuelling",AERONAUTICAL_GROUND_LIGHT:"AeronauticalGroundLight",AIRCRAFT_GROUND_SERVICE:"AircraftGroundService",AIRCRAFT_STAND:"AircraftStand",AIRPORT_HELIPORT:"AirportHeliport",AIRPORT_HOT_SPOT:"AirportHotSpot",AIRPORT_PROTECTION_AREA_MARKING:"AirportProtectionAreaMarking",AIRSPACE:"Airspace",ALTIMETER_SOURCE:"AltimeterSource",ANGLE_INDICATION:"AngleIndication",APPROACH_LIGHTING_SYSTEM:"ApproachLightingSystem",APRON:"Apron",APRON_ELEMENT:"ApronElement",APRON_MARKING:"ApronMarking",APRON_LIGHT_SYSTEM:"ApronLightSystem",ARRESTING_GEAR:"ArrestingGear",ARRIVAL_FEEDER_LEG:"ArrivalFeederLeg",ARRIVAL_LEG:"ArrivalLeg",AUTHORITY_FOR_AIRSPACE:"AuthorityForAirspace",AZIMUTH:"Azimuth",DEICING_AREA:"DeicingArea",DEICING_AREA_MARKING:"DeicingAreaMarking",DEPARTURE_LEG:"DepartureLeg",DESIGNATED_POINT:"DesignatedPoint",DIRECTION_FINDER:"DirectionFinder",DISTANCE_INDICATION:"DistanceIndication",DME:"DME",ELEVATION:"Elevation",EVENT:"Event",FINAL_LEG:"FinalLeg",GLIDEPATH:"Glidepath",GROUND_TRAFFIC_CONTROL_SERVICE:"GroundTrafficControlService",GUIDANCE_LINE:"GuidanceLine",GUIDANCE_LINE_LIGHT_SYSTEM:"GuidanceLineLightSystem",GUIDANCE_LINE_MARKING:"GuidanceLineMarking",HOLDING_PATTERN:"HoldingPattern",INITIAL_LEG:"InitialLeg",INSTRUMENT_APPROACH_PROCEDURE:"InstrumentApproachProcedure",INTERMEDIATE_LEG:"IntermediateLeg",LOCALIZER:"Localizer",MARKER_BEACON:"MarkerBeacon",MISSED_APPROACH_LEG:"MissedApproachLeg",NAVAID:"Navaid",NAVAID_EQUIPMENT:"NavaidEquipment",NDB:"NDB",NON_MOVEMENT_AREA:"NonMovementArea",OBSTACLE_AREA:"ObstacleArea",ORGANISATION_AUTHORITY:"OrganisationAuthority",PASSENGER_LOADING_BRIDGE:"PassengerLoadingBridge",RADAR_SYSTEM:"RadarSystem",RADIO_COMMUNICATION_CHANNEL:"RadioCommunicationChannel",RADIO_FREQUENCY_AREA:"RadioFrequencyArea",ROAD:"Road",ROUTE:"Route",ROUTE_SEGMENT:"RouteSegment",RUNWAY:"Runway",RUNWAY_BLAST_PAD:"RunwayBlastPad",RUNWAY_CENTRELINE_POINT:"RunwayCentrelinePoint",RUNWAY_DIRECTION:"RunwayDirection",RUNWAY_DIRECTION_LIGHT_SYSTEM:"RunwayDirectionLightSystem",RUNWAY_ELEMENT:"RunwayElement",RUNWAY_MARKING:"RunwayMarking",RUNWAY_PROTECT_AREA:"RunwayProtectArea",RUNWAY_PROTECT_AREA_LIGHT_SYSTEM:"RunwayProtectAreaLightSystem",RUNWAY_VISUAL_RANGE:"RunwayVisualRange",SAFE_ALTITUDE_AREA:"SafeAltitudeArea",SAFE_ALTITUDE_AREA_SECTOR:"SafeAltitudeAreaSector",SDF:"SDF",SEAPLANE_LANDING_AREA:"SeaplaneLandingArea",SEGMENT_LEG:"SegmentLeg",SPECIAL_NAVIGATION_SYSTEM:"SpecialNavigationSystem",STAND_MARKING:"StandMarking",STANDARD_INSTRUMENT_ARRIVAL:"StandardInstrumentArrival",STANDARD_INSTRUMENT_DEPARTURE:"StandardInstrumentDeparture",TACAN:"TACAN",TAXI_HOLDING_POSITION:"TaxiHoldingPosition",TAXI_HOLDING_POSITION_LIGHT_SYSTEM:"TaxiHoldingPositionLightSystem",TAXI_HOLDING_POSITION_MARKING:"TaxiHoldingPositionMarking",TAXIWAY:"Taxiway",TAXIWAY_ELEMENT:"TaxiwayElement",TAXIWAY_LIGHT_SYSTEM:"TaxiwayLightSystem",TAXIWAY_MARKING:"TaxiwayMarking",TOUCH_DOWN_LIFT_OFF:"TouchDownLiftOff",TOUCH_DOWN_LIFT_OFF_LIGHT_SYSTEM:"TouchDownLiftOffLightSystem",TOUCH_DOWN_LIFT_OFF_MARKING:"TouchDownLiftOffMarking",UNIT:"Unit",VERTICAL_STRUCTURE:"VerticalStructure",VISUAL_GLIDE_SLOPE_INDICATOR:"VisualGlideSlopeIndicator",VOR:"VOR",WORK_AREA:"WorkArea"},RD=`${CD.key}-SOURCE-HIGHLIGHT`,LD={reason:"",startTime:null,endTime:null,note:"",portions:[]},DD="TWY_CLS_PORTIONS_SOURCE",OD="TWY_CLS_PORTIONS_LAYER";function ND(t){const n=BD(),{name:r,identifier:i,onClose:o,onHide:s,visible:a}=t,l=(0,e.useRef)([]),[c,u]=(0,e.useState)(LD),[h,d]=(0,e.useState)(!1);return(0,e.useEffect)((()=>(l.current=Array.from(n.mapController.layer.getAll().values()).filter((e=>e.source===RD)).map((e=>e.id)),n.mapController.source.set(DD,sr(c.portions)),n.mapController.layer.set(OD,{id:OD,index:1e12,paint:{"fill-color":"green","fill-opacity":.25},source:DD,type:"fill"}),()=>{n.mapController.off("click",m),n.mapController.layer.remove(OD),n.mapController.source.remove(DD)})),[]),(0,e.useEffect)((()=>n.mapController.source.set(DD,sr(c.portions))),[c.portions]),(0,e.useEffect)((()=>{a?n.mapController.off("click",m):n.mapController.on("click",m,{priority:10,stopPropagation:!0})}),[a]),(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsxs)(SD,{children:[TD," - ",r]}),(0,Wy.jsx)(nD,{children:(0,Wy.jsxs)("div",{className:"grid-cols-2 grid-gap-4 px-3",children:[(0,Wy.jsx)(BS,{className:"mt-2",id:`${CD.key}-notam-rwy-cls-reason-textfield`,label:"Closure Reason",onChange:e=>u((t=>({...t,reason:e.target.value}))),required:!0,sx:{gridColumn:"1 / 3"},value:c.reason}),(0,Wy.jsx)(_D,{ampm:!1,className:"mt-2",slotProps:{actionBar:{actions:["accept","clear"]}},format:MD,label:"Start Time (UTC)",maxDateTime:c.endTime,minDateTime:Ye()(),onChange:e=>u((t=>({...t,startTime:e}))),timezone:"UTC",value:c.startTime}),(0,Wy.jsx)(_D,{ampm:!1,className:"mt-2",slotProps:{actionBar:{actions:["accept","clear"]}},format:MD,label:"End Time (UTC)",minDateTime:c.startTime||Ye()(),onChange:e=>u((t=>({...t,endTime:e}))),timezone:"UTC",value:c.endTime}),(0,Wy.jsx)(BS,{className:"mt-2",id:`${CD.key}-notam-rwy-cls-note-textfield`,label:"Note",multiline:!0,onChange:e=>u((t=>({...t,note:e.target.value}))),rows:4,sx:{gridColumn:"1 / 3"},value:c.note}),(0,Wy.jsx)(Tv,{onClick:s,children:"Select from Map"}),(0,Wy.jsx)(Mb,{sx:{gridColumn:"1 / 3"},children:c.portions.map((e=>(0,Wy.jsxs)(aR,{children:[e.properties.label," (",e.properties.identifier,")"]},e.properties.identifier)))})]})}),(0,Wy.jsxs)(HP,{children:[(0,Wy.jsx)(Tv,{onClick:o,children:"Cancel"}),(0,Wy.jsx)(Tv,{disabled:c.reason.length<2||!c.startTime||!c.endTime||(null===(p=c.startTime)||void 0===p||null===(f=p.isAfter)||void 0===f?void 0:f.call(p,null==c?void 0:c.endTime)),onClick:function(){n.authRequest.post("/poc/api/v0/notam/twyCls/create",{closedTaxiwaysSpecification:[{taxiwayAixmId:i,closedPortions:[{closedTaxiwayElementsAixmIds:c.portions.map((e=>e.properties.identifier))}]}],closureReason:c.reason,startTimeUtc:c.startTime,endTimeUtc:c.endTime,note:c.note}).then((()=>{hy("Notam successfully created.",{variant:"success"}),null==o||o()})).catch((e=>{hy("Failed to create notam. See console for further details.",{variant:"error"}),console.log(e)}))},children:"Publish"})]})]});var p,f;function m(e){const[t]=n.mapController.getMapboxFeatures(e.point,{layers:l.current});t&&u((e=>{const n=e.portions.some((e=>e.properties.identifier===t.properties.identifier));return{...e,portions:n?e.portions.filter((e=>e.properties.identifier!==t.properties.identifier)):[...e.portions,t]}}))}}const kD={"e19021ab-c0e0-481f-a554-d9efaed3ef96":ED,"3b6c378e-daad-4d31-a5b5-5b249badf503":TD},FD=(0,e.createContext)(null);function zD(e){let{children:t,msalInstance:n}=e;const r=new Wn(n),i=new er(r),o=new Zm,s=new class{constructor(){this.createForm=(e,t)=>{switch(kD[e]){case ED:return(0,Wy.jsx)(ID,{...t});case TD:return(0,Wy.jsx)(ND,{...t});default:return null}}}},a=new class{constructor(e){Object.defineProperty(this,jn,{writable:!0,value:void 0}),Object.defineProperty(this,Vn,{writable:!0,value:void 0}),Object.defineProperty(this,Gn,{writable:!0,value:new Map}),Object.defineProperty(this,Hn,{writable:!0,value:null}),Object.defineProperty(this,Zn,{writable:!0,value:(e,t)=>{kn(this,Gn)[Gn].has(e)&&Array.from(kn(this,Gn)[Gn].get(e).values()).forEach((e=>null==e?void 0:e(t)))}}),this.initialize=e=>{kn(this,Vn)[Vn]=e,kn(this,Zn)[Zn](Un.init,kn(this,Vn)[Vn])},this.getConfig=()=>kn(this,Vn)[Vn],this.selectAndFitToFeature=e=>{kn(this,Hn)[Hn]=e,kn(this,Zn)[Zn](Un["feature-select"],kn(this,Hn)[Hn])},this.selectAndFitToNotam=e=>{kn(this,Hn)[Hn]=e,kn(this,Zn)[Zn](Un["feature-select"],kn(this,Hn)[Hn])},this.on=(e,t)=>{qe().has(Un,e)&&(kn(this,Gn)[Gn].has(e)||kn(this,Gn)[Gn].set(e,new Map),kn(this,Gn)[Gn].get(e).set(Bn(t),t))},this.once=(e,t)=>{qe().has(Un,e)&&(kn(this,Gn)[Gn].has(e)||kn(this,Gn)[Gn].set(e,new Map),kn(this,Gn)[Gn].get(e).set(Bn(t),(()=>{t(),this.off(e,t)})))},this.off=(e,t)=>{qe().has(Un,e)&&kn(this,Gn)[Gn].has(e)&&kn(this,Gn)[Gn].get(e).delete(Bn(t))},kn(this,jn)[jn]=e}}({authController:r,authRequest:i,mapController:o,notamController:s});return window.NGAviationMapViewer=a,(0,Wy.jsx)(FD.Provider,{value:{apiController:a,authController:r,authRequest:i,mapController:o,notamController:s},children:t})}function BD(){const t=(0,e.useContext)(FD);if(null===t)throw new Error("Missing provider for System");return t}function UD(e){var t;return null==e||null===(t=e.config)||void 0===t?void 0:t.config}function jD(e){var t;return null==e||null===(t=e.config)||void 0===t?void 0:t.cross}function VD(e){var t;return null==e||null===(t=e.config)||void 0===t?void 0:t.darkTheme}function GD(e){var t;return null==e||null===(t=e.map)||void 0===t?void 0:t.globe}function HD(e){var t;return null==e||null===(t=e.map)||void 0===t?void 0:t.style}const ZD=function(e){return{color:`rgb(${e>>16&255},${e>>8&255},${255&e})`,opacity:(e>>24&255)/255}};function WD(e){var t;return null==e||null===(t=e.widget)||void 0===t?void 0:t.ready}const $D={id:"AIXM_DATA_TAB",label:"Feature list"},qD={id:"AIXM_SETTINGS_TAB",label:"Settings"},XD={id:"AIXM_FILTERS_TAB",label:"Filters"},YD={datasets:{},enabled3D:!0,filter:{aixmFeaturesBlacklist:[],airspaceTypeBlacklist:[],aixmFeaturesLabelsBlacklist:[],vertical:{from:{reference:"",unit:"",value:""},to:{reference:"",unit:"",value:""},otherReferences:!0}},layers:[],repositories:[],highlightedFeatures:[],selectedAIXMFeature:null,selectedRepository:null,updatedFeatures:[],lastFeaturesUpdate:null,tab:$D.id};function KD(e){return function(t){e.aixmFeaturesBlacklist.includes(PD.AIRSPACE)&&(e.airspaceTypeBlacklist=[]),t(tt(CD.key,{filter:e}))}}function JD(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.datasets}function QD(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.enabled3D}function eO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.filter}function tO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.highlightedFeatures}function nO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.lastFeaturesUpdate}function rO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.selectedAIXMFeature}function iO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.selectedRepository}function oO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.tab}function sO(e){var t,n,r;return null==e||null===(t=e.widget)||void 0===t||null===(n=t.widgetData)||void 0===n||null===(r=n[CD.key])||void 0===r?void 0:r.updatedFeatures}const aO=function(e,t){var n,r,i;const o=null==t||null===(n=t.geomType)||void 0===n?void 0:n[e.geomType],s=null==t||null===(r=t.geomIcon)||void 0===r?void 0:r[e.icon],a=e.order,l=Math.min(23,e.toZoomLevel),c=e.fromZoomLevel,u=e.dimensions;return{geoType:o,icon:s,index:a,maxzoom:l,minzoom:c,dimensions:u,units:null==t||null===(i=t.geomPenUnit)||void 0===i?void 0:i[u.unit],radius:u.radius}},lO=["get","airspaceClass"],cO=["get","airspaceType"],uO=["get","availability"],hO=["get","height"],dO=["get","verticalStructureGroup"],pO=["get","verticalStructureLighted"],fO="circle",mO="fill",gO="fill-extrusion",yO="label",vO="line",_O="symbol";function xO(e,t,n,r){return n.filter((e=>!qe().isEmpty(qe().intersection(t,e.types)))).map((e=>({...e,types:e.types.filter((e=>t.includes(e)))}))).map(((t,n)=>function(e,t,n,r){const{decorationArgb:i,decorationType:o,types:s=[]}=t,{geoType:a,index:l,maxzoom:c,minzoom:u}=n,{color:h,opacity:d}=ZD(i);return{id:`${CD.key}#${e}#${a}#${o}-${_O}#type-${r}`,source:`${CD.key}-${e}`,type:_O,maxzoom:c,minzoom:u,layout:{"icon-allow-overlap":!0,"icon-anchor":"top-right","icon-ignore-placement":!0,"icon-image":o.toLowerCase(),"icon-size":["interpolate",["linear"],["zoom"],2,.25,4,.5],"symbol-placement":"line","symbol-spacing":1},paint:{"icon-color":h,"icon-opacity":d},filter:["in",cO[1],...s],index:l+r,only2D:!0}}(e,t,r,n)))}function bO(e,t,n,r,i){return r.filter((e=>!qe().isEmpty(qe().intersection(n,e.classes)))).map((e=>({...e,classes:e.classes.filter((e=>n.includes(e)))}))).map(((n,r)=>function(e,t,n,r,i){const{decorationArgb:o,decorationType:s,classes:a=[]}=n,{geoType:l,index:c,maxzoom:u,minzoom:h}=r,{color:d,opacity:p}=ZD(o);return"Color"===s?{id:`${CD.key}#${e}#${l}#${s}-${vO}#class-${i}`,source:`${CD.key}-${e}`,type:vO,maxzoom:u,minzoom:h,paint:{"line-color":d,"line-offset":["interpolate",["linear"],["zoom"],0,0,2,2,4,4],"line-opacity":p,"line-width":["interpolate",["linear"],["zoom"],0,0,2,4,4,8]},filter:["all",["!in",cO[1],...t],["in",lO[1],...a]],index:c+i,only2D:!0}:{id:`${CD.key}#${e}#${l}#${s}-${_O}#class-${i}`,source:`${CD.key}-${e}`,type:_O,maxzoom:u,minzoom:h,layout:{"icon-allow-overlap":!0,"icon-anchor":"top-right","icon-ignore-placement":!0,"icon-image":s.toLowerCase(),"icon-size":["interpolate",["linear"],["zoom"],2,.25,4,.5],"symbol-placement":"line","symbol-spacing":1},paint:{"icon-color":d,"icon-opacity":p},filter:["all",["!in",cO[1],...t],["in",lO[1],...a]],index:c+i,only2D:!0}}(e,t,n,i,r)))}const wO=["A","ADIZ","D","D_OTHER","FIR","FIR_P","MTR","NAS","NAS_P","OCA","OTA","P","PROTECT","R","TRA","TSA","UTA","UTA_P","W"],SO=["A","B","C","D","E","G"],MO=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{geoType:i,minzoom:o,maxzoom:s,index:a}=t;return{id:`${CD.key}#${e}#${i}#${mO}`,source:`${CD.key}-${e}`,type:mO,maxzoom:s,minzoom:o,paint:{"fill-color":n.color||r.color,"fill-opacity":n.opacity||r.opacity},filter:["in","$type","Polygon"],index:a}},EO=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{geoType:i,index:o,maxzoom:s,minzoom:a}=t;return{id:`${CD.key}#${e}#${i}#${vO}${r>0?`-${r}`:""}`,source:`${CD.key}-${e}`,type:vO,maxzoom:s,minzoom:a,layout:{"line-join":"round","line-cap":"round"},paint:qe().omitBy({"line-color":n.color,"line-opacity":n.opacity,"line-width":n.width,"line-dasharray":n.dasharray},qe().isNil),filter:["in","$type","LineString","Polygon"],index:o+.01*r}},TO="#000000",CO="#FFFFFF",AO="#FFFF00",IO={"text-anchor":"center","text-field":["get","label"],"text-size":12,"text-transform":"uppercase"},PO={"text-color":"#D3D3D3","text-halo-color":TO,"text-halo-width":3},RO={"text-justify":"auto","text-radial-offset":.75,"text-variable-anchor":["bottom","left","top","right"]};function LO(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?["interpolate",["exponential",2],["zoom"],10,[t,["*",e,["^",2,-6]]],24,[t,["*",e,["^",2,8]]]]:["interpolate",["exponential",2],["zoom"],10,["*",e,["^",2,-6]],24,["*",e,["^",2,8]]]}const DO=function(e,t){return"Pixels"===e?t:LO(t)},OO=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{geoType:i,index:o,maxzoom:s,minzoom:a,radius:l,units:c}=t;return{id:`${CD.key}#${e}#${i}#${fO}`,source:`${CD.key}-${e}`,type:fO,maxzoom:s,minzoom:a,paint:qe().omitBy({"circle-color":null==n?void 0:n.color,"circle-opacity":null==n?void 0:n.opacity,"circle-radius":DO(c,l),"circle-stroke-color":r.color,"circle-stroke-opacity":r.opacity,"circle-stroke-width":r.width},qe().isNil),filter:["in","$type","Point"],index:o}},NO="Choice",kO="Curve",FO="Point",zO="Surface",BO=[PD.AIRPORT_HELIPORT,PD.AIRCRAFT_STAND,PD.TOUCH_DOWN_LIFT_OFF,PD.TAXI_HOLDING_POSITION,PD.RUNWAY_CENTRELINE_POINT,PD.DESIGNATED_POINT,PD.NAVAID],UO=function(e,t,n,r){const i=qe().first(r);switch(t.geoType){case FO:let o=[];return t.icon&&"None"!==t.icon?o.push(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{geoType:i,icon:o,index:s,maxzoom:a,minzoom:l}=t;return{id:`${CD.key}#${e}#${i}#${_O}`,source:`${CD.key}-${e}`,type:_O,maxzoom:a,minzoom:l,layout:{"icon-allow-overlap":!0,"icon-image":o,"icon-ignore-placement":!0,"icon-pitch-alignment":"viewport","icon-rotation-alignment":"viewport","icon-size":.14},paint:{"icon-color":r.color||n.color},filter:["in","$type","Point"],index:s}}(e,t,n,i)):o.push(OO(e,t,n,i)),BO.includes(e)&&o.push(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{geoType:i}=t,{layout:o,maxzoom:s,minzoom:a,paint:l}=function(e,t,n){switch(e){case PD.AIRPORT_HELIPORT:return{maxzoom:23,minzoom:7,layout:{...IO,...RO},paint:{"text-color":TO,"text-halo-color":CO,"text-halo-width":1}};case PD.DESIGNATED_POINT:const e=t.color||n.color;return{maxzoom:23,minzoom:12,layout:{...IO,...RO},paint:{"text-color":Array.isArray(e)?qe().last(e):e}};case PD.NAVAID:return{maxzoom:23,minzoom:10,layout:{...IO,...RO},paint:{"text-color":TO,"text-halo-color":CO,"text-halo-width":1}};case PD.TAXI_HOLDING_POSITION:return{maxzoom:23,minzoom:15,layout:IO,paint:{...PO,"text-color":"#EC741D"}};default:return{maxzoom:23,minzoom:15,layout:IO,paint:PO}}}(e,n,r);return{id:`${CD.key}#${e}#${i}#${yO}`,source:`${CD.key}-${e}`,type:_O,maxzoom:s,minzoom:a,layout:o,paint:l,filter:["in","$type","Point"],index:Tm}}(e,t,n,i)),o;case kO:return r.map(((n,r)=>EO(e,t,n,r)));case zO:return[qe().isEmpty(n)?[]:MO(e,t,n,i),...r.map(((n,r)=>EO(e,t,n,r)))];case NO:return[qe().isEmpty(n)?[]:MO(e,t,n,i),...r.map(((n,r)=>EO(e,t,n,r))),OO(e,t,n,i)];default:return[]}},jO=["CLOSED","CLSD","UNSERVICEABLE","INTERRUPT","IN_CONSTRUCTION","DISPLACED"],VO=["CLOSED EXCEPT"],GO=["LIMITED","COND","ONTEST","PARTIAL","CONDITIONAL","FALSE_INDICATION","FALSE_POSSIBLE"],HO=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];const[n,r,i]=e.replace(" ","").replace("rgb(","").replace(")","").split(",").map((e=>parseInt(e))),[o,s,a]=t;return`rgb(${n+o},${r+s},${i+a})`};function ZO(e,t){return["match",["get","type"],"SHOULDER",HO(e,t),e]}const WO={availabilityColor:function(e,t){return["case",["in",uO,["literal",jO]],ZD(null==t?void 0:t.Closed).color,["in",uO,["literal",VO]],ZD(null==t?void 0:t.ClosedExcept).color,["in",uO,["literal",GO]],ZD(null==t?void 0:t.Limited).color,e]},color:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FFFFFF";return["match",["get",e],...qe().flatten(Object.entries(t).map((e=>{let[t,n]=e;return[t.toUpperCase(),ZD(n).color]}))),n]},elementTypeColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[12,12,12];if(Array.isArray(e)){const n=e.pop();return[...e,ZO(n,t)]}return ZO(e,t)},verticalStructureIcon:function(){return["case",["all",[">",hO,0],["==",dO,"YES"],["==",pO,"YES"]],"LightedGroupObstacles",["all",[">",hO,0],["==",pO,"YES"]],"LightedObstacle",[">",hO,0],"Obstacle","None"]}},$O=WO,qO=function(e,t,n){if(e){let t=ZD(e);return t.color=$O.availabilityColor(t.color,n),t}return{}},XO=function(e,t,n,r){let i={...ZD(e.argb),width:DO(t.units,e.thickness),dasharray:e.pattern};return i.color=$O.availabilityColor(i.color,r),i},YO=function(e,t,n,r){let{colors:i,enums:o}=r;const s=aO(t,o);return UO(e,s,qO(t.fillArgb,n,i),t.pens.filter((e=>e.argb)).map((e=>XO(e,s,n,i))))},KO=LO(2.5),JO=function(e,t,n,r,i){const{enums:o}=i,s=n[0],a=aO(s,o),{classSettings:l,typeSettings:c}=t;return[...c.map(((t,n)=>function(e,t,n,r){const{lineArgb:i,lineStyle:o,lineThicknessInPixels:s,types:a=[]}=t,{geoType:l,index:c,maxzoom:u,minzoom:h}=n,{color:d,opacity:p}=ZD(i);return{id:`${CD.key}#${e}#${l}#${o}-${vO}#type-${r}`,source:`${CD.key}-${e}`,type:vO,maxzoom:u,minzoom:h,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":d,"line-opacity":p,"line-width":s,"line-dasharray":"Solid"===o?[1]:"Dot"===o?[.1,5]:[3,3]},filter:["in",cO[1],...a],index:c+r,only2D:!0}}(e,t,a,n))),...xO(e,wO,c,a),...bO(e,wO,SO,l,a)]},QO=YO,eN=function(e,t,n,r){let{colors:i,enums:o}=r;const s=aO(t,o),a=qO(t.fillArgb,n,i),l=t.pens.filter((e=>e.argb)).map((e=>XO(e,s,n,i)));return UO(e,s,{...a,color:$O.elementTypeColor(a.color)},l.map((e=>({...e,color:$O.elementTypeColor(e.color)}))))},tN=function(e,t,n,r){let{colors:i,enums:o}=r;const s=aO(t,o),a=qO(t.fillArgb,n,i);return UO(e,s,{...a,color:$O.color("lightColor",i,a.color)},[{color:$O.color("lightColor",i,a.color),opacity:.1,width:KO}])},nN=function(e,t,n,r){let{colors:i,enums:o}=r;const s=aO(t,o),a=qO(t.fillArgb,n,i),l=t.pens.filter((e=>e.argb)).map((e=>XO(e,s,n,i)));return UO(e,s,{...a,color:$O.color("markingColor",i,a.color)},l.map((e=>({...e,color:$O.color("markingColor",i,e.color)}))))},rN=function(e,t,n,r){const{colors:i,enums:o}=r,s=aO(t,o),a=qO(t.fillArgb,n,i),l=qe().first(t.pens.filter((e=>e.argb)).map((e=>XO(e,s,n,i))));if(s.geoType===FO)return[{id:`${CD.key}#${e}#${s.geoType}#symbol`,source:`${CD.key}-${e}`,type:"symbol",maxzoom:s.maxzoom,minzoom:s.minzoom,layout:{"icon-allow-overlap":!0,"icon-image":$O.verticalStructureIcon(),"icon-ignore-placement":!0,"icon-pitch-alignment":"viewport","icon-rotation-alignment":"viewport","icon-size":.16},paint:{"icon-color":(null==l?void 0:l.color)||(null==a?void 0:a.color)},filter:["in","$type","Point"],index:s.index}];const c=YO(e,t,n,r),u=c.find((e=>"fill"===e.type));return u?[...c,(h=u,{...h,id:`${h.id}-${gO}`,type:gO,index:h.index+1,paint:{"fill-extrusion-base":0,"fill-extrusion-color":h.paint["fill-color"],"fill-extrusion-height":hO},only3D:!0})]:c;var h},iN="Airspace",oN="Area",sN="Element",aN="Light",lN="Marking",cN="Other",uN="VerticalStructure";function hN(t){const[n,r]=(0,e.useState)([]);return(0,e.useEffect)((()=>r([])),[t]),[n,function(e){r((t=>-1===t.indexOf(e)?[...t,e]:t.filter((t=>t!==e))))}]}const dN=function(t){const n=(0,e.useRef)();return(0,e.useEffect)((()=>{n.current=t}),[t]),n.current};function pN(e){return Ry.Z}var fN=i(5829);function mN(e){return(0,lv.ZP)("MuiCollapse",e)}(0,$y.Z)("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const gN=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],yN=(0,Iy.ZP)("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],"entered"===n.state&&t.entered,"exited"===n.state&&!n.in&&"0px"===n.collapsedSize&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({height:0,overflow:"hidden",transition:t.transitions.create("height")},"horizontal"===n.orientation&&{height:"auto",width:0,transition:t.transitions.create("width")},"entered"===n.state&&(0,_n.Z)({height:"auto",overflow:"visible"},"horizontal"===n.orientation&&{width:"auto"}),"exited"===n.state&&!n.in&&"0px"===n.collapsedSize&&{visibility:"hidden"})})),vN=(0,Iy.ZP)("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})((e=>{let{ownerState:t}=e;return(0,_n.Z)({display:"flex",width:"100%"},"horizontal"===t.orientation&&{width:"auto",height:"100%"})})),_N=(0,Iy.ZP)("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})((e=>{let{ownerState:t}=e;return(0,_n.Z)({width:"100%"},"horizontal"===t.orientation&&{width:"auto",height:"100%"})})),xN=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiCollapse"}),{addEndListener:i,children:o,className:s,collapsedSize:a="0px",component:l,easing:c,in:u,onEnter:h,onEntered:d,onEntering:p,onExit:f,onExited:m,onExiting:g,orientation:y="vertical",style:v,timeout:_=fN.x9.standard,TransitionComponent:x=Hb}=r,b=(0,My.Z)(r,gN),w=(0,_n.Z)({},r,{orientation:y,collapsedSize:a}),S=(e=>{const{orientation:t,classes:n}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return(0,Cy.Z)(r,mN,n)})(w),M=Zb(),E=(0,Zy.Z)(),T=e.useRef(null),C=e.useRef(),A="number"==typeof a?`${a}px`:a,I="horizontal"===y,P=I?"width":"height",R=e.useRef(null),L=(0,Ly.Z)(n,R),D=e=>t=>{if(e){const n=R.current;void 0===t?e(n):e(n,t)}},O=()=>T.current?T.current[I?"clientWidth":"clientHeight"]:0,N=D(((e,t)=>{T.current&&I&&(T.current.style.position="absolute"),e.style[P]=A,h&&h(e,t)})),k=D(((e,t)=>{const n=O();T.current&&I&&(T.current.style.position="");const{duration:r,easing:i}=$b({style:v,timeout:_,easing:c},{mode:"enter"});if("auto"===_){const t=M.transitions.getAutoHeightDuration(n);e.style.transitionDuration=`${t}ms`,C.current=t}else e.style.transitionDuration="string"==typeof r?r:`${r}ms`;e.style[P]=`${n}px`,e.style.transitionTimingFunction=i,p&&p(e,t)})),F=D(((e,t)=>{e.style[P]="auto",d&&d(e,t)})),z=D((e=>{e.style[P]=`${O()}px`,f&&f(e)})),B=D(m),U=D((e=>{const t=O(),{duration:n,easing:r}=$b({style:v,timeout:_,easing:c},{mode:"exit"});if("auto"===_){const n=M.transitions.getAutoHeightDuration(t);e.style.transitionDuration=`${n}ms`,C.current=n}else e.style.transitionDuration="string"==typeof n?n:`${n}ms`;e.style[P]=A,e.style.transitionTimingFunction=r,g&&g(e)}));return(0,Wy.jsx)(x,(0,_n.Z)({in:u,onEnter:N,onEntered:F,onEntering:k,onExit:z,onExited:B,onExiting:U,addEndListener:e=>{"auto"===_&&E.start(C.current||0,e),i&&i(R.current,e)},nodeRef:R,timeout:"auto"===_?null:_},b,{children:(e,t)=>(0,Wy.jsx)(yN,(0,_n.Z)({as:l,className:(0,Ey.Z)(S.root,s,{entered:S.entered,exited:!u&&"0px"===A&&S.hidden}[e]),style:(0,_n.Z)({[I?"minWidth":"minHeight"]:A},v),ref:L},t,{ownerState:(0,_n.Z)({},w,{state:e}),children:(0,Wy.jsx)(vN,{ownerState:(0,_n.Z)({},w,{state:e}),className:S.wrapper,ref:T,children:(0,Wy.jsx)(_N,{ownerState:(0,_n.Z)({},w,{state:e}),className:S.wrapperInner,children:o})})}))}))}));xN.muiSupportAuto=!0;const bN=xN,wN=e.createContext({}),SN=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],MN=["component","slots","slotProps"],EN=["component"];function TN(e){return(0,lv.ZP)("MuiAccordion",e)}const CN=(0,$y.Z)("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),AN=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],IN=pN(),PN=(0,Iy.ZP)(Dw,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${CN.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t}=e;const n={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],n),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],n)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${CN.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${CN.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}}),(e=>{let{theme:t}=e;return{variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${CN.expanded}`]:{margin:"16px 0"}}}]}})),RN=e.forwardRef((function(t,n){const r=IN({props:t,name:"MuiAccordion"}),{children:i,className:o,defaultExpanded:s=!1,disabled:a=!1,disableGutters:l=!1,expanded:c,onChange:u,square:h=!1,slots:d={},slotProps:p={},TransitionComponent:f,TransitionProps:m}=r,g=(0,My.Z)(r,AN),[y,v]=(0,dS.Z)({controlled:c,default:s,name:"Accordion",state:"expanded"}),_=e.useCallback((e=>{v(!y),u&&u(e,!y)}),[y,u,v]),[x,...b]=e.Children.toArray(i),w=e.useMemo((()=>({expanded:y,disabled:a,disableGutters:l,toggle:_})),[y,a,l,_]),S=(0,_n.Z)({},r,{square:h,disabled:a,disableGutters:l,expanded:y}),M=(e=>{const{classes:t,square:n,expanded:r,disabled:i,disableGutters:o}=e,s={root:["root",!n&&"rounded",r&&"expanded",i&&"disabled",!o&&"gutters"],region:["region"]};return(0,Cy.Z)(s,TN,t)})(S),E=(0,_n.Z)({transition:f},d),T=(0,_n.Z)({transition:m},p),[C,A]=function(e,t){const{className:n,elementType:r,ownerState:i,externalForwardedProps:o,getSlotOwnerState:s,internalForwardedProps:a}=t,l=(0,My.Z)(t,SN),{component:c,slots:u={[e]:void 0},slotProps:h={[e]:void 0}}=o,d=(0,My.Z)(o,MN),p=u[e]||r,f=kv(h[e],i),m=fb((0,_n.Z)({className:n},l,{externalForwardedProps:"root"===e?d:void 0,externalSlotProps:f})),{props:{component:g},internalRef:y}=m,v=(0,My.Z)(m.props,EN),_=(0,F_.Z)(y,null==f?void 0:f.ref,t.ref),x=s?s(v):{},b=(0,_n.Z)({},i,x),w="root"===e?g||c:g,S=hb(p,(0,_n.Z)({},"root"===e&&!c&&!u[e]&&a,"root"!==e&&!u[e]&&a,v,w&&{as:w},{ref:_}),b);return Object.keys(x).forEach((e=>{delete S[e]})),[p,S]}("transition",{elementType:bN,externalForwardedProps:{slots:E,slotProps:T},ownerState:S});return(0,Wy.jsxs)(PN,(0,_n.Z)({className:(0,Ey.Z)(M.root,o),ref:n,ownerState:S,square:h},g,{children:[(0,Wy.jsx)(wN.Provider,{value:w,children:x}),(0,Wy.jsx)(C,(0,_n.Z)({in:y,timeout:"auto"},A,{children:(0,Wy.jsx)("div",{"aria-labelledby":x.props.id,id:x.props["aria-controls"],role:"region",className:M.region,children:b})}))]}))})),LN=RN;function DN(e){return(0,lv.ZP)("MuiAccordionDetails",e)}(0,$y.Z)("MuiAccordionDetails",["root"]);const ON=["className"],NN=pN(),kN=(0,Iy.ZP)("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{padding:t.spacing(1,2,2)}})),FN=e.forwardRef((function(e,t){const n=NN({props:e,name:"MuiAccordionDetails"}),{className:r}=n,i=(0,My.Z)(n,ON),o=n,s=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},DN,t)})(o);return(0,Wy.jsx)(kN,(0,_n.Z)({className:(0,Ey.Z)(s.root,r),ref:t,ownerState:o},i))})),zN=FN;function BN(e){return(0,lv.ZP)("MuiAccordionSummary",e)}const UN=(0,$y.Z)("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),jN=["children","className","expandIcon","focusVisibleClassName","onClick"],VN=pN(),GN=(0,Iy.ZP)(fv,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;const n={duration:t.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],n),[`&.${UN.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${UN.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${UN.disabled})`]:{cursor:"pointer"},variants:[{props:e=>!e.disableGutters,style:{[`&.${UN.expanded}`]:{minHeight:64}}}]}})),HN=(0,Iy.ZP)("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})((e=>{let{theme:t}=e;return{display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${UN.expanded}`]:{margin:"20px 0"}}}]}})),ZN=(0,Iy.ZP)("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})((e=>{let{theme:t}=e;return{display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${UN.expanded}`]:{transform:"rotate(180deg)"}}})),WN=e.forwardRef((function(t,n){const r=VN({props:t,name:"MuiAccordionSummary"}),{children:i,className:o,expandIcon:s,focusVisibleClassName:a,onClick:l}=r,c=(0,My.Z)(r,jN),{disabled:u=!1,disableGutters:h,expanded:d,toggle:p}=e.useContext(wN),f=(0,_n.Z)({},r,{expanded:d,disabled:u,disableGutters:h}),m=(e=>{const{classes:t,expanded:n,disabled:r,disableGutters:i}=e,o={root:["root",n&&"expanded",r&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]};return(0,Cy.Z)(o,BN,t)})(f);return(0,Wy.jsxs)(GN,(0,_n.Z)({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":d,className:(0,Ey.Z)(m.root,o),focusVisibleClassName:(0,Ey.Z)(m.focusVisible,a),onClick:e=>{p&&p(e),l&&l(e)},ref:n,ownerState:f},c,{children:[(0,Wy.jsx)(HN,{className:m.content,ownerState:f,children:i}),s&&(0,Wy.jsx)(ZN,{className:m.expandIconWrapper,ownerState:f,children:s})]}))})),$N=WN;var qN=i(3241),XN=i(2741),YN=i(9303);const KN=["className","component"];var JN=i(8610),QN=i(7458);const ek=(0,$y.Z)("MuiBox",["root"]),tk=(0,QN.Z)(),nk=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:n,defaultTheme:r,defaultClassName:i="MuiBox-root",generateClassName:o}=t,s=(0,CE.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(IE.Z);return e.forwardRef((function(e,t){const a=(0,Y_.Z)(r),l=(0,EM.Z)(e),{className:c,component:u="div"}=l,h=(0,My.Z)(l,KN);return(0,Wy.jsx)(s,(0,_n.Z)({as:u,ref:t,className:(0,Ey.Z)(c,o?o(i):i),theme:n&&a[n]||a},h))}))}({themeId:Q_.Z,defaultTheme:tk,defaultClassName:ek.root,generateClassName:JN.Z.generate}),rk=nk;function ik(e){return(0,lv.ZP)("MuiCard",e)}(0,$y.Z)("MuiCard",["root"]);const ok=["className","raised"],sk=(0,Iy.ZP)(Dw,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),ak=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiCard"}),{className:r,raised:i=!1}=n,o=(0,My.Z)(n,ok),s=(0,_n.Z)({},n,{raised:i}),a=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},ik,t)})(s);return(0,Wy.jsx)(sk,(0,_n.Z)({className:(0,Ey.Z)(a.root,r),elevation:i?8:void 0,ref:t,ownerState:s},o))})),lk=ak;function ck(e){return(0,lv.ZP)("MuiCardContent",e)}(0,$y.Z)("MuiCardContent",["root"]);const uk=["className","component"],hk=(0,Iy.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),dk=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiCardContent"}),{className:r,component:i="div"}=n,o=(0,My.Z)(n,uk),s=(0,_n.Z)({},n,{component:i}),a=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},ck,t)})(s);return(0,Wy.jsx)(hk,(0,_n.Z)({as:i,className:(0,Ey.Z)(a.root,r),ownerState:s,ref:t},o))})),pk=dk;function fk(e){return(0,lv.ZP)("MuiCircularProgress",e)}(0,$y.Z)("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const mk=["className","color","disableShrink","size","style","thickness","value","variant"];let gk,yk,vk,_k,xk=e=>e;const bk=(0,Hy.F4)(gk||(gk=xk`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),wk=(0,Hy.F4)(yk||(yk=xk`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),Sk=(0,Iy.ZP)("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`color${(0,mv.Z)(n.color)}`]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({display:"inline-block"},"determinate"===t.variant&&{transition:n.transitions.create("transform")},"inherit"!==t.color&&{color:(n.vars||n).palette[t.color].main})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&(0,Hy.iv)(vk||(vk=xk`
      animation: ${0} 1.4s linear infinite;
    `),bk)})),Mk=(0,Iy.ZP)("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),Ek=(0,Iy.ZP)("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.circle,t[`circle${(0,mv.Z)(n.variant)}`],n.disableShrink&&t.circleDisableShrink]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({stroke:"currentColor"},"determinate"===t.variant&&{transition:n.transitions.create("stroke-dashoffset")},"indeterminate"===t.variant&&{strokeDasharray:"80px, 200px",strokeDashoffset:0})}),(e=>{let{ownerState:t}=e;return"indeterminate"===t.variant&&!t.disableShrink&&(0,Hy.iv)(_k||(_k=xk`
      animation: ${0} 1.4s ease-in-out infinite;
    `),wk)})),Tk=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiCircularProgress"}),{className:r,color:i="primary",disableShrink:o=!1,size:s=40,style:a,thickness:l=3.6,value:c=0,variant:u="indeterminate"}=n,h=(0,My.Z)(n,mk),d=(0,_n.Z)({},n,{color:i,disableShrink:o,size:s,thickness:l,value:c,variant:u}),p=(e=>{const{classes:t,variant:n,color:r,disableShrink:i}=e,o={root:["root",n,`color${(0,mv.Z)(r)}`],svg:["svg"],circle:["circle",`circle${(0,mv.Z)(n)}`,i&&"circleDisableShrink"]};return(0,Cy.Z)(o,fk,t)})(d),f={},m={},g={};if("determinate"===u){const e=2*Math.PI*((44-l)/2);f.strokeDasharray=e.toFixed(3),g["aria-valuenow"]=Math.round(c),f.strokeDashoffset=`${((100-c)/100*e).toFixed(3)}px`,m.transform="rotate(-90deg)"}return(0,Wy.jsx)(Sk,(0,_n.Z)({className:(0,Ey.Z)(p.root,r),style:(0,_n.Z)({width:s,height:s},m,a),ownerState:d,ref:t,role:"progressbar"},g,h,{children:(0,Wy.jsx)(Mk,{className:p.svg,ownerState:d,viewBox:"22 22 44 44",children:(0,Wy.jsx)(Ek,{className:p.circle,style:f,ownerState:d,cx:44,cy:44,r:(44-l)/2,fill:"none",strokeWidth:l})})}))})),Ck=Tk;function Ak(e){return"sm"===e?"1.25rem":"md"===e?"1.5rem":"lg"===e?"2rem":"number"==typeof e?`${e}px`:e}function Ik(t){const{fourColor:n,id:r=qe().uniqueId("circular-progress-"),indeterminate:i,max:o,size:s,value:a}=t,l=(0,e.useRef)(null),c=(0,e.useRef)(r),u=Ak(s);return(0,e.useEffect)((()=>{l.current&&l.current.style.setProperty("--_size",u)}),[]),(0,Wy.jsx)("div",{className:"component-circular-progress-container",id:c.current,ref:l,children:(0,Wy.jsx)("div",{className:`circular-progress ${n?"circular-four-color":""} ${i?"indeterminate":""}`,children:i?(0,Wy.jsxs)("div",{className:"spinner",children:[(0,Wy.jsx)("div",{className:"left",children:(0,Wy.jsx)("div",{className:"circle"})}),(0,Wy.jsx)("div",{className:"right",children:(0,Wy.jsx)("div",{className:"circle"})})]}):function(){const e=100*(1-a/o);return(0,Wy.jsxs)("svg",{viewBox:"0 0 4800 4800",children:[(0,Wy.jsx)("circle",{className:"track",pathLength:"100"}),(0,Wy.jsx)("circle",{className:"active-track",pathLength:"100",strokeDashoffset:e})]})}()})})}function Pk(t){const{buffer:n,fourColor:r,id:i=qe().uniqueId("linear-progress-"),indeterminate:o,max:s,value:a}=t,l=(0,e.useRef)(i),c={transform:`scaleX(${100*(o?1:n/s)}%)`},u={transform:`scaleX(${100*(o?1:a/s)}%)`};return(0,Wy.jsx)("div",{className:"component-linear-progress-container",id:l.current,children:(0,Wy.jsxs)("div",{className:`linear-progress ${r?"linear-four-color":""} ${o?"indeterminate":""}`,children:[(0,Wy.jsx)("div",{className:"dots"}),(0,Wy.jsx)("div",{className:"inactive-track",style:c}),(0,Wy.jsx)("div",{className:"bar primary-bar",style:u,children:(0,Wy.jsx)("div",{className:"bar-inner"})}),(0,Wy.jsx)("div",{className:"bar secondary-bar",children:(0,Wy.jsx)("div",{className:"bar-inner"})})]})})}function Rk(t){const{appendedToDOM:n,circular:r,className:i,displayScrim:o=!!n,fullScreen:s=!!n,fullWindowed:a,id:l=qe().uniqueId("progress-"),scrimTransparent:c=!!n,style:u}=t,h=(0,e.useRef)(l),d=s?"progress-full screen":"",p=a?"progress-full windowed":"",f=o?"progress-scrim "+(c?"transparent":"opaque"):"";return(0,Wy.jsx)("div",{className:`component-progress-container ${d} ${p} ${f} ${i}`,id:h.current,style:u,children:r?(0,Wy.jsx)(Ik,{...t}):(0,Wy.jsx)(Pk,{...t})})}Ik.defaultProps={fourColor:!1,indeterminate:!0,size:"3rem"},Pk.defaultProps={buffer:1,fourColor:!1,indeterminate:!0},Rk.defaultProps={appendedToDOM:!1,circular:!1,className:"",fourColor:!1,fullWindowed:!1,indeterminate:!0,max:1,style:{},value:0};const Lk={HORIZONTAL:"horizontal",VERTICAL:"vertical"};function Dk(t){const{children:n,className:r,distance:i,id:o=qe().uniqueId("tooltip-"),orientation:s,supportingText:a}=t,[l,c]=(0,e.useState)(!1),[u,h]=(0,e.useState)(0),[d,p]=(0,e.useState)({left:0,top:0}),f=(0,e.useRef)(o),m=(0,e.useRef)(null);(0,e.useEffect)((()=>{l||c(!0)}),[l,d]);const g=(0,e.cloneElement)(n,{onBlur:v,onFocus:y,onPointerEnter:y,onPointerLeave:v});return l?(0,Wy.jsxs)(Wy.Fragment,{children:[g,(0,Wy.jsx)("div",{className:`component-tooltip body-small ${r}`,id:f.current,ref:m,style:{...d,opacity:u},children:a})]}):null;function y(e){const t=e.currentTarget.getBoundingClientRect(),n=m.current.getBoundingClientRect();let r=0;if(s===Lk.HORIZONTAL){const e=t.right+n.width+i>window.innerWidth;r=t.top+t.height/2-n.height/2,p({left:e?t.left-n.width-i+"px":`${t.right+i}px`,top:`${r+window.scrollY}px`}),h(1)}else{const e=Math.max(0,t.left+t.width/2-n.width/2),o=Math.min(window.innerWidth-n.width,Math.abs(t.right-t.width/2-n.width/2));r=t.top-n.height+i<=0?t.bottom+i:t.top-n.height-i,p({left:e<o?`${e}px`:`${o}px`,top:`${r+window.scrollY}px`}),h(1)}}function v(){h(0)}}function Ok(t){const{ariaLabel:n,children:r,className:i,color:o,disabled:s,href:a,id:l=qe().uniqueId("icon-button-"),loading:c,onClick:u,onMouseDown:h,onTouchStart:d,rel:p,selected:f,shape:m,size:g,style:y,tabIndex:v,target:_,title:x,tooltip:b=(x?{supportingText:x,...t.tooltip}:null),type:w,variant:S}=t,M=(0,e.useRef)(l).current,E=Object.fromEntries(Object.entries(t).filter((e=>{let[t]=e;return t.startsWith("data-")}))),T="sm"===g?"1.25rem":"md"===g?"1.5rem":"1.875rem",C=void 0===f?"":f?"selected":"unselected";if(a&&!s){const e=(0,Wy.jsx)("a",{...E,"aria-label":n,className:`component-icon-button-container icon-button-size-${g} ${o?`ng-palette-color-${o}`:""} ng-variant-${S} ${m?`ng-${m}`:""} ${C} ${i}`,href:a,id:M,rel:p,onClick:u,style:y,tabIndex:v,target:_,title:b?null:x,children:I()});return b?(0,Wy.jsx)(Dk,{...b,id:`${M}-icon-button-tooltip`,children:e}):e}const A=(0,Wy.jsx)("button",{...E,"aria-label":n,className:`component-icon-button-container icon-button-size-${g} ${o?`ng-palette-color-${o}`:""} ng-variant-${S} ${m?`ng-${m}`:""} ${C} ${i}`,disabled:c||s,id:M,onClick:u,onMouseDown:h,onTouchStart:d,style:y,tabIndex:v,title:b?null:x,type:w,children:I()});return b?(0,Wy.jsx)(Dk,{...b,id:`${M}-icon-button-tooltip`,children:A}):A;function I(){return c?(0,Wy.jsx)(Rk,{circular:!0,size:T}):r?(0,Wy.jsx)(Wy.Fragment,{children:r}):null}}function Nk(e,t,n){return Math.floor(e%(n-t)+t)}function kk(t){const{children:n,className:r,color:i,content:o,disabled:s,id:a=qe().uniqueId("badge-"),position:l,shape:c,size:u=(o?"lg":"sm"),style:h,transform:d,variant:p}=t,f=(0,e.useRef)(a).current;return n?(0,Wy.jsxs)("div",{className:`component-badge-sticky-container ${r}`,id:`${f}-badge-sticky-container`,style:h,children:[n,(0,Wy.jsx)("span",{className:`component-badge-container label-small ng-palette-color-${i} ${s?"disabled":""} ng-variant-${p} badge-position-${l} badge-size-${u} ${c?`ng-${c}`:""}`,id:f,style:{transform:`translate(${d[0]}%, ${d[1]}%)`},tabIndex:-1,children:o})]}):(0,Wy.jsx)("span",{className:`component-badge-container position-static label-small ng-palette-color-${i} ${s?"disabled":""} ng-variant-${p} badge-size-${u} ${c?`ng-${c}`:""} ${r}`,id:f,style:{...h,transform:`translate(${d[0]}%, ${d[1]}%)`},tabIndex:-1,children:o})}function Fk(t){const{backgroundColor:n,badge:r,className:i,disabled:o,htmlTitle:s,topAppBarIcon:a,icon:l=(a?(0,Wy.jsx)("span",{className:"component-avatar-icon material-symbols-outlined",children:"account_circle"}):(0,Wy.jsx)("span",{className:"component-avatar-icon person material-symbols-outlined",children:"person"})),id:c=qe().uniqueId("avatar-"),onClick:u,shape:h,size:d,style:p,title:f}=t,m=(0,e.useRef)(c).current,g=f&&m?function(e,t,n){return`hsl(${(r=function(e,t,n){const r=function(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t=Math.abs(t),t}(e);return[Nk(r,0,360),Nk(r,t[0],t[1]),Nk(r,n[0],n[1])]}(e,[40,60],[40,60]))[0]}, ${r[1]}%, ${r[2]}%)`;var r}(m):null,y=function(e,t){return"string"==typeof e&&e.length>0?e.split(" ").map((e=>e[0])).join("").substring(0,2).toUpperCase():t}(f,l),v=Ak(d);return r.enabled?(0,Wy.jsx)(kk,{color:r.color,disabled:o,content:r.content,shape:r.shape,size:r.size,variant:r.variant,children:(0,Wy.jsx)("div",{className:`component-avatar-container title-medium ${o?"disabled":""} ${f?"":"no-name"} ng-${h} ${i}`,id:m,onClick:u,style:{backgroundColor:n||g,fontSize:f?`calc(${v} / 2.25)`:v,height:v,maxHeight:v,width:v,...p},title:s||("string"==typeof f?f:""),children:y})}):(0,Wy.jsx)("div",{className:`component-avatar-container title-medium ${o?"disabled":""} ${f?"":"no-name"} ng-${h} ${i}`,id:m,onClick:u,style:{backgroundColor:n||g,fontSize:f?`calc(${v} / 2.25)`:v,height:v,maxHeight:v,width:v,...p},title:s||("string"==typeof f?f:""),children:y})}function zk(t){const{append:n,avatar:r,className:i,closable:o,disabled:s,htmlTitle:a,id:l=qe().uniqueId("chip-"),onClick:c,onClose:u,prepend:h,selected:d,size:p,shape:f,subtitle:m,style:g,title:y,variant:v}=t,_=(0,e.useRef)(l).current,x={disabled:s,cId:_,size:p,title:y,variant:v,...qe().omit(r,"enabled")},b="object"==typeof y,w=!c;return(0,Wy.jsxs)("div",{className:`component-chip-container label-large chip-variant-${v} chip-size-${p} ng-${f} ${o?"closable":""} ${s?"disabled":""} ${w?"passive-chip":""} ${d?"selected":""} ${b?"parent":""} ${r?"avatar":""} ${h?"prepend":""} ${n||o?"append":""} ${i}`,"data-id":_,id:_,onClick:s?null:c,onKeyDown:s||w?null:function(e){"Enter"===e.key&&e.currentTarget.click()},style:g,tabIndex:s||w?-1:0,children:[null!=r&&r.enabled?(0,Wy.jsx)("span",{className:"component-chip-prepend avatar",children:(0,Wy.jsx)(Fk,{...x})}):h?(0,Wy.jsx)("span",{className:"component-chip-prepend",id:`${_}-chip-prepend`,children:h}):null,(y||m)&&(0,Wy.jsxs)("div",{className:"component-chip-text-container",children:[y&&(0,Wy.jsx)("span",{className:"component-chip-title text-truncate",children:y}),m&&(0,Wy.jsx)("span",{className:"component-chip-subtitle text-truncate",children:m})]}),o?(0,Wy.jsx)("span",{className:"component-chip-append","data-id":_,id:`${_}-chip-remove-button`,onClick:e=>{e.stopPropagation(),null==u||u(e)},title:a?"Remove":"string"==typeof y?`Remove ${y}`:"",children:(0,Wy.jsx)("span",{className:"close-icon material-symbols-outlined",children:"close"})}):n?(0,Wy.jsx)("span",{className:"component-chip-append",id:`${_}-chip-append`,children:n}):null]})}Dk.defaultProps={children:null,className:"",distance:4,orientation:Lk.VERTICAL,supportingText:""},Ok.defaultProps={ariaLabel:null,children:null,className:"",color:"primary",disabled:!1,href:null,loading:!1,onClick:null,onMouseDown:null,onTouchStart:null,shape:"",size:"md",style:{},tabIndex:0,target:"_blank",title:null,type:"button",variant:"filled"},kk.defaultProps={children:null,className:"",color:"error",content:null,disabled:!1,position:"top-right",shape:"",style:{},transform:[],variant:"filled"},Fk.defaultProps={backgroundColor:null,badge:{color:"tertiary",content:null,enabled:!1,shape:"",size:"lg",variant:"filled"},className:"",disabled:!1,htmlTitle:"",onClick:null,shape:"circle",size:"2rem",style:{},title:null,topAppBarIcon:!1},zk.defaultProps={append:null,className:"",closable:!1,disabled:!1,htmlTitle:"",onClick:null,onClose:null,prepend:null,selected:!1,size:"md",shape:"rounded",subtitle:null,style:{},title:null,variant:"assist"};const Bk=(0,e.forwardRef)(((t,n)=>{const{className:r,id:i=qe().uniqueId("menu-"),index:o,loading:s,multiple:a,options:l,positionX:c,positionY:u,primaryKey:h,renderOption:d,selected:p,selectedKey:f,size:m,style:g}=t,[y,v]=(0,e.useState)(null),[_,x]=(0,e.useState)([]),b=(0,e.useRef)(i).current,w=(0,e.useRef)(!1);(0,e.useEffect)((()=>{qe().isEmpty(p)||(a?x(p.map((e=>e[h]))):v(p[h]))}),[]),(0,e.useEffect)((()=>{w.current?qe().isEmpty(p)?a?x([]):v(null):a?_.includes(f)?x(_.filter((e=>e!==f))):x([..._,f]):v(f):w.current=!0}),[p,f]),(0,e.useEffect)((()=>{const e=document.getElementById(`${b}-${o}`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}),[b,o]);const S="label-large";return(0,Wy.jsx)("div",{className:`component-menu-list-container menu-list-${u}-${c} menu-list-size-${m} ${S} ${r}`,id:b,onClick:e=>e.stopPropagation(),onScroll:function(e){var n;null===(n=t.onScroll)||void 0===n||n.call(t,e)},onTouchStart:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),ref:n,style:g,children:s?(0,Wy.jsx)("div",{className:`component-menu-list-item passive-menu-list-item ${S}`,children:"Searching..."}):qe().isEmpty(l)?(0,Wy.jsx)("div",{className:`component-menu-list-item passive-menu-list-item ${S}`,children:"No results found"}):(0,Wy.jsxs)(Wy.Fragment,{children:[l.map(((e,t)=>{const n=e.disabled||e.passive,r=(null==p?void 0:p.length)>=0?_.includes(e[h]):y===e[h],i=e.target||"_self",s=e.tooltip?e.tooltip:void 0;return e.href&&!n?(0,Wy.jsxs)("div",{id:`${b}-${t}`,children:[(0,Wy.jsx)("a",{className:`component-menu-list-item ${S} ${r?"selected":""} ${o===t?"focused":""}`,"data-id":e[h],"data-index":t,href:e.href,id:`${b}-menu-list-item-${e[h]}`,target:i,title:s,children:C(e,r)}),e.divider&&t>=0&&(0,Wy.jsx)("hr",{className:"ng-divider"})]},t):(0,Wy.jsxs)("div",{id:`${b}-${t}`,children:[(0,Wy.jsx)("div",{className:`component-menu-list-item ${S} ${e.disabled?"disabled-menu-list-item":""} ${e.passive?"passive-menu-list-item":""} ${r?"selected":""} ${o===t?"focused":""}`,"data-id":e[h],"data-index":t,id:`${b}-menu-list-item-${e[h]}`,onClick:n?null:M,onMouseEnter:n?null:E,onMouseLeave:n?null:T,title:s,children:C(e,r)}),e.divider&&t>=0&&(0,Wy.jsx)("hr",{className:"ng-divider"})]},t)})),t.onClear&&(0,Wy.jsxs)("button",{className:`component-menu-list-item ${S}`,disabled:t.clearDisabled,id:`${b}-menu-clear-button`,onClick:function(){t.onClear(),x([])},type:"button",children:[(0,Wy.jsx)("span",{className:"close-icon material-symbols-outlined",children:"close"}),"Clear"]})]})});function M(e){var n;const r=parseInt(e.currentTarget.getAttribute("data-index"));null===(n=t.onClick)||void 0===n||n.call(t,e,r)}function E(e){var n;const r=parseInt(e.currentTarget.getAttribute("data-index"));null===(n=t.onMouseEnter)||void 0===n||n.call(t,e,r)}function T(e){var n;const r=parseInt(e.currentTarget.getAttribute("data-index"));null===(n=t.onMouseLeave)||void 0===n||n.call(t,e,r)}function C(e,t){return(0,Wy.jsxs)(Wy.Fragment,{children:[e.prepend&&(0,Wy.jsx)("div",{className:"component-menu-list-item-prepend",id:`${b}-menu-list-item-${e[h]}-prepend`,children:e.prepend}),d(e,t),e.append&&(0,Wy.jsx)("div",{className:"component-menu-list-item-append",id:`${b}-menu-list-item-${e[h]}-append`,children:e.append})]})}}));Bk.defaultProps={className:"",index:-1,loading:!1,multiple:!1,options:[],positionX:"left",positionY:"bottom",primaryKey:"id",renderOption:function(e){return(0,Wy.jsx)("p",{className:"text-truncate flex-grow-1 m-0",children:e.title||e.name||e.id||e.key})},size:"sm",style:{}};const Uk=Bk;function jk(e,t,n){return e.bottom+t.height<n.height?e.bottom:e.top-t.height}function Vk(e,t,n){return e.top+t.height<n.height?e.top:e.bottom-t.height}function Gk(e,t){return e.left-t.width>0?e.left-t.width:e.right}function Hk(e,t){return e.right-t.width>0?e.right-t.width:e.left}function Zk(e,t){return(e.left+e.right)/2-t.width/2}function Wk(e,t){return(e.top+e.bottom)/2-t.height/2}function $k(e,t,n){return e.right+t.width<n.width?e.right:e.left-t.width}function qk(e,t,n){return e.left+t.width<n.width?e.left:e.right-t.width}function Xk(e,t){return e.top-t.height>0?e.top-t.height:e.bottom}function Yk(e,t){return e.bottom-t.height>0?e.bottom-t.height:e.top}function Kk(e,t,n,r){switch(r){case"bottom":return{x:Zk(e,t),y:jk(e,t,n)};case"bottom-left":return{x:Hk(e,t),y:jk(e,t,n)};case"bottom-right":return{x:qk(e,t,n),y:jk(e,t,n)};case"left":return{x:Gk(e,t),y:Wk(e,t)};case"left-bottom":return{x:Gk(e,t),y:Vk(e,t,n)};case"left-top":return{x:Gk(e,t),y:Yk(e,t)};case"right":return{x:$k(e,t,n),y:Wk(e,t)};case"right-bottom":return{x:$k(e,t,n),y:Vk(e,t,n)};case"right-top":return{x:$k(e,t,n),y:Yk(e,t)};case"top":return{x:Zk(e,t),y:Xk(e,t)};case"top-left":return{x:Hk(e,t),y:Xk(e,t)};case"top-right":return{x:qk(e,t,n),y:Xk(e,t)};default:return{x:0,y:0}}}const Jk={opened:!1,x:0,y:0};class Qk extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("menu-button-"),this.state=Jk,this.close=this.close.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.onOptionSelected=this.onOptionSelected.bind(this),this.toggle=this.toggle.bind(this)}componentDidUpdate(e,t){const{clickBlur:n,scrollBlur:r}=this.props;!t.opened&&this.state.opened?(window.addEventListener("resize",this.close),document.addEventListener("keydown",this.handleKeyPress),n&&document.addEventListener("mousedown",this.mousedownClose),r&&document.addEventListener("scroll",this.close,!0)):t.opened&&!this.state.opened&&(window.removeEventListener("resize",this.close),document.removeEventListener("keydown",this.handleKeyPress),n&&document.removeEventListener("mousedown",this.mousedownClose),r&&document.removeEventListener("scroll",this.close))}render(){var t,n;const{children:r}=this.props,{opened:i,x:o,y:s}=this.state,a=(null===(t=r[0])||void 0===t||null===(n=t.props)||void 0===n?void 0:n.className)||"",l=(0,e.cloneElement)(r[0],{className:`${a} ${i?"active":""}`,id:`${this.componentId}-menu-button-trigger`,onClick:this.toggle}),c=(0,e.cloneElement)(r[1],{id:`${this.componentId}-menu-button-menu`,onClick:this.props.onSelect?this.onOptionSelected:null,ref:e=>this.menuRef=e,style:{position:"fixed",left:`${o}px`,top:`${s}px`,visibility:i?"visible":"hidden"}});return(0,Wy.jsxs)("div",{id:this.componentId,children:[l,c]})}close(){this.setState(Jk)}handleKeyPress(e){"Escape"!==e.key&&"Tab"!==e.key||this.close()}mousedownClose(e){var t;null!==(t=document.getElementById(this.componentId))&&void 0!==t&&t.contains(e.target)||this.close()}onOptionSelected(e){this.props.onSelect(e.currentTarget.getAttribute("data-id"),e.currentTarget.getAttribute("data-index"),e),this.close()}toggle(e){if(e.stopPropagation(),this.state.opened)this.close();else{const t=e.currentTarget,n=document.body,r=t.getBoundingClientRect(),i=this.menuRef.getBoundingClientRect(),o=n.getBoundingClientRect(),{x:s,y:a}=Kk(r,i,o,this.props.position);this.setState({opened:!0,x:s,y:a})}}}function eF(t){const{append:n,ariaLabel:r,children:i,className:o,color:s,disabled:a,href:l,id:c=qe().uniqueId("button-"),loading:u,rel:h,onClick:d,onMouseDown:p,onTouchStart:f,prepend:m,selected:g,shape:y,size:v,style:_,target:x,title:b,tooltip:w=(b?{supportingText:b,...t.tooltip}:null),type:S,variant:M}=t,E=(0,e.useRef)(c).current,T=Object.fromEntries(Object.entries(t).filter((e=>{let[t]=e;return t.startsWith("data-")}))),C="lg"===v?"1.5rem":"1.375rem",A=void 0===g?"":g?"selected":"unselected";if(l&&!a&&!u){const e=(0,Wy.jsx)("a",{...T,"aria-label":r,className:`component-button-container label-large button-size-${v} ${s?`ng-palette-color-${s}`:""} ng-variant-${M} ${y?`ng-${y}`:""} ${A} ${m?"prepend":""} ${n?"append":""} ${o}`,href:l,id:E,rel:h,onClick:d,style:_,target:x,title:w?null:b,children:P()});return w?(0,Wy.jsx)(Dk,{...w,id:`${E}-button-tooltip`,children:e}):e}const I=(0,Wy.jsx)("button",{...T,"aria-label":r,className:`component-button-container label-large button-size-${v} ${s?`ng-palette-color-${s}`:""} ng-variant-${M} ${y?`ng-${y}`:""} ${A} ${m?"prepend":""} ${n?"append":""} ${o}`,disabled:u||a,id:E,onClick:d,onMouseDown:p,onTouchStart:f,style:_,type:S,title:w?null:b,children:P()});return w?(0,Wy.jsx)(Dk,{...w,id:`${E}-button-tooltip`,children:I}):I;function P(){return u?(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)("span",{className:"component-button-prepend",id:`${E}-button-prepend`,children:(0,Wy.jsx)(Rk,{circular:!0,size:C})}),R()]}):(0,Wy.jsxs)(Wy.Fragment,{children:[m&&(0,Wy.jsx)("span",{className:"component-button-prepend",id:`${E}-button-prepend`,children:m}),R()]})}function R(){return(0,Wy.jsxs)(Wy.Fragment,{children:[i&&(0,Wy.jsx)(Wy.Fragment,{children:i}),n&&(0,Wy.jsx)("span",{className:"component-button-append",id:`${E}-button-append`,children:n})]})}}function tF(t){let n=[];return e.Children.map(t,(function(r,i){const{className:o}=r.props;let s;s=0===i?"border-right ng-border-color sharp-right-top sharp-right-bottom":i===t.length-1?"sharp-left-top sharp-left-bottom":"border-right ng-border-color sharp-left-top sharp-left-bottom sharp-right-top sharp-right-bottom",n.push((0,e.cloneElement)(r,{className:`${o||""} ${s}`,key:i}))})),n}function nF(t){const{children:n,id:r=qe().uniqueId("button-group-")}=t,i=(0,e.useRef)(r);return(0,Wy.jsx)("div",{className:"component-button-group-container",id:i.current,children:tF(n)})}function rF(t){const{checked:n,className:r,disabled:i,filled:o,indeterminate:s,label:a,errorText:l=`Not a valid ${null==a?void 0:a.toLowerCase()}`,id:c=qe().uniqueId("checkbox-"),labelPlacement:u,onFocus:h,readOnly:d,required:p,size:f,style:m,supportingText:g,title:y}=t,[v,_]=(0,e.useState)(!1),[x,b]=(0,e.useState)(n),w=(0,e.useRef)(c).current,S=(0,e.useRef)(!1);(0,e.useEffect)((()=>b(n)),[n]),(0,e.useEffect)((()=>{S.current?p&&T():S.current=!0}),[x]);const M=v&&!i,E=p&&M?l:g;return(0,Wy.jsxs)("div",{className:`component-checkbox-main-container body-large checkbox-size-${f} label-${u} ${r} ${i?"disabled":""} ${d?"pointer-events-none":""} ${o?"filled":""} ${s?"indeterminate":""} ${a?"":"no-label"} ${x?"selected":""}`,id:`${w}-checkbox-main-container`,style:m,children:[(0,Wy.jsxs)("label",{className:"component-checkbox-inner-container",id:`${w}-checkbox-inner-container`,onMouseDown:e=>e.preventDefault(),children:[(0,Wy.jsxs)("div",{className:"component-checkbox",title:y,children:[(0,Wy.jsx)("input",{checked:x,disabled:i,id:w,onBlur:function(){var e;null==t||null===(e=t.onBlur)||void 0===e||e.call(t),p&&T()},onChange:function(e){t.disabled||t.readOnly||(t.onChange?t.onChange(e.target.checked,w):b(e.target.checked))},onClick:function(e){if(t.readOnly)return e.preventDefault(),!1;var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t)},onFocus:h,required:p,type:"checkbox"}),x?(0,Wy.jsx)("span",{className:"component-checkbox-icon checkbox-icon material-symbols-outlined",children:"check_box"}):s?(0,Wy.jsx)("span",{className:"component-checkbox-icon checkbox-icon material-symbols-outlined",children:"indeterminate_check_box"}):(0,Wy.jsx)("span",{className:"component-checkbox-icon material-symbols-outlined",children:"check_box_outline_blank"})]}),a&&(0,Wy.jsxs)("span",{className:"component-checkbox-label",children:[a,p&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]})]}),E&&(0,Wy.jsx)("p",{className:"component-supporting-text body-small "+(M?"error-text":""),title:E,children:E})]});function T(){_(!x)}}function iF(t){const{closable:n,disabled:r,id:i=qe().uniqueId("chip-option-"),onClose:o,title:s}=t,a=(0,e.useRef)(i);return(0,Wy.jsx)(zk,{avatar:{enabled:!0},closable:n,disabled:r,id:a.current,onClose:o,size:"sm",title:s,variant:"input"})}Qk.defaultProps={children:null,clickBlur:!0,position:"bottom-left",scrollBlur:!0},eF.defaultProps={append:null,ariaLabel:null,children:null,className:"",color:"primary",disabled:!1,href:null,loading:!1,onClick:null,onMouseDown:null,onTouchStart:null,prepend:null,shape:"",size:"md",style:{},target:"_blank",title:null,type:"button",variant:"filled"},rF.defaultProps={checked:!1,className:"",disabled:!1,filled:!0,indeterminate:!1,label:"",labelPlacement:"end",readOnly:!1,required:!1,size:"md",style:{},supportingText:"",title:""};var oF=i(2586),sF=i(7677);function aF(e){return(0,lv.ZP)("MuiTooltip",e)}const lF=(0,$y.Z)("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),cF=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"],uF=(0,Iy.ZP)(AP,{name:"MuiTooltip",slot:"Popper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.popper,!n.disableInteractive&&t.popperInteractive,n.arrow&&t.popperArrow,!n.open&&t.popperClose]}})((e=>{let{theme:t,ownerState:n,open:r}=e;return(0,_n.Z)({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!n.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},n.arrow&&{[`&[data-popper-placement*="bottom"] .${lF.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${lF.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${lF.arrow}`]:(0,_n.Z)({},n.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${lF.arrow}`]:(0,_n.Z)({},n.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})})),hF=(0,Iy.ZP)("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.tooltip,n.touch&&t.touch,n.arrow&&t.tooltipArrow,t[`tooltipPlacement${(0,mv.Z)(n.placement.split("-")[0])}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:(0,Ay.Fq)(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},n.arrow&&{position:"relative",margin:0},n.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:(16/14,Math.round(114285.71428571428)/1e5+"em"),fontWeight:t.typography.fontWeightRegular},{[`.${lF.popper}[data-popper-placement*="left"] &`]:(0,_n.Z)({transformOrigin:"right center"},n.isRtl?(0,_n.Z)({marginLeft:"14px"},n.touch&&{marginLeft:"24px"}):(0,_n.Z)({marginRight:"14px"},n.touch&&{marginRight:"24px"})),[`.${lF.popper}[data-popper-placement*="right"] &`]:(0,_n.Z)({transformOrigin:"left center"},n.isRtl?(0,_n.Z)({marginRight:"14px"},n.touch&&{marginRight:"24px"}):(0,_n.Z)({marginLeft:"14px"},n.touch&&{marginLeft:"24px"})),[`.${lF.popper}[data-popper-placement*="top"] &`]:(0,_n.Z)({transformOrigin:"center bottom",marginBottom:"14px"},n.touch&&{marginBottom:"24px"}),[`.${lF.popper}[data-popper-placement*="bottom"] &`]:(0,_n.Z)({transformOrigin:"center top",marginTop:"14px"},n.touch&&{marginTop:"24px"})})})),dF=(0,Iy.ZP)("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(e,t)=>t.arrow})((e=>{let{theme:t}=e;return{overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:(0,Ay.Fq)(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}}));let pF=!1;const fF=new Zy.V;let mF={x:0,y:0};function gF(e,t){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];t&&t(n,...i),e(n,...i)}}const yF=e.forwardRef((function(t,n){var r,i,o,s,a,l,c,u,h,d,p,f,m,g,y,v,_,x,b;const w=(0,Ry.Z)({props:t,name:"MuiTooltip"}),{arrow:S=!1,children:M,components:E={},componentsProps:T={},describeChild:C=!1,disableFocusListener:A=!1,disableHoverListener:I=!1,disableInteractive:P=!1,disableTouchListener:R=!1,enterDelay:L=100,enterNextDelay:D=0,enterTouchDelay:O=700,followCursor:N=!1,id:k,leaveDelay:F=0,leaveTouchDelay:z=1500,onClose:B,onOpen:U,open:j,placement:V="bottom",PopperComponent:G,PopperProps:H={},slotProps:Z={},slots:W={},title:$,TransitionComponent:q=Qb,TransitionProps:X}=w,Y=(0,My.Z)(w,cF),K=e.isValidElement(M)?M:(0,Wy.jsx)("span",{children:M}),J=Zb(),Q=vb(),[ee,te]=e.useState(),[ne,re]=e.useState(null),ie=e.useRef(!1),oe=P||N,se=(0,Zy.Z)(),ae=(0,Zy.Z)(),le=(0,Zy.Z)(),ce=(0,Zy.Z)(),[ue,he]=(0,dS.Z)({controlled:j,default:!1,name:"Tooltip",state:"open"});let de=ue;const pe=(0,sF.Z)(k),fe=e.useRef(),me=(0,Dy.Z)((()=>{void 0!==fe.current&&(document.body.style.WebkitUserSelect=fe.current,fe.current=void 0),ce.clear()}));e.useEffect((()=>me),[me]);const ge=e=>{fF.clear(),pF=!0,he(!0),U&&!de&&U(e)},ye=(0,Dy.Z)((e=>{fF.start(800+F,(()=>{pF=!1})),he(!1),B&&de&&B(e),se.start(J.transitions.duration.shortest,(()=>{ie.current=!1}))})),ve=e=>{ie.current&&"touchstart"!==e.type||(ee&&ee.removeAttribute("title"),ae.clear(),le.clear(),L||pF&&D?ae.start(pF?D:L,(()=>{ge(e)})):ge(e))},_e=e=>{ae.clear(),le.start(F,(()=>{ye(e)}))},{isFocusVisibleRef:xe,onBlur:be,onFocus:we,ref:Se}=(0,Oy.Z)(),[,Me]=e.useState(!1),Ee=e=>{be(e),!1===xe.current&&(Me(!1),_e(e))},Te=e=>{ee||te(e.currentTarget),we(e),!0===xe.current&&(Me(!0),ve(e))},Ce=e=>{ie.current=!0;const t=K.props;t.onTouchStart&&t.onTouchStart(e)};e.useEffect((()=>{if(de)return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)};function e(e){"Escape"!==e.key&&"Esc"!==e.key||ye(e)}}),[ye,de]);const Ae=(0,Ly.Z)(K.ref,Se,te,n);$||0===$||(de=!1);const Ie=e.useRef(),Pe={},Re="string"==typeof $;C?(Pe.title=de||!Re||I?null:$,Pe["aria-describedby"]=de?pe:null):(Pe["aria-label"]=Re?$:null,Pe["aria-labelledby"]=de&&!Re?pe:null);const Le=(0,_n.Z)({},Pe,Y,K.props,{className:(0,Ey.Z)(Y.className,K.props.className),onTouchStart:Ce,ref:Ae},N?{onMouseMove:e=>{const t=K.props;t.onMouseMove&&t.onMouseMove(e),mF={x:e.clientX,y:e.clientY},Ie.current&&Ie.current.update()}}:{}),De={};R||(Le.onTouchStart=e=>{Ce(e),le.clear(),se.clear(),me(),fe.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",ce.start(O,(()=>{document.body.style.WebkitUserSelect=fe.current,ve(e)}))},Le.onTouchEnd=e=>{K.props.onTouchEnd&&K.props.onTouchEnd(e),me(),le.start(z,(()=>{ye(e)}))}),I||(Le.onMouseOver=gF(ve,Le.onMouseOver),Le.onMouseLeave=gF(_e,Le.onMouseLeave),oe||(De.onMouseOver=ve,De.onMouseLeave=_e)),A||(Le.onFocus=gF(Te,Le.onFocus),Le.onBlur=gF(Ee,Le.onBlur),oe||(De.onFocus=Te,De.onBlur=Ee));const Oe=e.useMemo((()=>{var e;let t=[{name:"arrow",enabled:Boolean(ne),options:{element:ne,padding:4}}];return null!=(e=H.popperOptions)&&e.modifiers&&(t=t.concat(H.popperOptions.modifiers)),(0,_n.Z)({},H.popperOptions,{modifiers:t})}),[ne,H]),Ne=(0,_n.Z)({},w,{isRtl:Q,arrow:S,disableInteractive:oe,placement:V,PopperComponentProp:G,touch:ie.current}),ke=(e=>{const{classes:t,disableInteractive:n,arrow:r,touch:i,placement:o}=e,s={popper:["popper",!n&&"popperInteractive",r&&"popperArrow"],tooltip:["tooltip",r&&"tooltipArrow",i&&"touch",`tooltipPlacement${(0,mv.Z)(o.split("-")[0])}`],arrow:["arrow"]};return(0,Cy.Z)(s,aF,t)})(Ne),Fe=null!=(r=null!=(i=W.popper)?i:E.Popper)?r:uF,ze=null!=(o=null!=(s=null!=(a=W.transition)?a:E.Transition)?s:q)?o:Qb,Be=null!=(l=null!=(c=W.tooltip)?c:E.Tooltip)?l:hF,Ue=null!=(u=null!=(h=W.arrow)?h:E.Arrow)?u:dF,je=hb(Fe,(0,_n.Z)({},H,null!=(d=Z.popper)?d:T.popper,{className:(0,Ey.Z)(ke.popper,null==H?void 0:H.className,null==(p=null!=(f=Z.popper)?f:T.popper)?void 0:p.className)}),Ne),Ve=hb(ze,(0,_n.Z)({},X,null!=(m=Z.transition)?m:T.transition),Ne),Ge=hb(Be,(0,_n.Z)({},null!=(g=Z.tooltip)?g:T.tooltip,{className:(0,Ey.Z)(ke.tooltip,null==(y=null!=(v=Z.tooltip)?v:T.tooltip)?void 0:y.className)}),Ne),He=hb(Ue,(0,_n.Z)({},null!=(_=Z.arrow)?_:T.arrow,{className:(0,Ey.Z)(ke.arrow,null==(x=null!=(b=Z.arrow)?b:T.arrow)?void 0:x.className)}),Ne);return(0,Wy.jsxs)(e.Fragment,{children:[e.cloneElement(K,Le),(0,Wy.jsx)(Fe,(0,_n.Z)({as:null!=G?G:AP,placement:V,anchorEl:N?{getBoundingClientRect:()=>({top:mF.y,left:mF.x,right:mF.x,bottom:mF.y,width:0,height:0})}:ee,popperRef:Ie,open:!!ee&&de,id:pe,transition:!0},De,je,{popperOptions:Oe,children:e=>{let{TransitionProps:t}=e;return(0,Wy.jsx)(ze,(0,_n.Z)({timeout:J.transitions.duration.shorter},t,Ve,{children:(0,Wy.jsxs)(Be,(0,_n.Z)({},Ge,{children:[$,S?(0,Wy.jsx)(Ue,(0,_n.Z)({},He,{ref:re})):null]}))}))}}))]})})),vF=yF;function _F(e){const{className:t,shape:n,title:r,tooltipPlacement:i,...o}=e;return(0,Wy.jsx)(vF,{placement:i,title:r,children:(0,Wy.jsx)(Tv,{...o,className:`component-copy-to-clipboard-button ${n?`ng-${n}`:""} ${t}`,endIcon:(0,Wy.jsx)(oF.Z,{sx:{color:"primary.main"}}),onClick:()=>{return e=r,navigator.clipboard.writeText(e),void hy(`Copied ${e}`);var e},children:e.children})})}function xF(e,t){(e.scrollY||e.scrollTop)>0?t&&!t.classList.contains("content-scrolled")&&t.classList.add("content-scrolled"):t&&t.classList.contains("content-scrolled")&&t.classList.remove("content-scrolled")}_F.defaultProps={className:"",shape:"rounded"};const bF="center";class wF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("modal-"),this.state={opened:!(!e.defaultOpened&&!e.appendedToDOM)},this.close=this.close.bind(this),this.open=this.open.bind(this),this.registerModalContent=this.registerModalContent.bind(this),this.registerModalHeader=this.registerModalHeader.bind(this)}registerModalContent(e){e&&(this.modalContent=e)}registerModalHeader(e){e&&(this.modalHeader=e)}componentDidUpdate(e,t){var n,r;if(!t.opened&&this.state.opened)null===(n=this.props)||void 0===n||null===(r=n.onOpen)||void 0===r||r.call(n);else if(t.opened&&!this.state.opened){var i,o;null===(i=this.props)||void 0===i||null===(o=i.onClose)||void 0===o||o.call(i)}}render(){const{opened:t}=this.state,{appendedToDOM:n,buttons:r,className:i,children:o,closable:s=!!n,closeButton:a,dividers:l,icon:c,position:u,showScrim:h,title:d,trigger:p}=this.props,f=p&&(0,e.cloneElement)(p,{id:`${this.componentId}-modal-trigger`,onClick:this.open,onKeyPress:e=>"Enter"===e.key?this.open():null});return u===bF?(0,Wy.jsxs)(Wy.Fragment,{children:[f,t&&(0,Wy.jsxs)("div",{className:`${this.componentId}-modal-main-container`,onMouseDown:e=>e.stopPropagation(),children:[h&&(0,Wy.jsx)("div",{className:"ng-fullscreen-scrim visible",id:`${this.componentId}-modal-scrim`,onClick:s?this.close:null}),(0,Wy.jsxs)("div",{className:`component-modal-container ${u}-modal ${l?"content-dividers":""} ${c?"icon-visible":""} ${i}`,id:this.componentId,onClick:e=>e.stopPropagation(),children:[(0,Wy.jsxs)("header",{className:"component-modal-header",ref:this.registerModalHeader,children:[c&&(0,Wy.jsx)("div",{className:"component-modal-icon-container",children:c}),(0,Wy.jsx)("h4",{className:"headline-small m-0",title:d,children:d}),s&&a&&(0,Wy.jsx)(Ok,{className:"modal-close-icon-button",color:null,id:`${this.componentId}-modal-close-button`,onClick:this.close,title:"Close",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}),(0,Wy.jsx)("div",{className:"component-modal-content body-medium",id:`${this.componentId}-modal-content`,onScroll:()=>xF(this.modalContent,this.modalHeader),ref:this.registerModalContent,children:o}),r&&(0,Wy.jsx)("footer",{children:r})]})]})]}):(0,Wy.jsxs)(Wy.Fragment,{children:[f,t&&(0,Wy.jsxs)("div",{className:`${this.componentId}-modal-main-container`,onMouseDown:e=>e.stopPropagation(),children:[h&&(0,Wy.jsx)("div",{className:"ng-fullscreen-scrim visible",id:`${this.componentId}-modal-scrim`,onClick:s?this.close:null}),(0,Wy.jsxs)("div",{className:`component-modal-container ${u}-modal ${l?"content-dividers":""} ${i}`,id:this.componentId,onClick:e=>e.stopPropagation(),children:[(0,Wy.jsxs)("header",{className:"component-modal-header",ref:this.registerModalHeader,children:[s&&(0,Wy.jsx)(Ok,{className:"mr-2",color:null,id:`${this.componentId}-modal-close-button`,onClick:this.close,title:"Close",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"close"})}),(0,Wy.jsxs)("div",{className:"component-modal-title-container",children:[(0,Wy.jsx)("h5",{className:"title-large m-0 text-truncate",title:d,children:d}),r]})]}),(0,Wy.jsx)("div",{className:"component-modal-content body-medium",id:`${this.componentId}-modal-content`,onScroll:()=>xF(this.modalContent,this.modalHeader),ref:this.registerModalContent,children:o})]})]})]})}close(e){e.stopPropagation(),document.body.classList.contains("overflow-y-hidden")&&(document.body.classList.remove("overflow-y-hidden"),document.body.classList.add("overflow-y-scroll")),this.setState({opened:!1})}open(e){e.stopPropagation(),document.body.classList.contains("overflow-y-scroll")&&(document.body.classList.remove("overflow-y-scroll"),document.body.classList.add("overflow-y-hidden")),this.setState({opened:!0})}}function SF(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"")}wF.defaultProps={appendedToDOM:!1,className:"",children:null,closeButton:!1,dividers:!1,icon:null,position:bF,showScrim:!0,trigger:null};class MF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("combobox-"),this.initialOptionIndex=e.isInitialIndexZero?0:-1;const t=e.options.findIndex((t=>{var n;return t[e.primaryKey]===(null===(n=e.value)||void 0===n?void 0:n[e.primaryKey])}));this.state={focused:!1,invalid:!1,opened:!1,optionIndex:-1===t?this.initialOptionIndex:t,search:"",selected:e.value||null,selectedIndex:t,selectedKey:null,x:0,y:0},this.callback=this.callback.bind(this),this.clearSearch=this.clearSearch.bind(this),this.close=this.close.bind(this),this.focus=this.focus.bind(this),this.getMenuPosition=this.getMenuPosition.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleOptionSelect=this.handleOptionSelect.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.open=this.open.bind(this),this.validate=this.validate.bind(this)}componentDidUpdate(e,t){const{primaryKey:n,required:r,scrollBlur:i,value:o}=this.props,{opened:s,search:a,selected:l}=this.state;if(!t.opened&&s?(window.addEventListener("resize",this.close),document.addEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),i&&document.addEventListener("scroll",this.close)):t.opened&&!s&&(window.removeEventListener("resize",this.close),document.removeEventListener("mousedown",this.mousedownClose),document.removeEventListener("touchstart",this.mousedownClose),i&&document.removeEventListener("scroll",this.close)),!qe().isEqual(e.value,o)&&!qe().isEqual(l,o)){const e=this.filteredOptions.findIndex((e=>e[n]===(null==o?void 0:o[n]))),t=-1===e?this.initialOptionIndex:e;this.setState({selected:o||null,selectedKey:o[n]||null,optionIndex:t,selectedIndex:e})}if(r&&!qe().isEqual(t.selected,l)&&this.validate(),t.search!==a){var c,u;const{x:e,y:t}=this.getMenuPosition();this.setState({x:e,y:t}),null===(c=this.props)||void 0===c||null===(u=c.onSearch)||void 0===u||u.call(c,a)}}render(){var e;const{focused:t,invalid:n,opened:r,optionIndex:i,search:o,selected:s,selectedKey:a,x:l,y:c}=this.state,{append:u,arrowButton:h,autoFocus:d,clearButton:p,className:f,disabled:m,label:g,loading:y,errorText:v=`Not a valid ${null==g?void 0:g.toLowerCase()}`,maxLength:_,options:x,placeholder:b,prepend:w,primaryKey:S,renderOption:M,renderSelected:E,required:T,searchableKeys:C,size:A,style:I,supportingText:P,variant:R}=this.props;this.filteredOptions=x.filter((e=>C.reduce(((t,n)=>t||SF(e[n]||"").includes(SF(o))),!1)));const L=u&&!s,D=w&&!s||y,O=p&&(o||s),N=n&&!m,k=!t&&!r&&T&&!s,F=T?N?v:"*required":P||"",z=null===(e=document.getElementById(this.componentId))||void 0===e?void 0:e.offsetWidth;return(0,Wy.jsxs)("div",{className:`component-combobox-main-container ng-textfield-main-container body-large ng-textfield-variant-${R} ng-textfield-size-${A} ${h?"arrow-button-visible":""} ${m?"disabled":""} ${N?"invalid":""} ${T?"required":""} ${O?"clear-button-visible":""} ${t?"focused":""} ${r?"opened":""} ${s?"selected":""} ${L?"append-visible":""} ${D?"prepend-visible":""} ${f}`,id:`${this.componentId}-combobox-main-container`,style:I,children:[(0,Wy.jsxs)("div",{className:"component-combobox-inner-container ng-textfield-inner-container",children:[D&&(0,Wy.jsx)("span",{className:"ng-textfield-prepend",id:`${this.componentId}-combobox-prepend`,children:y?(0,Wy.jsx)(Rk,{circular:!0,size:"1.5rem"}):w}),(0,Wy.jsx)("input",{autoFocus:d,autoComplete:"off",className:"component-combobox ng-textfield "+(g?"":"ng-placeholder-visible"),disabled:m,id:this.componentId,maxLength:_,onBlur:this.handleBlur,onChange:this.handleSearchChange,onClick:r?this.close:this.open,onFocus:this.handleFocus,placeholder:b,readOnly:s,type:"search",value:o}),s&&(0,Wy.jsx)("div",{className:"ng-textfield",children:E(s)}),(L||h||O||N)&&(0,Wy.jsxs)("div",{className:"ng-textfield-append",children:[O&&(0,Wy.jsx)("button",{className:"ng-textfield-button clear-button",id:`${this.componentId}-combobox-clear-button`,onClick:o?this.clearSearch:s?this.handleOptionSelect:null,tabIndex:-1,title:"Clear",type:"button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"cancel"})}),h&&(0,Wy.jsx)("div",{className:"ng-textfield-button arrow-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:r?"arrow_drop_up":"arrow_drop_down"})}),N&&(0,Wy.jsx)("div",{className:"ng-textfield-button error-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"error"})}),L&&(0,Wy.jsx)("div",{className:"ng-textfield-button",id:`${this.componentId}-combobox-append`,children:u})]}),(0,Wy.jsx)("fieldset",{className:"ng-textfield-fieldset",children:(0,Wy.jsx)("legend",{className:"ng-textfield-legend",children:g&&(0,Wy.jsxs)("span",{children:[g,k?"*":""]})})}),(0,Wy.jsx)(Uk,{className:"position-fixed "+(r?"visible":"invisible"),id:`${this.componentId}-combobox-menu`,index:i,loading:y,onClick:this.handleOptionSelect,options:this.filteredOptions,primaryKey:S,renderOption:M,selected:s,selectedKey:a,style:{left:`${l}px`,top:`${c}px`,width:`${z}px`}})]}),g&&(0,Wy.jsxs)("label",{className:"ng-label-text",htmlFor:this.componentId,children:[g,k&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]}),(F||_)&&(0,Wy.jsxs)("div",{className:`ng-textfield-supporting-text-container body-small ${F?"supporting-text":""} ${_?"max-length":""}`,children:[F&&(0,Wy.jsx)("p",{className:"ng-textfield-supporting-text text-truncate m-0",title:F,children:F}),_&&(0,Wy.jsx)("p",{className:"m-0",children:`${o.length}/${_}`})]})]})}callback(){var e,t;null===(e=this.props)||void 0===e||null===(t=e.onChange)||void 0===t||t.call(e,this.state.selected,this.componentId),this.close()}clearSearch(){this.setState({search:"",optionIndex:this.initialOptionIndex,selectedIndex:-1},this.focus)}close(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{search:r,selected:i,selectedIndex:o}=this.state;r&&(null==e?void 0:e.currentTarget)!==document.getElementById(this.componentId)&&this.clearSearch(),this.setState({opened:!1,optionIndex:i?o:this.initialOptionIndex})}focus(){document.getElementById(this.componentId).focus()}getMenuPosition(){const e=document.getElementById(this.componentId),t=document.getElementById(`${this.componentId}-combobox-menu`),n=document.body;return Kk(e.getBoundingClientRect(),t.getBoundingClientRect(),n.getBoundingClientRect(),"bottom-right")}handleBlur(e){document.removeEventListener("keydown",this.handleKeyPress),e.currentTarget.parentNode.contains(e.relatedTarget)||(this.setState({focused:!1}),this.props.required&&!this.state.selected&&this.validate())}handleFocus(){document.addEventListener("keydown",this.handleKeyPress),this.setState({focused:!0})}handleKeyPress(e){const{opened:t,optionIndex:n,search:r}=this.state,{primaryKey:i,scrollLooping:o}=this.props,s=this.filteredOptions.length-1;if("Escape"===e.key)e.preventDefault(),t&&this.close();else if("Tab"===e.key)t&&this.close(e),r&&this.clearSearch();else if("Enter"===e.key){if(e.preventDefault(),t){const e=this.filteredOptions[n];e&&this.setState({selected:e,selectedIndex:n,selectedKey:e[i]},this.callback)}}else if("ArrowUp"===e.key)if(e.preventDefault(),t){const e=Math.max(n-1,0);this.setState({optionIndex:o&&0===n?s:e})}else this.open();else if("ArrowDown"===e.key)if(e.preventDefault(),t){const e=Math.min(n+1,s);this.setState({optionIndex:o&&n===s?0:e})}else this.open()}handleOptionSelect(e){var t,n,r,i;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const o=e.currentTarget.getAttribute("data-id"),s=parseInt(null===(r=e.currentTarget)||void 0===r||null===(i=r.getAttribute)||void 0===i?void 0:i.call(r,"data-index"));this.setState({selected:this.filteredOptions.find((e=>e[this.props.primaryKey]===o))||null,selectedIndex:qe().isNaN(s)?-1:s,selectedKey:o},(()=>{this.callback(),this.focus()}))}handleSearchChange(e){!this.state.opened&&this.open(),this.setState({search:e.currentTarget.value})}mousedownClose(e){var t;null!==(t=document.getElementById(`${this.componentId}-combobox-main-container`))&&void 0!==t&&t.contains(e.target)||this.close()}open(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{x:r,y:i}=this.getMenuPosition();this.setState({opened:!0,x:r,y:i})}validate(){this.state.selected?this.setState({invalid:!1}):this.setState({invalid:!0})}}MF.defaultProps={append:null,arrowButton:!0,autoFocus:!1,clearButton:!0,className:"",disabled:!1,isInitialIndexZero:!0,label:"",loading:!1,options:[],placeholder:"",prepend:null,primaryKey:"id",renderOption:function(e){return e.title||e.name||e.id||e.key},renderSelected:function(e){return(0,Wy.jsx)("div",{className:"ng-textfield",children:e.title||e.name||e.id||e.key})},required:!1,scrollBlur:!0,scrollLooping:!0,searchableKeys:["id"],size:"sm",style:{},supportingText:"",variant:"outlined"};class EF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("dropdown-"),this.initialOptionIndex=e.isInitialIndexZero?0:-1;const t=e.options.findIndex((t=>{var n;return t[e.primaryKey]===(null===(n=e.value)||void 0===n?void 0:n[e.primaryKey])}));this.state={focused:!1,invalid:!1,opened:!1,optionIndex:-1===t?this.initialOptionIndex:t,selected:e.value||null,selectedIndex:t,selectedKey:null,x:0,y:0},this.callback=this.callback.bind(this),this.close=this.close.bind(this),this.focus=this.focus.bind(this),this.getMenuPosition=this.getMenuPosition.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleOptionSelect=this.handleOptionSelect.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.open=this.open.bind(this),this.validate=this.validate.bind(this)}componentDidUpdate(e,t){const{options:n,primaryKey:r,required:i,scrollBlur:o,value:s}=this.props,{focused:a,opened:l,selected:c}=this.state;if(!t.opened&&l?(window.addEventListener("resize",this.close),document.addEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),o&&document.addEventListener("scroll",this.close)):t.opened&&!l&&(window.removeEventListener("resize",this.close),document.removeEventListener("mousedown",this.mousedownClose),document.removeEventListener("touchstart",this.mousedownClose),o&&document.removeEventListener("scroll",this.close)),!qe().isEqual(e.value,s)&&!qe().isEqual(c,s)){const e=n.findIndex((e=>e[r]===(null==s?void 0:s[r]))),t=-1===e?this.initialOptionIndex:e;this.setState({selected:s||null,selectedKey:s[r]||null,optionIndex:t,selectedIndex:e})}var u,h;if(!t.focused&&a)null===(u=this.props)||void 0===u||null===(h=u.onFocus)||void 0===h||h.call(u);else if(t.focused&&!a){var d,p;null===(d=this.props)||void 0===d||null===(p=d.onBlur)||void 0===p||p.call(d)}i&&!qe().isEqual(t.selected,c)&&this.validate()}render(){var e;const{focused:t,invalid:n,opened:r,optionIndex:i,selected:o,selectedKey:s,x:a,y:l}=this.state,{append:c,arrowButton:u,autoFocus:h,className:d,disabled:p,label:f,loading:m,errorText:g=`Not a valid ${null==f?void 0:f.toLowerCase()}`,options:y,placeholder:v,prepend:_,primaryKey:x,renderOption:b,renderSelected:w,required:S,size:M,style:E,supportingText:T,variant:C}=this.props,A=c&&!o,I=_&&!o||m,P=n&&!p,R=!t&&!r&&S&&!o,L=S?P?g:"*required":T||"",D=null===(e=document.getElementById(this.componentId))||void 0===e?void 0:e.offsetWidth;return(0,Wy.jsxs)("div",{className:`ng-textfield-main-container body-large ng-textfield-variant-${C} ng-textfield-size-${M} ${u?"arrow-button-visible":""} ${p?"disabled":""} ${P?"invalid":""} ${S?"required":""} ${t?"focused":""} ${r?"opened":""} ${o?"selected":""} ${A?"append-visible":""} ${I?"prepend-visible":""} ${d}`,id:`${this.componentId}-dropdown-main-container`,style:E,children:[(0,Wy.jsxs)("div",{className:"component-dropdown-inner-container ng-textfield-inner-container",children:[I&&(0,Wy.jsx)("span",{className:"ng-textfield-prepend",id:`${this.componentId}-dropdown-prepend`,children:m?(0,Wy.jsx)(Rk,{circular:!0,size:"1.5rem"}):_}),(0,Wy.jsx)("button",{autoFocus:h,className:"component-dropdown ng-textfield",disabled:p,id:this.componentId,onClick:r?this.close:this.open,onBlur:this.handleBlur,onFocus:this.handleFocus,type:"button",children:o?w(o):(0,Wy.jsx)("p",{className:"ng-placeholder "+(f?"":"ng-placeholder-visible"),children:v})}),(A||u||P)&&(0,Wy.jsx)("div",{className:"ng-textfield-append",children:(0,Wy.jsxs)(Wy.Fragment,{children:[u&&(0,Wy.jsx)("div",{className:"ng-textfield-button arrow-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:r?"arrow_drop_up":"arrow_drop_down"})}),P&&(0,Wy.jsx)("div",{className:"ng-textfield-button error-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"error"})}),A&&(0,Wy.jsx)("div",{className:"ng-textfield-button",id:`${this.componentId}-dropdown-append`,children:c})]})}),(0,Wy.jsx)("fieldset",{className:"ng-textfield-fieldset",children:(0,Wy.jsx)("legend",{className:"ng-textfield-legend",children:f&&(0,Wy.jsxs)("span",{children:[f,R?"*":""]})})}),(0,Wy.jsx)(Uk,{className:"position-fixed "+(r?"visible":"invisible"),id:`${this.componentId}-dropdown-menu`,index:i,loading:m,onClick:this.handleOptionSelect,options:y,primaryKey:x,renderOption:b,selected:o,selectedKey:s,style:{left:`${a}px`,top:`${l}px`,width:`${D}px`}})]}),f&&(0,Wy.jsxs)("label",{className:"ng-label-text",htmlFor:this.componentId,children:[f,R&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]}),L&&(0,Wy.jsx)("div",{className:"ng-textfield-supporting-text-container body-small "+(L?"supporting-text":""),children:L&&(0,Wy.jsx)("p",{className:"ng-textfield-supporting-text text-truncate m-0",title:L,children:L})})]})}callback(){var e,t;null===(e=this.props)||void 0===e||null===(t=e.onChange)||void 0===t||t.call(e,this.state.selected,this.componentId),this.close()}close(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e);const{selected:r,selectedIndex:i}=this.state;this.setState({opened:!1,optionIndex:r?i:this.initialOptionIndex})}focus(){document.getElementById(this.componentId).focus()}getMenuPosition(){const e=document.getElementById(this.componentId),t=document.getElementById(`${this.componentId}-dropdown-menu`),n=document.body;return Kk(e.getBoundingClientRect(),t.getBoundingClientRect(),n.getBoundingClientRect(),"bottom-right")}handleBlur(e){document.removeEventListener("keydown",this.handleKeyPress),e.currentTarget.parentNode.contains(e.relatedTarget)||(this.setState({focused:!1}),this.props.required&&!this.state.selected&&this.validate())}handleFocus(){document.addEventListener("keydown",this.handleKeyPress),this.setState({focused:!0})}handleKeyPress(e){const{opened:t,optionIndex:n}=this.state,{options:r,primaryKey:i,scrollLooping:o}=this.props,s=r.length-1;if("Escape"===e.key||"Tab"===e.key)t&&this.close(e);else if("Enter"===e.key)if(e.preventDefault(),t){const e=r[n];e&&this.setState({selected:e,selectedIndex:n,selectedKey:e[i]},this.callback)}else this.open();else if("ArrowUp"===e.key)if(e.preventDefault(),t){const e=Math.max(n-1,0);this.setState({optionIndex:o&&0===n?s:e})}else this.open();else if("ArrowDown"===e.key)if(e.preventDefault(),t){const e=Math.min(n+1,s);this.setState({optionIndex:o&&n===s?0:e})}else this.open()}handleOptionSelect(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{options:r,primaryKey:i}=this.props,o=e.currentTarget.getAttribute("data-id"),s=parseInt(e.currentTarget.getAttribute("data-index"));this.setState({selected:r.find((e=>e[i]===o))||null,selectedIndex:s,selectedKey:o},(()=>{this.callback(),this.focus()}))}mousedownClose(e){var t;null!==(t=document.getElementById(`${this.componentId}-dropdown-main-container`))&&void 0!==t&&t.contains(e.target)||this.close()}open(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{x:r,y:i}=this.getMenuPosition();this.setState({opened:!0,x:r,y:i})}validate(){this.state.selected?this.setState({invalid:!1}):this.setState({invalid:!0})}}EF.defaultProps={append:null,arrowButton:!0,autoFocus:!1,className:"",disabled:!1,isInitialIndexZero:!0,label:"",loading:!1,options:[],placeholder:"",prepend:null,primaryKey:"id",renderOption:function(e){return(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.title||e.name||e.id||e.key})},renderSelected:function(e){return(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.title||e.name||e.id||e.key})},required:!1,scrollBlur:!0,scrollLooping:!1,size:"sm",style:{},supportingText:"",variant:"outlined"};const TF={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let CF;const AF=new Uint8Array(16);function IF(){if(!CF&&(CF="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!CF))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return CF(AF)}const PF=[];for(let e=0;e<256;++e)PF.push((e+256).toString(16).slice(1));const RF=function(e,t,n){if(TF.randomUUID&&!t&&!e)return TF.randomUUID();const r=(e=e||{}).random||(e.rng||IF)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return PF[e[t+0]]+PF[e[t+1]]+PF[e[t+2]]+PF[e[t+3]]+"-"+PF[e[t+4]]+PF[e[t+5]]+"-"+PF[e[t+6]]+PF[e[t+7]]+"-"+PF[e[t+8]]+PF[e[t+9]]+"-"+PF[e[t+10]]+PF[e[t+11]]+PF[e[t+12]]+PF[e[t+13]]+PF[e[t+14]]+PF[e[t+15]]}(r)};Ye().extend(Je());const LF={bytes:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!e)return"N/A";if(0===e)return"0 B";const n=0>t?0:t,r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(n))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][r]},dateTime:function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"s";if("number"==typeof e){const n="ms"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ms")?e:1e3*e,r=Math.floor(n/864e5);return"m"===t?`${r} d ${Ye().utc(n).format("HH [h] mm [m]")}`:`${r} d ${Ye().utc(n).format("HH [h] mm [m] ss [s]")}`}return null},query:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"?";return e.length<4?{}:Object.fromEntries(e.replace("?","").split("&").map((e=>e.split("="))))},text:function(e){if(e){if(e.includes("_")||e.includes("-")){let t;e.includes("_")?t=e.split("_"):e.includes("-")&&(t=e.split("-"));for(let e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);return t.join(" ")}return(e.charAt(0).toUpperCase()+e.slice(1)).replace(/([A-Z])([A-Z])([a-z])|([a-z])([A-Z])/g,"$1$4 $2$3$5")}return null}},DF=LF,OF={eq:{key:"eq",name:"=="},ne:{key:"ne",name:"!="},lt:{key:"lt",name:"<"},le:{key:"le",name:"<="},gt:{key:"gt",name:">"},ge:{key:"ge",name:">="},contains:{key:"contains",name:"contains"},endswith:{key:"endswith",name:"ends with"},in:{key:"in",name:"in"},startswith:{key:"startswith",name:"starts with"}};function NF(e,t){return e.map((e=>`'${e[t]}'`)).join(", ")}function kF(e,t,n,r,i){let o=t?`${null==e?void 0:e.key}/${null==t?void 0:t.key}`:null==e?void 0:e.key;return(null==n?void 0:n.key)===OF.in.key?`${o} ${null==n?void 0:n.key} (${NF(r,i)})`:(null==n?void 0:n.key)===OF.contains.key||(null==n?void 0:n.key)===OF.endswith.key||(null==n?void 0:n.key)===OF.startswith.key?`${null==n?void 0:n.key}(${o}, '${r}')`:`${o} ${null==n?void 0:n.key} ${"number"==typeof r?r:`'${r}'`}`}function FF(e,t,n,r){return`${e?`${null==e?void 0:e.key} `:""}${null==t?void 0:t.name} ${Array.isArray(n)?NF(n,r):"number"==typeof n?n:`'${n}'`}`}function zF(e){return"text"===e.type?e.options.map((e=>({id:e}))):[]}class BF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("multidropdown-"),this.initialOptionIndex=e.isInitialIndexZero?0:-1;const t=e.options.findIndex((t=>{var n,r;return t[e.primaryKey]===(null===(n=e.value)||void 0===n||null===(r=n[e.value.length-1])||void 0===r?void 0:r[e.primaryKey])}));this.state={focused:!1,invalid:!1,opened:!1,optionIndex:-1===t?this.initialOptionIndex:t,selected:e.value||[],selectedIndex:t,selectedKey:null,x:0,y:0},this.callback=this.callback.bind(this),this.clearSelected=this.clearSelected.bind(this),this.close=this.close.bind(this),this.focus=this.focus.bind(this),this.getMenuPosition=this.getMenuPosition.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleOptionSelect=this.handleOptionSelect.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.open=this.open.bind(this),this.validate=this.validate.bind(this)}componentDidUpdate(e,t){const{options:n,primaryKey:r,required:i,scrollBlur:o,value:s}=this.props,{opened:a,selected:l}=this.state;if(!t.opened&&a?(window.addEventListener("resize",this.close),document.addEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),o&&document.addEventListener("scroll",this.close)):t.opened&&!a&&(window.removeEventListener("resize",this.close),document.removeEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),o&&document.removeEventListener("scroll",this.close)),!qe().isEqual(e.value,s)&&!qe().isEqual(l,s)){const e=n.findIndex((e=>{var t;return e[r]===(null==s||null===(t=s[s.length-1])||void 0===t?void 0:t[r])})),t=-1===e?this.initialOptionIndex:e;this.setState({selected:s||[],selectedKey:s[r]||null,optionIndex:t,selectedIndex:e})}i&&!qe().isEqual(t.selected,l)&&this.validate()}render(){var e;const{focused:t,invalid:n,opened:r,optionIndex:i,selected:o,selectedKey:s,x:a,y:l}=this.state,{append:c,arrowButton:u,autoFocus:h,className:d,clearButton:p,disabled:f,label:m,loading:g,errorText:y=`Not a valid ${null==m?void 0:m.toLowerCase()}`,options:v,placeholder:_,prepend:x,primaryKey:b,renderOption:w,renderSelected:S,required:M,size:E,style:T,supportingText:C,variant:A}=this.props;this.isSelected=o.length>0;const I=c&&!this.isSelected,P=x&&!this.isSelected||g,R=n&&!f,L=!t&&!r&&M&&!this.isSelected,D=M?R?y:"*required":C||"",O=null===(e=document.getElementById(this.componentId))||void 0===e?void 0:e.offsetWidth;return(0,Wy.jsxs)("div",{className:`ng-textfield-main-container body-large ng-textfield-variant-${A} ng-textfield-size-${E} ${u?"arrow-button-visible":""} ${f?"disabled":""} ${R?"invalid":""} ${M?"required":""} ${t?"focused":""} ${r?"opened":""} ${this.isSelected?"selected":""} ${I?"append-visible":""} ${P?"prepend-visible":""} ${d}`,id:`${this.componentId}-multidropdown-main-container`,style:T,children:[(0,Wy.jsxs)("div",{className:"component-multidropdown-inner-container ng-textfield-inner-container",children:[P&&(0,Wy.jsx)("span",{className:"ng-textfield-prepend",id:`${this.componentId}-multidropdown-prepend`,children:g?(0,Wy.jsx)(Rk,{circular:!0,size:"1.5rem"}):x}),(0,Wy.jsx)("button",{autoFocus:h,className:"component-multidropdown ng-textfield",disabled:f,id:this.componentId,onFocus:this.handleFocus,onBlur:this.handleBlur,onClick:r?this.close:this.open,type:"button",children:this.isSelected?S(o,v):(0,Wy.jsx)("p",{className:"ng-placeholder "+(m?"":"ng-placeholder-visible"),children:_})}),(I||u||R)&&(0,Wy.jsxs)("div",{className:"ng-textfield-append",children:[u&&(0,Wy.jsx)("div",{className:"ng-textfield-button arrow-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:r?"arrow_drop_up":"arrow_drop_down"})}),R&&(0,Wy.jsx)("div",{className:"ng-textfield-button error-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"error"})}),I&&(0,Wy.jsx)("div",{className:"ng-textfield-button",id:`${this.componentId}-multidropdown-append`,children:c})]}),(0,Wy.jsx)("fieldset",{className:"ng-textfield-fieldset",children:(0,Wy.jsx)("legend",{className:"ng-textfield-legend",children:m&&(0,Wy.jsxs)("span",{children:[m,L?"*":""]})})}),(0,Wy.jsx)(Uk,{className:"position-fixed "+(r?"visible":"invisible"),clearDisabled:!this.isSelected,id:`${this.componentId}-multidropdown-menu`,index:i,loading:g,multiple:!0,onClear:p?this.clearSelected:null,onClick:this.handleOptionSelect,options:v,primaryKey:b,renderOption:w,selected:o,selectedKey:s,style:{left:`${a}px`,top:`${l}px`,width:`${O}px`}})]}),m&&(0,Wy.jsxs)("label",{className:"ng-label-text",htmlFor:this.componentId,children:[m,L&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]}),D&&(0,Wy.jsx)("div",{className:"ng-textfield-supporting-text-container body-small "+(D?"supporting-text":""),children:D&&(0,Wy.jsx)("p",{className:"ng-textfield-supporting-text text-truncate m-0",title:D,children:D})})]})}callback(){var e,t;null===(e=this.props)||void 0===e||null===(t=e.onChange)||void 0===t||t.call(e,this.state.selected,this.componentId)}clearSelected(){this.setState({selected:[],optionIndex:this.initialOptionIndex,selectedIndex:-1},(()=>{this.callback(),this.focus()}))}close(e){if(null==e||!e.defaultPrevented){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e);const{selected:r}=this.state,{options:i,primaryKey:o}=this.props,s=i.findIndex((e=>{var t;return e[o]===(null==r||null===(t=r[r.length-1])||void 0===t?void 0:t[o])}));this.setState({opened:!1,optionIndex:-1===s?this.initialOptionIndex:s})}}focus(){document.getElementById(this.componentId).focus()}getMenuPosition(){const e=document.getElementById(this.componentId),t=document.getElementById(`${this.componentId}-multidropdown-menu`),n=document.body;return Kk(e.getBoundingClientRect(),t.getBoundingClientRect(),n.getBoundingClientRect(),"bottom-right")}handleBlur(e){document.removeEventListener("keydown",this.handleKeyPress),e.currentTarget.parentNode.contains(e.relatedTarget)||(this.setState({focused:!1}),this.props.required&&!this.isSelected&&this.validate())}handleFocus(){document.addEventListener("keydown",this.handleKeyPress),this.setState({focused:!0})}handleKeyPress(e){const{opened:t,optionIndex:n,selected:r}=this.state,{options:i,primaryKey:o,scrollLooping:s}=this.props,a=i.length-1;if("Escape"===e.key||"Tab"===e.key)t&&this.close(e);else if("Enter"===e.key)if(e.preventDefault(),t){const e=null==i?void 0:i[n][o],t=i.find((t=>t[o]===e))||null,s=r.map((e=>e[o])).includes(e)?r.filter((t=>t[o]!==e)):[...r,t];s&&this.setState({optionIndex:s.length?n:this.initialOptionIndex,selected:s,selectedIndex:n,selectedKey:e},this.callback)}else this.open();else if("ArrowUp"===e.key)if(e.preventDefault(),t){const e=Math.max(n-1,0);this.setState({optionIndex:s&&0===n?a:e})}else this.open();else if("ArrowDown"===e.key)if(e.preventDefault(),t){const e=Math.min(n+1,a);this.setState({optionIndex:s&&n===a?0:e})}else this.open()}handleOptionSelect(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{selected:r}=this.state,{options:i,primaryKey:o}=this.props,s=e.currentTarget.getAttribute("data-id"),a=parseInt(e.currentTarget.getAttribute("data-index")),l=i.find((e=>e[o]===s))||null,c=r.map((e=>e[o])).includes(s)?r.filter((e=>e[o]!==s)):[...r,l];this.setState({optionIndex:c.length?a:this.initialOptionIndex,selected:c,selectedIndex:a,selectedKey:s},(()=>{this.callback(),this.focus()}))}mousedownClose(e){var t;null!==(t=document.getElementById(`${this.componentId}-multidropdown-main-container`))&&void 0!==t&&t.contains(e.target)||this.close()}open(e){var t,n;null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e);const{x:r,y:i}=this.getMenuPosition();this.setState({opened:!0,x:r,y:i})}validate(){this.isSelected?this.setState({invalid:!1}):this.setState({invalid:!0})}}function UF(e){return null==e?"":e}BF.defaultProps={append:null,arrowButton:!0,autoFocus:!1,className:"",clearButton:!0,disabled:!1,isInitialIndexZero:!0,label:"",loading:!1,options:[],placeholder:"",prepend:null,primaryKey:"id",renderOption:function(e,t){return(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)(rF,{checked:t}),(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.title||e.name||e.value||e.id})]})},renderSelected:function(e){return(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.map((e=>e.title||e.name||e.value||e.id)).join(", ")})},required:!1,scrollBlur:!0,scrollLooping:!1,size:"sm",style:{},supportingText:"",variant:"outlined"};const jF=/^([A-Za-z0-9_\-.])+@([A-Za-z0-9_\-.])+\.([A-Za-z]{2,4})$/,VF=/^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/,GF="date",HF="datetime-local",ZF="password",WF="text",$F=(0,e.forwardRef)(((t,n)=>{var r,i;const{append:o,autoFocus:s,className:a,disabled:l,id:c=qe().uniqueId("textfield-"),label:u,errorText:h=`Not a valid ${null==u?void 0:u.toLowerCase()}`,max:d,min:p,maxLength:f,minLength:m,onKeyDown:g,placeholder:y,prepend:v,readOnly:_,required:x,size:b,step:w,style:S,supportingText:M,value:E,variant:T}=t,C=t.type===GF||t.type===HF,A="search"===t.type,I=t.type===ZF,[P,R]=(0,e.useState)(!1),[L,D]=(0,e.useState)(!1),[O,N]=(0,e.useState)(C?WF:t.type),[k,F]=(0,e.useState)(UF(E)),z=(0,e.useRef)(c).current,B=(0,e.useRef)(!1);(0,e.useEffect)((()=>F(UF(E))),[E]),(0,e.useEffect)((()=>{B.current?x&&$():B.current=!0}),[k]),(0,e.useEffect)((()=>{var e,n;P?null==t||null===(e=t.onFocus)||void 0===e||e.call(t,k):null==t||null===(n=t.onBlur)||void 0===n||n.call(t,k)}),[P]),(0,e.useEffect)((()=>{var e;null==t||null===(e=t.onInvalid)||void 0===e||e.call(t,L)}),[L]);const U=L&&!l,j=O===ZF,V=(null==k||null===(r=k.toString)||void 0===r||null===(i=r.call(k))||void 0===i?void 0:i.length)>0,G=!P&&x&&!V,H=C?GF:O,Z=x?U?h:"*required":M||"";return(0,Wy.jsxs)("div",{className:`ng-textfield-main-container body-large ng-textfield-type-${H} ng-textfield-variant-${T} ng-textfield-size-${b} ${l?"disabled":""} ${U?"invalid":""} ${x?"required":""} ${A?"clear-button-visible":""} ${I?"password-button-visible":""} ${o?"append-visible":""} ${v?"prepend-visible":""} ${P?"focused":""} ${V?"selected":""} ${a}`,id:`${z}-textfield-main-container`,style:S,children:[(0,Wy.jsxs)("div",{className:"component-textfield-inner-container ng-textfield-inner-container",children:[v&&(0,Wy.jsx)("span",{className:"ng-textfield-prepend",id:`${z}-textfield-prepend`,children:v}),(0,Wy.jsx)("input",{autoFocus:s,autoComplete:"off",className:"ng-textfield "+(u?"":"ng-placeholder-visible"),disabled:l,id:z,maxLength:f,minLength:m,max:d,min:p,onBlur:function(e){C&&(e.target.type=WF),R(!1),x&&$()},onChange:l?null:function(e){var n,r;let i=e.currentTarget.value;if("number"===t.type){const{max:e,min:n}=t;i=""===i?null:Number(i),i>e?i=e:i<n&&(i=n)}F(UF(null===(n=i)||void 0===n?void 0:n.toString())),null==t||null===(r=t.onChange)||void 0===r||r.call(t,i,z)},onClick:e=>e.stopPropagation(),onFocus:function(e){t.type===GF?e.target.type=GF:t.type===HF&&(e.target.type=HF),R(!0)},onKeyDown:g,placeholder:y,readOnly:_,ref:n,required:x,step:w,type:O,value:k}),(o||C||U||I||A&&V)&&(0,Wy.jsxs)("div",{className:"ng-textfield-append",children:[C&&(0,Wy.jsx)("div",{className:"ng-textfield-button calendar-button",id:`${z}-textfield-calendar-button`,onClick:l?null:function(){W(),document.getElementById(z).showPicker()},onMouseDown:e=>e.preventDefault(),onTouchStart:e=>e.preventDefault(),title:"Show calendar",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"today"})}),A&&V&&(0,Wy.jsx)("div",{className:"ng-textfield-button clear-button",id:`${z}-textfield-clear-button`,onClick:l?null:function(){var e;W(),F(""),null==t||null===(e=t.onClear)||void 0===e||e.call(t)},onMouseDown:e=>e.preventDefault(),onTouchStart:e=>e.preventDefault(),title:"Clear",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"cancel"})}),I&&(0,Wy.jsx)("div",{className:"ng-textfield-button clickable-button",id:`${z}-textfield-password-button`,onClick:l?null:function(){N(j?WF:ZF)},onMouseDown:e=>e.preventDefault(),onTouchStart:e=>e.preventDefault(),title:j?"Show password":"Hide password",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:j?"visibility_off":"visibility"})}),U&&(0,Wy.jsx)("div",{className:"ng-textfield-button error-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"error"})}),o&&(0,Wy.jsx)("div",{className:"ng-textfield-button",id:`${z}-textfield-append`,children:o})]}),(0,Wy.jsx)("fieldset",{className:"ng-textfield-fieldset",children:(0,Wy.jsx)("legend",{className:"ng-textfield-legend",children:u&&(0,Wy.jsxs)("span",{children:[u,G?"*":""]})})})]}),u&&(0,Wy.jsxs)("label",{className:"ng-label-text",htmlFor:z,children:[u,G&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]}),(Z||f)&&(0,Wy.jsxs)("div",{className:`ng-textfield-supporting-text-container body-small ${Z?"supporting-text":""} ${f?"max-length":""}`,children:[Z&&(0,Wy.jsx)("p",{className:"ng-textfield-supporting-text text-truncate m-0",title:Z,children:Z}),f&&(0,Wy.jsx)("p",{className:"m-0",children:`${k.length}/${f}`})]})]});function W(){P||document.getElementById(z).focus()}function $(){k.length<1||k.length<t.minLength?D(!0):C?new Date(k)>new Date(t.max)||new Date(k)<new Date(t.min)?D(!0):D(!1):"email"===t.type?k.match(jF)?D(!1):D(!0):"tel"===t.type?k.match(VF)?D(!1):D(!0):D(!1)}}));$F.defaultProps={append:null,autoFocus:!1,className:"",disabled:!1,label:"",onKeyDown:null,placeholder:"",prepend:null,readOnly:!1,required:!1,size:"sm",style:{},supportingText:"",type:WF,value:"",variant:"outlined"};class qF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("column-filter-"),this.state={rules:e.value||[]},this.handleDropdownChange=this.handleDropdownChange.bind(this)}componentDidUpdate(e,t){var n,r;qe().isEqual(t.rules,this.state.rules)||null===(n=this.props)||void 0===n||null===(r=n.onChange)||void 0===r||r.call(n,this.state.rules),qe().isEqual(e.value,this.props.value)||this.setState({rules:this.props.value})}render(){const{className:e,keys:t,variant:n}=this.props,{rules:r}=this.state,i=t.filter((e=>!qe().isEmpty(e.options))),o=r.filter((e=>{var t;return(null==e||null===(t=e.o)||void 0===t?void 0:t.key)===OF.in.key}));if(i.length>0)return(0,Wy.jsxs)(Wy.Fragment,{children:["table"!==n&&(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)("hr",{className:"ng-divider my-4"}),(0,Wy.jsx)("h6",{className:"title-medium mb-3",children:"Column filter"})]}),(0,Wy.jsx)("div",{className:`component-column-filter-container column-filter-${n} ${e}`,id:this.componentId,children:i.map(((e,t)=>{const n=o.find((t=>t.p.key===e.key)),r=(null==n?void 0:n.v)||[];return(0,Wy.jsx)(BF,{className:"column-filter-select",clearButton:!0,id:`${this.componentId}-column-filter-multidropdown-${e.key}`,label:e.name,onChange:t=>this.handleDropdownChange(e,t),options:zF(e),renderSelected:()=>function(e,t){const n=t.filter((t=>e.some((e=>e.id===t.id))));return 1===n.length?(0,Wy.jsx)("p",{className:"text-truncate m-0",children:n[0].id}):n.length>1?(0,Wy.jsx)("p",{className:"text-truncate m-0",children:`${n[0].id} (+${n.length-1})`}):void 0}(r,zF(e)),value:r},t)}))})]})}handleDropdownChange(e,t){const{primaryKey:n}=this.props,r=this.state.rules.filter((t=>t.p.key!==e.key||t.o.key!==OF.in.key));if(0===t.length)this.setState({rules:r});else{const i=function(e){let{p:t,l:n,op:r,o:i,v:o,primaryKey:s="id",id:a=RF()}=e;return n?{id:a,value:`${null==t?void 0:t.key}/${null==n?void 0:n.key}(s:${kF({key:"s"},r,i,o)})`,p:t,l:n,op:r,o:i,v:o,valid:(null==t?void 0:t.key)&&(null==n?void 0:n.key)&&(null==i?void 0:i.key)&&o,str:`${null==n?void 0:n.name} has ${FF(r,i,o,s)}`}:{id:a,value:kF(t,r,i,o,s),p:t,op:r,o:i,v:o,valid:(null==t?void 0:t.key)&&(null==i?void 0:i.key)&&o,str:FF(""===r?null:r,i,o,s)}}({p:e,o:OF.in,v:t,primaryKey:n});this.setState({rules:[...r,i]})}}}qF.defaultProps={className:"",variant:""};class XF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("multicombobox-"),this.initialOptionIndex=e.isInitialIndexZero?0:-1,this.state={focused:!1,invalid:!1,newOptions:[],opened:!1,optionIndex:this.initialOptionIndex,search:"",selected:e.value||[],selectedKey:null,x:0,y:0},this.callback=this.callback.bind(this),this.clearSearch=this.clearSearch.bind(this),this.clearSelected=this.clearSelected.bind(this),this.close=this.close.bind(this),this.defaultRenderOption=this.defaultRenderOption.bind(this),this.defaultRenderSelected=this.defaultRenderSelected.bind(this),this.focusInput=this.focusInput.bind(this),this.getMenuPosition=this.getMenuPosition.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleClear=this.handleClear.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleOptionSelect=this.handleOptionSelect.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.open=this.open.bind(this),this.validate=this.validate.bind(this)}componentDidUpdate(e,t){const{primaryKey:n,required:r,scrollBlur:i,value:o}=this.props,{opened:s,search:a,selected:l}=this.state;if(!t.opened&&s?(window.addEventListener("resize",this.close),document.addEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),i&&document.addEventListener("scroll",this.close)):t.opened&&!s&&(window.removeEventListener("resize",this.close),document.removeEventListener("mousedown",this.mousedownClose),document.addEventListener("touchstart",this.mousedownClose),i&&document.removeEventListener("scroll",this.close)),!qe().isEqual(e.value,o)&&!qe().isEqual(l,o)){const e=this.filteredOptions.findIndex((e=>e[n]===(null==o?void 0:o[n])));this.setState({selected:o||[],selectedKey:o[n]||null,optionIndex:e})}if(r&&!qe().isEqual(t.selected,l)&&this.validate(),t.search!==a){var c,u;const{x:e,y:t}=this.getMenuPosition();this.setState({x:e,y:t}),null===(c=this.props)||void 0===c||null===(u=c.onSearch)||void 0===u||u.call(c,a)}}render(){var e;const{focused:t,invalid:n,newOptions:r,opened:i,optionIndex:o,search:s,selected:a,selectedKey:l,x:c,y:u}=this.state,{allowNewOptions:h,append:d,arrowButton:p,clearButton:f,className:m,disabled:g,label:y,loading:v,errorText:_=`Not a valid ${null==y?void 0:y.toLowerCase()}`,maxLength:x,options:b,placeholder:w,prepend:S,primaryKey:M,renderOption:E,renderSelected:T,renderStatic:C,required:A,searchableKeys:I,size:P,style:R,supportingText:L,variant:D}=this.props,O=[...b,...r];this.filteredOptions=O.filter((e=>!a.map((e=>e[M])).includes(e[M]))).filter((e=>I.reduce(((t,n)=>t||SF(e[n]||"").includes(SF(s))),!1))),this.isSelected=a.length>0;const N=d&&!this.isSelected,k=S&&!this.isSelected||v,F=f&&(s||this.isSelected),z=n&&!g,B=!t&&!i&&A&&!this.isSelected,U=A?z?_:"*required":L||"",j=null===(e=document.getElementById(this.componentId))||void 0===e?void 0:e.offsetWidth;return h&&s.length>0&&!O.map((e=>e[M])).includes(s)&&this.filteredOptions.push(Object.fromEntries(Object.keys(b[0]).map((e=>[e,s])))),(0,Wy.jsxs)("div",{className:`ng-textfield-main-container body-large ng-textfield-variant-${D} ng-textfield-size-${P} ${p?"arrow-button-visible":""} ${g?"disabled":""} ${z?"invalid":""} ${A?"required":""} ${F?"clear-button-visible":""} ${t?"focused":""} ${i?"opened":""} ${this.isSelected?"selected":""} ${N?"append-visible":""} ${k?"prepend-visible":""} ${C?"render-static":""} ${m}`,id:`${this.componentId}-multicombobox-main-container`,style:R,children:[(0,Wy.jsxs)("div",{className:"component-multicombobox-inner-container ng-textfield-inner-container",id:this.componentId,onBlur:this.handleBlur,onClick:g?null:i?this.close:this.open,onFocus:this.handleFocus,tabIndex:-1,children:[k&&(0,Wy.jsx)("span",{className:"ng-textfield-prepend",id:`${this.componentId}-multicombobox-prepend`,children:v?(0,Wy.jsx)(Rk,{circular:!0,size:"1.5rem"}):S}),!C&&(null==a?void 0:a.map(T||this.defaultRenderSelected)),null==C?void 0:C(),!g&&(0,Wy.jsx)("input",{autoComplete:"off",className:"component-multicombobox ng-textfield",disabled:g,id:`${this.componentId}-search-input`,maxLength:x,onChange:this.handleSearchChange,placeholder:w,type:"search",value:s}),(N||p||f||z)&&(0,Wy.jsxs)("div",{className:"ng-textfield-append",children:[F&&(0,Wy.jsx)("button",{className:"ng-textfield-button clear-button",id:`${this.componentId}-multicombobox-clear-button`,onClick:this.handleClear,tabIndex:-1,title:"Clear",type:"button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"cancel"})}),p&&(0,Wy.jsx)("div",{className:"ng-textfield-button arrow-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:i?"arrow_drop_up":"arrow_drop_down"})}),z&&(0,Wy.jsx)("div",{className:"ng-textfield-button error-button",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"error"})}),N&&(0,Wy.jsx)("div",{className:"ng-textfield-button",id:`${this.componentId}-multicombobox-append`,children:d})]}),(0,Wy.jsx)("fieldset",{className:"ng-textfield-fieldset",children:(0,Wy.jsx)("legend",{className:"ng-textfield-legend",children:y&&(0,Wy.jsxs)("span",{children:[y,B?"*":""]})})}),(0,Wy.jsx)(Uk,{className:"position-fixed "+(i?"visible":"invisible"),filtered:!0,id:`${this.componentId}-multicombobox-menu`,index:o,loading:v,multiple:!0,onClick:this.handleOptionSelect,options:this.filteredOptions,primaryKey:M,renderOption:E||this.defaultRenderOption,selected:a,selectedKey:l,style:{left:`${c}px`,top:`${u}px`,width:`${j}px`}})]}),y&&(0,Wy.jsxs)("label",{className:"ng-label-text",htmlFor:`${this.componentId}-search-input`,children:[y,B&&(0,Wy.jsx)("span",{className:"error-text",children:"*"})]}),(U||x)&&(0,Wy.jsxs)("div",{className:`ng-textfield-supporting-text-container body-small ${U?"supporting-text":""} ${x?"max-length":""}`,children:[U&&(0,Wy.jsx)("p",{className:"ng-textfield-supporting-text text-truncate m-0",title:U,children:U}),x&&(0,Wy.jsx)("p",{className:"m-0",children:`${s.length}/${x}`})]})]})}callback(){var e,t;null===(e=this.props)||void 0===e||null===(t=e.onChange)||void 0===t||t.call(e,this.state.selected,this.componentId)}clearSearch(){this.setState({search:""},this.focusInput)}clearSelected(){this.setState({selected:[],optionIndex:this.initialOptionIndex,selectedKey:null},(()=>{this.callback(),this.focusInput()}))}close(e){var t,n;null!=e&&e.defaultPrevented||(null==e||null===(t=e.preventDefault)||void 0===t||t.call(e),null==e||null===(n=e.stopPropagation)||void 0===n||n.call(e),null!=e&&e.currentTarget||this.clearSearch(),this.setState({opened:!1,optionIndex:this.initialOptionIndex}))}defaultRenderOption(e){return(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.title||e.name||e[this.props.primaryKey]})}defaultRenderSelected(e,t,n,r){const{primaryKey:i}=this.props;return(0,Wy.jsx)(iF,{avatar:{enabled:!1},closable:!r,disabled:r,id:`${this.componentId}-chip-option-${e[i]}`,onClose:()=>this.setState({selected:n.filter((t=>t[i]!==e[i])),selectedKey:e[i]}),title:e.title||e.name||e[i]},e[i])}focusInput(){document.getElementById(`${this.componentId}-search-input`).focus()}getMenuPosition(){const e=document.getElementById(this.componentId),t=document.getElementById(`${this.componentId}-multicombobox-menu`),n=document.body;return Kk(e.getBoundingClientRect(),t.getBoundingClientRect(),n.getBoundingClientRect(),"bottom-right")}handleBlur(e){document.removeEventListener("keydown",this.handleKeyPress),e.currentTarget.contains(e.relatedTarget)||(this.setState({focused:!1}),this.props.required&&!this.isSelected&&this.validate())}handleClear(e){e.stopPropagation(),this.state.search?this.clearSearch():this.isSelected&&(window.confirm("Clear all selected items?")?this.clearSelected():this.focusInput())}handleFocus(){document.addEventListener("keydown",this.handleKeyPress),this.setState({focused:!0},this.focusInput)}handleKeyPress(e){const{newOptions:t,opened:n,optionIndex:r,search:i,selected:o}=this.state,{options:s,primaryKey:a,scrollLooping:l}=this.props,c=this.filteredOptions.length-1;if("Escape"===e.key||"Tab"===e.key)n&&this.close(e),i&&this.clearSearch();else if("Enter"===e.key){if(e.preventDefault(),n){const e=this.filteredOptions[r];e&&this.setState({newOptions:[...s,...t].map((e=>e[a])).includes(e[a])?t:[...t,e],selected:[...o,e],selectedKey:e[a]},(()=>{this.callback(),this.close()}))}}else if("ArrowUp"===e.key)if(e.preventDefault(),n){const e=Math.max(r-1,0);this.setState({optionIndex:l&&0===r?c:e})}else this.open();else if("ArrowDown"===e.key)if(e.preventDefault(),n){const e=Math.min(r+1,c);this.setState({optionIndex:l&&r===c?0:e})}else this.open()}handleOptionSelect(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{options:r,primaryKey:i}=this.props,{newOptions:o,selected:s}=this.state,a=e.currentTarget.getAttribute("data-id"),l=this.filteredOptions.find((e=>e[i]===a))||null;this.setState({newOptions:[...r,...o].map((e=>e[i])).includes(a)?o:[...o,l],selected:[...s,l],selectedKey:a},(()=>{this.callback(),this.close()}))}handleSearchChange(e){!this.state.opened&&this.open(),this.setState({search:e.currentTarget.value})}mousedownClose(e){var t;null!==(t=document.getElementById(`${this.componentId}-multicombobox-main-container`))&&void 0!==t&&t.contains(e.target)||this.close()}open(e){var t,n;null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==e||null===(n=e.preventDefault)||void 0===n||n.call(e);const{x:r,y:i}=this.getMenuPosition();this.setState({opened:!0,x:r,y:i})}validate(){this.isSelected?this.setState({invalid:!1}):this.setState({invalid:!0})}}XF.defaultProps={allowNewOptions:!1,append:null,arrowButton:!0,clearButton:!0,className:"",disabled:!1,isInitialIndexZero:!0,label:"",loading:!1,options:[],placeholder:"",prepend:null,primaryKey:"id",renderStatic:null,required:!1,scrollBlur:!0,scrollLooping:!0,searchableKeys:["id"],size:"sm",style:{},supportingText:"",variant:"outlined"};const YF={opened:!1,x:0,y:0};class KF extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("popover-"),this.state=YF,this.close=this.close.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.mousedownClose=this.mousedownClose.bind(this),this.toggle=this.toggle.bind(this)}componentDidUpdate(e,t){const{clickBlur:n}=this.props;!t.opened&&this.state.opened?(window.addEventListener("resize",this.close),document.addEventListener("keydown",this.handleKeyPress),n&&document.addEventListener("mousedown",this.mousedownClose)):t.opened&&!this.state.opened&&(window.removeEventListener("resize",this.close),document.removeEventListener("keydown",this.handleKeyPress),n&&document.removeEventListener("mousedown",this.mousedownClose))}render(){var t;const{className:n,children:r,onMouseDown:i,style:o,trigger:s}=this.props,{opened:a,x:l,y:c}=this.state,u=(null==s||null===(t=s.props)||void 0===t?void 0:t.className)||"",h=s&&(0,e.cloneElement)(s,{className:`${u} ${a?"active":""}`,id:`${this.componentId}-popover-trigger`,selected:a,onClick:this.toggle});return(0,Wy.jsxs)("div",{id:`${this.componentId}-popover-main-container`,children:[h,(0,Wy.jsx)("div",{className:`component-popover-content-container ${a?"visible":"invisible"} ${n}`,id:this.componentId,onMouseDown:i,ref:e=>this.popoverContentRef=e,style:{...o,left:`${l}px`,top:`${c}px`},children:r})]})}close(){this.setState(YF)}handleKeyPress(e){"Escape"===e.key&&this.close()}mousedownClose(e){var t;null!==(t=document.getElementById(`${this.componentId}-popover-main-container`))&&void 0!==t&&t.contains(e.target)||this.close()}toggle(e){if(e.stopPropagation(),this.state.opened)this.close();else{const t=e.currentTarget,n=document.body,r=t.getBoundingClientRect(),i=this.popoverContentRef.getBoundingClientRect(),o=n.getBoundingClientRect(),{x:s,y:a}=Kk(r,i,o,this.props.position);this.setState({opened:!0,x:s,y:a})}}}KF.defaultProps={children:null,className:"",clickBlur:!0,onMouseDown:null,position:"bottom-left",style:{},trigger:null};const JF="Escape";Math.min,Math.max,Math.round,Math.floor,"undefined"!=typeof document?e.useLayoutEffect:e.useEffect;fP("Popup",["root","open"]);const QF="horizontal";class ez extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("resizer-"),this.resizableElementId=e.resizableElementId||"",this.size=e.size||24,this.state={dragging:!1,touching:!1,position:0},this.calcPosition=this.calcPosition.bind(this),this.setDragOn=this.setDragOn.bind(this),this.setDragOff=this.setDragOff.bind(this),this.setTouchOn=this.setTouchOn.bind(this),this.setTouchOff=this.setTouchOff.bind(this),this.resize=this.resize.bind(this),this.touchResize=this.touchResize.bind(this),this.setParentSize=this.setParentSize.bind(this)}componentDidMount(){const e=document.getElementById(this.resizableElementId),{bottom:t,left:n,right:r,top:i}=e.parentNode.getBoundingClientRect();if(this.props.orient===QF){const t=e.offsetWidth;e.style.minWidth=t,e.style.maxWidth=t,this.max=this.props.max||r,this.min=this.props.min||n,this.setState({position:t-this.size/2})}else{const n=e.offsetHeight;e.style.minHeight=n,e.style.maxHeight=n,this.max=this.props.max||i,this.min=this.props.min||t,this.setState({position:n-this.size/2})}}componentDidUpdate(e,t){!t.dragging&&this.state.dragging?(document.body.style.userSelect="none",document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.setDragOff)):t.dragging&&!this.state.dragging&&(document.body.style.userSelect="auto",document.removeEventListener("mousemove",this.resize),document.removeEventListener("mouseup",this.setDragOff),this.setParentSize()),!t.touching&&this.state.touching?(document.body.style.userSelect="none",document.addEventListener("touchmove",this.touchResize),document.addEventListener("touchend",this.setTouchOff),document.addEventListener("touchcancel",this.setTouchOff)):t.touching&&!this.state.touching&&(document.body.style.userSelect="auto",document.removeEventListener("touchmove",this.touchResize),document.removeEventListener("touchend",this.setTouchOff),document.removeEventListener("touchcancel",this.setTouchOff),this.setParentSize())}render(){const{orient:e}=this.props,t=e===QF?{left:`${this.state.position}px`,width:`${this.size}px`}:{top:`${this.state.position}px`,height:`${this.size}px`};return(0,Wy.jsx)("div",{className:"component-resizer-container "+(e===QF?"horizontal":"vertical"),id:this.componentId,onMouseDown:this.setDragOn,onTouchStart:this.setTouchOn,style:t,children:(0,Wy.jsx)("div",{className:"component-resizer-divider"})})}calcPosition(e,t){const{bottom:n,height:r,left:i,right:o,top:s,width:a}=document.getElementById(this.resizableElementId).parentNode.getBoundingClientRect();let l,c,u;return this.props.orient===QF?(l=o-this.max,c=e-i-this.size/2,u=a):(l=n-this.max,c=t-s-this.size/2,u=r),c>this.min&&c<this.max?c:c<this.min&&c>this.min/2?this.min:c>this.max&&c<this.max+l/2?this.max:c>=this.max+l/2?u-this.size/2:c<=this.min/2?-this.size/2:this.props.orient===QF?Math.max(i,Math.min(o,e))-i-this.size/2:Math.max(s,Math.min(n,t))-s-this.size/2}setDragOn(){this.setState({dragging:!0})}setDragOff(e){this.setState({dragging:!1,position:this.calcPosition(e.clientX,e.clientY)})}setTouchOn(){this.setState({touching:!0})}setTouchOff(e){this.setState({touching:!1,position:this.calcPosition(e.changedTouches[0].clientX,e.changedTouches[0].clientY)})}resize(e){this.setState({position:this.calcPosition(e.clientX,e.clientY)})}touchResize(e){this.setState({position:this.calcPosition(e.touches[0].clientX,e.touches[0].clientY)})}setParentSize(){const e=document.getElementById(this.resizableElementId),t=`${this.state.position+this.size/2}px`;this.props.orient===QF?(e.style.minWidth=t,e.style.maxWidth=t,e.style.width=t):(e.style.minHeight=t,e.style.maxHeight=t,e.style.height=t)}}ez.defaultProps={orient:QF};class tz extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("split-button-"),this.state={opened:!1,optionIndex:0},this.menuOptions=Array.prototype.slice.call(e.children),this.defaultOption=this.menuOptions.shift(),this.handleBlur=this.handleBlur.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.close=this.close.bind(this),this.open=this.open.bind(this),this.handleOptionSelect=this.handleOptionSelect.bind(this)}componentDidUpdate(e,t){!t.opened&&this.state.opened?document.addEventListener("click",this.close):t.opened&&!this.state.opened&&document.removeEventListener("click",this.close)}render(){const{color:t,disabled:n,renderOption:r,size:i,variant:o}=this.props,{optionIndex:s}=this.state,a=(0,e.cloneElement)(this.defaultOption,{color:this.defaultOption.props.color||t,disabled:this.defaultOption.props.disabled||n,id:`${this.componentId}-split-button-main-button`,size:this.defaultOption.props.size||i,variant:this.defaultOption.props.variant||o});return(0,Wy.jsx)("div",{className:`ng-textfield-main-container body-large ng-textfield-size-${i} ${n?"disabled":""}`,id:this.componentId,children:(0,Wy.jsxs)(nF,{children:[a,(0,Wy.jsxs)(Qk,{id:`${this.componentId}-split-button-menu-button`,onSelect:this.handleOptionSelect,children:[(0,Wy.jsx)(eF,{color:a.props.color,disabled:n,onFocus:this.handleFocus,onBlur:this.handleBlur,size:a.props.size,variant:a.props.variant,children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"arrow_drop_down"})}),(0,Wy.jsx)(Uk,{className:"menu-list-w-fit-content",index:s,options:this.menuOptions,renderOption:r})]})]})})}handleBlur(){document.removeEventListener("keydown",this.handleKeyPress)}handleFocus(){document.addEventListener("keydown",this.handleKeyPress)}handleKeyPress(e){const{opened:t,optionIndex:n}=this.state;"Escape"===e.key||"Tab"===e.key?t&&this.close():"Enter"===e.key?this.handleOptionSelect(null,n):"ArrowUp"===e.key?(e.preventDefault(),t?this.setState({optionIndex:Math.max(n-1,0)}):this.open()):"ArrowDown"===e.key&&(e.preventDefault(),t?this.setState({optionIndex:Math.min(n+1,this.menuOptions.length-1)}):this.open())}open(){this.setState({opened:!0})}close(){this.setState({opened:!1})}handleOptionSelect(e,t){var n,r,i;null===(n=this.menuOptions[parseInt(t)])||void 0===n||null===(r=n.props)||void 0===r||null===(i=r.onClick)||void 0===i||i.call(r),this.close()}}tz.defaultProps={color:"primary",disabled:!1,renderOption:function(e){return(0,Wy.jsx)("p",{className:"text-truncate m-0",children:e.props.children})},size:"md",variant:"filled"};const nz="primary";function rz(t){const{className:n,closable:r,disabled:i,htmlTitle:o,icon:s,id:a,onClick:l,onClose:c,selected:u,style:h,title:d,twoRows:p,variant:f,visible:m,width:g,widthClosable:y}=t,v=Ak(g),_=Ak(y),x=(0,e.useRef)(null),b=(0,e.useRef)(null);return(0,e.useEffect)((()=>{var e;x.current&&(x.current.style.setProperty("--tab-width",v),r&&x.current.style.setProperty("--tab-width",_)),null!==b.current&&((e=b.current).scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth?b.current.classList.add("is-overflow"):b.current.classList.remove("is-overflow"))}),[]),m?(0,Wy.jsxs)("li",{className:`tab-component tab-variant-${f} ${r?"closable":""} ${i?"disabled":""} ${u?"selected":""} ${p?"two-rows":""} ${n}`,"data-id":a,id:a,onClick:i?null:l,onKeyDown:i?null:function(e){"Enter"!==e.key&&"Space"!==e.code||e.currentTarget.click()},ref:x,style:h,tabIndex:i?-1:0,children:[(0,Wy.jsx)("div",{className:"tab-content",children:(0,Wy.jsxs)("div",{className:"tab-text-container",children:[s&&(0,Wy.jsx)("div",{className:"tab-icon",children:s}),d&&(0,Wy.jsx)("div",{className:"tab-title title-small",ref:b,title:o||d,children:d}),f===nz&&u&&(0,Wy.jsx)("div",{className:"tab-indicator"})]})}),"secondary"===f&&u&&(0,Wy.jsx)("div",{className:"tab-indicator"}),r&&(0,Wy.jsx)(Ok,{className:"tab-close-button","data-id":a,id:`${a}-tab-close-button`,onClick:function(e){e.stopPropagation(),null==c||c(e)},size:"sm",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"close"})})]}):null}function iz(t){const{className:n,count:r,data:i,density:o,filter:s,heading:a,id:l=qe().uniqueId("table-"),loading:c,onClick:u,onPageNext:h,onPagePrev:d,onSelect:p,onSort:f,orderby:m,page:g,perPage:y,primaryKey:v,selectable:_,style:x,tableStyle:b,toolbarButton:w}=t,[S,M]=(0,e.useState)(0),[E,T]=(0,e.useState)(t.selected||[]);(0,e.useEffect)((()=>{Array.isArray(t.selected)&&!qe().isEqual(t.selected,E)&&T(t.selected)}),[t.selected]),(0,e.useEffect)((()=>null==p?void 0:p(E)),[p,E]);const C=(0,e.useRef)(l).current,A=(g-1)*y+(r?1:0),I=g*y,P=Math.ceil(r/y),R=qe().sumBy(a,(e=>e.proportion||1)),L=!u;function D(e){var t,n;const r=Math.floor(null==e||null===(t=e[0])||void 0===t||null===(n=t.target)||void 0===n?void 0:n.getBoundingClientRect().width);r&&M(_?(r-50)/R:r/R)}function O(e,t){T(e?qe().uniq([...E,t]):E.filter((e=>e!==t)))}return(0,Wy.jsxs)("div",{className:`component-table-container body-medium row-density-${o} ${L?"passive-table":""} ${n}`,id:`${C}-table-container`,ref:function(e){e&&new ResizeObserver(D).observe(e)},style:x,children:[(0,Wy.jsxs)("div",{className:"component-table-toolbar",id:`${C}-table-toolbar`,children:[w,(0,Wy.jsxs)("div",{className:"align-items-center d-flex flex-grow-1 justify-content-end",children:[(0,Wy.jsxs)("p",{className:"m-0 text-truncate",children:[A,"",I>r?r:I," of ",r]}),(0,Wy.jsxs)("div",{className:"component-table-pagination-actions",children:[(0,Wy.jsx)(Ok,{color:null,disabled:g<=1,id:`${C}-prev-page-button`,onClick:d,title:"Go to previous page",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined font-size-20",children:"navigate_before"})}),(0,Wy.jsx)(Ok,{color:null,disabled:g>=P,id:`${C}-next-page-button`,onClick:h,title:"Go to next page",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined font-size-20",children:"navigate_next"})})]})]})]}),(0,Wy.jsxs)("div",{className:"component-table-scroll-x-container",children:[(0,Wy.jsx)(Rk,{className:"table-progress "+(c?"visible":"invisible")}),(0,Wy.jsxs)("table",{className:qe().isEmpty(i)?"table-min-height":"",id:`${C}-table-element`,style:b,children:[(0,Wy.jsx)("thead",{children:(0,Wy.jsxs)("tr",{children:[_&&(0,Wy.jsx)("th",{className:"checkbox-column",style:{width:"50px"},children:(0,Wy.jsx)("div",{className:"d-flex align-item-center justify-content-center",children:(0,Wy.jsx)(rF,{checked:(null==i?void 0:i.length)>0&&(null==E?void 0:E.length)===(null==i?void 0:i.length),id:`${C}-select-all-checkbox`,indeterminate:(null==E?void 0:E.length)>0,className:"p-0",onChange:function(e){T(e?i.map((e=>e[v])):[])},title:"Select"})})}),a.map(((e,t)=>{const n=s.find((t=>t.p.key===e.key)),r=m.find((t=>t.column===e.key)),i=(e.proportion||1)*S+"px";return(0,Wy.jsx)("th",{className:e.sortable?"header-sortable":"","data-key":e.key,id:`${C}-table-header-${t}`,onClick:e.sortable?f:null,style:{maxWidth:i,minWidth:i},children:(0,Wy.jsxs)("div",{className:"align-items-center d-flex",children:[(0,Wy.jsx)("p",{className:"m-0 text-truncate",children:e.name||e.key}),(0,Wy.jsx)(Ok,{className:"header-icon sort-icon "+(r?"icon-visible":"icon-invisible"),disabled:!r,id:`${C}-header-sort-icon-${t}`,size:"sm",title:"Sort",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined "+("asc"===(null==r?void 0:r.order)?"":"rotate-180"),children:"straight"})}),(0,Wy.jsx)(Ok,{className:"header-icon filter-icon "+(n?"icon-visible visible":"icon-invisible invisible"),disabled:!0,id:`${C}-header-filter-icon-${t}`,size:"sm",title:"Active filter",variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"filter_alt"})})]})},t)}))]})}),(0,Wy.jsx)("tbody",{children:qe().isEmpty(i)?(0,Wy.jsx)("tr",{}):i.map(((e,t)=>{const n=e[v],r=E.includes(n);return(0,Wy.jsxs)("tr",{className:`${u?"cursor-pointer":""} ${r?"selected-row":""}`,id:`${C}-table-row-${t}`,onClick:()=>null==u?void 0:u(e),children:[_&&(0,Wy.jsx)("td",{className:"checkbox-column",children:(0,Wy.jsx)("div",{className:"d-flex align-item-center justify-content-center",children:(0,Wy.jsx)(rF,{checked:r,className:"p-0",id:n,onChange:O,title:"Select"})})}),a.map(((n,r)=>{const i=(n.proportion||1)*S+"px",o=n.key?qe().get(e,n.key):e,s=n.format?n.format(e,t):o;return(0,Wy.jsx)("td",{className:"text-truncate",style:{maxWidth:i,minWidth:i},children:s},r)}))]},t)}))})]})]})]})}rz.defaultProps={className:"",closable:!1,disabled:!1,htmlTitle:null,icon:null,onClick:null,onClose:null,selected:!1,style:{},title:null,twoRows:!1,variant:nz,visible:!0},iz.defaultProps={className:"",density:0,filter:[],heading:[],loading:!1,onClick:null,onPageNext:null,onPagePrev:null,onSelect:null,onSort:null,orderby:[],perPage:10,selectable:!1,style:{},tableStyle:{},toolbarButton:null};class oz extends e.PureComponent{constructor(e){super(e),this.state={count:e.data.length,data:e.data,filter:[...e.filter||[]],loading:!1,orderby:[...e.orderby||[]],page:1},this.nextPage=this.nextPage.bind(this),this.prevPage=this.prevPage.bind(this),this.sortBy=this.sortBy.bind(this),this.setData=this.setData.bind(this)}componentDidMount(){this.setData()}componentDidUpdate(e,t){var n,r;qe().isEqual(e.orderby,this.props.orderby)||this.setState({orderby:[...this.props.orderby||[]]}),qe().isEqual(t.orderby,this.state.orderby)||(null===(n=this.props)||void 0===n||null===(r=n.onOrderChange)||void 0===r||r.call(n,[...this.state.orderby]),this.setData()),qe().isEqual(e.filter,this.props.filter)||(1===this.state.page?this.setState({filter:this.props.filter},this.setData):this.setState({filter:this.props.filter,page:1},this.setData)),qe().isEqual(e.data,this.props.data)||this.setData()}render(){return(0,Wy.jsx)(iz,{...this.props,...this.state,onPageNext:this.nextPage,onPagePrev:this.prevPage,onSort:this.sortBy})}setData(){const e=this.props.data.length,t=(this.state.page-1)*this.props.perPage,n=Math.min(t+this.props.perPage,e),r=qe().slice(qe().orderBy(this.props.data,this.state.orderby.map((e=>e.column)),this.state.orderby.map((e=>e.order))),t,n);this.setState({count:e,data:r})}nextPage(){this.setState({page:this.state.page+1},this.setData)}prevPage(){this.setState({page:this.state.page-1},this.setData)}sortBy(e){var t;const n=e.currentTarget.getAttribute("data-key"),{orderby:r}=this.state,i=r.findIndex((e=>e.column===n));let o="asc";"asc"===(null==r||null===(t=r[i])||void 0===t?void 0:t.order)&&(o="desc"),this.setState({orderby:[{index:0,column:n,order:o,value:`${n} ${o}`}]})}}oz.defaultProps={perPage:10};class sz extends e.PureComponent{constructor(e){super(e),this.componentId=e.id||qe().uniqueId("tab-navigation-"),this.state={delta:0,isDown:!1,maxScroll:0,scrollLeft:0},this.calculateScroll=this.calculateScroll.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleWheel=this.handleWheel.bind(this),this.registerScrollContainer=this.registerScrollContainer.bind(this),this.scrollOnClick=this.scrollOnClick.bind(this)}componentDidUpdate(e){e.tabs!==this.props.tabs&&this.calculateScroll()}render(){const{append:t,className:n,onTabClose:r,onTabSelect:i,prepend:o,style:s,tabs:a,twoRows:l,variant:c,width:u,widthClosable:h}=this.props,{delta:d,isDown:p,maxScroll:f,scrollLeft:m}=this.state,g=m>0,y=m!==f,v=g||y;return(0,Wy.jsxs)("div",{className:`tab-navigation-component ${n} ${l?"two-rows":""}`,id:this.componentId,style:s,children:[o&&(0,Wy.jsx)("div",{className:"tab-navigation-prepend",id:`${this.componentId}-tab-navigation-prepend`,children:o}),(0,Wy.jsxs)("div",{className:"tab-container",children:[g&&(0,Wy.jsx)("div",{className:"scroll-button-main-container prev",children:(0,Wy.jsx)("div",{className:"scroll-button-inner-container",children:(0,Wy.jsx)(Ok,{className:"scroll-button prev",color:null,id:`${this.componentId}-prev-scroll-button`,onClick:()=>this.scrollOnClick("left",250),variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"navigate_before"})})})}),(0,Wy.jsx)("ul",{className:"tab-navigation-scrollable-container hide-scrollbars scroll-behavior-smooth "+(v?"cursor-grab":""),id:`${this.componentId}-tab-navigation-scrollable-container`,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseUp,onMouseMove:p?this.handleMouseMove:null,onScroll:this.handleScroll,onWheel:this.handleWheel,ref:this.registerScrollContainer,children:a.map(((t,n)=>(0,e.createElement)(rz,{...t,closable:!t.static&&0!==n,key:t.id,id:t.id,onClick:Math.abs(d)>20?null:i||null,onClose:Math.abs(d)>20?null:r||null,selected:t.focused,htmlTitle:t.title?t.title:"Loading",title:t.title?t.title:(0,Wy.jsx)(Rk,{circular:!0,size:"1.5rem"}),twoRows:l,variant:c,visible:t.visible,width:u,widthClosable:h})))}),y&&(0,Wy.jsx)("div",{className:"scroll-button-main-container next",children:(0,Wy.jsx)("div",{className:"scroll-button-inner-container",children:(0,Wy.jsx)(Ok,{className:"scroll-button next",color:null,id:`${this.componentId}-next-scroll-button`,onClick:()=>this.scrollOnClick("right",250),variant:"text",children:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"navigate_next"})})})})]}),t&&(0,Wy.jsx)("div",{className:"tab-navigation-append",id:`${this.componentId}-tab-navigation-append`,children:t})]})}calculateScroll(){const e=this.scrollContainer.scrollWidth-this.scrollContainer.clientWidth;this.setState({maxScroll:e},(()=>{this.scrollContainer.scrollLeft=this.validateScrollValue(this.state.scrollLeft)}))}registerScrollContainer(e){e&&(this.scrollContainer=e,new ResizeObserver(this.calculateScroll).observe(this.scrollContainer))}handleMouseDown(){this.setState({delta:0,isDown:!0}),this.scrollContainer.classList.remove("scroll-behavior-smooth"),this.scrollContainer.classList.add("cursor-grabbing")}handleMouseUp(){this.setState({isDown:!1}),this.scrollContainer.classList.add("scroll-behavior-smooth"),this.scrollContainer.classList.remove("cursor-grabbing")}handleMouseMove(e){this.setState({delta:this.state.delta+e.movementX}),this.scrollContainer.scrollLeft=this.validateScrollValue(this.scrollContainer.scrollLeft-e.movementX)}handleScroll(e){e.preventDefault(),this.setState({scrollLeft:e.currentTarget.scrollLeft})}handleWheel(e){const t=0===e.deltaX?e.deltaY:e.deltaX;this.scrollOnClick(t>0?"right":"left",250)}scrollOnClick(e,t){const{scrollLeft:n}=this.state;this.scrollContainer.scrollLeft="left"===e?this.validateScrollValue(n-t):this.validateScrollValue(n+t)}validateScrollValue(e){return Math.max(0,Math.min(e,this.state.maxScroll))}}sz.defaultProps={append:null,className:"",onTabClose:null,onTabSelect:null,prepend:null,style:{},twoRows:!1,variant:nz,width:120,widthClosable:190};var az=i(6306),lz=i(9428),cz=i(8268);const uz=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],hz=(0,Iy.ZP)(fv,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiListItemButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dense&&t.dense,"flex-start"===n.alignItems&&t.alignItemsFlexStart,n.divider&&t.divider,!n.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${YP.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${YP.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${YP.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,Ay.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${YP.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${YP.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},n.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},"flex-start"===n.alignItems&&{alignItems:"flex-start"},!n.disableGutters&&{paddingLeft:16,paddingRight:16},n.dense&&{paddingTop:4,paddingBottom:4})})),dz=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiListItemButton"}),{alignItems:i="center",autoFocus:o=!1,component:s="div",children:a,dense:l=!1,disableGutters:c=!1,divider:u=!1,focusVisibleClassName:h,selected:d=!1,className:p}=r,f=(0,My.Z)(r,uz),m=e.useContext(_b),g=e.useMemo((()=>({dense:l||m.dense||!1,alignItems:i,disableGutters:c})),[i,m.dense,l,c]),y=e.useRef(null);(0,q_.Z)((()=>{o&&y.current&&y.current.focus()}),[o]);const v=(0,_n.Z)({},r,{alignItems:i,dense:g.dense,disableGutters:c,divider:u,selected:d}),_=(e=>{const{alignItems:t,classes:n,dense:r,disabled:i,disableGutters:o,divider:s,selected:a}=e,l={root:["root",r&&"dense",!o&&"gutters",s&&"divider",i&&"disabled","flex-start"===t&&"alignItemsFlexStart",a&&"selected"]},c=(0,Cy.Z)(l,XP,n);return(0,_n.Z)({},n,c)})(v),x=(0,Ly.Z)(y,n);return(0,Wy.jsx)(_b.Provider,{value:g,children:(0,Wy.jsx)(hz,(0,_n.Z)({ref:x,href:f.href||f.to,component:(f.href||f.to)&&"div"===s?"button":s,focusVisibleClassName:(0,Ey.Z)(_.focusVisible,h),ownerState:v,className:(0,Ey.Z)(_.root,p)},f,{classes:_,children:a}))})})),pz=dz,fz=["className"],mz=(0,Iy.ZP)("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"flex-start"===n.alignItems&&t.alignItemsFlexStart]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex"},"flex-start"===n.alignItems&&{marginTop:8})})),gz=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiListItemIcon"}),{className:i}=r,o=(0,My.Z)(r,fz),s=e.useContext(_b),a=(0,_n.Z)({},r,{alignItems:s.alignItems}),l=(e=>{const{alignItems:t,classes:n}=e,r={root:["root","flex-start"===t&&"alignItemsFlexStart"]};return(0,Cy.Z)(r,pL,n)})(a);return(0,Wy.jsx)(mz,(0,_n.Z)({className:(0,Ey.Z)(l.root,i),ownerState:a,ref:n},o))})),yz=gz,vz=["children","className","disableTypography","inset","primary","primaryTypographyProps","secondary","secondaryTypographyProps"],_z=(0,Iy.ZP)("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${gL.primary}`]:t.primary},{[`& .${gL.secondary}`]:t.secondary},t.root,n.inset&&t.inset,n.primary&&n.secondary&&t.multiline,n.dense&&t.dense]}})((e=>{let{ownerState:t}=e;return(0,_n.Z)({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4},t.primary&&t.secondary&&{marginTop:6,marginBottom:6},t.inset&&{paddingLeft:56})})),xz=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiListItemText"}),{children:i,className:o,disableTypography:s=!1,inset:a=!1,primary:l,primaryTypographyProps:c,secondary:u,secondaryTypographyProps:h}=r,d=(0,My.Z)(r,vz),{dense:p}=e.useContext(_b);let f=null!=l?l:i,m=u;const g=(0,_n.Z)({},r,{disableTypography:s,inset:a,primary:!!f,secondary:!!m,dense:p}),y=(e=>{const{classes:t,inset:n,primary:r,secondary:i,dense:o}=e,s={root:["root",n&&"inset",o&&"dense",r&&i&&"multiline"],primary:["primary"],secondary:["secondary"]};return(0,Cy.Z)(s,mL,t)})(g);return null==f||f.type===LM||s||(f=(0,Wy.jsx)(LM,(0,_n.Z)({variant:p?"body2":"body1",className:y.primary,component:null!=c&&c.variant?void 0:"span",display:"block"},c,{children:f}))),null==m||m.type===LM||s||(m=(0,Wy.jsx)(LM,(0,_n.Z)({variant:"body2",className:y.secondary,color:"text.secondary",display:"block"},h,{children:m}))),(0,Wy.jsxs)(_z,(0,_n.Z)({className:(0,Ey.Z)(y.root,o),ownerState:g,ref:n},d,{children:[f,m]}))})),bz=xz;var wz=i(7983);function Sz(e){return(0,lv.ZP)("MuiSimpleTreeView",e)}(0,$y.Z)("MuiSimpleTreeView",["root"]);class Mz{constructor(){this.maxListeners=20,this.warnOnce=!1,this.events={}}on(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.events[e];r||(r={highPriority:new Map,regular:new Map},this.events[e]=r),n.isFirst?r.highPriority.set(t,!0):r.regular.set(t,!0)}removeListener(e,t){this.events[e]&&(this.events[e].regular.delete(t),this.events[e].highPriority.delete(t))}removeAllListeners(){this.events={}}emit(e){const t=this.events[e];if(!t)return;const n=Array.from(t.highPriority.keys()),r=Array.from(t.regular.keys());for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];for(let e=n.length-1;e>=0;e-=1){const r=n[e];t.highPriority.has(r)&&r.apply(this,o)}for(let e=0;e<r.length;e+=1){const n=r[e];t.regular.has(n)&&n.apply(this,o)}}once(e,t){const n=this;this.on(e,(function r(){n.removeListener(e,r);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];t.apply(n,o)}))}}const Ez=()=>{const[t]=e.useState((()=>new Mz));return{instance:{$$publishEvent:e.useCallback((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];const[i,o,s={}]=n;s.defaultMuiPrevented=!1,(e=>void 0!==e.isPropagationStopped)(s)&&s.isPropagationStopped()||t.emit(i,o,s)}),[t]),$$subscribeEvent:e.useCallback(((e,n)=>(t.on(e,n),()=>{t.removeListener(e,n)})),[t])}}};Ez.params={};const Tz=[Ez],Cz=e.createContext(null);function Az(e){const{value:t,children:n}=e;return(0,Wy.jsx)(Cz.Provider,{value:t,children:t.wrapRoot({children:n})})}const Iz=t=>{let{params:n}=t;const r=(0,O_.Z)(n.id);return{getRootProps:()=>({id:r}),instance:{getTreeItemIdAttribute:e.useCallback(((e,t)=>t??`${r}-${e}`),[r])}}};Iz.params={id:!0};const Pz=(e,t,n)=>{e.$$publishEvent(t,n)},Rz="__TREE_VIEW_ROOT_PARENT_ID__",Lz=e=>{const t={};return e.forEach(((e,n)=>{t[e]=n})),t},Dz=e=>{let{items:t,isItemDisabled:n,getItemLabel:r,getItemId:i}=e;const o={},s={},a={[Rz]:[]},l=(e,t)=>{const c=i?i(e):e.id;if(null==c)throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.","An item was provided without id in the `items` prop:",JSON.stringify(e)].join("\n"));if(null!=o[c])throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.",`Two items were provided with the same id in the \`items\` prop: "${c}"`].join("\n"));const u=r?r(e):e.label;if(null==u)throw new Error(["MUI X: The Tree View component requires all items to have a `label` property.","Alternatively, you can use the `getItemLabel` prop to specify a custom label for each item.","An item was provided without label in the `items` prop:",JSON.stringify(e)].join("\n"));o[c]={id:c,label:u,parentId:t,idAttribute:void 0,expandable:!!e.children?.length,disabled:!!n&&n(e)},s[c]=e,a[c]=[];const h=t??Rz;a[h]||(a[h]=[]),a[h].push(c),e.children?.forEach((e=>l(e,c)))};t.forEach((e=>l(e,null)));const c={};return Object.keys(a).forEach((e=>{c[e]=Lz(a[e])})),{itemMetaMap:o,itemMap:s,itemOrderedChildrenIds:a,itemChildrenIndexes:c}},Oz=t=>{let{instance:n,params:r,state:i,setState:o}=t;const s=e.useCallback((e=>i.items.itemMetaMap[e]),[i.items.itemMetaMap]),a=e.useCallback((e=>i.items.itemMap[e]),[i.items.itemMap]),l=e.useCallback((e=>{if(null==e)return!1;let t=n.getItemMeta(e);if(!t)return!1;if(t.disabled)return!0;for(;null!=t.parentId;)if(t=n.getItemMeta(t.parentId),t.disabled)return!0;return!1}),[n]),c=e.useCallback((e=>{const t=n.getItemMeta(e).parentId??Rz;return i.items.itemChildrenIndexes[t][e]}),[n,i.items.itemChildrenIndexes]),u=e.useCallback((e=>i.items.itemOrderedChildrenIds[e??Rz]??[]),[i.items.itemOrderedChildrenIds]),h=e.useRef(!1),d=e.useCallback((()=>{h.current=!0}),[]),p=e.useCallback((()=>h.current),[]);return e.useEffect((()=>{n.areItemUpdatesPrevented()||o((e=>{const t=Dz({items:r.items,isItemDisabled:r.isItemDisabled,getItemId:r.getItemId,getItemLabel:r.getItemLabel});return Object.values(e.items.itemMetaMap).forEach((e=>{t.itemMetaMap[e.id]||Pz(n,"removeItem",{id:e.id})})),(0,_n.Z)({},e,{items:t})}))}),[n,o,r.items,r.isItemDisabled,r.getItemId,r.getItemLabel]),{publicAPI:{getItem:a},instance:{getItemMeta:s,getItem:a,getItemsToRender:()=>{const e=t=>{const n=i.items.itemMetaMap[t];return{label:n.label,itemId:n.id,id:n.idAttribute,children:i.items.itemOrderedChildrenIds[t].map(e)}};return i.items.itemOrderedChildrenIds[Rz].map(e)},getItemIndex:c,getItemOrderedChildrenIds:u,isItemDisabled:l,isItemNavigable:e=>!!r.disabledItemsFocusable||!n.isItemDisabled(e),preventItemUpdates:d,areItemUpdatesPrevented:p},contextValue:{disabledItemsFocusable:r.disabledItemsFocusable}}};Oz.getInitialState=e=>({items:Dz({items:e.items,isItemDisabled:e.isItemDisabled,getItemId:e.getItemId,getItemLabel:e.getItemLabel})}),Oz.getDefaultizedParams=e=>(0,_n.Z)({},e,{disabledItemsFocusable:e.disabledItemsFocusable??!1}),Oz.params={disabledItemsFocusable:!0,items:!0,isItemDisabled:!0,getItemLabel:!0,getItemId:!0};const Nz=t=>{let{instance:n,params:r,models:i}=t;const o=e.useMemo((()=>{const e=new Map;return i.expandedItems.value.forEach((t=>{e.set(t,!0)})),e}),[i.expandedItems.value]),s=(e,t)=>{r.onExpandedItemsChange?.(e,t),i.expandedItems.setControlledValue(t)},a=e.useCallback((e=>o.has(e)),[o]),l=e.useCallback((e=>!!n.getItemMeta(e)?.expandable),[n]),c=(0,tw.Z)(((e,t)=>{const r=n.isItemExpanded(t);n.setItemExpansion(e,t,!r)})),u=(0,tw.Z)(((e,t,o)=>{if(n.isItemExpanded(t)===o)return;let a;a=o?[t].concat(i.expandedItems.value):i.expandedItems.value.filter((e=>e!==t)),r.onItemExpansionToggle&&r.onItemExpansionToggle(e,t,o),s(e,a)}));return{publicAPI:{setItemExpansion:u},instance:{isItemExpanded:a,isItemExpandable:l,setItemExpansion:u,toggleItemExpansion:c,expandAllSiblings:(e,t)=>{const o=n.getItemMeta(t),a=n.getItemOrderedChildrenIds(o.parentId).filter((e=>n.isItemExpandable(e)&&!n.isItemExpanded(e))),l=i.expandedItems.value.concat(a);a.length>0&&(r.onItemExpansionToggle&&a.forEach((t=>{r.onItemExpansionToggle(e,t,!0)})),s(e,l))}}}};Nz.models={expandedItems:{getDefaultValue:e=>e.defaultExpandedItems}};const kz=[];Nz.getDefaultizedParams=e=>(0,_n.Z)({},e,{defaultExpandedItems:e.defaultExpandedItems??kz}),Nz.params={expandedItems:!0,defaultExpandedItems:!0,onExpandedItemsChange:!0,onItemExpansionToggle:!0};const Fz=(e,t)=>{let n=t.length-1;for(;n>=0&&!e.isItemNavigable(t[n]);)n-=1;if(-1!==n)return t[n]},zz=(e,t)=>{if(e.isItemExpanded(t)){const n=e.getItemOrderedChildrenIds(t).find(e.isItemNavigable);if(null!=n)return n}let n=e.getItemMeta(t);for(;null!=n;){const t=e.getItemOrderedChildrenIds(n.parentId),r=e.getItemIndex(n.id);if(r<t.length-1){let n=r+1;for(;!e.isItemNavigable(t[n])&&n<t.length-1;)n+=1;if(e.isItemNavigable(t[n]))return t[n]}n=e.getItemMeta(n.parentId)}return null},Bz=e=>{let t=null;for(;null==t||e.isItemExpanded(t);){const n=e.getItemOrderedChildrenIds(t),r=Fz(e,n);if(null==r)return t;t=r}return t},Uz=e=>e.getItemOrderedChildrenIds(null).find(e.isItemNavigable),jz=(e,t,n)=>{if(t===n)return[t,n];const r=e.getItemMeta(t),i=e.getItemMeta(n);if(r.parentId===i.id||i.parentId===r.id)return i.parentId===r.id?[r.id,i.id]:[i.id,r.id];const o=[r.id],s=[i.id];let a=r.parentId,l=i.parentId,c=-1!==s.indexOf(a),u=-1!==o.indexOf(l),h=!0,d=!0;for(;!u&&!c;)h&&(o.push(a),c=-1!==s.indexOf(a),h=null!==a,!c&&h&&(a=e.getItemMeta(a).parentId)),d&&!c&&(s.push(l),u=-1!==o.indexOf(l),d=null!==l,!u&&d&&(l=e.getItemMeta(l).parentId));const p=c?a:l,f=e.getItemOrderedChildrenIds(p),m=o[o.indexOf(p)-1],g=s[s.indexOf(p)-1];return f.indexOf(m)<f.indexOf(g)?[t,n]:[n,t]},Vz=e=>Array.isArray(e)?e:null!=e?[e]:[],Gz=e=>{const t={};return e.forEach((e=>{t[e]=!0})),t},Hz=t=>{let{instance:n,params:r,models:i}=t;const o=e.useRef(null),s=e.useRef({}),a=e.useMemo((()=>{const e=new Map;return Array.isArray(i.selectedItems.value)?i.selectedItems.value.forEach((t=>{e.set(t,!0)})):null!=i.selectedItems.value&&e.set(i.selectedItems.value,!0),e}),[i.selectedItems.value]),l=(e,t)=>{if(r.onItemSelectionToggle)if(r.multiSelect){const o=t.filter((e=>!n.isItemSelected(e))),s=i.selectedItems.value.filter((e=>!t.includes(e)));o.forEach((t=>{r.onItemSelectionToggle(e,t,!0)})),s.forEach((t=>{r.onItemSelectionToggle(e,t,!1)}))}else t!==i.selectedItems.value&&(null!=i.selectedItems.value&&r.onItemSelectionToggle(e,i.selectedItems.value,!1),null!=t&&r.onItemSelectionToggle(e,t,!0));r.onSelectedItemsChange&&r.onSelectedItemsChange(e,t),i.selectedItems.setControlledValue(t)},c=(e,t)=>{let[o,a]=t;if(r.disableSelection||!r.multiSelect)return;let c=Vz(i.selectedItems.value).slice();Object.keys(s.current).length>0&&(c=c.filter((e=>!s.current[e])));const u=Gz(c),h=((e,t,n)=>{const r=t=>{if(e.isItemExpandable(t)&&e.isItemExpanded(t))return e.getItemOrderedChildrenIds(t)[0];let n=e.getItemMeta(t);for(;null!=n;){const t=e.getItemOrderedChildrenIds(n.parentId),r=e.getItemIndex(n.id);if(r<t.length-1)return t[r+1];n=e.getItemMeta(n.parentId)}throw new Error("Invalid range")},[i,o]=jz(e,t,n),s=[i];let a=i;for(;a!==o;)a=r(a),e.isItemDisabled(a)||s.push(a);return s})(n,o,a),d=h.filter((e=>!u[e]));c=c.concat(d),l(e,c),s.current=Gz(h)};return{getRootProps:()=>({"aria-multiselectable":r.multiSelect}),instance:{isItemSelected:e=>a.has(e),selectItem:(e,t,a,c)=>{if(r.disableSelection)return;let u;if(a){const e=Vz(i.selectedItems.value),r=n.isItemSelected(t);u=!r||!1!==c&&null!=c?r||!0!==c&&null!=c?e:[t].concat(e):e.filter((e=>e!==t))}else u=!1===c?r.multiSelect?[]:null:r.multiSelect?[t]:t;l(e,u),o.current=t,s.current={}},selectAllNavigableItems:e=>{if(r.disableSelection||!r.multiSelect)return;const t=(e=>{let t=Uz(e);const n=[];for(;null!=t;)n.push(t),t=zz(e,t);return n})(n);l(e,t),s.current=Gz(t)},expandSelectionRange:(e,t)=>{if(null!=o.current){const[r,i]=jz(n,t,o.current);c(e,[r,i])}},selectRangeFromStartToItem:(e,t)=>{c(e,[Uz(n),t])},selectRangeFromItemToEnd:(e,t)=>{c(e,[t,Bz(n)])},selectItemFromArrowNavigation:(e,t,n)=>{if(r.disableSelection||!r.multiSelect)return;let o=Vz(i.selectedItems.value).slice();0===Object.keys(s.current).length?(o.push(n),s.current={[t]:!0,[n]:!0}):(s.current[t]||(s.current={}),s.current[n]?(o=o.filter((e=>e!==t)),delete s.current[t]):(o.push(n),s.current[n]=!0)),l(e,o)}},contextValue:{selection:{multiSelect:r.multiSelect,checkboxSelection:r.checkboxSelection,disableSelection:r.disableSelection}}}};Hz.models={selectedItems:{getDefaultValue:e=>e.defaultSelectedItems}};const Zz=[];Hz.getDefaultizedParams=e=>(0,_n.Z)({},e,{disableSelection:e.disableSelection??!1,multiSelect:e.multiSelect??!1,checkboxSelection:e.checkboxSelection??!1,defaultSelectedItems:e.defaultSelectedItems??(e.multiSelect?Zz:null)}),Hz.params={disableSelection:!0,multiSelect:!0,checkboxSelection:!0,defaultSelectedItems:!0,selectedItems:!0,onSelectedItemsChange:!0,onItemSelectionToggle:!0};class Wz{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;this.timeouts=new Map,this.cleanupTimeout=1e3,this.cleanupTimeout=e}register(e,t,n){this.timeouts||(this.timeouts=new Map);const r=setTimeout((()=>{"function"==typeof t&&t(),this.timeouts.delete(n.cleanupToken)}),this.cleanupTimeout);this.timeouts.set(n.cleanupToken,r)}unregister(e){const t=this.timeouts.get(e.cleanupToken);t&&(this.timeouts.delete(e.cleanupToken),clearTimeout(t))}reset(){this.timeouts&&(this.timeouts.forEach(((e,t)=>{this.unregister({cleanupToken:t})})),this.timeouts=void 0)}}class $z{constructor(){this.registry=new FinalizationRegistry((e=>{"function"==typeof e&&e()}))}register(e,t,n){this.registry.register(e,t,n)}unregister(e){this.registry.unregister(e)}reset(){}}class qz{}const Xz=function(t){let n=0;return function(r,i,o){null===t.registry&&(t.registry="undefined"!=typeof FinalizationRegistry?new $z:new Wz);const[s]=e.useState(new qz),a=e.useRef(null),l=e.useRef();l.current=o;const c=e.useRef(null);if(!a.current&&l.current){const e=(e,t)=>{t.defaultMuiPrevented||l.current?.(e,t)};a.current=r.$$subscribeEvent(i,e),n+=1,c.current={cleanupToken:n},t.registry.register(s,(()=>{a.current?.(),a.current=null,c.current=null}),c.current)}else!l.current&&a.current&&(a.current(),a.current=null,c.current&&(t.registry.unregister(c.current),c.current=null));e.useEffect((()=>{if(!a.current&&l.current){const e=(e,t)=>{t.defaultMuiPrevented||l.current?.(e,t)};a.current=r.$$subscribeEvent(i,e)}return c.current&&t.registry&&(t.registry.unregister(c.current),c.current=null),()=>{a.current?.(),a.current=null}}),[r,i])}}({registry:null}),Yz=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:document).activeElement;return e?e.shadowRoot?Yz(e.shadowRoot):e:null},Kz=t=>{let{instance:n,params:r,state:i,setState:o,models:s,rootRef:a}=t;const l=((e,t)=>{const n=t=>{const n=e.getItemMeta(t);return n&&(null==n.parentId||e.isItemExpanded(n.parentId))};let r;return Array.isArray(t)?r=t.find(n):null!=t&&n(t)&&(r=t),null==r&&(r=Uz(e)),r})(n,s.selectedItems.value),c=(0,tw.Z)((e=>{const t="function"==typeof e?e(i.focusedItemId):e;i.focusedItemId!==t&&o((e=>(0,_n.Z)({},e,{focusedItemId:t})))})),u=e.useCallback((()=>!!a.current&&a.current.contains(Yz((0,ew.Z)(a.current)))),[a]),h=e.useCallback((e=>i.focusedItemId===e&&u()),[i.focusedItemId,u]),d=e=>{const t=n.getItemMeta(e);return t&&(null==t.parentId||n.isItemExpanded(t.parentId))},p=(e,t)=>{const i=n.getItemMeta(t),o=document.getElementById(n.getTreeItemIdAttribute(t,i.idAttribute));o&&o.focus(),c(t),r.onItemFocus&&r.onItemFocus(e,t)},f=(0,tw.Z)(((e,t)=>{d(t)&&p(e,t)})),m=(0,tw.Z)((e=>{let t;Array.isArray(s.selectedItems.value)?t=s.selectedItems.value.find(d):null!=s.selectedItems.value&&d(s.selectedItems.value)&&(t=s.selectedItems.value),null==t&&(t=Uz(n)),p(e,t)})),g=(0,tw.Z)((()=>{if(null==i.focusedItemId)return;const e=n.getItemMeta(i.focusedItemId);if(e){const t=document.getElementById(n.getTreeItemIdAttribute(i.focusedItemId,e.idAttribute));t&&t.blur()}c(null)}));Xz(n,"removeItem",(e=>{let{id:t}=e;i.focusedItemId===t&&n.focusDefaultItem(null)}));const y=e=>t=>{e.onFocus?.(t),t.defaultMuiPrevented||t.target===t.currentTarget&&n.focusDefaultItem(t)};return{getRootProps:e=>({onFocus:y(e)}),publicAPI:{focusItem:f},instance:{isItemFocused:h,canItemBeTabbed:e=>e===l,focusItem:f,focusDefaultItem:m,removeFocusedItem:g}}};Kz.getInitialState=()=>({focusedItemId:null}),Kz.params={onItemFocus:!0};const Jz=t=>{let{instance:n,params:r,state:i}=t;const o="rtl"===Zb().direction,s=e.useRef({}),a=(0,tw.Z)((e=>{s.current=e(s.current)}));e.useEffect((()=>{if(n.areItemUpdatesPrevented())return;const e={};Object.values(i.items.itemMetaMap).forEach((t=>{e[t.id]=t.label.substring(0,1).toLowerCase()})),s.current=e}),[i.items.itemMetaMap,r.getItemId,n]);const l=e=>!r.disableSelection&&!n.isItemDisabled(e),c=e=>!n.isItemDisabled(e)&&n.isItemExpandable(e);return{instance:{updateFirstCharMap:a,handleItemKeyDown:(e,t)=>{if(e.defaultMuiPrevented)return;if(e.altKey||e.currentTarget!==e.target.closest('*[role="treeitem"]'))return;const i=e.ctrlKey||e.metaKey,a=e.key;switch(!0){case" "===a&&l(t):e.preventDefault(),r.multiSelect&&e.shiftKey?n.expandSelectionRange(e,t):r.multiSelect?n.selectItem(e,t,!0):n.selectItem(e,t,!1);break;case"Enter"===a:c(t)?(n.toggleItemExpansion(e,t),e.preventDefault()):l(t)&&(r.multiSelect?(e.preventDefault(),n.selectItem(e,t,!0)):n.isItemSelected(t)||(n.selectItem(e,t,!1),e.preventDefault()));break;case"ArrowDown"===a:{const i=zz(n,t);i&&(e.preventDefault(),n.focusItem(e,i),r.multiSelect&&e.shiftKey&&l(i)&&n.selectItemFromArrowNavigation(e,t,i));break}case"ArrowUp"===a:{const i=((e,t)=>{const n=e.getItemMeta(t),r=e.getItemOrderedChildrenIds(n.parentId),i=e.getItemIndex(t);if(0===i)return n.parentId;let o=r[i-1],s=Fz(e,e.getItemOrderedChildrenIds(o));for(;e.isItemExpanded(o)&&null!=s;)o=s,s=e.getItemOrderedChildrenIds(o).find(e.isItemNavigable);return o})(n,t);i&&(e.preventDefault(),n.focusItem(e,i),r.multiSelect&&e.shiftKey&&l(i)&&n.selectItemFromArrowNavigation(e,t,i));break}case"ArrowRight"===a&&!o||"ArrowLeft"===a&&o:if(n.isItemExpanded(t)){const r=zz(n,t);r&&(n.focusItem(e,r),e.preventDefault())}else c(t)&&(n.toggleItemExpansion(e,t),e.preventDefault());break;case"ArrowLeft"===a&&!o||"ArrowRight"===a&&o:if(c(t)&&n.isItemExpanded(t))n.toggleItemExpansion(e,t),e.preventDefault();else{const r=n.getItemMeta(t).parentId;r&&(n.focusItem(e,r),e.preventDefault())}break;case"Home"===a:l(t)&&r.multiSelect&&i&&e.shiftKey?n.selectRangeFromStartToItem(e,t):n.focusItem(e,Uz(n)),e.preventDefault();break;case"End"===a:l(t)&&r.multiSelect&&i&&e.shiftKey?n.selectRangeFromItemToEnd(e,t):n.focusItem(e,Bz(n)),e.preventDefault();break;case"*"===a:n.expandAllSiblings(e,t),e.preventDefault();break;case"a"===a&&i&&r.multiSelect&&!r.disableSelection:n.selectAllNavigableItems(e),e.preventDefault();break;case!(i||e.shiftKey||(u=a,!u||1!==u.length||!u.match(/\S/))):{const r=((e,t)=>{const r=t.toLowerCase(),i=e=>{const t=zz(n,e);return null===t?Uz(n):t};let o=null,a=i(e);const l={};for(;null==o&&!l[a];)s.current[a]===r?o=a:(l[a]=!0,a=i(a));return o})(t,a);null!=r&&(n.focusItem(e,r),e.preventDefault());break}}var u}}}};Jz.params={};const Qz=e=>{let{slots:t,slotProps:n}=e;return{contextValue:{icons:{slots:{collapseIcon:t.collapseIcon,expandIcon:t.expandIcon,endIcon:t.endIcon},slotProps:{collapseIcon:n.collapseIcon,expandIcon:n.expandIcon,endIcon:n.endIcon}}}}};Qz.params={};const eB=[Iz,Oz,Nz,Hz,Kz,Jz,Qz],tB=()=>{const t=e.useContext(Cz);if(null==t)throw new Error(["MUI X: Could not find the Tree View context.","It looks like you rendered your component outside of a SimpleTreeView or RichTreeView parent component.","This can also happen if you are bundling multiple versions of the Tree View."].join("\n"));return t},nB=e.createContext(null);function rB(t){const{children:n,itemId:r=null}=t,{instance:i,rootRef:o}=tB(),s=e.useRef(new Map);e.useEffect((()=>{if(!o.current)return;let e=null;if(null==r)e=o.current.id;else{const t=i.getItemMeta(r);void 0!==t&&(e=i.getTreeItemIdAttribute(r,t.idAttribute))}if(null==e)return;const t=i.getItemOrderedChildrenIds(r??null)??[],n=o.current.querySelectorAll(`${null==r?"":`*[id="${e}"] `}[role="treeitem"]:not(*[id="${e}"] [role="treeitem"] [role="treeitem"])`),a=Array.from(n).map((e=>s.current.get(e.id)));(a.length!==t.length||a.some(((e,n)=>e!==t[n])))&&i.setJSXItemsOrderedChildrenIds(r??null,a)}));const a=e.useMemo((()=>({registerChild:(e,t)=>s.current.set(e,t),unregisterChild:e=>s.current.delete(e),parentId:r})),[r]);return(0,Wy.jsx)(nB.Provider,{value:a,children:n})}const iB=e=>{let{instance:t,setState:n}=e;return t.preventItemUpdates(),{instance:{insertJSXItem:(0,tw.Z)((e=>{n((t=>{if(null!=t.items.itemMetaMap[e.id])throw new Error(["MUI X: The Tree View component requires all items to have a unique `id` property.","Alternatively, you can use the `getItemId` prop to specify a custom id for each item.",`Two items were provided with the same id in the \`items\` prop: "${e.id}"`].join("\n"));return(0,_n.Z)({},t,{items:(0,_n.Z)({},t.items,{itemMetaMap:(0,_n.Z)({},t.items.itemMetaMap,{[e.id]:e}),itemMap:(0,_n.Z)({},t.items.itemMap,{[e.id]:{id:e.id,label:e.label}})})})}))})),removeJSXItem:(0,tw.Z)((e=>{n((t=>{const n=(0,_n.Z)({},t.items.itemMetaMap),r=(0,_n.Z)({},t.items.itemMap);return delete n[e],delete r[e],(0,_n.Z)({},t,{items:(0,_n.Z)({},t.items,{itemMetaMap:n,itemMap:r})})})),Pz(t,"removeItem",{id:e})})),setJSXItemsOrderedChildrenIds:(e,t)=>{const r=e??Rz;n((e=>(0,_n.Z)({},e,{items:(0,_n.Z)({},e.items,{itemOrderedChildrenIds:(0,_n.Z)({},e.items.itemOrderedChildrenIds,{[r]:t}),itemChildrenIndexes:(0,_n.Z)({},e.items.itemChildrenIndexes,{[r]:Lz(t)})})})))},mapFirstCharFromJSX:(0,tw.Z)(((e,n)=>(t.updateFirstCharMap((t=>(t[e]=n,t))),()=>{t.updateFirstCharMap((t=>{const n=(0,_n.Z)({},t);return delete n[e],n}))})))}}},oB=e=>Array.isArray(e)?e.length>0&&e.some(oB):Boolean(e);iB.itemPlugin=t=>{let{props:n,rootRef:r,contentRef:i}=t;const{instance:o}=tB(),{children:s,disabled:a=!1,label:l,itemId:c,id:u}=n,h=e.useContext(nB);if(null==h)throw new Error(["MUI X: Could not find the Tree View Children Item context.","It looks like you rendered your component outside of a SimpleTreeView parent component.","This can also happen if you are bundling multiple versions of the Tree View."].join("\n"));const{registerChild:d,unregisterChild:p,parentId:f}=h,m=oB(s),g=e.useRef(null),y=(0,F_.Z)(g,i);return(0,Cv.Z)((()=>{const e=o.getTreeItemIdAttribute(c,u);return d(e,c),()=>{p(e)}}),[o,d,p,c,u]),e.useEffect((()=>(o.insertJSXItem({id:c,idAttribute:u,parentId:f,expandable:m,disabled:a}),()=>o.removeJSXItem(c))),[o,f,c,m,a,u]),e.useEffect((()=>{if(l)return o.mapFirstCharFromJSX(c,(g.current?.textContent??"").substring(0,1).toLowerCase())}),[o,c,l]),{contentRef:y,rootRef:r}},iB.wrapItem=e=>{let{children:t,itemId:n}=e;return(0,Wy.jsx)(rB,{itemId:n,children:t})},iB.wrapRoot=e=>{let{children:t}=e;return(0,Wy.jsx)(rB,{children:t})},iB.params={};const sB=[...eB,iB],aB=["slots","slotProps","apiRef"],lB=(0,Iy.ZP)("ul",{name:"MuiSimpleTreeView",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:0,margin:0,listStyle:"none",outline:0,position:"relative"}),cB=[],uB=(function(e){Array.isArray(e)&&e.join("\n")}(["MUI X: The `SimpleTreeView` component does not support the `items` prop.","If you want to add items, you need to pass them as JSX children.","Check the documentation for more details: https://mui.com/x/react-tree-view/simple-tree-view/items/"]),e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiSimpleTreeView"}),i=r,{pluginParams:o,slots:s,slotProps:a,otherProps:l}=(e=>{let{props:{slots:t,slotProps:n,apiRef:r},plugins:i,rootRef:o}=e,s=(0,My.Z)(e.props,aB);const a={};i.forEach((e=>{Object.assign(a,e.params)}));const l={plugins:i,rootRef:o,slots:t??{},slotProps:n??{},apiRef:r},c={};return Object.keys(s).forEach((e=>{const t=s[e];a[e]?l[e]=t:c[e]=t})),{pluginParams:l,slots:t,slotProps:n,otherProps:c}})({props:(0,_n.Z)({},r,{items:cB}),plugins:sB,rootRef:n}),{getRootProps:c,contextValue:u}=(t=>{const n=[...Tz,...t.plugins],r=n.reduce(((e,t)=>t.getDefaultizedParams?t.getDefaultizedParams(e):e),t),i=((t,n)=>{const r=e.useRef({}),[i,o]=e.useState((()=>{const e={};return t.forEach((t=>{t.models&&Object.entries(t.models).forEach((t=>{let[i,o]=t;r.current[i]={isControlled:void 0!==n[i],getDefaultValue:o.getDefaultValue},e[i]=o.getDefaultValue(n)}))})),e}));return Object.fromEntries(Object.entries(r.current).map((e=>{let[t,r]=e;const s=n[t]??i[t];return[t,{value:s,setControlledValue:e=>{r.isControlled||o((n=>(0,_n.Z)({},n,{[t]:e})))}}]})))})(n,r),o=e.useRef({}).current,s=function(t){const n=e.useRef({});return t?(null==t.current&&(t.current={}),t.current):n.current}(t.apiRef),a=e.useRef(null),l=(0,F_.Z)(a,t.rootRef),[c,u]=e.useState((()=>{const e={};return n.forEach((t=>{t.getInitialState&&Object.assign(e,t.getInitialState(r))})),e})),h=[],d={publicAPI:s,instance:o,rootRef:a};n.forEach((e=>{const t=e({instance:o,params:r,slots:r.slots,slotProps:r.slotProps,state:c,setState:u,rootRef:a,models:i});t.getRootProps&&h.push(t.getRootProps),t.publicAPI&&Object.assign(s,t.publicAPI),t.instance&&Object.assign(o,t.instance),t.contextValue&&Object.assign(d,t.contextValue)})),d.runItemPlugins=e=>{let t=null,r=null;return n.forEach((n=>{if(!n.itemPlugin)return;const i=n.itemPlugin({props:e,rootRef:t,contentRef:r});i?.rootRef&&(t=i.rootRef),i?.contentRef&&(r=i.contentRef)})),{contentRef:r,rootRef:t}};const p=n.map((e=>e.wrapItem)).filter((e=>!!e));d.wrapItem=e=>{let{itemId:t,children:n}=e,r=n;return p.forEach((e=>{r=e({itemId:t,children:r})})),r};const f=n.map((e=>e.wrapRoot)).filter((e=>!!e));return d.wrapRoot=e=>{let{children:t}=e,n=t;return f.forEach((e=>{n=e({children:n})})),n},{getRootProps:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,_n.Z)({role:"tree"},e,{ref:l});return h.forEach((n=>{Object.assign(t,n(e))})),t},rootRef:l,contextValue:d,instance:o}})(o),h=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"]},Sz,t)})(r),d=s?.root??lB,p=gb({elementType:d,externalSlotProps:a?.root,externalForwardedProps:l,className:h.root,getSlotProps:c,ownerState:i});return(0,Wy.jsx)(Az,{value:u,children:(0,Wy.jsx)(d,(0,_n.Z)({},p))})})));function hB(e){return(0,lv.ZP)("PrivateSwitchBase",e)}(0,$y.Z)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const dB=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],pB=(0,Iy.ZP)(fv)((e=>{let{ownerState:t}=e;return(0,_n.Z)({padding:9,borderRadius:"50%"},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})})),fB=(0,Iy.ZP)("input",{shouldForwardProp:Py.Z})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),mB=e.forwardRef((function(e,t){const{autoFocus:n,checked:r,checkedIcon:i,className:o,defaultChecked:s,disabled:a,disableFocusRipple:l=!1,edge:c=!1,icon:u,id:h,inputProps:d,inputRef:p,name:f,onBlur:m,onChange:g,onFocus:y,readOnly:v,required:_=!1,tabIndex:x,type:b,value:w}=e,S=(0,My.Z)(e,dB),[M,E]=(0,dS.Z)({controlled:r,default:Boolean(s),name:"SwitchBase",state:"checked"}),T=$_();let C=a;T&&void 0===C&&(C=T.disabled);const A="checkbox"===b||"radio"===b,I=(0,_n.Z)({},e,{checked:M,disabled:C,disableFocusRipple:l,edge:c}),P=(e=>{const{classes:t,checked:n,disabled:r,edge:i}=e,o={root:["root",n&&"checked",r&&"disabled",i&&`edge${(0,mv.Z)(i)}`],input:["input"]};return(0,Cy.Z)(o,hB,t)})(I);return(0,Wy.jsxs)(pB,(0,_n.Z)({component:"span",className:(0,Ey.Z)(P.root,o),centerRipple:!0,focusRipple:!l,disabled:C,tabIndex:null,role:void 0,onFocus:e=>{y&&y(e),T&&T.onFocus&&T.onFocus(e)},onBlur:e=>{m&&m(e),T&&T.onBlur&&T.onBlur(e)},ownerState:I,ref:t},S,{children:[(0,Wy.jsx)(fB,(0,_n.Z)({autoFocus:n,checked:r,defaultChecked:s,className:P.input,disabled:C,id:A?h:void 0,name:f,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;const t=e.target.checked;E(t),g&&g(e,t)},readOnly:v,ref:p,required:_,ownerState:I,tabIndex:x,type:b},"checkbox"===b&&void 0===w?{}:{value:w},d)),M?i:u]}))})),gB=mB,yB=(0,MS.Z)((0,Wy.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),vB=(0,MS.Z)((0,Wy.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),_B=(0,MS.Z)((0,Wy.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function xB(e){return(0,lv.ZP)("MuiCheckbox",e)}const bB=(0,$y.Z)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),wB=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],SB=(0,Iy.ZP)(gB,{shouldForwardProp:e=>(0,Py.Z)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,t[`size${(0,mv.Z)(n.size)}`],"default"!==n.color&&t[`color${(0,mv.Z)(n.color)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({color:(t.vars||t).palette.text.secondary},!n.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${"default"===n.color?t.vars.palette.action.activeChannel:t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)("default"===n.color?t.palette.action.active:t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{[`&.${bB.checked}, &.${bB.indeterminate}`]:{color:(t.vars||t).palette[n.color].main},[`&.${bB.disabled}`]:{color:(t.vars||t).palette.action.disabled}})})),MB=(0,Wy.jsx)(vB,{}),EB=(0,Wy.jsx)(yB,{}),TB=(0,Wy.jsx)(_B,{}),CB=e.forwardRef((function(t,n){var r,i;const o=(0,Ry.Z)({props:t,name:"MuiCheckbox"}),{checkedIcon:s=MB,color:a="primary",icon:l=EB,indeterminate:c=!1,indeterminateIcon:u=TB,inputProps:h,size:d="medium",className:p}=o,f=(0,My.Z)(o,wB),m=c?u:l,g=c?u:s,y=(0,_n.Z)({},o,{color:a,indeterminate:c,size:d}),v=(e=>{const{classes:t,indeterminate:n,color:r,size:i}=e,o={root:["root",n&&"indeterminate",`color${(0,mv.Z)(r)}`,`size${(0,mv.Z)(i)}`]},s=(0,Cy.Z)(o,xB,t);return(0,_n.Z)({},t,s)})(y);return(0,Wy.jsx)(SB,(0,_n.Z)({type:"checkbox",inputProps:(0,_n.Z)({"data-indeterminate":c},h),icon:e.cloneElement(m,{fontSize:null!=(r=m.props.fontSize)?r:d}),checkedIcon:e.cloneElement(g,{fontSize:null!=(i=g.props.fontSize)?i:d}),ownerState:y,ref:n,className:(0,Ey.Z)(v.root,p)},f,{classes:v}))})),AB=CB,IB=["classes","className","displayIcon","expansionIcon","icon","label","itemId","onClick","onMouseDown"],PB=e.forwardRef((function(t,n){const{classes:r,className:i,displayIcon:o,expansionIcon:s,icon:a,label:l,itemId:c,onClick:u,onMouseDown:h}=t,d=(0,My.Z)(t,IB),{disabled:p,expanded:f,selected:m,focused:g,disableSelection:y,checkboxSelection:v,handleExpansion:_,handleSelection:x,handleCheckboxSelection:b,preventSelection:w}=function(e){const{instance:t,selection:{multiSelect:n,checkboxSelection:r,disableSelection:i}}=tB(),o=t.isItemExpandable(e),s=t.isItemExpanded(e),a=t.isItemFocused(e),l=t.isItemSelected(e),c=t.isItemDisabled(e);return{disabled:c,expanded:s,selected:l,focused:a,disableSelection:i,checkboxSelection:r,handleExpansion:r=>{if(!c){a||t.focusItem(r,e);const i=n&&(r.shiftKey||r.ctrlKey||r.metaKey);!o||i&&t.isItemExpanded(e)||t.toggleItemExpansion(r,e)}},handleSelection:r=>{c||(a||t.focusItem(r,e),n&&(r.shiftKey||r.ctrlKey||r.metaKey)?r.shiftKey?t.expandSelectionRange(r,e):t.selectItem(r,e,!0):t.selectItem(r,e,!1))},handleCheckboxSelection:r=>{if(i||c)return;const o=r.nativeEvent.shiftKey;n&&o?t.expandSelectionRange(r,e):t.selectItem(r,e,n,r.target.checked)},preventSelection:e=>{(e.shiftKey||e.ctrlKey||e.metaKey||c)&&e.preventDefault()}}}(c),S=a||s||o,M=e.useRef(null);return(0,Wy.jsxs)("div",(0,_n.Z)({},d,{className:(0,Ey.Z)(i,r.root,f&&r.expanded,m&&r.selected,g&&r.focused,p&&r.disabled),onClick:e=>{M.current?.contains(e.target)||(_(e),v||x(e),u&&u(e))},onMouseDown:e=>{w(e),h&&h(e)},ref:n,children:[(0,Wy.jsx)("div",{className:r.iconContainer,children:S}),v&&(0,Wy.jsx)(AB,{className:r.checkbox,checked:m,onChange:b,disabled:p||y,ref:M,tabIndex:-1}),(0,Wy.jsx)("div",{className:r.label,children:l})]}))}));function RB(e){return(0,lv.ZP)("MuiTreeItem",e)}const LB=(0,$y.Z)("MuiTreeItem",["root","groupTransition","content","expanded","selected","focused","disabled","iconContainer","label","checkbox"]),DB=(0,MS.Z)((0,Wy.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"TreeViewExpandIcon"),OB=(0,MS.Z)((0,Wy.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"TreeViewCollapseIcon");function NB(e){const{children:t,itemId:n}=e,{wrapItem:r}=tB();return r({children:t,itemId:n})}NB.propTypes={children:Nv().node,itemId:Nv().string.isRequired};const kB=["children","className","slots","slotProps","ContentComponent","ContentProps","itemId","id","label","onClick","onMouseDown","onFocus","onBlur","onKeyDown"],FB=["ownerState"],zB=["ownerState"],BB=["ownerState"],UB=(0,Iy.ZP)("li",{name:"MuiTreeItem",slot:"Root",overridesResolver:(e,t)=>t.root})({listStyle:"none",margin:0,padding:0,outline:0}),jB=(0,Iy.ZP)(PB,{name:"MuiTreeItem",slot:"Content",overridesResolver:(e,t)=>[t.content,t.iconContainer&&{[`& .${LB.iconContainer}`]:t.iconContainer},t.label&&{[`& .${LB.label}`]:t.label}]})((e=>{let{theme:t}=e;return{padding:t.spacing(.5,1),borderRadius:t.shape.borderRadius,width:"100%",boxSizing:"border-box",display:"flex",alignItems:"center",gap:t.spacing(1),cursor:"pointer",WebkitTapHighlightColor:"transparent","&:hover":{backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${LB.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,backgroundColor:"transparent"},[`&.${LB.focused}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${LB.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:EC(t.palette.primary.main,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:EC(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:EC(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${LB.focused}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:EC(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`& .${LB.iconContainer}`]:{width:16,display:"flex",flexShrink:0,justifyContent:"center","& svg":{fontSize:18}},[`& .${LB.label}`]:(0,_n.Z)({width:"100%",boxSizing:"border-box",minWidth:0,position:"relative"},t.typography.body1),[`& .${LB.checkbox}`]:{padding:0}}})),VB=(0,Iy.ZP)(bN,{name:"MuiTreeItem",slot:"GroupTransition",overridesResolver:(e,t)=>t.groupTransition})({margin:0,padding:0,paddingLeft:12}),GB=e.forwardRef((function(e,t){const{icons:n,runItemPlugins:r,selection:{multiSelect:i},disabledItemsFocusable:o,instance:s}=tB(),a=(0,Ry.Z)({props:e,name:"MuiTreeItem"}),{children:l,className:c,slots:u,slotProps:h,ContentComponent:d=PB,ContentProps:p,itemId:f,id:m,label:g,onClick:y,onMouseDown:v,onBlur:_,onKeyDown:x}=a,b=(0,My.Z)(a,kB),{contentRef:w,rootRef:S}=r(a),M=(0,F_.Z)(t,S),E=(0,F_.Z)(p?.ref,w),T={expandIcon:u?.expandIcon??n.slots.expandIcon??DB,collapseIcon:u?.collapseIcon??n.slots.collapseIcon??OB,endIcon:u?.endIcon??n.slots.endIcon,icon:u?.icon,groupTransition:u?.groupTransition},C=e=>Array.isArray(e)?e.length>0&&e.some(C):Boolean(e),A=C(l),I=s.isItemExpanded(f),P=s.isItemFocused(f),R=s.isItemSelected(f),L=s.isItemDisabled(f),D=(0,_n.Z)({},a,{expanded:I,focused:P,selected:R,disabled:L}),O=(e=>{const{classes:t}=e;return(0,Cy.Z)({root:["root"],content:["content"],expanded:["expanded"],selected:["selected"],focused:["focused"],disabled:["disabled"],iconContainer:["iconContainer"],checkbox:["checkbox"],label:["label"],groupTransition:["groupTransition"]},RB,t)})(D),N=T.groupTransition??void 0,k=gb({elementType:N,ownerState:{},externalSlotProps:h?.groupTransition,additionalProps:{unmountOnExit:!0,in:I,component:"ul",role:"group"},className:O.groupTransition}),F=I?T.collapseIcon:T.expandIcon,z=gb({elementType:F,ownerState:{},externalSlotProps:e=>I?(0,_n.Z)({},kv(n.slotProps.collapseIcon,e),kv(h?.collapseIcon,e)):(0,_n.Z)({},kv(n.slotProps.expandIcon,e),kv(h?.expandIcon,e))}),B=(0,My.Z)(z,FB),U=A&&F?(0,Wy.jsx)(F,(0,_n.Z)({},B)):null,j=A?void 0:T.endIcon,V=gb({elementType:j,ownerState:{},externalSlotProps:e=>A?{}:(0,_n.Z)({},kv(n.slotProps.endIcon,e),kv(h?.endIcon,e))}),G=(0,My.Z)(V,zB),H=j?(0,Wy.jsx)(j,(0,_n.Z)({},G)):null,Z=T.icon,W=gb({elementType:Z,ownerState:{},externalSlotProps:h?.icon}),$=(0,My.Z)(W,BB),q=Z?(0,Wy.jsx)(Z,(0,_n.Z)({},$)):null;let X;i?X=R:R&&(X=!0);const Y=s.getTreeItemIdAttribute(f,m),K=s.canItemBeTabbed(f)?0:-1;return(0,Wy.jsx)(NB,{itemId:f,children:(0,Wy.jsxs)(UB,(0,_n.Z)({className:(0,Ey.Z)(O.root,c),role:"treeitem","aria-expanded":A?I:void 0,"aria-selected":X,"aria-disabled":L||void 0,id:Y,tabIndex:K},b,{ownerState:D,onFocus:function(e){!P&&(!L||o)&&e.currentTarget===e.target&&s.focusItem(e,f)},onBlur:function(e){_?.(e),s.removeFocusedItem()},onKeyDown:e=>{x?.(e),s.handleItemKeyDown(e,f)},ref:M,children:[(0,Wy.jsx)(jB,(0,_n.Z)({as:d,classes:{root:O.content,expanded:O.expanded,selected:O.selected,focused:O.focused,disabled:O.disabled,iconContainer:O.iconContainer,label:O.label,checkbox:O.checkbox},label:g,itemId:f,onClick:y,onMouseDown:v,icon:q,expansionIcon:U,displayIcon:H,ownerState:D},p,{ref:E})),l&&(0,Wy.jsx)(VB,(0,_n.Z)({as:N},k,{children:l}))]}))})}));Ye().extend(Je());const HB="#LINK",ZB="ROOT",WB={[PD.APRON]:[PD.APRON_ELEMENT],[PD.INSTRUMENT_APPROACH_PROCEDURE]:[PD.ARRIVAL_FEEDER_LEG,PD.FINAL_LEG,PD.INITIAL_LEG,PD.INTERMEDIATE_LEG,PD.MISSED_APPROACH_LEG],[PD.NAVAID]:[PD.LOCALIZER,PD.GLIDEPATH,PD.VOR,PD.TACAN,PD.DME,PD.MARKER_BEACON,PD.NDB,PD.SDF,PD.ELEVATION,PD.DIRECTION_FINDER,PD.AZIMUTH],[PD.OBSTACLE_AREA]:[PD.VERTICAL_STRUCTURE],[PD.ROUTE]:[PD.ROUTE_SEGMENT],[PD.RUNWAY]:[PD.RUNWAY_ELEMENT],[PD.STANDARD_INSTRUMENT_ARRIVAL]:[PD.ARRIVAL_LEG],[PD.STANDARD_INSTRUMENT_DEPARTURE]:[PD.DEPARTURE_LEG],[PD.TAXIWAY]:[PD.TAXIWAY_ELEMENT],[PD.EVENT]:Object.values(PD)};function $B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=[];return Array.isArray(e)?n=e.flatMap(((e,n)=>{const r=`${t}${n}`;return[r,...$B(e,`${r}-`)]})):"object"==typeof e&&null!==e&&(n=Object.entries(e).flatMap(((e,n)=>{let[r,i]=e;const o=`${t}${n}`;return[o,...$B(i,`${o}-`)]}))),n}function qB(t){const n=BD(),{options:r=[],identifier:i,name:o}=t,[s,a]=(0,e.useState)(null),[l,c]=(0,e.useState)(!0);return r.length>0?(0,Wy.jsxs)("div",{className:"d-flex flex-column",children:[r.map((e=>(0,Wy.jsx)(Tv,{disabled:s&&s!==e.processId,onClick:()=>function(e){kD[e]?(a(e),c(!0)):hy("Undefined NOTAM scenario.",{variant:"error"})}(e.processId),children:e.name},e.processId))),(0,Wy.jsx)(dD,{disablePortal:!0,fullWidth:!0,open:!!s,sx:l?{}:{display:"none"},children:n.notamController.createForm(s,{identifier:i,name:o,onClose:()=>a(null),onHide:()=>c(!1),visible:l})})]}):null}function XB(e,t,n){if(t||qe().isEmpty(e))return null;const{Identifier:r,Name:i,Type:o}=e;return(0,Wy.jsxs)("div",{className:"aixm-feature-header",children:[(0,Wy.jsxs)(aR,{id:`${CD.key}-feature-header-list-item`,sx:{bgcolor:"background.paper",margin:0},children:[(0,Wy.jsx)(bz,{primary:(0,Wy.jsx)(LM,{sx:{fontSize:11,lineHeight:"16px"},variant:"overline",children:DF.text(o)}),secondary:(0,Wy.jsxs)(LM,{component:"div",sx:{display:"flex",flexDirection:"column"},children:[(0,Wy.jsx)(_F,{id:`${CD.key}-feature-header-name-copy-button`,title:i,children:(0,Wy.jsx)(LM,{noWrap:!0,variant:"body1",children:i})}),(0,Wy.jsx)(_F,{id:`${CD.key}-feature-header-identifier-copy-button`,title:r,children:(0,Wy.jsx)(LM,{noWrap:!0,variant:"body2",sx:{textTransform:"none"},children:r})})]}),sx:{margin:0}}),(0,Wy.jsx)(qB,{options:n,identifier:r,name:i})]}),(0,Wy.jsx)(Hv,{})]})}function YB(e){const t=qe().get(e,"NOTAM Text");return t?(0,Wy.jsx)("div",{className:"d-flex flex-column p-3 gap-3",children:t.map(((e,t)=>(0,Wy.jsx)(lk,{className:"aixm-notam-container",variant:"outlined",children:(0,Wy.jsxs)(pk,{children:[(0,Wy.jsxs)("pre",{children:["Q)",`${e["Affected FIR"]}/${e["First Letter"]}${e["Second And Third Letter"]}${e["Forth And Fifth Letter"]}/${e["Affected Traffic"]}/${e.Purpose}/${e.Scope}/${e["Minimum FL"]}/${e["Maximum FL"]}/${[e.Coordinates]}${e.Radius}`]}),(0,Wy.jsxs)("pre",{children:["A)",e.Location]}),(0,Wy.jsxs)("pre",{children:["B)",e["Effective Start"]]}),(0,Wy.jsxs)("pre",{children:["C)",e["Effective End"]]}),e.Schedule&&(0,Wy.jsxs)("pre",{children:["D)",e.Schedule]}),(0,Wy.jsxs)("pre",{children:["E)",`${e.Text}`]})]})},t)))}):null}function KB(){return(0,Wy.jsx)(lz.Z,{sx:{opacity:.8}})}function JB(){return(0,Wy.jsx)(rk,{sx:{borderBlockEnd:"1px dashed rgba(0,0,0,0.4)",width:14}})}function QB(){return(0,Wy.jsx)(cz.Z,{})}function eU(){return(0,Wy.jsx)(lz.Z,{sx:{opacity:.8,transform:"rotate(-90deg)"}})}const tU=K((function(e){return{config:UD(e),lastFeaturesUpdate:nO(e),selectedAIXMFeature:rO(e),repository:iO(e),updatedFeatures:sO(e)}}),(function(e){return{setHighlightedFeatures:function(){var t;e((t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],function(e){e(tt(CD.key,{highlightedFeatures:t}))}))},setSelectedAIXMFeature:function(t){var n;e((n=t,function(e){e(tt(CD.key,{selectedAIXMFeature:n}))}))}}}))((function(t){const{focused:n,lastFeaturesUpdate:r,selectedAIXMFeature:i,repository:o,setHighlightedFeatures:s,setSelectedAIXMFeature:a,updatedFeatures:l}=t,c=BD(),u=c.apiController.getConfig(),h=dN(r),d=dN(i),p=dN(o),f=dN(l),[m,g]=(0,e.useState)([]),[y,v]=(0,e.useState)({}),[_,x]=(0,e.useState)(""),[b,w]=(0,e.useState)(!i),[S,M]=(0,e.useState)(!1),{Feature:E={},Parents:T=[],Children:C=[],InitiableProcesses:A=[],...I}=y,P=!qe().isEmpty(y),R=!qe().isEmpty(I),L=!qe().isEmpty(C),[D,O]=hN(n&&L);return(0,e.useEffect)((()=>(c.apiController.on("feature-select",a),()=>{c.apiController.off("feature-select",a)})),[]),(0,e.useEffect)((()=>{R&&g($B(I))}),[y]),(0,e.useEffect)((()=>{if(o)if(i!==d||o!==p)i?F():z();else if(r!==h){const e=[i,...((null==y?void 0:y.Parents)||[]).map((e=>e.Identifier)),...((null==y?void 0:y.Children)||[]).map((e=>e.Identifier))];i&&!qe().isEmpty(qe().intersection(l,e))?F():!i&&l.length&&z()}}),[r,i,h,d,o,p,l,f]),n?S?(0,Wy.jsx)("div",{className:"align-items-center d-flex flex-grow-1 justify-content-center",children:(0,Wy.jsx)(Ck,{})}):(0,Wy.jsxs)("section",{className:"d-flex flex-column overflow-x-hidden overflow-y-auto flex-grow-1 position-relative",children:[P?(0,Wy.jsxs)(Wy.Fragment,{children:[function(){if(b)return null;const e=[{Identifier:ZB},...T];return(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)(Mb,{id:`${CD.key}-feature-parents-list`,children:e.map((e=>(0,Wy.jsx)(aR,{disablePadding:!0,children:(0,Wy.jsxs)(pz,{id:`${CD.key}-feature-parents-list-item-${e.Identifier}`,onClick:()=>c.apiController.selectAndFitToFeature(e.Identifier===ZB?null:e.Identifier),sx:{minHeight:72},children:[(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(qN.Z,{})}),(0,Wy.jsx)(bz,{primary:DF.text(e.Type),secondary:e.Name})]})},e.Identifier)))}),(0,Wy.jsx)(Hv,{})]})}(),XB(E,b,A),R&&(0,Wy.jsxs)(Wy.Fragment,{children:[YB(I),(0,Wy.jsx)(uB,{expandedItems:m,id:`${CD.key}-feature-detail-tree-view`,onExpandedItemsChange:(e,t)=>g(t),slots:{expandIcon:eU,collapseIcon:KB,endIcon:JB},sx:{paddingBlock:1},children:function e(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t&&!b?Object.keys(t).map(((r,i)=>{const o=n?`${n}-${i}`:`${i}`,s=t[r];return Array.isArray(s)?(0,Wy.jsx)(GB,{itemId:o,label:`${r} (${s.length})`,children:s.map(((t,n)=>{const r=`${o}-${n}`;return(0,Wy.jsx)(GB,{itemId:r,label:`#${n+1}`,children:e(t,r)},r)}))},o):"object"==typeof s&&null!==s?r.includes(HB)?(0,Wy.jsx)(GB,{itemId:o,label:r.replace(HB,""),onClick:()=>c.apiController.selectAndFitToFeature(s.Identifier),slots:{expandIcon:QB,collapseIcon:QB,endIcon:QB},children:e(s,o)},o):(0,Wy.jsx)(GB,{itemId:o,label:r,children:e(s,o)},o):(0,Wy.jsx)(GB,{itemId:o,label:(0,Wy.jsxs)("div",{className:"align-items-center d-flex justify-content-between",children:[(0,Wy.jsx)(LM,{color:"text.primary",sx:{fontSize:"inherit"},children:r}),(0,Wy.jsx)(LM,{color:"text.secondary",sx:{textTransform:"capitalize"},variant:"overline",children:s})]}),slots:n.length?{}:{endIcon:()=>null}},o)})):null}(I)})]})]}):(0,Wy.jsx)(Wy.Fragment,{children:(0,Wy.jsxs)("div",{className:"align-items-center d-flex flex-column flex-grow-1 gap-4 justify-content-center p-3",children:[(0,Wy.jsx)(YN.Z,{sx:{color:"text.secondary",height:120,width:120}}),(0,Wy.jsx)(LM,{color:"text.primary",variant:"h5",children:"Invalid feature"}),(0,Wy.jsx)(Tv,{onClick:()=>c.apiController.selectAndFitToFeature(null),variant:"outlined",children:"Return to root feature"})]})}),L&&(0,Wy.jsxs)(Wy.Fragment,{children:[!b&&(0,Wy.jsx)(Hv,{}),(0,Wy.jsx)("div",{className:"aixm-children-search "+(b?"root":""),children:(0,Wy.jsx)(BS,{fullWidth:!0,id:`${CD.key}-feature-children-search`,onChange:e=>x(e.target.value),placeholder:"Search features",sx:{bgcolor:"background.paper"},type:"search",value:_,variant:"filled",InputProps:{startAdornment:(0,Wy.jsx)(BM,{position:"start",children:(0,Wy.jsx)(wz.Z,{})})}})}),function(e){const t=qe().groupBy(e,"Type");return(0,Wy.jsx)(Wy.Fragment,{children:qe().sortBy(Object.keys(t)).map((e=>{var n,r;return(0,Wy.jsxs)(LN,{expanded:D.includes(e)||_.length>0,onChange:()=>O(e),slotProps:{transition:{unmountOnExit:!0}},square:!0,children:[(0,Wy.jsx)($N,{expandIcon:(0,Wy.jsx)(az.Z,{}),id:`${CD.key}-feature-children-accordion-${e}`,children:DF.text(e)}),(0,Wy.jsx)(zN,{children:(0,Wy.jsx)(Mb,{disablePadding:!0,id:`${CD.key}-feature-children-list-${e}`,children:null==t||null===(n=t[e])||void 0===n||null===(r=n.map)||void 0===r?void 0:r.call(n,(t=>(0,Wy.jsxs)(pz,{id:`${CD.key}-filter-aixm-type-list-${e}-list-item-${t.Identifier}`,onClick:()=>c.apiController.selectAndFitToFeature(t.Identifier),children:[(0,Wy.jsx)(bz,{primary:t.Name,secondary:t.Identifier}),(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(XN.Z,{})})]},t.Identifier)))})})]},e)}))})}((N=C,k=_,N.filter((e=>e.Name.toLowerCase().includes(k.toLowerCase())||e.Identifier.toLowerCase().includes(k.toLowerCase())||e.Type.toLowerCase().includes(k.toLowerCase())))))]})]}):null;var N,k;function F(){v({}),M(!0),Promise.allSettled([c.authRequest.get(`/collections/${o.id}/items/?datetime=${Ye()().utc().toISOString()}&featureIdentifier=${i}&excludeGeometry=true&includeOnlyTimesliceTypes=AEROSNAPSHOT&includeParents=true&includeChildren=true&excludeFeaturesWithoutGeometry=false`,u.adsUri),u.enabledNotamCreation?c.authRequest.post("/poc/api/v0/workflows/getInitiableProcesses",{entitydId:i},u.adsUri):Promise.reject()]).then((e=>{const[t,n]=e;if("fulfilled"===t.status){const e=t.value;if(e){let t=e[0];var r,i;"fulfilled"===n.status&&(t.InitiableProcesses=(null===(r=n.value)||void 0===r||null===(i=r[0])||void 0===i?void 0:i.initiatableProcesses)||[]),w(!1),v(t),s([t.Feature.Identifier,...t.Children.filter((e=>(WB[t.Feature.Type]||[]).includes(e.Type))).map((e=>e.Identifier))])}}})).finally((()=>{x(""),M(!1)}))}function z(){v({}),M(!0),c.authRequest.get(`/collections/${o.id}/items/?datetime=${Ye()().utc().toISOString()}&limit=0&excludeGeometry=true&includeOnlyTimesliceTypes=GEOSNAPSHOT&includeParents=true&includeChildren=true&onlyRootFeature=true&excludeFeaturesWithoutGeometry=false`,u.adsUri).then((e=>{if(e){const t=e.features;w(!0),v({Children:t.map((e=>({Identifier:e.properties.identifier,Name:e.properties.label,Type:e.properties.aixmType.replace("aixm:","")})))}),s()}})).catch((e=>{console.log("failed getting feature detail",e)})).finally((()=>{M(!1)}))}}));var nU=i(3714);const rU=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=OE,rootShouldForwardProp:r=DE,slotShouldForwardProp:i=DE}=e,o=e=>(0,IE.Z)((0,_n.Z)({},e,{theme:kE((0,_n.Z)({},e,{defaultTheme:n,themeId:t}))}));return o.__mui_systemSx=!0,function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,CE.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:a,slot:l,skipVariantsResolver:c,skipSx:u,overridesResolver:h=FE(NE(l))}=s,d=(0,My.Z)(s,LE),p=void 0!==c?c:l&&"Root"!==l&&"root"!==l||!1,f=u||!1;let m=DE;"Root"===l||"root"===l?m=r:l?m=i:function(e){return"string"==typeof e&&e.charCodeAt(0)>96}(e)&&(m=void 0);const g=(0,CE.default)(e,(0,_n.Z)({shouldForwardProp:m,label:void 0},d)),y=e=>"function"==typeof e&&e.__emotion_real!==e||(0,N_.P)(e)?r=>zE(e,(0,_n.Z)({},r,{theme:kE({theme:r.theme,defaultTheme:n,themeId:t})})):e,v=function(r){let i=y(r);for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];const u=l?l.map(y):[];a&&h&&u.push((e=>{const r=kE((0,_n.Z)({},e,{defaultTheme:n,themeId:t}));if(!r.components||!r.components[a]||!r.components[a].styleOverrides)return null;const i=r.components[a].styleOverrides,o={};return Object.entries(i).forEach((t=>{let[n,i]=t;o[n]=zE(i,(0,_n.Z)({},e,{theme:r}))})),h(e,o)})),a&&!p&&u.push((e=>{var r;const i=kE((0,_n.Z)({},e,{defaultTheme:n,themeId:t}));return zE({variants:null==i||null==(r=i.components)||null==(r=r[a])?void 0:r.variants},(0,_n.Z)({},e,{theme:i}))})),f||u.push(o);const d=u.length-l.length;if(Array.isArray(r)&&d>0){const e=new Array(d).fill("");i=[...r,...e],i.raw=[...r.raw,...e]}const m=g(i,...u);return e.muiName&&(m.muiName=e.muiName),m};return g.withConfig&&(v.withConfig=g.withConfig),v}}(),iU=rU;var oU=i(4614),sU=i(4929),aU=i(6886);const lU=["component","direction","spacing","divider","children","className","useFlexGap"],cU=(0,AE.Z)(),uU=iU("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function hU(e){return(0,oU.Z)({props:e,name:"MuiStack",defaultTheme:cU})}function dU(t,n){const r=e.Children.toArray(t).filter(Boolean);return r.reduce(((t,i,o)=>(t.push(i),o<r.length-1&&t.push(e.cloneElement(n,{key:`separator-${o}`})),t)),[])}const pU=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[e]),fU=e=>{let{ownerState:t,theme:n}=e,r=(0,_n.Z)({display:"flex",flexDirection:"column"},(0,sU.k9)({theme:n},(0,sU.P$)({values:t.direction,breakpoints:n.breakpoints.values}),(e=>({flexDirection:e}))));if(t.spacing){const e=(0,aU.hB)(n),i=Object.keys(n.breakpoints.values).reduce(((e,n)=>(("object"==typeof t.spacing&&null!=t.spacing[n]||"object"==typeof t.direction&&null!=t.direction[n])&&(e[n]=!0),e)),{}),o=(0,sU.P$)({values:t.direction,base:i}),s=(0,sU.P$)({values:t.spacing,base:i});"object"==typeof o&&Object.keys(o).forEach(((e,t,n)=>{if(!o[e]){const r=t>0?o[n[t-1]]:"column";o[e]=r}}));const a=(n,r)=>t.useFlexGap?{gap:(0,aU.NA)(e,n)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${pU(r?o[r]:t.direction)}`]:(0,aU.NA)(e,n)}};r=(0,N_.Z)(r,(0,sU.k9)({theme:n},s,a))}return r=(0,sU.dt)(n.breakpoints,r),r},mU=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:n=uU,useThemeProps:r=hU,componentName:i="MuiStack"}=t,o=n(fU),s=e.forwardRef((function(e,t){const n=r(e),s=(0,EM.Z)(n),{component:a="div",direction:l="column",spacing:c=0,divider:u,children:h,className:d,useFlexGap:p=!1}=s,f=(0,My.Z)(s,lU),m={direction:l,spacing:c,useFlexGap:p},g=(0,Cy.Z)({root:["root"]},(e=>(0,lv.ZP)(i,e)),{});return(0,Wy.jsx)(o,(0,_n.Z)({as:a,ownerState:m,ref:t,className:(0,Ey.Z)(g.root,d)},f,{children:u?dU(h,u):h}))}));return s}({createStyledComponent:(0,Iy.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,Ry.Z)({props:e,name:"MuiStack"})}),gU=mU;function yU(e){return(0,lv.ZP)("MuiFormControlLabel",e)}const vU=(0,$y.Z)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),_U=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],xU=(0,Iy.ZP)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${vU.label}`]:t.label},t.root,t[`labelPlacement${(0,mv.Z)(n.labelPlacement)}`]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,_n.Z)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${vU.disabled}`]:{cursor:"default"}},"start"===n.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===n.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===n.labelPlacement&&{flexDirection:"column",marginLeft:16},{[`& .${vU.label}`]:{[`&.${vU.disabled}`]:{color:(t.vars||t).palette.text.disabled}}})})),bU=(0,Iy.ZP)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})((e=>{let{theme:t}=e;return{[`&.${vU.error}`]:{color:(t.vars||t).palette.error.main}}})),wU=e.forwardRef((function(t,n){var r,i;const o=(0,Ry.Z)({props:t,name:"MuiFormControlLabel"}),{className:s,componentsProps:a={},control:l,disabled:c,disableTypography:u,label:h,labelPlacement:d="end",required:p,slotProps:f={}}=o,m=(0,My.Z)(o,_U),g=$_(),y=null!=(r=null!=c?c:l.props.disabled)?r:null==g?void 0:g.disabled,v=null!=p?p:l.props.required,_={disabled:y,required:v};["checked","name","onChange","value","inputRef"].forEach((e=>{void 0===l.props[e]&&void 0!==o[e]&&(_[e]=o[e])}));const x=Z_({props:o,muiFormControl:g,states:["error"]}),b=(0,_n.Z)({},o,{disabled:y,labelPlacement:d,required:v,error:x.error}),w=(e=>{const{classes:t,disabled:n,labelPlacement:r,error:i,required:o}=e,s={root:["root",n&&"disabled",`labelPlacement${(0,mv.Z)(r)}`,i&&"error",o&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",i&&"error"]};return(0,Cy.Z)(s,yU,t)})(b),S=null!=(i=f.typography)?i:a.typography;let M=h;return null==M||M.type===LM||u||(M=(0,Wy.jsx)(LM,(0,_n.Z)({component:"span"},S,{className:(0,Ey.Z)(w.label,null==S?void 0:S.className),children:M}))),(0,Wy.jsxs)(xU,(0,_n.Z)({className:(0,Ey.Z)(w.root,s),ownerState:b,ref:n},m,{children:[e.cloneElement(l,_),v?(0,Wy.jsxs)(gU,{display:"block",children:[M,(0,Wy.jsxs)(bU,{ownerState:b,"aria-hidden":!0,className:w.asterisk,children:["","*"]})]}):M]}))})),SU=wU;function MU(e){return(0,lv.ZP)("MuiToggleButton",e)}const EU=(0,$y.Z)("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),TU=e.createContext({}),CU=e.createContext(void 0);function AU(e,t){return void 0!==t&&void 0!==e&&(Array.isArray(t)?t.indexOf(e)>=0:e===t)}const IU=["value"],PU=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],RU=(0,Iy.ZP)(fv,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`size${(0,mv.Z)(n.size)}`]]}})((e=>{let t,{theme:n,ownerState:r}=e,i="standard"===r.color?n.palette.text.primary:n.palette[r.color].main;return n.vars&&(i="standard"===r.color?n.vars.palette.text.primary:n.vars.palette[r.color].main,t="standard"===r.color?n.vars.palette.text.primaryChannel:n.vars.palette[r.color].mainChannel),(0,_n.Z)({},n.typography.button,{borderRadius:(n.vars||n).shape.borderRadius,padding:11,border:`1px solid ${(n.vars||n).palette.divider}`,color:(n.vars||n).palette.action.active},r.fullWidth&&{width:"100%"},{[`&.${EU.disabled}`]:{color:(n.vars||n).palette.action.disabled,border:`1px solid ${(n.vars||n).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:n.vars?`rgba(${n.vars.palette.text.primaryChannel} / ${n.vars.palette.action.hoverOpacity})`:EC(n.palette.text.primary,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${EU.selected}`]:{color:i,backgroundColor:n.vars?`rgba(${t} / ${n.vars.palette.action.selectedOpacity})`:EC(i,n.palette.action.selectedOpacity),"&:hover":{backgroundColor:n.vars?`rgba(${t} / calc(${n.vars.palette.action.selectedOpacity} + ${n.vars.palette.action.hoverOpacity}))`:EC(i,n.palette.action.selectedOpacity+n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:n.vars?`rgba(${t} / ${n.vars.palette.action.selectedOpacity})`:EC(i,n.palette.action.selectedOpacity)}}}},"small"===r.size&&{padding:7,fontSize:n.typography.pxToRem(13)},"large"===r.size&&{padding:15,fontSize:n.typography.pxToRem(15)})})),LU=e.forwardRef((function(t,n){const r=e.useContext(TU),{value:i}=r,o=(0,My.Z)(r,IU),s=e.useContext(CU),a=(0,Ty.Z)((0,_n.Z)({},o,{selected:AU(t.value,i)}),t),l=(0,Ry.Z)({props:a,name:"MuiToggleButton"}),{children:c,className:u,color:h="standard",disabled:d=!1,disableFocusRipple:p=!1,fullWidth:f=!1,onChange:m,onClick:g,selected:y,size:v="medium",value:_}=l,x=(0,My.Z)(l,PU),b=(0,_n.Z)({},l,{color:h,disabled:d,disableFocusRipple:p,fullWidth:f,size:v}),w=(e=>{const{classes:t,fullWidth:n,selected:r,disabled:i,size:o,color:s}=e,a={root:["root",r&&"selected",i&&"disabled",n&&"fullWidth",`size${(0,mv.Z)(o)}`,s]};return(0,Cy.Z)(a,MU,t)})(b),S=s||"";return(0,Wy.jsx)(RU,(0,_n.Z)({className:(0,Ey.Z)(o.className,w.root,u,S),disabled:d,focusRipple:!p,ref:n,onClick:e=>{g&&(g(e,_),e.defaultPrevented)||m&&m(e,_)},onChange:m,value:_,ownerState:b,"aria-pressed":y},x,{children:c}))})),DU=LU;function OU(e){return(0,lv.ZP)("MuiToggleButtonGroup",e)}const NU=(0,$y.Z)("MuiToggleButtonGroup",["root","selected","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),kU=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],FU=(0,Iy.ZP)("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${NU.grouped}`]:t.grouped},{[`& .${NU.grouped}`]:t[`grouped${(0,mv.Z)(n.orientation)}`]},{[`& .${NU.firstButton}`]:t.firstButton},{[`& .${NU.lastButton}`]:t.lastButton},{[`& .${NU.middleButton}`]:t.middleButton},t.root,"vertical"===n.orientation&&t.vertical,n.fullWidth&&t.fullWidth]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({display:"inline-flex",borderRadius:(n.vars||n).shape.borderRadius},"vertical"===t.orientation&&{flexDirection:"column"},t.fullWidth&&{width:"100%"},{[`& .${NU.grouped}`]:(0,_n.Z)({},"horizontal"===t.orientation?{[`&.${NU.selected} + .${NU.grouped}.${NU.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${NU.selected} + .${NU.grouped}.${NU.selected}`]:{borderTop:0,marginTop:0}})},"horizontal"===t.orientation?{[`& .${NU.firstButton},& .${NU.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${NU.lastButton},& .${NU.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${NU.firstButton},& .${NU.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${NU.lastButton},& .${NU.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},"horizontal"===t.orientation?{[`& .${NU.lastButton}.${EU.disabled},& .${NU.middleButton}.${EU.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${NU.lastButton}.${EU.disabled},& .${NU.middleButton}.${EU.disabled}`]:{borderTop:"1px solid transparent"}})})),zU=e.forwardRef((function(t,n){const r=(0,Ry.Z)({props:t,name:"MuiToggleButtonGroup"}),{children:i,className:o,color:s="standard",disabled:a=!1,exclusive:l=!1,fullWidth:c=!1,onChange:u,orientation:h="horizontal",size:d="medium",value:p}=r,f=(0,My.Z)(r,kU),m=(0,_n.Z)({},r,{disabled:a,fullWidth:c,orientation:h,size:d}),g=(e=>{const{classes:t,orientation:n,fullWidth:r,disabled:i}=e,o={root:["root","vertical"===n&&"vertical",r&&"fullWidth"],grouped:["grouped",`grouped${(0,mv.Z)(n)}`,i&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return(0,Cy.Z)(o,OU,t)})(m),y=e.useCallback(((e,t)=>{if(!u)return;const n=p&&p.indexOf(t);let r;p&&n>=0?(r=p.slice(),r.splice(n,1)):r=p?p.concat(t):[t],u(e,r)}),[u,p]),v=e.useCallback(((e,t)=>{u&&u(e,p===t?null:t)}),[u,p]),_=e.useMemo((()=>({className:g.grouped,onChange:l?v:y,value:p,size:d,fullWidth:c,color:s,disabled:a})),[g.grouped,l,v,y,p,d,c,s,a]),x=function(t){return e.Children.toArray(t).filter((t=>e.isValidElement(t)))}(i),b=x.length,w=e=>{const t=0===e,n=e===b-1;return t&&n?"":t?g.firstButton:n?g.lastButton:g.middleButton};return(0,Wy.jsx)(FU,(0,_n.Z)({role:"group",className:(0,Ey.Z)(g.root,o),ref:n,ownerState:m},f,{children:(0,Wy.jsx)(TU.Provider,{value:_,children:x.map(((e,t)=>(0,Wy.jsx)(CU.Provider,{value:w(t),children:e},t)))})}))})),BU=zU,UU=[{name:"NAS - National Airspace System",key:"NAS"},{name:"FIR - Flight Information Region",key:"FIR"},{name:"FIR_P - Part of Flight Information Region",key:"FIR_P"},{name:"UIR - Upper Flight Information Region",key:"UIR"},{name:"UIR_P - Part of Upper Flight Information Region",key:"UIR_P"},{name:"CTA - Control Area",key:"CTA"},{name:"CTA_P - Part of Control Area",key:"CTA_P"},{name:"OCA - Oceanic Control Area",key:"OCA"},{name:"OCA_P - Part of Oceanic Control Area",key:"OCA_P"},{name:"UTA - Upper Control Area",key:"UTA"},{name:"UTA_P - Part of Upper Control Area",key:"UTA_P"},{name:"TMA - Terminal Control Area",key:"TMA"},{name:"TMA_P - Part of Terminal Control Area",key:"TMA_P"},{name:"CTR - Control Zone",key:"CTR"},{name:"CTR_P - Part of Control Zone",key:"CTR_P"},{name:"OTA - Oceanic Transition Area",key:"OTA"},{name:"SECTOR - Control Sector",key:"SECTOR"},{name:"SECTOR_C - Temporary Consolidated Sector",key:"SECTOR_C"},{name:"TSA - Temporary Segregated Area",key:"TSA"},{name:"CBA - Cross Border Area",key:"CBA"},{name:"RCA - Reduced Co-Ordination Area",key:"RCA"},{name:"RAS - Regulated Airspace",key:"RAS"},{name:"AWY - Airway (Corridor)",key:"AWY"},{name:"MTR - Military Training Route",key:"MTR"},{name:"P - Prohibited Area",key:"P"},{name:"R - Restricted Area",key:"R"},{name:"D - Danger Area",key:"D"},{name:"ADIZ - Air Defence Identification Zone",key:"ADIZ"},{name:"NO_FIR - Not Even FIR is defined",key:"NO_FIR"},{name:"PART - Part of an Airspace",key:"PART"},{name:"CLASS - Airspace having a specified class",key:"CLASS"},{name:"POLITICAL - Political / Administrative Area",key:"POLITICAL"},{name:"D_OTHER - Activities of Dangerous Nature",key:"D_OTHER"},{name:"TRA - Temporary Reserved Area",key:"TRA"},{name:"A - Alert Area",key:"A"},{name:"W - Warning Area",key:"W"},{name:"PROTECT - Airspace protected from specific air traffic",key:"PROTECT"},{name:"AMA - Minimum Altitude Area",key:"AMA"},{name:"ASR - Altimeter Setting Region",key:"ASR"},{name:"ADV - Advisory Area",key:"ADV"},{name:"UADV - Upper Advisory Area",key:"UADV"},{name:"ATZ - Airport Traffic Zone",key:"ATZ"},{name:"ATZ_P - Part of Airport Traffic Zone",key:"ATZ_P"},{name:"HTZ - Helicopter Traffic Zone",key:"HTZ"},{name:"NAS_P - Part of National Airspace System",key:"NAS_P"},{name:"OTHER - Other",key:"OTHER"}],jU={FT:"FT",FL:"FL",M:"M",SM:"SM"},VU={MSL:"MSL",SFC:"SFC",STD:"STD",W84:"W84"},GU={reference:VU.STD,unit:jU.FL,value:245},HU=K((function(e){return{datasets:JD(e),filter:eO(e),selectedRepository:iO(e)}}),(function(e){return{setFilter:function(t){e(KD(t))}}}))((function(t){const{datasets:n,filter:r,focused:i,selectedRepository:o,setFilter:s}=t,{aixmFeaturesBlacklist:a,airspaceTypeBlacklist:l,vertical:c}=r,[u,h]=(0,e.useState)(""),[d,p]=(0,e.useState)(""),[f,m]=(0,e.useState)(c),[g,y]=hN(i);if((0,e.useEffect)((()=>m(c)),[c]),(0,e.useEffect)((()=>s(YD.filter)),[o]),i){const e=qe().uniq(qe().flatten(qe().values(n))),t=e.length-a.length,i=UU.length-l.length,o=qe().omit(f,"otherReferences"),m={from:YD.filter.vertical.from,to:GU},b={from:GU,to:YD.filter.vertical.to};return(0,Wy.jsxs)("section",{className:"d-flex flex-column overflow-x-hidden overflow-y-auto flex-grow-1 position-relative",children:[(0,Wy.jsxs)(LN,{square:!0,children:[(0,Wy.jsxs)($N,{className:"accordion-summary-filter",expandIcon:(0,Wy.jsx)(az.Z,{}),id:`${CD.key}-aixm-type-filter-accordion`,children:[(0,Wy.jsx)(AB,{checked:0===a.length,id:`${CD.key}-aixm-type-filter-select-all-checkbox`,indeterminate:a.length>0&&a.length<e.length,onClick:e=>e.stopPropagation(),onChange:t=>v(t,"aixmFeaturesBlacklist",e),title:"Select all features"}),(0,Wy.jsx)(LM,{component:"pre",variant:"body2",children:"Feature filter "}),t>0&&(0,Wy.jsx)(LM,{color:"text.secondary",variant:"body2",children:`(${t})`})]}),(0,Wy.jsxs)(zN,{children:[(0,Wy.jsx)(BS,{fullWidth:!0,id:`${CD.key}-aixm-type-filter-search`,onChange:e=>p(e.target.value),placeholder:"Search features",type:"search",value:d,variant:"filled",InputProps:{startAdornment:(0,Wy.jsx)(BM,{position:"start",children:(0,Wy.jsx)(wz.Z,{})})}}),(0,Wy.jsx)(Mb,{id:`${CD.key}-aixm-type-filter-list`,children:Object.entries(n).map((e=>{let[t,i]=e;const o=g.includes(t)||d.length>0,l=qe().every(i,(e=>!a.includes(e))),c=qe().some(i,(e=>!a.includes(e)));return(0,Wy.jsxs)("div",{children:[(0,Wy.jsxs)(pz,{id:`${CD.key}-aixm-type-filter-list-item-${t}`,onClick:()=>y(t),children:[(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(AB,{checked:l,id:`${CD.key}-aixm-type-filter-checkbox-${t}`,indeterminate:c&&!l,onClick:e=>e.stopPropagation(),onChange:e=>function(e,t){const i=e.target.checked;s({...r,aixmFeaturesBlacklist:i?a.filter((e=>!n[t].includes(e))):qe().uniq([...a,...n[t]])})}(e,t),onMouseDown:e=>e.stopPropagation()})}),(0,Wy.jsx)(bz,{primary:t}),o?(0,Wy.jsx)(nU.Z,{}):(0,Wy.jsx)(az.Z,{})]}),(0,Wy.jsx)(bN,{in:o,unmountOnExit:!0,timeout:"auto",children:(0,Wy.jsx)(Mb,{component:"div",disablePadding:!0,id:`${CD.key}-aixm-type-filter-list-${t}`,children:i.filter((e=>e.toLowerCase().includes(d.toLowerCase()))).map((e=>{const n=a.includes(e);return(0,Wy.jsxs)(pz,{dense:!0,id:`${CD.key}-aixm-type-filter-list-${t}-list-item-${e}`,onClick:()=>_(e,"aixmFeaturesBlacklist",n),sx:{pl:6},children:[(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(AB,{checked:!n,disableRipple:!0,edge:"start",id:`${CD.key}-aixm-type-filter-list-${t}-checkbox-${e}`,size:"small",tabIndex:-1})}),(0,Wy.jsx)(bz,{primary:DF.text(e)})]},e)}))})})]},t)}))})]})]}),!a.includes(PD.AIRSPACE)&&(0,Wy.jsxs)(LN,{square:!0,children:[(0,Wy.jsxs)($N,{className:"accordion-summary-filter",expandIcon:(0,Wy.jsx)(az.Z,{}),id:`${CD.key}-airspace-type-filter-accordion`,children:[(0,Wy.jsx)(AB,{checked:0===l.length,id:`${CD.key}-airspace-type-filter-select-all-checkbox`,indeterminate:l.length>0&&l.length<UU.length,onClick:e=>e.stopPropagation(),onChange:e=>v(e,"airspaceTypeBlacklist",UU.map((e=>e.key))),title:"Select all airspace types"}),(0,Wy.jsx)(LM,{component:"pre",variant:"body2",children:"Airspace type filter "}),i>0&&(0,Wy.jsx)(LM,{color:"text.secondary",variant:"body2",children:`(${i})`})]}),(0,Wy.jsxs)(zN,{children:[(0,Wy.jsx)(BS,{fullWidth:!0,id:`${CD.key}-airspace-type-filter-search`,onChange:e=>h(e.target.value),placeholder:"Search airspace types",type:"search",value:u,variant:"filled",InputProps:{startAdornment:(0,Wy.jsx)(BM,{position:"start",children:(0,Wy.jsx)(wz.Z,{})})}}),(0,Wy.jsx)(Mb,{id:`${CD.key}-airspace-type-filter-list`,children:UU.filter((e=>e.key.toLowerCase().includes(u.toLowerCase())||e.name.toLowerCase().includes(u.toLowerCase()))).map((e=>{const t=l.includes(e.key);return(0,Wy.jsx)(aR,{disablePadding:!0,children:(0,Wy.jsxs)(pz,{dense:!0,id:`${CD.key}-airspace-type-filter-list-item-${e.key}`,onClick:()=>_(e.key,"airspaceTypeBlacklist",t),children:[(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(AB,{checked:!t,disableRipple:!0,edge:"start",id:`${CD.key}-airspace-type-filter-checkbox-${e.key}`,size:"small",tabIndex:-1})}),(0,Wy.jsx)(bz,{primary:e.name})]})},e.key)}))})]})]}),(0,Wy.jsxs)(LN,{square:!0,children:[(0,Wy.jsx)($N,{className:"accordion-summary-filter",expandIcon:(0,Wy.jsx)(az.Z,{}),id:`${CD.key}-vertical-filter-accordion`,children:"Vertical filter"}),(0,Wy.jsxs)(zN,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,Wy.jsxs)("div",{children:[(0,Wy.jsx)(LM,{marginBlockEnd:2,children:"From"}),(0,Wy.jsxs)("div",{className:"grid-cols-2 grid-gap-4",children:[(0,Wy.jsx)(BS,{fullWidth:!0,id:`${CD.key}-vertical-filter-from-value-textfield`,inputProps:{min:0},label:"Value",onChange:e=>x({from:{...f.from,value:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}}),sx:{gridColumn:"1 / 3"},type:"number",value:f.from.value}),(0,Wy.jsxs)(nb,{fullWidth:!0,children:[(0,Wy.jsx)(Yx,{id:`${CD.key}-vertical-filter-from-unit-select-label`,children:"Unit"}),(0,Wy.jsxs)(DS,{id:`${CD.key}-vertical-filter-from-unit-select`,label:"Unit",labelId:`${CD.key}-vertical-filter-from-unit-select-label`,onChange:e=>x({from:{...f.from,unit:e.target.value}}),value:f.from.unit,children:[(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-from-unit-menu-item-none`,value:"",children:(0,Wy.jsx)("em",{children:"None"})}),Object.values(jU).map((e=>(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-from-unit-menu-item-${e}`,value:e,children:e},e)))]})]}),(0,Wy.jsxs)(nb,{fullWidth:!0,children:[(0,Wy.jsx)(Yx,{id:`${CD.key}-vertical-filter-from-reference-select-label`,children:"Reference"}),(0,Wy.jsxs)(DS,{id:`${CD.key}-vertical-filter-from-reference-select`,label:"Reference",labelId:`${CD.key}-vertical-filter-from-reference-select-label`,onChange:e=>x({from:{...f.from,reference:e.target.value}}),value:f.from.reference,children:[(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-from-reference-menu-item-none`,value:"",children:(0,Wy.jsx)("em",{children:"None"})}),Object.values(VU).map((e=>(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-from-reference-menu-item-${e}`,value:e,children:e},e)))]})]})]})]}),(0,Wy.jsxs)("div",{children:[(0,Wy.jsx)(LM,{marginBlockEnd:2,children:"To"}),(0,Wy.jsxs)("div",{className:"grid-cols-2 grid-gap-4",children:[(0,Wy.jsx)(BS,{fullWidth:!0,id:`${CD.key}-vertical-filter-to-value-textfield`,inputProps:{min:0},label:"Value",onChange:e=>x({to:{...f.to,value:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}}),sx:{gridColumn:"1 / 3"},type:"number",value:f.to.value}),(0,Wy.jsxs)(nb,{fullWidth:!0,children:[(0,Wy.jsx)(Yx,{id:`${CD.key}-vertical-filter-to-unit-select-label`,children:"Unit"}),(0,Wy.jsxs)(DS,{id:`${CD.key}-vertical-filter-to-unit-select`,label:"Unit",labelId:`${CD.key}-vertical-filter-to-unit-select-label`,onChange:e=>x({to:{...f.to,unit:e.target.value}}),value:f.to.unit,children:[(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-to-unit-menu-item-none`,value:"",children:(0,Wy.jsx)("em",{children:"None"})}),Object.values(jU).map((e=>(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-to-unit-menu-item-${e}`,value:e,children:e},e)))]})]}),(0,Wy.jsxs)(nb,{fullWidth:!0,children:[(0,Wy.jsx)(Yx,{id:`${CD.key}-vertical-filter-to-reference-select-label`,children:"Reference"}),(0,Wy.jsxs)(DS,{id:`${CD.key}-vertical-filter-to-reference-select`,label:"Reference",labelId:`${CD.key}-vertical-filter-to-reference-select-label`,onChange:e=>x({to:{...f.to,reference:e.target.value}}),value:f.to.reference,children:[(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-to-reference-menu-item-none`,value:"",children:(0,Wy.jsx)("em",{children:"None"})}),Object.values(VU).map((e=>(0,Wy.jsx)(wL,{id:`${CD.key}-vertical-filter-to-reference-menu-item-${e}`,value:e,children:e},e)))]})]})]})]}),(0,Wy.jsx)(SU,{checked:f.otherReferences,control:(0,Wy.jsx)(AB,{id:`${CD.key}-vertical-filter-other-references-checkbox`}),label:"Include features with different reference",onChange:e=>x({otherReferences:e.target.checked}),sx:{marginBlockEnd:0}}),(0,Wy.jsxs)(BU,{color:"primary",fullWidth:!0,children:[(0,Wy.jsx)(DU,{id:`${CD.key}-vertical-filter-low-ifr-button`,onClick:()=>x(m),selected:qe().isEqual(o,m),value:m,children:"Low IFR"}),(0,Wy.jsx)(DU,{id:`${CD.key}-vertical-filter-hight-ifr-button`,onClick:()=>x(b),selected:qe().isEqual(o,b),value:b,children:"Hight IFR"})]}),(0,Wy.jsxs)("div",{className:"align-items-center d-flex justify-content-end gap-2",children:[(0,Wy.jsx)(Tv,{disabled:qe().isEqual(f,YD.filter.vertical),id:`${CD.key}-vertical-filter-clear-button`,onClick:function(){qe().isEqual(c,f)?s({...r,vertical:YD.filter.vertical}):x(YD.filter.vertical)},children:"Clear"}),(0,Wy.jsx)(Tv,{disabled:qe().isEqual(c,f),id:`${CD.key}-vertical-filter-apply-button`,onClick:function(){s({...r,vertical:f})},children:"Apply"})]})]})]})]})}return null;function v(e,t,n){e.target.checked?s({...r,[t]:[]}):s({...r,[t]:n})}function _(e,t,n){const i=r[t];s({...r,[t]:n?i.filter((t=>t!==e)):qe().uniq([...i,e])})}function x(e){m({...f,...e})}}));var ZU=zn("target");class WU{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;Object.defineProperty(this,ZU,{writable:!0,value:void 0}),this.destroy=()=>{var e;this.node&&(null===(e=kn(this,ZU)[ZU])||void 0===e?void 0:e.contains(this.node))&&kn(this,ZU)[ZU].removeChild(this.node)},kn(this,ZU)[ZU]=t,this.node=document.createElement("div"),this.root=(0,Q.s)(this.node),this.root.render(e),kn(this,ZU)[ZU].appendChild(this.node)}}function $U(e,t){return new WU(e,t)}const qU="map-context-menu-container";function XU(t){let{data:n,mapController:r,onClick:i,onClose:o,position:s}=t;const a=(0,e.useRef)(null),l=(0,e.useRef)(null),[c,u]=(0,e.useState)(0),[h,d]=(0,e.useState)(""),[p,f]=(0,e.useState)(0),[m,g]=(0,e.useState)(0),[y,v]=(0,e.useState)(0),[_,x]=(0,e.useState)(0),[b,w]=(0,e.useState)(0),[S,M]=(0,e.useState)(0),[E,T]=(0,e.useState)(0),C=document.getElementById(Cm.container),A=C.offsetHeight,I=C.offsetWidth,P=h?n[h]:[];return(0,e.useEffect)((()=>{const e=a.current.offsetHeight,t=a.current.offsetWidth;return s.x+t>I?f(I-t):f(s.x),s.y+e>A?g(s.y-e):g(s.y),v(1),document.addEventListener("keydown",L,{once:!0}),document.addEventListener("mousedown",D),r.on("move",R,{once:!0}),r.on("zoom",R,{once:!0}),()=>{document.removeEventListener("keydown",L),document.removeEventListener("mousedown",D),r.off("move",R),r.off("zoom",R)}}),[]),(0,e.useEffect)((()=>{if(h){const e=a.current.getBoundingClientRect(),t=l.current.getBoundingClientRect();e.right+t.width>=I?x(-t.width):x(e.width),e.top+E+t.height>=A?w(E+32-t.height):w(E),M(1)}}),[E,h]),(0,Wy.jsxs)("div",{id:qU,style:{left:`${p}px`,top:`${m}px`,opacity:y},children:[(0,Wy.jsx)(Dw,{className:"map-context-menu-paper",onScroll:function(e){u(e.currentTarget.scrollTop),h&&d("")},ref:a,children:(0,Wy.jsx)(Db,{dense:!0,id:"map-context-menu",children:qe().isEmpty(n)?(0,Wy.jsx)(wL,{disabled:!0,children:(0,Wy.jsx)(LM,{variant:"inherit",children:"No features found"})}):Object.keys(n).sort().map((e=>(0,Wy.jsxs)(wL,{onClick:t=>function(e,t){T(e.currentTarget.offsetTop-c),d(t)}(t,e),children:[(0,Wy.jsx)(LM,{noWrap:!0,sx:{flexGrow:1},variant:"inherit",children:DF.text(e.replace("aixm:","").replace("event:",""))}),(0,Wy.jsx)(yz,{sx:{justifyContent:"flex-end"},children:(0,Wy.jsx)(XN.Z,{})})]},e)))})}),h&&(0,Wy.jsx)(Dw,{className:"map-context-sub-menu-paper",ref:l,sx:{left:_,top:b,opacity:S},children:(0,Wy.jsx)(Db,{dense:!0,id:"map-context-sub-menu",children:qe().orderBy(P,"label").map((e=>(0,Wy.jsx)(wL,{onClick:()=>function(e){i(e),null==o||o()}(e.identifier),title:e.label,children:(0,Wy.jsx)(LM,{noWrap:!0,variant:"inherit",children:e.label})},e.identifier)))})})]});function R(){null==o||o()}function L(e){e.key===JF&&(null==o||o())}function D(e){var t;null!==(t=document.getElementById(qU))&&void 0!==t&&t.contains(e.target)||null==o||o()}}Ye().extend(Je());const YU={unit:"FT",value:0,reference:VU.SFC},KU={unit:"FT",value:12400,reference:VU.SFC};function JU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.every((t=>t===e[0]))}function QU(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).every((e=>"string"==typeof e))}function ej(){var e,t,n,r;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{from:YU,to:KU};const a=i.otherReferences,l={ref:VU[null==i||null===(e=i.from)||void 0===e?void 0:e.reference],m:new(Gs())(null==i?void 0:i.from).m||0},c={ref:VU[null==i||null===(t=i.to)||void 0===t?void 0:t.reference],m:new(Gs())(null==i?void 0:i.to).m||1/0},u={ref:VU[(null==o||null===(n=o.elevationFrom)||void 0===n?void 0:n.reference)||s.from.reference],m:new(Gs())((null==o?void 0:o.elevationFrom)||s.from).m},h={ref:VU[(null==o||null===(r=o.elevationTo)||void 0===r?void 0:r.reference)||s.to.reference],m:new(Gs())((null==o?void 0:o.elevationTo)||s.to).m};return QU([l.ref,c.ref,u.ref,h.ref])?JU([l.ref,c.ref,u.ref,h.ref])?l.m<=u.m&&u.m<=c.m||l.m<=h.m&&h.m<=c.m||l.m<=u.m&&h.m<=c.m:JU([l.ref,u.ref,h.ref])?u.m<=l.m&&l.m<=h.m:JU([c.ref,u.ref,h.ref])?u.m<=c.m&&c.m<=h.m:JU([l.ref,c.ref,u.ref])?l.m<=u.m&&u.m<=c.m:JU([l.ref,c.ref,h.ref])?l.m<=h.m&&h.m<=c.m:a:QU([c.ref,u.ref,h.ref])?JU([c.ref,u.ref,h.ref])?u.m<=c.m:JU([c.ref,h.ref])?h.m<=c.m:JU([c.ref,u.ref])?u.m<=c.m:a:QU([l.ref,u.ref,h.ref])?JU([l.ref,u.ref,h.ref])||JU([l.ref,h.ref])?l.m<=h.m:JU([l.ref,u.ref])?l.m<=u.m:a:QU([c.ref,u.ref])&&JU([c.ref,u.ref])?u.m<=c.m:QU([l.ref,h.ref])&&JU([l.ref,h.ref])?l.m<=h.m:!(!QU([c.ref,h.ref])||!JU([c.ref,h.ref]))||!(!QU([l.ref,u.ref])||!JU([l.ref,u.ref]))||a}function tj(e,t){const n=e.geometry||e._geometry;return{...e,geometry:t?n:null,_geometry:t?null:n}}const nj=K((function(e){return{enabled3D:QD(e),highlightedFeatures:tO(e),filter:eO(e),selectedFeature:rO(e),repository:iO(e)}}))((function(t){const{enabled3D:n,filter:r,highlightedFeatures:i,repository:o,selectedFeature:s}=t,{apiController:a,authRequest:l,mapController:c}=BD(),u=a.getConfig(),h=c.aixmLayers.get(),d=(0,e.useRef)(),p=(0,e.useRef)(!1),f=(0,e.useRef)(s),m=dN(n),[g,y]=(0,e.useState)([]),v=dN(g);return(0,e.useEffect)((()=>(c.on("click",x),()=>{c.off("click",x)})),[]),(0,e.useEffect)((()=>{f.current=s}),[s]),(0,e.useEffect)((()=>{b()}),[n,i]),(0,e.useEffect)((()=>{if(o){const e=new $U((0,Wy.jsx)(Rk,{appendedToDOM:!0}));_(),l.get(`/collections/${o.id}/items/?splitGeometriesAsFeatures=true&excludeFeaturesWithoutGeometry=true&includeOnlyTimesliceTypes=GEOSNAPSHOT&limit=0&includeOnlyProperties=activity,availability,availabilitySchedule,identifier,aixmType,lightColor,markingColor,airspaceClass,airspaceType,label,elevationFrom,elevationTo,verticalStructureGroup,verticalStructureLighted,verticalStructureType&includeBbox=false&&datetime=${Ye()().utc().toISOString()}`,u.adsUri).then((e=>y((null==e?void 0:e.features)||[]))).catch((e=>console.log("Failed to obtain geometry data from /geo endpoint. Error: ",e))).finally((()=>e.destroy()))}}),[o]),(0,e.useEffect)((()=>{var e;(qe().differenceBy(g,v,(e=>e.properties.identifier)).length||qe().differenceBy(v,g,(e=>e.properties.identifier)).length)&&_(),function(e,t){if(e.length){var r,i,o;const s=new $U((0,Wy.jsx)(Rk,{appendedToDOM:!0})),l=qe().groupBy(e,(e=>e.properties.aixmType.replace("aixm:","")));function u(e,r){switch(e){case PD.AIRSPACE:return sr(r.map((e=>{var r,i;let o=qe().cloneDeep(e);null!==(r=o.properties.airspaceType)&&void 0!==r&&null!==(i=r.startsWith)&&void 0!==i&&i.call(r,"OTHER")&&(o.properties.airspaceType="OTHER");const s=function(e,t){var n,r;let{properties:i}=e;const{aixmFeaturesBlacklist:o,airspaceTypeBlacklist:s,vertical:a}=t,l=null!==(n=i.airspaceType)&&void 0!==n&&null!==(r=n.startsWith)&&void 0!==r&&r.call(n,"OTHER")?"OTHER":i.airspaceType;return!o.includes(PD.AIRSPACE)&&!s.includes(l)&&ej(a,i)}(o,t);return c.airspace.set(o,s&&n),s||e.properties.identifier!==f.current||a.selectAndFitToFeature(null),tj(o,s)})));case PD.VERTICAL_STRUCTURE:return sr(r.map((e=>{var n,r;const i=ej(t.vertical,e.properties,{from:YU,to:YU}),o={...e,properties:{...e.properties,height:((null===(n=new(Gs())(e.properties.elevationTo))||void 0===n?void 0:n.m)||0)-((null===(r=new(Gs())(e.properties.elevationFrom))||void 0===r?void 0:r.m)||0)}};return i||e.properties.identifier!==f.current||a.selectAndFitToFeature(null),tj(o,i)})));case PD.ROUTE_SEGMENT:return sr(r.map((e=>{const n=ej(t.vertical,e.properties);return n||e.properties.identifier!==f.current||a.selectAndFitToFeature(null),tj(e,n)})));default:return sr(r)}}const d=e.find((e=>e.properties.identifier===f.current)),p=null==d||null===(r=d.properties)||void 0===r||null===(i=r.aixmType)||void 0===i||null===(o=i.replace)||void 0===o?void 0:o.call(i,"aixm:","");Object.entries(l).forEach((e=>{let[r,i]=e;const o=`${CD.key}-${r}`,s=u(r,i);c.source.set(o,s),h.filter((e=>e.source===o)).forEach((e=>{c.layer.set(e.id,e),function(e,t,n,r){const{aixmFeaturesBlacklist:i,aixmFeaturesLabelsBlacklist:o}=t;return!(i.includes(r)||i.some((t=>e.id.startsWith(`${CD.key}#${t}#`)))||o.some((t=>e.id.startsWith(`${CD.key}#${t}#`)&&e.id.endsWith("#label")))||void 0!==e.only2D&&e.only2D&&n||void 0!==e.only3D&&e.only3D&&!n)}(e,t,n,r)?c.layer.show(e.id):(e.only3D||r!==p||p===PD.AIRSPACE||a.selectAndFitToFeature(null),c.layer.hide(e.id))}))})),s.destroy()}}(g,r),p.current||(c.source.set(RD,sr(g.filter((e=>e.properties.identifier===s)))),(e=RD,[{id:`${e}#polygon#fill`,source:e,type:"fill",paint:{"fill-opacity":0},index:Sm},{id:`${e}#polygonpolyline#line`,source:e,type:"line",paint:{"line-color":AO,"line-width":3},index:Sm},{id:`${e}#point`,source:e,type:"circle",paint:{"circle-color":AO,"circle-radius":3},filter:["in","$type","Point"],index:Sm}]).forEach((e=>c.layer.set(e.id,e))),p.current=!0,b())}),[n,r,g]),null;function _(){c.airspace.removeAll(),Array.from(c.source.getAll().keys()).filter((e=>e.includes(CD.key))).forEach((e=>{Array.from(c.layer.getAll().values()).filter((t=>t.source===e)).forEach((e=>{c.layer.remove(e.id)})),c.source.remove(e)})),p.current=!1}function x(e){const t=new $U((0,Wy.jsx)(Rk,{appendedToDOM:!0})),{lat:n,lng:r}=e.lngLat;l.get(`/collections/${o.id}/items/?bbox=${r},${n},${r},${n}&limit=0&datetime=${Ye()().utc().toISOString()}&zoomLevel=${Math.round(c.zoom.get())}&excludeGeometry=true&includeOnlyTimesliceTypes=GEOSNAPSHOT&includeNotams=true&includeParents=true`,u.adsUri).then((t=>{var n,r;const i=((null==t?void 0:t.features)||[]).map((e=>e.properties)),o=c.getThreeboxFeatures(e.point),s=qe().uniqBy([...o,...i],"identifier");null===(n=d.current)||void 0===n||null===(r=n.destroy)||void 0===r||r.call(n),d.current=$U((0,Wy.jsx)(XU,{data:qe().groupBy(s,(e=>e.aixmType)),mapController:c,onClick:e=>a.selectAndFitToFeature(e),onClose:()=>{var e,t;return null===(e=d.current)||void 0===e||null===(t=e.destroy)||void 0===t?void 0:t.call(e)},position:e.point}),document.getElementById(Fe))})).catch((e=>{console.log("Failed to fetch list",e)})).finally((()=>t.destroy()))}function b(){if(p.current){let e=sr(g.filter((e=>i.includes(e.properties.identifier))));c.airspace.select(n?s:null),e.features.length&&m===n&&c.geojson.fit(e),c.source.set(RD,n?sr(e.features.filter((e=>e.properties.aixmType!==`aixm:${PD.AIRSPACE}`))):e)}}}));function rj(e){return(0,lv.ZP)("MuiSwitch",e)}const ij=(0,$y.Z)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),oj=["className","color","edge","size","sx"],sj=pN(),aj=(0,Iy.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.edge&&t[`edge${(0,mv.Z)(n.edge)}`],t[`size${(0,mv.Z)(n.size)}`]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${ij.thumb}`]:{width:16,height:16},[`& .${ij.switchBase}`]:{padding:4,[`&.${ij.checked}`]:{transform:"translateX(16px)"}}}}]}),lj=(0,Iy.ZP)(gB,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.switchBase,{[`& .${ij.input}`]:t.input},"default"!==n.color&&t[`color${(0,mv.Z)(n.color)}`]]}})((e=>{let{theme:t}=e;return{position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${"light"===t.palette.mode?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${ij.checked}`]:{transform:"translateX(20px)"},[`&.${ij.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${"light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${ij.checked} + .${ij.track}`]:{opacity:.5},[`&.${ij.disabled} + .${ij.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:""+("light"===t.palette.mode?.12:.2)},[`& .${ij.input}`]:{left:"-100%",width:"300%"}}}),(e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter((e=>{let[,t]=e;return t.main&&t.light})).map((e=>{let[n]=e;return{props:{color:n},style:{[`&.${ij.checked}`]:{color:(t.vars||t).palette[n].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[n].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,Ay.Fq)(t.palette[n].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ij.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${n}DisabledColor`]:`${"light"===t.palette.mode?(0,Ay.$n)(t.palette[n].main,.62):(0,Ay._j)(t.palette[n].main,.55)}`}},[`&.${ij.checked} + .${ij.track}`]:{backgroundColor:(t.vars||t).palette[n].main}}}}))]}})),cj=(0,Iy.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})((e=>{let{theme:t}=e;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${"light"===t.palette.mode?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:""+("light"===t.palette.mode?.38:.3)}})),uj=(0,Iy.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})((e=>{let{theme:t}=e;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}})),hj=e.forwardRef((function(e,t){const n=sj({props:e,name:"MuiSwitch"}),{className:r,color:i="primary",edge:o=!1,size:s="medium",sx:a}=n,l=(0,My.Z)(n,oj),c=(0,_n.Z)({},n,{color:i,edge:o,size:s}),u=(e=>{const{classes:t,edge:n,size:r,color:i,checked:o,disabled:s}=e,a={root:["root",n&&`edge${(0,mv.Z)(n)}`,`size${(0,mv.Z)(r)}`],switchBase:["switchBase",`color${(0,mv.Z)(i)}`,o&&"checked",s&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},l=(0,Cy.Z)(a,rj,t);return(0,_n.Z)({},t,l)})(c),h=(0,Wy.jsx)(uj,{className:u.thumb,ownerState:c});return(0,Wy.jsxs)(aj,{className:(0,Ey.Z)(u.root,r),sx:a,ownerState:c,children:[(0,Wy.jsx)(lj,(0,_n.Z)({type:"checkbox",icon:h,checkedIcon:h,ref:t,ownerState:c},l,{classes:(0,_n.Z)({},u,{root:u.switchBase})})),(0,Wy.jsx)(cj,{className:u.track,ownerState:c})]})})),dj=hj,pj=K((function(e){return{enabled3D:QD(e),filter:eO(e),selectedRepository:iO(e)}}),(function(e){return{setEnabled3D:function(t){e(function(e){return function(t){t(tt(CD.key,{enabled3D:e}))}}(t))},setFilter:function(t){e(KD(t))}}}))((function(t){const{enabled3D:n,filter:r,focused:i,selectedRepository:o,setEnabled3D:s,setFilter:a}=t,{aixmFeaturesBlacklist:l,aixmFeaturesLabelsBlacklist:c}=r,[u,h]=(0,e.useState)(!0);return(0,e.useEffect)((()=>{a({...r,aixmFeaturesLabelsBlacklist:qe().intersection(BO,l)})}),[l]),(0,e.useEffect)((()=>h(!0)),[o]),i?(0,Wy.jsx)("section",{className:"d-flex flex-column overflow-x-hidden overflow-y-auto flex-grow-1 position-relative",children:(0,Wy.jsxs)(Mb,{id:`${CD.key}-settings-list`,children:[(0,Wy.jsx)(aR,{disablePadding:!0,children:(0,Wy.jsxs)(pz,{id:`${CD.key}-3d-toggle-button`,onClick:()=>s(!n),children:[(0,Wy.jsx)(bz,{primary:"3D features",secondary:"Show 3D features where available"}),(0,Wy.jsx)(dj,{checked:n,edge:"end",id:`${CD.key}-3d-toggle-switch`,tabIndex:-1})]})}),(0,Wy.jsx)(aR,{disablePadding:!0,sx:{bgcolor:"background.paper",position:"sticky",top:0,zIndex:1},children:(0,Wy.jsxs)(pz,{id:`${CD.key}-labels-toggle-button`,onClick:function(){u?(h(!1),a({...r,aixmFeaturesLabelsBlacklist:BO})):(h(!0),a({...r,aixmFeaturesLabelsBlacklist:[]}))},children:[(0,Wy.jsx)(bz,{primary:"Labels",secondary:"Show feature labels"}),(0,Wy.jsx)(dj,{checked:u,edge:"end",id:`${CD.key}-labels-toggle-switch`,tabIndex:-1})]})}),(0,Wy.jsx)(bN,{in:u,unmountOnExit:!0,timeout:"auto",children:(0,Wy.jsx)(Mb,{component:"div",disablePadding:!0,id:`${CD.key}-labels-list`,children:BO.map((e=>{const t=c.includes(e);return(0,Wy.jsxs)(pz,{dense:!0,id:`${CD.key}-label-list-item-${e}`,onClick:()=>function(e,t){a({...r,aixmFeaturesLabelsBlacklist:t?c.filter((t=>t!==e)):qe().uniq([...c,e])})}(e,t),sx:{pl:4},children:[(0,Wy.jsx)(yz,{children:(0,Wy.jsx)(AB,{checked:!t,disableRipple:!0,edge:"start",id:`${CD.key}-label-checkbox-${e}`,size:"small",tabIndex:-1})}),(0,Wy.jsx)(bz,{primary:DF.text(e)})]},e)}))})})]})}):null}));function fj(e){return(0,lv.ZP)("MuiLinearProgress",e)}(0,$y.Z)("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const mj=["className","color","value","valueBuffer","variant"];let gj,yj,vj,_j,xj,bj,wj=e=>e;const Sj=(0,Hy.F4)(gj||(gj=wj`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`)),Mj=(0,Hy.F4)(yj||(yj=wj`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`)),Ej=(0,Hy.F4)(vj||(vj=wj`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`)),Tj=(e,t)=>"inherit"===t?"currentColor":e.vars?e.vars.palette.LinearProgress[`${t}Bg`]:"light"===e.palette.mode?(0,Ay.$n)(e.palette[t].main,.62):(0,Ay._j)(e.palette[t].main,.5),Cj=(0,Iy.ZP)("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`color${(0,mv.Z)(n.color)}`],t[n.variant]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},backgroundColor:Tj(n,t.color)},"inherit"===t.color&&"buffer"!==t.variant&&{backgroundColor:"none","&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}},"buffer"===t.variant&&{backgroundColor:"transparent"},"query"===t.variant&&{transform:"rotate(180deg)"})})),Aj=(0,Iy.ZP)("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.dashed,t[`dashedColor${(0,mv.Z)(n.color)}`]]}})((e=>{let{ownerState:t,theme:n}=e;const r=Tj(n,t.color);return(0,_n.Z)({position:"absolute",marginTop:0,height:"100%",width:"100%"},"inherit"===t.color&&{opacity:.3},{backgroundImage:`radial-gradient(${r} 0%, ${r} 16%, transparent 42%)`,backgroundSize:"10px 10px",backgroundPosition:"0 -23px"})}),(0,Hy.iv)(_j||(_j=wj`
    animation: ${0} 3s infinite linear;
  `),Ej)),Ij=(0,Iy.ZP)("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${(0,mv.Z)(n.color)}`],("indeterminate"===n.variant||"query"===n.variant)&&t.bar1Indeterminate,"determinate"===n.variant&&t.bar1Determinate,"buffer"===n.variant&&t.bar1Buffer]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",backgroundColor:"inherit"===t.color?"currentColor":(n.vars||n).palette[t.color].main},"determinate"===t.variant&&{transition:"transform .4s linear"},"buffer"===t.variant&&{zIndex:1,transition:"transform .4s linear"})}),(e=>{let{ownerState:t}=e;return("indeterminate"===t.variant||"query"===t.variant)&&(0,Hy.iv)(xj||(xj=wj`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
    `),Sj)})),Pj=(0,Iy.ZP)("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.bar,t[`barColor${(0,mv.Z)(n.color)}`],("indeterminate"===n.variant||"query"===n.variant)&&t.bar2Indeterminate,"buffer"===n.variant&&t.bar2Buffer]}})((e=>{let{ownerState:t,theme:n}=e;return(0,_n.Z)({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left"},"buffer"!==t.variant&&{backgroundColor:"inherit"===t.color?"currentColor":(n.vars||n).palette[t.color].main},"inherit"===t.color&&{opacity:.3},"buffer"===t.variant&&{backgroundColor:Tj(n,t.color),transition:"transform .4s linear"})}),(e=>{let{ownerState:t}=e;return("indeterminate"===t.variant||"query"===t.variant)&&(0,Hy.iv)(bj||(bj=wj`
      width: auto;
      animation: ${0} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
    `),Mj)})),Rj=e.forwardRef((function(e,t){const n=(0,Ry.Z)({props:e,name:"MuiLinearProgress"}),{className:r,color:i="primary",value:o,valueBuffer:s,variant:a="indeterminate"}=n,l=(0,My.Z)(n,mj),c=(0,_n.Z)({},n,{color:i,variant:a}),u=(e=>{const{classes:t,variant:n,color:r}=e,i={root:["root",`color${(0,mv.Z)(r)}`,n],dashed:["dashed",`dashedColor${(0,mv.Z)(r)}`],bar1:["bar",`barColor${(0,mv.Z)(r)}`,("indeterminate"===n||"query"===n)&&"bar1Indeterminate","determinate"===n&&"bar1Determinate","buffer"===n&&"bar1Buffer"],bar2:["bar","buffer"!==n&&`barColor${(0,mv.Z)(r)}`,"buffer"===n&&`color${(0,mv.Z)(r)}`,("indeterminate"===n||"query"===n)&&"bar2Indeterminate","buffer"===n&&"bar2Buffer"]};return(0,Cy.Z)(i,fj,t)})(c),h=vb(),d={},p={bar1:{},bar2:{}};if(("determinate"===a||"buffer"===a)&&void 0!==o){d["aria-valuenow"]=Math.round(o),d["aria-valuemin"]=0,d["aria-valuemax"]=100;let e=o-100;h&&(e=-e),p.bar1.transform=`translateX(${e}%)`}if("buffer"===a&&void 0!==s){let e=(s||0)-100;h&&(e=-e),p.bar2.transform=`translateX(${e}%)`}return(0,Wy.jsxs)(Cj,(0,_n.Z)({className:(0,Ey.Z)(u.root,r),ownerState:c,role:"progressbar"},d,{ref:t},l,{children:["buffer"===a?(0,Wy.jsx)(Aj,{className:u.dashed,ownerState:c}):null,(0,Wy.jsx)(Ij,{className:u.bar1,ownerState:c,style:p.bar1}),"determinate"===a?null:(0,Wy.jsx)(Pj,{className:u.bar2,ownerState:c,style:p.bar2})]}))})),Lj=Rj,Dj="NO_DATASET_DEFINED",Oj=K((function(e){return{hasInitialState:WD(e).includes(CD.key),tab:oO(e)}}),(function(e){return{setInitialState:function(){var t;e((t={key:CD.key,initialState:YD},{type:Qe,payload:{widget:t}}))},setDatasets:function(t){e(function(e){return function(t){t(tt(CD.key,{datasets:e}))}}(t))},setRepository:function(t){var n;e((n=t,function(e){e(tt(CD.key,{selectedRepository:n}))}))},setTab:function(t){e(function(e){return function(t){t(tt(CD.key,{tab:e}))}}(t))}}}))((function(t){const{hasInitialState:n,setDatasets:r,setInitialState:i,setRepository:o,setTab:s,tab:a}=t,[l,c]=(0,e.useState)(!1),u=BD(),h=u.apiController.getConfig();return(0,e.useEffect)((()=>{i(),u.authRequest.get("/feature-types",h.adsUri).then((e=>{var t;r(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return Object.keys(e).forEach((n=>{const r=e[n].datasets;0===r.length&&(t[Dj]||(t[Dj]=[]),t[Dj].push(n)),r.forEach((e=>{t[e]||(t[e]=[]),t[e].push(n)}))})),t}(null==e?void 0:e.featureTypes)),u.mapController.airspace.colors.set(function(e){let{airspaceStyleDefinition:t}=e,n={};return t.typeSettings.forEach((e=>e.types.forEach((t=>{n[t]=ZD(e.lineArgb).color})))),n}(null==e||null===(t=e.featureTypes)||void 0===t?void 0:t.Airspace)),u.mapController.aixmLayers.set(function(e){let{featureTypes:t,metadata:n}=e;const r=qe().flattenDeep(Object.entries(t).map((e=>{let[t,r]=e,i=[];const{airspaceStyleDefinition:o,group:s,hasAvailability:a}=r,l=r.styleDefinitions.filter((e=>!e.isDrawModeOnly));return s===iN?i=JO(t,o,l,a,n):s===oN?i=l.map((e=>QO(t,e,a,n))):s===sN?i=l.map((e=>eN(t,e,a,n))):s===aN?i=l.map((e=>tN(t,e,a,n))):s===lN?i=l.map((e=>nN(t,e,a,n))):s===cN?i=l.map((e=>QO(t,e,a,n))):s===uN&&(i=l.map((e=>rN(t,e,a,n)))),i=qe().flattenDeep(i),i.find((e=>e.id.endsWith(`#${FO}#${fO}`)||e.id.endsWith(`#${FO}#${_O}`)))&&(i=i.filter((e=>!e.id.endsWith(`#${NO}#${fO}`)))),i.find((e=>e.id.endsWith(`#${kO}#line`)))&&(i=i.filter((e=>!e.id.endsWith(`#${NO}#${vO}`)))),i.find((e=>e.id.endsWith(`#${zO}#fill`)))&&(i=i.filter((e=>!e.id.endsWith(`#${NO}#${mO}`)&&!e.id.endsWith(`#${NO}#${gO}`)))),i})));return qe().orderBy(r,"index","asc").map(((e,t)=>({...e,index:e.id.endsWith(yO)?Tm:e.type===gO?Mm:t})))}(e)),c(!0)})).catch((e=>console.log("Failed to obtain data from /feature-types. Error: ",e))),u.authRequest.get("/collections",h.adsUri).then((e=>{var t,n,r,i;const s=(null==e||null===(t=e.collections)||void 0===t?void 0:t[0])||null;u.mapController.bbox.fit(null==s||null===(n=s.extent)||void 0===n||null===(r=n.spatial)||void 0===r||null===(i=r.bbox)||void 0===i?void 0:i[0]),o(s)})).catch((e=>console.log(e)))}),[]),n?(0,Wy.jsxs)("div",{className:"d-flex flex-column flex-grow-1",children:[l&&(0,Wy.jsx)(nj,{}),(0,Wy.jsx)(rk,{sx:{borderBottom:1,borderColor:"divider",width:"100%"},children:(0,Wy.jsxs)(zT,{id:`${CD.key}-tabs`,onChange:(e,t)=>s(t),scrollButtons:"auto",value:a,variant:"scrollable",children:[(0,Wy.jsx)(uT,{id:$D.id,label:$D.label,tabIndex:0,value:$D.id}),(0,Wy.jsx)(uT,{id:qD.id,label:qD.label,tabIndex:0,value:qD.id}),(0,Wy.jsx)(uT,{id:XD.id,label:XD.label,tabIndex:0,value:XD.id})]})}),(0,Wy.jsx)(tU,{focused:a===$D.id}),(0,Wy.jsx)(pj,{focused:a===qD.id}),(0,Wy.jsx)(HU,{focused:a===XD.id})]}):(0,Wy.jsx)(Lj,{})}));var Nj=i(9883),kj=i(6713),Fj=i(8324);const zj=K((function(e){return{config:UD(e),cross:jD(e),globe:GD(e),style:HD(e)||je.key}}))((function(){const t=BD(),n=t.apiController.getConfig(),[r,i]=(0,e.useState)(!1),[o,s]=(0,e.useState)(!0),[a,l]=(0,e.useState)({bearing:0,pitch:0}),c=qe().debounce((()=>l({bearing:t.mapController.bearing.get(),pitch:t.mapController.pitch.get()})),15);return(0,e.useEffect)((()=>(t.mapController.mount(t,n,{...Cm,projection:Rm,style:Ve.style}).then((()=>{t.mapController.on("move",c),i(!0)})),()=>{t.mapController.unmount()})),[]),(0,Wy.jsxs)("div",{className:"d-flex flex-grow-1 h-100 position-relative",children:[(0,Wy.jsxs)("div",{className:"aixm-side-panel "+(o?"":"hidden"),children:[(0,Wy.jsxs)("div",{className:"h-100 overflow-x-hidden w-100",style:{paddingBottom:"36px"},children:[!r&&(0,Wy.jsx)(Lj,{}),r&&(0,Wy.jsx)(Oj,{})]}),(0,Wy.jsxs)(Tv,{onClick:()=>s(!o),style:{position:"absolute",top:"4px",left:"100%",zIndex:100},children:[o&&(0,Wy.jsx)(Nj.Z,{}),!o&&(0,Wy.jsx)(kj.Z,{})]})]}),(0,Wy.jsxs)("div",{id:"map-screen-container",children:[(0,Wy.jsx)("div",{id:Cm.container}),(0,Wy.jsx)(Tv,{id:"reset-viewport-button",onClick:function(){t.mapController.bearing.set(0),t.mapController.pitch.set(0)},tooltip:{supportingText:"Reset viewport to true north"},variant:"contained",sx:{backgroundColor:"rgba(94, 95, 82, 0.5)",borderRadius:"50%",fontSize:"32px",position:"absolute",right:"14px",bottom:"11px",height:"64px",width:"64px",zIndex:105},children:(0,Wy.jsx)(Fj.Z,{style:{transform:`perspective(2rem) rotateX(${a.pitch||0}deg) rotateZ(${a.bearing||0}deg)`}})})]})]})})),Bj=function(){const t=BD(),[n,r]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{t.apiController.once("init",(()=>r(!0))),window.postMessage({source:Fe,event:"loaded",apiControllerTarget:"NGAviationMapViewer"})}),[]),(0,Wy.jsxs)(Sy,{anchorOrigin:{horizontal:"right",vertical:"bottom"},hideIconVariant:!0,maxSnack:5,children:[n&&(0,Wy.jsx)(zj,{}),(0,Wy.jsx)("footer",{className:"ngaviation-license-footer",children:" 2024 NG Aviation s. r. o. All rights reserved. Any use of this source code is subject to entering into a separate license agreement."})]})};function Uj(e){return Uj="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uj(e)}function jj(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vj(e){return Vj=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Vj(e)}function Gj(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hj(e,t){return Hj=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Hj(e,t)}function Zj(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wj=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=function(e,t){return!t||"object"!==Uj(t)&&"function"!=typeof t?Gj(e):t}(this,(e=Vj(t)).call.apply(e,[this].concat(i))),Zj(Gj(n),"state",{bootstrapped:!1}),Zj(Gj(n),"_unsubscribe",void 0),Zj(Gj(n),"handlePersistorState",(function(){n.props.persistor.getState().bootstrapped&&(n.props.onBeforeLift?Promise.resolve(n.props.onBeforeLift()).finally((function(){return n.setState({bootstrapped:!0})})):n.setState({bootstrapped:!0}),n._unsubscribe&&n._unsubscribe())})),n}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hj(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return"function"==typeof this.props.children?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}])&&jj(n.prototype,r),t}(e.PureComponent);Zj(Wj,"defaultProps",{children:null,loading:null});const $j=K((function(e){return{darkTheme:VD(e)}}),{reset:te})((function(e){const{darkTheme:t,error:n={},reset:r}=e,{message:i,stack:o}=n;return(0,Wy.jsxs)("div",{className:"ng-background-image-screen",children:[(0,Wy.jsx)("header",{children:(0,Wy.jsx)("img",{src:"/asset/logo.svg",alt:"NG Aviation logo"})}),(0,Wy.jsxs)("main",{children:[(0,Wy.jsx)("img",{alt:"NG Aviation Background",className:"background-image",src:"/asset/image/ng_background-login-1.jpeg"}),(0,Wy.jsxs)("div",{className:"text-container body-medium",children:[(0,Wy.jsx)("h1",{className:"headline-small",children:"Unexpected error occured in application"}),(0,Wy.jsx)("p",{children:"You can try to fix this error by resetting the application storage."}),(0,Wy.jsx)(eF,{className:"mb-4",color:t?"primary":"inverse-primary",prepend:(0,Wy.jsx)("span",{className:"material-symbols-outlined",children:"history"}),onClick:function(){r(),window.location.reload()},variant:"outlined",children:"Reset storage"}),i&&(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)("h6",{className:"title-medium",children:"Error message"}),(0,Wy.jsx)("pre",{className:"body-medium",children:i})]}),o&&(0,Wy.jsxs)(Wy.Fragment,{children:[(0,Wy.jsx)("h6",{className:"title-medium",children:"Error stacktrace"}),(0,Wy.jsx)("pre",{className:"body-medium",children:o})]})]})]})]})}));window.isMobile=function(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}();const qj=K(null,{reset:te})(class extends e.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}render(){return this.state.hasError?(0,Wy.jsx)($j,{error:this.state.error}):this.props.children}});(0,Q.s)(document.getElementById(Fe)).render((0,Wy.jsx)(zD,{children:(0,Wy.jsx)(J,{store:yn,children:(0,Wy.jsx)(Wj,{persistor:vn,children:(0,Wy.jsx)(qj,{children:(0,Wy.jsx)(VS,{dateAdapter:class{constructor(){var e=this;let{locale:t,formats:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var r,i;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=Ln,this.setLocaleToValue=e=>{const t=this.getCurrentLocaleCode();return t===e.locale()?e:e.locale(t)},this.hasUTCPlugin=()=>void 0!==Ye().utc,this.hasTimezonePlugin=()=>void 0!==Ye().tz,this.isSame=(e,t,n)=>{const r=this.setTimezone(t,this.getTimezone(e));return e.format(n)===r.format(n)},this.cleanTimezone=e=>{switch(e){case"default":return;case"system":return Ye().tz.guess();default:return e}},this.createSystemDate=e=>{if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const t=Ye().tz.guess();return"UTC"!==t?Ye().tz(e,t):Ye()(e)}return Ye()(e)},this.createUTCDate=e=>{if(!this.hasUTCPlugin())throw new Error(On);return Ye().utc(e)},this.createTZDate=(e,t)=>{if(!this.hasUTCPlugin())throw new Error(On);if(!this.hasTimezonePlugin())throw new Error(Nn);const n=void 0!==e&&!e.endsWith("Z");return Ye()(e).tz(this.cleanTimezone(t),n)},this.getLocaleFormats=()=>{const e=Ye().Ls;let t=e[this.locale||"en"];return void 0===t&&(Rn(),t=e.en),t.formats},this.adjustOffset=e=>{if(!this.hasTimezonePlugin())return e;const t=this.getTimezone(e);if("UTC"!==t){const n=e.tz(this.cleanTimezone(t),!0);return(n.$offset??0)===(e.$offset??0)?e:n}return e},this.date=function(t){let n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return null===t?null:(n="UTC"===r?e.createUTCDate(t):"system"===r||"default"===r&&!e.hasTimezonePlugin()?e.createSystemDate(t):e.createTZDate(t,r),void 0===e.locale?n:n.locale(e.locale))},this.getInvalidDate=()=>Ye()(new Date("Invalid date")),this.getTimezone=e=>{if(this.hasTimezonePlugin()){const t=e.$x?.$timezone;if(t)return t}return this.hasUTCPlugin()&&e.isUTC()?"UTC":"system"},this.setTimezone=(e,t)=>{if(this.getTimezone(e)===t)return e;if("UTC"===t){if(!this.hasUTCPlugin())throw new Error(On);return e.utc()}if("system"===t)return e.local();if(!this.hasTimezonePlugin()){if("default"===t)return e;throw new Error(Nn)}return Ye().tz(e,this.cleanTimezone(t))},this.toJsDate=e=>e.toDate(),this.parse=(e,t)=>""===e?null:this.dayjs(e,t,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=e=>{const t=this.getLocaleFormats();return e.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,((e,n,r)=>{const i=r&&r.toUpperCase();return n||t[r]||t[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,((e,t,n)=>t||n.slice(1)))}))},this.isValid=e=>null!=e&&e.isValid(),this.format=(e,t)=>this.formatByString(e,this.formats[t]),this.formatByString=(e,t)=>this.dayjs(e).format(t),this.formatNumber=e=>e,this.isEqual=(e,t)=>null===e&&null===t||null!==e&&null!==t&&e.toDate().getTime()===t.toDate().getTime(),this.isSameYear=(e,t)=>this.isSame(e,t,"YYYY"),this.isSameMonth=(e,t)=>this.isSame(e,t,"YYYY-MM"),this.isSameDay=(e,t)=>this.isSame(e,t,"YYYY-MM-DD"),this.isSameHour=(e,t)=>e.isSame(t,"hour"),this.isAfter=(e,t)=>e>t,this.isAfterYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()>t.utc():e.isAfter(t,"year"),this.isAfterDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()>t.utc():e.isAfter(t,"day"),this.isBefore=(e,t)=>e<t,this.isBeforeYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()<t.utc():e.isBefore(t,"year"),this.isBeforeDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()<t.utc():e.isBefore(t,"day"),this.isWithinRange=(e,t)=>{let[n,r]=t;return e>=n&&e<=r},this.startOfYear=e=>this.adjustOffset(e.startOf("year")),this.startOfMonth=e=>this.adjustOffset(e.startOf("month")),this.startOfWeek=e=>this.adjustOffset(e.startOf("week")),this.startOfDay=e=>this.adjustOffset(e.startOf("day")),this.endOfYear=e=>this.adjustOffset(e.endOf("year")),this.endOfMonth=e=>this.adjustOffset(e.endOf("month")),this.endOfWeek=e=>this.adjustOffset(e.endOf("week")),this.endOfDay=e=>this.adjustOffset(e.endOf("day")),this.addYears=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"year"):e.add(t,"year")),this.addMonths=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"month"):e.add(t,"month")),this.addWeeks=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"week"):e.add(t,"week")),this.addDays=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"day"):e.add(t,"day")),this.addHours=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"hour"):e.add(t,"hour")),this.addMinutes=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"minute"):e.add(t,"minute")),this.addSeconds=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"second"):e.add(t,"second")),this.getYear=e=>e.year(),this.getMonth=e=>e.month(),this.getDate=e=>e.date(),this.getHours=e=>e.hour(),this.getMinutes=e=>e.minute(),this.getSeconds=e=>e.second(),this.getMilliseconds=e=>e.millisecond(),this.setYear=(e,t)=>this.adjustOffset(e.set("year",t)),this.setMonth=(e,t)=>this.adjustOffset(e.set("month",t)),this.setDate=(e,t)=>this.adjustOffset(e.set("date",t)),this.setHours=(e,t)=>this.adjustOffset(e.set("hour",t)),this.setMinutes=(e,t)=>this.adjustOffset(e.set("minute",t)),this.setSeconds=(e,t)=>this.adjustOffset(e.set("second",t)),this.setMilliseconds=(e,t)=>this.adjustOffset(e.set("millisecond",t)),this.getDaysInMonth=e=>e.daysInMonth(),this.getWeekArray=e=>{const t=this.setLocaleToValue(e),n=this.startOfWeek(this.startOfMonth(t)),r=this.endOfWeek(this.endOfMonth(t));let i=0,o=n;const s=[];for(;o<r;){const e=Math.floor(i/7);s[e]=s[e]||[],s[e].push(o),o=this.addDays(o,1),i+=1}return s},this.getWeekNumber=e=>e.week(),this.getYearRange=e=>{let[t,n]=e;const r=this.startOfYear(t),i=this.endOfYear(n),o=[];let s=r;for(;this.isBefore(s,i);)o.push(s),s=this.addYears(s,1);return o},this.dayjs=(r=Ye(),(i=t)?function(){return r(...arguments).locale(i)}:r),this.locale=t,this.formats=(0,_n.Z)({},Dn,n),Ye().extend(Sn())}getDayOfWeek(e){return e.day()+1}},children:(0,Wy.jsx)(Bj,{})})})})})}))})()})();